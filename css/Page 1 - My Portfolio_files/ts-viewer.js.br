
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="76ba77ca-7525-511b-a1e9-4d3e6defed39")}catch(e){}}();
(()=>{var cy=Object.create;var ld=Object.defineProperty;var dy=Object.getOwnPropertyDescriptor;var uy=Object.getOwnPropertyNames;var py=Object.getPrototypeOf,hy=Object.prototype.hasOwnProperty;var mo=(i,e)=>()=>(i&&(e=i(i=0)),e);var ah=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),si=(i,e)=>{for(var t in e)ld(i,t,{get:e[t],enumerable:!0})},rf=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of uy(e))!hy.call(i,n)&&n!==t&&ld(i,n,{get:()=>e[n],enumerable:!(r=dy(e,n))||r.enumerable});return i};var fs=(i,e,t)=>(t=i!=null?cy(py(i)):{},rf(e||!i||!i.__esModule?ld(t,"default",{value:i,enumerable:!0}):t,i)),li=i=>rf(ld({},"__esModule",{value:!0}),i);var of={};si(of,{ByteBuffer:()=>ci});var sh,nf,ci,cd=mo(()=>{sh=new Int32Array(1),nf=new Float32Array(sh.buffer),ci=class i{constructor(e){if(e&&!(e instanceof Uint8Array))throw new Error("Must initialize a ByteBuffer with a Uint8Array");this._data=e||new Uint8Array(256),this._index=0,this._start=0,this.length=e?e.length:0}extendWindowTo(e){this._index=e._index}getNewWindowFromRight(){let e=new i(this._data);return e._index=this._index,e._start=this._index,e}windowToUint8Array(){return this._data.subarray(this._start,this._index)}toUint8Array(){return this._data.subarray(0,this.length)}readByte(){if(this._index+1>this._data.length)throw new Error("Index out of bounds");return this._data[this._index++]}readByteArray(){let e=this.readVarUint(),t=this._index,r=t+e;if(r>this._data.length)throw new Error("Read array out of bounds");this._index=r;let n=new Uint8Array(e);return n.set(this._data.subarray(t,r)),n}readVarFloat(){let e=this._index,t=this._data,r=t.length;if(e+1>r)throw new Error("Index out of bounds");let n=t[e];if(n===0)return this._index=e+1,0;if(e+4>r)throw new Error("Index out of bounds");let o=n|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;return this._index=e+4,o=o<<23|o>>>9,sh[0]=o,nf[0]}readVarUint(){let e=0,t=0;do{var r=this.readByte();e|=(r&127)<<t,t+=7}while(r&128&&t<35);return e>>>0}readVarInt(){let e=this.readVarUint()|0;return e&1?~(e>>>1):e>>>1}readVarUint64Bin(){let e=0,t="";do{var r=this.readByte();if(e<8){let n=((r&127)>>>0).toString(2);t=(r&128?n.padStart(7,"0"):n)+t}else{t=r.toString(2)+t;break}e+=1}while(r&128);return t}readVarUint64(){return this.convertBase(this.readVarUint64Bin(),2,10)}readVarInt64(){let e=this.readVarUint64Bin();if(e.slice(-1)=="1"){let t=this.parseToDigitsArray(e.slice(0,-1),2);return t=this.add(t,[1],2),"-"+this.convertBase(this.parseFromDigitsArray(t,2),2,10)}else return this.convertBase(e.slice(0,-1),2,10)}readString(){let e="";for(;;){let t,r=this.readByte();if(r<192)t=r;else{let n=this.readByte();if(r<224)t=(r&31)<<6|n&63;else{let o=this.readByte();if(r<240)t=(r&15)<<12|(n&63)<<6|o&63;else{let a=this.readByte();t=(r&7)<<18|(n&63)<<12|(o&63)<<6|a&63}}}if(t===0)break;t<65536?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode((t>>10)+55296,(t&1024-1)+56320))}return e}_growBy(e){if(this.length+e>this._data.length){let t=new Uint8Array(this.length+e<<1);t.set(this._data),this._data=t}this.length+=e}writeByte(e){let t=this.length;this._growBy(1),this._data[t]=e}writeByteArray(e){this.writeVarUint(e.length);let t=this.length;this._growBy(e.length),this._data.set(e,t)}writeVarFloat(e){let t=this.length;nf[0]=e;let r=sh[0];if(r=r>>>23|r<<9,!(r&255)){this.writeByte(0);return}this._growBy(4);let n=this._data;n[t]=r,n[t+1]=r>>8,n[t+2]=r>>16,n[t+3]=r>>24}writeVarUint(e){do{let t=e&127;e>>>=7,this.writeByte(e?t|128:t)}while(e)}writeVarInt(e){this.writeVarUint(e<<1^e>>31)}writeVarUint64Helper(e){if(e){var t=0;do{if(t<8){var r=parseInt(e.slice(-7),2);e=e.slice(0,-7)}else{var r=parseInt(e.slice(-8),2);e=e.slice(0,-8),this.writeByte(r);break}this.writeByte(e?r|128:r),t+=1}while(e)}}writeVarUint64(e){e=this.cleanNumericString(e);let t=this.convertBase(e,10,2);this.writeVarUint64Helper(t)}subtractOne(e){let t=1,r=e.split("").map(Number);for(let n=r.length-1;n>=0;n--)if(r[n]<t)r[n]=1;else{r[n]--,t=0;break}return r.join("").replace(/^0+/,"")}cleanNumericString(e){let t="";for(let r=0;r<e.length;r++){let n=e.charAt(r);(n>="0"&&n<="9"||r===0&&n==="-")&&(t+=n)}return t}writeVarInt64(e){if(e=this.cleanNumericString(e),e!=""){if(e[0]!="-")var t=this.convertBase(e,10,2)+"0";else{var t=this.convertBase(e.slice(1),10,2);if(t=="0"||t==""){this.writeVarUint64("0");return}t=this.subtractOne(t)+"1"}this.writeVarUint64Helper(t)}}add(e,t,r){let n=[],o=Math.max(e.length,t.length),a=0,s=0;for(;s<o||a;){let l=s<e.length?e[s]:0,c=s<t.length?t[s]:0,d=a+l+c;n.push(d%r),a=Math.floor(d/r),s++}return n}multiplyByNumber(e,t,r){if(e<0)return[];if(e===0)return[];let n=[],o=t;for(;e&1&&(n=this.add(n,o,r)),e=e>>1,e!==0;)o=this.add(o,o,r);return n}parseToDigitsArray(e,t){let r=e.toString().split(""),n=[];for(let o=r.length-1;o>=0;o--){let a=parseInt(r[o],t);if(isNaN(a))return[];n.push(a)}return n}parseFromDigitsArray(e,t){let r="";for(let n=e.length-1;n>=0;n--)r+=e[n].toString(t);return r}convertBase(e,t,r){let n=this.parseToDigitsArray(e,t);if(n===null)return"";let o=[0],a=[1];for(let s=0;s<n.length;s++)n[s]&&(o=this.add(o,this.multiplyByNumber(n[s],a,r),r)),a=this.multiplyByNumber(t,a,r);return this.parseFromDigitsArray(o,r)}writeString(e){let t;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);if(r+1===e.length||n<55296||n>=56320)t=n;else{let o=e.charCodeAt(++r);t=(n<<10)+o+(65536-56623104-56320)}if(t===0)throw new Error("Cannot encode a string containing the null character");t<128?this.writeByte(t):(t<2048?this.writeByte(t>>6&31|192):(t<65536?this.writeByte(t>>12&15|224):(this.writeByte(t>>18&7|240),this.writeByte(t>>12&63|128)),this.writeByte(t>>6&63|128)),this.writeByte(t&63|128))}this.writeByte(0)}}});var lh,dd,af=mo(()=>{lh=class{constructor(){this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer),this._value=0}reset(){this._value=0}value(){return this._value}hashStr(e){for(var t=0;t<e.length;++t)this.hashI(e.codePointAt(t)||0)}hashBool(e){this.hashI(e?1:0)}hashBytes(e){for(var t=0;t<e.length;++t)this.hashI(e[t])}hashF(e){this._float[0]=e,this._value=this._combine(this._value,this._int[0])}hashI(e){this._value=this._combine(this._value,e)}_combine(e,t){return t+2654435769+(e<<6)+(e>>2)}},dd=class{constructor(e){this._helper=new lh,this._bb=e}bb(){return this._bb}windowToUint8Array(){return this._bb.windowToUint8Array()}value(){return this._helper.value()}readByte(){let e=this._bb.readByte();return this._helper.hashI(e),e}readByteArray(){let e=this._bb.readByteArray();return this._helper.hashBytes(e),e}readVarFloat(){let e=this._bb.readVarFloat();return this._helper.hashF(e),e}readVarUint(){let e=this._bb.readVarUint();return this._helper.hashI(e),e}readVarInt(){let e=this._bb.readVarInt();return this._helper.hashI(e),e}readVarUint64(){let e=this._bb.readVarUint64();return this._helper.hashStr(e),e}readVarInt64(){let e=this._bb.readVarInt64();return this._helper.hashStr(e),e}readString(){let e=this._bb.readString();return this._helper.hashStr(e),e}}});var Cl,sf=mo(()=>{Cl=class{constructor(e,t){this._buckets=new Map,this._hash=e,this._equals=t}get(e,t){let r=this._hash(e),n=this._buckets.get(r);if(n!==void 0)for(let o=0;o<n.length;++o){let a=n[o];if(this._equals(e,a.key))return a.value}return t}set(e,t){let r=this._hash(e),n=this._buckets.get(r);n===void 0&&(n=[],this._buckets.set(r,n));for(let o=0;o<n.length;++o){let a=n[o];if(this._equals(e,a.key))return a.value=t,t}return n.push({key:e,value:t}),t}remove(e){let t=this._hash(e),r=this._buckets.get(t);if(r!==void 0){for(let n=0;n<r.length;++n)if(this._equals(e,r[n].key)){r.splice(n,1),r.length===0&&this._buckets.delete(t);break}}}}});function je(i){return JSON.stringify(i)}function tr(i,e,t){var r=new Error(i);throw r.line=e,r.column=t,r}var wa=mo(()=>{});var uf={};si(uf,{nativeTypes:()=>cf,parseSchema:()=>ch,reservedNames:()=>df});function Ry(i){let e=i.split(my),t=[],r=0,n=0;for(let o=0;o<e.length;o++){let a=e[o];o&1?gy.test(a)||t.push({text:a,line:n+1,column:r+1}):a!==""&&tr("Syntax error "+je(a),n+1,r+1);let s=a.split(`
`);s.length>1&&(r=0),n+=s.length-1,r+=s[s.length-1].length}return t.push({text:"",line:n,column:r}),t}function Ny(i){function e(){return i[s]}function t(l){return l.test(e().text)?(s++,!0):!1}function r(l,c){if(!t(l)){let d=e();tr("Expected "+c+" but found "+je(d.text),d.line,d.column)}}function n(){let l=e();tr("Unexpected token "+je(l.text),l.line,l.column)}let o=[],a=null,s=0;for(t(Ey)&&(a=e().text,r(ud,"identifier"),r(lf,'";"'));s<i.length&&!t(_y);){let l=[],c;t(Ty)?c="ENUM":t(vy)?c="STRUCT":t(Iy)?c="MESSAGE":n();let d=e();for(r(ud,"identifier"),r(Sy,'"{"');!t(by);){let h=null,u=!1,m=!1;c!=="ENUM"&&(h=e().text,r(ud,"identifier"),u=t(yy));let g=e();r(ud,"identifier");let _=null;c!=="STRUCT"&&(r(fy,'"="'),_=e(),r(Ay,"integer"),(+_.text|0)+""!==_.text&&tr("Invalid integer "+je(_.text),_.line,_.column));let f=e();t(Cy)&&(c!=="MESSAGE"&&tr("Cannot deprecate this field",f.line,f.column),m=!0),r(lf,'";"'),l.push({name:g.text,line:g.line,column:g.column,type:h,isArray:u,isDeprecated:m,value:_!==null?+_.text|0:l.length+1})}o.push({name:d.text,line:d.line,column:d.column,kind:c,fields:l})}return{package:a,definitions:o}}function Oy(i){let e=cf.slice(),t={};for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o];e.indexOf(a.name)!==-1&&tr("The type "+je(a.name)+" is defined twice",a.line,a.column),df.indexOf(a.name)!==-1&&tr("The type name "+je(a.name)+" is reserved",a.line,a.column),e.push(a.name),t[a.name]=a}for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o],s=a.fields;if(a.kind==="ENUM"||s.length===0)continue;for(let c=0;c<s.length;c++){let d=s[c];e.indexOf(d.type)===-1&&tr("The type "+je(d.type)+" is not defined for field "+je(d.name),d.line,d.column)}let l=[];for(let c=0;c<s.length;c++){let d=s[c];l.indexOf(d.value)!==-1&&tr("The id for field "+je(d.name)+" is used twice",d.line,d.column),d.value<=0&&tr("The id for field "+je(d.name)+" must be positive",d.line,d.column),d.value>s.length&&tr("The id for field "+je(d.name)+" cannot be larger than "+s.length,d.line,d.column),l.push(d.value)}}let r={},n=o=>{let a=t[o];if(a&&a.kind==="STRUCT"&&(r[o]===1&&tr("Recursive nesting of "+je(o)+" is not allowed",a.line,a.column),r[o]!==2&&a)){r[o]=1;let s=a.fields;for(let l=0;l<s.length;l++){let c=s[l];c.isArray||n(c.type)}r[o]=2}return!0};for(let o=0;o<i.definitions.length;o++)n(i.definitions[o].name)}function ch(i){let e=Ny(Ry(i));return Oy(e),e}var cf,df,my,ud,gy,fy,_y,lf,Ay,Sy,by,yy,Ty,vy,Iy,Ey,Cy,dh=mo(()=>{wa();cf=["bool","byte","float","int","string","uint","int64","uint64"],df=["ByteBuffer","package"],my=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,ud=/^[A-Za-z_][A-Za-z0-9_]*$/,gy=/^\/\/.*|\s+$/,fy=/^=$/,_y=/^$/,lf=/^;$/,Ay=/^-?\d+$/,Sy=/^\{$/,by=/^\}$/,yy=/^\[\]$/,Ty=/^enum$/,vy=/^struct$/,Iy=/^message$/,Ey=/^package$/,Cy=/^\[deprecated\]$/});var pf={};si(pf,{decodeBinarySchema:()=>hh,encodeBinarySchema:()=>wy});function hh(i){let e=i instanceof ci?i:new ci(i),t=e.readVarUint(),r=[];for(let n=0;n<t;n++){let o=e.readString(),a=e.readByte(),s=e.readVarUint(),l=[];for(let c=0;c<s;c++){let d=e.readString(),h=e.readVarInt(),u=!!(e.readByte()&1),m=e.readVarUint();l.push({name:d,line:0,column:0,type:ph[a]==="ENUM"?null:h,isArray:u,isDeprecated:!1,value:m})}r.push({name:o,line:0,column:0,kind:ph[a],fields:l})}for(let n=0;n<t;n++){let o=r[n].fields;for(let a=0;a<o.length;a++){let s=o[a],l=s.type;if(l!==null&&l<0){if(~l>=uh.length)throw new Error("Invalid type "+l);s.type=uh[~l]}else{if(l!==null&&l>=r.length)throw new Error("Invalid type "+l);s.type=l===null?null:r[l].name}}}return{package:null,definitions:r}}function wy(i){let e=new ci,t=i.definitions,r={};e.writeVarUint(t.length);for(let n=0;n<t.length;n++)r[t[n].name]=n;for(let n=0;n<t.length;n++){let o=t[n];e.writeString(o.name),e.writeByte(ph.indexOf(o.kind)),e.writeVarUint(o.fields.length);for(let a=0;a<o.fields.length;a++){let s=o.fields[a],l=uh.indexOf(s.type);e.writeString(s.name),e.writeVarInt(l===-1?r[s.type]:~l),e.writeByte(s.isArray?1:0),e.writeVarUint(s.value)}}return e.toUint8Array()}var uh,ph,mh=mo(()=>{cd();uh=["bool","byte","int","uint","float","string","int64","uint64"],ph=["ENUM","STRUCT","MESSAGE"]});var mf={};si(mf,{compileSchema:()=>My,compileSchemaJS:()=>hf});function xy(i,e,t,r){let n=[],o="  ";n.push("function(bb, optDedupCache) {"),n.push("  var dedupKey = null;"),t.includes(i.name)&&(n.push("  if (!!optDedupCache) {"),n.push("    if (!(optDedupCache instanceof this.HashTable)) {"),n.push('      throw new Error("optDedupCache must be instance of HashTable");'),n.push("    }"),n.push("    // lookahead with hasher then reference result with dedup cache"),n.push("    var hasher = new this.Hasher(bb.getNewWindowFromRight());"),n.push(`    this[${je("hash"+i.name)}](hasher);`),n.push(`    dedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${je(i.name)} };`),n.push("    var cachedResult = optDedupCache.get(dedupKey, null);"),n.push("    if (cachedResult !== null) {"),n.push("      bb.extendWindowTo(hasher.bb());"),n.push("      return cachedResult;"),n.push("    }"),n.push("  }")),n.push("  var result = {};"),n.push("  if (!(bb instanceof this.ByteBuffer)) {"),n.push("    bb = new this.ByteBuffer(bb);"),n.push("  }"),n.push(""),i.kind==="MESSAGE"&&(n.push("  while (true) {"),n.push("  var x = bb.readVarUint();"),n.push("    switch (x) {"),n.push("    case 0:"),n.push("      return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),n.push(""),o="      ");for(let a=0;a<i.fields.length;a++){let s=i.fields[a],l,c;switch(s.type){case"bool":{l="!!bb.readByte()",c="!!hasher.readByte()";break}case"byte":{l="bb.readByte()",c="hasher.readByte()";break}case"int":{l="bb.readVarInt()",c="hasher.readVarInt()";break}case"uint":{l="bb.readVarUint()",c="hasher.readVarUint()";break}case"int64":{l="bb.readVarInt64()",c="hasher.readVarInt64()";break}case"uint64":{l="bb.readVarUint64()",c="hasher.readVarUint64()";break}case"float":{l="bb.readVarFloat()",c="hasher.readVarFloat()";break}case"string":{l="bb.readString()",c="hasher.readString()";break}default:{let d=e[s.type];d?d.kind==="ENUM"?(l=`this[${je(d.name)}][bb.readVarUint()]`,c=`this[${je(d.name)}][hasher.readVarUint()]`):(l=`this[${je("decode"+d.name)}](bb, optDedupCache || null)`,c=`this[${je("hash"+d.name)}](hasher)`):tr(`Invalid type ${je(s.type)} for field ${je(s.name)}`,s.line,s.column)}}i.kind==="MESSAGE"&&n.push(`    case ${s.value}:`),s.isArray?s.isDeprecated?s.type==="byte"?n.push(o+"bb.readByteArray();"):(n.push(o+"var length = bb.readVarUint();"),n.push(o+`while (length-- > 0) ${l};`)):s.type==="byte"?n.push(o+`result[${je(s.name)}] = bb.readByteArray();`):(n.push(o+"var arrayDedupKey = null;"),n.push(o+"var values = null;"),r.includes(s.type)&&(n.push(o+"if (!!optDedupCache) {"),n.push(o+"  // lookahead with hasher then reference result with dedup cache"),n.push(o+"  var hasher = new this.Hasher(bb.getNewWindowFromRight());"),n.push(o+"  var length = hasher.readVarUint();"),n.push(o+`  for (var i = 0; i < length; i++) ${c};`),n.push(o+`  arrayDedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${je(s.type+"[]")} };`),n.push(o+"  var cachedResult = optDedupCache.get(arrayDedupKey, null);"),n.push(o+"  if (cachedResult !== null) {"),n.push(o+"    bb.extendWindowTo(hasher.bb());"),n.push(o+"    values = cachedResult;"),n.push(o+"  }"),n.push(o+"}")),n.push(o+"if (values === null) {"),n.push(o+"  var length = bb.readVarUint();"),n.push(o+"  var values = Array(length);"),n.push(o+`  for (var i = 0; i < length; i++) values[i] = ${l};`),n.push(o+"  if (arrayDedupKey !== null) { optDedupCache.set(arrayDedupKey, values); }"),n.push(o+"}"),n.push(o+`result[${je(s.name)}] = values;`)):s.isDeprecated?n.push(o+`${l};`):n.push(o+`result[${je(s.name)}] = ${l};`),i.kind==="MESSAGE"&&(n.push("      break;"),n.push(""))}return i.kind==="MESSAGE"?(n.push("    default:"),n.push('      throw new Error("Attempted to parse invalid message");'),n.push("    }"),n.push("  }")):n.push("  return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),n.push("}"),n.join(`
`)}function Py(i,e){let t=[],r="  ";t.push("function(hasher) {"),t.push("  var result = {};"),t.push("  if (!(hasher instanceof this.Hasher)) {"),t.push('    throw new Error("Expected Hasher");'),t.push("  }"),t.push(""),i.kind==="MESSAGE"&&(t.push("  while (true) {"),t.push("    switch (hasher.readVarUint()) {"),t.push("    case 0:"),t.push("      return;"),t.push(""),r="      ");for(let n=0;n<i.fields.length;n++){let o=i.fields[n],a;switch(o.type){case"bool":{a="hasher.readByte()";break}case"byte":{a="hasher.readByte()";break}case"int":{a="hasher.readVarInt()";break}case"uint":{a="hasher.readVarUint()";break}case"int64":{a="hasher.readVarInt64()";break}case"uint64":{a="hasher.readVarUint64()";break}case"float":{a="hasher.readVarFloat()";break}case"string":{a="hasher.readString()";break}default:{let s=e[o.type];s?s.kind==="ENUM"?a="hasher.readVarUint()":a=`this[${je("hash"+s.name)}](hasher)`:tr(`Invalid type ${je(o.type)} for field ${je(o.name)}`,o.line,o.column)}}i.kind==="MESSAGE"&&t.push(`    case ${o.value}:`),o.isArray?o.type==="byte"?t.push(r+"hasher.readByteArray();"):(t.push(r+"var length = hasher.readVarUint();"),t.push(r+`while (length-- > 0) ${a};`)):t.push(r+`${a};`),i.kind==="MESSAGE"&&(t.push("      break;"),t.push(""))}return i.kind==="MESSAGE"?(t.push("    default:"),t.push('      throw new Error("Attempted to parse invalid message");'),t.push("    }"),t.push("  }")):t.push("  return;"),t.push("}"),t.join(`
`)}function Fy(i,e){let t=[];t.push("function(message, bb) {"),t.push("  var isTopLevel = !bb;"),t.push("  if (isTopLevel) bb = new this.ByteBuffer();");for(let r=0;r<i.fields.length;r++){let n=i.fields[r],o;if(!n.isDeprecated){switch(n.type){case"bool":{o="bb.writeByte(value);";break}case"byte":{o="bb.writeByte(value);";break}case"int":{o="bb.writeVarInt(value);";break}case"uint":{o="bb.writeVarUint(value);";break}case"int64":{o="bb.writeVarInt64(value);";break}case"uint64":{o="bb.writeVarUint64(value);";break}case"float":{o="bb.writeVarFloat(value);";break}case"string":{o="bb.writeString(value);";break}default:{let a=e[n.type];if(a)a.kind==="ENUM"?o=`var encoded = this[${je(a.name)}][value]; if (encoded === void 0) throw new Error("Invalid value " + JSON.stringify(value) + ${je(" for enum "+je(a.name))}); bb.writeVarUint(encoded);`:o=`this[${je("encode"+a.name)}](value, bb);`;else throw new Error(`Invalid type ${je(n.type)} for field ${je(n.name)}`)}}t.push(""),t.push(`  var value = message[${je(n.name)}];`),t.push("  if (value != null) {"),i.kind==="MESSAGE"&&t.push(`    bb.writeVarUint(${n.value});`),n.isArray?n.type==="byte"?t.push("    bb.writeByteArray(value);"):(t.push("    var values = value, n = values.length;"),t.push("    bb.writeVarUint(n);"),t.push("    for (var i = 0; i < n; i++) {"),t.push("      value = values[i];"),t.push(`      ${o}`),t.push("    }")):t.push(`    ${o}`),i.kind==="STRUCT"&&(t.push("  } else {"),t.push(`    throw new Error(${je("Missing required field "+je(n.name))});`)),t.push("  }")}}return i.kind==="MESSAGE"&&t.push("  bb.writeVarUint(0);"),t.push(""),t.push("  if (isTopLevel) return bb.toUint8Array();"),t.push("}"),t.join(`
`)}function Dy(i){return typeof i=="string"?ch(i):i instanceof Uint8Array||i instanceof ci?hh(i):i}function hf(i,e,t){i=Dy(i);let r={},n=i.package,o=[];n!==null?o.push(`var ${n} = exports || ${n} || {}, exports;`):(o.push("var exports = exports || {};"),n="exports"),o.push(`${n}.ByteBuffer = ${n}.ByteBuffer || require("kiwi-schema").ByteBuffer;`);for(let a=0;a<i.definitions.length;a++){let s=i.definitions[a];r[s.name]=s}for(let a=0;a<i.definitions.length;a++){let s=i.definitions[a];switch(s.kind){case"ENUM":{let l={};for(let c=0;c<s.fields.length;c++){let d=s.fields[c];l[d.name]=d.value,l[d.value]=d.name}o.push(`${n}[${je(s.name)}] = ${JSON.stringify(l,null,2)};`);break}case"STRUCT":case"MESSAGE":{o.push(""),o.push(`${n}[${je("decode"+s.name)}] = ${xy(s,r,e,t)};`),o.push(""),o.push(`${n}[${je("encode"+s.name)}] = ${Fy(s,r)};`),o.push(""),o.push(`${n}[${je("hash"+s.name)}] = ${Py(s,r)};`);break}default:tr("Invalid definition kind "+je(s.kind),s.line,s.column)}}return o.push(""),o.join(`
`)}function Ly(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function My(i,e){let t={ByteBuffer:ci,Hasher:dd,HashTable:Cl,makeDedupCache:()=>new Cl(o=>o.hash,(o,a)=>o.defName===a.defName&&Ly(o.data,a.data))},r=[],n=[];return e&&(r=e.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*$/)),n=e.filter(o=>!!o.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(o=>o.slice(0,o.length-2)),n.length+r.length!==e.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping...")),new Function("exports",hf(i,r,n))(t),t}var gf=mo(()=>{cd();af();sf();wa();dh();mh()});var bf={};si(bf,{compileSchemaCallbackCPP:()=>Vy});function By(i,e,t){switch(e){case"bool":return{type:"bool ",name:t};case"byte":return{type:"uint8_t ",name:t};case"int":return{type:"int32_t ",name:t};case"uint":return{type:"uint32_t ",name:t};case"int64":return{type:"int64_t ",name:t};case"uint64":return{type:"uint64_t ",name:t};case"float":return{type:"float ",name:t};case"string":return{type:"const char *",name:t};default:{let r=i[e];return r.kind==="ENUM"?{type:r.name+" ",name:t}:null}}}function xa(i,e,t,r){let n=[];for(let o=0;o<t.length;o++){let a=t[o],s=e+a.name;if(a.isArray&&!r)return null;let l=By(i,a.type,s);if(l!==null){n.push(l);continue}let c=i[a.type];if(c.kind!=="STRUCT")return null;let d=xa(i,s+"_",c.fields,!1);if(d===null)return null;n.push.apply(n,d)}return n}function _s(i){return i.type+i.name}function Af(i){return i.name}function Sf(i){switch(i.type){case"bool ":return`!bb.readBool(${i.name})`;case"uint8_t ":return`!bb.readByte(${i.name})`;case"int32_t ":return`!bb.readVarInt(${i.name})`;case"uint32_t ":return`!bb.readVarUint(${i.name})`;case"int64_t ":return`!bb.readVarInt64(${i.name})`;case"uint64_t ":return`!bb.readVarUint64(${i.name})`;case"float ":return`!bb.readVarFloat(${i.name})`;case"const char *":return`!bb.readString(${i.name})`;default:return`!bb.readVarUint(reinterpret_cast<uint32_t &>(${i.name}))`}}function ff(i){switch(i.type){case"bool ":return`_wb.writeBool(${i.name})`;case"uint8_t ":return`_wb.writeByte(${i.name})`;case"int32_t ":return`_wb.writeVarInt(${i.name})`;case"uint32_t ":return`_wb.writeVarUint(${i.name})`;case"int64_t ":return`_wb.writeVarInt64(${i.name})`;case"uint64_t ":return`_wb.writeVarUint64(${i.name})`;case"float ":return`_wb.writeVarFloat(${i.name})`;case"const char *":return`_wb.writeString(${i.name})`;default:return`_wb.writeVarUint(static_cast<uint32_t>(${i.name}))`}}function _f(i,e,t,r,n){let o=r.name;if(r.isArray){let s=`_${o}_count`;i.push(n+`uint32_t ${s};`),i.push(n+`if (!bb.readVarUint(${s})) return false;`),r.isDeprecated||i.push(n+`visitor.visit${t.name}_${r.name}_count(${s});`),i.push(n+`while (${s}-- > 0) {`),n+="  ",o+="_element"}let a=xa(e,"",[r],!0);if(a!==null){for(let s=0;s<a.length;s++)i.push(n+`${_s(a[s])};`);i.push(n+`if (${a.map(Sf).join(" || ")}) return false;`),r.isDeprecated||i.push(n+`visitor.visit${t.name}_${o}(${a.map(Af).join(", ")});`)}else{r.isDeprecated||i.push(n+`visitor.visit${t.name}_${o}();`);let s=e[r.type];i.push(n+`if (!parse${s.name}(bb, visitor)) return false;`)}r.isArray&&i.push(n.slice(2)+"}")}function Vy(i){let e={},t=[];for(let r=0;r<i.definitions.length;r++){let n=i.definitions[r];e[n.name]=n}i.package!==null&&(t.push(`#ifndef INCLUDE_${i.package.toUpperCase()}_H`),t.push(`#define INCLUDE_${i.package.toUpperCase()}_H`),t.push("")),t.push('#include "kiwi.h"'),t.push(""),i.package!==null&&(t.push(`namespace ${i.package} {`),t.push(""));for(let r=0;r<i.definitions.length;r++){let n=i.definitions[r];if(n.kind==="ENUM"){t.push(`enum class ${n.name} : uint32_t {`);for(let o=0;o<n.fields.length;o++){let a=n.fields[o];a.isDeprecated||t.push(`  ${a.name} = ${a.value},`)}t.push("};"),t.push("")}}for(let r=0;r<2;r++){let n=") = 0;";r===0?(t.push("class Visitor {"),t.push("public:")):(t.push("class Writer : public Visitor {"),t.push("private:"),t.push("  kiwi::WriteBuffer &_wb;"),t.push("public:"),t.push("  Writer(kiwi::WriteBuffer &wb) : _wb(wb) {}"),n=") override;");for(let o=0;o<i.definitions.length;o++){let a=i.definitions[o];if(a.kind==="STRUCT"){let s=xa(e,"",a.fields,!1);if(s!==null){t.push(`  virtual void visit${a.name}(${s.map(_s).join(", ")}${n}`);continue}}if(a.kind==="STRUCT"||a.kind==="MESSAGE"){t.push(`  virtual void begin${a.name}(${n}`);for(let s=0;s<a.fields.length;s++){let l=a.fields[s];if(l.isDeprecated)continue;let c=l.name;l.isArray&&(t.push(`  virtual void visit${a.name}_${l.name}_count(uint32_t size${n}`),c+="_element");let d=xa(e,"",[l],!0);d!==null?t.push(`  virtual void visit${a.name}_${c}(${d.map(_s).join(", ")}${n}`):t.push(`  virtual void visit${a.name}_${c}(${n}`)}t.push(`  virtual void end${a.name}(${n}`)}}t.push("};"),t.push("")}for(let r=0;r<i.definitions.length;r++){let n=i.definitions[r];(n.kind==="STRUCT"||n.kind==="MESSAGE")&&t.push(`bool parse${n.name}(kiwi::ByteBuffer &bb, Visitor &visitor);`)}t.push(""),t.push("#ifdef IMPLEMENT_SCHEMA_H"),t.push("");for(let r=0;r<i.definitions.length;r++){let n=i.definitions[r];if(n.kind==="STRUCT"){let o=xa(e,"",n.fields,!1);if(o!==null){t.push(`bool parse${n.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`);for(let a=0;a<o.length;a++)t.push(`  ${_s(o[a])};`);t.push(`  if (${o.map(Sf).join(" || ")}) return false;`),t.push(`  visitor.visit${n.name}(${o.map(Af).join(", ")});`),t.push("  return true;"),t.push("}"),t.push("")}else{t.push(`bool parse${n.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),t.push(`  visitor.begin${n.name}();`);for(let a=0;a<n.fields.length;a++){let s=n.fields[a];_f(t,e,n,s,"  ")}t.push(`  visitor.end${n.name}();`),t.push("  return true;"),t.push("}"),t.push("")}}else if(n.kind==="MESSAGE"){t.push(`bool parse${n.name}(kiwi::ByteBuffer &bb, Visitor &visitor) {`),t.push(`  visitor.begin${n.name}();`),t.push("  while (true) {"),t.push("    uint32_t _type;"),t.push("    if (!bb.readVarUint(_type)) return false;"),t.push("    switch (_type) {"),t.push("      case 0: {"),t.push(`        visitor.end${n.name}();`),t.push("        return true;"),t.push("      }");for(let o=0;o<n.fields.length;o++){let a=n.fields[o];t.push(`      case ${a.value}: {`),_f(t,e,n,a,"        "),t.push("        break;"),t.push("      }")}t.push("      default: return false;"),t.push("    }"),t.push("  }"),t.push("}"),t.push("")}}for(let r=0;r<i.definitions.length;r++){let n=i.definitions[r];if(n.kind==="STRUCT"){let o=xa(e,"",n.fields,!1);if(o!==null){t.push(`void Writer::visit${n.name}(${o.map(_s).join(", ")}) {`);for(let a=0;a<o.length;a++)t.push(`  ${ff(o[a])};`);t.push("}"),t.push("");continue}}if(n.kind==="STRUCT"||n.kind==="MESSAGE"){t.push(`void Writer::begin${n.name}() {`),t.push("}"),t.push("");for(let o=0;o<n.fields.length;o++){let a=n.fields[o];if(a.isDeprecated)continue;let s=a.name;a.isArray&&(t.push(`void Writer::visit${n.name}_${a.name}_count(uint32_t size) {`),n.kind==="MESSAGE"&&t.push(`  _wb.writeVarUint(${a.value});`),t.push("  _wb.writeVarUint(size);"),t.push("}"),t.push(""),s+="_element");let l=xa(e,"",[a],!0);if(l!==null){t.push(`void Writer::visit${n.name}_${s}(${l.map(_s).join(", ")}) {`),n.kind==="MESSAGE"&&!a.isArray&&t.push(`  _wb.writeVarUint(${a.value});`);for(let c=0;c<l.length;c++)t.push(`  ${ff(l[c])};`);t.push("}"),t.push("")}else t.push(`void Writer::visit${n.name}_${s}() {`),n.kind==="MESSAGE"&&!a.isArray&&t.push(`  _wb.writeVarUint(${a.value});`),t.push("}"),t.push("")}t.push(`void Writer::end${n.name}() {`),n.kind==="MESSAGE"&&t.push("  _wb.writeVarUint(0);"),t.push("}"),t.push("")}}return t.push("#endif"),t.push(""),i.package!==null&&(t.push("}"),t.push(""),t.push("#endif"),t.push("")),t.join(`
`)}var yf=mo(()=>{});var Cf={};si(Cf,{compileSchemaCPP:()=>qy,compileSchemaEnumsCPP:()=>Yy});function Cn(i,e,t){let r;switch(e.type){case"bool":r="bool";break;case"byte":r="uint8_t";break;case"int":r="int32_t";break;case"uint":r="uint32_t";break;case"int64":r="int64_t";break;case"uint64":r="uint64_t";break;case"float":r="float";break;case"string":r="kiwi::String";break;default:{let n=i[e.type];n||tr(`Invalid type ${je(e.type)} for field ${je(e.name)}`,e.line,e.column),r=n.name;break}}return t&&(r=`kiwi::Array<${r}>`),r}function $i(i){return"_data_"+i.name}function gh(i){return i>>5}function fh(i){return`(1 << ${i%32})`}function go(i,e){return!e.isArray&&e.type in i&&i[e.type].kind!=="ENUM"}function Tf(i,e,t){switch(e.type){case"bool":return`_wb.writeBool(${t});`;case"byte":return`_wb.writeByte(${t});`;case"int":return`_wb.writeVarInt(${t});`;case"uint":return`_wb.writeVarUint(${t});`;case"int64":return`_wb.writeVarInt64(${t});`;case"uint64":return`_wb.writeVarUint64(${t});`;case"float":return`_wb.writeVarFloat(${t});`;case"string":return`_wb.writeString(${t}.c_str());`;default:{let r=i[e.type];if(!r)tr(`Invalid type ${je(e.type)} for field ${je(e.name)}`,e.line,e.column);else return r.kind==="ENUM"?`_wb.writeVarUint(static_cast<uint32_t>(${t}));`:`if (!${t}${go(i,e)?"->":"."}encode(_wb)) return false;`}}}function vf(i,e,t){let r=go(i,e);switch(e.type){case"bool":return`_bb.readBool(${t})`;case"byte":return`_bb.readByte(${t})`;case"int":return`_bb.readVarInt(${t})`;case"uint":return`_bb.readVarUint(${t})`;case"int64":return`_bb.readVarInt64(${t})`;case"uint64":return`_bb.readVarUint64(${t})`;case"float":return`_bb.readVarFloat(${t})`;case"string":return`_bb.readString(${t}, _pool)`;default:{let n=i[e.type];if(!n)tr(`Invalid type ${je(e.type)} for field ${je(e.name)}`,e.line,e.column);else return n.kind==="ENUM"?`_bb.readVarUint(reinterpret_cast<uint32_t &>(${t}))`:`${t+(r?"->":".")}decode(_bb, _pool, _schema)`}}}function If(i){let e={bool:1,byte:1,int:4,uint:4,float:4};return i.slice().sort(function(t,r){let n=!t.isArray&&e[t.type]||8,o=!r.isArray&&e[r.type]||8;return n!==o?o-n:i.indexOf(t)-i.indexOf(r)})}function ky(i,e,t){let r=i.fields,n=[];n.push(`class ${i.name} {`),n.push("public:"),n.push(`  ${i.name}() { (void)_flags; }`),t||(n.push(`  ${i.name}(const ${i.name}&) = delete;`),n.push(`  ${i.name}& operator=(const ${i.name}&) = delete;`)),n.push(`  ${i.name}(${i.name}&&) = default;`),n.push(`  ${i.name}& operator=(${i.name}&&) = default;`),n.push(""),t&&(n.push(`  ${i.name} copy() const;`),n.push(""));for(let s=0;s<r.length;s++){let l=r[s];if(l.isDeprecated)continue;let c=Cn(e,l,l.isArray);n.push(`  ${c} *${l.name}();`),n.push(`  const ${c} *${l.name}() const;`),go(e,l)?n.push(`  void set_${l.name}(${c} *value);`):l.isArray?n.push(`  ${c} &set_${l.name}(kiwi::MemoryPool &pool, uint32_t count);`):n.push(`  void set_${l.name}(const ${c} &value);`),n.push("")}n.push("  bool encode(kiwi::WriteBuffer &wb) const;"),n.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),n.push(""),n.push("private:"),t&&(n.push(`  ${i.name}(const ${i.name}&) = default;`),n.push(`  ${i.name}& operator=(const ${i.name}&) = default;`)),n.push(`  uint32_t _flags[${r.length+31>>5}] = {};`);let o=If(r),a="  ";for(let s=0;s<o.length;s++){let l=o[s];if(l.isDeprecated)continue;let c=$i(l),d=Cn(e,l,l.isArray);go(e,l)?n.push(a+`${d} *${c} = {};`):n.push(a+`${d} ${c} = {};`)}return n.push("};"),n.push(""),n}function Uy(i,e,t){let r=i.fields,n=[];n.push(`class ${i.name} {`),n.push("public:"),n.push(`  ${i.name}() { (void)_flags; }`),n.push(`  ${i.name}(const ${i.name}&) = delete;`),n.push(`  ${i.name}& operator=(const ${i.name}&) = delete;`),n.push(`  ${i.name}(${i.name}&&) = default;`),n.push(`  ${i.name}& operator=(${i.name}&&) = default;`),n.push(""),t&&(n.push(`  ${i.name} copy(kiwi::MemoryPool& pool) const;`),n.push(""));for(let s=0;s<r.length;s++){let l=r[s];if(l.isDeprecated)continue;let c=Cn(e,l,l.isArray);go(e,l)?(n.push(`  ${c} *${l.name}();`),n.push(`  const ${c} *${l.name}() const;`)):n.push(`  kiwi::Optional<${c}> ${l.name}() const;`),go(e,l)?n.push(`  void set_${l.name}(kiwi::MemoryPool &pool, ${c} *value);`):l.isArray?n.push(`  ${c} &set_${l.name}(kiwi::MemoryPool &pool, uint32_t count);`):n.push(`  void set_${l.name}(kiwi::MemoryPool &pool, const ${c} &value);`),n.push("")}n.push("  bool encode(kiwi::WriteBuffer &wb) const;"),n.push("  bool decode(kiwi::ByteBuffer &bb, kiwi::MemoryPool &pool, const BinarySchema *schema = nullptr);"),n.push(""),n.push("private:"),n.push(`  uint32_t _flags[${r.length+31>>5}] = {};`);let o=If(r);n.push("  union Field {"),n.push("  public:"),n.push("    bool operator==(const Field&) const { return false; }");let a="    ";for(let s=0;s<o.length;s++){let l=o[s];if(l.isDeprecated)continue;let c=$i(l),d=Cn(e,l,l.isArray);go(e,l)?n.push(a+`${d} *${c};`):n.push(a+`${d} ${c};`)}return n.push("  };"),n.push("  kiwi::SparseFields<Field> _fields;"),n.push("  friend std::hash<Field>;"),n.push("};"),n.push(""),n}function Gy(i,e,t){let r=i.fields,n=[];t&&(n.push(`inline ${i.name} ${i.name}::copy() const {`),n.push(`  ${i.name} clone = *this;`),n.push("  return clone;"),n.push("}"),n.push(""));for(let o=0;o<r.length;o++){let a=r[o],s=$i(a),l=Cn(e,a,a.isArray),c=gh(o),d=fh(o);if(a.isDeprecated)continue;let h=`_flags[${c}] |= ${d}`,u=`_flags[${c}] & ${d}`;go(e,a)?(n.push(`inline ${l} *${i.name}::${a.name}() {`),n.push(`  return ${s};`),n.push("}"),n.push(""),n.push(`inline const ${l} *${i.name}::${a.name}() const {`),n.push(`  return ${s};`),n.push("}"),n.push(""),n.push(`inline void ${i.name}::set_${a.name}(${l} *value) {`),n.push(`  ${s} = value;`),n.push("}"),n.push("")):a.isArray?(n.push(`inline ${l} *${i.name}::${a.name}() {`),n.push(`  return ${u} ? &${s} : nullptr;`),n.push("}"),n.push(""),n.push(`inline const ${l} *${i.name}::${a.name}() const {`),n.push(`  return ${u} ? &${s} : nullptr;`),n.push("}"),n.push(""),n.push(`inline ${l} &${i.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),n.push(`  ${h}; return ${s} = pool.array<${Cn(e,a,!1)}>(count);`),n.push("}"),n.push("")):(n.push(`inline ${l} *${i.name}::${a.name}() {`),n.push(`  return ${u} ? &${s} : nullptr;`),n.push("}"),n.push(""),n.push(`inline const ${l} *${i.name}::${a.name}() const {`),n.push(`  return ${u} ? &${s} : nullptr;`),n.push("}"),n.push(""),n.push(`inline void ${i.name}::set_${a.name}(const ${l} &value) {`),n.push(`  ${h}; ${s} = value;`),n.push("}"),n.push(""))}return n}function Hy(i,e){let t=i.fields,r=[];r.push(`bool ${i.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let n=0;n<t.length;n++){let o=t[n];if(o.isDeprecated)continue;let a="  ";i.kind==="STRUCT"?r.push(`  if (${o.name}() == nullptr) return false;`):(r.push(`  if (${o.name}() != nullptr) {`),a="    ");let s=$i(o),l=o.isArray?"_it":s,c=Tf(e,o,l);i.kind==="MESSAGE"&&r.push(a+`_wb.writeVarUint(${o.value});`),o.isArray?(r.push(a+`_wb.writeVarUint(${s}.size());`),r.push(a+`for (const ${Cn(e,o,!1)} &_it : ${s}) ${c}`)):r.push(a+c),i.kind!=="STRUCT"&&r.push("  }")}return i.kind==="MESSAGE"&&r.push("  _wb.writeVarUint(0);"),r.push("  return true;"),r.push("}"),r.push(""),r}function zy(i,e){let t=i.fields,r=[];r.push(`bool ${i.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let n=0;n<t.length;n++)if(t[n].isArray){r.push("  uint32_t count;");break}i.kind==="MESSAGE"&&(r.push("  while (true) {"),r.push("    uint32_t type;"),r.push("    if (!_bb.readVarUint(type)) return false;"),r.push("    switch (type) {"),r.push("      case 0:"),r.push("        return true;"));for(let n=0;n<t.length;n++){let o=t[n],a=$i(o),s=o.isArray?"_it":a,l=go(e,o),c=vf(e,o,s),d=Cn(e,o,!1),h="  ";i.kind==="MESSAGE"&&(r.push(`      case ${o.value}: {`),h="        "),o.isArray?(r.push(h+"if (!_bb.readVarUint(count)) return false;"),o.isDeprecated?o.type==="byte"?r.push(h+"if (!_bb.skipCount(count)) return false;"):r.push(h+`for (${d} &_it : _pool.array<${d}>(count)) if (!${c}) return false;`):o.type==="byte"?r.push(h+`if (!_bb.readByteArray(set_${o.name}(_pool, count).data(), count)) return false;`):r.push(h+`for (${d} &_it : set_${o.name}(_pool, count)) if (!${c}) return false;`)):o.isDeprecated?(l?r.push(h+`${d} *${a} = _pool.allocate<${d}>();`):r.push(h+`${d} ${a} = {};`),r.push(h+`if (!${c}) return false;`)):(l&&r.push(h+`${a} = _pool.allocate<${d}>();`),r.push(h+`if (!${c}) return false;`),l||r.push(h+`set_${o.name}(${a});`)),i.kind==="MESSAGE"&&(r.push("        break;"),r.push("      }"))}return i.kind==="MESSAGE"?(r.push("      default: {"),r.push(`        if (!_schema || !_schema->skip${i.name}Field(_bb, type)) return false;`),r.push("        break;"),r.push("      }"),r.push("    }"),r.push("  }")):r.push("  return true;"),r.push("}"),r.push(""),r}function Wy(i,e,t){let r=i.fields,n=[];t&&(n.push(`inline ${i.name} ${i.name}::copy(kiwi::MemoryPool& pool) const {`),n.push(`  ${i.name} clone;`),n.push("  clone._fields = _fields.copy(pool);"),n.push("  memcpy(clone._flags, _flags, sizeof(_flags));"),n.push("  return clone;"),n.push("}"),n.push(""));for(let o=0;o<r.length;o++){let a=r[o],s=$i(a),l=Cn(e,a,a.isArray),c=gh(o),d=fh(o);if(a.isDeprecated)continue;let h=`_flags[${c}] |= ${d}`,u=`_flags[${c}] & ${d}`,m=go(e,a);m?(n.push(`inline ${l} *${i.name}::${a.name}() {`),n.push(`  if (!(${u})) return nullptr;`),n.push(`  Field* field = _fields.getField(${a.value});`),n.push(`  return field ? ${m?"":"&"}field->${s} : nullptr;`),n.push("}"),n.push(""),n.push(`inline const ${l} *${i.name}::${a.name}() const {`),n.push(`  if (!(${u})) return nullptr;`),n.push(`  const Field* field = _fields.getField(${a.value});`),n.push(`  return field ? ${m?"":"&"}field->${s} : nullptr;`),n.push("}"),n.push("")):(n.push(`inline kiwi::Optional<${l}> ${i.name}::${a.name}() const {`),n.push(`  if (!(${u})) return std::nullopt;`),n.push(`  const Field* field = _fields.getField(${a.value});`),n.push(`  return field ? kiwi::Optional<${l}>(field->${s}) : std::nullopt;`),n.push("}"),n.push("")),go(e,a)?n.push(`inline void ${i.name}::set_${a.name}(kiwi::MemoryPool &pool, ${l} *value) {`):a.isArray?(n.push(`inline ${l} &${i.name}::set_${a.name}(kiwi::MemoryPool &pool, uint32_t count) {`),n.push(`  ${l} value = pool.array<${Cn(e,a,!1)}>(count);`)):n.push(`inline void ${i.name}::set_${a.name}(kiwi::MemoryPool &pool, const ${l} &value) {`),n.push(`  if (${u}) {`),n.push(`    Field* field = _fields.getField(${a.value});`),n.push(`    field->${s} = value;`),a.isArray&&n.push(`    return field->${s};`),n.push("  } else {"),n.push(`    ${h};`),a.isArray?n.push(`    return _fields.addField({${a.value}, Field{.${s} = value}}, pool)->field.${s};`):n.push(`    _fields.addField({${a.value}, Field{.${s} = value}}, pool);`),n.push("  }"),n.push("}"),n.push("")}return n}function Qy(i,e){let t=i.fields,r=[];r.push(`bool ${i.name}::encode(kiwi::WriteBuffer &_wb) const {`);for(let n=0;n<t.length;n++){let o=t[n];if(o.isDeprecated)continue;let a=Cn(e,o,o.isArray),s=go(e,o),l;s?l=`${a}*`:l=`kiwi::Optional<${a}>`;let c=$i(o);r.push(`  const ${l} ${c} = ${o.name}();`),r.push(`  if (${c}) {`),s?r.push(`    const ${Cn(e,o,o.isArray)}* _data = ${c};`):r.push(`    const ${Cn(e,o,o.isArray)}& _data = *${c};`);let d="    ";c="_data";let h=o.isArray?"_it":c,u=Tf(e,o,h);r.push(d+`_wb.writeVarUint(${o.value});`),o.isArray?(r.push(d+`_wb.writeVarUint(${c}.size());`),r.push(d+`for (const ${Cn(e,o,!1)} &_it : ${c}) ${u}`)):r.push(d+u),r.push("  }")}return r.push("  _wb.writeVarUint(0);"),r.push("  return true;"),r.push("}"),r.push(""),r}function Ky(i,e){let t=i.fields,r=[];r.push(`bool ${i.name}::decode(kiwi::ByteBuffer &_bb, kiwi::MemoryPool &_pool, const BinarySchema *_schema) {`);for(let n=0;n<t.length;n++)if(t[n].isArray){r.push("  uint32_t count;");break}r.push("  std::vector<kiwi::SparseFields<Field>::Element> tempFields;"),r.push("  while (true) {"),r.push("    uint32_t type;"),r.push("    if (!_bb.readVarUint(type)) return false;"),r.push("    switch (type) {"),r.push("      case 0: {"),r.push("        _fields = kiwi::SparseFields<Field>(tempFields.data(), tempFields.size(), _pool);"),r.push("        return true;"),r.push("      }");for(let n=0;n<t.length;n++){let o=t[n],a=$i(o),s=o.isArray?"_it":a,l=go(e,o),c=vf(e,o,s),d=Cn(e,o,!1),h=gh(n),u=fh(n),m=`_flags[${h}] |= ${u}`;r.push(`      case ${o.value}: {`);let g="        ";o.isArray?(r.push(g+"if (!_bb.readVarUint(count)) return false;"),o.isDeprecated?o.type==="byte"?r.push(g+"if (!_bb.skipCount(count)) return false;"):r.push(g+`for (${d} &_it : _pool.array<${d}>(count)) if (!${c}) return false;`):(r.push(g+`${m};`),r.push(g+`${Cn(e,o,!0)} ${a} = _pool.array<${d}>(count);`),o.type==="byte"?r.push(g+`if (!_bb.readByteArray(${a}.data(), count)) return false;`):r.push(g+`for (${d} &_it : ${a}) if (!${c}) return false;`),r.push(g+`tempFields.push_back({${o.value}, Field{.${a} = ${a}}});`))):(l?r.push(g+`${d}* ${a} = _pool.allocate<${d}>();`):r.push(g+`${d} ${a} = {};`),r.push(g+`if (!${c}) return false;`),o.isDeprecated||(r.push(g+`${m};`),r.push(g+`tempFields.push_back({${o.value}, Field{.${a} = ${a}}});`))),r.push("        break;"),r.push("      }")}return r.push("      default: {"),r.push(`        if (!_schema || !_schema->skip${i.name}Field(_bb, type)) return false;`),r.push("        break;"),r.push("      }"),r.push("    }"),r.push("  }"),r.push("}"),r.push(""),r}function qy(i,e={}){let t={};for(let s of i.definitions)t[s.name]=s;let{sparseMessages:r=[],copyableMessages:n=[],separateEnumFile:o}=e;for(let s of r)s in t||tr(`Requesting sparse implementation for ${je(s)} which is not defined in the schema`,0,0);let a=[];a.push('#include "kiwi.h"'),o&&a.push(`#include "${o}"`),a.push(""),i.package!==null&&(a.push(`namespace ${i.package} {`),a.push(""),a.push(`#ifndef INCLUDE_${i.package.toUpperCase()}_H`),a.push(`#define INCLUDE_${i.package.toUpperCase()}_H`),a.push("")),a.push("class BinarySchema {"),a.push("public:"),a.push("  bool parse(kiwi::ByteBuffer &bb);"),a.push("  const kiwi::BinarySchema &underlyingSchema() const { return _schema; }");for(let s=0;s<i.definitions.length;s++){let l=i.definitions[s];l.kind==="MESSAGE"&&a.push(`  bool skip${l.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const;`)}a.push(""),a.push("private:"),a.push("  kiwi::BinarySchema _schema;");for(let s=0;s<i.definitions.length;s++){let l=i.definitions[s];l.kind==="MESSAGE"&&a.push(`  uint32_t _index${l.name} = 0;`)}a.push("};"),a.push(""),o||Ef(i,a);for(let s of[0,1,2,3]){let l=!1;if(s===3){if(i.package!==null){if(r.length>0){a.push(`}  // namespace ${i.package}`);for(let c of r)a.push("template<>"),a.push(`struct std::hash<${i.package}::${c}::Field> {`),a.push(`  size_t operator()(const ${i.package}::${c}::Field& msg) const {`),a.push("    return 0;"),a.push("  }"),a.push("};");a.push(`namespace ${i.package} {`)}a.push(`#endif  // INCLUDE_${i.package.toUpperCase()}_H`)}a.push("#ifdef IMPLEMENT_SCHEMA_H"),a.push(""),a.push("bool BinarySchema::parse(kiwi::ByteBuffer &bb) {"),a.push("  if (!_schema.parse(bb)) return false;");for(let c=0;c<i.definitions.length;c++){let d=i.definitions[c];d.kind==="MESSAGE"&&a.push(`  _schema.findDefinition("${d.name}", _index${d.name});`)}a.push("  return true;"),a.push("}"),a.push("");for(let c=0;c<i.definitions.length;c++){let d=i.definitions[c];d.kind==="MESSAGE"&&(a.push(`bool BinarySchema::skip${d.name}Field(kiwi::ByteBuffer &bb, uint32_t id) const {`),a.push(`  return _schema.skipField(bb, _index${d.name}, id);`),a.push("}"),a.push(""))}}for(let c=0;c<i.definitions.length;c++){let d=i.definitions[c];if(d.kind==="ENUM")continue;let h=r.includes(d.name);if(h&&d.kind!=="MESSAGE"){let u=`Type ${je(d.name)} cannot be declared as sparse. `;u+=`${je(d.name)} is type ${je(d.kind)}, but needs to be a MESSAGE.`,tr(u,d.line,d.column)}s===0?(a.push(`class ${d.name};`),l=!0):s===1?h?a=a.concat(Uy(d,t,n.includes(d.name))):a=a.concat(ky(d,t,n.includes(d.name))):s===2?h?a=a.concat(Wy(d,t,n.includes(d.name))):a=a.concat(Gy(d,t,n.includes(d.name))):h?(a=a.concat(Qy(d,t)),a=a.concat(Ky(d,t))):(a=a.concat(Hy(d,t)),a=a.concat(zy(d,t)))}s===3?(a.push("#endif  // IMPLEMENT_SCHEMA_H"),a.push("")):l&&a.push("")}return i.package!==null&&(a.push(`}  // namespace ${i.package}`),a.push("")),a.join(`
`)}function Yy(i){let e=["#pragma once",""];return i.package&&(e.push(`namespace ${i.package} {`),e.push("")),Ef(i,e),i.package&&(e.push(""),e.push(`}  // namespace ${i.package}`),e.push("")),e.join(`
`)}function Ef(i,e){for(let t of i.definitions)if(t.kind==="ENUM"){e.push(`enum class ${t.name} : uint32_t {`);for(let r=0;r<t.fields.length;r++){let n=t.fields[r];e.push(`  ${n.name} = ${n.value},`)}e.push("};"),e.push("")}}var Rf=mo(()=>{wa()});var wf={};si(wf,{compileSchemaSkew:()=>Jy});function Nf(i){i[i.length-1]===""&&i.pop()}function Xy(i,e){if(e.isArray)return"null";switch(e.type){case"bool":return"false";case"byte":case"int":case"uint":return"0";case"int64":case"uint64":return'"0"';case"float":return"0.0";case"string":return"null"}let t=i[e.type];return t.kind==="ENUM"?t.fields.length>0?"."+t.fields[0].name:"0 as "+e.type:"null"}function Of(i){let e;switch(i.type){case"bool":e="bool";break;case"byte":case"int":case"uint":e="int";break;case"int64":case"uint64":e="string";break;case"float":e="double";break;case"string":default:e=i.type;break}return i.isArray&&(e="List<"+e+">"),e}function Jy(i){let e={},t="",r=[];i.package!==null&&(r.push("namespace "+i.package+" {"),t+="  ");for(let n=0;n<i.definitions.length;n++){let o=i.definitions[n];e[o.name]=o}r.push(t+"class BinarySchema {"),r.push(t+"  var _schema = Kiwi.BinarySchema.new");for(let n=0;n<i.definitions.length;n++){let o=i.definitions[n];o.kind==="MESSAGE"&&r.push(t+"  var _index"+o.name+" = 0")}r.push(""),r.push(t+"  def parse(bytes Uint8Array) {"),r.push(t+"    _schema.parse(Kiwi.ByteBuffer.new(bytes))");for(let n=0;n<i.definitions.length;n++){let o=i.definitions[n];o.kind==="MESSAGE"&&r.push(t+"    _index"+o.name+' = _schema.findDefinition("'+o.name+'")')}r.push(t+"  }");for(let n=0;n<i.definitions.length;n++){let o=i.definitions[n];o.kind==="MESSAGE"&&(r.push(""),r.push(t+"  def skip"+o.name+"Field(bb Kiwi.ByteBuffer, id int) {"),r.push(t+"    _schema.skipField(bb, _index"+o.name+", id)"),r.push(t+"  }"))}r.push(t+"}"),r.push("");for(let n=0;n<i.definitions.length;n++){let o=i.definitions[n];switch(o.kind){case"ENUM":{let a={},s={};r.push(t+"enum "+o.name+" {");for(let l=0;l<o.fields.length;l++){let c=o.fields[l];a[c.name]=c.value,s[c.value]=c.name,r.push(t+"  "+c.name)}r.push(t+"}"),r.push(""),r.push(t+"namespace "+o.name+" {"),r.push(t+"  const _encode = "+JSON.stringify(a,null,2).replace(/"/g,"").replace(/\n/g,`
  `+t)),r.push(""),r.push(t+"  const _decode = "+JSON.stringify(s,null,2).replace(/"/g,"").replace(/\n/g,`
  `+t)),r.push(""),r.push(t+"  def encode(value "+o.name+") int {"),r.push(t+"    return _encode[value]"),r.push(t+"  }"),r.push(""),r.push(t+"  def decode(value int) "+o.name+" {"),r.push(t+"    if !(value in _decode) {"),r.push(t+"      Kiwi.DecodeError.throwInvalidEnumValue("+je(o.name)+")"),r.push(t+"    }"),r.push(t+"    return _decode[value]"),r.push(t+"  }"),r.push(t+"}"),r.push("");break}case"STRUCT":case"MESSAGE":{r.push(t+"class "+o.name+" {");for(let s=0;s<o.fields.length;s+=32)r.push(t+"  var _flags"+(s>>5)+" = 0");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];l.isDeprecated||r.push(t+"  var _"+l.name+" "+Of(l)+" = "+Xy(e,l))}r.push("");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];if(l.isDeprecated)continue;let c=Of(l),d="_flags"+(s>>5),h=""+(1<<s%32>>>0);r.push(t+"  def has_"+l.name+" bool {"),r.push(t+"    return ("+d+" & "+h+") != 0"),r.push(t+"  }"),r.push(""),r.push(t+"  def "+l.name+" "+c+" {"),r.push(t+"    assert(has_"+l.name+")"),r.push(t+"    return _"+l.name),r.push(t+"  }"),r.push(""),r.push(t+"  def "+l.name+"=(value "+c+") {"),r.push(t+"    _"+l.name+" = value"),r.push(t+"    "+d+" |= "+h),r.push(t+"  }"),r.push("")}r.push(t+"  def encode(bb Kiwi.ByteBuffer) {");for(let s=0;s<o.fields.length;s++){let l=o.fields[s];if(l.isDeprecated)continue;let c="_"+l.name,d;switch(l.isArray&&(c="value"),l.type){case"bool":{d="bb.writeByte("+c+" as int)";break}case"byte":{d="bb.writeByte("+c+")";break}case"int":{d="bb.writeVarInt("+c+")";break}case"uint":{d="bb.writeVarUint("+c+")";break}case"int64":{d="bb.writeVarInt64("+c+")";break}case"uint64":{d="bb.writeVarUint64("+c+")";break}case"float":{d="bb.writeVarFloat("+c+")";break}case"string":{d="bb.writeString("+c+")";break}default:{let u=e[l.type];u?u.kind==="ENUM"?d="bb.writeVarUint("+u.name+".encode("+c+"))":d=c+".encode(bb)":tr("Invalid type "+je(l.type)+" for field "+je(l.name),l.line,l.column)}}let h=t+"    ";o.kind==="STRUCT"?r.push(h+"assert(has_"+l.name+")"):(r.push(h+"if has_"+l.name+" {"),h+="  "),o.kind==="MESSAGE"&&r.push(h+"bb.writeVarUint("+l.value+")"),l.isArray?(r.push(h+"bb.writeVarUint(_"+l.name+".count)"),r.push(h+"for value in _"+l.name+" {"),r.push(h+"  "+d),r.push(h+"}")):r.push(h+d),o.kind!=="STRUCT"&&r.push(t+"    }"),r.push("")}o.kind==="MESSAGE"?r.push(t+"    bb.writeVarUint(0)"):Nf(r),r.push(t+"  }"),r.push(""),r.push(t+"  def encode Uint8Array {"),r.push(t+"    var bb = Kiwi.ByteBuffer.new"),r.push(t+"    encode(bb)"),r.push(t+"    return bb.toUint8Array"),r.push(t+"  }"),r.push(t+"}"),r.push(""),r.push(t+"namespace "+o.name+" {"),r.push(t+"  def decode(bytes Uint8Array) "+o.name+" {"),r.push(t+"    return decode(Kiwi.ByteBuffer.new(bytes), null)"),r.push(t+"  }"),r.push(""),r.push(t+"  def decode(bytes Uint8Array, schema BinarySchema) "+o.name+" {"),r.push(t+"    return decode(Kiwi.ByteBuffer.new(bytes), schema)"),r.push(t+"  }"),r.push(""),r.push(t+"  def decode(bb Kiwi.ByteBuffer, schema BinarySchema) "+o.name+" {"),r.push(t+"    var self = new");for(let s=0;s<o.fields.length;s++)if(o.fields[s].isArray){r.push(t+"    var count = 0");break}let a=t+"  ";o.kind==="MESSAGE"&&(r.push(t+"    while true {"),r.push(t+"      var type = bb.readVarUint"),r.push(t+"      switch type {"),r.push(t+"        case 0 {"),r.push(t+"          break"),r.push(t+"        }"),r.push(""),a+="      ");for(let s=0;s<o.fields.length;s++){let l=o.fields[s],c;switch(l.type){case"bool":{c=l.isDeprecated?"bb.readByte":"bb.readByte as bool";break}case"byte":{c="bb.readByte";break}case"int":{c="bb.readVarInt";break}case"uint":{c="bb.readVarUint";break}case"int64":{c="bb.readVarInt64";break}case"uint64":{c="bb.readVarUint64";break}case"float":{c="bb.readVarFloat";break}case"string":{c="bb.readString";break}default:{let d=e[l.type];d?d.kind==="ENUM"?c=d.name+".decode(bb.readVarUint)":c=d.name+".decode(bb, schema)":tr("Invalid type "+je(l.type)+" for field "+je(l.name),l.line,l.column)}}o.kind==="MESSAGE"&&r.push(a+"case "+l.value+" {"),l.isArray?l.isDeprecated?(r.push(a+"  for i in 0..bb.readVarUint {"),r.push(a+"    "+c),r.push(a+"  }")):(r.push(a+"  count = bb.readVarUint"),r.push(a+"  self."+l.name+" = []"),r.push(a+"  for array = self._"+l.name+"; count != 0; count-- {"),r.push(a+"    array.append("+c+")"),r.push(a+"  }")):l.isDeprecated?r.push(a+"  "+c):r.push(a+"  self."+l.name+" = "+c),o.kind==="MESSAGE"&&(r.push(a+"}"),r.push(""))}o.kind==="MESSAGE"&&(r.push(t+"        default {"),r.push(t+"          if schema == null { Kiwi.DecodeError.throwInvalidMessage }"),r.push(t+"          else { schema.skip"+o.name+"Field(bb, type) }"),r.push(t+"        }"),r.push(t+"      }"),r.push(t+"    }")),r.push(t+"    return self"),r.push(t+"  }"),r.push(t+"}"),r.push("");break}default:tr("Invalid definition kind "+je(o.kind),o.line,o.column)}}return i.package!==null&&(Nf(r),r.push("}")),r.push(""),r.join(`
`)}var xf=mo(()=>{wa()});var Pf={};si(Pf,{compileSchemaSkewTypes:()=>Zy});function Zy(i){var e="",t=[];i.package!==null&&(t.push("namespace "+i.package+" {"),e+="  ");for(var r=0;r<i.definitions.length;r++){var n=i.definitions[r];if(n.kind==="ENUM"){if(t.push(e+"type "+n.name+" : string {"),t.push(e+"  @alwaysinline"),t.push(e+"  def toString string { return self as string }"),t.push(e+"}"),n.fields.length>0){t.push(e+"namespace "+n.name+" {");for(var o=0;o<n.fields.length;o++)t.push(e+"  @alwaysinline"),t.push(e+"  def "+n.fields[o].name+" "+n.name+" { return "+JSON.stringify(n.fields[o].name)+" as "+n.name+" }");t.push(e+"}")}t.push("")}}for(var r=0;r<i.definitions.length;r++){var n=i.definitions[r];if(n.kind==="STRUCT"||n.kind==="MESSAGE"){t.push(e+"@import"),t.push(e+"class "+n.name+" {");for(var o=0;o<n.fields.length;o++){var a=n.fields[o],s;if(!a.isDeprecated){switch(a.type){case"byte":case"uint":s="int";break;case"uint64":case"int64":s="string";break;case"float":s="double";break;default:s=a.type;break}a.type==="byte"&&a.isArray?s="Uint8Array":a.isArray&&(s="List<"+s+">"),t.push(e+"  var "+a.name+" "+s),t.push(e+"  @alwaysinline"),t.push(e+"  def has_"+a.name+" bool { return self."+a.name+" != dynamic.void(0) }")}}t.push(e+"}"),t.push(""),t.push(e+"namespace "+n.name+" {"),t.push(e+"  @alwaysinline"),t.push(e+"  def new "+n.name+" { return {} as dynamic }"),t.push(e+"}"),t.push("")}else n.kind!=="ENUM"&&tr("Invalid definition kind "+je(n.kind),n.line,n.column)}t.push(e+"type DedupCache = dynamic"),t.push(""),t.push(e+"@import"),t.push(e+"class Schema {"),t.push(e+"  const makeDedupCache fn() DedupCache");for(var r=0;r<i.definitions.length;r++){var n=i.definitions[r];n.kind==="ENUM"?t.push(e+"  const "+n.name+" dynamic"):(n.kind==="STRUCT"||n.kind==="MESSAGE")&&(t.push(e+"  def encode"+n.name+"(message "+n.name+") Uint8Array"),t.push(e+"  def decode"+n.name+"(buffer Uint8Array) "+n.name),t.push(e+"  def decode"+n.name+"(buffer Uint8Array, optionalDedupCache DedupCache) "+n.name))}return t.push(e+"}"),i.package!==null&&t.push("}"),t.push(""),t.join(`
`)}var Ff=mo(()=>{wa()});var Df={};si(Df,{compileSchemaTypeScript:()=>jy});function jy(i){var e="",t=[];i.package!==null&&(t.push("export namespace "+i.package+" {"),e+="  ");for(var r=0;r<i.definitions.length;r++){var n=i.definitions[r];if(n.kind==="ENUM"){t.push(e+"export type "+n.name+" =");for(var o=0;o<n.fields.length;o++)t.push(e+"  "+JSON.stringify(n.fields[o].name)+(o+1<n.fields.length?" |":";"));n.fields.length||t.push(e+"  any;"),t.push("")}}for(var r=0;r<i.definitions.length;r++){var n=i.definitions[r];if(n.kind==="STRUCT"||n.kind==="MESSAGE"){t.push(e+"export interface "+n.name+" {");for(var o=0;o<n.fields.length;o++){var a=n.fields[o],s;if(!a.isDeprecated){switch(a.type){case"bool":s="boolean";break;case"byte":case"int":case"uint":case"float":s="number";break;case"int64":case"uint64":s="string";break;default:s=a.type;break}a.type==="byte"&&a.isArray?s="Uint8Array":a.isArray&&(s+="[]"),t.push(e+"  "+a.name+(n.kind==="MESSAGE"?"?":"")+": "+s+";")}}t.push(e+"}"),t.push("")}else n.kind!=="ENUM"&&tr("Invalid definition kind "+je(n.kind),n.line,n.column)}t.push(e+"export type DedupCache = any;"),t.push(""),t.push(e+"export interface Schema {"),t.push(e+"  makeDedupCache(): DedupCache;");for(var r=0;r<i.definitions.length;r++){var n=i.definitions[r];n.kind==="ENUM"?t.push(e+"  "+n.name+": any;"):(n.kind==="STRUCT"||n.kind==="MESSAGE")&&(t.push(e+"  encode"+n.name+"(message: "+n.name+"): Uint8Array;"),t.push(e+"  decode"+n.name+"(buffer: Uint8Array, optionalDedupCache?: DedupCache): "+n.name+";"))}return t.push(e+"}"),i.package!==null&&t.push("}"),t.push(""),t.join(`
`)}var Lf=mo(()=>{wa()});var Mf={};si(Mf,{prettyPrintSchema:()=>$y});function $y(i){let e=i.definitions,t="";i.package!==null&&(t+="package "+i.package+`;
`);for(let r=0;r<e.length;r++){let n=e[r];(r>0||i.package!==null)&&(t+=`
`),t+=n.kind.toLowerCase()+" "+n.name+` {
`;for(let o=0;o<n.fields.length;o++){let a=n.fields[o];t+="  ",n.kind!=="ENUM"&&(t+=a.type,a.isArray&&(t+="[]"),t+=" "),t+=a.name,n.kind!=="STRUCT"&&(t+=" = "+a.value),a.isDeprecated&&(t+=" [deprecated]"),t+=`;
`}t+=`}
`}return t}var Bf=mo(()=>{});var Rl=ah(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});fr.prettyPrintSchema=fr.parseSchema=fr.encodeBinarySchema=fr.decodeBinarySchema=fr.compileSchemaTypeScript=fr.compileSchemaSkewTypes=fr.compileSchemaSkew=fr.compileSchemaCPP=fr.compileSchemaCallbackCPP=fr.compileSchemaJS=fr.compileSchema=fr.ByteBuffer=void 0;var eT=(cd(),li(of));Object.defineProperty(fr,"ByteBuffer",{enumerable:!0,get:function(){return eT.ByteBuffer}});var Vf=(gf(),li(mf));Object.defineProperty(fr,"compileSchema",{enumerable:!0,get:function(){return Vf.compileSchema}});Object.defineProperty(fr,"compileSchemaJS",{enumerable:!0,get:function(){return Vf.compileSchemaJS}});var tT=(yf(),li(bf));Object.defineProperty(fr,"compileSchemaCallbackCPP",{enumerable:!0,get:function(){return tT.compileSchemaCallbackCPP}});var rT=(Rf(),li(Cf));Object.defineProperty(fr,"compileSchemaCPP",{enumerable:!0,get:function(){return rT.compileSchemaCPP}});var nT=(xf(),li(wf));Object.defineProperty(fr,"compileSchemaSkew",{enumerable:!0,get:function(){return nT.compileSchemaSkew}});var oT=(Ff(),li(Pf));Object.defineProperty(fr,"compileSchemaSkewTypes",{enumerable:!0,get:function(){return oT.compileSchemaSkewTypes}});var iT=(Lf(),li(Df));Object.defineProperty(fr,"compileSchemaTypeScript",{enumerable:!0,get:function(){return iT.compileSchemaTypeScript}});var kf=(mh(),li(pf));Object.defineProperty(fr,"decodeBinarySchema",{enumerable:!0,get:function(){return kf.decodeBinarySchema}});Object.defineProperty(fr,"encodeBinarySchema",{enumerable:!0,get:function(){return kf.encodeBinarySchema}});var aT=(dh(),li(uf));Object.defineProperty(fr,"parseSchema",{enumerable:!0,get:function(){return aT.parseSchema}});var sT=(Bf(),li(Mf));Object.defineProperty(fr,"prettyPrintSchema",{enumerable:!0,get:function(){return sT.prettyPrintSchema}})});var TA=ah((lm,cm)=>{(function(i,e){typeof lm=="object"&&typeof cm<"u"?cm.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self).RBush=e()})(lm,function(){"use strict";function i(f,S,b,T,y){(function I(p,A,v,E,D){for(;E>v;){if(E-v>600){var G=E-v+1,U=A-v+1,M=Math.log(G),z=.5*Math.exp(2*M/3),B=.5*Math.sqrt(M*z*(G-z)/G)*(U-G/2<0?-1:1),w=Math.max(v,Math.floor(A-U*z/G+B)),P=Math.min(E,Math.floor(A+(G-U)*z/G+B));I(p,A,w,P,D)}var H=p[A],Q=v,Y=E;for(e(p,v,A),D(p[E],H)>0&&e(p,v,E);Q<Y;){for(e(p,Q,Y),Q++,Y--;D(p[Q],H)<0;)Q++;for(;D(p[Y],H)>0;)Y--}D(p[v],H)===0?e(p,v,Y):e(p,++Y,E),Y<=A&&(v=Y+1),A<=Y&&(E=Y-1)}})(f,S,b||0,T||f.length-1,y||t)}function e(f,S,b){var T=f[S];f[S]=f[b],f[b]=T}function t(f,S){return f<S?-1:f>S?1:0}var r=function(f){f===void 0&&(f=9),this._maxEntries=Math.max(4,f),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(f,S,b){if(!b)return S.indexOf(f);for(var T=0;T<S.length;T++)if(b(f,S[T]))return T;return-1}function o(f,S){a(f,0,f.children.length,S,f)}function a(f,S,b,T,y){y||(y=g(null)),y.minX=1/0,y.minY=1/0,y.maxX=-1/0,y.maxY=-1/0;for(var I=S;I<b;I++){var p=f.children[I];s(y,f.leaf?T(p):p)}return y}function s(f,S){return f.minX=Math.min(f.minX,S.minX),f.minY=Math.min(f.minY,S.minY),f.maxX=Math.max(f.maxX,S.maxX),f.maxY=Math.max(f.maxY,S.maxY),f}function l(f,S){return f.minX-S.minX}function c(f,S){return f.minY-S.minY}function d(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function h(f){return f.maxX-f.minX+(f.maxY-f.minY)}function u(f,S){return f.minX<=S.minX&&f.minY<=S.minY&&S.maxX<=f.maxX&&S.maxY<=f.maxY}function m(f,S){return S.minX<=f.maxX&&S.minY<=f.maxY&&S.maxX>=f.minX&&S.maxY>=f.minY}function g(f){return{children:f,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(f,S,b,T,y){for(var I=[S,b];I.length;)if(!((b=I.pop())-(S=I.pop())<=T)){var p=S+Math.ceil((b-S)/T/2)*T;i(f,p,S,b,y),I.push(S,p,p,b)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(f){var S=this.data,b=[];if(!m(f,S))return b;for(var T=this.toBBox,y=[];S;){for(var I=0;I<S.children.length;I++){var p=S.children[I],A=S.leaf?T(p):p;m(f,A)&&(S.leaf?b.push(p):u(f,A)?this._all(p,b):y.push(p))}S=y.pop()}return b},r.prototype.collides=function(f){var S=this.data;if(!m(f,S))return!1;for(var b=[];S;){for(var T=0;T<S.children.length;T++){var y=S.children[T],I=S.leaf?this.toBBox(y):y;if(m(f,I)){if(S.leaf||u(f,I))return!0;b.push(y)}}S=b.pop()}return!1},r.prototype.load=function(f){if(!f||!f.length)return this;if(f.length<this._minEntries){for(var S=0;S<f.length;S++)this.insert(f[S]);return this}var b=this._build(f.slice(),0,f.length-1,0);if(this.data.children.length)if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){var T=this.data;this.data=b,b=T}this._insert(b,this.data.height-b.height-1,!0)}else this.data=b;return this},r.prototype.insert=function(f){return f&&this._insert(f,this.data.height-1),this},r.prototype.clear=function(){return this.data=g([]),this},r.prototype.remove=function(f,S){if(!f)return this;for(var b,T,y,I=this.data,p=this.toBBox(f),A=[],v=[];I||A.length;){if(I||(I=A.pop(),T=A[A.length-1],b=v.pop(),y=!0),I.leaf){var E=n(f,I.children,S);if(E!==-1)return I.children.splice(E,1),A.push(I),this._condense(A),this}y||I.leaf||!u(I,p)?T?(b++,I=T.children[b],y=!1):I=null:(A.push(I),v.push(b),b=0,T=I,I=I.children[0])}return this},r.prototype.toBBox=function(f){return f},r.prototype.compareMinX=function(f,S){return f.minX-S.minX},r.prototype.compareMinY=function(f,S){return f.minY-S.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(f){return this.data=f,this},r.prototype._all=function(f,S){for(var b=[];f;)f.leaf?S.push.apply(S,f.children):b.push.apply(b,f.children),f=b.pop();return S},r.prototype._build=function(f,S,b,T){var y,I=b-S+1,p=this._maxEntries;if(I<=p)return o(y=g(f.slice(S,b+1)),this.toBBox),y;T||(T=Math.ceil(Math.log(I)/Math.log(p)),p=Math.ceil(I/Math.pow(p,T-1))),(y=g([])).leaf=!1,y.height=T;var A=Math.ceil(I/p),v=A*Math.ceil(Math.sqrt(p));_(f,S,b,v,this.compareMinX);for(var E=S;E<=b;E+=v){var D=Math.min(E+v-1,b);_(f,E,D,A,this.compareMinY);for(var G=E;G<=D;G+=A){var U=Math.min(G+A-1,D);y.children.push(this._build(f,G,U,T-1))}}return o(y,this.toBBox),y},r.prototype._chooseSubtree=function(f,S,b,T){for(;T.push(S),!S.leaf&&T.length-1!==b;){for(var y=1/0,I=1/0,p=void 0,A=0;A<S.children.length;A++){var v=S.children[A],E=d(v),D=(G=f,U=v,(Math.max(U.maxX,G.maxX)-Math.min(U.minX,G.minX))*(Math.max(U.maxY,G.maxY)-Math.min(U.minY,G.minY))-E);D<I?(I=D,y=E<y?E:y,p=v):D===I&&E<y&&(y=E,p=v)}S=p||S.children[0]}var G,U;return S},r.prototype._insert=function(f,S,b){var T=b?f:this.toBBox(f),y=[],I=this._chooseSubtree(T,this.data,S,y);for(I.children.push(f),s(I,T);S>=0&&y[S].children.length>this._maxEntries;)this._split(y,S),S--;this._adjustParentBBoxes(T,y,S)},r.prototype._split=function(f,S){var b=f[S],T=b.children.length,y=this._minEntries;this._chooseSplitAxis(b,y,T);var I=this._chooseSplitIndex(b,y,T),p=g(b.children.splice(I,b.children.length-I));p.height=b.height,p.leaf=b.leaf,o(b,this.toBBox),o(p,this.toBBox),S?f[S-1].children.push(p):this._splitRoot(b,p)},r.prototype._splitRoot=function(f,S){this.data=g([f,S]),this.data.height=f.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(f,S,b){for(var T,y,I,p,A,v,E,D=1/0,G=1/0,U=S;U<=b-S;U++){var M=a(f,0,U,this.toBBox),z=a(f,U,b,this.toBBox),B=(y=M,I=z,p=void 0,A=void 0,v=void 0,E=void 0,p=Math.max(y.minX,I.minX),A=Math.max(y.minY,I.minY),v=Math.min(y.maxX,I.maxX),E=Math.min(y.maxY,I.maxY),Math.max(0,v-p)*Math.max(0,E-A)),w=d(M)+d(z);B<D?(D=B,T=U,G=w<G?w:G):B===D&&w<G&&(G=w,T=U)}return T||b-S},r.prototype._chooseSplitAxis=function(f,S,b){var T=f.leaf?this.compareMinX:l,y=f.leaf?this.compareMinY:c;this._allDistMargin(f,S,b,T)<this._allDistMargin(f,S,b,y)&&f.children.sort(T)},r.prototype._allDistMargin=function(f,S,b,T){f.children.sort(T);for(var y=this.toBBox,I=a(f,0,S,y),p=a(f,b-S,b,y),A=h(I)+h(p),v=S;v<b-S;v++){var E=f.children[v];s(I,f.leaf?y(E):E),A+=h(I)}for(var D=b-S-1;D>=S;D--){var G=f.children[D];s(p,f.leaf?y(G):G),A+=h(p)}return A},r.prototype._adjustParentBBoxes=function(f,S,b){for(var T=b;T>=0;T--)s(S[T],f)},r.prototype._condense=function(f){for(var S=f.length-1,b=void 0;S>=0;S--)f[S].children.length===0?S>0?(b=f[S-1].children).splice(b.indexOf(f[S]),1):this.clear():o(f[S],this.toBBox)},r})});var Bb=ah((kc,xg)=>{(function(e,t){typeof kc=="object"&&typeof xg=="object"?xg.exports=t():typeof define=="function"&&define.amd?define([],t):typeof kc=="object"?kc.JsDiff=t():e.JsDiff=t()})(kc,function(){return function(i){var e={};function t(r){if(e[r])return e[r].exports;var n=e[r]={exports:{},id:r,loaded:!1};return i[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}return t.m=i,t.c=e,t.p="",t(0)}([function(i,e,t){"use strict";e.__esModule=!0,e.canonicalize=e.convertChangesToXML=e.convertChangesToDMP=e.merge=e.parsePatch=e.applyPatches=e.applyPatch=e.createPatch=e.createTwoFilesPatch=e.structuredPatch=e.diffArrays=e.diffJson=e.diffCss=e.diffSentences=e.diffTrimmedLines=e.diffLines=e.diffWordsWithSpace=e.diffWords=e.diffChars=e.Diff=void 0;var r=t(1),n=b(r),o=t(2),a=t(3),s=t(5),l=t(6),c=t(7),d=t(8),h=t(9),u=t(10),m=t(11),g=t(13),_=t(14),f=t(16),S=t(17);function b(T){return T&&T.__esModule?T:{default:T}}e.Diff=n.default,e.diffChars=o.diffChars,e.diffWords=a.diffWords,e.diffWordsWithSpace=a.diffWordsWithSpace,e.diffLines=s.diffLines,e.diffTrimmedLines=s.diffTrimmedLines,e.diffSentences=l.diffSentences,e.diffCss=c.diffCss,e.diffJson=d.diffJson,e.diffArrays=h.diffArrays,e.structuredPatch=_.structuredPatch,e.createTwoFilesPatch=_.createTwoFilesPatch,e.createPatch=_.createPatch,e.applyPatch=u.applyPatch,e.applyPatches=u.applyPatches,e.parsePatch=m.parsePatch,e.merge=g.merge,e.convertChangesToDMP=f.convertChangesToDMP,e.convertChangesToXML=S.convertChangesToXML,e.canonicalize=d.canonicalize},function(i,e){"use strict";e.__esModule=!0,e.default=t;function t(){}t.prototype={diff:function(a,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=l.callback;typeof l=="function"&&(c=l,l={}),this.options=l;var d=this;function h(y){return c?(setTimeout(function(){c(void 0,y)},0),!0):y}a=this.castInput(a),s=this.castInput(s),a=this.removeEmpty(this.tokenize(a)),s=this.removeEmpty(this.tokenize(s));var u=s.length,m=a.length,g=1,_=u+m,f=[{newPos:-1,components:[]}],S=this.extractCommon(f[0],s,a,0);if(f[0].newPos+1>=u&&S+1>=m)return h([{value:this.join(s),count:s.length}]);function b(){for(var y=-1*g;y<=g;y+=2){var I=void 0,p=f[y-1],A=f[y+1],v=(A?A.newPos:0)-y;p&&(f[y-1]=void 0);var E=p&&p.newPos+1<u,D=A&&0<=v&&v<m;if(!E&&!D){f[y]=void 0;continue}if(!E||D&&p.newPos<A.newPos?(I=n(A),d.pushComponent(I.components,void 0,!0)):(I=p,I.newPos++,d.pushComponent(I.components,!0,void 0)),v=d.extractCommon(I,s,a,y),I.newPos+1>=u&&v+1>=m)return h(r(d,I.components,s,a,d.useLongestToken));f[y]=I}g++}if(c)(function y(){setTimeout(function(){if(g>_)return c();b()||y()},0)})();else for(;g<=_;){var T=b();if(T)return T}},pushComponent:function(a,s,l){var c=a[a.length-1];c&&c.added===s&&c.removed===l?a[a.length-1]={count:c.count+1,added:s,removed:l}:a.push({count:1,added:s,removed:l})},extractCommon:function(a,s,l,c){for(var d=s.length,h=l.length,u=a.newPos,m=u-c,g=0;u+1<d&&m+1<h&&this.equals(s[u+1],l[m+1]);)u++,m++,g++;return g&&a.components.push({count:g}),a.newPos=u,m},equals:function(a,s){return this.options.comparator?this.options.comparator(a,s):a===s||this.options.ignoreCase&&a.toLowerCase()===s.toLowerCase()},removeEmpty:function(a){for(var s=[],l=0;l<a.length;l++)a[l]&&s.push(a[l]);return s},castInput:function(a){return a},tokenize:function(a){return a.split("")},join:function(a){return a.join("")}};function r(o,a,s,l,c){for(var d=0,h=a.length,u=0,m=0;d<h;d++){var g=a[d];if(g.removed){if(g.value=o.join(l.slice(m,m+g.count)),m+=g.count,d&&a[d-1].added){var f=a[d-1];a[d-1]=a[d],a[d]=f}}else{if(!g.added&&c){var _=s.slice(u,u+g.count);_=_.map(function(b,T){var y=l[m+T];return y.length>b.length?y:b}),g.value=o.join(_)}else g.value=o.join(s.slice(u,u+g.count));u+=g.count,g.added||(m+=g.count)}}var S=a[h-1];return h>1&&typeof S.value=="string"&&(S.added||S.removed)&&o.equals("",S.value)&&(a[h-2].value+=S.value,a.pop()),a}function n(o){return{newPos:o.newPos,components:o.components.slice(0)}}},function(i,e,t){"use strict";e.__esModule=!0,e.characterDiff=void 0,e.diffChars=s;var r=t(1),n=o(r);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.characterDiff=new n.default;function s(l,c,d){return a.diff(l,c,d)}},function(i,e,t){"use strict";e.__esModule=!0,e.wordDiff=void 0,e.diffWords=d,e.diffWordsWithSpace=h;var r=t(1),n=a(r),o=t(4);function a(u){return u&&u.__esModule?u:{default:u}}var s=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,c=e.wordDiff=new n.default;c.equals=function(u,m){return this.options.ignoreCase&&(u=u.toLowerCase(),m=m.toLowerCase()),u===m||this.options.ignoreWhitespace&&!l.test(u)&&!l.test(m)},c.tokenize=function(u){for(var m=u.split(/(\s+|\b)/),g=0;g<m.length-1;g++)!m[g+1]&&m[g+2]&&s.test(m[g])&&s.test(m[g+2])&&(m[g]+=m[g+2],m.splice(g+1,2),g--);return m};function d(u,m,g){return g=(0,o.generateOptions)(g,{ignoreWhitespace:!0}),c.diff(u,m,g)}function h(u,m,g){return c.diff(u,m,g)}},function(i,e){"use strict";e.__esModule=!0,e.generateOptions=t;function t(r,n){if(typeof r=="function")n.callback=r;else if(r)for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);return n}},function(i,e,t){"use strict";e.__esModule=!0,e.lineDiff=void 0,e.diffLines=l,e.diffTrimmedLines=c;var r=t(1),n=a(r),o=t(4);function a(d){return d&&d.__esModule?d:{default:d}}var s=e.lineDiff=new n.default;s.tokenize=function(d){var h=[],u=d.split(/(\n|\r\n)/);u[u.length-1]||u.pop();for(var m=0;m<u.length;m++){var g=u[m];m%2&&!this.options.newlineIsToken?h[h.length-1]+=g:(this.options.ignoreWhitespace&&(g=g.trim()),h.push(g))}return h};function l(d,h,u){return s.diff(d,h,u)}function c(d,h,u){var m=(0,o.generateOptions)(u,{ignoreWhitespace:!0});return s.diff(d,h,m)}},function(i,e,t){"use strict";e.__esModule=!0,e.sentenceDiff=void 0,e.diffSentences=s;var r=t(1),n=o(r);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.sentenceDiff=new n.default;a.tokenize=function(l){return l.split(/(\S.+?[.!?])(?=\s+|$)/)};function s(l,c,d){return a.diff(l,c,d)}},function(i,e,t){"use strict";e.__esModule=!0,e.cssDiff=void 0,e.diffCss=s;var r=t(1),n=o(r);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.cssDiff=new n.default;a.tokenize=function(l){return l.split(/([{}:;,]|\s+)/)};function s(l,c,d){return a.diff(l,c,d)}},function(i,e,t){"use strict";e.__esModule=!0,e.jsonDiff=void 0;var r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u};e.diffJson=d,e.canonicalize=h;var n=t(1),o=s(n),a=t(5);function s(u){return u&&u.__esModule?u:{default:u}}var l=Object.prototype.toString,c=e.jsonDiff=new o.default;c.useLongestToken=!0,c.tokenize=a.lineDiff.tokenize,c.castInput=function(u){var m=this.options,g=m.undefinedReplacement,_=m.stringifyReplacer,f=_===void 0?function(S,b){return typeof b>"u"?g:b}:_;return typeof u=="string"?u:JSON.stringify(h(u,null,null,f),f,"  ")},c.equals=function(u,m){return o.default.prototype.equals.call(c,u.replace(/,([\r\n])/g,"$1"),m.replace(/,([\r\n])/g,"$1"))};function d(u,m,g){return c.diff(u,m,g)}function h(u,m,g,_,f){m=m||[],g=g||[],_&&(u=_(f,u));var S=void 0;for(S=0;S<m.length;S+=1)if(m[S]===u)return g[S];var b=void 0;if(l.call(u)==="[object Array]"){for(m.push(u),b=new Array(u.length),g.push(b),S=0;S<u.length;S+=1)b[S]=h(u[S],m,g,_,f);return m.pop(),g.pop(),b}if(u&&u.toJSON&&(u=u.toJSON()),(typeof u>"u"?"undefined":r(u))==="object"&&u!==null){m.push(u),b={},g.push(b);var T=[],y=void 0;for(y in u)u.hasOwnProperty(y)&&T.push(y);for(T.sort(),S=0;S<T.length;S+=1)y=T[S],b[y]=h(u[y],m,g,_,y);m.pop(),g.pop()}else b=u;return b}},function(i,e,t){"use strict";e.__esModule=!0,e.arrayDiff=void 0,e.diffArrays=s;var r=t(1),n=o(r);function o(l){return l&&l.__esModule?l:{default:l}}var a=e.arrayDiff=new n.default;a.tokenize=function(l){return l.slice()},a.join=a.removeEmpty=function(l){return l};function s(l,c,d){return a.diff(l,c,d)}},function(i,e,t){"use strict";e.__esModule=!0,e.applyPatch=s,e.applyPatches=l;var r=t(11),n=t(12),o=a(n);function a(c){return c&&c.__esModule?c:{default:c}}function s(c,d){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof d=="string"&&(d=(0,r.parsePatch)(d)),Array.isArray(d)){if(d.length>1)throw new Error("applyPatch only works with a single input.");d=d[0]}var u=c.split(/\r\n|[\n\v\f\r\x85]/),m=c.match(/\r\n|[\n\v\f\r\x85]/g)||[],g=d.hunks,_=h.compareLine||function(j,ge,Ue,Tt){return ge===Tt},f=0,S=h.fuzzFactor||0,b=0,T=0,y=void 0,I=void 0;function p(j,ge){for(var Ue=0;Ue<j.lines.length;Ue++){var Tt=j.lines[Ue],$e=Tt.length>0?Tt[0]:" ",xt=Tt.length>0?Tt.substr(1):Tt;if($e===" "||$e==="-"){if(!_(ge+1,u[ge],$e,xt)&&(f++,f>S))return!1;ge++}}return!0}for(var A=0;A<g.length;A++){for(var v=g[A],E=u.length-v.oldLines,D=0,G=T+v.oldStart-1,U=(0,o.default)(G,b,E);D!==void 0;D=U())if(p(v,G+D)){v.offset=T+=D;break}if(D===void 0)return!1;b=v.offset+v.oldStart+v.oldLines}for(var M=0,z=0;z<g.length;z++){var B=g[z],w=B.oldStart+B.offset+M-1;M+=B.newLines-B.oldLines,w<0&&(w=0);for(var P=0;P<B.lines.length;P++){var H=B.lines[P],Q=H.length>0?H[0]:" ",Y=H.length>0?H.substr(1):H,ne=B.linedelimiters[P];if(Q===" ")w++;else if(Q==="-")u.splice(w,1),m.splice(w,1);else if(Q==="+")u.splice(w,0,Y),m.splice(w,0,ne),w++;else if(Q==="\\"){var W=B.lines[P-1]?B.lines[P-1][0]:null;W==="+"?y=!0:W==="-"&&(I=!0)}}}if(y)for(;!u[u.length-1];)u.pop(),m.pop();else I&&(u.push(""),m.push(`
`));for(var K=0;K<u.length-1;K++)u[K]=u[K]+m[K];return u.join("")}function l(c,d){typeof c=="string"&&(c=(0,r.parsePatch)(c));var h=0;function u(){var m=c[h++];if(!m)return d.complete();d.loadFile(m,function(g,_){if(g)return d.complete(g);var f=s(_,m,d);d.patched(m,f,function(S){if(S)return d.complete(S);u()})})}u()}},function(i,e){"use strict";e.__esModule=!0,e.parsePatch=t;function t(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.split(/\r\n|[\n\v\f\r\x85]/),a=r.match(/\r\n|[\n\v\f\r\x85]/g)||[],s=[],l=0;function c(){var u={};for(s.push(u);l<o.length;){var m=o[l];if(/^(\-\-\-|\+\+\+|@@)\s/.test(m))break;var g=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(m);g&&(u.index=g[1]),l++}for(d(u),d(u),u.hunks=[];l<o.length;){var _=o[l];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(_))break;if(/^@@/.test(_))u.hunks.push(h());else{if(_&&n.strict)throw new Error("Unknown line "+(l+1)+" "+JSON.stringify(_));l++}}}function d(u){var m=/^(---|\+\+\+)\s+(.*)$/.exec(o[l]);if(m){var g=m[1]==="---"?"old":"new",_=m[2].split("	",2),f=_[0].replace(/\\\\/g,"\\");/^".*"$/.test(f)&&(f=f.substr(1,f.length-2)),u[g+"FileName"]=f,u[g+"Header"]=(_[1]||"").trim(),l++}}function h(){for(var u=l,m=o[l++],g=m.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),_={oldStart:+g[1],oldLines:+g[2]||1,newStart:+g[3],newLines:+g[4]||1,lines:[],linedelimiters:[]},f=0,S=0;l<o.length&&!(o[l].indexOf("--- ")===0&&l+2<o.length&&o[l+1].indexOf("+++ ")===0&&o[l+2].indexOf("@@")===0);l++){var b=o[l].length==0&&l!=o.length-1?" ":o[l][0];if(b==="+"||b==="-"||b===" "||b==="\\")_.lines.push(o[l]),_.linedelimiters.push(a[l]||`
`),b==="+"?f++:b==="-"?S++:b===" "&&(f++,S++);else break}if(!f&&_.newLines===1&&(_.newLines=0),!S&&_.oldLines===1&&(_.oldLines=0),n.strict){if(f!==_.newLines)throw new Error("Added line count did not match for hunk at line "+(u+1));if(S!==_.oldLines)throw new Error("Removed line count did not match for hunk at line "+(u+1))}return _}for(;l<o.length;)c();return s}},function(i,e){"use strict";e.__esModule=!0,e.default=function(t,r,n){var o=!0,a=!1,s=!1,l=1;return function c(){if(o&&!s){if(a?l++:o=!1,t+l<=n)return l;s=!0}if(!a)return s||(o=!0),r<=t-l?-l++:(a=!0,c())}}},function(i,e,t){"use strict";e.__esModule=!0,e.calcLineCount=s,e.merge=l;var r=t(14),n=t(11),o=t(15);function a(E){if(Array.isArray(E)){for(var D=0,G=Array(E.length);D<E.length;D++)G[D]=E[D];return G}else return Array.from(E)}function s(E){var D=v(E.lines),G=D.oldLines,U=D.newLines;G!==void 0?E.oldLines=G:delete E.oldLines,U!==void 0?E.newLines=U:delete E.newLines}function l(E,D,G){E=c(E,G),D=c(D,G);var U={};(E.index||D.index)&&(U.index=E.index||D.index),(E.newFileName||D.newFileName)&&(d(E)?d(D)?(U.oldFileName=h(U,E.oldFileName,D.oldFileName),U.newFileName=h(U,E.newFileName,D.newFileName),U.oldHeader=h(U,E.oldHeader,D.oldHeader),U.newHeader=h(U,E.newHeader,D.newHeader)):(U.oldFileName=E.oldFileName,U.newFileName=E.newFileName,U.oldHeader=E.oldHeader,U.newHeader=E.newHeader):(U.oldFileName=D.oldFileName||E.oldFileName,U.newFileName=D.newFileName||E.newFileName,U.oldHeader=D.oldHeader||E.oldHeader,U.newHeader=D.newHeader||E.newHeader)),U.hunks=[];for(var M=0,z=0,B=0,w=0;M<E.hunks.length||z<D.hunks.length;){var P=E.hunks[M]||{oldStart:1/0},H=D.hunks[z]||{oldStart:1/0};if(u(P,H))U.hunks.push(m(P,B)),M++,w+=P.newLines-P.oldLines;else if(u(H,P))U.hunks.push(m(H,w)),z++,B+=H.newLines-H.oldLines;else{var Q={oldStart:Math.min(P.oldStart,H.oldStart),oldLines:0,newStart:Math.min(P.newStart+B,H.oldStart+w),newLines:0,lines:[]};g(Q,P.oldStart,P.lines,H.oldStart,H.lines),z++,M++,U.hunks.push(Q)}}return U}function c(E,D){if(typeof E=="string"){if(/^@@/m.test(E)||/^Index:/m.test(E))return(0,n.parsePatch)(E)[0];if(!D)throw new Error("Must provide a base reference or pass in a patch");return(0,r.structuredPatch)(void 0,void 0,D,E)}return E}function d(E){return E.newFileName&&E.newFileName!==E.oldFileName}function h(E,D,G){return D===G?D:(E.conflict=!0,{mine:D,theirs:G})}function u(E,D){return E.oldStart<D.oldStart&&E.oldStart+E.oldLines<D.oldStart}function m(E,D){return{oldStart:E.oldStart,oldLines:E.oldLines,newStart:E.newStart+D,newLines:E.newLines,lines:E.lines}}function g(E,D,G,U,M){var z={offset:D,lines:G,index:0},B={offset:U,lines:M,index:0};for(b(E,z,B),b(E,B,z);z.index<z.lines.length&&B.index<B.lines.length;){var w=z.lines[z.index],P=B.lines[B.index];if((w[0]==="-"||w[0]==="+")&&(P[0]==="-"||P[0]==="+"))_(E,z,B);else if(w[0]==="+"&&P[0]===" "){var H;(H=E.lines).push.apply(H,a(y(z)))}else if(P[0]==="+"&&w[0]===" "){var Q;(Q=E.lines).push.apply(Q,a(y(B)))}else w[0]==="-"&&P[0]===" "?f(E,z,B):P[0]==="-"&&w[0]===" "?f(E,B,z,!0):w===P?(E.lines.push(w),z.index++,B.index++):S(E,y(z),y(B))}T(E,z),T(E,B),s(E)}function _(E,D,G){var U=y(D),M=y(G);if(p(U)&&p(M)){if((0,o.arrayStartsWith)(U,M)&&A(G,U,U.length-M.length)){var z;(z=E.lines).push.apply(z,a(U));return}else if((0,o.arrayStartsWith)(M,U)&&A(D,M,M.length-U.length)){var B;(B=E.lines).push.apply(B,a(M));return}}else if((0,o.arrayEqual)(U,M)){var w;(w=E.lines).push.apply(w,a(U));return}S(E,U,M)}function f(E,D,G,U){var M=y(D),z=I(G,M);if(z.merged){var B;(B=E.lines).push.apply(B,a(z.merged))}else S(E,U?z:M,U?M:z)}function S(E,D,G){E.conflict=!0,E.lines.push({conflict:!0,mine:D,theirs:G})}function b(E,D,G){for(;D.offset<G.offset&&D.index<D.lines.length;){var U=D.lines[D.index++];E.lines.push(U),D.offset++}}function T(E,D){for(;D.index<D.lines.length;){var G=D.lines[D.index++];E.lines.push(G)}}function y(E){for(var D=[],G=E.lines[E.index][0];E.index<E.lines.length;){var U=E.lines[E.index];if(G==="-"&&U[0]==="+"&&(G="+"),G===U[0])D.push(U),E.index++;else break}return D}function I(E,D){for(var G=[],U=[],M=0,z=!1,B=!1;M<D.length&&E.index<E.lines.length;){var w=E.lines[E.index],P=D[M];if(P[0]==="+")break;if(z=z||w[0]!==" ",U.push(P),M++,w[0]==="+")for(B=!0;w[0]==="+";)G.push(w),w=E.lines[++E.index];P.substr(1)===w.substr(1)?(G.push(w),E.index++):B=!0}if((D[M]||"")[0]==="+"&&z&&(B=!0),B)return G;for(;M<D.length;)U.push(D[M++]);return{merged:U,changes:G}}function p(E){return E.reduce(function(D,G){return D&&G[0]==="-"},!0)}function A(E,D,G){for(var U=0;U<G;U++){var M=D[D.length-G+U].substr(1);if(E.lines[E.index+U]!==" "+M)return!1}return E.index+=G,!0}function v(E){var D=0,G=0;return E.forEach(function(U){if(typeof U!="string"){var M=v(U.mine),z=v(U.theirs);D!==void 0&&(M.oldLines===z.oldLines?D+=M.oldLines:D=void 0),G!==void 0&&(M.newLines===z.newLines?G+=M.newLines:G=void 0)}else G!==void 0&&(U[0]==="+"||U[0]===" ")&&G++,D!==void 0&&(U[0]==="-"||U[0]===" ")&&D++}),{oldLines:D,newLines:G}}},function(i,e,t){"use strict";e.__esModule=!0,e.structuredPatch=o,e.createTwoFilesPatch=a,e.createPatch=s;var r=t(5);function n(l){if(Array.isArray(l)){for(var c=0,d=Array(l.length);c<l.length;c++)d[c]=l[c];return d}else return Array.from(l)}function o(l,c,d,h,u,m,g){g||(g={}),typeof g.context>"u"&&(g.context=4);var _=(0,r.diffLines)(d,h,g);_.push({value:"",lines:[]});function f(E){return E.map(function(D){return" "+D})}for(var S=[],b=0,T=0,y=[],I=1,p=1,A=function(D){var G=_[D],U=G.lines||G.value.replace(/\n$/,"").split(`
`);if(G.lines=U,G.added||G.removed){var M;if(!b){var z=_[D-1];b=I,T=p,z&&(y=g.context>0?f(z.lines.slice(-g.context)):[],b-=y.length,T-=y.length)}(M=y).push.apply(M,n(U.map(function(ne){return(G.added?"+":"-")+ne}))),G.added?p+=U.length:I+=U.length}else{if(b)if(U.length<=g.context*2&&D<_.length-2){var B;(B=y).push.apply(B,n(f(U)))}else{var w,P=Math.min(U.length,g.context);(w=y).push.apply(w,n(f(U.slice(0,P))));var H={oldStart:b,oldLines:I-b+P,newStart:T,newLines:p-T+P,lines:y};if(D>=_.length-2&&U.length<=g.context){var Q=/\n$/.test(d),Y=/\n$/.test(h);U.length==0&&!Q?y.splice(H.oldLines,0,"\\ No newline at end of file"):(!Q||!Y)&&y.push("\\ No newline at end of file")}S.push(H),b=0,T=0,y=[]}I+=U.length,p+=U.length}},v=0;v<_.length;v++)A(v);return{oldFileName:l,newFileName:c,oldHeader:u,newHeader:m,hunks:S}}function a(l,c,d,h,u,m,g){var _=o(l,c,d,h,u,m,g),f=[];l==c&&f.push("Index: "+l),f.push("==================================================================="),f.push("--- "+_.oldFileName+(typeof _.oldHeader>"u"?"":"	"+_.oldHeader)),f.push("+++ "+_.newFileName+(typeof _.newHeader>"u"?"":"	"+_.newHeader));for(var S=0;S<_.hunks.length;S++){var b=_.hunks[S];f.push("@@ -"+b.oldStart+","+b.oldLines+" +"+b.newStart+","+b.newLines+" @@"),f.push.apply(f,b.lines)}return f.join(`
`)+`
`}function s(l,c,d,h,u,m){return a(l,l,c,d,h,u,m)}},function(i,e){"use strict";e.__esModule=!0,e.arrayEqual=t,e.arrayStartsWith=r;function t(n,o){return n.length!==o.length?!1:r(n,o)}function r(n,o){if(o.length>n.length)return!1;for(var a=0;a<o.length;a++)if(o[a]!==n[a])return!1;return!0}},function(i,e){"use strict";e.__esModule=!0,e.convertChangesToDMP=t;function t(r){for(var n=[],o=void 0,a=void 0,s=0;s<r.length;s++)o=r[s],o.added?a=1:o.removed?a=-1:a=0,n.push([a,o.value]);return n}},function(i,e){"use strict";e.__esModule=!0,e.convertChangesToXML=t;function t(n){for(var o=[],a=0;a<n.length;a++){var s=n[a];s.added?o.push("<ins>"):s.removed&&o.push("<del>"),o.push(r(s.value)),s.added?o.push("</ins>"):s.removed&&o.push("</del>")}return o.join("")}function r(n){var o=n;return o=o.replace(/&/g,"&amp;"),o=o.replace(/</g,"&lt;"),o=o.replace(/>/g,"&gt;"),o=o.replace(/"/g,"&quot;"),o}}])})});var ry=fs(Rl());var lr;(e=>{function i(t,r,n){return t<r?r:t>n?n:t}e.Math_clamp=i})(lr||(lr={}));var As=i=>i===(i|0);var pd;(r=>{function i(o,a){let s=0;switch(a){case 0:{for(let l of o)l<128?s=s+1:l<2048?s=s+2:l<65536?s=s+3:s=s+4;break}case 1:{for(let l of o)l<65536?s=s+1:s=s+2;break}case 2:{s=o.length;break}}return s}r.codeUnitCountForCodePoints=i;let e;(l=>(l[l.UTF8=0]="UTF8",l[l.UTF16=1]="UTF16",l[l.UTF32=2]="UTF32"))(e=r.Encoding||(r.Encoding={}));let n=class n{reset(a,s){return this.value=a,this.index=s,this.stop=a.length,this}countCodePointsUntil(a){let s=0;for(;this.index<a&&this.nextCodePoint()>=0;)s=s+1;return s}previousCodePoint(){if(this.index<=0)return-1;let a=this.value.charCodeAt(this.index=this.index-1);return(a&64512)!=56320?a:this.index<=0?-1:(this.value.charCodeAt(this.index=this.index-1)<<10)+a+(65536-56623104-56320)}nextCodePoint(){if(this.index>=this.stop)return-1;let a=this.value.charCodeAt((this.index=this.index+1)+-1);if((a&64512)!=55296)return a;if(this.index>=this.stop)return-1;let s=this.value.charCodeAt((this.index=this.index+1)+-1);return(a<<10)+s+(65536-56623104-56320)}constructor(){this.value="",this.index=0,this.stop=0}};n.INSTANCE=new n;let t=n;r.StringIterator=n})(pd||(pd={}));var fe=class{static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e.value==t.value}constructor(e){this.value=e}},Uf=1e5;function Or(i,e){if(e!=i,e.length<Uf){i.push(...e);return}for(let t of e)i.push(t)}function Gf(i,e,t){if(t!=i,t.length<Uf){i.splice(e,0,...t);return}for(let r of t)i.splice(e,0,r),e=e+1}var ce;(c=>{function i(d){d.length!=0,d.pop()}c.List_removeLast=i;function e(d){let h=0;for(let u=0,m=d.length;u<m;u=u+1){let g=!1,_=d[u];for(let f=0;f<u;f=f+1)if(_==d[f]){g=!0;break}g||(h<u&&(d[h]=d[u]),h=h+1)}for(;h<d.length;)i(d)}c.List_removeDuplicates=e;function t(d){return d.length!=0,d[d.length-1]}c.List_last=t;function r(d,h){d.indexOf(h)==-1&&d.push(h)}c.List_appendOne=r;function n(d,h){let u=d.indexOf(h);u>=0&&d.splice(u,1)}c.List_removeOne=n;function o(d,h){let u=0;for(let m=0,g=d.length;m<g;m=m+1)h(d[m])||(u<m&&(d[u]=d[m]),u=u+1);for(;u<d.length;)i(d)}c.List_removeIf=o;function a(d,h){if(d.length!=h.length)return!1;for(let u=0,m=d.length;u<m;u=u+1)if(d[u]!=h[u])return!1;return!0}c.List_equals=a;function s(d,h){let u=d.slice();return u.push(h),u}c.List_cloneAndAppend=s;function l(d,h,u){if(d==null!=(h==null))return!1;if(d==null)return!0;if(d.length==h.length){for(let m=0,g=d.length;m<g;m=m+1)if(!u(d[m],h[m]))return!1;return!0}return!1}c.List_equalsWithComparison=l})(ce||(ce={}));var He;(r=>{function i(n,o,a){let s=n.get(o);return s!==void 0?s:a}r.StringMap_get=i;function e(n,o){n.forEach((a,s)=>{o(s,a)})}r.StringMap_each=e;function t(n){let o={};return e(n,(a,s)=>{o[a]=s}),o}r.StringMap_toJSObject=t})(He||(He={}));var zt;(t=>{function i(r,n,o){let a=r.get(n);return a!==void 0?a:o}t.IntMap_get=i;function e(r,n){r.forEach((o,a)=>{n(a,o)})}t.IntMap_each=e})(zt||(zt={}));var St;(t=>{function i(r,n){return(n<r?1:0)-(n>r?1:0)}t.int_compare=i;function e(r,n){return r%n|0}t.int_remainder=e})(St||(St={}));var Xt;(r=>{function i(n,o){return(o<n?1:0)-(o>n?1:0)}r.double_compare=i;function e(n,o,a){return n*(1-a)+o*a}r.double_lerp=e;function t(n,o,a){return Math.min(Math.max(n,o),a)}r.double_clamp=t})(Xt||(Xt={}));var fo;(o=>{function i(a){let s="";for(let l of a)s+=n(l);return s}o.string_fromCodePoints=i;function e(a,s){return(s<a|0)-(s>a|0)}o.string_compare=e;function t(a){let s="";for(let l of a)s+=String.fromCharCode(l);return s}o.string_fromCodeUnits=t;function r(a){let s=[],l=pd.StringIterator.INSTANCE;for(l.reset(a,0);;){let c=l.nextCodePoint();if(c<0)return s;s.push(c)}}o.string_codePoints=r;function n(a){return a<65536?String.fromCharCode(a):String.fromCharCode((a-65536>>10)+55296)+String.fromCharCode((a-65536&1024-1)+56320)}o.string_fromCodePoint=n})(fo||(fo={}));var Nl=3;var De;(y=>{function i(I,p,A,v,E,D){y._internalTrackAnalyticsEvent=I,y._internalDefinedAnalyticsHandler=p,y._appTimerStart=A,y._appTimerStop=v,y._internalLoadTimeTracker=E,y._internalSocketConnectionTracker=D}y.initialize=i;function e(I){let p=y._internalTrackAnalyticsEvent;return y._internalTrackAnalyticsEvent=I,()=>{y._internalTrackAnalyticsEvent=p}}y.mockTrackEvent=e,y.trackDefinedEvent=(I,p)=>{y._internalDefinedAnalyticsHandler!==null&&y._internalDefinedAnalyticsHandler.trackDefinedEvent(I,p)};function r(I,p,A){y._internalTrackAnalyticsEvent!=null&&(0,y._internalTrackAnalyticsEvent)(I,p,A)}y.trackEvent=r;function n(I,p){o(I,p,void 0)}y.trackEventJSON1=n;function o(I,p,A){y._internalTrackAnalyticsEvent!=null&&(0,y._internalTrackAnalyticsEvent)(I,p,A)}y.trackEventJSON2=o;function a(I){y._appTimerStart!=null&&(0,y._appTimerStart)(I)}y.appTimerStart=a;function s(I){y._appTimerStop!=null&&(0,y._appTimerStop)(I)}y.appTimerStop=s;function l(){y._internalLoadTimeTracker!==null&&y._internalLoadTimeTracker.handleMultiplayerOpenConnection()}y.handleMultiplayerOpenConnection=l;function c(){y._internalLoadTimeTracker!==null&&y._internalLoadTimeTracker.handleMultiplayerIFLSatisfied()}y.handleMultiplayerIFLSatisfied=c;function d(){y._internalLoadTimeTracker!==null&&y._internalLoadTimeTracker.handleMultiplayerFirstResponse()}y.handleMultiplayerFirstResponse=d;function h(){y._internalLoadTimeTracker!==null&&y._internalLoadTimeTracker.handleIFLCompleted()}y.handleIFLCompleted=h;function u(I){y._internalSocketConnectionTracker!==null&&y._internalSocketConnectionTracker.handleSocketDisconnect(I)}y.handleMultiplayerSocketDisconnected=u;function m(I,p,A,v){y._internalSocketConnectionTracker!==null&&(I||p>3)&&y._internalSocketConnectionTracker.handleSocketConnectionAttempt(I,p,A,v)}y.handleMultiplayerSocketConnectionAttempt=m,y._internalTrackAnalyticsEvent=null,y._internalDefinedAnalyticsHandler=null,y._internalLoadTimeTracker=null,y._internalSocketConnectionTracker=null,y._appTimerStart=null,y._appTimerStop=null})(De||(De={}));var hd=class{constructor(e){this._context=null,this._ext=null,this._activeQuery=null,this._isRunning=!1,this._eventsPendingTimestamps=[],this._resolvedEvents=[],this._context=e,this._ext=e.getExtension("EXT_disjoint_timer_query")}start(){if(this._ext==null)throw new Error("EXT_disjoint_timer_query WebGL extension is not available. Cannot start profiler.");if(this._isRunning)throw new Error("Profiler is already running");let e=this._context.getExtension("WEBGL_debug_renderer_info");if(e!==null){let t=this._context.getParameter(e.UNMASKED_RENDERER_WEBGL);if(t.indexOf("NVIDIA GeForce GT 750M")!=-1)throw new Error(`${t} cards seem to have a buggy implementation of EXT_disjoint_timer_query. Refusing to profile to avoid confusing results.`)}this._isRunning=!0,this._eventsPendingTimestamps.length=0,this._resolvedEvents.length=0,this._activeQuery=this._ext.createQueryEXT(),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery)}stop(){if(this._ext!=null){if(!this._isRunning)throw new Error("Profiler is already stopped");this._isRunning=!1,this._activeQuery=null,this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT)}}isRunning(){return this._isRunning}_markAction(e){if(this._ext==null)return;if(this._activeQuery==null)throw new Error("Cannot mark actions while no profile is active");let t=this._activeQuery;this._activeQuery=this._ext.createQueryEXT(),this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery),this._eventsPendingTimestamps.push(new _h(e,t))}pushFrame(e){this._markAction(new md(0,e))}popFrame(e){this._markAction(new md(1,e))}resolveEventsIfPossible(){if(this._ext==null)return;let e=0;for(;e<this._eventsPendingTimestamps.length;){let t=this._eventsPendingTimestamps[e],r=t.query;if(!this._ext.getQueryObjectEXT(r,this._ext.QUERY_RESULT_AVAILABLE_EXT))break;if(this._context.getParameter(this._ext.GPU_DISJOINT_EXT))throw new Error("GPU_DISJOINT_EXT");let n=this._ext.getQueryObjectEXT(r,this._ext.QUERY_RESULT_EXT);this._ext.deleteQueryEXT(r);let a=(this._resolvedEvents.length==0?0:ce.List_last(this._resolvedEvents).timestamp)+n;this._resolvedEvents.push(new Ah(t.action,a)),e=e+1}e>0&&(this._eventsPendingTimestamps=this._eventsPendingTimestamps.slice(e))}hasPendingResults(){return this._eventsPendingTimestamps.length!=0}resolvedEvents(){return this._resolvedEvents}exportSpeedscopeProfile(){let e=[],t=[];if(this._resolvedEvents.length==0)throw new Error("Profile is empty");let r={type:"evented",name:"GPU Profile",unit:"nanoseconds",startValue:0,endValue:ce.List_last(this._resolvedEvents).timestamp,events:t},n={$schema:"https://www.speedscope.app/file-format-schema.json",shared:{frames:e},profiles:[r]},o=new Map,a=c=>(o.has(c)||(o.set(c,e.length),e.push({name:c})),o.get(c)),s="O",l="C";for(let c of this._resolvedEvents)t.push({type:c.action.type==0?s:l,frame:a(c.action.name),at:c.timestamp});return JSON.stringify(n)}};var md=class{constructor(e,t){this.type=e,this.name=t}},_h=class{constructor(e,t){this.action=e,this.query=t}},Ah=class{constructor(e,t){this.action=e,this.timestamp=t}},Ol;(n=>{function i(o,a,s){Ss?o.annotateBlock(a,s):s()}n.WebGLRenderingContext_annotateBlock=i;function e(o,a,s){return Ss?o.annotateBlock(a,s):s()}n.WebGLRenderingContext_annotateBlockAndReturn=e;function t(o,a,s){Ss?o.annotateProfile(a,s):s()}n.WebGLRenderingContext_annotateProfile=t;function r(o,a){return o.TEXTURE0+a}n.WebGLRenderingContext_TEXTURE_N=r})(Ol||(Ol={}));var Ss=!1;var rr;(o=>{function i(a){let s=[];for(let l=0,c=a.length;l<c;l=l+1)s.push(a[l]);return s}o.asList=i;function e(a,s,l){a.addEventListener(s,l)}o.on1=e;function t(a,s,l,c){a.addEventListener(s,l,c)}o.on2=t;function r(a,s,l){a.removeEventListener(s,l)}o.off=r;function n(a){a.preventDefault()}o.preventDefault=n})(rr||(rr={}));var Xn;(n=>{function i(o){try{return o.getContext("2d")}catch{}return null}n.HTMLCanvasElement_getContext2D=i;function e(o,a){let s=null;try{s=a?o.getContext("webgl2"):o.getContext("webgl")}catch{}return Ss?r(o,s):s}n.HTMLCanvasElement_getContextWebGL1=e;function t(o,a,s){let l=null;try{l=s?o.getContext("webgl2",a):o.getContext("webgl",a)}catch{}return Ss?r(o,l):l}n.HTMLCanvasElement_getContextWebGL2=t;function r(o,a){console.log("WebGL intercepts are enabled. This records all calls.");let s=window.requestAnimationFrame,l=0,c=new hd(a);window.requestAnimationFrame=()=>(l=l+1,c.hasPendingResults()&&c.resolveEventsIfPossible(),s.apply(window,arguments));let d=o,h=a,u=d.width,m=d.height,g=l,_=[],f={},S="  ",b=M=>{_.push(S+M)},T=()=>{l!=g&&(g=l,b("yield;"))},y=(M,z)=>{T(),b(`{ // ${M}`);let B=S;S+="  ",c.isRunning()&&c.pushFrame(M);let w=z();return c.isRunning()&&c.popFrame(M),S=B,b("}"),w},I=(M,z)=>{c.isRunning()&&c.pushFrame(M),z(),c.isRunning()&&c.popFrame(M)},p=()=>{let M=`function* render(gl) {

`;M+=`  // Recorded using https://github.com/evanw/webgl-recorder
`;for(let z in f)M+="  var "+z+`s = [];
`;for(let z of _)M+=z+`
`;return M+=`}
`,M},A=(M,z)=>{let B=document.createElement("a");B.href=URL.createObjectURL(new Blob([M],{type:"application/javascript"})),B.download=z??"trace.js",document.body.appendChild(B),B.click(),document.body.removeChild(B)},v=M=>{A(p(),M??"trace.js")},E=()=>{c.start()},D=M=>{c.stop();let z=()=>{c.hasPendingResults()?s(z):A(c.exportSpeedscopeProfile(),`viewer-${+new Date}.speedscope.json`)};z()},G=M=>{if(M instanceof WebGLActiveInfo||M instanceof WebGLBuffer||M instanceof WebGLFramebuffer||M instanceof WebGLProgram||M instanceof WebGLRenderbuffer||M instanceof WebGLShader||M instanceof WebGLShaderPrecisionFormat||M instanceof WebGLTexture||M instanceof WebGLUniformLocation){let z=M.constructor.name,B=z in f?f[z]:f[z]=[],w=B.indexOf(M);return w==-1&&(w=B.length,B.push(M)),z+"s["+w+"]"}return null},U={traceLines:_,compileTrace:p,downloadTrace:v,startProfile:E,stopProfile:D,annotateBlock:y,annotateProfile:I};b(`gl.canvas.width = ${u};`),b(`gl.canvas.height = ${m};`);for(let M in h){let z=h[M];if(typeof z=="function"){let B=((w,P)=>()=>{let H=[];T(),(d.width!=u||d.height!=m)&&(u=d.width,m=d.height,b(`gl.canvas.width = ${u};`),b(`gl.canvas.height = ${m};`));for(let W=0,K=arguments.length;W<K;W=W+1){let j=arguments[W];if(typeof j=="number"||typeof j=="boolean"||typeof j=="string"||Array.isArray(j)||j===null)H.push(JSON.stringify(j));else if(ArrayBuffer.isView(j))H.push(`new ${j.constructor.name}([${Array.prototype.slice.call(j)}])`);else{let ge=G(j);ge!=null?H.push(ge):(console.warn("unsupported value:",j),H.push("null"))}}let Q=`gl.${w}(`;for(let W=0,K=H.length;W<K;W=W+1)W!=0&&(Q+=", "),Q+=H[W];Q+=");",c.isRunning()&&w.startsWith("draw")&&c.pushFrame(Q);let Y=P.apply(h,arguments);c.isRunning()&&w.startsWith("draw")&&c.popFrame(Q);let ne=G(Y);return ne!=null&&(Q=ne+" = "+Q),b(Q),Y})(M,z);U[M]=B}else(B=>{Object.defineProperty(U,B,{set:w=>{h[B]=w},get:()=>h[B]})})(M)}return window.recordingContext=U,U}n.HTMLCanvasElement_makeRecordableContext=r})(Xn||(Xn={}));var gd;(t=>{function i(r){return r.result}t.FileReader_resultAsArrayBuffer=i;function e(r){return r.result}t.FileReader_resultAsString=e})(gd||(gd={}));var Pa;(e=>{function i(t){return t&&t.now?t.now():+new Date}e.Performance_now=i})(Pa||(Pa={}));var Jt;(I=>{function i(p,A,v){rr.on1(p,A,v)}I.EventTarget_addEventListener1=i;function e(p,A,v){rr.on1(p,A,v)}I.EventTarget_addEventListener2=e;function t(p,A,v){rr.on1(p,A,v)}I.EventTarget_addEventListener3=t;function r(p,A,v){rr.on1(p,A,v)}I.EventTarget_addEventListener4=r;function n(p,A,v){rr.on1(p,A,v)}I.EventTarget_addEventListener5=n;function o(p,A,v){rr.on1(p,A,v)}I.EventTarget_addEventListener6=o;function a(p,A,v){rr.on1(p,A,v)}I.EventTarget_addEventListener7=a;function s(p,A,v,E){rr.on2(p,A,v,E)}I.EventTarget_addEventListener8=s;function l(p,A,v,E){rr.on2(p,A,v,E)}I.EventTarget_addEventListener9=l;function c(p,A,v,E){rr.on2(p,A,v,E)}I.EventTarget_addEventListener10=c;function d(p,A,v,E){rr.on2(p,A,v,E)}I.EventTarget_addEventListener11=d;function h(p,A,v,E){rr.on2(p,A,v,E)}I.EventTarget_addEventListener12=h;function u(p,A,v,E){rr.on2(p,A,v,E)}I.EventTarget_addEventListener13=u;function m(p,A,v,E){rr.on2(p,A,v,E)}I.EventTarget_addEventListener14=m;function g(p,A,v){rr.off(p,A,v)}I.EventTarget_removeEventListener1=g;function _(p,A,v){rr.off(p,A,v)}I.EventTarget_removeEventListener2=_;function f(p,A,v){rr.off(p,A,v)}I.EventTarget_removeEventListener3=f;function S(p,A,v){rr.off(p,A,v)}I.EventTarget_removeEventListener4=S;function b(p,A,v){rr.off(p,A,v)}I.EventTarget_removeEventListener5=b;function T(p,A,v){rr.off(p,A,v)}I.EventTarget_removeEventListener6=T;function y(p,A,v){rr.off(p,A,v)}I.EventTarget_removeEventListener7=y})(Jt||(Jt={}));var Bn;(n=>{function i(o){return new Image}n.HTMLDocument_createElementImage=i;function e(o){return o.createElement("canvas")}n.HTMLDocument_createElementCanvas=e;function t(o,a){return rr.asList(o.querySelectorAll(a))}n.HTMLDocument_querySelectorAll=t;function r(o,a){return rr.asList(o.getElementsByClassName(a))}n.HTMLDocument_getElementsByClassName=r})(Bn||(Bn={}));var xo;(e=>{function i(t){rr.preventDefault(t)}e.Event_preventDefault=i})(xo||(xo={}));var fd;(t=>{function i(r){return rr.asList(r.types)}t.DataTransfer_types=i;function e(r){return rr.asList(r.files)}t.DataTransfer_files=e})(fd||(fd={}));var Hf;(e=>{function i(t){if(typeof t.buttons>"u"){let r=t.which;return r<2?r:r==3?2:4}return t.buttons}e.MouseEvent_buttons=i})(Hf||(Hf={}));var _d;(r=>{function i(n){return rr.asList(n.touches)}r.TouchEvent_touches=i;function e(n){return rr.asList(n.targetTouches)}r.TouchEvent_targetTouches=e;function t(n){return rr.asList(n.changedTouches)}r.TouchEvent_changedTouches=t})(_d||(_d={}));function _o(){return self}var cr;(p=>{function i(){return p._workerURL}p.getWorkerURL=i;function e(A){p._workerURL=A}p.setWorkerURL=e;function t(){return p._imagePrefixURL}p.getImagePrefixURL=t;function r(A){p._imagePrefixURL=A}p.setImagePrefixURL=r;function n(){return p._imageBatchURL}p.getImageBatchURL=n;function o(A){p._imageBatchURL=A}p.setImageBatchURL=o;function a(){return p._videoPrefixURL}p.getVideoPrefixUrl=a;function s(A){p._videoPrefixURL=A}p.setVideoPrefixUrl=s;function l(){return p._deviceInfoByIdentifier}p.getDeviceInfoByIdentifier=l;function c(A){p._deviceInfoByIdentifier=A}p.setDeviceInfoByIdentifier=c;function d(){return p._containerElement}p.getContainerElement=d;function h(A){p._containerElement=A}p.setContainerElement=h;function u(){return p._forceMobileOptimizations}p.forceMobileOptimizations=u;function m(A){let v=D=>{if(!(D in A))throw new Error(`Missing required parameter '${D}'`);return A[D]},E=(D,G)=>D in A?A[D]:G;p._workerURL=v("workerURL"),p._deviceInfoByIdentifier=E("deviceInfoByIdentifier",p._deviceInfoByIdentifierDefault),p._containerElement=v("containerElement"),p._forceMobileOptimizations=E("forceMobileOptimizations",!1)}p.initialize=m,p._workerURL=null,p._imagePrefixURL=null,p._imageBatchURL=null,p._videoPrefixURL=null,p._deviceInfoByIdentifierDefault=null,p._deviceInfoByIdentifier=p._deviceInfoByIdentifierDefault,p._containerElement=null,p._forceMobileOptimizations=!1})(cr||(cr={}));var Gt;(f=>{let i;function e(S){i=S}f.initialize=e;function t(){return i!=null&&i.mac==!0}f.mac=t;function r(){return i!=null&&i.windows==!0}f.windows=r;function n(){return i!=null&&i.ios==!0}f.ios=n;function o(){return i!=null&&i.android==!0}f.android=o;function a(){return i!=null&&i.linux==!0}f.linux=a;function s(){return i!=null&&i.chrome==!0}f.chrome=s;function l(){return i!=null&&i.safari==!0}f.safari=l;function c(){return i!=null&&i.firefox==!0}f.firefox=c;function d(){return i!=null&&i.msedge==!0}f.edge=d;function h(){return i!=null&&i.msie==!0}f.msie=h;function u(S){return S==2||S==1}f.isMobile=u;function m(){return f.isMobile(f.current())||f.current()==4&&navigator.maxTouchPoints>0}f.isCurrentOSMobileOrIPad=m;function g(){return f.OS__current==0&&(f.OS__current=t()?4:r()?5:n()?2:o()?1:a()?3:0),f.OS__current}f.current=g,f.OS__current=0})(Gt||(Gt={}));function Le(i){let e=typeof i=="string"?new Error(i):i;setTimeout(()=>{throw e},0)}function lT(i){let e=new Error(i);setTimeout(()=>{throw e},0)}function zf(i){lT(i)}var di=null,Vn=!1,Po=!1,Oi=!1;function Wf(){Po=!0}function Fo(){return Vn||Oi}var bs=!0;var wl=null,Sh=null;function Ad(i){if(wl!=null){Le("Attempt to initialize PrototypeLib, but PrototypeLib is already initialized");return}Qf(i),Sh.setSerialization(i.appState().serialization()),Oi&&i.modules().interactionTestHelpers.setIsRunningViewerRenderServer()}function L(){return wl}function Qf(i){wl=i}function Sd(){wl!=null&&wl.reset(),Qf(null)}function Kf(i){Sh=i}function bd(){return Sh}var X;(ve=>{function i(){return M().use_int_boundaries_for_scissor}ve.useIntBoundariesForScissor=i;function e(){return M().optimization_exposure_logging}ve.optimizationExposureLogging=e;function t(){return M().viewer_skip_not_dirty_tree_opt}ve.viewerSkipNotDirtyTreeOpt=t;function r(){return M().rounded_mask_optimization}ve.roundedMaskOptimization=r;function n(){return M().static_render_tree_animations}ve.useStaticRenderTreeIfNonAnimatingSubtree=n;function o(){return M().viewer_ctg_equal_within_bounds}ve.compositeTileGridEqualWithinBounds=o;function a(){return!kt()}ve.smartAnimateCacheTransform=a;function s(){return M().viewer_bblur_bounds_opt||f()}ve.backgroundBlurBoundsOpt=s;function l(){return!kt()&&M().viewer_ic_cache_opt}ve.viewerICCacheOpt=l;function c(){return!kt()&&M().create_video_triggers_opt}ve.viewerCreateVideoTriggersOpt=c;function d(){return!kt()&&M().viewer_large_tiles_drawtoscreen}ve.viewerLargeTilesDrawToScreen=d;function h(){return M().enable_intra_tile_interrupts}ve.enableIntraTileInterrupts=h;function u(){return M().viewer_tile_list_culling}ve.cullTreesDuringTilePrioritization=u;function m(){return M().prototype_ifl_time_slice}ve.prototypeIFLTimeSlice=m;function g(){return d()||M().viewer_scissor_clear}ve.viewerScissorClear=g;function _(){return!kt()&&M().viewer_createimagebitmap}ve.enableCreateImageBitmap=_;function f(){return M().viewer_background_blur_opts}ve.useBackgroundBlurOpts=f;function S(){return M().viewer_fast_stroke_shadow}ve.useFastStrokeShadow=S;function b(){return M().viewer_flush_after_clear}ve.shouldFlushAfterClear=b;function T(){return M().viewer_flush_after_stencil_cover}ve.shouldFlushAfterStencilCover=T;function y(){return M().flush_after_draws}ve.shouldFlushAfterDraws=y;function I(){return kt()}ve.shouldPreventVolatileCaching=I;function p(){return M().use_glslx_replacement_viewer}ve.shouldUseGLSLXReplacement=p;function A(){return M().use_webgl2_viewer}ve.shouldUseWebGL2=A;function v(){return window.devicePixelRatio>3}ve.isHighDPR=v;function E(){return M().internal_only_debug_tools}ve.internalDebugTools=E;function D(){return!v()}ve.useSSAA=D;function G(Ke){return ve._bowser.version===null||ve._bowser.version===void 0?!1:ve._bowser.compareVersions([ve._bowser.version,Ke])>=0}ve.isBrowserVersionAtLeast=G;function U(Ke){return ve._bowser.osversion===null||ve._bowser.osversion===void 0?!1:ve._bowser.compareVersions([ve._bowser.osversion,Ke])>=0}ve.isOSVersionAtLeast=U;function M(){return ve._featureFlags}ve.getFeatureFlags=M;function z(Ke){var ht,oe;ve._featureFlags=Ke,Vn?di.featureFlagsCppApi.updateFeatureFlags(Ke):((oe=(ht=L())==null?void 0:ht.modules())==null?void 0:oe.featureFlagsCppApi)!=null&&L().modules().featureFlagsCppApi.updateFeatureFlags(Ke)}ve.setFeatureFlags=z;function B(Ke){let ht=Object.assign({},ve._featureFlags);z(Object.assign(ht,Ke))}ve.updateFeatureFlags=B;function w(){return ve._viewerMode}ve.getViewerMode=w;function P(Ke){ve._viewerMode=Ke}ve.setViewerMode=P;function H(){return ve._scrollToPan}ve.getScrollToPan=H;function Q(Ke){ve._scrollToPan=Ke}ve.setScrollToPan=Q;function Y(){return ve._dragToPan}ve.getDragToPan=Y;function ne(Ke){ve._dragToPan=Ke}ve.setDragToPan=ne;function W(){return ve._disableKeyboardHandling}ve.disableKeyboardHandling=W;function K(){return ve._gameControllerListener}ve.gameControllerListener=K;function j(){return ve._isInlinePreview}ve.isInlinePreview=j;function ge(Ke){ve.protoUseFrameEvictionForUnitTests=Ke}ve.setProtoUseFrameEvictionForUnitTests=ge;function Ue(){return 2==0?ve.protoUseFrameEvictionForUnitTests:kt()}ve.protoUseFrameEviction=Ue;function Tt(Ke){let ht=le=>{if(!(le in Ke))throw new Error(`Missing required parameter '${le}'`);return Ke[le]},oe=(le,x)=>le in Ke?Ke[le]:x,_e=ht("featureFlags");z(_e),ve._viewerMode=Me.ViewerMode_create(ht("viewerMode")),De.initialize(oe("trackAnalyticsEvent",null),oe("definedAnalyticsHandler",null),oe("appTimerStart",null),oe("appTimerStop",null),oe("loadTimeTracker",null),oe("socketConnectionTracker",null)),ve._bowser=ht("bowser"),Gt.initialize(ve._bowser),ve._scrollToPan=oe("scrollToPan",ve._scrollToPanDefault),ve._disablePrototypeDeviceFrames=oe("disablePrototypeDeviceFrames",ve._disablePrototypeDeviceFramesDefault),ve._disableKeyboardHandling=oe("disableKeyboardHandling",ve._disableKeyboardHandlingDefault),ve._gameControllerListener=oe("gameControllerListener",null),ve._isInlinePreview=oe("isInlinePreview",!1)}ve.initialize=Tt;function $e(){return!ve._disablePrototypeDeviceFrames&&ve._viewerMode==1}ve.deviceFramesSupported=$e;function xt(Ke){ve.prototypeBackgroundColorOverride=Ke}ve.setPrototypeBackgroundColorOverride=xt;function Vt(){if(ve._htmlImageDecodeMethodIsPresent==null){let Ke=Bn.HTMLDocument_createElementImage(document),ht=Ke.decode!==null&&Ke.decode!==void 0;ve._htmlImageDecodeMethodIsPresent=new fe(ht)}return ve._htmlImageDecodeMethodIsPresent.value}ve.htmlImageDecodeMethodIsPresent=Vt;function kt(){return Gt.isMobile(Gt.current())||Gt.current()==4&&navigator.maxTouchPoints>0||cr.forceMobileOptimizations()}ve.shouldApplyMobileOptimizations=kt;let pe;(oe=>(oe[oe.MIRROR=0]="MIRROR",oe[oe.PROTOTYPE=1]="PROTOTYPE"))(pe=ve.ViewerMode||(ve.ViewerMode={}));let Me;(ht=>{function Ke(oe){if(typeof oe=="string")switch(oe){case"MIRROR":return 0;case"PROTOTYPE":return 1}throw new Error(`Invalid viewer mode: ${oe}`)}ht.ViewerMode_create=Ke})(Me=ve.in_ViewerMode||(ve.in_ViewerMode={})),ve._bowser=null,ve._featureFlags={},ve._viewerMode=1,ve._scrollToPanDefault=!0,ve._scrollToPan=ve._scrollToPanDefault,ve._dragToPanDefault=!0,ve._dragToPan=ve._dragToPanDefault,ve._disablePrototypeDeviceFramesDefault=!1,ve._disablePrototypeDeviceFrames=ve._disablePrototypeDeviceFramesDefault,ve._disableKeyboardHandlingDefault=!1,ve._disableKeyboardHandling=ve._disableKeyboardHandlingDefault,ve._gameControllerListener=null,ve._isInlinePreview=!1,ve.protoUseFrameEvictionForUnitTests=!1,ve.prototypeBackgroundColorOverride=null,ve._htmlImageDecodeMethodIsPresent=null,ve.forceInitiateStateChangeForTests=!1})(X||(X={}));var Cr;(a=>{function i(s,l){if(n.set(s,l),!o.has(s))o.set(s,n.get(s));else{let c=o.get(s);o.set(s,Math.max(c,l))}}a.trackNumber=i;function e(s,l){if(n.has(s)?n.set(s,n.get(s)+l):n.set(s,l),!o.has(s))o.set(s,n.get(s));else{let c=o.get(s);o.set(s,Math.max(c,n.get(s)))}return n.get(s)}a.increment=e;function t(s){return o.has(s)?o.get(s):0}a.getMax=t;function r(){let s=window.performance.memory;s&&s.jsHeapSizeLimit&&s.usedJSHeapSize&&(i("JS Heap size (MB)",s.jsHeapSizeLimit/(1024*1024)|0),i("Used Heap size (MB)",s.usedJSHeapSize/(1024*1024)|0));let l={};for(let c of Array.from(n.keys())){let d=n.get(c);l[c]=Math.round(d*100)/100}return l}a.getStatsForDebugging=r;let n=new Map,o=new Map})(Cr||(Cr={}));function cT(){let i=new Map,e=window.location.search;if(e.length==0)return i;e=e.slice(1);for(let t of e.split("&")){let r=t.split("=");r.length==2&&i.set(r[0],r[1])}return i}function Jn(){if(!qf){qf=!0;let i=cT(),e=He.StringMap_get(i,"force-dpr",null);if(e!=null){let t=+parseFloat(e);isNaN(t)||(bh=new fe(lr.Math_clamp(t,.1,4)))}}return bh!=null?bh.value:window.devicePixelRatio}var qf=!1,bh=null;var wr=class i{constructor(){X.shouldUseGLSLXReplacement()&&!X.shouldUseWebGL2()?(this.GLSLX_NAME_U_SHAPE_TYPE="uShapeType",this.GLSLX_NAME_U_ELLIPSE_CENTER="uEllipseCenter",this.GLSLX_NAME_U_ELLIPSE_RADII="uEllipseRadii",this.GLSLX_NAME_U_RECT="uRect",this.GLSLX_NAME_U_CORNER_RADII="uCornerRadii",this.GLSLX_NAME_U_TYPE="uType",this.GLSLX_NAME_U_OPACITY="uOpacity",this.GLSLX_NAME_U_TEXTURE0="uTexture0",this.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);gl_FragColor = ditherColor(texture2D(uTexture0, coord) * uOpacity) * coverageAlpha;}`,this.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS="uEmulateWrapAddress",this.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS="uEmulateBorderAddress",this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb *= color.a;gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_GLOBAL_TINT="uGlobalTint",this.GLSLX_NAME_U_GLOBAL_COLOR="uGlobalColor",this.GLSLX_NAME_U_GLOBAL_SHADOWS="uGlobalShadows",this.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS="uGlobalHighlights",this.GLSLX_NAME_U_GLOBAL_EXPOSURE="uGlobalExposure",this.GLSLX_NAME_U_GLOBAL_TEMPERATURE="uGlobalTemperature",this.GLSLX_NAME_U_GLOBAL_CONTRAST="uGlobalContrast",this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;varying vec2 vNodeSpacePoint;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_PROGRESS="uProgress",this.GLSLX_NAME_U_TEXTURE1="uTexture1",this.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped = mix(texture2D(uTexture0, coord), texture2D(uTexture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}uniform sampler2D uTexture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) / 8.;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;varying vec2 vPaintASample;varying vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}uniform sampler2D uTexture1;varying vec2 vPaintBSample;varying vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) / 8.;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;varying vec2 vNodeSpacePoint;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_UV_SCALE="uUvScale",this.GLSLX_NAME_U_PATH_SIZE="uPathSize",this.GLSLX_NAME_U_PIXEL_RATIO="uPixelRatio",this.GLSLX_NAME_U_PAINT_TRANSFORM0="uPaintTransform0",this.GLSLX_NAME_U_VERTEX_TRANSFORM="uVertexTransform",this.GLSLX_NAME_A_POSITION2="aPosition2",this.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample, out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA = (uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintASample;}uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;varying vec2 vPaintASample;varying vec2 vStepA;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_NAME_U_COLOR="uColor",this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;varying vec2 vNodeSpacePoint;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);gl_FragColor = uColor * uOpacity * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_NAME_U_PAINT_TRANSFORM1="uPaintTransform1",this.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample, out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA = (uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintASample;}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vPaintASample;varying vec2 vStepA;varying vec2 vPaintBSample;varying vec2 vStepB;varying vec2 vNodeSpacePoint;varying vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB = (uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_BLEND_MODE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;float minv3(vec3 c) {return min(min(c.r, c.g), c.b);}float maxv3(vec3 c) {return max(max(c.r, c.g), c.b);}float satv3(vec3 c) {return maxv3(c) - minv3(c);}float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}void main() {const int DARKEN       = 2;const int MULTIPLY     = 3;const int LINEAR_BURN  = 4;const int COLOR_BURN   = 5;const int LIGHTEN      = 6;const int SCREEN       = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE  = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture2D(uTexture0, vCoord2) * uOpacity;vec4 target = texture2D(uTexture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {gl_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca,Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0) Sc /= Sa;if (Da > 0.0) Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}gl_FragColor = vec4(color, Sa + Da - Sa * Da);}}",this.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(uTexture0, vCoord2) * uOpacity;}",this.GLSLX_NAME_U_COUNT="uCount",this.GLSLX_NAME_U_BLUR_DELTA="uBlurDelta",this.GLSLX_NAME_U_BLUR_CLAMP="uBlurClamp",this.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture2D(uTexture0, coord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg = (uCount - t0) * float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos = (uCount - t0) * float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg = (uCount - t1) * float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos = (uCount - t1) * float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result +=texture2D(uTexture0, coord_neg) * weight_neg +texture2D(uTexture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}gl_FragColor = result / total;}",this.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX="precision highp float;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}",this.GLSLX_NAME_U_QUAD="uQuad",this.GLSLX_SOURCE_COPY_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;void main() {gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1);}",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(uTexture0, vCoord2);}",this.GLSLX_NAME_U_SOURCE="uSource",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}",this.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT="uUvSpaceClampingRect",this.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT="uUvSpaceSourceRect",this.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D uTexture0;varying vec2 vCoord2;const bool drawDebugStuff = false;void main() {vec2 sampleCoordinates = clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);gl_FragColor = texture2D(uTexture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) / (uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) - 0.5);float t = max(tt.x, tt.y);if (t > 0.99) {gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}",this.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM="uToClipSpaceTransform",this.GLSLX_NAME_U_DESTINATION_RECT="uDestinationRect",this.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX="precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform * vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0,1);}",this.GLSLX_SOURCE_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);gl_FragColor = ditherColor(texture2D(uTexture0, coord) * uOpacity);}",this.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = float(texture2D(uTexture0, vCoord2).a > 0.0) * uColor;}",this.GLSLX_NAME_U_TEXTURE_SIZE="uTextureSize",this.GLSLX_NAME_U_TEXTURE_PX="uTexturePx",this.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture2D(uTexture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture2D(uTexture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture2D(uTexture0, upperLeftTexelCoord).a;float upperRightAlpha = texture2D(uTexture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha =(hardMaskedLowerLeftAlpha * leftWeight + hardMaskedLowerRightAlpha * rightWeight) * bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight + hardMaskedUpperRightAlpha * rightWeight) * topWeight;gl_FragColor = downsampledHardMaskedAlpha * uColor;}",this.GLSLX_SOURCE_IMAGE_FRAGMENT="precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(uTexture0, vCoord2);color.rgb *= color.a;gl_FragColor = color * uOpacity;}",this.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {vec4 color = sampleImage(uTexture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;gl_FragColor = color * uOpacity;}",this.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT="precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped = mix(texture2D(uTexture0, coord), texture2D(uTexture1, coord), uProgress);gl_FragColor = ditherColor(lerped * uOpacity);}",this.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT="precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(uTexture0, vCoord2), sampleImage(uTexture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;gl_FragColor = lerped * uOpacity;}",this.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture2D(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vec4 lerped = mix(sampleImage(uTexture0, vCoord2), sampleImage(uTexture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;gl_FragColor = lerped * uOpacity;}",this.GLSLX_NAME_U_TEXTURE0_UV_SPACE_SCISSOR="uTexture0UvSpaceScissor",this.GLSLX_NAME_U_TEXTURE1_UV_SPACE_SCISSOR="uTexture1UvSpaceScissor",this.GLSLX_SOURCE_LERP_TILE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uTexture0UvSpaceScissor;uniform vec4 uTexture1UvSpaceScissor;varying vec2 vCoord2;void main() {vec4 texture0Color =all(greaterThan(vCoord2, uTexture0UvSpaceScissor.xy)) && all(lessThan(vCoord2, uTexture0UvSpaceScissor.zw)) ?texture2D(uTexture0, vCoord2) :vec4(0.0);vec4 texture1Color =all(greaterThan(vCoord2, uTexture1UvSpaceScissor.xy)) && all(lessThan(vCoord2, uTexture1UvSpaceScissor.zw)) ?texture2D(uTexture1, vCoord2) :vec4(0.0);gl_FragColor = mix(texture0Color, texture1Color, uOpacity);}",this.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT="precision highp float;varying vec3 vCoord3;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}",this.GLSLX_NAME_A_COORD3="aCoord3",this.GLSLX_SOURCE_LOOP_BLINN_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;attribute vec3 aCoord3;varying vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {if (texture2D(uTexture1, vCoord2).a == 0.0) {discard;}gl_FragColor = texture2D(uTexture0, vCoord2);}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {gl_FragColor = (1.0 - texture2D(uTexture0, vCoord2).a) * texture2D(uTexture1, vCoord2).a * uColor;}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uColor;varying vec2 vCoord2;void main() {float texture1HardMasked = float(texture2D(uTexture1, vCoord2).a > 0.0);gl_FragColor = (1.0 - texture2D(uTexture0, vCoord2).a) * texture1HardMasked * uColor;}",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(uTexture0, vCoord2) * float(texture2D(uTexture1, vCoord2).a == 0.);}",this.GLSLX_NAME_U_MASK_TEXTURE="uMaskTexture",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform sampler2D uMaskTexture;varying vec2 vCoord2;void main() {float geometryAlpha = texture2D(uMaskTexture, vCoord2).a;gl_FragColor = mix(texture2D(uTexture1, vCoord2),texture2D(uTexture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}",this.GLSLX_SOURCE_MASK_TILE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {gl_FragColor = texture2D(uTexture0, vCoord2) * texture2D(uTexture1, vCoord2).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {vec3 rgb = texture2D(uTexture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor = texture2D(uTexture0, vCoord2) * luminance * texture2D(uTexture1, vCoord2).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D uMaskTexture;uniform sampler2D uTexture0;uniform sampler2D uTexture1;varying vec2 vCoord2;void main() {vec3 rgb = texture2D(uMaskTexture, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);gl_FragColor = mix(texture2D(uTexture1, vCoord2),texture2D(uTexture0, vCoord2),texture2D(uMaskTexture, vCoord2).a * luminance);}",this.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform sampler2D uMaskTexture;varying vec2 vCoord2;void main() {gl_FragColor = mix(texture2D(uTexture1, vCoord2), texture2D(uTexture0, vCoord2), texture2D(uMaskTexture, vCoord2).a);}",this.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) return 0.0;else if (x < 0.0) return 0.5 * (x + 1.0) * (x + 1.0);else if (x < 1.0) return 0.5 - 0.5 * x * (x - 2.0);else return 1.0;}uniform vec4 uColor;varying vec4 vCoord4;void main() {float alpha = (integrateTriangle(vCoord4.x) - integrateTriangle(vCoord4.z)) * (integrateTriangle(vCoord4.y) - integrateTriangle(vCoord4.w));gl_FragColor = ditherColor(uColor * alpha);}",this.GLSLX_NAME_U_BLUR_RADIUS="uBlurRadius",this.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;attribute vec2 aPosition2;varying vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT="precision highp float;uniform sampler2D uTexture0;varying vec4 vPosition4;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;gl_FragColor = texture2D(uTexture0, uv);}",this.GLSLX_NAME_A_POSITION4="aPosition4",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.GLSLX_NAME_U_HOTSPOT_OPACITY="uHotspotOpacity",this.GLSLX_NAME_U_STROKE_PROPORTION="uStrokeProportion",this.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT="uUvHotspotClippingRect",this.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT="precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;varying vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 &&rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {gl_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {gl_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {gl_FragColor = vec4(0.0);}}",this.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aPosition4;varying vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}",this.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS="uHalfSizeOverBlurRadius",this.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS="uCornerRadiusOverBlurRadius",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) return 0.0;else if (x < 0.0) return 0.5 * (x + 1.0) * (x + 1.0);else if (x < 1.0) return 0.5 - 0.5 * x * (x - 2.0);else return 1.0;}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;varying vec2 vCoord2;float triangle(float x) {return max(0.0, (1.0 - abs(x)));}float roundedRectangleBlurHorizontal(float x, float y, float cornerRadius, vec2 halfSize) {float deltaY = min(halfSize.y - cornerRadius - abs(y), 0.0);float roundedRectX = halfSize.x - cornerRadius + sqrt(max(0.0, cornerRadius * cornerRadius - deltaY * deltaY));vec2 xRelativeToLowerAndUpper = vec2(x + roundedRectX, x - roundedRectX);return integrateTriangle(xRelativeToLowerAndUpper.x) - integrateTriangle(xRelativeToLowerAndUpper.y);}void main() {float alpha;if (all(lessThan(abs(vCoord2), uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius + 1.0 )))) {alpha = 1.0;} else {float low = vCoord2.y - uHalfSizeOverBlurRadius.y;float high = vCoord2.y + uHalfSizeOverBlurRadius.y;float start = clamp(-1.0 , low, high);float end = clamp(1.0 , low, high);if (start == end) {alpha = 0.0;} else {const int numSamples = 4;float step = (end - start) / float(numSamples);float y = start + step * 0.5;float weightSum = 0.0;float result = 0.0;for (int i = 0; i < numSamples; i++) {float currentWeight = triangle(y);result +=roundedRectangleBlurHorizontal(vCoord2.x, vCoord2.y - y, uCornerRadiusOverBlurRadius, uHalfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor = (integrateTriangle(end) - integrateTriangle(start)) / weightSum;alpha = result * weightNormalizationFactor;}}gl_FragColor = ditherColor(uColor * alpha);}",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX="precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}",this.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT="precision highp float;varying vec2 vCoord2;varying vec4 vCoord4;void main() {gl_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y));}",this.GLSLX_NAME_A_COORD4="aCoord4",this.GLSLX_SOURCE_SMOOTH_PATH_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec4 aCoord4;attribute vec4 aPosition4;varying vec2 vCoord2;varying vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT="precision highp float;uniform float uOpacity;uniform vec4 uColor;void main() {gl_FragColor = uColor * uOpacity;}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}",this.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT="precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;varying vec2 vCoord2;const int TILEATLAS_TILE_SIZE = 512;const int SSAA_4X4_DIMENSION = TILEATLAS_TILE_SIZE * 4;const float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);void main() {vec4 downsampledColor = 0.25 *(texture2D(uTexture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(uTexture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture2D(uTexture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture2D(uTexture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));gl_FragColor = downsampledColor * uOpacity;}",this.GLSLX_SOURCE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}",this.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;attribute vec2 aPosition2;varying vec2 vCoord2;varying vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}",this.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {float weight = uCount;vec4 result = texture2D(uTexture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture2D(uTexture0, coord_neg) +texture2D(uTexture0, coord_pos));total += 2.0 * weightSum;}gl_FragColor = result / total;}",this.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT="precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D uTexture0;varying vec2 vCoord2;void main() {gl_FragColor = ditherColor(texture2D(uTexture0, vCoord2));}",this.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 uQuad;uniform vec4 uSource;attribute vec2 aPosition2;varying vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}"):X.shouldUseWebGL2()?(this.GLSLX_NAME_U_SHAPE_TYPE="uShapeType",this.GLSLX_NAME_U_ELLIPSE_CENTER="uEllipseCenter",this.GLSLX_NAME_U_ELLIPSE_RADII="uEllipseRadii",this.GLSLX_NAME_U_RECT="uRect",this.GLSLX_NAME_U_CORNER_RADII="uCornerRadii",this.GLSLX_NAME_U_TYPE="uType",this.GLSLX_NAME_U_OPACITY="uOpacity",this.GLSLX_NAME_U_TEXTURE0="uTexture0",this.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D uTexture0;in vec2 vNodeSpacePoint;in vec2 vGradientSampleUV;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);fig_FragColor = ditherColor(texture(uTexture0, coord) * uOpacity) * coverageAlpha;}`,this.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS="uEmulateWrapAddress",this.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS="uEmulateBorderAddress",this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#version 300 es
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb *= color.a;fig_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_GLOBAL_TINT="uGlobalTint",this.GLSLX_NAME_U_GLOBAL_COLOR="uGlobalColor",this.GLSLX_NAME_U_GLOBAL_SHADOWS="uGlobalShadows",this.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS="uGlobalHighlights",this.GLSLX_NAME_U_GLOBAL_EXPOSURE="uGlobalExposure",this.GLSLX_NAME_U_GLOBAL_TEMPERATURE="uGlobalTemperature",this.GLSLX_NAME_U_GLOBAL_CONTRAST="uGlobalContrast",this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 color = sampleImagePaintAWithMSAA();color.rgb = pipeline(color.rgb) * color.a;fig_FragColor = color * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_PROGRESS="uProgress",this.GLSLX_NAME_U_TEXTURE1="uTexture1",this.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vNodeSpacePoint;in vec2 vGradientSampleUV;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);vec2 coord = _gradientCoord(vGradientSampleUV);vec4 lerped = mix(texture(uTexture0, coord), texture(uTexture1, coord), uProgress);fig_FragColor = ditherColor(lerped * uOpacity) * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#version 300 es
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}uniform sampler2D uTexture1;in vec2 vPaintBSample;in vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) / 8.;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb *= lerped.a;fig_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec2 AA_JITTER_PATTERN_1 = vec2(-3, -5);const vec2 AA_JITTER_PATTERN_2 = vec2(5, 1);const vec2 AA_JITTER_PATTERN_3 = vec2(-1, 3);const vec2 AA_JITTER_PATTERN_4 = vec2(7, -7);const vec2 AA_JITTER_PATTERN_5 = vec2(1, -3);const vec2 AA_JITTER_PATTERN_6 = vec2(-5, 5);const vec2 AA_JITTER_PATTERN_7 = vec2(3, 7);const vec2 AA_JITTER_PATTERN_8 = vec2(-7, -1);uniform sampler2D uTexture0;in vec2 vPaintASample;in vec2 vStepA;vec4 sampleImagePaintAWithMSAA() {return (sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_1 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_2 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_3 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_4 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_5 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_6 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_7 * vStepA) +sampleImage(uTexture0, vPaintASample + AA_JITTER_PATTERN_8 * vStepA)) / 8.;}uniform sampler2D uTexture1;in vec2 vPaintBSample;in vec2 vStepB;vec4 sampleImagePaintBWithMSAA() {return (sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_1 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_2 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_3 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_4 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_5 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_6 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_7 * vStepB) +sampleImage(uTexture1, vPaintBSample + AA_JITTER_PATTERN_8 * vStepB)) / 8.;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform float uProgress;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {vec4 imageA = sampleImagePaintAWithMSAA();vec4 imageB = sampleImagePaintBWithMSAA();vec4 lerped = mix(imageA, imageB, uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;fig_FragColor = lerped * uOpacity * pixelShapeCoverage(vNodeSpacePoint);}`,this.GLSLX_NAME_U_UV_SCALE="uUvScale",this.GLSLX_NAME_U_PATH_SIZE="uPathSize",this.GLSLX_NAME_U_PIXEL_RATIO="uPixelRatio",this.GLSLX_NAME_U_PAINT_TRANSFORM0="uPaintTransform0",this.GLSLX_NAME_U_VERTEX_TRANSFORM="uVertexTransform",this.GLSLX_NAME_A_POSITION2="aPosition2",this.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample, out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA = (uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintASample;}uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vNodeSpacePoint;out vec2 vGradientSampleUV;out vec2 vPaintASample;out vec2 vStepA;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.GLSLX_NAME_U_COLOR="uColor",this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#version 300 es
precision highp float;const int SHAPE_TYPE_ELLIPSE = 0;const int SHAPE_TYPE_ROUNDED_RECT = 1;uniform int uShapeType;uniform vec2 uEllipseCenter;uniform vec2 uEllipseRadii;uniform vec4 uRect;uniform vec4 uCornerRadii;float ellipseImplicitEquation(in vec2 nodeSpacePoint, in vec2 ellipseCenter, in vec2 ellipseRadii) {nodeSpacePoint -= ellipseCenter;return ((nodeSpacePoint.x * nodeSpacePoint.x) / (ellipseRadii.x * ellipseRadii.x) +(nodeSpacePoint.y * nodeSpacePoint.y) / (ellipseRadii.y * ellipseRadii.y) -1.);}float roundedRectImplicitEquation(in vec2 nodeSpacePoint, in vec4 bounds, vec4 cornerRadii) {vec2 quadrantSize = (bounds.zw - bounds.xy) / 2.;vec2 ptRelativeToBoxCenter = nodeSpacePoint - quadrantSize;vec2 radiiInBoxHalf = ptRelativeToBoxCenter.x > 0. ? cornerRadii.zy : cornerRadii.wx;float radiusInBoxQuadrant = ptRelativeToBoxCenter.y > 0. ? radiiInBoxHalf.x : radiiInBoxHalf.y;vec2 q = abs(ptRelativeToBoxCenter) - quadrantSize + radiusInBoxQuadrant;return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - radiusInBoxQuadrant;}float shapeImplicitEquation(in vec2 nodeSpacePoint) {if (uShapeType == SHAPE_TYPE_ELLIPSE) {return ellipseImplicitEquation(nodeSpacePoint, uEllipseCenter, uEllipseRadii);} else if (uShapeType == SHAPE_TYPE_ROUNDED_RECT) {return roundedRectImplicitEquation(nodeSpacePoint, uRect, uCornerRadii);}return 0.;}float pixelShapeCoverage(vec2 nodeSpacePoint) {float eqValue = shapeImplicitEquation(nodeSpacePoint);float gradientLengthApprox = fwidth(eqValue);gradientLengthApprox = max(gradientLengthApprox, 0.00001);float distance = eqValue / gradientLengthApprox;return 1.0 - smoothstep(-0.5, 0.5, distance);}uniform float uOpacity;uniform vec4 uColor;in vec2 vNodeSpacePoint;out vec4 fig_FragColor;void main() {float coverageAlpha = pixelShapeCoverage(vNodeSpacePoint);fig_FragColor = uColor * uOpacity * coverageAlpha;}`,this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vNodeSpacePoint;void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.GLSLX_NAME_U_PAINT_TRANSFORM1="uPaintTransform1",this.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;const vec2 AA_JITTER_STEP = vec2(1. / 16., 1. / 16.);uniform vec2 uUvScale;vec2 uvExcludingBorderScreenspacePixel(in vec2 uv) {return (uv - vec2(.5, .5)) * uUvScale + vec2(.5, .5);}uniform vec2 uPathSize;uniform float uPixelRatio;uniform mat3 uPaintTransform0;void setMSAAVaryingsForImagePaintA(vec2 shapeUv, out vec2 vPaintASample, out vec2 vStepA) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintASample = (uPaintTransform0 * vec3(shapeUv, 1)).xy;vStepA = (uPaintTransform0 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintASample;}uniform mat3 uVertexTransform;uniform mat3 uPaintTransform1;in vec2 aPosition2;out vec2 vPaintASample;out vec2 vStepA;out vec2 vPaintBSample;out vec2 vStepB;out vec2 vNodeSpacePoint;out vec2 vGradientSampleUV;void setMSAAVaryingsForImagePaintB(vec2 shapeUv) {vec2 uvPixelSize = 1.0 / uPathSize / uPixelRatio;vPaintBSample = (uPaintTransform1 * vec3(shapeUv, 1)).xy;vStepB = (uPaintTransform1 * vec3(shapeUv + AA_JITTER_STEP * uvPixelSize, 1)).xy - vPaintBSample;}void main() {vec2 shapeUv = uvExcludingBorderScreenspacePixel(aPosition2);vNodeSpacePoint = shapeUv * uPathSize;vGradientSampleUV = (uPaintTransform0 * vec3(shapeUv, 1)).xy;setMSAAVaryingsForImagePaintA(shapeUv, vPaintASample, vStepA);setMSAAVaryingsForImagePaintB(shapeUv);gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.GLSLX_SOURCE_BLEND_MODE_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;uniform float uOpacity;uniform int uType;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;float minv3(vec3 c) {return min(min(c.r, c.g), c.b);}float maxv3(vec3 c) {return max(max(c.r, c.g), c.b);}float satv3(vec3 c) {return maxv3(c) - minv3(c);}float lumv3(vec3 c) {return dot(c, vec3(0.30, 0.59, 0.11)); }vec3 setLum(vec3 cbase, vec3 clum) {float llum = lumv3(clum);vec3 color = cbase + (llum - lumv3(cbase));float minc = minv3(color);float maxc = maxv3(color);if (minc < 0.0) {color = mix(vec3(llum), color, llum / (llum - minc));} else if (maxc > 1.0) {color = mix(vec3(llum), color, (1.0 - llum) / (maxc - llum));}return color;}vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum) {float sbase = satv3(cbase);vec3 color = vec3(0.0);if (sbase > 0.0) {float minbase = minv3(cbase);float ssat = satv3(csat);color = (cbase - minbase) * ssat / sbase;}return setLum(color, clum);}out vec4 fig_FragColor;void main() {const int DARKEN       = 2;const int MULTIPLY     = 3;const int LINEAR_BURN  = 4;const int COLOR_BURN   = 5;const int LIGHTEN      = 6;const int SCREEN       = 7;const int LINEAR_DODGE = 8;const int COLOR_DODGE  = 9;const int OVERLAY = 10;const int SOFT_LIGHT = 11;const int HARD_LIGHT = 12;const int DIFFERENCE = 13;const int EXCLUSION = 14;const int HUE = 15;const int SATURATION = 16;const int COLOR = 17;const int LUMINOSITY = 18;vec4 source = texture(uTexture0, vCoord2) * uOpacity;vec4 target = texture(uTexture1, vCoord2);float Sa = source.a;float Da = target.a;vec3 Dca = target.rgb;if (Sa == 0.0) {fig_FragColor = vec4(Dca, Da);}else {float epsilon = 0.000001;vec3 Sca = source.rgb;vec3 color = Sca * (1.0 - Da) + Dca * (1.0 - Sa);if (uType == DARKEN) {color += min(Sca * Da, Dca * Sa);}else if (uType == MULTIPLY) {color += Sca * Dca;}else if (uType == LINEAR_BURN) {color = max(vec3(0.0), Sca + Dca - Sa * Da);}else if (uType == COLOR_BURN) {vec3 denominator = max(Sca * Da, DITHER_FACTOR);vec3 numerator = (Da - Dca) * Sa * step(DITHER_FACTOR, Da - Dca);color += Sa * Da * (1.0 - min(vec3(1.0), numerator / denominator));}else if (uType == LIGHTEN) {color += max(Sca * Da, Dca * Sa);}else if (uType == SCREEN) {color = Sca + Dca - Sca * Dca;}else if (uType == LINEAR_DODGE) {color = min(vec3(1.0), Sca + Dca);}else if (uType == COLOR_DODGE) {vec3 denominator = max(Da * (Sa - Sca), DITHER_FACTOR);vec3 numerator = Dca * Sa * step(DITHER_FACTOR, Dca);color += Sa * Da * min(vec3(1.0), numerator / denominator);}else if (uType == OVERLAY) {color += mix(Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),2.0 * Sca * Dca,vec3(lessThanEqual(2.0 * Dca, vec3(Da))));}else if (uType == HARD_LIGHT) {color += mix(2.0 * Sca * Dca,Sa * Da - 2.0 * (Da - Dca) * (Sa - Sca),vec3(greaterThan(2.0 * Sca, vec3(Sa))));}else if (uType == DIFFERENCE) {color += abs(Dca * Sa - Sca * Da);}else if (uType == EXCLUSION) {color += Sca * Da + Dca * Sa - 2.0 * Sca * Dca;}else {vec3 delta = vec3(0.0);vec3 Sc = Sca;vec3 Dc = Dca;if (Sa > 0.0) Sc /= Sa;if (Da > 0.0) Dc /= Da;if (uType == SOFT_LIGHT) {vec3 c0 = 1.0 - Dc;vec3 c1 = (16.0 * Dc - 12.0) * Dc + 3.0;vec3 c2 = inversesqrt(Dc + epsilon) - 1.0;vec3 c = mix(c1, c2, vec3(greaterThan(Dc, vec3(0.25))));c = mix(c, c0, vec3(greaterThan(Sc, vec3(0.50))));delta = Dc * (1.0 + c * (2.0 * Sc - 1.0));}else if (uType == HUE) {delta = setLumSat(Sc, Dc, Dc);}else if (uType == SATURATION) {delta = setLumSat(Dc, Sc, Dc);}else if (uType == COLOR) {delta = setLum(Sc, Dc);}else if (uType == LUMINOSITY) {delta = setLum(Dc, Sc);}color += Sa * Da * delta;}fig_FragColor = vec4(color, Sa + Da - Sa * Da);}}`,this.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = texture(uTexture0, vCoord2) * uOpacity;}`,this.GLSLX_NAME_U_COUNT="uCount",this.GLSLX_NAME_U_BLUR_DELTA="uBlurDelta",this.GLSLX_NAME_U_BLUR_CLAMP="uBlurClamp",this.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform vec4 uBlurClamp;uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord2 = clamp(vCoord2, uBlurClamp.xy, uBlurClamp.zw);float weight = uCount;vec4 result = texture(uTexture0, coord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = coord2 - uBlurDelta * t0;vec2 coord0_pos = coord2 + uBlurDelta * t0;vec2 coord1_neg = coord2 - uBlurDelta * t1;vec2 coord1_pos = coord2 + uBlurDelta * t1;float weight0_neg = (uCount - t0) * float(coord0_neg == clamp(coord0_neg, uBlurClamp.xy, uBlurClamp.zw));float weight0_pos = (uCount - t0) * float(coord0_pos == clamp(coord0_pos, uBlurClamp.xy, uBlurClamp.zw));float weight1_neg = (uCount - t1) * float(coord1_neg == clamp(coord1_neg, uBlurClamp.xy, uBlurClamp.zw));float weight1_pos = (uCount - t1) * float(coord1_pos == clamp(coord1_pos, uBlurClamp.xy, uBlurClamp.zw));float weight_neg = weight0_neg + weight1_neg;float weight_pos = weight0_pos + weight1_pos;vec2 coord_neg = (coord0_neg * weight0_neg + coord1_neg * weight1_neg) / weight_neg;vec2 coord_pos = (coord0_pos * weight0_pos + coord1_pos * weight1_pos) / weight_pos;result +=texture(uTexture0, coord_neg) * weight_neg +texture(uTexture0, coord_pos) * weight_pos;total += weight_neg + weight_pos;}fig_FragColor = result / total;}`,this.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX=`#version 300 es
precision highp float;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(aPosition2 * 2.0 - 1.0, 0.0, 1.0);}`,this.GLSLX_NAME_U_QUAD="uQuad",this.GLSLX_SOURCE_COPY_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;in vec2 aPosition2;void main() {gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2), 0, 1);}`,this.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = texture(uTexture0, vCoord2);}`,this.GLSLX_NAME_U_SOURCE="uSource",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform vec4 uSource;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}`,this.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT="uUvSpaceClampingRect",this.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT="uUvSpaceSourceRect",this.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform vec4 uUvSpaceClampingRect;uniform vec4 uUvSpaceSourceRect;uniform sampler2D uTexture0;in vec2 vCoord2;const bool drawDebugStuff = false;out vec4 fig_FragColor;void main() {vec2 sampleCoordinates = clamp(vCoord2, uUvSpaceClampingRect.xy, uUvSpaceClampingRect.zw);fig_FragColor = texture(uTexture0, sampleCoordinates) * uOpacity;if (drawDebugStuff) {vec2 tt = 2.0 * abs((vCoord2 - uUvSpaceSourceRect.xy) / (uUvSpaceSourceRect.zw - uUvSpaceSourceRect.xy) - 0.5);float t = max(tt.x, tt.y);if (t > 0.99) {fig_FragColor = vec4(1.0, 0.0, 0.0, 1.0);}}}`,this.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM="uToClipSpaceTransform",this.GLSLX_NAME_U_DESTINATION_RECT="uDestinationRect",this.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uUvSpaceSourceRect;uniform mat3 uToClipSpaceTransform;uniform vec4 uDestinationRect;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uUvSpaceSourceRect.xy, uUvSpaceSourceRect.zw, aPosition2);gl_Position = vec4((uToClipSpaceTransform * vec3(mix(uDestinationRect.xy, uDestinationRect.zw, aPosition2), 1.0)).xy,0,1);}`,this.GLSLX_SOURCE_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord = _gradientCoord(vCoord2);fig_FragColor = ditherColor(texture(uTexture0, coord) * uOpacity);}`,this.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = float(texture(uTexture0, vCoord2).a > 0.0) * uColor;}`,this.GLSLX_NAME_U_TEXTURE_SIZE="uTextureSize",this.GLSLX_NAME_U_TEXTURE_PX="uTexturePx",this.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform vec4 uColor;uniform float uTextureSize;uniform float uTexturePx;uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coordInSSAA = vCoord2 * vec2(uTextureSize);vec2 lowerLeftInSSAA = floor(coordInSSAA - vec2(0.5)) + 0.5;vec2 lowerLeftTexelCoord = lowerLeftInSSAA * uTexturePx;vec2 lowerRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, 0.0);vec2 upperLeftTexelCoord = lowerLeftTexelCoord + vec2(0.0, uTexturePx);vec2 upperRightTexelCoord = lowerLeftTexelCoord + vec2(uTexturePx, uTexturePx);float lowerLeftAlpha = texture(uTexture0, lowerLeftTexelCoord).a;float lowerRightAlpha = texture(uTexture0, lowerRightTexelCoord).a;float upperLeftAlpha = texture(uTexture0, upperLeftTexelCoord).a;float upperRightAlpha = texture(uTexture0, upperRightTexelCoord).a;float hardMaskedLowerLeftAlpha = float(lowerLeftAlpha > 0.0);float hardMaskedLowerRightAlpha = float(lowerRightAlpha > 0.0);float hardMaskedUpperLeftAlpha = float(upperLeftAlpha > 0.0);float hardMaskedUpperRightAlpha = float(upperRightAlpha > 0.0);float rightWeight = coordInSSAA.x - lowerLeftInSSAA.x;float leftWeight = 1.0 - rightWeight;float topWeight = coordInSSAA.y - lowerLeftInSSAA.y;float bottomWeight = 1.0 - topWeight;float downsampledHardMaskedAlpha =(hardMaskedLowerLeftAlpha * leftWeight + hardMaskedLowerRightAlpha * rightWeight) * bottomWeight +(hardMaskedUpperLeftAlpha * leftWeight + hardMaskedUpperRightAlpha * rightWeight) * topWeight;fig_FragColor = downsampledHardMaskedAlpha * uColor;}`,this.GLSLX_SOURCE_IMAGE_FRAGMENT=`#version 300 es
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}uniform float uOpacity;uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 color = sampleImage(uTexture0, vCoord2);color.rgb *= color.a;fig_FragColor = color * uOpacity;}`,this.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform float uOpacity;uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 color = sampleImage(uTexture0, vCoord2);color.rgb = pipeline(color.rgb) * color.a;fig_FragColor = color * uOpacity;}`,this.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT=`#version 300 es
precision highp float;uniform int uType;const float PI = 3.141592;vec2 _gradientCoord(in vec2 paintUV) {const int LINEAR = 1;const int RADIAL = 2;const int ANGULAR = 3;const int DIAMOND = 4;vec2 uv = paintUV - 0.5;float t =uType == LINEAR ? uv.x + 0.5 :uType == RADIAL ? 2.0 * length(uv) :uType == ANGULAR ? fract(atan(uv.y, uv.x) / (2.0 * PI)) :uType == DIAMOND ? 2.0 * max(abs(uv.x + uv.y), abs(uv.y - uv.x)) :0.0;return vec2(t, 0.25 + (0.75 - 0.25) / 256.0);}const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec2 coord = _gradientCoord(vCoord2);vec4 lerped = mix(texture(uTexture0, coord), texture(uTexture1, coord), uProgress);fig_FragColor = ditherColor(lerped * uOpacity);}`,this.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT=`#version 300 es
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;in vec2 vCoord2b;out vec4 fig_FragColor;void main() {vec4 lerped = mix(sampleImage(uTexture0, vCoord2), sampleImage(uTexture1, vCoord2b), uProgress);lerped.rgb *= lerped.a;fig_FragColor = lerped * uOpacity;}`,this.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#version 300 es
precision highp float;uniform bool uEmulateWrapAddress;uniform bool uEmulateBorderAddress;vec4 sampleImage(sampler2D tex, vec2 coord) {if (uEmulateWrapAddress) {coord = fract(coord);}vec4 color = texture(tex, coord);if (uEmulateBorderAddress && coord != clamp(coord, 0.0, 1.0)) color.a = 0.0;return color;}const vec3 RGB2Y = vec3(0.2126, 0.7152, 0.0722);const float IMAGE_HIGHLIGHT_SHADOW_THRESHOLD = 0.5;uniform float uGlobalTint;uniform float uGlobalColor;uniform float uGlobalShadows;uniform float uGlobalHighlights;uniform float uGlobalExposure;uniform float uGlobalTemperature;uniform float uGlobalContrast;vec3 colorToLinear(vec3 color) {color = pow(color, vec3(2.2));return color;}vec3 colorFromLinear(vec3 color) {color = pow(color, vec3(1.0 / 2.2));return color;}float rangeFactor(vec3 color, float shadows, float highlights) {float lThreshold = dot(color, RGB2Y) - pow(IMAGE_HIGHLIGHT_SHADOW_THRESHOLD, 2.2);return 0.75 * lThreshold / sqrt(1.0 + 4.0 * lThreshold * lThreshold) * (lThreshold > 0.0 ? highlights : -shadows * 0.999);}vec3 adjustExposure(vec3 color, float exposureAdjust) {float lFactor = pow(10.0, 2.0 * exposureAdjust) - 1.0;const float lSqueeze = 0.75;float lUnsqueeze = 1.0 / (1.0 - lSqueeze) - 1.0;float gray = dot(color, RGB2Y);lUnsqueeze *= 1.0 + gray * gray * min(0.0, exposureAdjust) / (0.2 - min(0.0, exposureAdjust));color += (gray - color) * lSqueeze;if (exposureAdjust < 0.0) {color *= 1.0 + exposureAdjust / 16.0;gray *= 1.0 + exposureAdjust / 16.0;}color *= (lFactor + 1.0) / (color * lFactor + 1.0);gray *= (lFactor + 1.0) / (gray * lFactor + 1.0);color += (color - gray) * lUnsqueeze;color = clamp(color, 0.0, 1.0);return color;}vec3 adjustColor(vec3 color, float colorAdjust) {float gray = dot(color, RGB2Y);if (colorAdjust <= 0.0) {color -= (gray - color) * colorAdjust;} else {float lNeg = gray / (gray - min(min(color.r, color.g), color.b) + 1e-6);float lPos = (1.0 - gray) / (max(max(color.r, color.g), color.b) - gray + 1e-6);float lFactor = mix(1.0, min(lNeg, lPos), colorAdjust);lFactor = min(lFactor, 2.0); color += (gray - color) * (1.0 - lFactor);}return color;}float smootherstep(float edge0, float edge1, float x) {x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);}vec3 adjustTempTintContrast(vec3 color, float temp, float tint, float contrast) {vec3 lXYZ = mat3(0.4124564, 0.2126729, 0.0193339,0.3575761, 0.7151522, 0.1191920,0.1804375, 0.0721750, 0.9503041) * color;lXYZ.x /= 0.95047;lXYZ.z /= 1.08883;lXYZ = pow(lXYZ, vec3(1.0 / 3.0));vec3 lLAB = vec3(116.0 * lXYZ.y - 16.0,500.0 * (lXYZ.x - lXYZ.y),200.0 * (lXYZ.y - lXYZ.z));lLAB.y += 30.0 * tint;lLAB.z += 30.0 * temp;float scaledThreshold = IMAGE_HIGHLIGHT_SHADOW_THRESHOLD * 100.0;float thresholdDelta = 30.0;float contrastLeftCurve = contrast < 0.0? (lLAB.x - scaledThreshold) * 0.2 + 50.0: lLAB.x;float contrastRightCurve = contrast < 0.0? lLAB.x: smootherstep(scaledThreshold - thresholdDelta,scaledThreshold + thresholdDelta, lLAB.x) * 100.0;float interp = contrast < 0.0 ? contrast + 1.0 : contrast;lLAB.x = mix(contrastLeftCurve, contrastRightCurve, interp);lXYZ.y = (lLAB.x + 16.0) / 116.0;lXYZ.x = lLAB.y / 500.0 + lXYZ.y;lXYZ.z = lXYZ.y - lLAB.z / 200.0;lXYZ *= lXYZ * lXYZ;lXYZ.x *= 0.95047;lXYZ.z *= 1.08883;color = mat3(3.2404542, -0.9692660, 0.0556434,-1.5371385, 1.8760108, -0.2040259,-0.4985314, 0.0415560, 1.0572252) * lXYZ;color = clamp(color, 0.0, 1.0);return color;}vec3 pipeline(vec3 color) {color = colorToLinear(color);float originalRangeFactor = rangeFactor(color, uGlobalShadows, uGlobalHighlights);color = adjustTempTintContrast(color, uGlobalTemperature, uGlobalTint, uGlobalContrast);color = adjustExposure(color, uGlobalExposure + originalRangeFactor);color = adjustColor(color, clamp(uGlobalColor, -1.0, 1.0));color = colorFromLinear(color);return color;}uniform float uOpacity;uniform float uProgress;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;in vec2 vCoord2b;out vec4 fig_FragColor;void main() {vec4 lerped = mix(sampleImage(uTexture0, vCoord2), sampleImage(uTexture1, vCoord2b), uProgress);lerped.rgb = pipeline(lerped.rgb) * lerped.a;fig_FragColor = lerped * uOpacity;}`,this.GLSLX_NAME_U_TEXTURE0_UV_SPACE_SCISSOR="uTexture0UvSpaceScissor",this.GLSLX_NAME_U_TEXTURE1_UV_SPACE_SCISSOR="uTexture1UvSpaceScissor",this.GLSLX_SOURCE_LERP_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uTexture0UvSpaceScissor;uniform vec4 uTexture1UvSpaceScissor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec4 texture0Color =all(greaterThan(vCoord2, uTexture0UvSpaceScissor.xy)) && all(lessThan(vCoord2, uTexture0UvSpaceScissor.zw)) ?texture(uTexture0, vCoord2) :vec4(0.0);vec4 texture1Color =all(greaterThan(vCoord2, uTexture1UvSpaceScissor.xy)) && all(lessThan(vCoord2, uTexture1UvSpaceScissor.zw)) ?texture(uTexture1, vCoord2) :vec4(0.0);fig_FragColor = mix(texture0Color, texture1Color, uOpacity);}`,this.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT=`#version 300 es
precision highp float;in vec3 vCoord3;out vec4 fig_FragColor;void main() {if (vCoord3.x * vCoord3.x * vCoord3.x > vCoord3.y * vCoord3.z) {discard;}}`,this.GLSLX_NAME_A_COORD3="aCoord3",this.GLSLX_SOURCE_LOOP_BLINN_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec2 aPosition2;in vec3 aCoord3;out vec3 vCoord3;void main() {vCoord3 = aCoord3;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {if (texture(uTexture1, vCoord2).a == 0.0) {discard;}fig_FragColor = texture(uTexture0, vCoord2);}`,this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = (1.0 - texture(uTexture0, vCoord2).a) * texture(uTexture1, vCoord2).a * uColor;}`,this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform vec4 uColor;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float texture1HardMasked = float(texture(uTexture1, vCoord2).a > 0.0);fig_FragColor = (1.0 - texture(uTexture0, vCoord2).a) * texture1HardMasked * uColor;}`,this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = texture(uTexture0, vCoord2) * float(texture(uTexture1, vCoord2).a == 0.);}`,this.GLSLX_NAME_U_MASK_TEXTURE="uMaskTexture",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform sampler2D uMaskTexture;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float geometryAlpha = texture(uMaskTexture, vCoord2).a;fig_FragColor = mix(texture(uTexture1, vCoord2),texture(uTexture0, vCoord2) * float(geometryAlpha == 0.),1.0 - geometryAlpha);}`,this.GLSLX_SOURCE_MASK_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = texture(uTexture0, vCoord2) * texture(uTexture1, vCoord2).a;}`,this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec3 rgb = texture(uTexture1, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);fig_FragColor = texture(uTexture0, vCoord2) * luminance * texture(uTexture1, vCoord2).a;}`,this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uMaskTexture;uniform sampler2D uTexture0;uniform sampler2D uTexture1;in vec2 vCoord2;out vec4 fig_FragColor;void main() {vec3 rgb = texture(uMaskTexture, vCoord2).rgb;vec3 weights = vec3(0.299, 0.587, 0.114);float c2 = dot(rgb * rgb, weights);float luminance = sqrt(c2);fig_FragColor = mix(texture(uTexture1, vCoord2),texture(uTexture0, vCoord2),texture(uMaskTexture, vCoord2).a * luminance);}`,this.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;uniform sampler2D uTexture1;uniform sampler2D uMaskTexture;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = mix(texture(uTexture1, vCoord2), texture(uTexture0, vCoord2), texture(uMaskTexture, vCoord2).a);}`,this.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) return 0.0;else if (x < 0.0) return 0.5 * (x + 1.0) * (x + 1.0);else if (x < 1.0) return 0.5 - 0.5 * x * (x - 2.0);else return 1.0;}uniform vec4 uColor;in vec4 vCoord4;out vec4 fig_FragColor;void main() {float alpha = (integrateTriangle(vCoord4.x) - integrateTriangle(vCoord4.z)) * (integrateTriangle(vCoord4.y) - integrateTriangle(vCoord4.w));fig_FragColor = ditherColor(uColor * alpha);}`,this.GLSLX_NAME_U_BLUR_RADIUS="uBlurRadius",this.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform vec4 uQuad;uniform float uBlurRadius;in vec2 aPosition2;out vec4 vCoord4;void main() {vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord4 = (vec4(vertex, vertex) - uQuad) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}`,this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT=`#version 300 es
precision highp float;uniform sampler2D uTexture0;in vec4 vPosition4;out vec4 fig_FragColor;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;uv.y = 1.0 - uv.y;fig_FragColor = texture(uTexture0, uv);}`,this.GLSLX_NAME_A_POSITION4="aPosition4",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aPosition4;out vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}`,this.GLSLX_NAME_U_HOTSPOT_OPACITY="uHotspotOpacity",this.GLSLX_NAME_U_STROKE_PROPORTION="uStrokeProportion",this.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT="uUvHotspotClippingRect",this.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform float uHotspotOpacity;uniform vec2 uStrokeProportion;uniform vec4 uUvHotspotClippingRect;in vec4 vPosition4;const vec3 HOTSPOT_COLOR = vec3(48.0 / 255.0, 194.0 / 255.0, 255.0 / 255.0);bool contains(vec4 rect, vec2 point) {return (rect.z >= 0.0 &&rect.w >= 0.0 &&clamp(point.x, rect.x, rect.x + rect.z) == point.x &&clamp(point.y, rect.y, rect.y + rect.w) == point.y);}out vec4 fig_FragColor;void main() {vec2 position = vPosition4.xy;vec2 uv = vPosition4.zw;if (contains(uUvHotspotClippingRect, position)) {if (uv.x < uStrokeProportion.x || uv.x > 1.0 - uStrokeProportion.x ||uv.y < uStrokeProportion.y || uv.y > 1.0 - uStrokeProportion.y) {fig_FragColor = vec4(HOTSPOT_COLOR, 1.0 * uHotspotOpacity);} else {fig_FragColor = vec4(HOTSPOT_COLOR, 0.5 * uHotspotOpacity);}} else {fig_FragColor = vec4(0.0);}}`,this.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aPosition4;out vec4 vPosition4;void main() {vec2 transformedPosition = (uVertexTransform * vec3(aPosition4.xy, 1.0)).xy;vPosition4 = vec4(transformedPosition.xy, aPosition4.zw);gl_Position = vec4(transformedPosition, 0.0, 1.0);}`,this.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS="uHalfSizeOverBlurRadius",this.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS="uCornerRadiusOverBlurRadius",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}float integrateTriangle(float x) {if (x < -1.0) return 0.0;else if (x < 0.0) return 0.5 * (x + 1.0) * (x + 1.0);else if (x < 1.0) return 0.5 - 0.5 * x * (x - 2.0);else return 1.0;}uniform vec4 uColor;uniform vec2 uHalfSizeOverBlurRadius;uniform float uCornerRadiusOverBlurRadius;in vec2 vCoord2;float triangle(float x) {return max(0.0, (1.0 - abs(x)));}float roundedRectangleBlurHorizontal(float x, float y, float cornerRadius, vec2 halfSize) {float deltaY = min(halfSize.y - cornerRadius - abs(y), 0.0);float roundedRectX = halfSize.x - cornerRadius + sqrt(max(0.0, cornerRadius * cornerRadius - deltaY * deltaY));vec2 xRelativeToLowerAndUpper = vec2(x + roundedRectX, x - roundedRectX);return integrateTriangle(xRelativeToLowerAndUpper.x) - integrateTriangle(xRelativeToLowerAndUpper.y);}out vec4 fig_FragColor;void main() {float alpha;if (all(lessThan(abs(vCoord2), uHalfSizeOverBlurRadius - vec2(uCornerRadiusOverBlurRadius + 1.0 )))) {alpha = 1.0;} else {float low = vCoord2.y - uHalfSizeOverBlurRadius.y;float high = vCoord2.y + uHalfSizeOverBlurRadius.y;float start = clamp(-1.0 , low, high);float end = clamp(1.0 , low, high);if (start == end) {alpha = 0.0;} else {const int numSamples = 4;float step = (end - start) / float(numSamples);float y = start + step * 0.5;float weightSum = 0.0;float result = 0.0;for (int i = 0; i < numSamples; i++) {float currentWeight = triangle(y);result +=roundedRectangleBlurHorizontal(vCoord2.x, vCoord2.y - y, uCornerRadiusOverBlurRadius, uHalfSizeOverBlurRadius) *currentWeight;weightSum += currentWeight;y += step;}float weightNormalizationFactor = (integrateTriangle(end) - integrateTriangle(start)) / weightSum;alpha = result * weightNormalizationFactor;}}fig_FragColor = ditherColor(uColor * alpha);}`,this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform float uBlurRadius;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vCoord2;void main() {vec2 center = (uQuad.xy + uQuad.zw) * 0.5;vec2 vertex = mix(uQuad.xy - uBlurRadius, uQuad.zw + uBlurRadius, aPosition2);vCoord2 = (vertex - center) / uBlurRadius;gl_Position = vec4(uVertexTransform * vec3(vertex, 1), 0).xywz;}`,this.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT=`#version 300 es
precision highp float;in vec2 vCoord2;in vec4 vCoord4;out vec4 fig_FragColor;void main() {fig_FragColor = vCoord4 * min(1.0, min(vCoord2.x, vCoord2.y));}`,this.GLSLX_NAME_A_COORD4="aCoord4",this.GLSLX_SOURCE_SMOOTH_PATH_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec4 aCoord4;in vec4 aPosition4;out vec2 vCoord2;out vec4 vCoord4;void main() {vCoord2 = aPosition4.zw;vCoord4 = aCoord4;gl_Position = vec4(uVertexTransform * vec3(aPosition4.xy, 1.0), 0.0).xywz;}`,this.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform vec4 uColor;out vec4 fig_FragColor;void main() {fig_FragColor = uColor * uOpacity;}`,this.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = aPosition2;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1.0), 0.0).xywz;}`,this.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT=`#version 300 es
precision highp float;uniform float uOpacity;uniform sampler2D uTexture0;in vec2 vCoord2;const int TILEATLAS_TILE_SIZE = 512;const int SSAA_4X4_DIMENSION = TILEATLAS_TILE_SIZE * 4;const float SSAA_4X4_PX = 1.0 / float(SSAA_4X4_DIMENSION);out vec4 fig_FragColor;void main() {vec4 downsampledColor = 0.25 *(texture(uTexture0, vCoord2 + vec2(-SSAA_4X4_PX, -SSAA_4X4_PX)) +texture(uTexture0, vCoord2 + vec2(SSAA_4X4_PX, -SSAA_4X4_PX)) +texture(uTexture0, vCoord2 + vec2(SSAA_4X4_PX, SSAA_4X4_PX)) +texture(uTexture0, vCoord2 + vec2(-SSAA_4X4_PX, SSAA_4X4_PX)));fig_FragColor = downsampledColor * uOpacity;}`,this.GLSLX_SOURCE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uQuad.xy, uQuad.zw, aPosition2);gl_Position = vec4(vCoord2 * 2.0 - 1.0, 0, 1);}`,this.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX=`#version 300 es
precision highp float;uniform mat3 uVertexTransform;uniform mat3 uPaintTransform0;uniform mat3 uPaintTransform1;in vec2 aPosition2;out vec2 vCoord2;out vec2 vCoord2b;void main() {vCoord2 = (uPaintTransform0 * vec3(aPosition2, 1)).xy;vCoord2b = (uPaintTransform1 * vec3(aPosition2, 1)).xy;gl_Position = vec4(uVertexTransform * vec3(aPosition2, 1), 0).xywz;}`,this.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT=`#version 300 es
precision highp float;uniform float uCount;uniform vec2 uBlurDelta;uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {float weight = uCount;vec4 result = texture(uTexture0, vCoord2) * weight;float total = weight;for (int i = 1; i < 32; i += 2) {if (float(i) > uCount) {break;}float t0 = float(i);float t1 = min(t0 + 1.0, uCount);vec2 coord0_neg = vCoord2 - uBlurDelta * t0;vec2 coord0_pos = vCoord2 + uBlurDelta * t0;vec2 coord1_neg = vCoord2 - uBlurDelta * t1;vec2 coord1_pos = vCoord2 + uBlurDelta * t1;float weight0 = uCount - t0;float weight1 = uCount - t1;float weightSum = weight0 + weight1;vec2 coord_neg = (coord0_neg * weight0 + coord1_neg * weight1) / weightSum;vec2 coord_pos = (coord0_pos * weight0 + coord1_pos * weight1) / weightSum;result += weightSum *(texture(uTexture0, coord_neg) +texture(uTexture0, coord_pos));total += 2.0 * weightSum;}fig_FragColor = result / total;}`,this.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT=`#version 300 es
precision highp float;const float DITHER_FACTOR = 0.003922;const float DITHER_RANGE = 2.0 * DITHER_FACTOR;float random() {vec2 coordCopy = gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898, 78.233), coordCopy)) * 43758.5453);}vec4 ditherColor(vec4 color) {float offset = (random() - 0.5) * DITHER_RANGE; return color.a > 0.0 ? min(abs(color + offset), 1.0) : color;}uniform sampler2D uTexture0;in vec2 vCoord2;out vec4 fig_FragColor;void main() {fig_FragColor = ditherColor(texture(uTexture0, vCoord2));}`,this.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX=`#version 300 es
precision highp float;uniform vec4 uQuad;uniform vec4 uSource;in vec2 aPosition2;out vec2 vCoord2;void main() {vCoord2 = mix(uSource.xy, uSource.zw, aPosition2);gl_Position = vec4(mix(uQuad.xy, uQuad.zw, aPosition2) * 2.0 - 1.0, 0, 1);}`):(this.GLSLX_SOURCE_SMOOTH_PATH_VERTEX="precision highp float;uniform mat3 u;attribute vec4 ha,jb;varying vec2 e;varying vec4 N;void main(){e=ha.zw,N=jb,gl_Position=vec4(u*vec3(ha.xy,1),0).xywz;}",this.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT="precision highp float;varying vec2 e;varying vec4 N;void main(){gl_FragColor=N*min(1.,min(e.x,e.y));}",this.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX="precision highp float;uniform mat3 u;attribute vec4 ha;varying vec4 W;void main(){vec2 a=(u*vec3(ha.xy,1)).xy;W=vec4(a.xy,ha.zw),gl_Position=vec4(a,0,1);}",this.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT="precision highp float;uniform float bb;uniform vec2 Qa;uniform vec4 kb;varying vec4 W;const vec3 cb=vec3(.188235,.760784,1);bool lb(vec4 a,vec2 b){return a.z>=0.&&a.w>=0.&&clamp(b.x,a.x,a.x+a.z)==b.x&&clamp(b.y,a.y,a.y+a.w)==b.y;}void main(){vec2 b=W.xy,a=W.zw;gl_FragColor=lb(kb,b)?a.x<Qa.x||a.x>1.-Qa.x||a.y<Qa.y||a.y>1.-Qa.y?vec4(cb,1.*bb):vec4(cb,.5*bb):vec4(0);}",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX="precision highp float;uniform mat3 u;attribute vec4 ha;varying vec4 W;void main(){vec2 a=(u*vec3(ha.xy,1)).xy;W=vec4(a.xy,ha.zw),gl_Position=vec4(a,0,1);}",this.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT="precision highp float;uniform sampler2D f;varying vec4 W;void main(){vec2 a=W.zw;a.y=1.-a.y,gl_FragColor=texture2D(f,a);}",this.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 s,Ma;attribute vec2 n;varying vec2 e;void main(){e=mix(Ma.xy,Ma.zw,n),gl_Position=vec4(mix(s.xy,s.zw,n)*2.-1.,0,1);}",this.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform sampler2D f;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}void main(){gl_FragColor=O(texture2D(f,e));}",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX="precision highp float;uniform vec4 s,Ma;attribute vec2 n;varying vec2 e;void main(){e=mix(Ma.xy,Ma.zw,n),gl_Position=vec4(mix(s.xy,s.zw,n)*2.-1.,0,1);}",this.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D f;varying vec2 e;void main(){gl_FragColor=texture2D(f,e);}",this.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float db,ia;uniform vec4 I;varying vec2 e;void main(){vec2 b=e*vec2(db),c=floor(b-vec2(.5))+.5,a=c*ia,i=a+vec2(ia,0),m=a+vec2(0,ia),t=a+vec2(ia,ia);float D=texture2D(f,a).a,E=texture2D(f,i).a,J=texture2D(f,m).a,P=texture2D(f,t).a,X=float(D>0.),Y=float(E>0.),ua=float(J>0.),va=float(P>0.),d=b.x-c.x,g=1.-d,h=b.y-c.y,Ka=1.-h,Ya=(X*g+Y*d)*Ka+(ua*g+va*d)*h;gl_FragColor=Ya*I;}",this.GLSLX_SOURCE_COPY_TILE_VERTEX="precision highp float;uniform vec4 s;attribute vec2 n;void main(){gl_Position=vec4(mix(s.xy,s.zw,n),0,1);}",this.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX="precision highp float;uniform mat3 mb;uniform vec4 eb,fb;attribute vec2 n;varying vec2 e;void main(){e=mix(eb.xy,eb.zw,n),gl_Position=vec4((mb*vec3(mix(fb.xy,fb.zw,n),1)).xy,0,1);}",this.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float q;uniform vec4 Ra;varying vec2 e;void main(){vec2 a=clamp(e,Ra.xy,Ra.zw);gl_FragColor=texture2D(f,a)*q;}",this.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX="precision highp float;attribute vec2 n;varying vec2 e;void main(){e=n,gl_Position=vec4(n*2.-1.,0,1);}",this.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float q;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*q;}",this.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float q;varying vec2 e;void main(){vec4 a=.25*(texture2D(f,e+vec2(-4.882813e-4,-4.882813e-4))+texture2D(f,e+vec2(4.882813e-4,-4.882813e-4))+texture2D(f,e+vec2(4.882813e-4,4.882813e-4))+texture2D(f,e+vec2(-4.882813e-4,4.882813e-4)));gl_FragColor=a*q;}",this.GLSLX_SOURCE_LOOP_BLINN_VERTEX="precision highp float;uniform mat3 u;attribute vec2 n;attribute vec3 nb;varying vec3 wa;void main(){wa=nb,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT="precision highp float;varying vec3 wa;void main(){if(wa.x*wa.x*wa.x>wa.y*wa.z)discard;}",this.GLSLX_SOURCE_TILE_VERTEX="precision highp float;uniform vec4 s;attribute vec2 n;varying vec2 e;void main(){e=mix(s.xy,s.zw,n),gl_Position=vec4(e*2.-1.,0,1);}",this.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float v;uniform vec2 F;uniform vec4 y;varying vec2 e;void main(){vec2 a=clamp(e,y.xy,y.zw);float t=v;vec4 ua=texture2D(f,a)*t;float va=t;for(int m=1;m<32;m+=2){if(float(m)>v)break;float b=float(m),c=min(b+1.,v);vec2 d=a-F*b,g=a+F*b,h=a-F*c,i=a+F*c;float D=(v-b)*float(d==clamp(d,y.xy,y.zw)),E=(v-b)*float(g==clamp(g,y.xy,y.zw)),J=(v-c)*float(h==clamp(h,y.xy,y.zw)),P=(v-c)*float(i==clamp(i,y.xy,y.zw)),X=D+J,Y=E+P;vec2 Ka=(d*D+h*J)/X,Ya=(g*E+i*P)/Y;ua+=texture2D(f,Ka)*X+texture2D(f,Ya)*Y,va+=X+Y;}gl_FragColor=ua/va;}",this.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D f;uniform float v;uniform vec2 F;varying vec2 e;void main(){float i=v;vec4 m=texture2D(f,e)*i;float t=i;for(int h=1;h<32;h+=2){if(float(h)>v)break;float a=float(h),b=min(a+1.,v);vec2 D=e-F*a,E=e+F*a,J=e-F*b,P=e+F*b;float c=v-a,d=v-b,g=c+d;vec2 X=(D*c+J*d)/g,Y=(E*c+P*d)/g;m+=g*(texture2D(f,X)+texture2D(f,Y)),t+=2.*g;}gl_FragColor=m/t;}",this.GLSLX_SOURCE_LERP_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform float q;uniform vec4 Sa,Ta;varying vec2 e;void main(){vec4 a=all(greaterThan(e,Sa.xy))&&all(lessThan(e,Sa.zw))?texture2D(f,e):vec4(0),b=all(greaterThan(e,Ta.xy))&&all(lessThan(e,Ta.zw))?texture2D(k,e):vec4(0);gl_FragColor=mix(a,b,q);}",this.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 u;uniform float Z;uniform vec4 s;attribute vec2 n;varying vec4 N;void main(){vec2 a=mix(s.xy-Z,s.zw+Z,n);N=(vec4(a,a)-s)/Z,gl_Position=vec4(u*vec3(a,1),0).xywz;}",this.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform vec4 I;varying vec4 N;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}float K(float a){return a<-1.?0.:a<0.?.5*(a+1.)*(a+1.):a<1.?.5-.5*a*(a-2.):1.;}void main(){float a=(K(N.x)-K(N.z))*(K(N.y)-K(N.w));gl_FragColor=O(I*a);}",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX="precision highp float;uniform mat3 u;uniform float Z;uniform vec4 s;attribute vec2 n;varying vec2 e;void main(){vec2 b=(s.xy+s.zw)*.5,a=mix(s.xy-Z,s.zw+Z,n);e=(a-b)/Z,gl_Position=vec4(u*vec3(a,1),0).xywz;}",this.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform float gb;uniform vec2 La;uniform vec4 I;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}float K(float a){return a<-1.?0.:a<0.?.5*(a+1.)*(a+1.):a<1.?.5-.5*a*(a-2.):1.;}float hb(float a){return max(0.,1.-abs(a));}float ob(float b,float h,float a,vec2 c){float d=min(c.y-a-abs(h),0.),g=c.x-a+sqrt(max(0.,a*a-d*d));vec2 i=vec2(b+g,b-g);return K(i.x)-K(i.y);}void main(){float c;if(all(lessThan(abs(e),La-vec2(gb+1.))))c=1.;else{float d=e.y-La.y,g=e.y+La.y,a=clamp(-1.,d,g),b=clamp(1.,d,g);if(a==b)c=0.;else{float i=(b-a)/4.,h=a+i*.5,m=0.,t=0.;for(int D=0;D<4;D++){float E=hb(h);t+=ob(e.x,e.y-h,gb,La)*E,m+=E,h+=i;}float J=(K(b)-K(a))/m;c=t*J;}}gl_FragColor=O(I*c);}",this.GLSLX_SOURCE_MASK_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*texture2D(k,e).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){vec3 a=texture2D(k,e).rgb,b=vec3(.299,.587,.114);float c=dot(a*a,b),d=sqrt(c);gl_FragColor=texture2D(f,e)*d*texture2D(k,e).a;}",this.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){vec3 a=texture2D(sa,e).rgb,b=vec3(.299,.587,.114);float c=dot(a*a,b),d=sqrt(c);gl_FragColor=mix(texture2D(k,e),texture2D(f,e),texture2D(sa,e).a*d);}",this.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){gl_FragColor=mix(texture2D(k,e),texture2D(f,e),texture2D(sa,e).a);}",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*float(texture2D(k,e).a==0.);}",this.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){float a=texture2D(sa,e).a;gl_FragColor=mix(texture2D(k,e),texture2D(f,e)*float(a==0.),1.-a);}",this.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT="precision highp float;uniform sampler2D f;uniform vec4 I;varying vec2 e;void main(){gl_FragColor=float(texture2D(f,e).a>0.)*I;}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform vec4 I;varying vec2 e;void main(){gl_FragColor=(1.-texture2D(f,e).a)*texture2D(k,e).a*I;}",this.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform vec4 I;varying vec2 e;void main(){float a=float(texture2D(k,e).a>0.);gl_FragColor=(1.-texture2D(f,e).a)*a*I;}",this.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){if(texture2D(k,e).a==0.)discard;gl_FragColor=texture2D(f,e);}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u;attribute vec2 n;varying vec2 e;void main(){e=n,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT="precision highp float;uniform float q;uniform vec4 I;void main(){gl_FragColor=I*q;}",this.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u,_;attribute vec2 n;varying vec2 e;void main(){e=(_*vec3(n,1)).xy,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u,_,Ua;attribute vec2 n;varying vec2 e,xa;void main(){e=(_*vec3(n,1)).xy,xa=(Ua*vec3(n,1)).xy,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_GRADIENT_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f;uniform float q;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}void main(){vec2 a=aa(e);gl_FragColor=O(texture2D(f,a)*q);}",this.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f,k;uniform float q,G;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}void main(){vec2 a=aa(e);vec4 b=mix(texture2D(f,a),texture2D(k,a),G);gl_FragColor=O(b*q);}",this.GLSLX_SOURCE_IMAGE_FRAGMENT="precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q;varying vec2 e;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=j(f,e);a.rgb*=a.a,gl_FragColor=a*q;}",this.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G;varying vec2 e,xa;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=mix(j(f,e),j(k,xa),G);a.rgb*=a.a,gl_FragColor=a*q;}",this.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q,ya,za,ba,ca,Aa,Ba,Ca;varying vec2 e;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=j(f,e);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q;}",this.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT="precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G,ya,za,ba,ca,Aa,Ba,Ca;varying vec2 e,xa;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=mix(j(f,e),j(k,xa),G);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q;}",this.GLSLX_SOURCE_BLEND_MODE_FRAGMENT="precision highp float;uniform int l;uniform sampler2D f,k;uniform float q;varying vec2 e;float Na(vec3 a){return min(min(a.r,a.g),a.b);}float Za(vec3 a){return max(max(a.r,a.g),a.b);}float Va(vec3 a){return Za(a)-Na(a);}float Wa(vec3 a){return dot(a,vec3(.3,.59,.11));}vec3 _a(vec3 c,vec3 d){float b=Wa(d);vec3 a=c+(b-Wa(c));float g=Na(a),h=Za(a);a=g<0.?mix(vec3(b),a,b/(b-g)):h>1.?mix(vec3(b),a,(1.-b)/(h-b)):a;return a;}vec3 ib(vec3 a,vec3 b,vec3 g){float c=Va(a);vec3 d=vec3(0);if(c>0.){float h=Na(a),i=Va(b);d=(a-h)*i/c;}return _a(d,g);}void main(){vec4 m=texture2D(f,e)*q,t=texture2D(k,e);float c=m.a,a=t.a;vec3 b=t.rgb;if(c==0.)gl_FragColor=vec4(b,a);else{vec3 d=m.rgb,h=d*(1.-a)+b*(1.-c);if(l==2)h+=min(d*a,b*c);else if(l==3)h+=d*b;else if(l==4)h=max(vec3(0),d+b-c*a);else if(l==5){vec3 X=max(d*a,.003922),Y=(a-b)*c*step(.003922,a-b);h+=c*a*(1.-min(vec3(1),Y/X));}else if(l==6)h+=max(d*a,b*c);else if(l==7)h=d+b-d*b;else if(l==8)h=min(vec3(1),d+b);else if(l==9){vec3 ua=max(a*(c-d),.003922),va=b*c*step(.003922,b);h+=c*a*min(vec3(1),va/ua);}else if(l==10)h+=mix(c*a-2.*(a-b)*(c-d),2.*d*b,vec3(lessThanEqual(2.*b,vec3(a))));else if(l==12)h+=mix(2.*d*b,c*a-2.*(a-b)*(c-d),vec3(greaterThan(2.*d,vec3(c))));else if(l==13)h+=abs(b*c-d*a);else if(l==14)h+=d*a+b*c-2.*d*b;else{vec3 D=vec3(0),i=d,g=b;if(c>0.)i/=c;if(a>0.)g/=a;if(l==11){vec3 Ka=1.-g,J=(16.*g-12.)*g+3.,P=inversesqrt(g+1e-6)-1.,E=mix(J,P,vec3(greaterThan(g,vec3(.25))));E=mix(E,Ka,vec3(greaterThan(i,vec3(.5)))),D=g*(1.+E*(2.*i-1.));}else D=l==15?ib(i,g,g):l==16?ib(g,i,g):l==17?_a(i,g):l==18?_a(g,i):D;h+=c*a*D;}gl_FragColor=vec4(h,c+a-c*a);}}",this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w;vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u,_;uniform float Ja;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w,ja,o,p;const vec2 Xa=vec2(.0625,.0625);void ab(vec2 a){vec2 b=1./fa/Ja;o=(_*vec3(a,1)).xy,p=(_*vec3(a+Xa*b,1)).xy-o;}vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,ja=(_*vec3(a,1)).xy,ab(a),gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX="precision highp float;uniform mat3 u,_,Ua;uniform float Ja;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w,ja,o,z,p,C;const vec2 Xa=vec2(.0625,.0625);void ab(vec2 a){vec2 b=1./fa/Ja;o=(_*vec3(a,1)).xy,p=(_*vec3(a+Xa*b,1)).xy-o;}void pb(vec2 a){vec2 b=1./fa/Ja;z=(Ua*vec3(a,1)).xy,C=(Ua*vec3(a+Xa*b,1)).xy-z;}vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,ja=(_*vec3(a,1)).xy,ab(a),pb(a),gl_Position=vec4(u*vec3(n,1),0).xywz;}",this.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform float q;uniform int A;uniform vec2 Q,R;uniform vec4 I,S,T;varying vec2 w;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float a=H(w);gl_FragColor=I*q*a;}`,this.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f;uniform float q;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,ja;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float a=H(w);vec2 b=aa(ja);gl_FragColor=O(texture2D(f,b)*q)*a;}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f,k;uniform float q,G;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,ja;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float b=H(w);vec2 a=aa(ja);vec4 c=mix(texture2D(f,a),texture2D(k,a),G);gl_FragColor=O(c*q)*b;}`,this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,p;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 a=ga();a.rgb*=a.a,gl_FragColor=a*q*H(w);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,z,p,C;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}vec4 Pa(){return (j(k,z+ka*C)+j(k,z+la*C)+j(k,z+ma*C)+j(k,z+na*C)+j(k,z+oa*C)+j(k,z+pa*C)+j(k,z+qa*C)+j(k,z+ra*C))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 b=ga(),c=Pa(),a=mix(b,c,G);a.rgb*=a.a,gl_FragColor=a*q*H(w);}`,this.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f;uniform bool L,M;uniform float q,ya,za,ba,ca,Aa,Ba,Ca;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,p;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 a=ga();a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q*H(w);}`,this.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float q,G,ya,za,ba,ca,Aa,Ba,Ca;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,z,p,C;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*p)+j(f,o+la*p)+j(f,o+ma*p)+j(f,o+na*p)+j(f,o+oa*p)+j(f,o+pa*p)+j(f,o+qa*p)+j(f,o+ra*p))/8.;}vec4 Pa(){return (j(k,z+ka*C)+j(k,z+la*C)+j(k,z+ma*C)+j(k,z+na*C)+j(k,z+oa*C)+j(k,z+pa*C)+j(k,z+qa*C)+j(k,z+ra*C))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 b=ga(),c=Pa(),a=mix(b,c,G);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*q*H(w);}`,this.GLSLX_NAME_U_TEXTURE0="f",this.GLSLX_NAME_U_TEXTURE1="k",this.GLSLX_NAME_U_TYPE="l",this.GLSLX_NAME_A_POSITION2="n",this.GLSLX_NAME_U_OPACITY="q",this.GLSLX_NAME_U_QUAD="s",this.GLSLX_NAME_U_VERTEX_TRANSFORM="u",this.GLSLX_NAME_U_COUNT="v",this.GLSLX_NAME_U_BLUR_CLAMP="y",this.GLSLX_NAME_U_SHAPE_TYPE="A",this.GLSLX_NAME_U_BLUR_DELTA="F",this.GLSLX_NAME_U_PROGRESS="G",this.GLSLX_NAME_U_COLOR="I",this.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS="L",this.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS="M",this.GLSLX_NAME_U_ELLIPSE_CENTER="Q",this.GLSLX_NAME_U_ELLIPSE_RADII="R",this.GLSLX_NAME_U_RECT="S",this.GLSLX_NAME_U_CORNER_RADII="T",this.GLSLX_NAME_U_BLUR_RADIUS="Z",this.GLSLX_NAME_U_PAINT_TRANSFORM0="_",this.GLSLX_NAME_U_GLOBAL_SHADOWS="ba",this.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS="ca",this.GLSLX_NAME_U_PATH_SIZE="fa",this.GLSLX_NAME_A_POSITION4="ha",this.GLSLX_NAME_U_TEXTURE_PX="ia",this.GLSLX_NAME_U_MASK_TEXTURE="sa",this.GLSLX_NAME_U_GLOBAL_TINT="ya",this.GLSLX_NAME_U_GLOBAL_COLOR="za",this.GLSLX_NAME_U_GLOBAL_EXPOSURE="Aa",this.GLSLX_NAME_U_GLOBAL_TEMPERATURE="Ba",this.GLSLX_NAME_U_GLOBAL_CONTRAST="Ca",this.GLSLX_NAME_U_PIXEL_RATIO="Ja",this.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS="La",this.GLSLX_NAME_U_SOURCE="Ma",this.GLSLX_NAME_U_UV_SCALE="Oa",this.GLSLX_NAME_U_STROKE_PROPORTION="Qa",this.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT="Ra",this.GLSLX_NAME_U_TEXTURE0_UV_SPACE_SCISSOR="Sa",this.GLSLX_NAME_U_TEXTURE1_UV_SPACE_SCISSOR="Ta",this.GLSLX_NAME_U_PAINT_TRANSFORM1="Ua",this.GLSLX_NAME_U_HOTSPOT_OPACITY="bb",this.GLSLX_NAME_U_TEXTURE_SIZE="db",this.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT="eb",this.GLSLX_NAME_U_DESTINATION_RECT="fb",this.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS="gb",this.GLSLX_NAME_A_COORD4="jb",this.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT="kb",this.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM="mb",this.GLSLX_NAME_A_COORD3="nb")}static instance(){return i._instance||(i._instance=new i),i._instance}};var C;(ne=>{function i(W){return W&255}ne.red=i;function e(W){return W>>8&255}ne.green=e;function t(W){return W>>16&255}ne.blue=t;function r(W){return W>>>24}ne.alpha=r;function n(W){return i(W)/255}ne.redF=n;function o(W){return e(W)/255}ne.greenF=o;function a(W){return t(W)/255}ne.blueF=a;function s(W){return r(W)/255}ne.alphaF=s;function l(W,K){return y(i(W),e(W),t(W),K)}ne.withAlpha=l;function c(W){let K=s(W);return I(n(W)*K,o(W)*K,a(W)*K,K)}ne.premultiplied=c;function d(W){let K=s(W);return I(n(W)/K,o(W)/K,a(W)/K,K)}ne.unpremultiplied=d;function h(W,K){return W&16777215|A(s(W)*K)<<24}ne.multiplyOpacity=h;function u(W){let K=1-s(W)+s(W)*n(W),j=1-s(W)+s(W)*o(W),ge=1-s(W)+s(W)*a(W);return I(K,j,ge,1)}ne.rgbaToRgb=u;function m(W){return`Color(${i(W)}, ${e(W)}, ${t(W)}, ${r(W)})`}ne.toString=m;function g(W){return r(W)==255}ne.isOpaque=g;function _(W){return"#"+G(i(W))+G(e(W))+G(t(W))}ne.toCSS=_;function f(W){return{red:n(W),green:o(W),blue:a(W),alpha:s(W)}}ne.toColorF=f;function S(W){return{r:i(W),g:e(W),b:t(W),a:r(W)}}ne.asInttoJSON=S;function b(W){return{r:n(W),g:o(W),b:a(W),a:s(W)}}ne.asFloattoJSON=b;function T(W,K,j){return y(W,K,j,255)}ne.new1=T;function y(W,K,j,ge){return W|K<<8|j<<16|ge<<24}ne.new2=y;function I(W,K,j,ge){return y(A(W),A(K),A(j),A(ge))}ne.new3=I;function p(W){return I(W.red,W.green,W.blue,W.alpha)}ne.fromColorF=p;function A(W){return W<0?0:W>=1?255:Math.round(W*255)|0}ne._clamp=A;function v(W,K,j){return I(n(W)+(n(K)-n(W))*j,o(W)+(o(K)-o(W))*j,a(W)+(a(K)-a(W))*j,s(W)+(s(K)-s(W))*j)}ne.mix=v;function E(W,K){let j=s(W),ge=s(K),Ue=j*(1-ge),Tt=Ue+ge,$e=Ue/Tt,xt=ge/Tt;return I(n(W)*$e+n(K)*xt,o(W)*$e+o(K)*xt,a(W)*$e+a(K)*xt,Tt)}ne.blend=E;function D(W,K){return I(n(W)*(1-s(K))+n(K),o(W)*(1-s(K))+o(K),a(W)*(1-s(K))+a(K),s(W)*(1-s(K))+s(K))}ne.over=D;function G(W){let K=W.toString(16);return(K.length==1?"0"+K:K).toUpperCase()}ne.asCSSComponent=G,ne.TRANSPARENT=y(0,0,0,0),ne.BLACK=T(0,0,0),ne.WHITE=T(255,255,255),ne.RED=T(255,0,0),ne.GREEN=T(0,255,0),ne.BLUE=T(0,0,255),ne.YELLOW=T(255,255,0),ne.CYAN=T(0,255,255),ne.MAGENTA=T(255,0,255)})(C||(C={}));var on=class i{constructor(e){e?(this._capacity=0,this._bytes=e,this._count=this._capacity=e.length,this._view=new DataView(e.buffer,e.byteOffset,e.length)):(this._count=0,this._capacity=256,this._bytes=new Uint8Array(this._capacity),this._view=new DataView(this._bytes.buffer))}clear(){this._count=0}clone(){return new i(new Uint8Array(this.bytes()))}isEmpty(){return this._count==0}byteCount(){return this._count}bytes(){return this._bytes.subarray(0,this._count)}floatAt(e){return this._view.getFloat32(e,!0)}byteAt(e){return this._bytes[e]}appendFloat(e){return this._count+4>this._capacity&&this._grow(this._count+4),this._view.setFloat32(this._count,e,!0),this._count=this._count+4,this}appendByte(e){return this._count+1>this._capacity&&this._grow(this._count+1),this._bytes[this._count]=e,this._count=this._count+1,this}prependBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(this.bytes(),t),this._bytes.set(e.bytes()),this._count=this._count+t,this}appendBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(e.bytes(),this._count),this._count=this._count+t,this}setFloatAt(e,t){this._view.setFloat32(e,t,!0)}_grow(e){this._capacity=e*2;let t=new Uint8Array(this._capacity);this._bytes!=null&&t.set(this._bytes),this._bytes=t,this._view=new DataView(t.buffer)}},yd;(e=>{function i(t,r){if(t==null||r==null||t.byteCount()!=r.byteCount())return!1;for(let n=0,o=t.byteCount();n<o;n=n+1)if(t.byteAt(n)!=r.byteAt(n))return!1;return!0}e.FrozenDataArray_equals=i})(yd||(yd={}));var Td;(e=>{function i(t,r){let n=Array.from(t);return Or(n,Array.from(r)),new Uint8Array(n)}e.concat=i})(Td||(Td={}));var Yf;(e=>{function i(t,r){if(t.byteLength!=r.byteLength)return!1;for(let n=0,o=t.byteLength;n<o;n=n+1)if(t[n]!=r[n])return!1;return!0}e.Uint8Array_equals=i})(Yf||(Yf={}));var vd;(e=>{function i(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}e.DataView_new1=i})(vd||(vd={}));var Id;(h=>{function i(u,m){if(m.value+1>u.length)return null;let g=new fe(u[m.value]);return m.value=m.value+1,g}h._read8=i;function e(u,m,g){if(m.value+2>u.length)return null;let _=u[m.value],f=u[m.value+1];return m.value=m.value+2,new fe(g==1?_|f<<8:f|_<<8)}h._read16=e;function t(u,m,g){if(m.value+2>u.length)return null;let _=u[m.value],f=u[m.value+1],S=u[m.value+2],b=u[m.value+3];return m.value=m.value+4,new fe(g==1?_|f<<8|S<<16|b<<24:b|S<<8|f<<16|_<<24)}h._read32=t;function r(u){let m=[255,216,255];if(u.length<m.length)return null;for(let _=0,f=m.length;_<f;_=_+1)if(m[_]!=u[_])return null;let g=new fe(2);for(;g.value+4<=u.length;){let _=e(u,g,0);if(_==null||_.value>>8!=255)return null;let f=e(u,g,0);if(f==null||f.value<2)return null;if(g.value=g.value-2,_.value==65505){let S=n(u,g.value);if(S!=null)return S}g.value=g.value+f.value}return null}h.readFromJPEG=r;function n(u,m){let g=new fe(m),_=e(u,g,0);if(_==null||_.value<6)return null;let f=t(u,g,0);if(f==null||f.value!=1165519206)return null;let S=e(u,g,0);if(S==null||S.value!=0)return null;let b=t(u,g,0);if(b==null||b.value!=1229531648&&b.value!=1296891946)return null;let y=b.value==1229531648?1:0,I=t(u,g,y);if(I==null)return null;g.value=g.value+I.value-8;let p=e(u,g,y);if(p==null)return null;let A=p.value,v=-1;for(let E=0;E<A;E=E+1){let D=e(u,g,y);if(D==null)break;let G=D.value,U=e(u,g,y);if(U==null)break;let M=U.value,z=t(u,g,y);if(z==null)break;let B=z.value,w=new fe(g.value);if(g.value=g.value+4,!(G!=h.EXIF_TAG_ORIENTATION||B!=1)){if(M==h.EXIF_FORMAT_BYTE){let P=i(u,w);if(P==null)return null;v=P.value}else if(M==h.EXIF_FORMAT_SHORT){let P=e(u,w,y);if(P==null)return null;v=P.value}else if(M==h.EXIF_FORMAT_LONG||M==h.EXIF_FORMAT_SLONG){let P=t(u,w,y);if(P==null)return null;v=P.value}else continue;switch(v){case 1:return new fe(0);case 6:return new fe(1);case 3:return new fe(2);case 8:return new fe(3);case 2:return new fe(4);case 5:return new fe(5);case 4:return new fe(6);case 7:return new fe(7)}}}return null}h._decodeExifOrientation=n;let o;(g=>(g[g.BIG=0]="BIG",g[g.LITTLE=1]="LITTLE"))(o=h.Endianness||(h.Endianness={})),h.EXIF_TAG_ORIENTATION=274,h.EXIF_FORMAT_BYTE=1,h.EXIF_FORMAT_SHORT=3,h.EXIF_FORMAT_LONG=4,h.EXIF_FORMAT_SLONG=9})(Id||(Id={}));var xl;(t=>{function i(r){switch(r){case 0:case 4:return 0;case 1:case 5:return 90;case 2:case 6:return 180;case 3:case 7:return 270;default:return 0}}t.ImageOrientation_rotationDegrees=i;function e(r){return r==4||r==5||r==6||r==7}t.ImageOrientation_shouldFlip=e})(xl||(xl={}));var Ed=class{seconds(){return Pa.Performance_now(_o().performance)/1e3}milliseconds(){return Pa.Performance_now(_o().performance)}constructor(){}};var Ts=class{reset(){this._seconds=0}advanceSeconds(e){this._seconds+=e}seconds(){return this._seconds}milliseconds(){return this._seconds*1e3}constructor(){this._seconds=0}},We;(a=>{function i(s){a._implementations.push(s)}a.dangerouslyPushMockTime=i;function e(){if(a._implementations.length==1)throw new Error("Popping last time implementation");ce.List_removeLast(a._implementations)}a.popMockTime=e;function t(){return ce.List_last(a._implementations).seconds()}a.seconds=t;function r(){return ce.List_last(a._implementations).milliseconds()}a.milliseconds=r;function n(s){let l=t(),c=t();for(;c-l<s;)c=t()}a.spin=n,a._implementations=[new Ed]})(We||(We={}));var yh=class{constructor(e){this._byteLength=0,this._cachedPx=null,this._cachedFrameIdx=null,this._byteLength=e,this._cachedPx=new Uint8Array(this._byteLength)}save(e,t){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(this._cachedPx.set(t),this._cachedFrameIdx=new fe(e))}saveEmpty(e){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(e!=0&&Le("Saving empty frame for idx \u2260 0"),this._cachedPx.fill(0),this._cachedFrameIdx=new fe(e))}getLastNonDisposedFrame(){return this._cachedFrameIdx==null&&Le("Attempting to get cached non-disposed frame while cache index has not been set"),this._cachedPx}},Do=class Do{constructor(e){this._width=0,this._height=0,this._frameCount=0,this._loopCount=0,this._currentLoop=0,this._frameByteLength=0,this._buf=null,this._frameInfos=null,this._startedPlayingMs=-1,this._currentFrame=-1,this._desiredFrameStartTimeMs=0,this._currentFramePx=null,this._prevDisposal=0,this._needPreviousFrame=!1,this._previousFrameCache=null,this._width=e.width,this._height=e.height,this._frameCount=e.frameCount,this._loopCount=e.loopCount,this._frameByteLength=this._width*this._height*4,this._buf=e.buf,this._frameInfos=e.frameInfos,this._currentFramePx=new Uint8Array(this._frameByteLength),this._needPreviousFrame=e.needLastNonDisposed,this._needPreviousFrame&&(this._previousFrameCache=new yh(this._frameByteLength))}width(){return this._width}height(){return this._height}frameCount(){return this._frameCount}loopCount(){return this._loopCount}loopsForever(){return this._loopCount==0}frameInfo(e){return(e<0||e>=this._frameInfos.length)&&Do.fail("Frame index out of range."),this._frameInfos[e]}_shouldAdvance(){if(!this.loopsForever()&&this._currentFrame==this._frameCount-1&&(this._loopCount==-1||this._loopCount==this._currentLoop))return Do.ShouldAdvance.NO;if(this._startedPlayingMs<0)return this._startedPlayingMs=We.milliseconds(),Do.ShouldAdvance.ONCE;let e=this.loopsForever()?Do.ShouldAdvance.UNTIL_CAUGHT_UP:Do.ShouldAdvance.ONCE;return We.milliseconds()-this._startedPlayingMs>=this._desiredFrameStartTimeMs?e:Do.ShouldAdvance.NO}_advanceFrame(){this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=St.int_remainder(this._currentFrame,this._frameCount));let e=this.frameInfo(this._currentFrame).delay*10;return e<=10&&(e=100),this._desiredFrameStartTimeMs+=e,this._blitFrame()}nextFrameIfNecessary(){let e=this._shouldAdvance();if(e==Do.ShouldAdvance.NO)return null;let t=We.milliseconds(),r=this._advanceFrame();if(e==Do.ShouldAdvance.UNTIL_CAUGHT_UP)for(;this._shouldAdvance()!=Do.ShouldAdvance.NO;){if(We.milliseconds()-t>=16){this._desiredFrameStartTimeMs=We.milliseconds()+this.frameInfo(this._currentFrame).delay*10-this._startedPlayingMs;break}r=this._advanceFrame()}return r}nextFrameForTesting(){return this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=St.int_remainder(this._currentFrame,this._frameCount)),this._blitFrame()}restart(){this._startedPlayingMs=-1,this._desiredFrameStartTimeMs=0,this._currentFrame=-1,this._currentLoop=0}toString(){let e=n=>"["+n.map(o=>`${o}`).join(", ")+"]",t=this._loopCount==0?"infinite":`${this._loopCount}`,r=this._frameInfos.map(n=>n.disposal);return ce.List_removeDuplicates(r),`GIF
 size: ${this._width} x ${this._height}
 loopCount: ${t}
 frameCount: ${this._frameCount}
 disposals: ${e(r)}`}_forEachRowIndexPairInSubrect(e,t){for(let r=e.y,n=e.y+e.height;r<n;r=r+1){let o=this.width()*4*r;t(o+e.x*4,o+(e.x+e.width)*4)}}_clearLastFrameToBackground(){let e=this._currentFrame>0?this._frameInfos[this._currentFrame-1]:null;e==null||e.width==this.width()&&e.height==this.height()?this._currentFramePx.fill(0):this._forEachRowIndexPairInSubrect(e,(t,r)=>{this._currentFramePx.subarray(t,r).fill(0)})}_blitFrame(){let e=this._frameInfos[this._currentFrame];if(this._currentFrame==0)this._clearLastFrameToBackground();else switch(this._prevDisposal){case 0:case 1:break;case 2:{this._clearLastFrameToBackground();break}case 3:{let g=this._currentFrame>0?this._currentFrame-1:this._frameCount-1,_=this._frameInfos[g],f=this._previousFrameCache.getLastNonDisposedFrame();_==null||f==null?this._clearLastFrameToBackground():_.width==this.width()&&_.height==this.height()?this._currentFramePx.set(f):this._forEachRowIndexPairInSubrect(_,(S,b)=>{let T=this._currentFramePx.subarray(S,b),y=f.subarray(S,b);T.set(y)});break}default:{console.error(`Disposal flag ${this._prevDisposal} not recognized`);break}}let t=e.width*e.height,r=new Uint8Array(t);this._LZWOutputIndexStream(this._buf,e.dataOffset,r,t);let n=e.paletteOffset,o=e.transparentIndex,a=e.width,s=this.width()-a,l=a,c=(e.y*this.width()+e.x)*4,d=((e.y+e.height)*this.width()-(this.width()-e.width-e.x))*4,h=c,u=s*4;e.interlaced&&(u=u+this.width()*4*7);let m=8;for(let g=0,_=r.length;g<_;g=g+1){let f=r[g];if(l==0&&(h=h+u,l=a,h>=d&&(u=s*4+this.width()*4*(m-1),h=c+(a+s)*(m<<1),m>>=1)),f==o)h=h+4;else{let S=this._buf[n+f*3],b=this._buf[n+f*3+1],T=this._buf[n+f*3+2];this._currentFramePx[h++]=S,this._currentFramePx[h++]=b,this._currentFramePx[h++]=T,this._currentFramePx[h++]=255}l=l-1}return this._prevDisposal=e.disposal,this._needPreviousFrame&&(this._prevDisposal<2?this._previousFrameCache.save(this._currentFrame,this._currentFramePx):this._currentFrame==0&&this._previousFrameCache.saveEmpty(this._currentFrame)),this._currentFramePx}_LZWOutputIndexStream(e,t,r,n){let o=e[t++],a=1<<o,s=a+1,l=s+1,c=o+1,d=(1<<c)-1,h=0,u=0,m=0,g=e[t++],_=new Int32Array(4096),f=-1;for(;;){for(;h<16&&g!=0;)u|=e[t++]<<h,h=h+8,g==1?g=e[t++]:g=g-1;if(h<c)break;let S=u&d;if(u>>=c,h=h-c,S==a){l=s+1,c=o+1,d=(1<<c)-1,f=-1;continue}else if(S==s)break;let b=S<l?S:f,T=0,y=b;for(;y>a;)y=_[y]>>8,T=T+1;let I=y;if(m+T+(b!=S?1:0)>n){console.warn("Warning, gif stream longer than expected.");return}r[m++]=I,m=m+T;let A=m;for(b!=S&&(r[m++]=I),y=b;(T=T-1)- -1!=0;)y=_[y],r[A=A-1]=y&255,y>>=8;f!=-1&&l<4096&&(_[l++]=f<<8|I,l>=d+1&&c<12&&(c=c+1,d=d<<1|1)),f=S}if(m!=n){console.warn("Warning, gif stream shorter than expected.");return}}decodedSize(){return this._buf.length}static fail(e){throw new Error(e)}};Do.DEBUG_LOG=!1;var an=Do;(r=>{let i;(s=>(s[s.ONCE=0]="ONCE",s[s.UNTIL_CAUGHT_UP=1]="UNTIL_CAUGHT_UP",s[s.NO=2]="NO"))(i=r.ShouldAdvance||(r.ShouldAdvance={}));class e{constructor(o,a,s,l,c,d,h){this.width=o,this.height=a,this.frameCount=s,this.loopCount=l,this.buf=c,this.frameInfos=d,this.needLastNonDisposed=h}}r.DecodeResult=e;class t{toString(){return`Frame [x=${this.x}, y=${this.y}] [w=${this.width}, h=${this.height}] [delay=${this.delay}] [localPalette=${this.hasLocalPalette}] [interlaced=${this.interlaced}]`}constructor(o,a,s,l,c,d,h,u,m,g,_,f,S){this.x=o,this.y=a,this.width=s,this.height=l,this.hasLocalPalette=c,this.paletteOffset=d,this.paletteSize=h,this.dataOffset=u,this.dataLength=m,this.transparentIndex=g,this.interlaced=_,this.delay=f,this.disposal=S}}r.Frame=t})(an||(an={}));var Lt=class{static didEncounterNestedBBNotInDirtyNodes(){this.encounteredNestedBBNotInDirtyNodes||(this.encounteredNestedBBNotInDirtyNodes=!0)}static didEncounterStaticRenderTreeAnimationOpt(){this.encounteredStaticRenderTreeAnimationOpt||(this.encounteredStaticRenderTreeAnimationOpt=!0)}static didEncounterRoundedRectOptimization(){this.encounteredRoundedRectOptimization||(this.encounteredRoundedRectOptimization=!0)}static didEncounterCullTreesDuringTilePrioritization(){this.encounteredCullTreesDuringTilePrioritization||(this.encounteredCullTreesDuringTilePrioritization=!0)}static didEncounterBackgroundBlurBoundsOpt(){this.encounteredBackgroundBlurBoundsOpt||(this.encounteredBackgroundBlurBoundsOpt=!0)}static didEncounterCTGEqualWithinBounds(){this.encounteredCTGEqualWithinBounds||(this.encounteredCTGEqualWithinBounds=!0)}static didEncounterICCacheOpt(){this.encounteredICCacheOpt||(this.encounteredICCacheOpt=!0)}static didEncounterTimeSlicedIFLMessage(){this.encounteredTimeSlicedIFLMessage||(this.encounteredTimeSlicedIFLMessage=!0)}static didEncounterIntraTileInterruptOpt(){this.encounteredIntraTileInterruptOpt||(this.encounteredIntraTileInterruptOpt=!0)}static didEncounterCreateVideoTriggers(){this.encounteredCreateVideoTriggers||(this.encounteredCreateVideoTriggers=!0)}static didEncounterLargeTilesForDrawToScreen(){this.encounteredLargeTilesForDrawToScreen||(this.encounteredLargeTilesForDrawToScreen=!0)}static didEncounterCreateImageBitmap(){this.encounteredCreateImageBitmap||(this.encounteredCreateImageBitmap=!0)}static encounteredStatsigEvaluation(e){this.statsigValidationKey==null&&(this.statsigValidationKey="statSigValidation-"+e)}static getAndResetOptimizationExposures(){let e=new Map;return X.optimizationExposureLogging()&&(this.encounteredRoundedRectOptimization&&e.set("rndMask",!!X.roundedMaskOptimization()),this.encounteredCullTreesDuringTilePrioritization&&e.set("culltrees",!!X.cullTreesDuringTilePrioritization()),this.encounteredNestedBBNotInDirtyNodes&&e.set("nestedBBNotDirty",!!X.viewerSkipNotDirtyTreeOpt()),this.encounteredBackgroundBlurBoundsOpt&&e.set("bblurbounds",!!X.backgroundBlurBoundsOpt()),this.encounteredCTGEqualWithinBounds&&e.set("ctgequal",!!X.compositeTileGridEqualWithinBounds()),this.encounteredStaticRenderTreeAnimationOpt&&e.set("staticTree",!!X.useStaticRenderTreeIfNonAnimatingSubtree()),this.encounteredICCacheOpt&&e.set("icCache",!!X.viewerICCacheOpt()),this.encounteredTimeSlicedIFLMessage&&e.set("timeSliceIFL",!!X.prototypeIFLTimeSlice()),this.encounteredIntraTileInterruptOpt&&e.set("intraTile",!!X.enableIntraTileInterrupts()),this.encounteredCreateVideoTriggers&&e.set("videoTriggers",!!X.viewerCreateVideoTriggersOpt()),this.encounteredLargeTilesForDrawToScreen&&e.set("largeTiles",!!X.viewerLargeTilesDrawToScreen()),this.encounteredCreateImageBitmap&&e.set("bitmap",!!X.enableCreateImageBitmap()),this.statsigValidationKey!=null&&e.set(this.statsigValidationKey,!1)),this.encounteredRoundedRectOptimization=!1,this.encounteredCullTreesDuringTilePrioritization=!1,this.encounteredNestedBBNotInDirtyNodes=!1,this.encounteredBackgroundBlurBoundsOpt=!1,this.encounteredCTGEqualWithinBounds=!1,this.encounteredStaticRenderTreeAnimationOpt=!1,this.encounteredICCacheOpt=!1,this.encounteredTimeSlicedIFLMessage=!1,this.encounteredIntraTileInterruptOpt=!1,this.encounteredCreateVideoTriggers=!1,this.encounteredLargeTilesForDrawToScreen=!1,this.encounteredCreateImageBitmap=!1,this.statsigValidationKey=null,e}};Lt.encounteredRoundedRectOptimization=!1,Lt.encounteredCullTreesDuringTilePrioritization=!1,Lt.encounteredNestedBBNotInDirtyNodes=!1,Lt.encounteredBackgroundBlurBoundsOpt=!1,Lt.encounteredCTGEqualWithinBounds=!1,Lt.encounteredStaticRenderTreeAnimationOpt=!1,Lt.encounteredICCacheOpt=!1,Lt.encounteredTimeSlicedIFLMessage=!1,Lt.encounteredIntraTileInterruptOpt=!1,Lt.encounteredCreateVideoTriggers=!1,Lt.encounteredLargeTilesForDrawToScreen=!1,Lt.encounteredCreateImageBitmap=!1,Lt.statsigValidationKey=null;var Pl=class{constructor(e){this.status=e}},Zn=class{state(){return this._state}get(){return this.send3("GET")}put(){return this.send3("PUT")}head(){return this.send3("HEAD")}setProgressCallback(e){this._progressCallback=e}header(e,t){return this._headers.set(e,t),this}format(e){return this._format=e,this}send1(e,t,r){if(2==0)return this.send3(e);if(Nl==3){this._blob=t;for(let n of Array.from(r.keys()))this._headers.set(n,r.get(n));return this.send3(e)}else throw new Error("unimplemented")}send2(e,t){if(2==0)return this.send3(e);if(Nl==3)return this._blob=t,this.send3(e);throw new Error("unimplemented")}send3(e){if(2==0)return new Promise((t,r)=>{if(Xf==null){r(new Pl(0));return}let n=Xf(this._url);if(n==200){let o=new Cd;o.status=200,t(o)}else r(new Pl(n))});if(Nl==3){this._xhr.open(e,this._url);let t=null,r=null,n=new Promise((o,a)=>{t=o,r=a});n.then(null,o=>{this.cancel()});for(let o of Array.from(this._headers.keys()))this._xhr.setRequestHeader(o,this._headers.get(o));switch(this._format){case 1:{this._xhr.responseType="arraybuffer";break}}return this._xhr.onload=()=>{if(this._state==2)return;let o=new Cd;switch(o.status=this._xhr.status,o.contentType=this._xhr.getResponseHeader("Content-Type"),this._format){case 0:{o.text=this._xhr.response;break}case 1:{o.bytes=new Uint8Array(this._xhr.response);break}}t(o)},this._xhr.onprogress=o=>{this._state!=2&&this._progressCallback!=null&&o.lengthComputable&&this._progressCallback(o.loaded/o.total)},this._xhr.onloadend=()=>{r(new Pl(this._xhr.status))},this._formData!=null?this._xhr.send(this._formData):this._xhr.send(this._blob),this._state=1,n}else throw new Error("unimplemented")}cancel(){if(2!=0)if(Nl==3)this._state==1&&this._xhr.abort(),(this._state==0||this._state==1)&&(this._state=2);else throw new Error("unimplemented")}constructor(e){this._url=e,this._method=null,this._headers=new Map,this._state=0,this._format=0,this._progressCallback=null,this._xhr=new XMLHttpRequest,this._formData=null,this._blob=null}},Cd=class{mimeType(){let e=this.contentType!=null?this.contentType.indexOf(";"):-1;return e!=-1?this.contentType.slice(0,e):this.contentType}wasSuccessful(){return this.status>=200&&this.status<=299}constructor(){this.status=0,this.contentType=null,this.text=null,this.bytes=null}};var Xf=null;var jn=class{constructor(){this._state=0,this._promise=null,this._resolve=null,this._reject=null,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}realPromise(){return this._promise}then1(e){this.then2(e,null)}then2(e,t){this._promise.then(e,t)}resolve(e){return this._state==0&&(this._state=1,this._resolve(e)),this}reject(e){return this._state==0&&(this._state=2,this._reject(e)),this}state(){return this._state}},Rd=class Rd{constructor(){}};Rd.VOID=new Rd;var An=Rd;function Nd(i){Promise.resolve(An.VOID).then(e=>{i()})}var Jr=class Jr{width(){return this.texture()!=null?this.texture().width():this._decodedData!=null?this._decodedData.width:0}height(){return this.texture()!=null?this.texture().height():this._decodedData!=null?this._decodedData.height:0}constructor(e,t,r,n){this._compressedData=null,this._url=null,this._downloadUrl=null,this._hash=null,this._allowDownscaling=!0,this._imageType=1,this._gif=null,this._fetchAndDecodePromise=null,this._decodedData=null,this._texture=null,this._url=e,this._downloadUrl=e,this._imageType=t,this._hash=r,this._allowDownscaling=n,r!=null&&!Vn&&cr.getImageBatchURL()!=null&&Jf(r)}primeWithCompressedData(e){this._compressedData=e,this._downloadUrl=URL.createObjectURL(new Blob([this._compressedData]))}imageType(){return this._imageType}isGIF(){return this._imageType==0}gif(){return this._gif}url(){return this._url}hash(){return this._hash}state(){return this.isDecoded()?2:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==2?3:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==0?1:0}loadDidFail(){return this.state()==3}_fetchImageBytesForSlowDecode(){let e=new jn;return this._compressedData!=null?e.resolve(this._compressedData):new Zn(this._downloadUrl).format(1).get().then(t=>{t.wasSuccessful()?e.resolve(t.bytes):(console.error(`failed to fetch image '${this}'`),e.reject(0))},t=>{e.reject(0)}),e}decodedData(){return this._decodedData}texture(){return this._texture}setTexture(e){this._texture=e}isDecoded(){return this._gif!=null||this._decodedData!=null||this._texture!=null}fetchAndDecode(e,t,r){if(this._decodedData!=null){t(this._decodedData);return}let n=this._fetchAndDecodePromise!=null;n||(this._fetchAndDecodePromise=new jn),this._fetchAndDecodePromise.then2(t,r),!n&&(this._hash==null||cr.getImageBatchURL()==null?this._fetchAndDecode(e):Jf(this._hash).then2(o=>{this._fetchAndDecodePromise!=null&&(this._downloadUrl=o,this._fetchAndDecode(e))},o=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(o)}))}_fetchAndDecode(e){this._canUseFastFetchAndDecode()?this._fastFetchAndDecode(e):this._slowFetchAndDecode()}_canUseFastFetchAndDecode(){return Jr.browserSupportsFastImageDecoding()&&this._imageType==1}_fetchHTMLImageObject(){let e=new jn,t=Bn.HTMLDocument_createElementImage(document);return t.crossOrigin="anonymous",t.src=this._downloadUrl,t.onload=()=>{e.resolve(t)},t.onerror=()=>{e.reject(0)},e}_fastDecodeHelper(e,t){e.decode().then(r=>{if(this._fetchAndDecodePromise==null)return;if(t!=0){this._handleDecodeSuccess(_r.createFromImage(e.naturalWidth,e.naturalHeight,e));return}let n=document.createElement("canvas");if(!(this._allowDownscaling&&X.shouldApplyMobileOptimizations()))n.width=e.naturalWidth,n.height=e.naturalHeight;else{let s=Math.max(e.naturalWidth,e.naturalHeight),c=Math.min(2048,s)/s;n.width=Math.round(e.naturalWidth*c)|0,n.height=Math.round(e.naturalHeight*c)|0}let a=Xn.HTMLCanvasElement_getContext2D(n);a==null?(Jr.trackImageDecodeFailure("Canvas context creation failed"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)):(a.drawImage(e,0,0,n.width,n.height),this._handleDecodeSuccess(_r.createFromCanvas(n)))},r=>{Jr.trackImageDecodeFailure("Image.decode"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)})}_fastFetchAndDecode(e){this._fetchHTMLImageObject().then2(t=>{if(this._fetchAndDecodePromise==null)return;let r=e!=0&&Jr.browserSupportsCreateImageBitmap();r&&Lt.didEncounterCreateImageBitmap(),r&&X.enableCreateImageBitmap()?createImageBitmap(t,{premultiplyAlpha:"none"}).then(n=>{this._fetchAndDecodePromise!=null&&this._handleDecodeSuccess(_r.createFromImageBitmap(n.width,n.height,n))},n=>{Jr.trackImageDecodeFailure("createImageBitmap"),this._fastDecodeHelper(t,e)}):this._fastDecodeHelper(t,e)},t=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(0)})}_handleDecodeSuccess(e){this._fetchAndDecodePromise!=null&&(this._decodedData=e,this._imageType==0?(this._gif=new an(e.gif),_r.setRamInUse(Cr.increment("Decoded image data in RAM (MB)",1*this._gif.decodedSize()/(1024*1024)))):_r.setRamInUse(Cr.increment("Decoded image data in RAM (MB)",1*e.width*e.height*4/(1024*1024))),this._fetchAndDecodePromise.resolve(e),Cr.increment("# Decoded images",1))}_slowFetchAndDecode(){this._fetchImageBytesForSlowDecode().then2(e=>{this._fetchAndDecodePromise!=null&&_r.decodeImageBuffer(e,this._imageType).then(t=>{this._handleDecodeSuccess(t)},t=>{Jr.trackImageDecodeFailure("unknown"),console.error(`failed to load image '${this}'`),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)})},e=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(e)})}freeMemoryForDecodedData(){let e=!1;return this._decodedData!=null&&(Cr.increment("# Decoded images",-1),_r.setRamInUse(Cr.increment("Decoded image data in RAM (MB)",-1*this.width()*this.height()*4/(1024*1024))),this._decodedData=null,e=!0),e}freeMemoryForDecodedDataAndTexture(){let e=!1;return this.freeMemoryForDecodedData(),this._gif!=null&&(_r.setRamInUse(Cr.increment("Decoded image data in RAM (MB)",-1*this._gif.decodedSize()/(1024*1024))),this._gif=null,e=!0),this.texture()!=null&&(this.texture().deleteTexture(),this.setTexture(null),e=!0),this._fetchAndDecodePromise!=null&&(this._fetchAndDecodePromise.reject(2),this._fetchAndDecodePromise=null,e=!0),e}objectHash(){return`ImageResourceImpl(${this._url}, ${ea[this._imageType]})`}toString(){return`ImageResourceImpl(${this._url}, ${ea[this._imageType]})`}static browserSupportsCreateImageBitmap(){return Gt.chrome()||Gt.firefox()&&X.isBrowserVersionAtLeast("93")||Gt.safari()}static browserSupportsFastImageDecoding(){return(Gt.chrome()&&X.isBrowserVersionAtLeast("81")||Gt.firefox()&&X.isBrowserVersionAtLeast("77")||Gt.safari()&&!Gt.ios()&&X.isBrowserVersionAtLeast("13.1")||Gt.safari()&&Gt.ios()&&X.isBrowserVersionAtLeast("13.4")||Gt.safari()&&Gt.ios()&&X.isOSVersionAtLeast("13.4.1"))&&X.htmlImageDecodeMethodIsPresent()}static getEmojiImageUrl(e){let t=e.map(o=>o.toString(16)).join("-");return(X.getFeatureFlags().font_index_220528?"https://static.figma.com/emoji/4/160/":"https://static.figma.com/emoji/1/64/")+t+".png"}static createEmojiImage1(e){let t=e.map(r=>r.toString(16)).join("-");return Jr.createEmojiImage2(t)}static createEmojiImage2(e){let n=(X.getFeatureFlags().font_index_220528?"https://static.figma.com/emoji/4/160/":"https://static.figma.com/emoji/1/64/")+e+".png";return new Jr(n,1,null,!0)}static createDeviceImage(e){let t=e.url,r=_o().INITIAL_OPTIONS,n=r?r.cluster_name:"missing-cluster",o=t+`?cachebreaker=${n}`;return new Jr(o,1,null,!1)}static createImage(e,t,r){let n=Jr.bytesToHex(e),o=cr.getImagePrefixURL(),s=`${o.endsWith("/")?o:o+"/"}${n}`,l=new Jr(s,r,n,!0);return t!=null&&l.primeWithCompressedData(t),l}static bytesToHex(e){let t="";for(let r=0,n=e.length;r<n;r=r+1)t+=(e[r]|256).toString(16).slice(-2);return t}static hexToBytes(e){let t=[];for(let r=0;r<e.length;r=r+2)t.push(parseInt(e.substr(r,2),16));return new Uint8Array(t)}static trackImageDecodeFailure(e){Jr.numDecodeFailuresLogged>=Jr.LOG_MAX_DECODE_FAILURES||(De.trackEvent("image_decode_failed",{reason:e}),Jr.numDecodeFailuresLogged=Jr.numDecodeFailuresLogged+1)}};Jr.LOG_MAX_DECODE_FAILURES=3,Jr.numDecodeFailuresLogged=0;var Mr=Jr;function uT(){let i=cr.getImageBatchURL(),e=vh;vh=[],Th=0;let t=n=>{let o=new Zn(i),a=new Map,s=_o().INITIAL_OPTIONS.user_data;s&&a.set("x-figma-user-id",s.id),o.send1("POST",new Blob([JSON.stringify({sha1s:n})],{type:"application/json"}),a).then(c=>{if(!c.wasSuccessful()){for(let u of n){let m=i+":"+u;Lo.has(m)&&Lo.get(m).reject(0)}return}let d;try{d=JSON.parse(c.text)}catch(u){if(!(u instanceof SyntaxError))throw u;let m=new Error("ImageResource: Response was not valid JSON");throw m.sentryContext={response:c.text},m}let h=d.meta.s3_urls;for(let u of Object.keys(h)){let m=i+":"+u;if(Lo.has(m)){let g=Lo.get(m);g.state()==0&&g.resolve(h[u])}}for(let u of n)if(!(u in h)){let m=i+":"+u;Lo.has(m)&&Lo.get(m).reject(0)}},c=>{for(let d of n){let h=i+":"+d;Lo.has(h)&&(De.trackDefinedEvent("prototype.image_url_request_failed",{status:c.status}),Lo.get(h).reject(0))}})},r=200;for(let n=0;n<=((e.length-1)/r|0);n=n+1){let o=e.slice(n*r,Math.min((n+1)*r,e.length));t(o)}}function Jf(i){let e=cr.getImageBatchURL()+":"+i;return Lo.has(e)||(vh.push(i),Lo.set(e,new jn),Th==0&&(Th=setTimeout(()=>{uT()},0))),Lo.get(e)}var Th=0,vh=[],Lo=new Map;var Fl;(U=>{function i(M){return M<0?0:M>255?255:M}U._clip=i;function e(M){return i(M+64>>7)}U._CF=e;function t(M,z){let B=0,w=M[z+4]<<11,P=M[z+6],H=M[z+2],Q=M[z+1],Y=M[z+7],ne=M[z+5],W=M[z+3],K=0;if(!(w|P|H|Q|Y|ne|W)){let j=M[z]<<3;M[z]=j,M[z+1]=j,M[z+2]=j,M[z+3]=j,M[z+4]=j,M[z+5]=j,M[z+6]=j,M[z+7]=j;return}B=(M[z]<<11)+128,K=U._W7*(Q+Y),Q=K+(U._W1-U._W7)*Q,Y=K-(U._W1+U._W7)*Y,K=U._W3*(ne+W),ne=K-(U._W3-U._W5)*ne,W=K-(U._W3+U._W5)*W,K=B+w,B=B-w,w=U._W6*(H+P),P=w-(U._W2+U._W6)*P,H=w+(U._W2-U._W6)*H,w=Q+ne,Q=Q-ne,ne=Y+W,Y=Y-W,W=K+H,K=K-H,H=B+P,B=B-P,P=181*(Q+Y)+128>>8,Q=181*(Q-Y)+128>>8,M[z]=W+w>>8,M[z+1]=H+P>>8,M[z+2]=B+Q>>8,M[z+3]=K+ne>>8,M[z+4]=K-ne>>8,M[z+5]=B-Q>>8,M[z+6]=H-P>>8,M[z+7]=W-w>>8}U._rowInverseDCT=t;function r(M,z,B,w,P){let H=0,Q=M[z+8*4]<<8,Y=M[z+8*6],ne=M[z+8*2],W=M[z+8*1],K=M[z+8*7],j=M[z+8*5],ge=M[z+8*3],Ue=0;if(!(Q|Y|ne|W|K|j|ge)){let Tt=i((M[z]+32>>6)+128);for(let $e=8;$e!=0;$e=$e-1)B[w]=Tt,w=w+P;return}H=(M[z]<<8)+8192,Ue=U._W7*(W+K)+4,W=Ue+(U._W1-U._W7)*W>>3,K=Ue-(U._W1+U._W7)*K>>3,Ue=U._W3*(j+ge)+4,j=Ue-(U._W3-U._W5)*j>>3,ge=Ue-(U._W3+U._W5)*ge>>3,Ue=H+Q,H=H-Q,Q=U._W6*(ne+Y)+4,Y=Q-(U._W2+U._W6)*Y>>3,ne=Q+(U._W2-U._W6)*ne>>3,Q=W+j,W=W-j,j=K+ge,K=K-ge,ge=Ue+ne,Ue=Ue-ne,ne=H+Y,H=H-Y,Y=181*(W+K)+128>>8,W=181*(W-K)+128>>8,B[w]=i((ge+Q>>14)+128),w=w+P,B[w]=i((ne+Y>>14)+128),w=w+P,B[w]=i((H+W>>14)+128),w=w+P,B[w]=i((Ue+j>>14)+128),w=w+P,B[w]=i((Ue-j>>14)+128),w=w+P,B[w]=i((H-W>>14)+128),w=w+P,B[w]=i((ne-Y>>14)+128),w=w+P,B[w]=i((ge-Q>>14)+128)}U._colInverseDCT=r;let n;(H=>(H[H.OK=0]="OK",H[H.NO_JPEG=1]="NO_JPEG",H[H.UNSUPPORTED=2]="UNSUPPORTED",H[H.SYNTAX_ERROR=3]="SYNTAX_ERROR",H[H.FINISHED=4]="FINISHED"))(n=U.Result||(U.Result={}));class o{upsampleH(){let z=this.width-3,B=0,w=0,P=new Uint8Array(this.width*this.height*2);for(let H=this.height;H!=0;H=H-1){P[w]=e(U._CF2A*this.pixels[B]+U._CF2B*this.pixels[B+1]),P[w+1]=e(U._CF3X*this.pixels[B]+U._CF3Y*this.pixels[B+1]+U._CF3Z*this.pixels[B+2]),P[w+2]=e(U._CF3A*this.pixels[B]+U._CF3B*this.pixels[B+1]+U._CF3C*this.pixels[B+2]);for(let Q=0;Q<z;Q=Q+1)P[w+Q*2+3]=e(U._CF4A*this.pixels[B+Q]+U._CF4B*this.pixels[B+Q+1]+U._CF4C*this.pixels[B+Q+2]+U._CF4D*this.pixels[B+Q+3]),P[w+Q*2+4]=e(U._CF4D*this.pixels[B+Q]+U._CF4C*this.pixels[B+Q+1]+U._CF4B*this.pixels[B+Q+2]+U._CF4A*this.pixels[B+Q+3]);B=B+this.stride,w=w+this.width*2,P[w+-3]=e(U._CF3A*this.pixels[B-1]+U._CF3B*this.pixels[B-2]+U._CF3C*this.pixels[B-3]),P[w+-2]=e(U._CF3X*this.pixels[B-1]+U._CF3Y*this.pixels[B-2]+U._CF3Z*this.pixels[B-3]),P[w+-1]=e(U._CF2A*this.pixels[B-1]+U._CF2B*this.pixels[B-2])}this.width<<=1,this.stride=this.width,this.pixels=P}upsampleV(){let z=this.width,B=this.stride,w=B+B,P=new Uint8Array(this.width*this.height*2);for(let H=0;H<z;H=H+1){let Q=H,Y=H;P[Y]=e(U._CF2A*this.pixels[Q]+U._CF2B*this.pixels[Q+B]),Y=Y+z,P[Y]=e(U._CF3X*this.pixels[Q]+U._CF3Y*this.pixels[Q+B]+U._CF3Z*this.pixels[Q+w]),Y=Y+z,P[Y]=e(U._CF3A*this.pixels[Q]+U._CF3B*this.pixels[Q+B]+U._CF3C*this.pixels[Q+w]),Y=Y+z,Q=Q+B;for(let ne=this.height-3;ne!=0;ne=ne-1)P[Y]=e(U._CF4A*this.pixels[Q+-B]+U._CF4B*this.pixels[Q]+U._CF4C*this.pixels[Q+B]+U._CF4D*this.pixels[Q+w]),Y=Y+z,P[Y]=e(U._CF4D*this.pixels[Q+-B]+U._CF4C*this.pixels[Q]+U._CF4B*this.pixels[Q+B]+U._CF4A*this.pixels[Q+w]),Y=Y+z,Q=Q+B;Q=Q+B,P[Y]=e(U._CF3A*this.pixels[Q]+U._CF3B*this.pixels[Q-B]+U._CF3C*this.pixels[Q-w]),Y=Y+z,P[Y]=e(U._CF3X*this.pixels[Q]+U._CF3Y*this.pixels[Q-B]+U._CF3Z*this.pixels[Q-w]),Y=Y+z,P[Y]=e(U._CF2A*this.pixels[Q]+U._CF2B*this.pixels[Q-B])}this.height<<=1,this.stride=this.width,this.pixels=P}constructor(){this.id=0,this.ssx=0,this.ssy=0,this.width=0,this.height=0,this.stride=0,this.quantizationTableIndex=0,this.acTableIndex=0,this.dcTableIndex=0,this.dcPred=0,this.pixels=null}}U.Component=o;class a{constructor(){}}U.Stop=a;let s;(W=>(W[W.NONE=0]="NONE",W[W.ROTATE_0=1]="ROTATE_0",W[W.FLIP_ROTATE_0=2]="FLIP_ROTATE_0",W[W.ROTATE_180=3]="ROTATE_180",W[W.FLIP_ROTATE_180=4]="FLIP_ROTATE_180",W[W.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",W[W.ROTATE_90=6]="ROTATE_90",W[W.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",W[W.ROTATE_270=8]="ROTATE_270"))(s=U.Orientation||(U.Orientation={}));class l{constructor(){this._bitBuffer=0,this._bitCount=0,this._block=new Int32Array(64),this._bytes=null,this._componentCount=0,this._components=[],this._error=0,this._exifOrientation=1,this._height=0,this._heightInMacroBlocks=0,this._huffmanTable=[],this._length=0,this._macroBlockSizeX=0,this._macroBlockSizeY=0,this._offset=0,this._quantizationTable=[],this._restartInterval=0,this._rgb=null,this._size=0,this._width=0,this._widthInMacroBlocks=0,this._getVLC_code=0;for(let z=0;z<4;z=z+1)this._quantizationTable.push(new Uint8Array(64)),this._huffmanTable.push(new Uint16Array(65536)),this._components.push(new o)}_throw(z){throw this._error=z,new a}_showBits(z){if(z==0)return 0;for(;this._bitCount<z;){if(this._size<=0){this._bitBuffer=this._bitBuffer<<8|255,this._bitCount=this._bitCount+8;continue}let B=this._bytes[this._offset];if(this._offset=this._offset+1,this._size=this._size-1,this._bitCount=this._bitCount+8,this._bitBuffer=this._bitBuffer<<8|B,B==255){this._size==0&&this._throw(3);let w=this._bytes[this._offset];this._offset=this._offset+1,this._size=this._size-1,w==217?this._size=0:w!=0&&w!=255&&((w&248)!=208&&this._throw(3),this._bitBuffer=this._bitBuffer<<8|w,this._bitCount=this._bitCount+8)}}return this._bitBuffer>>this._bitCount-z&(1<<z)-1}_skipBits(z){this._bitCount<z&&this._showBits(z),this._bitCount=this._bitCount-z}_getBits(z){let B=this._showBits(z);return this._skipBits(z),B}_byteAlign(){this._bitCount&=248}_skip(z){this._offset=this._offset+z,this._size=this._size-z,this._length=this._length-z,this._size<0&&this._throw(3)}_decodeBig16(z){return this._bytes[z]<<8|this._bytes[z+1]}_decodeBig32(z){return this._bytes[z]<<24|this._bytes[z+1]<<16|this._bytes[z+2]<<8|this._bytes[z+3]}_decode16(z,B){return B==l.Endianness.LITTLE?this._bytes[z]|this._bytes[z+1]<<8:this._decodeBig16(z)}_decode32(z,B){return B==l.Endianness.LITTLE?this._bytes[z]|this._bytes[z+1]<<8|this._bytes[z+2]<<16|this._bytes[z+3]<<24:this._decodeBig32(z)}_decodeLength(){this._size<2&&this._throw(3),this._length=this._decodeBig16(this._offset),this._length>this._size&&this._throw(3),this._skip(2)}_skipMarker(){this._decodeLength(),this._skip(this._length)}_decodeSOF(){let z=0,B=0,w=null;this._decodeLength(),this._length<9&&this._throw(3),this._bytes[this._offset]!=8&&this._throw(2),this._height=this._decodeBig16(this._offset+1),this._width=this._decodeBig16(this._offset+3),this._componentCount=this._bytes[this._offset+5],this._skip(6),this._componentCount!=1&&this._componentCount!=3&&this._throw(2),this._length<this._componentCount*3&&this._throw(3);for(let P=0;P<this._componentCount;P=P+1)w=this._components[P],w.id=this._bytes[this._offset],w.ssx=this._bytes[this._offset+1]>>4,w.ssy=this._bytes[this._offset+1]&15,w.quantizationTableIndex=this._bytes[this._offset+2],(w.ssx==0||w.ssy==0||w.quantizationTableIndex&252)&&this._throw(3),(w.ssx&w.ssx-1||w.ssy&w.ssy-1)&&this._throw(2),this._skip(3),w.ssx>z&&(z=w.ssx),w.ssy>B&&(B=w.ssy);this._componentCount==1&&(w=this._components[0],w.ssx=w.ssy=z=B=1),this._macroBlockSizeX=z<<3,this._macroBlockSizeY=B<<3,this._widthInMacroBlocks=(this._width+this._macroBlockSizeX-1)/this._macroBlockSizeX|0,this._heightInMacroBlocks=(this._height+this._macroBlockSizeY-1)/this._macroBlockSizeY|0;for(let P=0;P<this._componentCount;P=P+1)w=this._components[P],w.width=(this._width*w.ssx+z-1)/z|0,w.height=(this._height*w.ssy+B-1)/B|0,w.stride=this._widthInMacroBlocks*this._macroBlockSizeX*w.ssx/z|0,(w.width<3&&w.ssx!=z||w.height<3&&w.ssy!=B)&&this._throw(2),w.pixels=new Uint8Array(w.stride*(this._heightInMacroBlocks*this._macroBlockSizeY*w.ssy/B|0));this._rgb=new Uint8Array(this._width*this._height*3),this._skip(this._length)}_decodeDHT(){for(this._decodeLength();this._length>=17;){let z=this._bytes[this._offset];z&236&&this._throw(3),z&2&&this._throw(2),z=(z|z>>3)&3;let B=new Uint8Array(16);for(let Y=1;Y<=16;Y=Y+1)B[Y-1]=this._bytes[this._offset+Y];this._skip(17);let w=this._huffmanTable[z],P=0,H=65536,Q=65536;for(let Y=1;Y<=16;Y=Y+1){Q>>=1;let ne=B[Y-1];if(ne!=0){this._length<ne&&this._throw(3),H=H-(ne<<16-Y),H<0&&this._throw(3);for(let W=0;W<ne;W=W+1){let K=this._bytes[this._offset+W];for(let j=Q;j!=0;j=j-1)P<65536&&(w[P]=Y<<8|K,P=P+1)}this._skip(ne)}}for(;H!=0;)H=H-1,P<65536&&(w[P]=w[P]&65280,P=P+1)}this._length!=0&&this._throw(3)}_decodeDQT(){for(this._decodeLength();this._length>=65;){let z=this._bytes[this._offset];z&252&&this._throw(3);let B=this._quantizationTable[z];for(let w=0;w<64;w=w+1)B[w]=this._bytes[this._offset+w+1];this._skip(65)}this._length!=0&&this._throw(3)}_decodeDRI(){this._decodeLength(),this._length<2&&this._throw(3),this._restartInterval=this._decodeBig16(this._offset),this._skip(this._length)}_getVLC(z){let B=this._showBits(16),w=z[B]>>8;return w==0&&this._throw(3),this._skipBits(w),B=z[B]&255,this._getVLC_code=B,w=B&15,w==0?0:(B=this._getBits(w),B<1<<w-1&&(B=B+((-1<<w)+1)),B)}_decodeBlock(z,B){let w=0;for(this._block=new Int32Array(64),z.dcPred=z.dcPred+this._getVLC(this._huffmanTable[z.dcTableIndex]),this._block[0]=z.dcPred*this._quantizationTable[z.quantizationTableIndex][0];w<63;){let P=this._getVLC(this._huffmanTable[z.acTableIndex]);if(this._getVLC_code==0)break;!(this._getVLC_code&15)&&this._getVLC_code!=240&&this._throw(3),w=w+((this._getVLC_code>>4)+1),w>63&&this._throw(3),this._block[U._zigZagTable[w]]=P*this._quantizationTable[z.quantizationTableIndex][w]}for(let P=0;P<64;P=P+8)t(this._block,P);for(let P=0;P<8;P=P+1)r(this._block,P,z.pixels,B+P,z.stride)}_decodeScan(){let z=this._restartInterval,B=0;this._decodeLength(),this._length<4+2*this._componentCount&&this._throw(3),this._bytes[this._offset]!=this._componentCount&&this._throw(2),this._skip(1);for(let w=0;w<this._componentCount;w=w+1){let P=this._components[w];this._bytes[this._offset]!=P.id&&this._throw(3),this._bytes[this._offset+1]&238&&this._throw(3),P.dcTableIndex=this._bytes[this._offset+1]>>4,P.acTableIndex=this._bytes[this._offset+1]&1|2,this._skip(2)}(this._bytes[this._offset]!=0||this._bytes[this._offset+1]!=63||this._bytes[this._offset+2]!=0)&&this._throw(2),this._skip(this._length);for(let w=0;w<this._heightInMacroBlocks;w=w+1)for(let P=0;P<this._widthInMacroBlocks;P=P+1){if((P!=0||w!=0)&&this._restartInterval!=0&&(z=z-1,z==0)){this._byteAlign();let H=this._getBits(16);((H&65528)!=65488||(H&7)!=B)&&this._throw(3),B=B+1&7,z=this._restartInterval;for(let Q=0;Q<4;Q=Q+1)this._components[Q].dcPred=0}for(let H=0;H<this._componentCount;H=H+1){let Q=this._components[H];for(let Y=0;Y<Q.ssy;Y=Y+1)for(let ne=0;ne<Q.ssx;ne=ne+1)this._decodeBlock(Q,(w*Q.ssy+Y)*Q.stride+P*Q.ssx+ne<<3)}}this._error=4}_decodeEXIF(){if(this._decodeLength(),this._length<6||this._decodeBig32(this._offset)!=1165519206||this._decodeBig16(this._offset+4)!=0){this._skip(this._length);return}this._skip(6);let z=this._offset;this._length<8&&this._throw(3);let B=this._decodeBig32(z),w=B==1229531648?l.Endianness.LITTLE:l.Endianness.BIG;w==l.Endianness.BIG&&B!=1296891946&&this._throw(3);let P=274,H=1,Q=3,Y=4,ne=9,W=z+this._decode32(z+4,w),K=this._decode16(W,w);W=W+2;for(let j=0,ge=K;j<ge;j=j+1){let Ue=this._decode16(W,w),Tt=this._decode16(W+2,w),$e=this._decode32(W+4,w);if(W=W+8,Ue==P&&$e==1){this._exifOrientation=0,Tt==H?this._exifOrientation=this._bytes[W]:Tt==Q?this._exifOrientation=this._decode16(W,w):(Tt==Y||Tt==ne)&&(this._exifOrientation=this._decode32(W,w)),(this._exifOrientation<1||this._exifOrientation>8)&&(this._exifOrientation=1);break}W=W+4}this._skip(this._length)}_convert(){for(let w=0;w<this._componentCount;w=w+1){let P=this._components[w];for(;P.width<this._width||P.height<this._height;)P.width<this._width&&P.upsampleH(),P.height<this._height&&P.upsampleV()}let z=this._components[0],B=this._rgb;if(this._componentCount==1){let w=0,P=0;for(let H=this._height;H!=0;H=H-1){for(let Q=0;Q<this._width;Q=Q+1){let Y=z.pixels[P+Q];B[w]=Y,B[w+1]=Y,B[w+2]=Y,w=w+3}P=P+z.stride}}else{let w=this._components[1],P=this._components[2],H=0,Q=0,Y=0,ne=0;for(let W=this._height;W!=0;W=W-1){for(let K=0;K<this._width;K=K+1){let j=z.pixels[Q+K]<<8,ge=w.pixels[Y+K]-128,Ue=P.pixels[ne+K]-128;B[H]=i(j+359*Ue+128>>8),B[H+1]=i(j-88*ge-183*Ue+128>>8),B[H+2]=i(j+454*ge+128>>8),H=H+3}Q=Q+z.stride,Y=Y+w.stride,ne=ne+P.stride}}}_orient(){if(this._exifOrientation==1)return;let z=this._width,B=this._height,w=this._exifOrientation>=5,P=w?B:z,H=w?z:B,Q=this._rgb,Y=new Uint8Array(P*H*3);for(let ne=0,W=0;ne<B;ne=ne+1){let K=0,j=0;switch(this._exifOrientation){case 2:{K=ne*P+P-1,j=-1;break}case 3:{K=(B-ne-1)*P+P-1,j=-1;break}case 4:{K=(B-ne-1)*P,j=1;break}case 5:{K=ne,j=P;break}case 6:{K=B-ne-1,j=P;break}case 7:{K=B-ne-1+P*(H-1),j=-P;break}case 8:{K=ne+P*(H-1),j=-P;break}}K=K*3,j=j*3;for(let ge=0;ge<z;ge=ge+1,W=W+3)Y[K]=Q[W],Y[K+1]=Q[W+1],Y[K+2]=Q[W+2],K=K+j}this._width=P,this._height=H,this._rgb=Y}decodeBytes(z){try{for(this._bytes=z,this._offset=0,this._size=z.length,(this._size<2||this._bytes[0]!=255||this._bytes[1]!=216)&&this._throw(1),this._skip(2);this._error==0;){(this._size<2||this._bytes[this._offset]!=255)&&this._throw(3),this._skip(2);let B=this._bytes[this._offset-1];B==192?this._decodeSOF():B==196?this._decodeDHT():B==219?this._decodeDQT():B==221?this._decodeDRI():B==218?this._decodeScan():B==225?this._decodeEXIF():B==254?this._skipMarker():(B&240)==224?this._skipMarker():this._throw(2)}this._error!=4?this._error=3:(this._convert(),this._orient(),this._error=0)}catch{}return this._error}width(){return this._width}height(){return this._height}rgb(){return this._rgb}}U.Decoder=l,(z=>{let M;(P=>(P[P.BIG=0]="BIG",P[P.LITTLE=1]="LITTLE"))(M=z.Endianness||(z.Endianness={}))})(l=U.Decoder||(U.Decoder={})),U._zigZagTable=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],U._W1=2841,U._W2=2676,U._W3=2408,U._W5=1609,U._W6=1108,U._W7=565,U._CF4A=-9,U._CF4B=111,U._CF4C=29,U._CF4D=-3,U._CF3A=28,U._CF3B=109,U._CF3C=-9,U._CF3X=104,U._CF3Y=27,U._CF3Z=-3,U._CF2A=139,U._CF2B=-11})(Fl||(Fl={}));var Fa=class{elapsedSeconds(){return We.seconds()-this._start}reset(){this._start=We.seconds()}constructor(){this._start=We.seconds()}};var Da=class i{constructor(e){this._worker=null,this._queue=[],this._workerFailedToDownload=!1,this.onmessage=null,this.mainThreadFallback=null;let t=()=>{this._workerFailedToDownload=!0,this.mainThreadFallback!=null&&console.warn(`failed to download worker code from ${e}, falling back to running it on the main thread (this is slower)`);for(let r of this._queue)this.postMessage2(r.message,r.transfer)};new Zn(e).get().then(r=>{if(r.wasSuccessful()){try{this._worker=new Worker(URL.createObjectURL(new Blob([r.text])))}catch{t();return}this._worker.onmessage=n=>{this.onmessage!=null&&this.onmessage(n)};for(let n of this._queue)this.postMessage2(n.message,n.transfer)}else t()},r=>{t()})}postMessage1(e){this.postMessage2(e,null)}postMessage2(e,t){this._workerFailedToDownload?this.mainThreadFallback!=null&&this.onmessage!=null&&setTimeout(()=>{this.onmessage({data:this.mainThreadFallback(e)})},0):this._worker==null?this._queue.push(new i.Item(e,t)):t!=null?this._worker.postMessage(e,t):this._worker.postMessage(e)}};(e=>{class i{constructor(r,n){this.message=r,this.transfer=n}}e.Item=i})(Da||(Da={}));function Ns(i){let e=i.length;for(;--e>=0;)i[e]=0}var pT=0,L_=1,hT=2,mT=3,gT=258,qh=29,Yl=256,Ul=Yl+1+qh,Es=30,Yh=19,M_=2*Ul+1,La=15,Ih=16,fT=7,Xh=256,B_=16,V_=17,k_=18,Vh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Dd=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),_T=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),U_=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),AT=512,Pi=new Array((Ul+2)*2);Ns(Pi);var Bl=new Array(Es*2);Ns(Bl);var Gl=new Array(AT);Ns(Gl);var Hl=new Array(gT-mT+1);Ns(Hl);var Jh=new Array(qh);Ns(Jh);var Ld=new Array(Es);Ns(Ld);function Eh(i,e,t,r,n){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=r,this.max_length=n,this.has_stree=i&&i.length}var G_,H_,z_;function Ch(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}var W_=i=>i<256?Gl[i]:Gl[256+(i>>>7)],zl=(i,e)=>{i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255},$n=(i,e,t)=>{i.bi_valid>Ih-t?(i.bi_buf|=e<<i.bi_valid&65535,zl(i,i.bi_buf),i.bi_buf=e>>Ih-i.bi_valid,i.bi_valid+=t-Ih):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},pi=(i,e,t)=>{$n(i,t[e*2],t[e*2+1])},Q_=(i,e)=>{let t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1},ST=i=>{i.bi_valid===16?(zl(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},bT=(i,e)=>{let t=e.dyn_tree,r=e.max_code,n=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,l=e.stat_desc.max_length,c,d,h,u,m,g,_=0;for(u=0;u<=La;u++)i.bl_count[u]=0;for(t[i.heap[i.heap_max]*2+1]=0,c=i.heap_max+1;c<M_;c++)d=i.heap[c],u=t[t[d*2+1]*2+1]+1,u>l&&(u=l,_++),t[d*2+1]=u,!(d>r)&&(i.bl_count[u]++,m=0,d>=s&&(m=a[d-s]),g=t[d*2],i.opt_len+=g*(u+m),o&&(i.static_len+=g*(n[d*2+1]+m)));if(_!==0){do{for(u=l-1;i.bl_count[u]===0;)u--;i.bl_count[u]--,i.bl_count[u+1]+=2,i.bl_count[l]--,_-=2}while(_>0);for(u=l;u!==0;u--)for(d=i.bl_count[u];d!==0;)h=i.heap[--c],!(h>r)&&(t[h*2+1]!==u&&(i.opt_len+=(u-t[h*2+1])*t[h*2],t[h*2+1]=u),d--)}},K_=(i,e,t)=>{let r=new Array(La+1),n=0,o,a;for(o=1;o<=La;o++)n=n+t[o-1]<<1,r[o]=n;for(a=0;a<=e;a++){let s=i[a*2+1];s!==0&&(i[a*2]=Q_(r[s]++,s))}},yT=()=>{let i,e,t,r,n,o=new Array(La+1);for(t=0,r=0;r<qh-1;r++)for(Jh[r]=t,i=0;i<1<<Vh[r];i++)Hl[t++]=r;for(Hl[t-1]=r,n=0,r=0;r<16;r++)for(Ld[r]=n,i=0;i<1<<Dd[r];i++)Gl[n++]=r;for(n>>=7;r<Es;r++)for(Ld[r]=n<<7,i=0;i<1<<Dd[r]-7;i++)Gl[256+n++]=r;for(e=0;e<=La;e++)o[e]=0;for(i=0;i<=143;)Pi[i*2+1]=8,i++,o[8]++;for(;i<=255;)Pi[i*2+1]=9,i++,o[9]++;for(;i<=279;)Pi[i*2+1]=7,i++,o[7]++;for(;i<=287;)Pi[i*2+1]=8,i++,o[8]++;for(K_(Pi,Ul+1,o),i=0;i<Es;i++)Bl[i*2+1]=5,Bl[i*2]=Q_(i,5);G_=new Eh(Pi,Vh,Yl+1,Ul,La),H_=new Eh(Bl,Dd,0,Es,La),z_=new Eh(new Array(0),_T,0,Yh,fT)},q_=i=>{let e;for(e=0;e<Ul;e++)i.dyn_ltree[e*2]=0;for(e=0;e<Es;e++)i.dyn_dtree[e*2]=0;for(e=0;e<Yh;e++)i.bl_tree[e*2]=0;i.dyn_ltree[Xh*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},Y_=i=>{i.bi_valid>8?zl(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},Zf=(i,e,t,r)=>{let n=e*2,o=t*2;return i[n]<i[o]||i[n]===i[o]&&r[e]<=r[t]},Rh=(i,e,t)=>{let r=i.heap[t],n=t<<1;for(;n<=i.heap_len&&(n<i.heap_len&&Zf(e,i.heap[n+1],i.heap[n],i.depth)&&n++,!Zf(e,r,i.heap[n],i.depth));)i.heap[t]=i.heap[n],t=n,n<<=1;i.heap[t]=r},jf=(i,e,t)=>{let r,n,o=0,a,s;if(i.sym_next!==0)do r=i.pending_buf[i.sym_buf+o++]&255,r+=(i.pending_buf[i.sym_buf+o++]&255)<<8,n=i.pending_buf[i.sym_buf+o++],r===0?pi(i,n,e):(a=Hl[n],pi(i,a+Yl+1,e),s=Vh[a],s!==0&&(n-=Jh[a],$n(i,n,s)),r--,a=W_(r),pi(i,a,t),s=Dd[a],s!==0&&(r-=Ld[a],$n(i,r,s)));while(o<i.sym_next);pi(i,Xh,e)},kh=(i,e)=>{let t=e.dyn_tree,r=e.stat_desc.static_tree,n=e.stat_desc.has_stree,o=e.stat_desc.elems,a,s,l=-1,c;for(i.heap_len=0,i.heap_max=M_,a=0;a<o;a++)t[a*2]!==0?(i.heap[++i.heap_len]=l=a,i.depth[a]=0):t[a*2+1]=0;for(;i.heap_len<2;)c=i.heap[++i.heap_len]=l<2?++l:0,t[c*2]=1,i.depth[c]=0,i.opt_len--,n&&(i.static_len-=r[c*2+1]);for(e.max_code=l,a=i.heap_len>>1;a>=1;a--)Rh(i,t,a);c=o;do a=i.heap[1],i.heap[1]=i.heap[i.heap_len--],Rh(i,t,1),s=i.heap[1],i.heap[--i.heap_max]=a,i.heap[--i.heap_max]=s,t[c*2]=t[a*2]+t[s*2],i.depth[c]=(i.depth[a]>=i.depth[s]?i.depth[a]:i.depth[s])+1,t[a*2+1]=t[s*2+1]=c,i.heap[1]=c++,Rh(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],bT(i,e),K_(t,l,i.bl_count)},$f=(i,e,t)=>{let r,n=-1,o,a=e[0*2+1],s=0,l=7,c=4;for(a===0&&(l=138,c=3),e[(t+1)*2+1]=65535,r=0;r<=t;r++)o=a,a=e[(r+1)*2+1],!(++s<l&&o===a)&&(s<c?i.bl_tree[o*2]+=s:o!==0?(o!==n&&i.bl_tree[o*2]++,i.bl_tree[B_*2]++):s<=10?i.bl_tree[V_*2]++:i.bl_tree[k_*2]++,s=0,n=o,a===0?(l=138,c=3):o===a?(l=6,c=3):(l=7,c=4))},e_=(i,e,t)=>{let r,n=-1,o,a=e[0*2+1],s=0,l=7,c=4;for(a===0&&(l=138,c=3),r=0;r<=t;r++)if(o=a,a=e[(r+1)*2+1],!(++s<l&&o===a)){if(s<c)do pi(i,o,i.bl_tree);while(--s!==0);else o!==0?(o!==n&&(pi(i,o,i.bl_tree),s--),pi(i,B_,i.bl_tree),$n(i,s-3,2)):s<=10?(pi(i,V_,i.bl_tree),$n(i,s-3,3)):(pi(i,k_,i.bl_tree),$n(i,s-11,7));s=0,n=o,a===0?(l=138,c=3):o===a?(l=6,c=3):(l=7,c=4)}},TT=i=>{let e;for($f(i,i.dyn_ltree,i.l_desc.max_code),$f(i,i.dyn_dtree,i.d_desc.max_code),kh(i,i.bl_desc),e=Yh-1;e>=3&&i.bl_tree[U_[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e},vT=(i,e,t,r)=>{let n;for($n(i,e-257,5),$n(i,t-1,5),$n(i,r-4,4),n=0;n<r;n++)$n(i,i.bl_tree[U_[n]*2+1],3);e_(i,i.dyn_ltree,e-1),e_(i,i.dyn_dtree,t-1)},IT=i=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return 0;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return 1;for(t=32;t<Yl;t++)if(i.dyn_ltree[t*2]!==0)return 1;return 0},t_=!1,ET=i=>{t_||(yT(),t_=!0),i.l_desc=new Ch(i.dyn_ltree,G_),i.d_desc=new Ch(i.dyn_dtree,H_),i.bl_desc=new Ch(i.bl_tree,z_),i.bi_buf=0,i.bi_valid=0,q_(i)},X_=(i,e,t,r)=>{$n(i,(pT<<1)+(r?1:0),3),Y_(i),zl(i,t),zl(i,~t),t&&i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},CT=i=>{$n(i,L_<<1,3),pi(i,Xh,Pi),ST(i)},RT=(i,e,t,r)=>{let n,o,a=0;i.level>0?(i.strm.data_type===2&&(i.strm.data_type=IT(i)),kh(i,i.l_desc),kh(i,i.d_desc),a=TT(i),n=i.opt_len+3+7>>>3,o=i.static_len+3+7>>>3,o<=n&&(n=o)):n=o=t+5,t+4<=n&&e!==-1?X_(i,e,t,r):i.strategy===4||o===n?($n(i,(L_<<1)+(r?1:0),3),jf(i,Pi,Bl)):($n(i,(hT<<1)+(r?1:0),3),vT(i,i.l_desc.max_code+1,i.d_desc.max_code+1,a+1),jf(i,i.dyn_ltree,i.dyn_dtree)),q_(i),r&&Y_(i)},NT=(i,e,t)=>(i.pending_buf[i.sym_buf+i.sym_next++]=e,i.pending_buf[i.sym_buf+i.sym_next++]=e>>8,i.pending_buf[i.sym_buf+i.sym_next++]=t,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(Hl[t]+Yl+1)*2]++,i.dyn_dtree[W_(e)*2]++),i.sym_next===i.sym_end),OT=ET,wT=X_,xT=RT,PT=NT,FT=CT,DT={_tr_init:OT,_tr_stored_block:wT,_tr_flush_block:xT,_tr_tally:PT,_tr_align:FT},LT=(i,e,t,r)=>{let n=i&65535|0,o=i>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do n=n+e[r++]|0,o=o+n|0;while(--a);n%=65521,o%=65521}return n|o<<16|0},Wl=LT,MT=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var r=0;r<8;r++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},BT=new Uint32Array(MT()),VT=(i,e,t,r)=>{let n=BT,o=r+t;i^=-1;for(let a=r;a<o;a++)i=i>>>8^n[(i^e[a])&255];return i^-1},sn=VT,Va={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Os={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:kT,_tr_stored_block:Uh,_tr_flush_block:UT,_tr_tally:na,_tr_align:GT}=DT,{Z_NO_FLUSH:oa,Z_PARTIAL_FLUSH:HT,Z_FULL_FLUSH:zT,Z_FINISH:Mo,Z_BLOCK:r_,Z_OK:Sn,Z_STREAM_END:n_,Z_STREAM_ERROR:hi,Z_DATA_ERROR:WT,Z_BUF_ERROR:Nh,Z_DEFAULT_COMPRESSION:QT,Z_FILTERED:KT,Z_HUFFMAN_ONLY:Od,Z_RLE:qT,Z_FIXED:YT,Z_DEFAULT_STRATEGY:XT,Z_UNKNOWN:JT,Z_DEFLATED:Vd}=Os,ZT=9,jT=15,$T=8,ev=29,tv=256,Gh=tv+1+ev,rv=30,nv=19,ov=2*Gh+1,iv=15,Wt=3,ra=258,mi=ra+Wt+1,av=32,Cs=42,Zh=57,Hh=69,zh=73,Wh=91,Qh=103,Ma=113,Ll=666,kn=1,ws=2,ka=3,xs=4,sv=3,Ba=(i,e)=>(i.msg=Va[e],e),o_=i=>i*2-(i>4?9:0),ta=i=>{let e=i.length;for(;--e>=0;)i[e]=0},lv=i=>{let e,t,r,n=i.w_size;e=i.hash_size,r=e;do t=i.head[--r],i.head[r]=t>=n?t-n:0;while(--e);e=n,r=e;do t=i.prev[--r],i.prev[r]=t>=n?t-n:0;while(--e)},cv=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,ia=cv,Ao=i=>{let e=i.state,t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},So=(i,e)=>{UT(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,Ao(i.strm)},nr=(i,e)=>{i.pending_buf[i.pending++]=e},Dl=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255},Kh=(i,e,t,r)=>{let n=i.avail_in;return n>r&&(n=r),n===0?0:(i.avail_in-=n,e.set(i.input.subarray(i.next_in,i.next_in+n),t),i.state.wrap===1?i.adler=Wl(i.adler,e,n,t):i.state.wrap===2&&(i.adler=sn(i.adler,e,n,t)),i.next_in+=n,i.total_in+=n,n)},J_=(i,e)=>{let t=i.max_chain_length,r=i.strstart,n,o,a=i.prev_length,s=i.nice_match,l=i.strstart>i.w_size-mi?i.strstart-(i.w_size-mi):0,c=i.window,d=i.w_mask,h=i.prev,u=i.strstart+ra,m=c[r+a-1],g=c[r+a];i.prev_length>=i.good_match&&(t>>=2),s>i.lookahead&&(s=i.lookahead);do if(n=e,!(c[n+a]!==g||c[n+a-1]!==m||c[n]!==c[r]||c[++n]!==c[r+1])){r+=2,n++;do;while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<u);if(o=ra-(u-r),r=u-ra,o>a){if(i.match_start=e,a=o,o>=s)break;m=c[r+a-1],g=c[r+a]}}while((e=h[e&d])>l&&--t!==0);return a<=i.lookahead?a:i.lookahead},Rs=i=>{let e=i.w_size,t,r,n;do{if(r=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-mi)&&(i.window.set(i.window.subarray(e,e+e-r),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,i.insert>i.strstart&&(i.insert=i.strstart),lv(i),r+=e),i.strm.avail_in===0)break;if(t=Kh(i.strm,i.window,i.strstart+i.lookahead,r),i.lookahead+=t,i.lookahead+i.insert>=Wt)for(n=i.strstart-i.insert,i.ins_h=i.window[n],i.ins_h=ia(i,i.ins_h,i.window[n+1]);i.insert&&(i.ins_h=ia(i,i.ins_h,i.window[n+Wt-1]),i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++,i.insert--,!(i.lookahead+i.insert<Wt)););}while(i.lookahead<mi&&i.strm.avail_in!==0)},Z_=(i,e)=>{let t=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,r,n,o,a=0,s=i.strm.avail_in;do{if(r=65535,o=i.bi_valid+42>>3,i.strm.avail_out<o||(o=i.strm.avail_out-o,n=i.strstart-i.block_start,r>n+i.strm.avail_in&&(r=n+i.strm.avail_in),r>o&&(r=o),r<t&&(r===0&&e!==Mo||e===oa||r!==n+i.strm.avail_in)))break;a=e===Mo&&r===n+i.strm.avail_in?1:0,Uh(i,0,0,a),i.pending_buf[i.pending-4]=r,i.pending_buf[i.pending-3]=r>>8,i.pending_buf[i.pending-2]=~r,i.pending_buf[i.pending-1]=~r>>8,Ao(i.strm),n&&(n>r&&(n=r),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+n),i.strm.next_out),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n,i.block_start+=n,r-=n),r&&(Kh(i.strm,i.strm.output,i.strm.next_out,r),i.strm.next_out+=r,i.strm.avail_out-=r,i.strm.total_out+=r)}while(a===0);return s-=i.strm.avail_in,s&&(s>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=s&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-s,i.strm.next_in),i.strstart),i.strstart+=s,i.insert+=s>i.w_size-i.insert?i.w_size-i.insert:s),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),a?xs:e!==oa&&e!==Mo&&i.strm.avail_in===0&&i.strstart===i.block_start?ws:(o=i.window_size-i.strstart,i.strm.avail_in>o&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,o+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),o>i.strm.avail_in&&(o=i.strm.avail_in),o&&(Kh(i.strm,i.window,i.strstart,o),i.strstart+=o,i.insert+=o>i.w_size-i.insert?i.w_size-i.insert:o),i.high_water<i.strstart&&(i.high_water=i.strstart),o=i.bi_valid+42>>3,o=i.pending_buf_size-o>65535?65535:i.pending_buf_size-o,t=o>i.w_size?i.w_size:o,n=i.strstart-i.block_start,(n>=t||(n||e===Mo)&&e!==oa&&i.strm.avail_in===0&&n<=o)&&(r=n>o?o:n,a=e===Mo&&i.strm.avail_in===0&&r===n?1:0,Uh(i,i.block_start,r,a),i.block_start+=r,Ao(i.strm)),a?ka:kn)},Oh=(i,e)=>{let t,r;for(;;){if(i.lookahead<mi){if(Rs(i),i.lookahead<mi&&e===oa)return kn;if(i.lookahead===0)break}if(t=0,i.lookahead>=Wt&&(i.ins_h=ia(i,i.ins_h,i.window[i.strstart+Wt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-mi&&(i.match_length=J_(i,t)),i.match_length>=Wt)if(r=na(i,i.strstart-i.match_start,i.match_length-Wt),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=Wt){i.match_length--;do i.strstart++,i.ins_h=ia(i,i.ins_h,i.window[i.strstart+Wt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=ia(i,i.ins_h,i.window[i.strstart+1]);else r=na(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(r&&(So(i,!1),i.strm.avail_out===0))return kn}return i.insert=i.strstart<Wt-1?i.strstart:Wt-1,e===Mo?(So(i,!0),i.strm.avail_out===0?ka:xs):i.sym_next&&(So(i,!1),i.strm.avail_out===0)?kn:ws},vs=(i,e)=>{let t,r,n;for(;;){if(i.lookahead<mi){if(Rs(i),i.lookahead<mi&&e===oa)return kn;if(i.lookahead===0)break}if(t=0,i.lookahead>=Wt&&(i.ins_h=ia(i,i.ins_h,i.window[i.strstart+Wt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=Wt-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-mi&&(i.match_length=J_(i,t),i.match_length<=5&&(i.strategy===KT||i.match_length===Wt&&i.strstart-i.match_start>4096)&&(i.match_length=Wt-1)),i.prev_length>=Wt&&i.match_length<=i.prev_length){n=i.strstart+i.lookahead-Wt,r=na(i,i.strstart-1-i.prev_match,i.prev_length-Wt),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=n&&(i.ins_h=ia(i,i.ins_h,i.window[i.strstart+Wt-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=Wt-1,i.strstart++,r&&(So(i,!1),i.strm.avail_out===0))return kn}else if(i.match_available){if(r=na(i,0,i.window[i.strstart-1]),r&&So(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return kn}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(r=na(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<Wt-1?i.strstart:Wt-1,e===Mo?(So(i,!0),i.strm.avail_out===0?ka:xs):i.sym_next&&(So(i,!1),i.strm.avail_out===0)?kn:ws},dv=(i,e)=>{let t,r,n,o,a=i.window;for(;;){if(i.lookahead<=ra){if(Rs(i),i.lookahead<=ra&&e===oa)return kn;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=Wt&&i.strstart>0&&(n=i.strstart-1,r=a[n],r===a[++n]&&r===a[++n]&&r===a[++n])){o=i.strstart+ra;do;while(r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&n<o);i.match_length=ra-(o-n),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=Wt?(t=na(i,1,i.match_length-Wt),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=na(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(So(i,!1),i.strm.avail_out===0))return kn}return i.insert=0,e===Mo?(So(i,!0),i.strm.avail_out===0?ka:xs):i.sym_next&&(So(i,!1),i.strm.avail_out===0)?kn:ws},uv=(i,e)=>{let t;for(;;){if(i.lookahead===0&&(Rs(i),i.lookahead===0)){if(e===oa)return kn;break}if(i.match_length=0,t=na(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(So(i,!1),i.strm.avail_out===0))return kn}return i.insert=0,e===Mo?(So(i,!0),i.strm.avail_out===0?ka:xs):i.sym_next&&(So(i,!1),i.strm.avail_out===0)?kn:ws};function ui(i,e,t,r,n){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=r,this.func=n}var Ml=[new ui(0,0,0,0,Z_),new ui(4,4,8,4,Oh),new ui(4,5,16,8,Oh),new ui(4,6,32,32,Oh),new ui(4,4,16,16,vs),new ui(8,16,32,32,vs),new ui(8,16,128,128,vs),new ui(8,32,128,256,vs),new ui(32,128,258,1024,vs),new ui(32,258,258,4096,vs)],pv=i=>{i.window_size=2*i.w_size,ta(i.head),i.max_lazy_match=Ml[i.level].max_lazy,i.good_match=Ml[i.level].good_length,i.nice_match=Ml[i.level].nice_length,i.max_chain_length=Ml[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=Wt-1,i.match_available=0,i.ins_h=0};function hv(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Vd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(ov*2),this.dyn_dtree=new Uint16Array((2*rv+1)*2),this.bl_tree=new Uint16Array((2*nv+1)*2),ta(this.dyn_ltree),ta(this.dyn_dtree),ta(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(iv+1),this.heap=new Uint16Array(2*Gh+1),ta(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Gh+1),ta(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Xl=i=>{if(!i)return 1;let e=i.state;return!e||e.strm!==i||e.status!==Cs&&e.status!==Zh&&e.status!==Hh&&e.status!==zh&&e.status!==Wh&&e.status!==Qh&&e.status!==Ma&&e.status!==Ll?1:0},j_=i=>{if(Xl(i))return Ba(i,hi);i.total_in=i.total_out=0,i.data_type=JT;let e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?Zh:e.wrap?Cs:Ma,i.adler=e.wrap===2?0:1,e.last_flush=-2,kT(e),Sn},$_=i=>{let e=j_(i);return e===Sn&&pv(i.state),e},mv=(i,e)=>Xl(i)||i.state.wrap!==2?hi:(i.state.gzhead=e,Sn),eA=(i,e,t,r,n,o)=>{if(!i)return hi;let a=1;if(e===QT&&(e=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),n<1||n>ZT||t!==Vd||r<8||r>15||e<0||e>9||o<0||o>YT||r===8&&a!==1)return Ba(i,hi);r===8&&(r=9);let s=new hv;return i.state=s,s.strm=i,s.status=Cs,s.wrap=a,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Wt-1)/Wt),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=e,s.strategy=o,s.method=t,$_(i)},gv=(i,e)=>eA(i,e,Vd,jT,$T,XT),fv=(i,e)=>{if(Xl(i)||e>r_||e<0)return i?Ba(i,hi):hi;let t=i.state;if(!i.output||i.avail_in!==0&&!i.input||t.status===Ll&&e!==Mo)return Ba(i,i.avail_out===0?Nh:hi);let r=t.last_flush;if(t.last_flush=e,t.pending!==0){if(Ao(i),i.avail_out===0)return t.last_flush=-1,Sn}else if(i.avail_in===0&&o_(e)<=o_(r)&&e!==Mo)return Ba(i,Nh);if(t.status===Ll&&i.avail_in!==0)return Ba(i,Nh);if(t.status===Cs&&t.wrap===0&&(t.status=Ma),t.status===Cs){let n=Vd+(t.w_bits-8<<4)<<8,o=-1;if(t.strategy>=Od||t.level<2?o=0:t.level<6?o=1:t.level===6?o=2:o=3,n|=o<<6,t.strstart!==0&&(n|=av),n+=31-n%31,Dl(t,n),t.strstart!==0&&(Dl(t,i.adler>>>16),Dl(t,i.adler&65535)),i.adler=1,t.status=Ma,Ao(i),t.pending!==0)return t.last_flush=-1,Sn}if(t.status===Zh){if(i.adler=0,nr(t,31),nr(t,139),nr(t,8),t.gzhead)nr(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),nr(t,t.gzhead.time&255),nr(t,t.gzhead.time>>8&255),nr(t,t.gzhead.time>>16&255),nr(t,t.gzhead.time>>24&255),nr(t,t.level===9?2:t.strategy>=Od||t.level<2?4:0),nr(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(nr(t,t.gzhead.extra.length&255),nr(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(i.adler=sn(i.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=Hh;else if(nr(t,0),nr(t,0),nr(t,0),nr(t,0),nr(t,0),nr(t,t.level===9?2:t.strategy>=Od||t.level<2?4:0),nr(t,sv),t.status=Ma,Ao(i),t.pending!==0)return t.last_flush=-1,Sn}if(t.status===Hh){if(t.gzhead.extra){let n=t.pending,o=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+o>t.pending_buf_size;){let s=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>n&&(i.adler=sn(i.adler,t.pending_buf,t.pending-n,n)),t.gzindex+=s,Ao(i),t.pending!==0)return t.last_flush=-1,Sn;n=0,o-=s}let a=new Uint8Array(t.gzhead.extra);t.pending_buf.set(a.subarray(t.gzindex,t.gzindex+o),t.pending),t.pending+=o,t.gzhead.hcrc&&t.pending>n&&(i.adler=sn(i.adler,t.pending_buf,t.pending-n,n)),t.gzindex=0}t.status=zh}if(t.status===zh){if(t.gzhead.name){let n=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>n&&(i.adler=sn(i.adler,t.pending_buf,t.pending-n,n)),Ao(i),t.pending!==0)return t.last_flush=-1,Sn;n=0}t.gzindex<t.gzhead.name.length?o=t.gzhead.name.charCodeAt(t.gzindex++)&255:o=0,nr(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>n&&(i.adler=sn(i.adler,t.pending_buf,t.pending-n,n)),t.gzindex=0}t.status=Wh}if(t.status===Wh){if(t.gzhead.comment){let n=t.pending,o;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>n&&(i.adler=sn(i.adler,t.pending_buf,t.pending-n,n)),Ao(i),t.pending!==0)return t.last_flush=-1,Sn;n=0}t.gzindex<t.gzhead.comment.length?o=t.gzhead.comment.charCodeAt(t.gzindex++)&255:o=0,nr(t,o)}while(o!==0);t.gzhead.hcrc&&t.pending>n&&(i.adler=sn(i.adler,t.pending_buf,t.pending-n,n))}t.status=Qh}if(t.status===Qh){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(Ao(i),t.pending!==0))return t.last_flush=-1,Sn;nr(t,i.adler&255),nr(t,i.adler>>8&255),i.adler=0}if(t.status=Ma,Ao(i),t.pending!==0)return t.last_flush=-1,Sn}if(i.avail_in!==0||t.lookahead!==0||e!==oa&&t.status!==Ll){let n=t.level===0?Z_(t,e):t.strategy===Od?uv(t,e):t.strategy===qT?dv(t,e):Ml[t.level].func(t,e);if((n===ka||n===xs)&&(t.status=Ll),n===kn||n===ka)return i.avail_out===0&&(t.last_flush=-1),Sn;if(n===ws&&(e===HT?GT(t):e!==r_&&(Uh(t,0,0,!1),e===zT&&(ta(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),Ao(i),i.avail_out===0))return t.last_flush=-1,Sn}return e!==Mo?Sn:t.wrap<=0?n_:(t.wrap===2?(nr(t,i.adler&255),nr(t,i.adler>>8&255),nr(t,i.adler>>16&255),nr(t,i.adler>>24&255),nr(t,i.total_in&255),nr(t,i.total_in>>8&255),nr(t,i.total_in>>16&255),nr(t,i.total_in>>24&255)):(Dl(t,i.adler>>>16),Dl(t,i.adler&65535)),Ao(i),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Sn:n_)},_v=i=>{if(Xl(i))return hi;let e=i.state.status;return i.state=null,e===Ma?Ba(i,WT):Sn},Av=(i,e)=>{let t=e.length;if(Xl(i))return hi;let r=i.state,n=r.wrap;if(n===2||n===1&&r.status!==Cs||r.lookahead)return hi;if(n===1&&(i.adler=Wl(i.adler,e,t,0)),r.wrap=0,t>=r.w_size){n===0&&(ta(r.head),r.strstart=0,r.block_start=0,r.insert=0);let l=new Uint8Array(r.w_size);l.set(e.subarray(t-r.w_size,t),0),e=l,t=r.w_size}let o=i.avail_in,a=i.next_in,s=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,Rs(r);r.lookahead>=Wt;){let l=r.strstart,c=r.lookahead-(Wt-1);do r.ins_h=ia(r,r.ins_h,r.window[l+Wt-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++;while(--c);r.strstart=l,r.lookahead=Wt-1,Rs(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Wt-1,r.match_available=0,i.next_in=a,i.input=s,i.avail_in=o,r.wrap=n,Sn},Sv=gv,bv=eA,yv=$_,Tv=j_,vv=mv,Iv=fv,Ev=_v,Cv=Av,Rv="pako deflate (from Nodeca project)",Vl={deflateInit:Sv,deflateInit2:bv,deflateReset:yv,deflateResetKeep:Tv,deflateSetHeader:vv,deflate:Iv,deflateEnd:Ev,deflateSetDictionary:Cv,deflateInfo:Rv},Nv=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),Ov=function(i){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let r in t)Nv(t,r)&&(i[r]=t[r])}}return i},wv=i=>{let e=0;for(let r=0,n=i.length;r<n;r++)e+=i[r].length;let t=new Uint8Array(e);for(let r=0,n=0,o=i.length;r<o;r++){let a=i[r];t.set(a,n),n+=a.length}return t},kd={assign:Ov,flattenChunks:wv},tA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{tA=!1}var Ql=new Uint8Array(256);for(let i=0;i<256;i++)Ql[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;Ql[254]=Ql[254]=1;var xv=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,r,n,o,a=i.length,s=0;for(n=0;n<a;n++)t=i.charCodeAt(n),(t&64512)===55296&&n+1<a&&(r=i.charCodeAt(n+1),(r&64512)===56320&&(t=65536+(t-55296<<10)+(r-56320),n++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(s),o=0,n=0;o<s;n++)t=i.charCodeAt(n),(t&64512)===55296&&n+1<a&&(r=i.charCodeAt(n+1),(r&64512)===56320&&(t=65536+(t-55296<<10)+(r-56320),n++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e},Pv=(i,e)=>{if(e<65534&&i.subarray&&tA)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let r=0;r<e;r++)t+=String.fromCharCode(i[r]);return t},Fv=(i,e)=>{let t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let r,n,o=new Array(t*2);for(n=0,r=0;r<t;){let a=i[r++];if(a<128){o[n++]=a;continue}let s=Ql[a];if(s>4){o[n++]=65533,r+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&r<t;)a=a<<6|i[r++]&63,s--;if(s>1){o[n++]=65533;continue}a<65536?o[n++]=a:(a-=65536,o[n++]=55296|a>>10&1023,o[n++]=56320|a&1023)}return Pv(o,n)},Dv=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)===128;)t--;return t<0||t===0?e:t+Ql[i[t]]>e?t:e},Kl={string2buf:xv,buf2string:Fv,utf8border:Dv};function Lv(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var rA=Lv,nA=Object.prototype.toString,{Z_NO_FLUSH:Mv,Z_SYNC_FLUSH:Bv,Z_FULL_FLUSH:Vv,Z_FINISH:kv,Z_OK:Md,Z_STREAM_END:Uv,Z_DEFAULT_COMPRESSION:Gv,Z_DEFAULT_STRATEGY:Hv,Z_DEFLATED:zv}=Os;function Jl(i){this.options=kd.assign({level:Gv,method:zv,chunkSize:16384,windowBits:15,memLevel:8,strategy:Hv},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rA,this.strm.avail_out=0;let t=Vl.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Md)throw new Error(Va[t]);if(e.header&&Vl.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=Kl.string2buf(e.dictionary):nA.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,t=Vl.deflateSetDictionary(this.strm,r),t!==Md)throw new Error(Va[t]);this._dict_set=!0}}Jl.prototype.push=function(i,e){let t=this.strm,r=this.options.chunkSize,n,o;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?kv:Mv,typeof i=="string"?t.input=Kl.string2buf(i):nA.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),(o===Bv||o===Vv)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(n=Vl.deflate(t,o),n===Uv)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),n=Vl.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Md;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Jl.prototype.onData=function(i){this.chunks.push(i)};Jl.prototype.onEnd=function(i){i===Md&&(this.result=kd.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function jh(i,e){let t=new Jl(e);if(t.push(i,!0),t.err)throw t.msg||Va[t.err];return t.result}function Wv(i,e){return e=e||{},e.raw=!0,jh(i,e)}function Qv(i,e){return e=e||{},e.gzip=!0,jh(i,e)}var Kv=Jl,qv=jh,Yv=Wv,Xv=Qv,Jv=Os,Zv={Deflate:Kv,deflate:qv,deflateRaw:Yv,gzip:Xv,constants:Jv},wd=16209,jv=16191,$v=function(e,t){let r,n,o,a,s,l,c,d,h,u,m,g,_,f,S,b,T,y,I,p,A,v,E,D,G=e.state;r=e.next_in,E=e.input,n=r+(e.avail_in-5),o=e.next_out,D=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=G.dmax,c=G.wsize,d=G.whave,h=G.wnext,u=G.window,m=G.hold,g=G.bits,_=G.lencode,f=G.distcode,S=(1<<G.lenbits)-1,b=(1<<G.distbits)-1;e:do{g<15&&(m+=E[r++]<<g,g+=8,m+=E[r++]<<g,g+=8),T=_[m&S];t:for(;;){if(y=T>>>24,m>>>=y,g-=y,y=T>>>16&255,y===0)D[o++]=T&65535;else if(y&16){I=T&65535,y&=15,y&&(g<y&&(m+=E[r++]<<g,g+=8),I+=m&(1<<y)-1,m>>>=y,g-=y),g<15&&(m+=E[r++]<<g,g+=8,m+=E[r++]<<g,g+=8),T=f[m&b];r:for(;;){if(y=T>>>24,m>>>=y,g-=y,y=T>>>16&255,y&16){if(p=T&65535,y&=15,g<y&&(m+=E[r++]<<g,g+=8,g<y&&(m+=E[r++]<<g,g+=8)),p+=m&(1<<y)-1,p>l){e.msg="invalid distance too far back",G.mode=wd;break e}if(m>>>=y,g-=y,y=o-a,p>y){if(y=p-y,y>d&&G.sane){e.msg="invalid distance too far back",G.mode=wd;break e}if(A=0,v=u,h===0){if(A+=c-y,y<I){I-=y;do D[o++]=u[A++];while(--y);A=o-p,v=D}}else if(h<y){if(A+=c+h-y,y-=h,y<I){I-=y;do D[o++]=u[A++];while(--y);if(A=0,h<I){y=h,I-=y;do D[o++]=u[A++];while(--y);A=o-p,v=D}}}else if(A+=h-y,y<I){I-=y;do D[o++]=u[A++];while(--y);A=o-p,v=D}for(;I>2;)D[o++]=v[A++],D[o++]=v[A++],D[o++]=v[A++],I-=3;I&&(D[o++]=v[A++],I>1&&(D[o++]=v[A++]))}else{A=o-p;do D[o++]=D[A++],D[o++]=D[A++],D[o++]=D[A++],I-=3;while(I>2);I&&(D[o++]=D[A++],I>1&&(D[o++]=D[A++]))}}else if(y&64){e.msg="invalid distance code",G.mode=wd;break e}else{T=f[(T&65535)+(m&(1<<y)-1)];continue r}break}}else if(y&64)if(y&32){G.mode=jv;break e}else{e.msg="invalid literal/length code",G.mode=wd;break e}else{T=_[(T&65535)+(m&(1<<y)-1)];continue t}break}}while(r<n&&o<s);I=g>>3,r-=I,g-=I<<3,m&=(1<<g)-1,e.next_in=r,e.next_out=o,e.avail_in=r<n?5+(n-r):5-(r-n),e.avail_out=o<s?257+(s-o):257-(o-s),G.hold=m,G.bits=g},Is=15,i_=852,a_=592,s_=0,wh=1,l_=2,eI=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),tI=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),rI=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),nI=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),oI=(i,e,t,r,n,o,a,s)=>{let l=s.bits,c=0,d=0,h=0,u=0,m=0,g=0,_=0,f=0,S=0,b=0,T,y,I,p,A,v=null,E,D=new Uint16Array(Is+1),G=new Uint16Array(Is+1),U=null,M,z,B;for(c=0;c<=Is;c++)D[c]=0;for(d=0;d<r;d++)D[e[t+d]]++;for(m=l,u=Is;u>=1&&D[u]===0;u--);if(m>u&&(m=u),u===0)return n[o++]=1<<24|64<<16|0,n[o++]=1<<24|64<<16|0,s.bits=1,0;for(h=1;h<u&&D[h]===0;h++);for(m<h&&(m=h),f=1,c=1;c<=Is;c++)if(f<<=1,f-=D[c],f<0)return-1;if(f>0&&(i===s_||u!==1))return-1;for(G[1]=0,c=1;c<Is;c++)G[c+1]=G[c]+D[c];for(d=0;d<r;d++)e[t+d]!==0&&(a[G[e[t+d]]++]=d);if(i===s_?(v=U=a,E=20):i===wh?(v=eI,U=tI,E=257):(v=rI,U=nI,E=0),b=0,d=0,c=h,A=o,g=m,_=0,I=-1,S=1<<m,p=S-1,i===wh&&S>i_||i===l_&&S>a_)return 1;for(;;){M=c-_,a[d]+1<E?(z=0,B=a[d]):a[d]>=E?(z=U[a[d]-E],B=v[a[d]-E]):(z=32+64,B=0),T=1<<c-_,y=1<<g,h=y;do y-=T,n[A+(b>>_)+y]=M<<24|z<<16|B|0;while(y!==0);for(T=1<<c-1;b&T;)T>>=1;if(T!==0?(b&=T-1,b+=T):b=0,d++,--D[c]===0){if(c===u)break;c=e[t+a[d]]}if(c>m&&(b&p)!==I){for(_===0&&(_=m),A+=h,g=c-_,f=1<<g;g+_<u&&(f-=D[g+_],!(f<=0));)g++,f<<=1;if(S+=1<<g,i===wh&&S>i_||i===l_&&S>a_)return 1;I=b&p,n[I]=m<<24|g<<16|A-o|0}}return b!==0&&(n[A+b]=c-_<<24|64<<16|0),s.bits=m,0},kl=oI,iI=0,oA=1,iA=2,{Z_FINISH:c_,Z_BLOCK:aI,Z_TREES:xd,Z_OK:Ua,Z_STREAM_END:sI,Z_NEED_DICT:lI,Z_STREAM_ERROR:Bo,Z_DATA_ERROR:aA,Z_MEM_ERROR:sA,Z_BUF_ERROR:cI,Z_DEFLATED:d_}=Os,Ud=16180,u_=16181,p_=16182,h_=16183,m_=16184,g_=16185,f_=16186,__=16187,A_=16188,S_=16189,Bd=16190,xi=16191,xh=16192,b_=16193,Ph=16194,y_=16195,T_=16196,v_=16197,I_=16198,Pd=16199,Fd=16200,E_=16201,C_=16202,R_=16203,N_=16204,O_=16205,Fh=16206,w_=16207,x_=16208,Rr=16209,lA=16210,cA=16211,dI=852,uI=592,pI=15,hI=pI,P_=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function mI(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Ga=i=>{if(!i)return 1;let e=i.state;return!e||e.strm!==i||e.mode<Ud||e.mode>cA?1:0},dA=i=>{if(Ga(i))return Bo;let e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=Ud,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(dI),e.distcode=e.distdyn=new Int32Array(uI),e.sane=1,e.back=-1,Ua},uA=i=>{if(Ga(i))return Bo;let e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,dA(i)},pA=(i,e)=>{let t;if(Ga(i))return Bo;let r=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Bo:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=t,r.wbits=e,uA(i))},hA=(i,e)=>{if(!i)return Bo;let t=new mI;i.state=t,t.strm=i,t.window=null,t.mode=Ud;let r=pA(i,e);return r!==Ua&&(i.state=null),r},gI=i=>hA(i,hI),F_=!0,Dh,Lh,fI=i=>{if(F_){Dh=new Int32Array(512),Lh=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(kl(oA,i.lens,0,288,Dh,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;kl(iA,i.lens,0,32,Lh,0,i.work,{bits:5}),F_=!1}i.lencode=Dh,i.lenbits=9,i.distcode=Lh,i.distbits=5},mA=(i,e,t,r)=>{let n,o=i.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(n=o.wsize-o.wnext,n>r&&(n=r),o.window.set(e.subarray(t-r,t-r+n),o.wnext),r-=n,r?(o.window.set(e.subarray(t-r,t),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0},_I=(i,e)=>{let t,r,n,o,a,s,l,c,d,h,u,m,g,_,f=0,S,b,T,y,I,p,A,v,E=new Uint8Array(4),D,G,U=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ga(i)||!i.output||!i.input&&i.avail_in!==0)return Bo;t=i.state,t.mode===xi&&(t.mode=xh),a=i.next_out,n=i.output,l=i.avail_out,o=i.next_in,r=i.input,s=i.avail_in,c=t.hold,d=t.bits,h=s,u=l,v=Ua;e:for(;;)switch(t.mode){case Ud:if(t.wrap===0){t.mode=xh;break}for(;d<16;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(t.wrap&2&&c===35615){t.wbits===0&&(t.wbits=15),t.check=0,E[0]=c&255,E[1]=c>>>8&255,t.check=sn(t.check,E,2,0),c=0,d=0,t.mode=u_;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((c&255)<<8)+(c>>8))%31){i.msg="incorrect header check",t.mode=Rr;break}if((c&15)!==d_){i.msg="unknown compression method",t.mode=Rr;break}if(c>>>=4,d-=4,A=(c&15)+8,t.wbits===0&&(t.wbits=A),A>15||A>t.wbits){i.msg="invalid window size",t.mode=Rr;break}t.dmax=1<<t.wbits,t.flags=0,i.adler=t.check=1,t.mode=c&512?S_:xi,c=0,d=0;break;case u_:for(;d<16;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(t.flags=c,(t.flags&255)!==d_){i.msg="unknown compression method",t.mode=Rr;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=Rr;break}t.head&&(t.head.text=c>>8&1),t.flags&512&&t.wrap&4&&(E[0]=c&255,E[1]=c>>>8&255,t.check=sn(t.check,E,2,0)),c=0,d=0,t.mode=p_;case p_:for(;d<32;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}t.head&&(t.head.time=c),t.flags&512&&t.wrap&4&&(E[0]=c&255,E[1]=c>>>8&255,E[2]=c>>>16&255,E[3]=c>>>24&255,t.check=sn(t.check,E,4,0)),c=0,d=0,t.mode=h_;case h_:for(;d<16;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}t.head&&(t.head.xflags=c&255,t.head.os=c>>8),t.flags&512&&t.wrap&4&&(E[0]=c&255,E[1]=c>>>8&255,t.check=sn(t.check,E,2,0)),c=0,d=0,t.mode=m_;case m_:if(t.flags&1024){for(;d<16;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}t.length=c,t.head&&(t.head.extra_len=c),t.flags&512&&t.wrap&4&&(E[0]=c&255,E[1]=c>>>8&255,t.check=sn(t.check,E,2,0)),c=0,d=0}else t.head&&(t.head.extra=null);t.mode=g_;case g_:if(t.flags&1024&&(m=t.length,m>s&&(m=s),m&&(t.head&&(A=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(r.subarray(o,o+m),A)),t.flags&512&&t.wrap&4&&(t.check=sn(t.check,r,m,o)),s-=m,o+=m,t.length-=m),t.length))break e;t.length=0,t.mode=f_;case f_:if(t.flags&2048){if(s===0)break e;m=0;do A=r[o+m++],t.head&&A&&t.length<65536&&(t.head.name+=String.fromCharCode(A));while(A&&m<s);if(t.flags&512&&t.wrap&4&&(t.check=sn(t.check,r,m,o)),s-=m,o+=m,A)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=__;case __:if(t.flags&4096){if(s===0)break e;m=0;do A=r[o+m++],t.head&&A&&t.length<65536&&(t.head.comment+=String.fromCharCode(A));while(A&&m<s);if(t.flags&512&&t.wrap&4&&(t.check=sn(t.check,r,m,o)),s-=m,o+=m,A)break e}else t.head&&(t.head.comment=null);t.mode=A_;case A_:if(t.flags&512){for(;d<16;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(t.wrap&4&&c!==(t.check&65535)){i.msg="header crc mismatch",t.mode=Rr;break}c=0,d=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=xi;break;case S_:for(;d<32;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}i.adler=t.check=P_(c),c=0,d=0,t.mode=Bd;case Bd:if(t.havedict===0)return i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=c,t.bits=d,lI;i.adler=t.check=1,t.mode=xi;case xi:if(e===aI||e===xd)break e;case xh:if(t.last){c>>>=d&7,d-=d&7,t.mode=Fh;break}for(;d<3;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}switch(t.last=c&1,c>>>=1,d-=1,c&3){case 0:t.mode=b_;break;case 1:if(fI(t),t.mode=Pd,e===xd){c>>>=2,d-=2;break e}break;case 2:t.mode=T_;break;case 3:i.msg="invalid block type",t.mode=Rr}c>>>=2,d-=2;break;case b_:for(c>>>=d&7,d-=d&7;d<32;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if((c&65535)!==(c>>>16^65535)){i.msg="invalid stored block lengths",t.mode=Rr;break}if(t.length=c&65535,c=0,d=0,t.mode=Ph,e===xd)break e;case Ph:t.mode=y_;case y_:if(m=t.length,m){if(m>s&&(m=s),m>l&&(m=l),m===0)break e;n.set(r.subarray(o,o+m),a),s-=m,o+=m,l-=m,a+=m,t.length-=m;break}t.mode=xi;break;case T_:for(;d<14;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(t.nlen=(c&31)+257,c>>>=5,d-=5,t.ndist=(c&31)+1,c>>>=5,d-=5,t.ncode=(c&15)+4,c>>>=4,d-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=Rr;break}t.have=0,t.mode=v_;case v_:for(;t.have<t.ncode;){for(;d<3;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}t.lens[U[t.have++]]=c&7,c>>>=3,d-=3}for(;t.have<19;)t.lens[U[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,D={bits:t.lenbits},v=kl(iI,t.lens,0,19,t.lencode,0,t.work,D),t.lenbits=D.bits,v){i.msg="invalid code lengths set",t.mode=Rr;break}t.have=0,t.mode=I_;case I_:for(;t.have<t.nlen+t.ndist;){for(;f=t.lencode[c&(1<<t.lenbits)-1],S=f>>>24,b=f>>>16&255,T=f&65535,!(S<=d);){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(T<16)c>>>=S,d-=S,t.lens[t.have++]=T;else{if(T===16){for(G=S+2;d<G;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(c>>>=S,d-=S,t.have===0){i.msg="invalid bit length repeat",t.mode=Rr;break}A=t.lens[t.have-1],m=3+(c&3),c>>>=2,d-=2}else if(T===17){for(G=S+3;d<G;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}c>>>=S,d-=S,A=0,m=3+(c&7),c>>>=3,d-=3}else{for(G=S+7;d<G;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}c>>>=S,d-=S,A=0,m=11+(c&127),c>>>=7,d-=7}if(t.have+m>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=Rr;break}for(;m--;)t.lens[t.have++]=A}}if(t.mode===Rr)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=Rr;break}if(t.lenbits=9,D={bits:t.lenbits},v=kl(oA,t.lens,0,t.nlen,t.lencode,0,t.work,D),t.lenbits=D.bits,v){i.msg="invalid literal/lengths set",t.mode=Rr;break}if(t.distbits=6,t.distcode=t.distdyn,D={bits:t.distbits},v=kl(iA,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,D),t.distbits=D.bits,v){i.msg="invalid distances set",t.mode=Rr;break}if(t.mode=Pd,e===xd)break e;case Pd:t.mode=Fd;case Fd:if(s>=6&&l>=258){i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=c,t.bits=d,$v(i,u),a=i.next_out,n=i.output,l=i.avail_out,o=i.next_in,r=i.input,s=i.avail_in,c=t.hold,d=t.bits,t.mode===xi&&(t.back=-1);break}for(t.back=0;f=t.lencode[c&(1<<t.lenbits)-1],S=f>>>24,b=f>>>16&255,T=f&65535,!(S<=d);){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(b&&!(b&240)){for(y=S,I=b,p=T;f=t.lencode[p+((c&(1<<y+I)-1)>>y)],S=f>>>24,b=f>>>16&255,T=f&65535,!(y+S<=d);){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}c>>>=y,d-=y,t.back+=y}if(c>>>=S,d-=S,t.back+=S,t.length=T,b===0){t.mode=O_;break}if(b&32){t.back=-1,t.mode=xi;break}if(b&64){i.msg="invalid literal/length code",t.mode=Rr;break}t.extra=b&15,t.mode=E_;case E_:if(t.extra){for(G=t.extra;d<G;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,d-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=C_;case C_:for(;f=t.distcode[c&(1<<t.distbits)-1],S=f>>>24,b=f>>>16&255,T=f&65535,!(S<=d);){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(!(b&240)){for(y=S,I=b,p=T;f=t.distcode[p+((c&(1<<y+I)-1)>>y)],S=f>>>24,b=f>>>16&255,T=f&65535,!(y+S<=d);){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}c>>>=y,d-=y,t.back+=y}if(c>>>=S,d-=S,t.back+=S,b&64){i.msg="invalid distance code",t.mode=Rr;break}t.offset=T,t.extra=b&15,t.mode=R_;case R_:if(t.extra){for(G=t.extra;d<G;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,d-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=Rr;break}t.mode=N_;case N_:if(l===0)break e;if(m=u-l,t.offset>m){if(m=t.offset-m,m>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=Rr;break}m>t.wnext?(m-=t.wnext,g=t.wsize-m):g=t.wnext-m,m>t.length&&(m=t.length),_=t.window}else _=n,g=a-t.offset,m=t.length;m>l&&(m=l),l-=m,t.length-=m;do n[a++]=_[g++];while(--m);t.length===0&&(t.mode=Fd);break;case O_:if(l===0)break e;n[a++]=t.length,l--,t.mode=Fd;break;case Fh:if(t.wrap){for(;d<32;){if(s===0)break e;s--,c|=r[o++]<<d,d+=8}if(u-=l,i.total_out+=u,t.total+=u,t.wrap&4&&u&&(i.adler=t.check=t.flags?sn(t.check,n,u,a-u):Wl(t.check,n,u,a-u)),u=l,t.wrap&4&&(t.flags?c:P_(c))!==t.check){i.msg="incorrect data check",t.mode=Rr;break}c=0,d=0}t.mode=w_;case w_:if(t.wrap&&t.flags){for(;d<32;){if(s===0)break e;s--,c+=r[o++]<<d,d+=8}if(t.wrap&4&&c!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=Rr;break}c=0,d=0}t.mode=x_;case x_:v=sI;break e;case Rr:v=aA;break e;case lA:return sA;case cA:default:return Bo}return i.next_out=a,i.avail_out=l,i.next_in=o,i.avail_in=s,t.hold=c,t.bits=d,(t.wsize||u!==i.avail_out&&t.mode<Rr&&(t.mode<Fh||e!==c_))&&mA(i,i.output,i.next_out,u-i.avail_out),h-=i.avail_in,u-=i.avail_out,i.total_in+=h,i.total_out+=u,t.total+=u,t.wrap&4&&u&&(i.adler=t.check=t.flags?sn(t.check,n,u,i.next_out-u):Wl(t.check,n,u,i.next_out-u)),i.data_type=t.bits+(t.last?64:0)+(t.mode===xi?128:0)+(t.mode===Pd||t.mode===Ph?256:0),(h===0&&u===0||e===c_)&&v===Ua&&(v=cI),v},AI=i=>{if(Ga(i))return Bo;let e=i.state;return e.window&&(e.window=null),i.state=null,Ua},SI=(i,e)=>{if(Ga(i))return Bo;let t=i.state;return t.wrap&2?(t.head=e,e.done=!1,Ua):Bo},bI=(i,e)=>{let t=e.length,r,n,o;return Ga(i)||(r=i.state,r.wrap!==0&&r.mode!==Bd)?Bo:r.mode===Bd&&(n=1,n=Wl(n,e,t,0),n!==r.check)?aA:(o=mA(i,e,t,t),o?(r.mode=lA,sA):(r.havedict=1,Ua))},yI=uA,TI=pA,vI=dA,II=gI,EI=hA,CI=_I,RI=AI,NI=SI,OI=bI,wI="pako inflate (from Nodeca project)",Fi={inflateReset:yI,inflateReset2:TI,inflateResetKeep:vI,inflateInit:II,inflateInit2:EI,inflate:CI,inflateEnd:RI,inflateGetHeader:NI,inflateSetDictionary:OI,inflateInfo:wI};function xI(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var PI=xI,gA=Object.prototype.toString,{Z_NO_FLUSH:FI,Z_FINISH:DI,Z_OK:ql,Z_STREAM_END:Mh,Z_NEED_DICT:Bh,Z_STREAM_ERROR:LI,Z_DATA_ERROR:D_,Z_MEM_ERROR:MI}=Os;function Zl(i){this.options=kd.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rA,this.strm.avail_out=0;let t=Fi.inflateInit2(this.strm,e.windowBits);if(t!==ql)throw new Error(Va[t]);if(this.header=new PI,Fi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Kl.string2buf(e.dictionary):gA.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Fi.inflateSetDictionary(this.strm,e.dictionary),t!==ql)))throw new Error(Va[t])}Zl.prototype.push=function(i,e){let t=this.strm,r=this.options.chunkSize,n=this.options.dictionary,o,a,s;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?DI:FI,gA.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),o=Fi.inflate(t,a),o===Bh&&n&&(o=Fi.inflateSetDictionary(t,n),o===ql?o=Fi.inflate(t,a):o===D_&&(o=Bh));t.avail_in>0&&o===Mh&&t.state.wrap>0&&i[t.next_in]!==0;)Fi.inflateReset(t),o=Fi.inflate(t,a);switch(o){case LI:case D_:case Bh:case MI:return this.onEnd(o),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||o===Mh))if(this.options.to==="string"){let l=Kl.utf8border(t.output,t.next_out),c=t.next_out-l,d=Kl.buf2string(t.output,l);t.next_out=c,t.avail_out=r-c,c&&t.output.set(t.output.subarray(l,l+c),0),this.onData(d)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===ql&&s===0)){if(o===Mh)return o=Fi.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Zl.prototype.onData=function(i){this.chunks.push(i)};Zl.prototype.onEnd=function(i){i===ql&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=kd.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function $h(i,e){let t=new Zl(e);if(t.push(i),t.err)throw t.msg||Va[t.err];return t.result}function BI(i,e){return e=e||{},e.raw=!0,$h(i,e)}var VI=Zl,kI=$h,UI=BI,GI=$h,HI=Os,zI={Inflate:VI,inflate:kI,inflateRaw:UI,ungzip:GI,constants:HI},{Deflate:O1,deflate:w1,deflateRaw:WI,gzip:x1}=Zv,{Inflate:P1,inflate:F1,inflateRaw:QI,ungzip:D1}=zI;var fA=WI;var _A=QI;var jo;(t=>{function i(r){return _A(r)}t.inflateRaw=i;function e(r){return fA(r)}t.deflateRaw=e})(jo||(jo={}));var em;(r=>{class i{constructor(){}}let n=class n{_decode(a){for(this._count=a.length,this._view=vd.DataView_new1(a),(this._readInt()!=n._ID(137,80,78,71)||this._readInt()!=n._ID(13,10,26,10))&&n._fail();this._offset+12<=this._count;){let s=this._offset,l=this._readInt(),c=this._readInt(),d=s+8,h=d+l;switch(s+12+l>this._count&&(console.error("truncated png image"),n._fail()),c){case n._ID(73,72,68,82):{let u=this._readInt(),m=this._readInt(),g=this._readByte(),_=this._readByte(),f=this._readByte(),S=this._readByte(),b=this._readByte(),T=u<=0||m<=0||f!=0||S!=0||b!=0&&b!=1;if(!T)switch(_){case n.COLOR_TYPE_GRAY:{T=g!=1&&g!=2&&g!=4&&g!=8&&g!=16;break}case n.COLOR_TYPE_INDEXED:{T=g!=1&&g!=2&&g!=4&&g!=8;break}case n.COLOR_TYPE_RGB:case n.COLOR_TYPE_GRAY_ALPHA:case n.COLOR_TYPE_RGBA:{T=g!=8&&g!=16;break}default:{T=!0;break}}T&&(console.error("invalid png header"),n._fail()),this._width=u,this._height=m,this._bitDepth=g,this._colorType=_,this._isInterlaced=b==1;break}case n._ID(80,76,84,69):{this._palette=a.subarray(d,h),(l<3||l>256*3||l%3!=0)&&(console.error("invalid palette in png image"),n._fail());break}case n._ID(73,68,65,84):{this._dataStreamChunks.push(a.subarray(d,h)),this._dataStreamCount=this._dataStreamCount+l;break}case n._ID(116,82,78,83):{this._transparency=a.subarray(d,h);break}case n._ID(73,69,78,68):return r.DEBUG_LOG&&console.log(`png header: ${this._width}x${this._height}, ${this._bitDepth} bits per sample, `+new Map([[n.COLOR_TYPE_GRAY,"gray"],[n.COLOR_TYPE_RGB,"rgb"],[n.COLOR_TYPE_INDEXED,"indexed"],[n.COLOR_TYPE_GRAY_ALPHA,"gray_alpha"],[n.COLOR_TYPE_RGBA,"rgba"]]).get(this._colorType)+(this._isInterlaced?", interlaced":", non_interlaced")),this._decodeImage();default:{r.DEBUG_LOG&&console.warn(`unsupported png chunk '${fo.string_fromCodePoints([c>>>24,c>>16&255,c>>8&255,c&255])}'`);break}}this._offset=s+l+12}return n._fail(),null}_readInt(){return this._offset=this._offset+4,this._offset>this._count&&(console.error("truncated png image"),n._fail()),this._view.getInt32(this._offset-4)}_readByte(){return this._offset=this._offset+1,this._offset>this._count&&(console.error("truncated png image"),n._fail()),this._view.getUint8(this._offset-1)}_decompressStream(){let a=new Uint8Array(this._dataStreamCount),s=0;for(let c of this._dataStreamChunks)a.set(c,s),s=s+c.length;let l=null;try{l=jo.inflateRaw(a.subarray(2))}catch{console.error("invalid zip stream in png image"),n._fail()}return l}_decodeImage(){(this._width<=0||this._height<=0||this._dataStreamCount==0)&&(console.error("incomplete png image"),n._fail());let a=this._decompressStream(),s=this._colorType==n.COLOR_TYPE_GRAY_ALPHA?2:this._colorType==n.COLOR_TYPE_RGB?3:this._colorType==n.COLOR_TYPE_RGBA?4:1,l=this._bitDepth*s,c=l+7>>3,d=this._width*l+7>>3,h=new Uint8Array(d*this._height),u=0;a.length!=(d+1)*this._height&&(console.error("invalid decompressed png stream"),n._fail());for(let _=0,f=this._height;_<f;_=_+1){let S=_*d,b=S-c,T=S-d,y=T-c,I=a[u];switch(u=u+1,I){case n.FILTER_TYPE_NONE:{h.set(a.subarray(u,u+d),S),u=u+d;break}case n.FILTER_TYPE_SUB:{for(let p=0,A=d;p<A;p=p+1)h[S+p]=a[u]+(p<c?0:h[b+p]),u=u+1;break}case n.FILTER_TYPE_UP:{for(let p=0,A=d;p<A;p=p+1)h[S+p]=a[u]+(_==0?0:h[T+p]),u=u+1;break}case n.FILTER_TYPE_AVERAGE:{for(let p=0,A=d;p<A;p=p+1){let v=p<c?0:h[b+p],E=_==0?0:h[T+p];h[S+p]=a[u]+(v+E>>1),u=u+1}break}case n.FILTER_TYPE_PAETH:{for(let p=0,A=d;p<A;p=p+1){let v=p<c?0:h[b+p],E=_==0?0:h[T+p],D=p<c||_==0?0:h[y+p],G=v+E-D,U=Math.abs(G-v),M=Math.abs(G-E),z=Math.abs(G-D);h[S+p]=a[u]+(U<=M&&U<=z?v:M<=z?E:D),u=u+1}break}default:{console.error(`invalid png filter type ${I}`),n._fail();break}}}if(this._bitDepth==16){let _=new Uint8Array(h.length>>1);for(let f=0,S=_.length;f<S;f=f+1)_[f]=h[f*2];h=_,l>>=1,c>>=1,d>>=1,this._bitDepth=8}let m=this._width*this._height*4,g=s==4?h:new Uint8Array(m);switch(s){case 1:{let _=0,f=0,S=(1<<l)-1,b=S==1?255:255/S|0,T=this._colorType==n.COLOR_TYPE_INDEXED,y=this._palette,I=y!=null?y.length:0,p=this._transparency,A=p!=null?p.length:0;for(let v=0,E=this._height;v<E;v=v+1){let D=0,G=0;for(let U=0,M=this._width;U<M;U=U+1){D==0&&(G=h[_],D=8,_=_+1),D=D-l;let z=G>>D&S;if(T){let B=z*3;B>I-3&&(console.error(`invalid palette index ${z} in png image`),n._fail()),g[f]=y[B],g[f+1]=y[B+1],g[f+2]=y[B+2]}else z=z*b,g[f]=z,g[f+1]=z,g[f+2]=z;g[f+3]=T&&z<A?p[z]:255,f=f+4}}break}case 2:{for(let _=0,f=0;f<m;_=_+2,f=f+4){let S=h[_];g[f]=S,g[f+1]=S,g[f+2]=S,g[f+3]=h[_+1]}break}case 3:{for(let _=0,f=0;f<m;_=_+3,f=f+4){let S=h[_],b=h[_+1],T=h[_+2];g[f]=S,g[f+1]=b,g[f+2]=T,g[f+3]=255}break}}return _r.createFromPixels(this._width,this._height,g)}static _fail(){throw new i}static _ID(a,s,l,c){return a<<24|s<<16|l<<8|c}static decodeBytes(a){return new n()._decode(a)}constructor(){this._count=0,this._offset=0,this._palette=null,this._transparency=null,this._view=null,this._dataStreamChunks=[],this._dataStreamCount=0,this._width=0,this._height=0,this._bitDepth=0,this._colorType=0,this._isInterlaced=!1}};n.COLOR_TYPE_GRAY=0,n.COLOR_TYPE_RGB=2,n.COLOR_TYPE_INDEXED=3,n.COLOR_TYPE_GRAY_ALPHA=4,n.COLOR_TYPE_RGBA=6,n.FILTER_TYPE_NONE=0,n.FILTER_TYPE_SUB=1,n.FILTER_TYPE_UP=2,n.FILTER_TYPE_AVERAGE=3,n.FILTER_TYPE_PAETH=4;let e=n;r.Decoder=n,r.DEBUG_LOG=!1})(em||(em={}));var Gd=class i{_decode(e){let t=0;(e[t++]!=71||e[t++]!=73||e[t++]!=70||e[t++]!=56||(e[t++]+1&253)!=56||e[t++]!=97)&&an.fail("Invalid GIF 87a/89a header.");let r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,o=e[t++],a=!!(o>>7),l=1<<(o&7)+1;t=t+1,t=t+1;let c=0,d=0;a&&(c=t,d=l,t=t+l*3);let h=!0,u=[],m=!1,g=0,_=256,f=0,S=-1,b=!0;e:for(;h&&t<e.length;)switch(e[t++]){case 33:{switch(e[t++]){case 255:{if(e[t]!=11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t=t+14,S=e[t++]|e[t++]<<8,t=t+1;else for(t=t+12;;){let T=e[t++];if(T>=0||an.fail("Invalid block size"),T==0)break;t=t+T}break}case 249:{(e[t++]!=4||e[t+4]!=0)&&an.fail("Invalid graphics extension block.");let T=e[t++];g=e[t++]|e[t++]<<8,_=e[t++],T&1||(_=256),f=T>>2&7,!m&&f==3&&(m=!0),T>>1&1,t=t+1;break}case 254:case 1:{for(;;){let T=e[t++];if(T>=0||an.fail("Invalid block size"),T==0)break;t=t+T}break}default:{let T=e[t-1].toString(16);an.fail(`Unknown graphic control label: 0x${T}`);break}}break}case 44:{let T=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,I=e[t++]|e[t++]<<8,p=e[t++]|e[t++]<<8,A=e[t++],v=!!(A>>7),E=A>>6&1,G=1<<(A&7)+1,U=c,M=d,z=!1;v&&(z=!0,U=t,M=G,t=t+G*3);let B=t,w=!1;for(t=t+1;;){let P=e[t++];if(P===void 0){w=!0;break}if(P>=0||an.fail("Invalid block size"),P==0)break;t=t+P}w||u.push(new an.Frame(T,y,I,p,z,U,M,B,t-B,_,!!E,g,f)),(I==r&&p==n||!z||g>0)&&(b=!1);break}case 59:{h=!1;break e}default:{let T=e[t-1].toString(16);an.fail(`Unknown gif block: 0x${T}`);break}}if(b){let T="May have encountered multi-image/single-canvas GIF";T+=`
  GIF metadata: [${r} x ${n}], loopCount=${S}, disposal=${f}`;for(let y of u)T+=`
    ${y}`;console.warn(T)}return new an.DecodeResult(r,n,u.length,S,e,u,m)}static decodeBytes(e){{let t=new i()._decode(e);return _r.createFromGif(t.width,t.height,t)}}constructor(){}},Ve=class Ve{static createFromPixels(e,t,r){return new Ve(e,t,r)}static createFromCanvas(e){return new Ve(e.width,e.height,null,e)}static createFromImage(e,t,r){return new Ve(e,t,null,null,r)}static createFromGif(e,t,r){return new Ve(e,t,null,null,null,r)}static createFromImageBitmap(e,t,r){return new Ve(e,t,null,null,null,null,r)}constructor(e,t,r,n,o,a,s){this.width=e,this.height=t,this.gif=null,this.pixels=null,n!=null?this.pixels=Ve.Pixels.createFromCanvas(n):o!=null?this.pixels=Ve.Pixels.createFromImage(o):a!=null?this.gif=a:s!=null?this.pixels=Ve.Pixels.createFromImageBitmap(s):this.pixels=Ve.Pixels.createFromPixels(r)}static isPowerOf2(e){return e!=0&&(e&e-1)==0}static nextPowerOf2(e){return e=e-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e=e+1,e}isGIF(){return this.gif!=null}pixelAtIndex(e,t){if(e<0||e>=this.width||t<0||t>=this.height)return C.TRANSPARENT;if(this.pixels.array!=null){let r=this.pixels.array,n=t*this.width*4+e*4,o=r[n],a=r[n+1],s=r[n+2],l=r[n+3];return C.new2(o,a,s,l)}else{if(this.pixels.img!=null)throw new Error("pixelAtIndex not implemented for image-based buffers");{let r=Xn.HTMLCanvasElement_getContext2D(this.pixels.canvas).getImageData(e,t,1,1).data;return C.new2(r[0],r[1],r[2],r[3])}}}expandToPowerOfTwo(){if(this.isGIF())return console.warn("ImageBuffer#expandToPowerOfTwo: unimplemented for GIF resources"),this;if(this.pixels.array!=null){let e=this.pixels.array,t=Ve.nextPowerOf2(this.width),r=Ve.nextPowerOf2(this.height),n=new Uint8Array(t*r*4);for(let o=0;o<t;o=o+1)for(let a=0;a<r;a=a+1)for(let s=0;s<4;s=s+1)n[s+(o+a*t)*4]=o<this.width&&a<this.height?e[s+(o+a*this.width)*4]:0;return Ve.createFromPixels(t,r,n)}else{if(this.pixels.img!=null)throw new Error("expandToPowerOfTwo not implemented for image-based buffers");{let e=document.createElement("canvas");return e.width=Ve.nextPowerOf2(this.width),e.height=Ve.nextPowerOf2(this.height),Xn.HTMLCanvasElement_getContext2D(e).drawImage(this.pixels.canvas,0,0,this.pixels.canvas.width,this.pixels.canvas.height),Ve.createFromCanvas(e)}}}static initialize(){Ve._worker==null&&(Ve._worker=new Da(cr.getWorkerURL()??"ts-imagedecoder.js"),Ve._worker.mainThreadFallback=e=>Ve.handleWorkerEvent(e),Ve._worker.onmessage=e=>{let t=e.data;if(t==null){console.log("No data received from image decode worker");return}let r=zt.IntMap_get(Ve._pendingRequests,t.id,null);if(r==null)return;if(Ve._pendingRequests.delete(t.id),t.width>0&&t.height>0&&t.pixels!=null){let d=Ve.createFromPixels(t.width,t.height,t.pixels);Ve.dimensionsNeedDownsizing(t.width,t.height,Ve.computeMaxRes())&&(console.log("downsampling after worker"),d=Ve._downsampleBilinear(d,Ve.getMaxRes())),console.log(`image decode succeeded, got ${d.width}x${d.height} image`),r.resolve(d);return}else if(t.width>0&&t.height>0&&t.gif!=null){let d=Ve.createFromGif(t.width,t.height,t.gif);console.log(`GIF decode succeeded, got ${d.width}x${d.height} image`),r.resolve(d);return}console.log("image decode failed, falling back to the browser's image decoder instead");let n=Bn.HTMLDocument_createElementImage(document),o=Id.readFromJPEG(r.bytes),a=o!=null?xl.ImageOrientation_rotationDegrees(o.value):0,s=o!=null?xl.ImageOrientation_shouldFlip(o.value):!1,l=URL.createObjectURL(new Blob([r.bytes]));n.onerror=()=>{URL.revokeObjectURL(l),r.reject()};let c=()=>{URL.revokeObjectURL(l);let d=Ve._context!=null?Ve._context:Ve._context=Xn.HTMLCanvasElement_getContext2D(Bn.HTMLDocument_createElementCanvas(document)),h=d.canvas;if(n.width>0&&n.height>0){console.log(`image decode fallback succeeded, got ${n.width}x${n.height} image`);let u=a==0||a==180?n.width:n.height,m=a==0||a==180?n.height:n.width;h.width=u,h.height=m,d.save(),s&&(d.translate(h.width,0),d.scale(-1,1)),a==90?(d.translate(u,0),d.rotate(a*Math.PI/180)):a==180?(d.translate(u/2|0,m/2|0),d.rotate(a*Math.PI/180),d.translate(-u/2|0,-m/2|0)):a==270&&(d.translate(0,m),d.rotate(a*Math.PI/180)),d.drawImage(n,0,0,n.width,n.height),d.restore();let g=Ve.createFromPixels(u,m,new Uint8Array(d.getImageData(0,0,u,m).data.buffer));Ve.dimensionsNeedDownsizing(u,m,Ve.computeMaxRes())&&(g=Ve._downsampleBilinear(g,Ve.getMaxRes())),r.resolve(g);return}console.log("image decode fallback failed, giving up"),r.reject()};n.onload=()=>{X.htmlImageDecodeMethodIsPresent()?n.decode().then(d=>{c()},d=>{Mr.trackImageDecodeFailure("Slow decode fallback decode"),c()}):c()},n.src=l})}static setRamInUse(e){Ve._ramInUse=e}static setVRamInUse(e){Ve._vramInUse=e}static setMaxRes(e){Ve._maxRes=e}static getMaxRes(){return Ve._maxRes}static computeMaxRes(){if(!X.shouldApplyMobileOptimizations())return Ve._maxRes;let e=2048;return Ve._vramInUse>200||Ve._ramInUse>200?e=256:Ve._vramInUse>150||Ve._ramInUse>150?e=512:(Ve._vramInUse>100||Ve._ramInUse>100)&&(e=1024),e!=Ve._maxRes&&(Ve._maxRes=e),e}static decodeImageBuffer(e,t){return e=new Uint8Array(e),new Promise((r,n)=>{Ve.initialize(),Ve._worker.postMessage1(new tm(Ve._nextID,e,Ve.computeMaxRes(),t)),Ve._pendingRequests.set(Ve._nextID,new Ve.PendingRequest(e,r,()=>{n(new An)})),Ve._nextID=Ve._nextID+1})}static dimensionsNeedDownsizing(e,t,r){return r<=0||e<=Ve._maxRes&&t<=Ve._maxRes&&(e<13||t<13)||e*t<r*r*.5?!1:e>r||t>r}static handleWorkerEvent(e){var r;let t=null;if(e.isGIF)t=Gd.decodeBytes(e.bytes);else{try{t=em.Decoder.decodeBytes(e.bytes)}catch{}t==null&&(t=Ve._decodeJPEG(e.bytes)),t!=null&&Ve.dimensionsNeedDownsizing(t.width,t.height,e.maxRes)&&(t=Ve._downsampleBilinear(t,e.maxRes))}return new rm(e.id,t!=null?t.width:0,t!=null?t.height:0,t!=null?(r=t.pixels)==null?void 0:r.array:null,t!=null?t.gif:null)}static _decodeJPEG(e){let t=new Fl.Decoder;if(t.decodeBytes(e)!=Fl.Result.OK)return null;let r=t.width(),n=t.height(),o=t.rgb(),a=new Uint8Array(r*n*4),s=0,l=0;for(let c=0,d=r*n;c<d;c=c+1)a[l]=o[s],a[l+1]=o[s+1],a[l+2]=o[s+2],a[l+3]=255,s=s+3,l=l+4;return Ve.createFromPixels(r,n,a)}static redIndex(e,t,r){return(t*r+e)*4}static _downsampleBilinear(e,t){let r=Math.max(e.width,e.height);if(r<=0||t<=0)return e;let n=t/r,o=1/n,a=e.width*n|0,s=e.height*n|0,l=new Uint8Array(a*s*4),c=e.pixels.array;for(let d=0;d<s;d=d+1){let h=o*d,u=h-(h|0),m=d*a*4;for(let g=0;g<a;g=g+1){let _=o*g,f=_-(_|0),S=Ve.redIndex(g*o|0,d*o|0,e.width),b=c[S],T=c[S+1],y=c[S+2],I=c[S+3];g<a-1&&(S=Ve.redIndex((g*o|0)+1,d*o|0,e.width));let p=c[S],A=c[S+1],v=c[S+2],E=c[S+3];d<s-1?S=Ve.redIndex(g*o|0,(d*o|0)+1,e.width):S=Ve.redIndex(g*o|0,d*o|0,e.width);let D=c[S],G=c[S+1],U=c[S+2],M=c[S+3];d<s-1&&g<a-1&&(S=Ve.redIndex((g*o|0)+1,(d*o|0)+1,e.width));let z=c[S],B=c[S+1],w=c[S+2],P=c[S+3],H=1-f,Q=1-u;l[m]=(b*H+p*f)*Q+(D*H+z*f)*u|0,l[m+1]=(T*H+A*f)*Q+(G*H+B*f)*u|0,l[m+2]=(y*H+v*f)*Q+(U*H+w*f)*u|0,l[m+3]=(I*H+E*f)*Q+(M*H+P*f)*u|0,m=m+4}}return Ve.createFromPixels(a,s,l)}};Ve._pendingRequests=new Map,Ve._worker=null,Ve._nextID=0,Ve._context=null,Ve._handleResponse=null,Ve._ramInUse=0,Ve._vramInUse=0,Ve._maxRes=4096;var _r=Ve;(t=>{class i{static createFromPixels(n){return new i(n,null,null,null)}static createFromCanvas(n){return new i(null,n,null,null)}static createFromImage(n){return new i(null,null,n,null)}static createFromImageBitmap(n){return new i(null,null,null,n)}constructor(n,o,a,s){this.array=n,this.canvas=o,this.img=a,this.imageBitmap=s}}t.Pixels=i;class e{constructor(n,o,a){this.bytes=n,this.resolve=o,this.reject=a}}t.PendingRequest=e})(_r||(_r={}));var ea=(t=>(t[t.ANIMATED=0]="ANIMATED",t[t.STATIC_IMAGE=1]="STATIC_IMAGE",t))(ea||{}),tm=class{constructor(e,t,r,n){this.id=0,this.bytes=null,this.maxRes=0,this.isGIF=!1,this.id=e,this.bytes=t,this.maxRes=r,this.isGIF=n==0}},rm=class i{static empty(e){return new i(e,0,0,null,null)}constructor(e,t,r,n,o){this.id=e,this.width=t,this.height=r,this.pixels=n,this.gif=o}};var R=class i{constructor(e,t){this._x=0,this._y=0,this._x=e,this._y=t}x(){return this._x}y(){return this._y}setX(e){this._x=e}setY(e){this._y=e}multiply(e){return new i(this.x()*e,this.y()*e)}multiply1(e){return new i(this.x()*e.x(),this.y()*e.y())}add(e){return new i(this.x()+e,this.y()+e)}add1(e){return new i(this.x()+e.x(),this.y()+e.y())}negative(){return new i(-this.x(),-this.y())}subtract(e){return new i(this.x()-e,this.y()-e)}subtract1(e){return new i(this.x()-e.x(),this.y()-e.y())}divide(e){return new i(this.x()/e,this.y()/e)}divide1(e){return new i(this.x()/e.x(),this.y()/e.y())}clone(){return new i(this.x(),this.y())}dot(e){return this.x()*e.x()+this.y()*e.y()}equals(e){return this.x()==e.x()&&this.y()==e.y()}freeze(){return this.clone()}isZero(){return this.x()==0&&this.y()==0}isPositive(){return this.x()>0&&this.y()>0}length(){return Math.sqrt(this.x()*this.x()+this.y()*this.y())}max1(){return Math.max(this.x(),this.y())}max2(e){return new i(Math.max(this.x(),e.x()),Math.max(this.y(),e.y()))}min1(){return Math.min(this.x(),this.y())}min2(e){return new i(Math.min(this.x(),e.x()),Math.min(this.y(),e.y()))}distanceTo(e){return Math.sqrt(this.squaredDistanceTo(e))}withOnesForZeros(){return new i(this.x()==0?1:this.x(),this.y()==0?1:this.y())}area(){return this.x()*this.y()}squaredDistanceTo(e){let t=this.x()-e.x(),r=this.y()-e.y();return t*t+r*r}approximatelyEquals(e,t){return this.squaredDistanceTo(e)<=t*t}mixedWith(e,t){return new i(this.x()+(e.x()-this.x())*t,this.y()+(e.y()-this.y())*t)}flipped(){return new i(this._y,this._x)}mixWith(e,t){this._x+=(e.x()-this.x())*t,this._y+=(e.y()-this.y())*t}addUpdate(e){this._x+=e,this._y+=e}addUpdate1(e){this._x+=e.x(),this._y+=e.y()}subtractUpdate(e){this._x-=e,this._y-=e}subtractUpdate1(e){this._x-=e.x(),this._y-=e.y()}multiplyUpdate(e){this._x*=e,this._y*=e}multiplyUpdate1(e){this._x*=e.x(),this._y*=e.y()}divideUpdate(e){this._x/=e,this._y/=e}divideUpdate1(e){this._x/=e.x(),this._y/=e.y()}rounded(){return new i(Math.round(this._x),Math.round(this._y))}setTo(e,t){return this._x=e,this._y=t,this}copyFrom(e){return this._x=e.x(),this._y=e.y(),this}makeAbs(){return this._x=Math.abs(this._x),this._y=Math.abs(this._y),this}toString(){return`Vector(${this.x()}, ${this.y()})`}toJSON(){return{x:this._x,y:this._y}}static new2(){return new i(0,0)}static new3(e){return new i(e.x(),e.y())}static cross(e,t){return e.x()*t.y()-e.y()*t.x()}static lerp(e,t,r){return e.multiply(1-r).add1(t.multiply(r))}static equals_(e,t){return e==null!=(t==null)?!1:e==null?!0:e.equals(t)}},ye;(s=>{function i(){return R.new2()}s.FrozenVector_new1=i;function e(l){return l}s.FrozenVector_new2=e;function t(l){return R.new3(l)}s.FrozenVector_new3=t;function r(l,c){return new R(l,c)}s.FrozenVector_new4=r,s.FrozenVector_ZERO=i(),s.FrozenVector_ONE=r(1,1),s.FrozenVector_INFINITY=r(1/0,1/0)})(ye||(ye={}));var Gr=class Gr{static fromMinAndMax(e,t,r,n){return new Gr(e,t,r-e,n-t)}static fromRect(e){return new Gr(e.x(),e.y(),e.width(),e.height())}constructor(e,t,r,n){this._x=0,this._y=0,this._width=0,this._height=0,this._x=e,this._y=t,this._width=r,this._height=n}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}setX(e){this._x=e}setY(e){this._y=e}setWidth(e){this._width=e}setHeight(e){this._height=e}clone(){return new Gr(this.x(),this.y(),this.width(),this.height())}freeze(){return this.clone()}left(){return this.x()}top(){return this.y()}right(){return this.x()+this.width()}bottom(){return this.y()+this.height()}centerX(){return this.x()+this.width()/2}centerY(){return this.y()+this.height()/2}area(){return this.width()*this.height()}isEmpty(){return!(this.width()>0&&this.height()>0)}isInvalid(){return!(this.width()>=0&&this.height()>=0)}isFinite(){return isFinite(this._x)&&isFinite(this._y)&&isFinite(this._width)&&isFinite(this._height)}equals(e){return this.x()==e.x()&&this.y()==e.y()&&this.width()==e.width()&&this.height()==e.height()}contains1(e){return this.isEmpty()||e.isEmpty()?!1:this._x<=e.x()&&this._y<=e.y()&&this._x+this._width>=e.x()+e.width()&&this._y+this._height>=e.y()+e.height()}contains2(e){return!this.isEmpty()&&e!=null&&this.left()<=e.x()&&e.x()<this.right()&&this.top()<=e.y()&&e.y()<this.bottom()}overlaps(e){return!this.isEmpty()&&e!=null&&!e.isEmpty()&&this.left()<e.right()&&e.left()<this.right()&&this.top()<e.bottom()&&e.top()<this.bottom()}distanceTo(e){let t=Math.max(0,Math.abs(this.centerX()-e.centerX())-(this.width()+e.width())/2),r=Math.max(0,Math.abs(this.centerY()-e.centerY())-(this.height()+e.height())/2);return Math.sqrt(t*t+r*r)}topLeft(){return new R(this.left(),this.top())}topRight(){return new R(this.right(),this.top())}bottomLeft(){return new R(this.left(),this.bottom())}bottomRight(){return new R(this.right(),this.bottom())}size(){return new R(this.width(),this.height())}center(){return new R(this.x()+this.width()/2,this.y()+this.height()/2)}centerSelf(){return this.translate2(this.center().negative()),this}translate1(e,t){this._x+=e,this._y+=t}translate2(e){this._x+=e.x(),this._y+=e.y()}translatedBy(e){let t=this.clone();return t.translate2(e),t}scaleFromCenter(e){e-=1,this.expand2(this.width()*e,this.height()*e)}scaledBy1(e){return this.scaledBy2(new R(e,e))}scaledBy2(e){return this.isInvalid()?this.copyFrom(Gr.INVALID):this.isFinite()?(this._x=this._x*e.x(),this._y=this._y*e.y(),this._width=this._width*e.x(),this._height=this._height*e.y(),this):this.copyFrom(Gr.INFINITE)}expandToInts(){let e=Math.floor(this._x),t=Math.floor(this._y);this._width=Math.ceil(this._x+this._width)-e,this._height=Math.ceil(this._y+this._height)-t,this._x=e,this._y=t}setTo1(e,t,r,n){return this._x=e,this._y=t,this._width=r,this._height=n,this}setTo2(e,t){return this._x=e.x(),this._y=e.y(),this._width=t.x(),this._height=t.y(),this}copyFrom(e){return this.setX(e.x()),this.setY(e.y()),this.setWidth(e.width()),this.setHeight(e.height()),this}expand1(e){this._x-=e,this._y-=e,this._width+=2*e,this._height+=2*e}contract(e){this.expand1(-e)}expandedBy1(e){return this.expand1(e),this}expandedBy2(e,t){return this.expand2(e,t),this}expand2(e,t){this._x-=e,this._y-=t,this._width+=2*e,this._height+=2*t}expandToInclude(e){if(e.isEmpty())return;if(this.isEmpty()){this.copyFrom(e);return}let t=Math.min(this._x,e.x()),r=Math.min(this._y,e.y());this._width=Math.max(this._x+this._width,e.x()+e.width())-t,this._height=Math.max(this._y+this._height,e.y()+e.height())-r,this._x=t,this._y=r}intersectedWith(e){return this.intersectWith(e),this}intersectWith(e){if(this.isEmpty()||e.isEmpty())this.copyFrom(Br.FrozenRect_EMPTY);else{let t=Math.max(this._x,e.x()),r=Math.max(this._y,e.y());this._width=Math.min(this._x+this._width,e.x()+e.width())-t,this._height=Math.min(this._y+this._height,e.y()+e.height())-r,this._x=t,this._y=r}}round(){let e=Math.round(this._x),t=Math.round(this._y),r=Math.round(this._x+this._width),n=Math.round(this._y+this._height);this._x=e,this._y=t,this._width=r-e,this._height=n-t}rounded(){return this.round(),this}toString(){return`Rect(${this.x()}, ${this.y()}, ${this.width()}, ${this.height()})`}transformInto1(e,t){bt.INSTANCE.reset();let r=R.new2();for(let n=0;n<4;n=n+1)r.setTo(this._x+this._width*(n&1),this._y+this._height*(n>>1)),t.transformPoint(r),bt.INSTANCE.include2(r);bt.INSTANCE.buildTo(e)}transformBy1(e){this.transformInto1(this,e)}transformInto2(e,t){bt.INSTANCE.reset();let r=R.new2();for(let n=0;n<4;n=n+1)r.setTo(this._x+this._width*(n&1),this._y+this._height*(n>>1)),t.transformPoint(r),bt.INSTANCE.include2(r);bt.INSTANCE.buildTo(e)}transformBy2(e){this.transformInto2(this,e)}leftThird(){return new Gr(this._x,this._y,this._width/3,this._height)}rightThird(){let e=this._width/3;return new Gr(this._x+2*e,this._y,this._width/3,this._height)}static new2(){return new Gr(0,0,0,0)}static new3(e){return new Gr(e.x(),e.y(),e.width(),e.height())}static new4(e,t){return new Gr(e.x(),e.y(),t.x(),t.y())}};Gr.INVALID=new Gr(1/0,1/0,-1/0,-1/0),Gr.INFINITE=new Gr(-1/0,-1/0,1/0,1/0),Gr.CLIP=Gr.fromMinAndMax(-1,-1,1,1),Gr.UNIT=new Gr(0,0,1,1);var V=Gr,Hd=class Hd{constructor(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this.reset()}isValid(){return this._minX<this._maxX&&this._minY<this._maxY}isValidOrZeroArea(){return this._minX<=this._maxX&&this._minY<=this._maxY}reset(){this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0}include1(e,t){this._minX=Math.min(this._minX,e),this._minY=Math.min(this._minY,t),this._maxX=Math.max(this._maxX,e),this._maxY=Math.max(this._maxY,t)}include2(e){this.include1(e.x(),e.y())}include3(e){e!=null&&!e.isEmpty()&&(this.include1(e.left(),e.top()),this.include1(e.right(),e.bottom()))}include4(e,t){if(!e.isEmpty()){let r=V.new2();e.transformInto1(r,t),this.include3(r)}}buildTo(e){e.setTo1(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY)}build(){let e=V.new2();return this.buildTo(e),e}};Hd.INSTANCE=new Hd;var bt=Hd,Di=class i{constructor(){if(arguments[0]==0){let[,e,t,r,n]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=V.new4(e,t),this._nodeRadius=r,this._cornerSmoothing=n}else if(arguments[0]==1){let[,e,t,r,n]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=V.new4(e,t),this._vertexRadii=r,this._cornerSmoothing=n}else if(arguments[0]==2){let[,e,t,r,n]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=e,this._nodeRadius=t,this._vertexRadii=r}}clone(){var e;return new i(2,this._rect.clone(),this._nodeRadius,(e=this._vertexRadii)==null?void 0:e.slice(),this._cornerSmoothing)}cornerSmoothing(){return this._cornerSmoothing}left(){return this._rect.x()}top(){return this._rect.top()}width(){return this._rect.width()}height(){return this._rect.height()}rect(){return this._rect}nodeRadius(){return this._nodeRadius}vertexRadii(){return this._vertexRadii}isRounded(){return this._nodeRadius>0||this._vertexRadii!=null&&this._vertexRadii.some(e=>e>0)}isUniform(){return this._nodeRadius>0&&this._vertexRadii==null||this._vertexRadii!=null&&this._vertexRadii[0]==this._vertexRadii[1]&&this._vertexRadii[1]==this._vertexRadii[2]&&this._vertexRadii[2]==this._vertexRadii[3]}isSimpleRoundedRect(){return this.isUniform()&&this._cornerSmoothing==0}transform(e){e.transformRect(this._rect)}contract(e){this._rect.contract(e)}expand(e){this._rect.expand1(e)}adjustCornerRadiiForSpread(e){if(this._vertexRadii!=null)for(let t=0,r=this.vertexRadii().length;t<r;t=t+1)this._vertexRadii[t]!=0&&(this._vertexRadii[t]=Math.max(this._vertexRadii[t]+e,0));else this._nodeRadius!=0&&(this._nodeRadius=Math.max(this._nodeRadius+e,0))}},Br;(o=>{function i(){return V.new2()}o.FrozenRect_new1=i;function e(a){return a}o.FrozenRect_new2=e;function t(a){return V.new3(a)}o.FrozenRect_new3=t;function r(a,s,l,c){return new V(a,s,l,c)}o.FrozenRect_new4=r,o.FrozenRect_EMPTY=i()})(Br||(Br={}));var Li;(c=>{function i(){let d=Xn.HTMLCanvasElement_getContextWebGL1(Bn.HTMLDocument_createElementCanvas(document),X.shouldUseWebGL2());if(d==null)return!1;let h=d.canvas;document.body.appendChild(h);let u=d.createProgram(),m=d.createShader(d.VERTEX_SHADER);d.shaderSource(m,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),d.compileShader(m),d.attachShader(u,m);let g=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(g,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0., 0., 0., 1.);
        }
      `),d.compileShader(g),d.attachShader(u,g),d.bindAttribLocation(u,0,"pos"),d.linkProgram(u);let _=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,_);let f=new Float32Array([0,0,1,0,0,1,1,1]);d.bufferData(d.ARRAY_BUFFER,f.length*4,d.DYNAMIC_DRAW),d.bufferSubData(d.ARRAY_BUFFER,0,f),d.enableVertexAttribArray(0),d.vertexAttribPointer(0,2,d.FLOAT,!1,8,0),d.canvas.width=10,d.canvas.height=1;let S=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,S);let b=d.createTexture();d.bindTexture(d.TEXTURE_2D,b),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,b),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.canvas.width,d.canvas.height,0,d.RGBA,d.UNSIGNED_BYTE,null),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,b,0),d.useProgram(u),d.bindFramebuffer(d.FRAMEBUFFER,S),d.viewport(0,0,d.canvas.width/2|0,d.canvas.height),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,null),d.viewport(0,0,d.canvas.width/2|0,d.canvas.height),d.drawArrays(d.TRIANGLE_STRIP,0,4);let T=new Uint8Array(4);return d.readPixels((d.canvas.width/2|0)+2,0,1,1,d.RGBA,d.UNSIGNED_BYTE,T),document.body.removeChild(h),T[3]!=0}c._featureDetectViewportBug=i;function e(){let d=Xn.HTMLCanvasElement_getContextWebGL1(Bn.HTMLDocument_createElementCanvas(document),X.shouldUseWebGL2());if(d==null)return!1;let h=d.canvas;document.body.appendChild(h),d.canvas.width=1,d.canvas.height=1;let u=d.createTexture();d.bindTexture(d.TEXTURE_2D,u),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,u),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.canvas.width,d.canvas.height,0,d.RGBA,d.UNSIGNED_BYTE,null),d.bindTexture(d.TEXTURE_2D,u);let m=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,m),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,u,0);let g=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,g),d.bufferData(d.ARRAY_BUFFER,32,d.DYNAMIC_DRAW),d.bufferSubData(d.ARRAY_BUFFER,0,new Float32Array([1,1,1,-1,-1,1,-1,-1])),d.vertexAttribPointer(0,2,d.FLOAT,!1,8,0),d.enableVertexAttribArray(0),d.bindBuffer(d.ARRAY_BUFFER,g);let _=d.createProgram(),f=d.createShader(d.VERTEX_SHADER);d.shaderSource(f,`
        precision highp float;
        attribute vec2 pos;
        varying vec2 uv;
        void main(){
          uv = (pos + vec2(1.0)) / 2.0;
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),d.compileShader(f),d.attachShader(_,f);let S=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(S,`
        precision highp float;
        uniform sampler2D texture;
        varying vec2 uv;
        void main(){
          gl_FragColor=texture2D(texture, uv);
        }
      `),d.compileShader(S),d.attachShader(_,S),d.linkProgram(_);let b=d.createProgram(),T=d.createShader(d.VERTEX_SHADER);d.shaderSource(T,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos,0.,1.);
        }
      `),d.compileShader(T),d.attachShader(b,T);let y=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(y,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0.,0.,1.,1.);
        }
      `),d.compileShader(y),d.attachShader(b,y),d.bindAttribLocation(b,0,"pos"),d.linkProgram(b),d.clearColor(1,0,0,1),d.bindFramebuffer(d.FRAMEBUFFER,m),d.useProgram(b),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,null),d.useProgram(_),d.drawArrays(d.TRIANGLE_STRIP,0,4),d.bindFramebuffer(d.FRAMEBUFFER,m),d.clear(d.COLOR_BUFFER_BIT),d.bindFramebuffer(d.FRAMEBUFFER,null),d.useProgram(_),d.drawArrays(d.TRIANGLE_STRIP,0,4);let I=new Uint8Array(4);return d.readPixels(0,0,1,1,d.RGBA,d.UNSIGNED_BYTE,I),document.body.removeChild(h),I[0]!=255}c._featureDetectDrawClearReorderingBug=e;function t(){return c._hasViewportBug==null?(Le("Called hasViewportBug before running feature detection"),!1):c._hasViewportBug.value}c.hasViewportBug=t;function r(){return c._hasDrawClearReorderingBug==null?(Le("Called hasDrawClearReorderingBug before running feature detection"),!1):c._hasDrawClearReorderingBug.value}c.hasDrawClearReorderingBug=r;function n(){return c._hasUnexpectedCompositingBug==null?(Le("Called hasDrawClearReorderingBug before running feature detection"),!1):c._hasUnexpectedCompositingBug.value}c.hasUnexpectedCompositingBug=n;function o(){c._hasViewportBug=new fe(i()),t()&&console.warn("GPUBugs: device has buggy implementation of gl.viewport. Will apply workarounds."),c._hasDrawClearReorderingBug=new fe(e()),r()&&console.warn("GPUBugs: Device may re-order draw/clear commands. Will apply workarounds.");let d=navigator.userAgent,h=(d.indexOf("iPhone OS 14_0")|0)!=-1,u=(d.indexOf("iPhone OS 14_1")|0)!=-1,m=h||u,g=(d.indexOf("iPad; CPU OS 14_0")|0)!=-1,_=(d.indexOf("iPad; CPU OS 14_1")|0)!=-1,f=g||_,b=(d.indexOf("Version/14")|0)!=-1&&(d.indexOf("Safari")|0)!=-1&&(navigator.maxTouchPoints|0)>0;c._hasUnexpectedCompositingBug=new fe(m||f||b)}c.detect=o,c._hasViewportBug=null,c._hasDrawClearReorderingBug=null,c._hasUnexpectedCompositingBug=null})(Li||(Li={}));var O;(Me=>{function i(){return Me._supportsWebGLExtensionOESStandardDerivatives}Me.supportsWebGLExtensionOESStandardDerivatives=i;function e(dt){Me._supportsWebGLExtensionOESStandardDerivatives=dt}Me.setSupportsWebGLExtensionOESStandardDerivatives=e;function t(dt){return dt==0?4:1}Me.byteCount=t;function r(dt){window.testFakeLostContext=()=>{let N=dt.getExtension("WEBGL_lose_context");N.loseContext();let k=3;setTimeout(()=>{console.log(`waiting ${k} seconds to restore the context...`)},500),setTimeout(()=>{N.restoreContext()},k*1e3)},window.testRealLostContext=()=>{let N=[];for(let k=0;k<32;k=k+1)N.push(Xn.HTMLCanvasElement_getContextWebGL1(Bn.HTMLDocument_createElementCanvas(document),X.shouldUseWebGL2()))}}Me.addContextLossTestFunctionsToGlobalScope=r;function n(dt){let N=dt==null?void 0:dt.graphicsCardName();return N!=null&&N.indexOf("SwiftShader")!=-1}Me.isUsingSoftwareRenderer=n;let o;(oe=>(oe[oe.ZERO=0]="ZERO",oe[oe.ONE=1]="ONE",oe[oe.SOURCE_COLOR=2]="SOURCE_COLOR",oe[oe.TARGET_COLOR=3]="TARGET_COLOR",oe[oe.INVERSE_SOURCE_COLOR=4]="INVERSE_SOURCE_COLOR",oe[oe.INVERSE_TARGET_COLOR=5]="INVERSE_TARGET_COLOR",oe[oe.SOURCE_ALPHA=6]="SOURCE_ALPHA",oe[oe.TARGET_ALPHA=7]="TARGET_ALPHA",oe[oe.INVERSE_SOURCE_ALPHA=8]="INVERSE_SOURCE_ALPHA",oe[oe.INVERSE_TARGET_ALPHA=9]="INVERSE_TARGET_ALPHA",oe[oe.CONSTANT=10]="CONSTANT",oe[oe.INVERSE_CONSTANT=11]="INVERSE_CONSTANT"))(o=Me.BlendOperation||(Me.BlendOperation={}));let vt=class vt{static createInterpolateBlendState(N){return new vt(10,11,10,11,N)}constructor(N,k,$,ae,se){this.sourceColor=N,this.targetColor=k,this.sourceAlpha=$,this.targetAlpha=ae,this.constant=se}};vt.ZERO=new vt(0,0,0,0,0),vt.COPY=new vt(1,0,1,0,0),vt.KEEP=new vt(0,1,0,1,0),vt.PREMULTIPLIED=new vt(1,8,1,8,0),vt.PREMULTIPLIED_SOURCE_UNDER_TARGET=new vt(9,1,9,1,0),vt.UNPREMULTIPLIED=new vt(6,8,6,8,0),vt.SCREEN=new vt(1,4,1,8,0);let a=vt;Me.BlendState=vt;let s;($=>($[$.ALL=0]="ALL",$[$.COLOR=1]="COLOR",$[$.DEPTH_STENCIL=2]="DEPTH_STENCIL"))(s=Me.Clear||(Me.Clear={}));let l;(k=>(k[k.TRIANGLES=0]="TRIANGLES",k[k.TRIANGLE_STRIP=1]="TRIANGLE_STRIP"))(l=Me.Primitive||(Me.Primitive={}));let c;(we=>(we[we.ALWAYS=0]="ALWAYS",we[we.EQUAL=1]="EQUAL",we[we.GREATER_THAN=2]="GREATER_THAN",we[we.GREATER_THAN_OR_EQUAL=3]="GREATER_THAN_OR_EQUAL",we[we.LESS_THAN=4]="LESS_THAN",we[we.LESS_THAN_OR_EQUAL=5]="LESS_THAN_OR_EQUAL",we[we.NEVER=6]="NEVER",we[we.NOT_EQUAL=7]="NOT_EQUAL"))(c=Me.Comparison||(Me.Comparison={}));let d;(we=>(we[we.DECREMENT_CLAMP=0]="DECREMENT_CLAMP",we[we.DECREMENT_WRAP=1]="DECREMENT_WRAP",we[we.INCREMENT_CLAMP=2]="INCREMENT_CLAMP",we[we.INCREMENT_WRAP=3]="INCREMENT_WRAP",we[we.INVERT=4]="INVERT",we[we.KEEP=5]="KEEP",we[we.REPLACE=6]="REPLACE",we[we.ZERO=7]="ZERO"))(d=Me.StencilOperation||(Me.StencilOperation={}));let ct=class ct{equals(N){return this==N||this.reference==N.reference&&this.comparison==N.comparison&&this.readMask==N.readMask&&this.writeMask==N.writeMask&&this.stencilFail==N.stencilFail&&this.stencilPassDepthFail==N.stencilPassDepthFail&&this.stencilPassDepthPass==N.stencilPassDepthPass}constructor(N,k,$,ae,se,Re,Pe){this.reference=N,this.comparison=k,this.readMask=$,this.writeMask=ae,this.stencilFail=se,this.stencilPassDepthFail=Re,this.stencilPassDepthPass=Pe}};ct.NONE=new ct(0,6,0,-1,5,5,5);let h=ct;Me.StencilFaceState=ct;let qe=class qe{constructor(){if(arguments.length==0)this.isEnabled=!1,this.frontFace=h.NONE,this.backFace=h.NONE;else if(arguments.length==1){let N=arguments[0];this.isEnabled=!0,this.frontFace=N,this.backFace=N}else arguments.length==2&&(this.isEnabled=!0,this.frontFace=arguments[0],this.backFace=arguments[1])}equals(N){return this==N||this.isEnabled==N.isEnabled&&this.frontFace.equals(N.frontFace)&&this.backFace.equals(N.backFace)}};qe.NONE=new qe;let u=qe;Me.StencilState=qe;class m{constructor(N,k){this.canvasSize=N,this.webGLDidAdjustCanvasSize=k}}Me.ComputedCanvasSize=m;let g;(k=>(k[k.FLOAT=0]="FLOAT",k[k.BYTE=1]="BYTE"))(g=Me.AttributeType||(Me.AttributeType={}));class _{constructor(N,k,$,ae){this.name=N,this.type=k,this.count=$,this.byteOffset=ae}}Me.Attribute=_;class f{attributes(){return this._attributes}stride(){return this._stride}add(N,k,$){return this._attributes.push(new _(N,k,$,this._stride)),this._stride=this._stride+$*t(k),this}constructor(){this._attributes=[],this._stride=0}static getPositionF2(){return f._POSITION_F2||(f._POSITION_F2=new f().add(wr.instance().GLSLX_NAME_A_POSITION2,0,2)),f._POSITION_F2}static getPositionF2CoordF3(){return f._POSITION_F2_COORD_F3||(f._POSITION_F2_COORD_F3=new f().add(wr.instance().GLSLX_NAME_A_POSITION2,0,2).add(wr.instance().GLSLX_NAME_A_COORD3,0,3)),f._POSITION_F2_COORD_F3}static getPositionF4CoordF4(){return f._POSITION_F4_COORD_F4||(f._POSITION_F4_COORD_F4=new f().add(wr.instance().GLSLX_NAME_A_POSITION4,0,4).add(wr.instance().GLSLX_NAME_A_COORD4,0,4)),f._POSITION_F4_COORD_F4}static getPositionF4CoordB4(){return f._POSITION_F4_COORD_B4||(f._POSITION_F4_COORD_B4=new f().add(wr.instance().GLSLX_NAME_A_POSITION4,0,4).add(wr.instance().GLSLX_NAME_A_COORD4,1,4)),f._POSITION_F4_COORD_B4}static getPositionF4(){return f._POSITION_F4||(f._POSITION_F4=new f().add(wr.instance().GLSLX_NAME_A_POSITION4,0,4)),f._POSITION_F4}}Me.VertexFormat=f;let S;(k=>(k[k.RGBA_32=0]="RGBA_32",k[k.DEPTH_24_STENCIL_8=1]="DEPTH_24_STENCIL_8"))(S=Me.PixelFormat||(Me.PixelFormat={}));let b;(k=>(k[k.NEAREST=0]="NEAREST",k[k.LINEAR=1]="LINEAR"))(b=Me.PixelFilter||(Me.PixelFilter={}));let T;(k=>(k[k.REPEAT=0]="REPEAT",k[k.CLAMP=1]="CLAMP"))(T=Me.PixelWrap||(Me.PixelWrap={}));let tt=class tt{constructor(N,k,$,ae){this.pixelFormat=N,this.minFilter=k,this.magFilter=$,this.wrap=ae}};tt.RGBA_LINEAR_CLAMP=new tt(0,1,1,1),tt.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP=new tt(0,1,0,1),tt.RGBA_NEAREST_CLAMP=new tt(0,0,0,1),tt.RGBA_NEAREST_REPEAT=new tt(0,0,0,0),tt.STENCIL=new tt(1,0,0,1);let y=tt;Me.TextureFormat=tt;class I{constructor(N,k){this.texture=null,this.uvSpaceRect=null,this.texture=N,this.uvSpaceRect=k}}Me.TextureRegion=I;let p;(ae=>{function dt(se){return se.length==0}ae.isEmpty=dt;function N(se,Re){return se[Re]}ae.get=N;function k(se){return ce.List_last(se)}ae.last=k;function $(se){return se.length}ae.count=$})(p=Me.FrozenScissors||(Me.FrozenScissors={}));class A{totalVRAM(){return this._chunks.length*v.BYTE_COUNT}allocate(N,k){if(k.length==0)return null;k.length<=v.BYTE_COUNT;let $=N.stride();for(let se of this._chunks){let Re=se.tryToAllocate($,k);if(Re!=null)return Re}let ae=new v(this,this._context.createVertexBuffer(v.BYTE_COUNT));return this._chunks.push(ae),ae.tryToAllocate($,k)}constructor(N){this._context=N,this._chunks=[]}}Me.BufferPool=A;let Qe=class Qe{tryToAllocate(N,k){let $=k.length,ae=this.areas,se=null;if(this.bytesUsed+$<=Qe.BYTE_COUNT){for(;ae.length!=0&&ce.List_last(ae).wasFreed();)ce.List_removeLast(ae);se=this.allocateAtEnd(N,k),se==null&&(this.runCompactingGC(),se=this.allocateAtEnd(N,k)),se!=null&&(this.buffer.upload2(k,se.byteOffset()),this.bytesUsed=this.bytesUsed+$,ae.push(se))}return se}allocateAtEnd(N,k){let $=this.areas.length==0?0:Qe._alignToNextMultiple(ce.List_last(this.areas).byteOffset()+ce.List_last(this.areas).byteCount(),N);return $+k.length<=Qe.BYTE_COUNT?new E(this,k.length,N,$,k):null}runCompactingGC(){let N=0;ce.List_removeIf(this.areas,k=>k.wasFreed()?!0:(N=Qe._alignToNextMultiple(N,k.stride()),k.byteOffset()!=N&&(this.buffer.move(k.byteOffset(),N,k.byteCount()),k.wasMovedTo(N)),N=N+k.byteCount(),!1)),Me.DISABLE_BUFFER_ASSERT||this.areas.forEach(k=>{k.assertBytesAreAsExpected()})}static _alignToNextMultiple(N,k){return N+St.int_remainder(k-St.int_remainder(N,k),k)}constructor(N,k){this.pool=N,this.buffer=k,this.areas=[],this.bytesUsed=0}};Qe.BYTE_COUNT=4*1024*1024;let v=Qe;Me.BufferChunk=Qe;class E{constructor(N,k,$,ae,se){this._chunk=null,this._byteCount=0,this._stride=0,this._byteOffset=0,this._wasFreed=!1,this._expectedArray=null,this._chunk=N,this._byteCount=k,this._stride=$,this._byteOffset=ae,this._saveBytes(se)}_saveBytes(N){this._expectedArray=new Uint8Array(N)}assertBytesAreAsExpected(){for(let N=0,k=this._byteCount;N<k;N=N+1)this._expectedArray[N]!=this._chunk.buffer.bytes()[N+this._byteOffset]}byteCount(){return this._byteCount}stride(){return this._stride}byteOffset(){return this._byteOffset}wasFreed(){return this._wasFreed}buffer(){return this._chunk.buffer}free(){this._wasFreed||(this._wasFreed=!0,this._chunk.bytesUsed-=this.byteCount())}wasMovedTo(N){this._byteOffset=N}}Me.BufferArea=E;class D{constructor(N,k){this._rectPoints=[R.new2(),R.new2(),R.new2(),R.new2()],this._inside=[],this._material=null,this._outside=[],this._vertices=new on,this._context=null,this._pixelScale=1,this._pool=null,this._previousColor=C.TRANSPARENT,this._previousU=0,this._previousV=0,this._previousX=0,this._previousY=0,this._context=N,this._pool=k,this._materialStrings=wr.instance(),this._material=N.createMaterial("smooth",f.getPositionF4CoordB4(),this._materialStrings.GLSLX_SOURCE_SMOOTH_PATH_VERTEX,this._materialStrings.GLSLX_SOURCE_SMOOTH_PATH_FRAGMENT)}pixelScale(){return this._pixelScale}setTransformAndPixelScale(N,k){3!=0,$e.Material_setUniformMat32(this._material,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,N),this._pixelScale=k}flush(){let N=this._pool.allocate(f.getPositionF4CoordB4(),this._vertices.bytes());N!=null&&(Tt.Context_setPremultipliedBlendState(this._context),this._context.draw(1,this._material,N),N.free()),this._vertices.clear()}_loadPoints(N){this._rectPoints[0].setTo(N.left(),N.top()),this._rectPoints[1].setTo(N.right(),N.top()),this._rectPoints[2].setTo(N.right(),N.bottom()),this._rectPoints[3].setTo(N.left(),N.bottom())}fillRect(N,k){this._loadPoints(N),this.fillConvexPolygon(this._rectPoints,k)}strokeRect(N,k,$){this._loadPoints(N),this.strokeNonOverlappingPolyline(this._rectPoints,k,$,D.Loop.CLOSED)}fillConvexPolygon(N,k){let $=this._inside,ae=this._outside,se=N.length;if(!(se<3)){for(k=C.premultiplied(k);$.length<se;)$.push(R.new2()),ae.push(R.new2());for(let Re=0,Pe=se;Re<Pe;Re=Re+1){let we=N[St.int_remainder(Re+se-1,se)],ve=N[Re],Ke=N[St.int_remainder(Re+1,se)],ht=we.y()-ve.y(),oe=ve.x()-we.x(),_e=this._length(ht,oe),le=ve.y()-Ke.y(),x=Ke.x()-ve.x(),F=this._length(le,x),q=ht/_e+le/F,Z=oe/_e+x/F,ie=.5*this._pixelScale*_e/(ht*q+oe*Z),de=q*ie,he=Z*ie;ae[Re].setTo(ve.x()-de,ve.y()-he),$[Re].setTo(ve.x()+de,ve.y()+he)}for(let Re=0,Pe=se-1;Re<=Pe;Re=Re+1,Pe=Pe-1){let we=$[Re],ve=$[Pe];this._appendVertex(we.x(),we.y(),1,1,k),Re==0&&this._appendPreviousVertex(),Re<Pe&&this._appendVertex(ve.x(),ve.y(),1,1,k)}this._appendPreviousVertex();for(let Re=0;Re<=se;Re=Re+1){let Pe=St.int_remainder(Re,se),we=$[Pe],ve=ae[Pe];this._appendVertex(ve.x(),ve.y(),0,0,k),Re==0&&this._appendPreviousVertex(),this._appendVertex(we.x(),we.y(),1,1,k)}this._appendPreviousVertex()}}strokeNonOverlappingPolyline(N,k,$,ae){let se=($+this._pixelScale)/this._pixelScale,Re=($+this._pixelScale)/2,Pe=N.length;if(Pe<2)return;if(k=C.premultiplied(k),ae==D.Loop.OPEN){let Ke=N[0],ht=N[1],oe=ht.x()-Ke.x(),_e=ht.y()-Ke.y(),le=this._length(oe,_e),x=.5*this._pixelScale/le,F=oe*x,q=_e*x,Z=Re/le,ie=-_e*Z,de=oe*Z;this._appendVertex(Ke.x()-F-ie,Ke.y()-q-de,0,-se,k),this._appendPreviousVertex(),this._appendVertex(Ke.x()-F+ie,Ke.y()-q+de,-se,0,k),this._appendVertex(Ke.x()+F-ie,Ke.y()+q-de,0,se,k),this._appendVertex(Ke.x()+F+ie,Ke.y()+q+de,se,0,k)}let we=ae==D.Loop.CLOSED?0:1,ve=ae==D.Loop.CLOSED?Pe+1:Pe-1;for(let Ke=we,ht=ve;Ke<ht;Ke=Ke+1){let oe=N[St.int_remainder(Ke+Pe-1,Pe)],_e=N[St.int_remainder(Ke,Pe)],le=N[St.int_remainder(Ke+1,Pe)],x=oe.y()-_e.y(),F=_e.x()-oe.x(),q=this._length(x,F),Z=_e.y()-le.y(),ie=le.x()-_e.x(),de=this._length(Z,ie),he=x/q+Z/de,xe=F/q+ie/de,Ee=Re*q/(x*he+F*xe),Ae=he*Ee,Ge=xe*Ee;this._appendVertex(_e.x()-Ae,_e.y()-Ge,0,se,k),Ke==0&&this._appendPreviousVertex(),this._appendVertex(_e.x()+Ae,_e.y()+Ge,se,0,k)}if(ae==D.Loop.OPEN){let Ke=N[Pe-2],ht=N[Pe-1],oe=ht.x()-Ke.x(),_e=ht.y()-Ke.y(),le=this._length(oe,_e),x=.5*this._pixelScale/le,F=oe*x,q=_e*x,Z=Re/le,ie=-_e*Z,de=oe*Z;this._appendVertex(ht.x()-F-ie,ht.y()-q-de,0,se,k),this._appendVertex(ht.x()-F+ie,ht.y()-q+de,se,0,k),this._appendVertex(ht.x()+F-ie,ht.y()+q-de,0,-se,k),this._appendVertex(ht.x()+F+ie,ht.y()+q+de,-se,0,k)}this._appendPreviousVertex()}_appendVertex(N,k,$,ae,se){this._previousX=N,this._previousY=k,this._previousU=$,this._previousV=ae,this._previousColor=se,this._vertices.appendFloat(N).appendFloat(k).appendFloat($).appendFloat(ae),this._vertices.appendByte(C.red(se)).appendByte(C.green(se)).appendByte(C.blue(se)).appendByte(C.alpha(se))}_appendPreviousVertex(){this._appendVertex(this._previousX,this._previousY,this._previousU,this._previousV,this._previousColor)}_length(N,k){return Math.sqrt(N*N+k*k)}}Me.SmoothPath=D,(N=>{let dt;(ae=>(ae[ae.CLOSED=0]="CLOSED",ae[ae.OPEN=1]="OPEN"))(dt=N.Loop||(N.Loop={}))})(D=Me.SmoothPath||(Me.SmoothPath={}));let G;(k=>(k[k.WEBGL_TEXTURE=0]="WEBGL_TEXTURE",k[k.WEBGL_BUFFER=1]="WEBGL_BUFFER"))(G=Me.MemoryType||(Me.MemoryType={}));class U{increment(N,k,$){let ae=null;this._vramUsedByTypeAndPurpose.has(N)?ae=this._vramUsedByTypeAndPurpose.get(N):(ae=new Map,this._vramUsedByTypeAndPurpose.set(N,ae)),ae.has(k)||ae.set(k,0);let se=ae.get(k)+$;ae.set(k,se),Cr.trackNumber(G[N]+` (${k})`,se/(1024*1024)|0)}decrement(N,k,$){this.increment(N,k,-$)}resetOnContextRestored(){this._vramUsedByTypeAndPurpose=new Map}constructor(){this._vramUsedByTypeAndPurpose=new Map}}Me.MemoryStats=U;let Rt=class Rt{stats(){return this._stats}width(){return this._cachedSize.x()|0}height(){return this._cachedSize.y()|0}maxTextureSize(){return this._cachedMaxTextureSize}_loadOESStandardDerivativesExtension(N){let k=this._gl.getExtension("OES_standard_derivatives"),$=X.shouldUseWebGL2();e($||k!==null),N&&!Me._supportsWebGLExtensionOESStandardDerivatives&&!$&&De.trackEvent("missing_webgl_extensions",{extensions:["OES_standard_derivatives"]})}constructor(){this._stats=new U,this._attributeCount=0,this._currentBlendState=a.ZERO,this._currentBlendOperations=0,this._blendOperationMap=null,this._comparisonMap=null,this._contextResetHandlers=[],this._currentClearColor=C.TRANSPARENT,this._currentScissors=null,this._currentStencilState=u.NONE,this._currentFramebuffer=null,this._currentProgramInUse=null,this._currentVertexBuffer=null,this._currentVertexFormat=null,this._defaultViewport=V.new2(),this._forceStateUpdate=!0,this._generation=1,this._gl=null,this._oldBlendState=null,this._oldBlendOperations=0,this._oldScissors=null,this._oldStencilState=u.NONE,this._oldFramebuffer=null,this._oldViewport=V.new2(),this._operationMap=null,this._cachedGraphicsCardName=null,this._cachedMaxTextureSize=0,this._cachedSize=new R(0,0),this._mockMaximumDrawingBufferSize=null,this._materialsToCheckProgramCreationStatus=[],this._hasLoggedHighpPrecisionUnsupported=!1,this._shouldFlushAfterDraws=!1,this._boundWebGLFramebuffer=null,this._webGLFramebufferUsedForLastClearOrDraw=null,this._numFramebufferSwitches=0,this.hackToAvoidMissingTextureWarningInChrome=null;let N={antialias:!1,depth:!1,stencil:!1,alpha:!1,preserveDrawingBuffer:Oi,powerPreference:"high-performance"};if(this._gl=Xn.HTMLCanvasElement_getContextWebGL2(Bn.HTMLDocument_createElementCanvas(document),N,X.shouldUseWebGL2()),this._gl==null)throw console.error("WebGL initialization failed"),new Error("Could not initialize WebGL");this._loadOESStandardDerivativesExtension(!0);let k=this._gl.canvas,$=k.style;k.width=0,k.height=0,$.display="block",$.left="0",$.top="0",Jt.EventTarget_addEventListener2(k,"webglcontextlost",ae=>{console.warn("WebGL context was lost"),xo.Event_preventDefault(ae)}),Jt.EventTarget_addEventListener1(k,"webglcontextrestored",()=>{console.warn("WebGL context was restored"),this._attributeCount=0,this._currentClearColor=C.TRANSPARENT,this._currentScissors=null,this._forceStateUpdate=!0,this._loadOESStandardDerivativesExtension(!1),this._generation=this._generation+1,this._stats.resetOnContextRestored();for(let ae of this._contextResetHandlers)ae()}),r(this._gl),this._blendOperationMap=new Map([[0,this._gl.ZERO],[1,this._gl.ONE],[2,this._gl.SRC_COLOR],[3,this._gl.DST_COLOR],[4,this._gl.ONE_MINUS_SRC_COLOR],[5,this._gl.ONE_MINUS_DST_COLOR],[6,this._gl.SRC_ALPHA],[7,this._gl.DST_ALPHA],[8,this._gl.ONE_MINUS_SRC_ALPHA],[9,this._gl.ONE_MINUS_DST_ALPHA],[10,this._gl.CONSTANT_COLOR],[11,this._gl.ONE_MINUS_CONSTANT_COLOR]]),this._comparisonMap=new Map([[0,this._gl.ALWAYS],[1,this._gl.EQUAL],[2,this._gl.GREATER],[3,this._gl.GEQUAL],[4,this._gl.LESS],[5,this._gl.LEQUAL],[6,this._gl.NEVER],[7,this._gl.NOTEQUAL]]),this._operationMap=new Map([[0,this._gl.DECR],[1,this._gl.DECR_WRAP],[2,this._gl.INCR],[3,this._gl.INCR_WRAP],[4,this._gl.INVERT],[5,this._gl.KEEP],[6,this._gl.REPLACE],[7,this._gl.ZERO]]),this._cachedMaxTextureSize=Math.min(4096,this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE))|0,_r.setMaxRes(this._cachedMaxTextureSize),this.hackToAvoidMissingTextureWarningInChrome=new j(this,y.RGBA_NEAREST_CLAMP,1,1,_r.createFromPixels(1,1,new Uint8Array(4)),null,"ChromeHack"),this._shouldFlushAfterDraws=this._detectShouldFlushAfterDraws()}gl(){return this._gl}generation(){return this._generation}addContextResetHandler(N){ce.List_appendOne(this._contextResetHandlers,N)}removeContextResetHandler(N){ce.List_removeOne(this._contextResetHandlers,N)}currentFramebuffer(){return this._currentFramebuffer}currentStencilState(){return this._currentStencilState}currentBlendState(){return this._currentBlendState}beginFrame(){this._checkMaterialProgramCreationStatuses(),this.setFramebuffer(null)}endFrame(){}flush(){this._gl.flush()}readPixels(N,k,$,ae,se){var we;let Re=new Uint8Array(ae*se*4),Pe=(we=ge.from(N))==null?void 0:we.framebuffer();return this.bindWebGLFramebufferAndTrackForBudget(Pe),this._gl.readPixels(k,$,ae,se,this.gl().RGBA,this.gl().UNSIGNED_BYTE,Re),Re}setBlendState(N){this._currentBlendState=N,this._currentBlendOperations=Rt._packBlendModes(N.sourceColor,N.targetColor,N.sourceAlpha,N.targetAlpha)}setViewport(N,k,$,ae){this._currentFramebuffer!=null?this._currentFramebuffer.setViewport(N,k,$,ae):this._defaultViewport.setTo1(N,k,$,ae)}_reportClearOrDraw(){this._boundWebGLFramebuffer!=this._webGLFramebufferUsedForLastClearOrDraw&&this._numFramebufferSwitches++,this._webGLFramebufferUsedForLastClearOrDraw=this._boundWebGLFramebuffer}draw(N,k,$){$!=null&&Ol.WebGLRenderingContext_annotateBlock(this._gl,`material:${k.name()}`,()=>{this._updateFramebufferAndViewport(),W.from(k).prepare(),K.from($.buffer()).prepare(k.format()),this._updateDeferredStates(),this._gl.drawArrays(N==0?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,$.byteOffset()/$.stride()|0,$.byteCount()/$.stride()|0),this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush(),this._reportClearOrDraw()})}_setCanvasSize(N,k){this._mockMaximumDrawingBufferSize!=null&&(N=Math.min(this._mockMaximumDrawingBufferSize.value,N)|0,k=Math.min(this._mockMaximumDrawingBufferSize.value,k)|0);let $=N/Jn(),ae=k/Jn(),se=this._gl.canvas;se.width=N,se.height=k,se.style.width=`${$}px`,se.style.height=`${ae}px`;let Re=this._gl.drawingBufferWidth,Pe=this._gl.drawingBufferHeight,we=Re!=N||Pe!=k;return we&&($=Re/Jn(),ae=Pe/Jn(),se.width=Re,se.height=Pe,se.style.width=`${$}px`,se.style.height=`${ae}px`),new m(new R(Re,Pe),we)}resize(N,k){let $=!1;if((this._cachedSize.x()|0)!=N||(this._cachedSize.y()|0)!=k){let ae=this._setCanvasSize(N,k);this._cachedSize=ae.canvasSize,$=ae.webGLDidAdjustCanvasSize,this.setViewport(0,0,this._cachedSize.x()|0,this._cachedSize.y()|0)}return new m(this._cachedSize,$)}_detectShouldFlushAfterDraws(){let N=["Adreno (TM) 725","Adreno (TM) 730","Adreno (TM) 740","Adreno (TM) 750"];for(let k of N)if(this.graphicsCardName().indexOf(k)!=-1)return!0;return!!X.shouldFlushAfterDraws()}_shouldFlushAfterClear(){return!!(Li.hasDrawClearReorderingBug()||["Mesa Intel(R) Graphics (ADL GT2)","Mesa Intel(R) Xe Graphics (TGL GT2)"].indexOf(this.graphicsCardName())!=-1||X.shouldFlushAfterClear())}clear(N,k){var $,ae;k==null&&(k=C.TRANSPARENT),this._updateFramebufferAndViewport(),this._updateDeferredStates(),k!=this._currentClearColor&&(this._gl.clearColor(C.redF(k),C.greenF(k),C.blueF(k),C.alphaF(k)),this._currentClearColor=k),this._gl.clear((N!=2?this._gl.COLOR_BUFFER_BIT:0)|(N!=1?this._gl.DEPTH_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT:0)),this._shouldFlushAfterClear()&&this._gl.flush(),this._currentFramebuffer!=null&&((N==0||N==1)&&(($=this._currentFramebuffer.colorTexture())==null||$.markContentHasBeenInitialized()),(N==0||N==2)&&((ae=this._currentFramebuffer.depthStencilTexture())==null||ae.markContentHasBeenInitialized())),this._reportClearOrDraw()}setStencilState(N){this._currentStencilState=N}setFramebuffer(N){var k;this._currentFramebuffer=ge.from(N),(k=this._currentFramebuffer)==null||k.updateScissor()}setScissor(N){N==null?this._currentScissors=null:(this._currentScissors==null&&(this._currentScissors=V.new2()),this._currentScissors.copyFrom(N))}useProgram(N){(this._forceStateUpdate||this._currentProgramInUse!=N)&&(this._gl.useProgram(N),this._currentProgramInUse=N)}bindVertexBufferWithFormat(N,k){if((this._forceStateUpdate||this._currentVertexBuffer!=N)&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,N),this._currentVertexBuffer=N,this._currentVertexFormat=null),this._currentVertexFormat!=k){let $=this._gl,ae=k.attributes(),se=ae.length;for(let Re=0,Pe=se;Re<Pe;Re=Re+1){let we=ae[Re],ve=we.type==1;$.vertexAttribPointer(Re,we.count,ve?$.UNSIGNED_BYTE:$.FLOAT,ve,k.stride(),we.byteOffset)}for(;this._attributeCount<se;)$.enableVertexAttribArray(this._attributeCount),this._attributeCount=this._attributeCount+1;for(;this._attributeCount>se;)this._attributeCount=this._attributeCount-1,$.disableVertexAttribArray(this._attributeCount);this._attributeCount=se,this._currentVertexFormat=k}}isContextLost(){return this._gl.isContextLost()}graphicsCardName(){if(this._cachedGraphicsCardName!=null)return this._cachedGraphicsCardName;let N=this._gl.getExtension("WEBGL_debug_renderer_info");return N===null?this._cachedGraphicsCardName="Unknown":this._cachedGraphicsCardName=this._gl.getParameter(N.UNMASKED_RENDERER_WEBGL),this._cachedGraphicsCardName}setMaximumDrawingBufferSizeForTesting(N){this._mockMaximumDrawingBufferSize=new fe(N)}clearMaximumDrawingBufferSizeForTesting(){this._mockMaximumDrawingBufferSize=null}createMaterial(N,k,$,ae){return new W(this,N,k,$,ae)}createVertexBuffer(N){return new K(this,N)}createTexture(N,k,$,ae){return this.createTextureWithPixels(N,k,$,null,ae)}createTextureWithPixels(N,k,$,ae,se){return new j(this,N,k,$,_r.createFromPixels(k,$,ae),null,se)}createTextureWithVideo(N,k,$){return new j(this,N,k.videoWidth,k.videoHeight,null,k,$)}createFramebuffer(N,k,$){return new ge(this,j.from(N),j.from(k),$)}annotate(N,k){k()}annotateAndReturn(N,k){return k()}addMaterialToCheckProgramCreationStatusAsync(N){this._materialsToCheckProgramCreationStatus.push(N)}_checkMaterialProgramCreationStatuses(){if(this._materialsToCheckProgramCreationStatus.length!=0){for(let N of this._materialsToCheckProgramCreationStatus)N.haveCheckedProgramCreationStatus()||N.checkProgramCreationStatus();this._materialsToCheckProgramCreationStatus.length=0}}annotateProfile(N,k){k()}takeSpectorSnapshot(){Ue.takeSnapshot(this.gl().canvas)}_updateFramebufferAndViewport(){let N=this._currentFramebuffer,k=N!=null?N.viewport():this._defaultViewport,$=this._gl;if(this._forceStateUpdate||this._oldFramebuffer!=N){let ae=N==null?void 0:N.framebuffer();this.bindWebGLFramebufferAndTrackForBudget(ae),this._oldFramebuffer=N,Li.hasViewportBug()&&this._oldViewport.equals(k)&&(this._oldViewport.setX(k.x()+1),$.viewport(this._oldViewport.x()|0,this._oldViewport.y()|0,this._oldViewport.width()|0,this._oldViewport.height()|0),$.clear(0))}(this._forceStateUpdate||!this._oldViewport.equals(k))&&($.viewport(k.x()|0,k.y()|0,k.width()|0,k.height()|0),this._oldViewport.copyFrom(k))}_updateDeferredStates(){this._updateBlendState(),this._updateStencilState(),this._updateScissorState()}_updateBlendState(){if(this._forceStateUpdate||this._oldBlendOperations!=this._currentBlendOperations||this._oldBlendState.constant!=this._currentBlendState.constant){let N=this._gl,k=this._currentBlendOperations,$=this._oldBlendOperations,ae=k&255,se=k>>8&255,Re=k>>16&255,Pe=k>>24,we=this._currentBlendState.constant;k==Rt.KEEP_BLEND_OPERATIONS?N.colorMask(!1,!1,!1,!1):((this._forceStateUpdate||$==Rt.KEEP_BLEND_OPERATIONS)&&N.colorMask(!0,!0,!0,!0),k==Rt.COPY_BLEND_OPERATIONS?N.disable(N.BLEND):((this._forceStateUpdate||$==Rt.COPY_BLEND_OPERATIONS||$==Rt.KEEP_BLEND_OPERATIONS)&&N.enable(N.BLEND),N.blendFuncSeparate(this._blendOperationMap.get(ae),this._blendOperationMap.get(se),this._blendOperationMap.get(Re),this._blendOperationMap.get(Pe)),N.blendColor(we,we,we,we))),this._oldBlendState=this._currentBlendState,this._oldBlendOperations=k}}_updateStencilState(){let N=this._gl,k=this._oldStencilState,$=this._currentStencilState,ae=$.frontFace,se=$.backFace,Re=ae==se?N.FRONT_AND_BACK:N.FRONT;(this._forceStateUpdate||!k.equals($))&&((this._forceStateUpdate||k.isEnabled!=$.isEnabled)&&($.isEnabled?N.enable(N.STENCIL_TEST):N.disable(N.STENCIL_TEST)),N.stencilFuncSeparate(Re,this._comparisonMap.get(ae.comparison),ae.reference,ae.readMask),N.stencilOpSeparate(Re,this._operationMap.get(ae.stencilFail),this._operationMap.get(ae.stencilPassDepthFail),this._operationMap.get(ae.stencilPassDepthPass)),N.stencilMaskSeparate(Re,ae.writeMask),ae!=se&&(N.stencilFuncSeparate(N.BACK,this._comparisonMap.get(se.comparison),se.reference,se.readMask),N.stencilOpSeparate(N.BACK,this._operationMap.get(se.stencilFail),this._operationMap.get(se.stencilPassDepthFail),this._operationMap.get(se.stencilPassDepthPass)),N.stencilMaskSeparate(N.BACK,se.writeMask)),this._oldStencilState=$)}_updateScissorState(){this._currentScissors==null?(this._oldScissors!=null&&this._gl.disable(this._gl.SCISSOR_TEST),this._oldScissors=null):(this._oldScissors==null&&this._gl.enable(this._gl.SCISSOR_TEST),(this._oldScissors==null||!this._currentScissors.equals(this._oldScissors))&&(this._gl.scissor(this._currentScissors.x()|0,this._currentScissors.y()|0,Math.max(this._currentScissors.width(),0)|0,Math.max(this._currentScissors.height(),0)|0),this._oldScissors==null&&(this._oldScissors=V.new2()),this._oldScissors.copyFrom(this._currentScissors)))}hasLoggedHighpPrecisionUnsupported(){return this._hasLoggedHighpPrecisionUnsupported}setHasLoggedHighpPrecisionUnsupported(){this._hasLoggedHighpPrecisionUnsupported=!0}static from(N){return N}static _packBlendModes(N,k,$,ae){return N|k<<8|$<<16|ae<<24}getNumFramebufferSwitches(){return this._numFramebufferSwitches}resetNumFramebufferSwitches(){this._numFramebufferSwitches=0}bindWebGLFramebufferAndTrackForBudget(N){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,N),this._boundWebGLFramebuffer=N}};Rt.COPY_BLEND_OPERATIONS=Rt._packBlendModes(1,0,1,0),Rt.KEEP_BLEND_OPERATIONS=Rt._packBlendModes(0,1,0,1);let M=Rt;Me.HTMLContext=Rt;class z{location(){let N=M.from(this._material.context());if(this._generation!=N.generation()&&(this._location=N.gl().getUniformLocation(this._material.program(),this._name),this._generation=N.generation(),!1)){for(let ae=0,se=$.getProgramParameter(k,$.ACTIVE_UNIFORMS);ae<se;ae=ae+1)if(Re.name==this._name)switch(Re.type){case $.FLOAT:case $.FLOAT_MAT3:case $.FLOAT_VEC2:case $.FLOAT_VEC3:case $.FLOAT_VEC4:case $.INT:case $.BOOL:case $.SAMPLER_2D:default:}}return this._location}constructor(N,k){this._material=N,this._name=k,this._generation=0,this._location=null,this._isDirty=!0}}Me.HTMLUniform=z;class B extends z{constructor(k,$){super(k,$);this._x=0}set(k){k!=this._x&&(this._x=k,this._isDirty=!0)}prepare(){let k=M.from(this._material.context());(this._generation!=k.generation()||this._isDirty)&&(k.gl().uniform1f(this.location(),this._x),this._isDirty=!1)}}Me.HTMLUniformFloat=B;class w extends z{constructor(k,$){super(k,$);this._x=0}set(k){k!=this._x&&(this._x=k,this._isDirty=!0)}prepare(){let k=M.from(this._material.context());(this._generation!=k.generation()||this._isDirty)&&(k.gl().uniform1i(this.location(),this._x),this._isDirty=!1)}}Me.HTMLUniformInt=w;class P extends z{constructor(k,$){super(k,$);this._x=0,this._y=0}set(k,$){(k!=this._x||$!=this._y)&&(this._x=k,this._y=$,this._isDirty=!0)}prepare(){let k=M.from(this._material.context());(this._generation!=k.generation()||this._isDirty)&&(k.gl().uniform2f(this.location(),this._x,this._y),this._isDirty=!1)}}Me.HTMLUniformVec2=P;class H extends z{constructor(k,$){super(k,$);this._x=0,this._y=0,this._z=0}set(k,$,ae){(k!=this._x||$!=this._y||ae!=this._z)&&(this._x=k,this._y=$,this._z=ae,this._isDirty=!0)}prepare(){let k=M.from(this._material.context());(this._generation!=k.generation()||this._isDirty)&&(k.gl().uniform3f(this.location(),this._x,this._y,this._z),this._isDirty=!1)}}Me.HTMLUniformVec3=H;class Q extends z{constructor(k,$){super(k,$);this._x=0,this._y=0,this._z=0,this._w=0}set(k,$,ae,se){(k!=this._x||$!=this._y||ae!=this._z||se!=this._w)&&(this._x=k,this._y=$,this._z=ae,this._w=se,this._isDirty=!0)}prepare(){let k=M.from(this._material.context());(this._generation!=k.generation()||this._isDirty)&&(k.gl().uniform4f(this.location(),this._x,this._y,this._z,this._w),this._isDirty=!1)}}Me.HTMLUniformVec4=Q;let Et=class Et extends z{constructor(k,$){super(k,$);this._values=[1,0,0,0,1,0,0,0,1]}set(k,$,ae,se,Re,Pe,we,ve,Ke){Et._cachedValues[0]=k,Et._cachedValues[1]=se,Et._cachedValues[2]=we,Et._cachedValues[3]=$,Et._cachedValues[4]=Re,Et._cachedValues[5]=ve,Et._cachedValues[6]=ae,Et._cachedValues[7]=Pe,Et._cachedValues[8]=Ke;for(let ht=0;ht<9;ht=ht+1)if(Et._cachedValues[ht]!=this._values[ht]){let oe=this._values;this._values=Et._cachedValues,Et._cachedValues=oe,this._isDirty=!0;break}}prepare(){let k=M.from(this._material.context());(this._generation!=k.generation()||this._isDirty)&&(k.gl().uniformMatrix3fv(this.location(),!1,this._values),this._isDirty=!1)}};Et._cachedValues=[1,0,0,0,1,0,0,0,1];let Y=Et;Me.HTMLUniformMat3=Et;class ne extends z{constructor(k,$){super(k,$);this._texture=null,this._index=-1}set(k,$){(this._texture!=k||this._index!=$)&&(this._texture=j.from(k),this._index=$,this._isDirty=!0)}prepare(){let k=M.from(this._material.context()),$=this._texture,ae=k.gl();$==null&&($=k.hackToAvoidMissingTextureWarningInChrome),(this._generation!=k.generation()||this._isDirty)&&(ae.uniform1i(this.location(),this._index),this._isDirty=!1),ae.activeTexture(Ol.WebGLRenderingContext_TEXTURE_N(ae,this._index)),ae.bindTexture(ae.TEXTURE_2D,$.texture())}}Me.HTMLUniformSampler=ne;class W{constructor(N,k,$,ae,se){this._context=null,this._name=null,this._format=null,this._vertexSource=null,this._fragmentSource=null,this._uniformsMap=new Map,this._uniformsList=[],this._generation=0,this._program=null,this._haveCheckedProgramCreationStatus=!1,this._context=N,this._name=k,this._format=$,this._vertexSource=ae,this._fragmentSource=se,this._createProgram(),this._context.addMaterialToCheckProgramCreationStatusAsync(this)}context(){return this._context}name(){return this._name}format(){return this._format}setUniformFloat(N,k){let $=He.StringMap_get(this._uniformsMap,N,null);$==null&&($=new B(this,N),this._uniformsMap.set(N,$),this._uniformsList.push($)),$.set(k)}setUniformInt(N,k){let $=He.StringMap_get(this._uniformsMap,N,null);$==null&&($=new w(this,N),this._uniformsMap.set(N,$),this._uniformsList.push($)),$.set(k)}setUniformVec21(N,k,$){let ae=He.StringMap_get(this._uniformsMap,N,null);ae==null&&(ae=new P(this,N),this._uniformsMap.set(N,ae),this._uniformsList.push(ae)),ae.set(k,$)}setUniformVec3(N,k,$,ae){let se=He.StringMap_get(this._uniformsMap,N,null);se==null&&(se=new H(this,N),this._uniformsMap.set(N,se),this._uniformsList.push(se)),se.set(k,$,ae)}setUniformVec41(N,k,$,ae,se){let Re=He.StringMap_get(this._uniformsMap,N,null);Re==null&&(Re=new Q(this,N),this._uniformsMap.set(N,Re),this._uniformsList.push(Re)),Re.set(k,$,ae,se)}setUniformMat31(N,k,$,ae,se,Re,Pe,we,ve,Ke){let ht=He.StringMap_get(this._uniformsMap,N,null);ht==null&&(ht=new Y(this,N),this._uniformsMap.set(N,ht),this._uniformsList.push(ht)),ht.set(k,$,ae,se,Re,Pe,we,ve,Ke)}setUniformSampler(N,k,$){let ae=He.StringMap_get(this._uniformsMap,N,null);ae==null&&(ae=new ne(this,N),this._uniformsMap.set(N,ae),this._uniformsList.push(ae)),ae.set(k,$)}program(){return this._generation!=this._context.generation()&&(this._createProgram(),this.checkProgramCreationStatus()),this._program}prepare(){this._context.useProgram(this.program());for(let N of this._uniformsList)N.prepare()}haveCheckedProgramCreationStatus(){return this._haveCheckedProgramCreationStatus}checkProgramCreationStatus(){if(this._generation!=this._context.generation())return;let N=this._context.gl();if((()=>{if(N.getProgramParameter(this._program,N.LINK_STATUS))return;let $=Re=>Re.replace(new RegExp("\\bhighp\\b","g"),"mediump"),ae=N.getAttachedShaders(this._program),se=!1;for(let Re of ae){if(N.getShaderParameter(Re,N.COMPILE_STATUS))continue;se=!0;let Pe=N.getShaderParameter(Re,N.SHADER_TYPE);if(Pe===N.VERTEX_SHADER)this._vertexSource=$(this._vertexSource);else if(Pe===N.FRAGMENT_SHADER)this._fragmentSource=$(this._fragmentSource);else{if(N.isContextLost())return;throw new Error(`Unexpected shader type: ${Pe}`)}}if(!se){if(N.isContextLost())return;throw new Error(`Failed to link shader ${this.name()}: ${N.getProgramInfoLog(this._program)}`)}if(this._createProgram(),N.getProgramParameter(this._program,N.LINK_STATUS)){this.context().hasLoggedHighpPrecisionUnsupported()||(De.trackEvent("highp_unsupported_device",{}),this.context().setHasLoggedHighpPrecisionUnsupported());return}ae=N.getAttachedShaders(this._program);for(let Re of ae)if(!N.getShaderParameter(Re,N.COMPILE_STATUS)){if(N.isContextLost())return;{let Pe=N.getShaderInfoLog(Re);throw new Error(Pe)}}if(!N.isContextLost())throw new Error(`Failed to link shader ${this.name()}: ${N.getProgramInfoLog(this._program)}`)})(),!1){for(let $ of this.format().attributes())for(let ae=0,se=N.getProgramParameter(this._program,N.ACTIVE_ATTRIBUTES);ae<se;ae=ae+1)if(Re.name==$.name)switch($.count){case 1:case 2:case 3:case 4:default:}}this._haveCheckedProgramCreationStatus=!0}_createProgram(){let N=this._context.gl();this._program=N.createProgram(),Ue.addDebugMetadataToWebGLObject(this._program,{name:this._name}),this._compileShader(N,N.VERTEX_SHADER,this._vertexSource),this._compileShader(N,N.FRAGMENT_SHADER,this._fragmentSource);let k=this.format().attributes();for(let $=0,ae=k.length;$<ae;$=$+1)N.bindAttribLocation(this._program,$,k[$].name);N.linkProgram(this._program),this._generation=this._context.generation(),this._haveCheckedProgramCreationStatus=!1}_compileShader(N,k,$){let ae=N.createShader(k);N.shaderSource(ae,$),N.compileShader(ae),N.attachShader(this._program,ae)}static from(N){return N}}Me.HTMLMaterial=W;let Ut=class Ut{constructor(N,k){this._context=null,this._generation=0,this._buffer=null,this._bytes=null,this._isDirty=!0,this._dirtyMin=Ut.INT_MAX,this._dirtyMax=0,this._totalMin=Ut.INT_MAX,this._totalMax=0,this._byteCount=0,this._glByteCount=0,this._context=N,this._byteCount=k,this._bytes=new Uint8Array(k)}context(){return this._context}bytes(){return this._bytes}byteCount(){return this._byteCount}move(N,k,$){N!=k&&$!=0&&(this._bytes.set(this._bytes.subarray(N,N+$),k),this._growDirtyRegion(Math.min(N,k),Math.max(N,k)+$))}upload2(N,k){this._bytes.set(N,k),this._growDirtyRegion(k,k+N.length)}prepare(N){let k=this._context.gl();if(this._generation!=this._context.generation()&&(this._buffer=k.createBuffer(),Ue.addDebugMetadataToWebGLObject(this._buffer,{purpose:"Vertex Buffer"}),this._generation=this._context.generation(),this._isDirty=!0),this._context.bindVertexBufferWithFormat(this._buffer,N),this._isDirty){let $=this._glByteCount;k.bufferData(k.ARRAY_BUFFER,this._byteCount,k.DYNAMIC_DRAW),this._glByteCount=this.byteCount(),this._context.stats().increment(1,"all",this._glByteCount-$),this._dirtyMin=this._totalMin,this._dirtyMax=this._totalMax,this._isDirty=!1}this._dirtyMin<this._dirtyMax&&(k.bufferSubData(k.ARRAY_BUFFER,this._dirtyMin,this._bytes.subarray(this._dirtyMin,this._dirtyMax)),this._dirtyMin=Ut.INT_MAX,this._dirtyMax=0)}_growDirtyRegion(N,k){this._dirtyMin=Math.min(this._dirtyMin,N),this._dirtyMax=Math.max(this._dirtyMax,k),this._totalMin=Math.min(this._totalMin,N),this._totalMax=Math.max(this._totalMax,k)}static from(N){return N}};Ut.INT_MAX=2147483647;let K=Ut;Me.HTMLVertexBuffer=Ut;class j{context(){return this._context}format(){return this._format}width(){return this._width}height(){return this._height}hasContentBeenInitialized(){return this.isRenderbuffer()?this.renderbuffer():this.texture(),this._hasContentBeenInitialized}markContentHasBeenInitialized(){this._hasContentBeenInitialized=!0}setShouldUnloadImageBuffer(N){this._shouldUnloadImageBuffer=N}_currentGlTextureSizeInBytes(){let N=this._glTextureWidth*this._glTextureHeight*xt.PixelFormat_byteCount(this._format.pixelFormat);return this._useMipmap&&(N+=N*.33),N|0}deleteTexture(){this._texture!=null&&(this._context.gl().deleteTexture(this._texture),this._context.stats().decrement(0,this._purpose,this._currentGlTextureSizeInBytes()))}resize1(N,k,$,ae){this._width=N,this._height=k,this._pixels=$,this._useMipmap=ae,this._isContentDirty=!0}_needsUploadToGPUTexture(){return this._isContentDirty||this._video!=null}setFormat(N){this._format!=N&&(this._format=N,this._isFormatDirty=!0)}isRenderbuffer(){return this._format.pixelFormat==1}invalidateVideoFrame(){this._isVideoFrameDirty=!0}texture(){let N=this._context.gl();if(this._generation!=this._context.generation()&&(this._texture=N.createTexture(),Ue.addDebugMetadataToWebGLObject(this._texture,{purpose:this._purpose}),this._generation=this._context.generation(),this._isFormatDirty=!0,this._isContentDirty=!0,this._hasContentBeenInitialized=!1),this._isFormatDirty&&(N.bindTexture(N.TEXTURE_2D,this._texture),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,this.format().magFilter==0?N.NEAREST:N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,this.format().minFilter==0?N.NEAREST:N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,this.format().wrap==0?N.REPEAT:N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,this.format().wrap==0?N.REPEAT:N.CLAMP_TO_EDGE),this._isFormatDirty=!1),this._needsUploadToGPUTexture()){let k=this._currentGlTextureSizeInBytes();if(N.bindTexture(N.TEXTURE_2D,this._texture),this._video!=null)this._isVideoFrameDirty&&(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,this._video),this._isVideoFrameDirty=!1,this._hasContentBeenInitialized=!0);else{let ae=this._pixels.pixels;ae.imageBitmap!=null?(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,ae.imageBitmap),this._hasContentBeenInitialized=!0):ae.img!=null?(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,ae.img),this._hasContentBeenInitialized=!0):ae.canvas!=null?(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,ae.canvas),this._hasContentBeenInitialized=!0):(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,this._width,this._height,0,N.RGBA,N.UNSIGNED_BYTE,ae.array),this._hasContentBeenInitialized=ae.array!=null),this._shouldUnloadImageBuffer&&(this._pixels=null)}this._glTextureWidth=this._width,this._glTextureHeight=this._height,this._useMipmap&&(N.generateMipmap(N.TEXTURE_2D),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR_MIPMAP_LINEAR));let $=this._currentGlTextureSizeInBytes();this._context.stats().increment(0,this._purpose,$-k),this._isContentDirty=!1}return this._texture}renderbuffer(){let N=this._context.gl();return this._generation!=this._context.generation()&&(this._renderbuffer=N.createRenderbuffer(),Ue.addDebugMetadataToWebGLObject(this._renderbuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isContentDirty=!0,this._hasContentBeenInitialized=!1),this._isContentDirty&&(N.bindRenderbuffer(N.RENDERBUFFER,this._renderbuffer),N.renderbufferStorage(N.RENDERBUFFER,N.DEPTH_STENCIL,this._width,this._height),this._isContentDirty=!1,this._hasContentBeenInitialized=!1),this._renderbuffer}static from(N){return N}constructor(N,k,$,ae,se,Re,Pe){this._context=N,this._format=k,this._width=$,this._height=ae,this._pixels=se,this._video=Re,this._purpose=Pe,this._shouldUnloadImageBuffer=!1,this._useMipmap=!1,this._renderbuffer=null,this._texture=null,this._generation=0,this._isFormatDirty=!0,this._isContentDirty=!0,this._isVideoFrameDirty=!0,this._hasContentBeenInitialized=!1,this._glTextureWidth=0,this._glTextureHeight=0}}Me.HTMLTexture=j;class ge{context(){return this._context}colorTexture(){return this._colorTexture}depthStencilTexture(){return this._depthStencilTexture}setColorTexture(N){this._colorTexture!=N&&(this._colorTexture=j.from(N),this._isDirty=!0)}resize(N,k){this._colorTexture!=null&&(N!=this._colorTexture.width()||k!=this._colorTexture.height())&&(this._colorTexture.resize1(N,k,null,!1),this._isDirty=!0),this._depthStencilTexture!=null&&(N!=this._depthStencilTexture.width()||k!=this._depthStencilTexture.height())&&(this._depthStencilTexture.resize1(N,k,null,!1),this._isDirty=!0)}viewport(){return this._viewport}setViewport(N,k,$,ae){this._viewport.setTo1(N,k,$,ae)}pushScissor1(N,k,$,ae){let se=new V(N,k,$,ae);this.pushScissor2(se)}pushScissor2(N){this._scissorStack.length!=0&&N.intersectWith(ce.List_last(this._scissorStack)),this._scissorStack.push(N),this.updateScissor()}popScissor(){ce.List_removeLast(this._scissorStack),this.updateScissor()}takeScissor(){let N=this._scissorStack.pop();return this.updateScissor(),N}takeAllScissors(){let N=this._scissorStack;return this._scissorStack=[],this.updateScissor(),N}replaceAllScissors(N){this._scissorStack=N,this.updateScissor()}scissors(){return this._scissorStack}clearScissors(){this._scissorStack.length=0}updateScissor(){this._context.setScissor(this._scissorStack.length==0?null:ce.List_last(this._scissorStack))}setDepthStencil(N){this._depthStencilTexture!=N&&(this._depthStencilTexture=j.from(N),this._isDirty=!0)}framebuffer(){let N=this._context.gl();return this._generation!=this._context.generation()&&(this._framebuffer=N.createFramebuffer(),Ue.addDebugMetadataToWebGLObject(this._framebuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isDirty=!0),this._isDirty&&(this._context.bindWebGLFramebufferAndTrackForBudget(this._framebuffer),N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_2D,this._colorTexture.texture(),0),this._depthStencilTexture!=null&&N.framebufferRenderbuffer(N.FRAMEBUFFER,N.DEPTH_STENCIL_ATTACHMENT,N.RENDERBUFFER,this._depthStencilTexture.renderbuffer()),this._isDirty=!1),this._framebuffer}deleteTexture(){var N,k;(N=this._colorTexture)==null||N.deleteTexture(),(k=this._depthStencilTexture)==null||k.deleteTexture(),this._context.gl().deleteFramebuffer(this._framebuffer)}static from(N){return N}constructor(N,k,$,ae){this._context=N,this._colorTexture=k,this._depthStencilTexture=$,this._purpose=ae,this._scissorStack=[],this._framebuffer=null,this._generation=0,this._isDirty=!0,this._viewport=V.new2()}}Me.HTMLFramebuffer=ge;let Ue;(we=>{function dt(ve){if(!window.spector){console.error("Can't take a Spector.js snapshot because Spector isn't loaded. Go here to install the Chrome extension: https://chrome.google.com/webstore/detail/spectorjs/denbgaamihkadbghdceggmchnflmhpmk?hl=en");return}window.spector.captureNextFrame(ve)}we.takeSnapshot=dt;function N(ve,Ke){}we.addDebugMetadataToWebGLObject=N;function k(ve,Ke){Ke()}we.annotate=k;function $(ve,Ke){return Ke()}we.annotateAndReturn=$;function ae(ve){we._scopeStack.push(ve),Re()}we._beginScope=ae;function se(ve){we._scopeStack.pop(),Re()}we._endScope=se;function Re(){if(we._scopeStack.length==0)window.spector.clearMarker();else{let ve=we._scopeStack.join(" > ");window.spector.setMarker(ve)}}we._updateMarker=Re,we._scopeStack=[]})(Ue=Me.Spector||(Me.Spector={}));let Tt;(Pe=>{function dt(we){we.setBlendState(a.COPY)}Pe.Context_setCopyBlendState=dt;function N(we){we.setBlendState(a.KEEP)}Pe.Context_setKeepBlendState=N;function k(we,ve){we.setBlendState(a.createInterpolateBlendState(ve))}Pe.Context_setInterpolateBlendState=k;function $(we){we.setBlendState(a.PREMULTIPLIED)}Pe.Context_setPremultipliedBlendState=$;function ae(we){we.setBlendState(a.PREMULTIPLIED_SOURCE_UNDER_TARGET)}Pe.Context_setPremultipliedSourceUnderTargetState=ae;function se(we){we.setBlendState(a.UNPREMULTIPLIED)}Pe.Context_setUnpremultipliedBlendState=se;function Re(we){we.setBlendState(a.SCREEN)}Pe.Context_setScreenBlendState=Re})(Tt=Me.in_Context||(Me.in_Context={}));let $e;(ae=>{function dt(se,Re,Pe){se.setUniformVec21(Re,Pe.x(),Pe.y())}ae.Material_setUniformVec22=dt;function N(se,Re,Pe){se.setUniformVec41(Re,C.redF(Pe),C.greenF(Pe),C.blueF(Pe),C.alphaF(Pe))}ae.Material_setUniformVec42=N;function k(se,Re,Pe){se.setUniformVec41(Re,Pe.x(),Pe.y(),Pe.x()+Pe.width(),Pe.y()+Pe.height())}ae.Material_setUniformVec43=k;function $(se,Re,Pe){se.setUniformMat31(Re,Pe.m00(),Pe.m01(),Pe.m02(),Pe.m10(),Pe.m11(),Pe.m12(),0,0,1)}ae.Material_setUniformMat32=$})($e=Me.in_Material||(Me.in_Material={}));let xt;(N=>{function dt(k){return 4}N.PixelFormat_byteCount=dt})(xt=Me.in_PixelFormat||(Me.in_PixelFormat={}));let Vt;($=>{function dt(ae,se,Re){ae.resize1(se,Re,null,!1)}$.Texture_resize2=dt;function N(ae,se,Re,Pe){ae.resize1(se,Re,Pe,!1)}$.Texture_resize3=N;function k(ae){return ae.width()*ae.height()*xt.PixelFormat_byteCount(ae.format().pixelFormat)}$.Texture_totalVRAM=k})(Vt=Me.in_Texture||(Me.in_Texture={})),Me._supportsWebGLExtensionOESStandardDerivatives=!0,Me.DISABLE_BUFFER_ASSERT=!0})(O||(O={}));var Ha=class Ha{static instance(){return Ha._instance==null&&(Ha._instance=new Ha),Ha._instance}requestLibrary(){this.startLibLoad()}onLoadComplete(e){this._videoJsLib=e,this.onSuccess!=null&&this.onSuccess()}hasRequestedLibrary(){return this._requestStarted}isLibAvailable(){return this._videoJsLib!==null}getPlayer(e){return this._videoJsLib===null?(console.warn("VideoJS used before initialized"),null):this._videoJsLib.videoJs(e).player()}constructor(){this._videoJsLib=null,this._requestStarted=!1,this.startLibLoad=null,this.onSuccess=null}};Ha._instance=null;var Un=Ha,zd;(e=>{function i(t){let r=document.getElementById(t.id());return(r==null?void 0:r.getElementsByTagName("video"))[0]}e.VideoJsPlayer_getBackingVideo=i})(zd||(zd={}));var ee=class i{constructor(e,t,r,n,o,a){this._m00=0,this._m01=0,this._m02=0,this._m10=0,this._m11=0,this._m12=0,this._m00=e,this._m01=t,this._m02=r,this._m10=n,this._m11=o,this._m12=a}m00(){return this._m00}m01(){return this._m01}m02(){return this._m02}m10(){return this._m10}m11(){return this._m11}m12(){return this._m12}setM00(e){this._m00=e}setM01(e){this._m01=e}setM02(e){this._m02=e}setM10(e){this._m10=e}setM11(e){this._m11=e}setM12(e){this._m12=e}axisX(){return new R(this.m00(),this.m10())}axisY(){return new R(this.m01(),this.m11())}clone(){return new i(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12())}toAngle(){return Math.atan2(-this.m01(),this.m00())}scale1(){return new R(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}hasPerpendicularAxes(e){return Math.abs(this.m00()*this.m10()+this.m01()*this.m11())<e}isAxisAligned(e){return Math.abs(this.m00())<e&&Math.abs(this.m11())<e||Math.abs(this.m01())<e&&Math.abs(this.m10())<e}isAxisAlignedScaleInvariant(e){let t=Math.sqrt(this._m00*this._m00+this._m10*this._m10)*e,r=Math.sqrt(this._m01*this._m01+this._m11*this._m11)*e;return Math.abs(this.m00())<t&&Math.abs(this.m11())<r||Math.abs(this.m01())<t&&Math.abs(this.m10())<r}valueEquals(e,t){return e==t||isNaN(e)&&isNaN(t)}equals1(e){return this.valueEquals(this._m00,e.m00())&&this.valueEquals(this._m01,e.m01())&&this.valueEquals(this._m02,e.m02())&&this.valueEquals(this._m10,e.m10())&&this.valueEquals(this._m11,e.m11())&&this.valueEquals(this._m12,e.m12())}equals2(e,t){return Math.abs(this._m00-e.m00())<t&&Math.abs(this._m01-e.m01())<t&&Math.abs(this._m02-e.m02())<t&&Math.abs(this._m10-e.m10())<t&&Math.abs(this._m11-e.m11())<t&&Math.abs(this._m12-e.m12())<t}translation(){return new R(this._m02,this._m12)}translate1(e){this.translate2(e.x(),e.y())}translate2(e,t){this._m02+=e*this.m00()+t*this.m01(),this._m12+=e*this.m10()+t*this.m11()}translatedBy1(e){return this.translate1(e),this}translatedBy2(e,t){return this.translate2(e,t),this}rotatedBy(e){return this.rotate(e),this}rotate(e){let t=Math.sin(e),r=Math.cos(e),n=r*this.m00()+t*this.m01(),o=r*this.m01()-t*this.m00(),a=r*this.m10()+t*this.m11(),s=r*this.m11()-t*this.m10();this._m00=n,this._m01=o,this._m10=a,this._m11=s}scale2(e){this.scale4(e,e)}scale3(e){this.scale4(e.x(),e.y())}scale4(e,t){this._m00*=e,this._m01*=t,this._m10*=e,this._m11*=t}skewX(e){let t=Math.tan(e);this._m01+=this._m00*t,this._m11+=this._m10*t}skewY(e){let t=Math.tan(e);this._m00+=this._m01*t,this._m10+=this._m10*t}scaledBy1(e){return this.scale3(e),this}scaledBy2(e){return this.scale2(e),this}scaledBy3(e,t){return this.scale4(e,t),this}multiply(e){let t=this.m00()*e.m00()+this.m01()*e.m10(),r=this.m00()*e.m01()+this.m01()*e.m11(),n=this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),o=this.m10()*e.m00()+this.m11()*e.m10(),a=this.m10()*e.m01()+this.m11()*e.m11(),s=this.m10()*e.m02()+this.m11()*e.m12()+this.m12();this._m00=t,this._m01=r,this._m02=n,this._m10=o,this._m11=a,this._m12=s}rightMultiply(e){this.multiply(e)}leftMultiply(e){let t=this.m00()*e.m00()+this.m10()*e.m01(),r=this.m01()*e.m00()+this.m11()*e.m01(),n=this.m02()*e.m00()+this.m12()*e.m01()+e.m02(),o=this.m00()*e.m10()+this.m10()*e.m11(),a=this.m01()*e.m10()+this.m11()*e.m11(),s=this.m02()*e.m10()+this.m12()*e.m11()+e.m12();this._m00=t,this._m01=r,this._m02=n,this._m10=o,this._m11=a,this._m12=s}multipliedBy1(e){return this.multiply(e),this}multipliedBy2(e){return this.multipliedBy1(Nt.FrozenAffineTransform_new6(e))}invert(){let e=1/(this.m00()*this.m11()-this.m01()*this.m10());if(!isFinite(e))return!1;let t=this.m11()*e,r=-this.m01()*e,n=(this.m01()*this.m12()-this.m11()*this.m02())*e,o=-this.m10()*e,a=this.m00()*e,s=(this.m10()*this.m02()-this.m00()*this.m12())*e;return this._m00=t,this._m01=r,this._m02=n,this._m10=o,this._m11=a,this._m12=s,!0}inverse(){let e=this.clone(),t=e.invert();return e}transformPoint(e){let t=this.m00()*e.x()+this.m01()*e.y()+this.m02(),r=this.m10()*e.x()+this.m11()*e.y()+this.m12();return e.setX(t),e.setY(r),e}transformPoints(e){for(let t=0,r=e.length;t<r;t=t+1){let n=e[t],o=this.m00()*n.x()+this.m01()*n.y()+this.m02(),a=this.m10()*n.x()+this.m11()*n.y()+this.m12();n.setX(o),n.setY(a)}return e}transformDirection(e){let t=this.m00()*e.x()+this.m01()*e.y(),r=this.m10()*e.x()+this.m11()*e.y();return e.setX(t),e.setY(r),e}transformRect(e){if(e.isInvalid())return e.copyFrom(V.INVALID);if(!e.isFinite())return e.copyFrom(V.INFINITE);let t=new bt;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.topRight())),t.include2(this.transformPoint(e.bottomLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}setTo(e,t,r,n,o,a){return this._m00=e,this._m01=t,this._m02=r,this._m10=n,this._m11=o,this._m12=a,this}copyFrom(e){return this._m00=e.m00(),this._m01=e.m01(),this._m02=e.m02(),this._m10=e.m10(),this._m11=e.m11(),this._m12=e.m12(),this}postTranslate(e){let t=i.new2();t.translate1(e),this.leftMultiply(t)}postRotate(e){let t=i.new2();t.rotate(e),this.leftMultiply(t)}postScale(e){let t=i.new2();t.scale3(e),this.leftMultiply(t)}toString(){return`AffineTransform(${this.m00()}, ${this.m01()}, ${this.m02()}, ${this.m10()}, ${this.m11()}, ${this.m12()})`}static new2(){return new i(1,0,0,0,1,0)}static new3(e){return new i(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12())}static new4(e){return new i(e.scale(),0,e.offset().x(),0,e.scale(),e.offset().y())}static translated(e,t){let r=i.new2();return r.translate2(e,t),r}},Nt;(s=>{function i(){return ee.new2()}s.FrozenAffineTransform_new1=i;function e(l){return l}s.FrozenAffineTransform_new2=e;function t(l){return ee.new3(l)}s.FrozenAffineTransform_new3=t;function r(l,c,d,h,u,m){return new ee(l,c,d,h,u,m)}s.FrozenAffineTransform_new4=r;function n(l){return ee.new4(l)}s.FrozenAffineTransform_new5=n;function o(l){return ee.new4(l)}s.FrozenAffineTransform_new6=o,s.FrozenAffineTransform_IDENTITY=i()})(Nt||(Nt={}));var Wd=class{equals(e){return this.url==e.url&&this.scaleFactor==e.scaleFactor&&this.nonRotatedImageSize.equals(e.nonRotatedImageSize)&&this.nonRotatedOffset.equals(e.nonRotatedOffset)&&this.nonRotatedFramePresetSize.equals(e.nonRotatedFramePresetSize)}constructor(e,t,r,n,o){this.url=e,this.scaleFactor=t,this.nonRotatedImageSize=r,this.nonRotatedOffset=n,this.nonRotatedFramePresetSize=o}},Vo=class Vo{static deserializeVector(e){return new R(e.x,e.y)}static initialize(){let e=cr.getDeviceInfoByIdentifier();if(e!==null){Vo._infoByIdentifier=new Map;for(let t in e){let r=e[t];Vo._infoByIdentifier.set(t,new Wd(r.url,r.scaleFactor,Vo.deserializeVector(r.imageSize),Vo.deserializeVector(r.offset),Vo.deserializeVector(r.framePresetSize)))}}}static infoForDevice(e){return Vo._infoByIdentifier==null||e==null||e.type!="PRESET"?null:He.StringMap_get(Vo._infoByIdentifier,e.presetIdentifier,null)}static adjustNodeBoundsForDevice(e,t){let r=Vo.infoForDevice(t);if(r==null)return e;let n=t.canvasSpaceTopLeftOffset(r),o=t.canvasSpaceImageSize(r),a=e.clone();return a.setX(e.x()-n.x()),a.setY(e.y()-n.y()),a.setWidth(o.x()),a.setHeight(o.y()),a}static canvasSpaceContentSize(e,t){let r=Vo.infoForDevice(t);return r==null?e:t.canvasSpaceImageSize(r)}clearOnContextReset(){for(let e of Array.from(this._imageByURL.keys()))this._imageByURL.delete(e)}getImage(e,t){this._imageByURL.has(e.url)||this._imageByURL.set(e.url,Mr.createDeviceImage(e));let r=this._imageByURL.get(e.url);return r.texture()==null&&r.fetchAndDecode(0,n=>{let o=t.createTexture(O.TextureFormat.RGBA_LINEAR_CLAMP,1,1,"DeviceImage");r.setTexture(o);let a=n.expandToPowerOfTwo();r.texture().resize1(a.width,a.height,a,!0)},n=>{}),r}constructor(){this._imageByURL=new Map}};Vo._infoByIdentifier=null;var Rn=Vo;var J;(d=>{function i(h){return h!="-1:-1"&&h!=""}d.isValid=i;function e(h,u){let m=t(h),g=t(u),_=St.int_compare(m.sessionID,g.sessionID);return _==0&&(_=St.int_compare(m.localID,g.localID)),_}d.compare=e;function t(h){let u=h.split(":");if(u.length==2){let m={};return m.sessionID=parseInt(u[0]),m.localID=parseInt(u[1]),m}return null}d.toFigGUID=t;function r(){return"-1:-1"}d.invalid=r;function n(h){if(h==null)return null;let u=t(h);return u==null?null:u.sessionID<0||u.localID<0?"-1:-1":h}d.fromString=n;function o(h,u){return h<0||u<0?"-1:-1":`${h}:${u}`}d._new=o;function a(h){return o(h.sessionID,h.localID)}d.fromFigGUID=a;function s(h,u){return h==u}d.equals=s;function l(h,u){if(h.length!=u.length)return!1;for(let m=0,g=h.length;m<g;m=m+1)if(h[m]!=u[m])return!1;return!0}d.isSamePath=l;function c(h){return h=="0:0"}d.isRoot=c})(J||(J={}));var Nn=class i{constructor(e,t){this._offset=null,this._scale=0,this._offset=e,this._scale=t}offset(){return this._offset}scale(){return this._scale}setOffset(e){this._offset=e}setScale(e){this._scale=e}clone(){return new i(this.offset(),this.scale())}equals(e){return this._offset.equals(e.offset())&&this._scale==e.scale()}translate1(e,t){this._offset.setX(this._offset.x()+e*this._scale),this._offset.setY(this._offset.y()+t*this._scale)}translate2(e){this.translate1(e.x(),e.y())}translatedBy1(e){return this.translatedBy2(e.x(),e.y())}translatedBy2(e,t){return this.translate1(e,t),this}scaledBy(e){return this._scale=this._scale*e,this}multiply(e){this._offset=this._offset.add1(e.offset().multiply(this._scale)),this._scale=this._scale*e.scale()}multipliedBy(e){return this.multiply(e),this}transformRect(e){if(e.isInvalid())return e.copyFrom(V.INVALID);if(!e.isFinite())return e.copyFrom(V.INFINITE);let t=new bt;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}inverseTransformRect(e){if(e.isInvalid())return e.copyFrom(V.INVALID);if(!e.isFinite())return e.copyFrom(V.INFINITE);let t=new bt;return t.include2(this.inverseTransformPoint(e.topLeft())),t.include2(this.inverseTransformPoint(e.bottomRight())),t.buildTo(e),e}transformPoint(e){return e.multiplyUpdate(this._scale),e.addUpdate1(this._offset),e}inverseTransformPoint(e){return e.subtractUpdate1(this._offset),e.divideUpdate(this._scale),e}transformDirection(e){return e.multiplyUpdate(this._scale),e}inverseTransformDirection(e){return e.divideUpdate(this._scale),e}invert(){let e=1/this.scale();return isNaN(e)?!1:(this._offset=this._offset.negative().multiply(e),this._scale=e,!0)}copyFrom(e){return this._offset.copyFrom(e.offset()),this._scale=e.scale(),this}toString(){return`SimpleTransform({${this.offset().x()}, ${this.offset().y()}}, ${this.scale()})`}static new2(){return new i(R.new2(),1)}static new3(e){return new i(e.offset(),e.scale())}},AA;(o=>{function i(){return Nn.new2()}o.FrozenSimpleTransform_new1=i;function e(a){return a}o.FrozenSimpleTransform_new2=e;function t(a){return Nn.new3(a)}o.FrozenSimpleTransform_new3=t;function r(a,s){return new Nn(a,s)}o.FrozenSimpleTransform_new4=r,o.FrozenSimpleTransform_IDENTITY=i()})(AA||(AA={}));var Gn=class{constructor(e){this._hashKey=null,this._keyByHash=new Map,this._valueByKeyHash=new Map,this._hashKey=e}count(){return this._keyByHash.size}_in(e){let t=this._hashKey(e);return this._keyByHash.has(t)}set(e,t){let r=this._hashKey(e);this._keyByHash.set(r,e),this._valueByKeyHash.set(r,t)}get(e,t=null){let r=this._hashKey(e);return He.StringMap_get(this._valueByKeyHash,r,t)}remove(e){let t=this._hashKey(e);this._keyByHash.delete(t),this._valueByKeyHash.delete(t)}clear(){this._keyByHash=new Map,this._valueByKeyHash=new Map}keys(){return Array.from(this._keyByHash.values())}values(){return Array.from(this._valueByKeyHash.values())}each(e){this.keys().forEach(t=>{e(t,this.get(t))})}isEmpty(){return this.count()==0}},ko=class{constructor(e){this._hash=null,this._hash=new Gn(e)}add(e){this._hash.set(e,!0)}addList(e){for(let t of e)this.add(t)}_in(e){return this._hash._in(e)}remove(e){this._hash.remove(e)}count(){return this._hash.count()}asList(){return this._hash.keys()}each(e){this._hash.keys().forEach(e)}map(e){return this._hash.keys().map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of this._hash.keys())if(!e._in(t))return!1;return!0}};var qa=(b=>(b[b.NONE=0]="NONE",b[b.WINDOW_VISIBILITY=1]="WINDOW_VISIBILITY",b[b.WINDOW_RESIZE=2]="WINDOW_RESIZE",b[b.WINDOW_FRAME=3]="WINDOW_FRAME",b[b.MOUSE_MOVE=4]="MOUSE_MOVE",b[b.MOUSE_PRESS=5]="MOUSE_PRESS",b[b.MOUSE_DRAG=6]="MOUSE_DRAG",b[b.MOUSE_RELEASE=7]="MOUSE_RELEASE",b[b.MOUSE_SCROLL=8]="MOUSE_SCROLL",b[b.MOUSE_DROP=9]="MOUSE_DROP",b[b.MOUSE_LEAVE=10]="MOUSE_LEAVE",b[b.TOUCH_PRESS=11]="TOUCH_PRESS",b[b.TOUCH_DRAG=12]="TOUCH_DRAG",b[b.TOUCH_RELEASE=13]="TOUCH_RELEASE",b[b.KEY_PRESS=14]="KEY_PRESS",b[b.KEY_RELEASE=15]="KEY_RELEASE",b[b.GAMEPAD_DOWN=16]="GAMEPAD_DOWN",b[b.ON_MEDIA_HIT=17]="ON_MEDIA_HIT",b))(qa||{}),$o=class{type(){return this._type}target(){return this._target}modifiers(){return this._modifiers}asMouseEvent(){return null}asTouchEvent(){return null}asKeyEvent(){return null}asGamepadEvent(){return null}isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}constructor(e,t,r){this._type=e,this._target=t,this._modifiers=r,this._isAccepted=!1}};var za=class i extends $o{constructor(t,r,n,o,a,s,l,c){super(t,r,n);this._type=t;this._target=r;this._modifiers=n;this.locationInWindow=o,this.previousLocationInWindow=a,this.scrollDelta=s,this.clickCount=l,this.droppedFiles=c}interactionType(){return 0}asMouseEvent(){return this}interactionCount(){return 1}locationInView(t){let r=t.absoluteBounds();return new R(this.locationInWindow.x()-r.x(),this.locationInWindow.y()-r.y())}previousLocationInView(t){let r=t.absoluteBounds();return new R(this.previousLocationInWindow.x()-r.x(),this.previousLocationInWindow.y()-r.y())}delta(){return this.locationInWindow.subtract1(this.previousLocationInWindow)}clone(){return new i(this.type(),this.target(),this.modifiers(),this.locationInWindow,this.previousLocationInWindow,this.scrollDelta,this.clickCount,this.droppedFiles)}},Ps=class{locationInView(e){let t=e.absoluteBounds();return new R(this.locationInWindow.x()-t.x(),this.locationInWindow.y()-t.y())}previousLocationInView(e){let t=e.absoluteBounds();return new R(this.previousLocationInWindow.x()-t.x(),this.previousLocationInWindow.y()-t.y())}constructor(e,t,r,n){this.id=e,this.originalTarget=t,this.locationInWindow=r,this.previousLocationInWindow=n}},nm=class{constructor(e,t,r){this.centroid=e,this.distance=t,this.count=r}},Wa=class i extends $o{constructor(t,r,n,o,a){super(t,r,n);this._type=t;this._target=r;this._modifiers=n;this.touches=o,this.allTouches=a,this.scrollDelta=null}interactionType(){return 1}asTouchEvent(){return this}interactionCount(){return this.touches.length}locationInView(t){return this.touches[0].locationInView(t)}previousLocationInView(t){return this.touches[0].previousLocationInView(t)}summaryInView(t){return t==null?i._summarizeTouches(this.touches,r=>r.locationInWindow):i._summarizeTouches(this.touches,r=>r.locationInView(t))}previousSummaryInView(t){return t==null?i._summarizeTouches(this.touches,r=>r.previousLocationInWindow):i._summarizeTouches(this.touches,r=>r.previousLocationInView(t))}delta(){return this.summaryInView(null).centroid.subtract1(this.previousSummaryInView(null).centroid)}static _summarizeTouches(t,r){let n=R.new2(),o=0;if(t.length!=0){for(let a of t)n.addUpdate1(r(a));n.divideUpdate(t.length);for(let a of t)o+=r(a).distanceTo(n);o/=t.length}return new nm(n,o,t.length)}},Qa=class extends $o{constructor(t,r,n,o,a){super(t,r,n);this._type=t;this._target=r;this._modifiers=n;this.key=o,this.isRepeat=a}asKeyEvent(){return this}},Qd=class extends $o{constructor(t,r,n,o,a){super(t,r,n);this._type=t;this._target=r;this._modifiers=n;this.button=o,this.controllerType=a}asGamepadEvent(){return this}},Hr;(r=>{function i(n){return n.length}r.handlerCount=i;function e(n,o){ce.List_appendOne(n,o)}r.addUpdate=e;function t(n,o){ce.List_removeOne(n,o)}r.subtractUpdate=t})(Hr||(Hr={}));var Yt;(p=>{function i(A){return y(A,1)}p.windowVisibility=i;function e(A){return y(A,2)}p.windowResize=e;function t(A){return y(A,3)}p.windowFrame=t;function r(A){return y(A,4)}p.mouseMove=r;function n(A){return y(A,5)}p.mousePress=n;function o(A){return y(A,6)}p.mouseDrag=o;function a(A){return y(A,7)}p.mouseRelease=a;function s(A){return y(A,8)}p.mouseScroll=s;function l(A){return y(A,9)}p.mouseDrop=l;function c(A){return y(A,10)}p.mouseLeave=c;function d(A){return y(A,11)}p.touchPress=d;function h(A){return y(A,12)}p.touchDrag=h;function u(A){return y(A,13)}p.touchRelease=u;function m(A){return y(A,14)}p.keyPress=m;function g(A){return y(A,15)}p.keyRelease=g;function _(A){return y(A,16)}p.gamepadDown=_;function f(A,v,E){ce.List_appendOne(y(A,v),E)}p.on=f;function S(A,v,E){let D=T(A,v);D!=null&&ce.List_removeOne(D,E)}p.off=S;function b(A,v){let E=T(A,v.type());if(E!=null){for(let D of E)if(D(v),v.isAccepted())break}}p.trigger=b;function T(A,v){return zt.IntMap_get(A,v,null)}p._handlers=T;function y(A,v){let E=zt.IntMap_get(A,v,null);return E==null&&(E=[],A.set(v,E)),E}p._createHandlers=y;function I(){return new Map}p._new=I})(Yt||(Yt={}));var SA;(e=>{function i(){return new Map}e._new=i})(SA||(SA={}));var Kd;(t=>{function i(r){return He.StringMap_get(t._triggerDeviceMap,r,"UNKNOWN_CONTROLLER")}t.stringToTriggerDevice=i,t._triggerDeviceMap=new Map([["KEYBOARD","KEYBOARD"],["UNKNOWN_CONTROLLER","UNKNOWN_CONTROLLER"],["XBOX_ONE","XBOX_ONE"],["PS4","PS4"],["SWITCH_PRO","SWITCH_PRO"]])})(Kd||(Kd={}));var Fs;(t=>{function i(r,n,o,a){return zt.IntMap_get(r,n<<8|o,a)}t.KeyShortcutMap_get=i;function e(r,n,o,a){r.set(n<<8|o,a)}t.KeyShortcutMap_set=e})(Fs||(Fs={}));var aa;(s=>{function i(l){return l==1||l==2||l==3}s.ViewerEventType_isWindowEventType=i;function e(l){return l==4||l==5||l==6||l==7||l==8||l==9||l==10}s.ViewerEventType_isMouseEventType=e;function t(l){return l==11||l==12||l==13}s.ViewerEventType_isTouchEventType=t;function r(l){return l==14||l==15}s.ViewerEventType_isKeyEventType=r;function n(l){return l==11||l==13||l==5||l==7||l==8||l==9}s.ViewerEventType_isTypeToBeBlockedByDeviceFrame=n;function o(l){return He.StringMap_get(s.ViewerEventType__eventTypeFromString,l,0)}s.ViewerEventType_fromString=o,s.ViewerEventType__eventTypeFromString=new Map([["NONE",0],["WINDOW_VISIBILITY",1],["WINDOW_RESIZE",2],["WINDOW_FRAME",3],["MOUSE_MOVE",4],["MOUSE_PRESS",5],["MOUSE_DRAG",6],["MOUSE_RELEASE",7],["MOUSE_SCROLL",8],["MOUSE_DROP",9],["MOUSE_LEAVE",10],["TOUCH_PRESS",11],["TOUCH_DRAG",12],["TOUCH_RELEASE",13],["KEY_PRESS",14],["KEY_RELEASE",15],["GAMEPAD_DOWN",16]])})(aa||(aa={}));var jl;(t=>{function i(r){return r>=105&&r<=108}t.Key_isModifier=i;function e(r){return zt.IntMap_get(XI,r,[0])}t.Key_keyToKeyCode=e})(jl||(jl={}));var Ka;(e=>{function i(){return Gt.current()==4?2:8}e.Modifiers_currentPlatformModifier=i})(Ka||(Ka={}));function YI(i){let e=new Map;return zt.IntMap_each(i,(t,r)=>{let n=r;if(e.has(n)){e.get(n).push(t);return}e.set(n,[t])}),e}var om=new Map([[8,1],[9,2],[10,3],[13,3],[16,107],[17,108],[18,105],[19,5],[20,6],[27,7],[32,8],[33,9],[34,10],[35,11],[36,12],[37,13],[38,14],[39,15],[40,16],[44,17],[45,18],[46,19],[48,20],[49,21],[50,22],[51,23],[52,24],[53,25],[54,26],[55,27],[56,28],[57,29],[59,90],[61,93],[63,30],[65,31],[66,32],[67,33],[68,34],[69,35],[70,36],[71,37],[72,38],[73,39],[74,40],[75,41],[76,42],[77,43],[78,44],[79,45],[80,46],[81,47],[82,48],[83,49],[84,50],[85,51],[86,52],[87,53],[88,54],[89,55],[90,56],[91,106],[92,106],[93,57],[96,58],[97,59],[98,60],[99,61],[100,62],[101,63],[102,64],[103,65],[104,66],[105,67],[106,68],[107,69],[109,70],[110,71],[111,72],[112,76],[113,77],[114,78],[115,79],[116,80],[117,81],[118,82],[119,83],[120,84],[121,85],[122,86],[123,87],[144,88],[145,89],[173,91],[186,90],[187,93],[188,94],[189,91],[190,95],[191,96],[192,104],[219,99],[220,100],[221,101],[222,98],[224,106]]),XI=YI(om);var Xd=(r=>(r[r.NONE=0]="NONE",r[r.POINTER=1]="POINTER",r[r.TOUCH=2]="TOUCH",r))(Xd||{}),gi=class gi{parent(){return this._parent}window(){return this._window}children(){return this._children}events(){return this._events}focus(){this._window.setFocusedView(this)}absoluteBounds(){if(this._cachedAbsoluteBounds!=null)return this._cachedAbsoluteBounds;let e=null;if(this.parent()!=null)e=this.parent().absoluteBounds();else if(this==this.window().root())e=new V(0,0,this.window().width(),this.window().height());else return null;let t=e.width()|0,r=e.height()|0,n=this._minX+(this._alignX==2?t:0),o=this._maxX+(this._alignX!=0?t:0),a=this._minY+(this._alignY==2?r:0),s=this._maxY+(this._alignY!=0?r:0);return this._cachedAbsoluteBounds=new V(e.x()+n,e.y()+a,Math.max(0,o-n),Math.max(0,s-a)),e}viewFromPoint(e){let t=this.children().length;for(let r=0,n=t;r<n;r=r+1){let o=this.children()[t-r-1];if(o.absoluteBounds().contains2(e))return o.viewFromPoint(e)}return this}invalidateBounds(){this.forSelfAndDescendents(e=>{e._cachedAbsoluteBounds=null})}isEqualToOrParentOf(e){for(;e!=null;){if(e==this)return!0;e=e.parent()}return!1}selfAndParents(){let e=[];for(let t=this;t!=null;t=t.parent())e.push(t);return e}selfAndChildren(){let e=[],t=[this];for(;t.length!=0;){let r=t.pop(),n=r.children().length;e.push(r);for(let o=0,a=n;o<a;o=o+1)t.push(r.children()[n-o-1])}return e}setLayout(e,t,r,n,o,a){(this._alignX!=e||this._minX!=t||this._maxX!=r||this._alignY!=n||this._minY!=o||this._maxY!=a)&&(this._alignX=e,this._minX=t,this._maxX=r,this._alignY=n,this._minY=o,this._maxY=a,this._handleLayoutChange(),this.invalidateBounds())}setParent(e){if(e==this._parent)return;this._parent!=null&&ce.List_removeOne(this._parent.children(),this),e!=null&&e.children().push(this),this._handleParentChange(this._parent,e),this._parent=e,this.invalidateBounds();let t=e==null?void 0:e._window;this._window!=t&&this.forSelfAndDescendents(r=>{r._window=t})}forSelfAndDescendents(e){e(this);for(let t of this.children())t.forSelfAndDescendents(e)}setCursor(e){gi._appendCursorStyleIfNecessary(),e!=this._cursor&&(this._element.classList.remove(gi._cssCursorClassName(this._cursor)),this._cursor=e,this._element.classList.add(gi._cssCursorClassName(this._cursor)))}cursor(){return this._cursor}element(){return this._element==null&&(this._element=document.createElement("div"),this._element.style.position="absolute",this._handleLayoutChange()),this._element}becomeRoot(e){this._window=e}_handleParentChange(e,t){t!=null&&t._element!=null?t._element.appendChild(this.element()):e._element!=null&&e._element.removeChild(this.element())}_handleLayoutChange(){if(this._element!=null){let e=this._element.style;e.left=this._alignX==2?"auto":this._minX.toString()+"px",e.top=this._alignY==2?"auto":this._minY.toString()+"px",e.right=this._alignX==0?"auto":this._maxX.toString()+"px",e.bottom=this._alignY==0?"auto":this._maxY.toString()+"px",e.width=this._alignX==1?"auto":(this._maxX-this._minX).toString()+"px",e.height=this._alignY==1?"auto":(this._maxY-this._minY).toString()+"px"}}static _appendCursorStyleIfNecessary(){if(gi._cursorStyle!=null)return;let e=(d,h,u,m)=>`
      cursor: url("${u}"), auto; /* Edge, IE */
      cursor: url("${d}") 30 30, pointer; /* Legacy */
      cursor: url("${m}") 30 30, pointer; /* FF */
      cursor: -webkit-image-set(url("${d}") 1x, url("${h}") 2x) 30 30, pointer; /* Webkit */
      `,t="/images/viewer/cursor-touch.png",r="/images/viewer/cursor-touch.cur",n="/images/viewer/cursor-touch@2x.png",o="/images/viewer/cursor-touch.svg",a="/images/viewer/cursor-touch-down.png",s="/images/viewer/cursor-touch-down.cur",l="/images/viewer/cursor-touch-down@2x.png",c="/images/viewer/cursor-touch-down.svg";gi._cursorStyle=document.createElement("style"),gi._cursorStyle.textContent=`
    .cursor-default {
      cursor: default;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .cursor-touch {
      ${e(t,n,r,o)}
    }

    .cursor-touch:active {
      ${e(a,l,s,c)}
    }

    /*
      We provide a mechanism for the app outside of the viewer to disable all
      viewer cursors. This is useful e.g. in comments mode where the containing
      react application is responsible for setting the cursor instead of code
      inside the viewer library. To use this, the containing application would
      add the viewer-cursors-disabled class to the HTMLElement that hosts the
      viewer canvas.
    */

    .viewer-cursors-disabled .cursor-default {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-pointer {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch {
      cursor: inherit;
    }

    .viewer-cursors-disabled .cursor-touch:active {
      cursor: inherit;
    }
`,document.head.appendChild(gi._cursorStyle)}static _cssCursorClassName(e){switch(e){case 0:return"cursor-default";case 1:return"cursor-pointer";case 2:return"cursor-touch"}return null}constructor(){this._parent=null,this._window=null,this._children=[],this._events=Yt._new(),this._alignX=1,this._minX=0,this._maxX=0,this._alignY=1,this._minY=0,this._maxY=0,this._cachedAbsoluteBounds=null,this._element=null,this._cursor=0}};gi._cursorStyle=null;var $l=gi,im=class{name(){return this._file.name}mimeType(){return this._file.type}bytes(){return this._promise==null&&(this._promise=new Promise((e,t)=>{let r=new FileReader;r.onload=()=>{e(new Uint8Array(gd.FileReader_resultAsArrayBuffer(r)))},r.onloadend=()=>{t(An.VOID)},r.readAsArrayBuffer(this._file)})),this._promise}constructor(e){this._file=e,this._promise=null}},qd=class{constructor(e,t,r,n,o){this._root=null,this._width=0,this._height=0,this._devicePixelRatio=0,this._eventHandlersBefore=Yt._new(),this._eventHandlersAfter=Yt._new(),this._isInlinePreviewCallback=o,this._disableKeyboardHandlingCallback=n,this._events=Yt._new(),this._afterNotifyCallback=null,this._isActive=!0,this._focusedView=null,this._containerElement=null,this._disableOwnOnFrameCallback=!1,this._internalOnFrameID=0,this.forceFrame=null,this.internalOnFrame=null,this._containerElement=e,this._disableOwnOnFrameCallback=r,this._root=new $l,this._root.becomeRoot(this);let a=null,s=null,l=null,c=null,d=null,h=null,u=document,m=window,g=this.root().element(),_=w=>{xo.Event_preventDefault(w)},f=(w,P)=>{Jt.EventTarget_removeEventListener3(w,"mousemove",s),Jt.EventTarget_removeEventListener3(w,"mouseup",l),Jt.EventTarget_removeEventListener5(w,"touchmove",d),Jt.EventTarget_removeEventListener5(w,"touchend",h),Jt.EventTarget_addEventListener4(P,"mousemove",s),Jt.EventTarget_addEventListener4(P,"mouseup",l),Jt.EventTarget_addEventListener6(P,"touchmove",d),Jt.EventTarget_addEventListener6(P,"touchend",h)};this.forceFrame=()=>{this._resize(),Yt.trigger(this.events(),new $o(3,this.root(),0))},this.internalOnFrame=()=>{this._resize();try{Yt.trigger(this.events(),new $o(3,this.root(),0))}catch(w){Le(w)}this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))};let S=()=>{this._isActive=!u.hidden,Yt.trigger(this.events(),new $o(1,this.root(),0)),f(u,g)},b=w=>{let P=(w.altKey?1:0)|(w.metaKey?2:0)|(w.shiftKey?4:0)|(w.ctrlKey?8:0);return Ka.Modifiers_currentPlatformModifier()&P?P|16:P},T=(w,P)=>{for(let H=this.root().element();H!=null;H=H.offsetParent)w=w-H.offsetLeft,P=P-H.offsetTop;return new R(w,P)},y=0,I=0,p=0,A=0,v=w=>{let P=0,H=Pa.Performance_now(m.performance);return P=1,A!=0&&H-A<500&&Math.abs(w.pageX-y)<4&&Math.abs(w.pageY-I)<4&&(P=p+1),y=w.pageX,I=w.pageY,p=P,A=H,P},E=null,D=null,G=!1,U=(w,P,H,Q)=>{let Y=T(w.pageX,w.pageY),ne=D??this.root().viewFromPoint(Y),W=new za(P==4&&G?6:P,ne,b(w),Y,E??Y,H,P==5?v(w):0,Q);E=Y,this.notify(W),W.isAccepted()&&(W.type()==5&&w.button==0||xo.Event_preventDefault(w),P==5&&(D=ne)),P==5?G=!0:P==7&&(D=null,G=!1)},M=new Map,z=(w,P)=>{let H=new Map,Q=[];Array.from(M.values()).forEach(ne=>{ce.List_appendOne(Q,ne.originalTarget)});let Y=_d.TouchEvent_touches(w).map(ne=>{let W=ne.identifier,K=T(ne.pageX,ne.pageY),j=zt.IntMap_get(M,W,null),ge=j!=null?j.originalTarget:this.root().viewFromPoint(K),Ue=new Ps(W,ge,K,j!=null?j.locationInWindow:K);return H.set(W,Ue),ce.List_appendOne(Q,ge),Ue});M=H;for(let ne of Q){let W=new Wa(P,ne,b(w),Y.filter(K=>K.originalTarget==ne),Y);this.notify(W),W.isAccepted()&&xo.Event_preventDefault(w)}},B=(w,P)=>{if(this._disableKeyboardHandlingCallback())return;let H=zt.IntMap_get(om,w.which,0),Q=b(w),Y=(Ka.Modifiers_currentPlatformModifier()&Q)!=0&&(H==91||H==93||H==20),ne=this.focusedView();Y&&xo.Event_preventDefault(w);let W=K=>{for(;K!==u;){if(K.className.split(" ").indexOf("viewer-forward-keyevents")!=-1)return!0;K=K.parentNode}return!1};if((Y||u.activeElement==null||u.activeElement==u.body||W(u.activeElement))&&H!=0&&ne!=null){let K=new Qa(P,ne,Q,H,!1);this.notify(K),(K.isAccepted()||H==1)&&(xo.Event_preventDefault(w),w.stopPropagation())}};if(a=w=>{f(g,u),U(w,5,null,null),window.focus(),document.activeElement!=null&&document.activeElement.blur()},s=w=>{U(w,4,null,null)},l=w=>{f(u,g),U(w,7,null,null)},c=w=>{z(w,11)},d=w=>{z(w,12)},h=w=>{z(w,13)},Jt.EventTarget_addEventListener3(u,"keydown",w=>{B(w,14)}),Jt.EventTarget_addEventListener3(u,"keyup",w=>{B(w,15)}),Jt.EventTarget_addEventListener7(g,"wheel",w=>{let P=w.deltaMode,H=P==w.DOM_DELTA_LINE?10:P==w.DOM_DELTA_PAGE?100:1;U(w,8,new R(w.deltaX*H,w.deltaY*H),null)}),Jt.EventTarget_addEventListener14(u,"wheel",w=>{w.ctrlKey&&xo.Event_preventDefault(w)},{passive:!1}),Jt.EventTarget_addEventListener5(u,"drop",w=>{xo.Event_preventDefault(w),U(w,9,null,fd.DataTransfer_files(w.dataTransfer).map(P=>new im(P)))}),Jt.EventTarget_addEventListener4(u,"mouseenter",w=>{E=null}),Jt.EventTarget_addEventListener4(g,"mouseleave",w=>{U(w,10,null,null)}),t!=null){let w=t;w.onPress(P=>{let H=new Qd(16,this.root(),0,P.buttons[0],Kd.stringToTriggerDevice(P.controllerType));this.notifyAll(H)}),w.start()}Jt.EventTarget_addEventListener1(m,"resize",()=>{this._resize()}),Jt.EventTarget_addEventListener1(m,"visibilitychange",S),Jt.EventTarget_addEventListener2(g,"contextmenu",_),Jt.EventTarget_addEventListener4(g,"mousedown",a),Jt.EventTarget_addEventListener6(g,"touchstart",c),Jt.EventTarget_addEventListener2(u,"dragenter",_),Jt.EventTarget_addEventListener2(u,"dragover",_),this._containerElement!=null&&this._containerElement.appendChild(g),this._focusedView=this.root(),S(),this._resize(),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}root(){return this._root}width(){return this._width}height(){return this._height}size(){return new R(this._width,this._height)}isActive(){return this._isActive}focusedView(){return this._focusedView}devicePixelRatio(){return this._devicePixelRatio}eventsBefore(){return this._eventHandlersBefore}eventsAfter(){return this._eventHandlersAfter}events(){return this._events}setAfterNotify(e){this._afterNotifyCallback=e}clearAfterNotify(){this._afterNotifyCallback=null}_afterNotify(e){this._afterNotifyCallback!=null&&this._afterNotifyCallback(e)}notify(e){let t=e.target().selfAndParents();if(Yt.trigger(this._eventHandlersBefore,e),e.isAccepted()){this._afterNotify(e);return}for(let r of t)if(Yt.trigger(r.events(),e),e.isAccepted()){this._afterNotify(e);return}Yt.trigger(this._eventHandlersAfter,e),this._afterNotify(e)}notifyAll(e){let t=e.target().selfAndChildren();if(Yt.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let r of t)if(Yt.trigger(r.events(),e),e.isAccepted())return;Yt.trigger(this._eventHandlersAfter,e)}}dangerouslyDisableOnFrameCallbackForTesting(){this._disableOwnOnFrameCallback=!0}_resize(){if(this._containerElement==null)return;let e=document.body,t=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().width:this._containerElement==e?window.innerWidth:this._containerElement.clientWidth,r=this._isInlinePreviewCallback()?this._containerElement.getBoundingClientRect().height:this._containerElement==e?window.innerHeight:this._containerElement.clientHeight,n=Jn();(this._width!=t||this._height!=r||this._devicePixelRatio!=n)&&(this._width=t,this._height=r,this._devicePixelRatio=n,this.root().invalidateBounds(),this.notifyAll(new $o(2,this.root(),0)))}setFocusedView(e){this._focusedView=e}createDiv(){return document.createElement("div")}setNewContainerElement(e){if(e==null)throw new Error("Can't mount the viewer in a null DOM node");this._containerElement=e,e.appendChild(this.root().element()),this._resize(),this._internalOnFrameID!=0&&cancelAnimationFrame(this._internalOnFrameID),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}};var bA;(t=>{function i(){return[]}t.new1=i;function e(r){return r.slice()}t.new2=e})(bA||(bA={}));var jt;(b=>{function i(T){return T.length}b.FrozenList_count=i;function e(T){return T.length==0}b.FrozenList_isEmpty=e;function t(T,y){return T[y]}b.FrozenList_get=t;function r(T){return ce.List_last(T)}b.FrozenList_last=r;function n(T,y){return T.some(y)}b.FrozenList_any=n;function o(T,y){return T.filter(y)}b.FrozenList_filter=o;function a(T,y){T.forEach(y)}b.FrozenList_each=a;function s(T){return T[0]}b.FrozenList_first=s;function l(T,y){return T.map(y)}b.FrozenList_map=l;function c(T){return T.slice()}b.FrozenList_clone=c;function d(T,y,I){return T.slice(y,I)}b.FrozenList_slice=d;function h(T,y){let I=T.slice();return ce.List_appendOne(I,y),I}b.FrozenList_cloneAndAppendOne=h;function u(T,y){let I=T.slice();return ce.List_removeOne(I,y),I}b.FrozenList_cloneAndRemoveOne=u;function m(T,y,I){return ce.List_equalsWithComparison(T,y,I)}b.FrozenList_equals=m;function g(T,y){return T.indexOf(y)!=-1}b._in=g;function _(T,y){for(let I of T)if(y(I))return!0;return!1}b.FrozenList_contains=_;function f(T,y){let I=T.slice();return I.sort(y),I}b.FrozenList_sorted=f;function S(T,y){let I=T.slice();return I.push(y),I}b.FrozenList_cloneAndAppend=S})(jt||(jt={}));var zr=class{add(e){this._observers=jt.FrozenList_cloneAndAppendOne(this._observers,e)}remove(e){this._observers=jt.FrozenList_cloneAndRemoveOne(this._observers,e)}forEach(e){let t=this._observers;t.forEach(r=>{(t==this._observers||this._observers.indexOf(r)!=-1)&&e(r)})}constructor(){this._observers=[]}};var dr;(u=>{function i(m,g){return fo.string_compare(m,g)}u.compare=i;function e(m,g){return m==g}u.equals=e;function t(m){return m}u.toString=t;function r(m){return m.length>0}u.isValid=r;function n(m){let g=m,_=g.length-1,f=_;for(;f>=0;){let S=g.charCodeAt(f);if(S>u.LOWER+1)return g.slice(0,f)+String.fromCharCode(S-1);f=f-1}return g.slice(0,_)+String.fromCharCode(u.LOWER)+String.fromCharCode(u.UPPER)}u.before=n;function o(m){let g=m,_=g.length-1;for(;_>=0;){let f=g.charCodeAt(_);if(f<u.UPPER)return g.slice(0,_)+String.fromCharCode(f+1);_=_-1}return g+String.fromCharCode(u.LOWER+1)}u.after=o;function a(m){if(m==null||m==""||m.charCodeAt(m.length-1)==u.LOWER)return null;for(let g=0,_=m.length;g<_;g=g+1)if(m.charCodeAt(g)<u.LOWER||m.charCodeAt(g)>u.UPPER)return null;return m}u.fromString=a;function s(m,g){let _=m,f=g,S=_.length,b=f.length,T="",y=!1;for(let I=0,p=Math.max(S,b);I<p;I=I+1){let A=I<S?_.charCodeAt(I):u.LOWER,v=I<b&&!y?f.charCodeAt(I):u.UPPER;if(A==v)T+=String.fromCharCode(A);else if(v-A>1){T+=String.fromCharCode(A+v>>1),y=!1;break}else T+=String.fromCharCode(A),y=!0}return y&&(T+=String.fromCharCode(u.LOWER+u.UPPER>>1)),T}u.between=s,u.LOWER=32,u.UPPER=126,u.FIRST_POSITION=String.fromCharCode(u.LOWER+1),u.SECOND_POSITION=String.fromCharCode(u.LOWER+2)})(dr||(dr={}));var Vr=class i{toString(){return`${this.id};${dr.toString(this.position)}`}equals(e){return J.equals(this.id,e.id)&&dr.equals(this.position,e.position)}static fromString(e){let t=e.indexOf(";");if(t==-1)return null;let r=e.slice(0,t);if(r=="-1:-1")return null;let n=J.fromString(r);return new i(n,dr.fromString(e.slice(t+1)))}constructor(e,t){this.id=e,this.position=t}};var nt;(kt=>{function i(pe){try{if(t(pe))return pe.toString();if(r(pe))return y(pe).toString();if(n(pe))return I(pe).toString();if(a(pe))return pe;if(pe instanceof Array)return pe.length===0?"[]":"toString"in pe[0]?"["+pe.map(Me=>Me.toString()).join(", ")+"]":"[...]";if("toString"in pe)return pe.toString()}catch{}return"?"}kt.toString=i;function e(pe,Me){return t(pe)&&t(Me)?pe.equals1(Me):s(pe)&&s(Me)?pe.equals(Me):(r(pe)||n(pe)||a(pe)||As(pe),pe==Me)}kt.equals=e;function t(pe){return pe instanceof ee}kt.isAffineTransform=t;function r(pe){return typeof pe=="boolean"}kt.isBool=r;function n(pe){return typeof pe=="number"}kt.isDouble=n;function o(pe){return pe.guid!==void 0&&pe.ref!==void 0}kt.isStyleId=o;function a(pe){return typeof pe=="string"}kt.isString=a;function s(pe){return pe instanceof R}kt.isVector=s;function l(pe){return pe instanceof Array}kt.isList=l;function c(pe){return pe instanceof Vr}kt.isParentIndex=c;function d(pe){return typeof pe=="string"}kt.isGUID=d;function h(pe){return typeof pe=="string"}kt.isScrollDirection=h;function u(pe){return typeof pe=="string"}kt.isPosition=u;function m(pe){return typeof pe=="string"}kt.isScrollBehavior=m;function g(pe){return typeof pe=="string"}kt.isNavigationType=g;function _(pe){return typeof pe=="string"}kt.isOverlayPositionType=_;function f(pe){return typeof pe=="string"}kt.isOverlayBackgroundInteraction=f;function S(pe){return typeof pe=="string"}kt.isShapeWithTextType=S;function b(pe){return pe.autoplay!==void 0&&pe.mediaLoop!==void 0&&pe.muted!==void 0}kt.isVideoPlayback=b;function T(pe){return pe}kt.asAffineTransform=T;function y(pe){return!!pe}kt.asBool=y;function I(pe){return+pe}kt.asDouble=I;function p(pe){return pe}kt.asStyleId=p;function A(pe){return pe}kt.asInt=A;function v(pe){return pe}kt.asString=v;function E(pe,Me){return a(pe)?pe:Me}kt.asStringEnum=E;function D(pe){return pe}kt.asVector=D;function G(pe){return pe}kt.asPaintList=G;function U(pe){return pe}kt.asPaintData=U;function M(pe){return pe}kt.asEffectList=M;function z(pe){return pe}kt.asExportSettingsList=z;function B(pe){return pe}kt.asParentIndex=B;function w(pe){return pe}kt.asGUID=w;function P(pe){return pe}kt.asScrollDirection=P;function H(pe){return pe}kt.asPosition=H;function Q(pe){return pe}kt.asScrollBehavior=Q;function Y(pe){return pe}kt.asNavigationType=Y;function ne(pe){return pe}kt.asOverlayPositionType=ne;function W(pe){return pe}kt.asOverlayBackgroundInteraction=W;function K(pe){return pe}kt.asArcData=K;function j(pe){return pe}kt.asShapeWithTextType=j;function ge(pe){return pe}kt.asVideoPlayback=ge,kt.ZERO_VECTOR=ye.FrozenVector_new1(),kt.IDENTITY_TRANSFORM=Nt.FrozenAffineTransform_new1(),kt.EMPTY_PAINT_LIST=[],kt.EMPTY_EFFECT_LIST=[],kt.DEFAULT_ARC_DATA={startingAngle:0,endingAngle:2*Math.PI,innerRadius:0}})(nt||(nt={}));var $t=class i{static getEventEmitter(){return i._eventEmitter||(i._eventEmitter=new i),i._eventEmitter}on(e,t){ce.List_appendOne(this._list(e),t)}off(e,t){ce.List_removeOne(this._list(e),t)}trigger(e,t){let r=this._list(e).slice();for(let n of r)n(t)}constructor(){this._callbacks=new Map}_list(e){return this._callbacks.has(e)?this._callbacks.get(e):(this._callbacks.set(e,[]),this._callbacks.get(e))}};(t=>{class i{constructor(){this._emitter=t.getEventEmitter()}handleAction(n,o){switch(n){case 5:{this._emitter.trigger("mirrorTap");break}case 6:{this._emitter.trigger("canvasMouseDown",nt.asVector(o).toJSON());break}case 7:{this._emitter.trigger("canvasMouseMove",nt.asVector(o).toJSON());break}case 8:{this._emitter.trigger("canvasMouseDrag",nt.asVector(o).toJSON());break}case 9:{this._emitter.trigger("canvasMouseUp",nt.asVector(o).toJSON());break}case 10:{this._emitter.trigger("canvasTouchDown",nt.asVector(o).toJSON());break}}}}t.ActionHandler=i;class e{constructor(n){this._emitter=t.getEventEmitter();this._state=n,this._visible=!1}onFrame(){let n=this._state.baseScreenNode()!=null;this._visible!=n&&(this._visible=n,this._emitter.trigger("baseScreenVisibilityChange",this._visible))}}t.AppHandler=e})($t||($t={}));var ln=class i{add(e){this._hash.set(e,!0)}_in(e){return this._hash.has(e)}remove(e){this._hash.delete(e)}count(){return this._hash.size}asList(){return Array.from(this._hash.keys())}each(e){Array.from(this._hash.keys()).forEach(e)}map(e){return Array.from(this._hash.keys()).map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.keys()))if(!e._in(t))return!1;return!0}static fromList(e){let t=new i;for(let r of e)t.add(r);return t}constructor(){this._hash=new Map}};var Zr=class Zr{count(){return this._heap.length}peek(){if(this.count()==0)throw new Error("Peeking on an empty queue");return this._heap[Zr.ROOT_INDEX].value}insertOrUpdate(e,t){if(this._indexByElement.has(e)){this.remove(e),this.insertOrUpdate(e,t);return}let r=new Zr.Element(e,t);this._heap.push(r),this._indexByElement.set(r.value,this.count()-1),this._siftUp(this.count()-1)}getPriority(e){if(!this._indexByElement.has(e))return null;let t=this._indexByElement.get(e),r=this._heap[t];return new fe(r.priority)}remove(e){if(!this._indexByElement.has(e))return;let t=this._indexByElement.get(e),r=this.count()-1;r>t&&this._swap(t,r);let n=this._heap.pop();this._indexByElement.delete(n.value),t!=r&&(this._siftDown(t),this._siftUp(t))}allValues(){return this._heap.map(e=>e.value)}maxPriority(){if(this.count()==0)throw new Error("Calling maxPriority on an empty queue");return this._heap[Zr.ROOT_INDEX].priority}pop(){if(this.count()==0)throw new Error("Popping an empty queue");let e=this.peek();return this.remove(e),e}_isGreater(e,t){return this._compare(this._heap[e].priority,this._heap[t].priority)>0}_swap(e,t){let r=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=r,this._indexByElement.set(this._heap[e].value,e),this._indexByElement.set(this._heap[t].value,t)}_siftUp(e){let t=e;for(;t>Zr.ROOT_INDEX&&this._isGreater(t,Zr.indexOfParent(t));)this._swap(t,Zr.indexOfParent(t)),t=Zr.indexOfParent(t)}_siftDown(e){let t=e;for(;Zr.indexOfLeftChild(t)<this.count()&&this._isGreater(Zr.indexOfLeftChild(t),t)||Zr.indexOfRightChild(t)<this.count()&&this._isGreater(Zr.indexOfRightChild(t),t);){let r=Zr.indexOfRightChild(t)<this.count()&&this._isGreater(Zr.indexOfRightChild(t),Zr.indexOfLeftChild(t))?Zr.indexOfRightChild(t):Zr.indexOfLeftChild(t);this._swap(t,r),t=r}}static indexOfParent(e){return((e+1)/2|0)-1}static indexOfLeftChild(e){return e*2+1}static indexOfRightChild(e){return(e+1)*2}constructor(e){this._heap=[],this._indexByElement=new Map,this._compare=e}};Zr.ROOT_INDEX=0;var Mi=Zr;(e=>{class i{constructor(r,n){this.value=r,this.priority=n}}e.Element=i})(Mi||(Mi={}));var Hn=class i{recomposed(){let e=ee.new2();e.setM00(this.m00),e.setM01(this.m01),e.setM10(this.m10),e.setM11(this.m11),e.setM02(this.translation.x()),e.setM12(this.translation.y());let t=Math.PI/180*this.angleDegrees,r=Math.cos(t),n=Math.sin(t),o=ee.new2();return o.setM00(r),o.setM01(-n),o.setM10(n),o.setM11(r),e.multiply(o),e.setM00(e.m00()*this.scale.x()),e.setM01(e.m01()*this.scale.y()),e.setM10(e.m10()*this.scale.x()),e.setM11(e.m11()*this.scale.y()),e}static from(e){let t=new i,r=e.m00(),n=e.m10(),o=e.m01(),a=e.m11();t.translation=R.new3(e.translation()),t.scale=R.new3(e.scale1()),r*a-n*o<0&&(r<a?t.scale.setX(-t.scale.x()):t.scale.setY(-t.scale.y())),t.scale.x()!=0&&(r*=1/t.scale.x(),n*=1/t.scale.x()),t.scale.y()!=0&&(o*=1/t.scale.y(),a*=1/t.scale.y());let l=Math.atan2(n,r);if(l!=0){let c=-n,d=r,h=r,u=n,m=o,g=a;r=d*h+c*m,n=d*u+c*g,o=-c*h+d*m,a=-c*u+d*g}return t.angleDegrees=180/Math.PI*l,t.m00=r,t.m10=n,t.m01=o,t.m11=a,t}static lerp1(e,t,r){let n=i.from(e),o=i.from(t);return i.lerp2(n,o,r).recomposed()}static lerp2(e,t,r){(e.scale.x()<0&&t.scale.y()<0||e.scale.y()<0&&t.scale.x()<0)&&(e.scale.setX(-e.scale.x()),e.scale.setY(-e.scale.y()),e.angleDegrees+=e.angleDegrees<0?180:-180),e.angleDegrees==0&&(e.angleDegrees=360),t.angleDegrees==0&&(t.angleDegrees=360),Math.abs(e.angleDegrees-t.angleDegrees)>180&&(e.angleDegrees>t.angleDegrees?e.angleDegrees-=360:t.angleDegrees-=360);let n=new i;return n.translation=e.translation.multiply(1-r).add1(t.translation.multiply(r)),n.scale=e.scale.multiply(1-r).add1(t.scale.multiply(r)),n.angleDegrees=e.angleDegrees*(1-r)+t.angleDegrees*r,n.m00=e.m00*(1-r)+t.m00*r,n.m10=e.m10*(1-r)+t.m10*r,n.m01=e.m01*(1-r)+t.m01*r,n.m11=e.m11*(1-r)+t.m11*r,n}constructor(){this.translation=R.new2(),this.scale=R.new2(),this.angleDegrees=0,this.m00=0,this.m01=0,this.m10=0,this.m11=0}};var Ya;(t=>{function i(r){return r=="GRADIENT_LINEAR"||r=="GRADIENT_RADIAL"||r=="GRADIENT_ANGULAR"||r=="GRADIENT_DIAMOND"}t.isGradient=i;function e(r){return r=="GRADIENT_ANGULAR"}t.shouldWrap=e})(Ya||(Ya={}));var ot=class{constructor(e,t){this.color=e,this.position=t}};ot.COMPARE=(e,t)=>Xt.double_compare(e.position,t.position),ot.EQUALS=(e,t)=>e.color==t.color&&e.position==t.position;var tc=class tc{id(){return this._id}asSinglePaint(){return null}asVolatilePaint(){return null}debugString(){return""}isGradient(){switch(this.type()){case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":return!0}return!1}constructor(){this._id=tc._previousID=tc._previousID+1}};tc._previousID=0;var Jd=tc,eo=class eo extends Jd{constructor(t){super();this._type=null,this._color=C.TRANSPARENT,this._opacity=1,this._isEnabled=!0,this._colorStops=null,this._blendMode="NORMAL",this._image=null,this._imageThumbnail=null,this._video=null,this._videoPlaybackParams="",this._transform=Nt.FrozenAffineTransform_IDENTITY,this._rotationDeg=0,this._scalingFactor=1,this._imageScaleMode="STRETCH",this._filterColorAdjust=null,this._originalImageWidth=0,this._originalImageHeight=0,this._decodedImageIsReady=!1,this._decodedImageThumbnailIsReady=!1,this._type=t}type(){return this._type}color(){return this._color}opacity(){return this._opacity}isEnabled(){return this._isEnabled}isVolatile(){return!1}isVisible(){return this._isEnabled&&this._opacity>0}blendMode(){return this._blendMode}transform(){return this._transform}setIsEnabled(t){this._isEnabled=t}debugString(){return`SinglePaint id=${this._id} type=${this._type} blend=${this._blendMode} opacity=${this._opacity}${this._isEnabled?"":" [hidden]"}`}image(){return this._image}imageThumbnail(){return this._imageThumbnail}video(){return this._video}imageScaleMode(){return this._imageScaleMode}rotationDeg(){return this._rotationDeg}scalingFactor(){return this._scalingFactor}filterColorAdjust(){return this._filterColorAdjust}decodedImageIsReady(){return this._decodedImageIsReady}decodedImageThumbnailIsReady(){return this._decodedImageThumbnailIsReady}colorStops(){return this._colorStops}lastStopIsTransparent(){return this._colorStops.length!=0&&C.alpha(ce.List_last(this._colorStops).color)==0}isImageAvailable(){return this._image!=null&&this._image.isDecoded()}isImageThumbnailAvailable(){return this._image!=null&&this._image.isDecoded()}setType(t){this._type=t}setColor(t){this._color=t}setBlendMode(t){this._blendMode=t}setImage(t){this._image=t}setImageThumbnail(t){this._imageThumbnail=t}setVideo(t){this._video!=null&&t==null&&console.log(new Error().stack),this._video=t}videoPlaybackParams(t){this._videoPlaybackParams=t}setTransform(t){this._transform=t}setTransform1(t){this._transform=t.clone()}setImageScaleMode(t){this._imageScaleMode=t}setRotationDeg(t){this._rotationDeg=t}setScalingFactor(t){this._scalingFactor=t}setFilterColorAdjust(t){this._filterColorAdjust=t}setDecodedImageIsReady(t){this._decodedImageIsReady=t}setDecodedImageThumbnailIsReady(t){this._decodedImageThumbnailIsReady=t}setColorStops(t){this._colorStops=t}setColorStops1(t){this._colorStops=t.slice()}setOpacity(t){this._opacity=t}setOriginalImageWidth(t){this._originalImageWidth=t}setOriginalImageHeight(t){this._originalImageHeight=t}allocateBoundsToImageRatio(t,r){let n=R.new3(t);return this._rotationDeg!=0&&(ee.new2().rotatedBy(this._rotationDeg*(Math.PI/180)).transformPoint(r),r.makeAbs()),n.divideUpdate1(r),n}allocateImageSize(){let t=this._video!=null&&this._video.didLoad(this),r=this._image!=null&&this._image.isDecoded(),n=this._imageThumbnail!=null&&this._imageThumbnail.isDecoded();return t?this._video.size(this):r?new R(this._image.width(),this._image.height()):n?this._originalImageWidth!=0&&this._originalImageHeight!=0?new R(this._originalImageWidth,this._originalImageHeight):new R(this._imageThumbnail.width(),this._imageThumbnail.height()):null}allocateImageTransformForGeometrySize(t){let r=this._rotationDeg*(Math.PI/180),n=ee.new2(),o=this.allocateImageSize();o==null&&Le("Trying to render image before it is loaded");let a=this.allocateBoundsToImageRatio(t,o);switch(this.imageScaleMode()){case"FILL":{n=n.translatedBy2(.5,.5).rotatedBy(-r).scaledBy3(a.x()/a.max1(),a.y()/a.max1()).translatedBy2(-.5,-.5);break}case"FIT":{n=n.translatedBy2(.5,.5).rotatedBy(-r).scaledBy3(a.x()/a.min1(),a.y()/a.min1()).translatedBy2(-.5,-.5);break}case"STRETCH":{n.copyFrom(this.transform());break}case"TILE":{n=n.translatedBy2(.5,.5).rotatedBy(-r).translatedBy2(-.5,-.5).scaledBy2(1/this.scalingFactor()).scaledBy1(a);break}}return n}decodedImage(){return this.image().isDecoded()?this.image():null}decodedImageThumbnail(){return this.imageThumbnail().isDecoded()?this.imageThumbnail():null}scalingFactorForImage(t){return this.image()==null||t==null||t.width()==0||this.image().width()==0?this.scalingFactor():this.scalingFactor()*(this.image().width()/t.width())}colorAdjustIsActive(){return this._filterColorAdjust!=null&&(this._filterColorAdjust.tint!=0||this._filterColorAdjust.vibrance!=0||this._filterColorAdjust.shadows!=0||this._filterColorAdjust.highlights!=0||this._filterColorAdjust.exposure!=0||this._filterColorAdjust.contrast!=0||this._filterColorAdjust.temperature!=0)}colorAdjustSetData(t){let r=wr.instance();t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_TINT,this._filterColorAdjust.tint),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_COLOR,this._filterColorAdjust.vibrance),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_SHADOWS,this._filterColorAdjust.shadows),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS,this._filterColorAdjust.highlights),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_EXPOSURE,this._filterColorAdjust.exposure),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_CONTRAST,this._filterColorAdjust.contrast),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_TEMPERATURE,this._filterColorAdjust.temperature)}isEnabledAndVisible(){if(!this.isEnabled()||this.opacity()<=0)return!1;switch(this.type()){case"SOLID":return C.alpha(this.color())>0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let t=0,r=this.colorStops().length;t<r;t=t+1)if(C.alpha(this.colorStops()[t].color)>0)return!0;return!1}}return!0}hasAnyFullyTransparentAreas(){if(!this.isEnabled()||this.opacity()<=0)return!0;switch(this.type()){case"SOLID":return C.alpha(this.color())==0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let t=0,r=this.colorStops().length;t<r;t=t+1)if(C.alpha(this.colorStops()[t].color)==0)return!0;return!1}case"EMOJI":case"IMAGE":case"VIDEO":return!0}return!0}hasAnimatingMedia(){return this.image()!=null&&this.image().gif()!=null||this.video()!=null}optimized(){if(this.isGradient()&&this.colorStops().length!=0){let t=this.colorStops()[0].color;for(let r=1,n=this.colorStops().length;r<n;r=r+1)if(t!=this.colorStops()[r].color)return this;return eo.create("SOLID",this.opacity(),this.blendMode(),this.isEnabled(),t)}return this}equals1(t){return t.isVolatile()?!1:this.equals2(t.asSinglePaint())}equals2(t){if(this._colorStops==null||t.colorStops()==null){if(this._colorStops==null!=(t.colorStops()==null))return!1}else if(!jt.FrozenList_equals(this._colorStops,t.colorStops(),ot.EQUALS))return!1;if(this._transform==null||t.transform()==null){if(this._transform==null!=(t.transform()==null))return!1}else if(!this.transform().equals1(t.transform()))return!1;if(this._video==null||t.video()==null){if(this._video==null!=(t.video()==null))return!1}else if(this._video.hash()!=t.video().hash())return!1;if(this._image==null||t.image()==null){if(this._image==null!=(t.image()==null))return!1}else if(this._image.objectHash()!=t.image().objectHash())return!1;if(this._imageThumbnail==null||t.imageThumbnail()==null){if(this._imageThumbnail==null!=(t.imageThumbnail()==null))return!1}else if(this._imageThumbnail.objectHash()!=t.imageThumbnail().objectHash())return!1;return this._type==t.type()&&this._blendMode==t.blendMode()&&this._color==t.color()&&this._isEnabled==t.isEnabled()&&this._opacity==t.opacity()&&this._rotationDeg==t.rotationDeg()&&this._scalingFactor==t.scalingFactor()&&this._imageScaleMode==t.imageScaleMode()&&this._filterColorAdjust==t.filterColorAdjust()&&this._decodedImageIsReady==t.decodedImageIsReady()&&this._decodedImageThumbnailIsReady==t.decodedImageThumbnailIsReady()}clone(){return this.cloneAsSinglePaint()}cloneAsSinglePaint(){let t=new eo(this._type);return t._blendMode=this._blendMode,t._color=this.color(),t._colorStops=this._colorStops,t._image=this._image,t._imageThumbnail=this._imageThumbnail,t._video=this._video,t._isEnabled=this._isEnabled,t._opacity=this._opacity,t._transform=this._transform,t._rotationDeg=this._rotationDeg,t._scalingFactor=this._scalingFactor,t._imageScaleMode=this._imageScaleMode,t._filterColorAdjust=this._filterColorAdjust,t._decodedImageIsReady=this._decodedImageIsReady,t._decodedImageThumbnailIsReady=this._decodedImageThumbnailIsReady,t._originalImageWidth=this._originalImageWidth,t._originalImageHeight=this._originalImageHeight,t}isOpaque(){if(this.opacity()<1||this.blendMode()!="NORMAL")return!1;switch(this.type()){case"SOLID":return C.isOpaque(this._color);case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{for(let t=0,r=this._colorStops.length;t<r;t=t+1){let n=this._colorStops[t];if(!C.isOpaque(n.color))return!1}return!0}case"EMOJI":case"IMAGE":case"VIDEO":return!1}return!1}flattenedStops(){let t=this._colorStops.slice();if(t.sort((r,n)=>Xt.double_compare(r.position,n.position)),Ya.shouldWrap(this.type())&&t.length>=2){let r=t[0],n=ce.List_last(t);if(r.position>0)if(n.position<1){let o=C.mix(r.color,n.color,r.position/(1-n.position+r.position));t.unshift(new ot(o,0)),t.push(new ot(o,1))}else t.unshift(new ot(n.color,0));else n.position<1&&t.push(new ot(r.color,1))}return t}asSinglePaint(){return this}getCanvasSpaceUnclippedImageSize(t){if(!this.isImageAvailable()&&!this.isImageThumbnailAvailable())return ye.FrozenVector_ZERO;let r=this.allocateImageSize(),n=null;switch(this.imageScaleMode()){case"STRETCH":{n=t.divide1(this._transform.scale1());break}case"FILL":{let o=this.allocateBoundsToImageRatio(t,r);o.x()>o.y()?n=new R(t.x(),o.x()*this._image.height()):n=new R(o.y()*this._image.width(),t.y());break}case"FIT":{let o=this.allocateBoundsToImageRatio(t,r);o.x()>o.y()?n=new R(o.y()*this._image.width(),t.y()):n=new R(t.x(),o.x()*this._image.height());break}case"TILE":return ye.FrozenVector_ZERO;default:return console.warn(`Unimplemented imageScaleMode ${this.imageScaleMode()} in getCanvasSpaceUnclippedImageSize`),ye.FrozenVector_ZERO}return n}static create(t,r,n,o,a){let s=new eo(t);return s.setOpacity(r),s.setBlendMode(n),s.setIsEnabled(o),s.setColor(a),s}static createSolid(t,r){return eo.create("SOLID",r*C.alphaF(t),"NORMAL",!0,C.withAlpha(t,255))}static createLinearGradient(t){let r=eo.create("GRADIENT_LINEAR",1,"NORMAL",!0,C.BLACK);return r.setColorStops1(t),r}static createRadialGradient(t){let r=eo.create("GRADIENT_RADIAL",1,"NORMAL",!0,C.BLACK);return r.setColorStops1(t),r}static createAngularGradient(t){let r=eo.create("GRADIENT_ANGULAR",1,"NORMAL",!0,C.BLACK);return r.setColorStops1(t),r}static createDiamondGradient(t){let r=eo.create("GRADIENT_DIAMOND",1,"NORMAL",!0,C.BLACK);return r.setColorStops1(t),r}};eo.TRANSPARENT=eo.create("SOLID",0,"NORMAL",!0,C.BLACK),eo.SOLID_BLACK=eo.create("SOLID",1,"NORMAL",!0,C.BLACK);var te=eo,rc=class i extends Jd{constructor(t,r,n,o,a){super();this._from=null,this._to=null,this._getEasedT=null,this._fromCanvasSpaceNodeSize=null,this._toCanvasSpaceNodeSize=null,this._cachedFromTransform=null,this._cachedToTransform=null,this._cachedFromOffsetFromCenter=null,this._cachedToOffsetFromCenter=null,this._cachedFromImageOnCanvasSize=null,this._cachedToImageOnCanvasSize=null,this._from=t,this._to=r,this._getEasedT=n,this._fromCanvasSpaceNodeSize=o,this._toCanvasSpaceNodeSize=a,this._needsImageDimensionsForInterpolation()&&this._computeCachedImageDimensions()}_needsImageDimensionsForInterpolation(){return this.type()!="IMAGE"&&this.type()!="VIDEO"||!this._from.isImageAvailable()&&!this._from.isImageThumbnailAvailable()||!this._to.isImageAvailable()&&!this._to.isImageThumbnailAvailable()?!1:this._from.imageScaleMode()!="TILE"&&this._to.imageScaleMode()!="TILE"&&(this._from.imageScaleMode()=="STRETCH"||this._to.imageScaleMode()=="STRETCH"||this._from.imageScaleMode()!=this._to.imageScaleMode())}_computeCachedImageDimensions(){this.from().imageScaleMode()!="STRETCH"?(this._cachedFromTransform=this._from.allocateImageTransformForGeometrySize(this._fromCanvasSpaceNodeSize),this._cachedFromOffsetFromCenter=new R(0,0)):(this._cachedFromTransform=this.from().transform(),this._cachedFromOffsetFromCenter=new R(.5,.5).subtract1(this._cachedFromTransform.scale1().divide(2).add1(this._cachedFromTransform.translation()))),this.to().imageScaleMode()!="STRETCH"?(this._cachedToTransform=this._to.allocateImageTransformForGeometrySize(this._toCanvasSpaceNodeSize),this._cachedToOffsetFromCenter=new R(0,0)):(this._cachedToTransform=this.to().transform(),this._cachedToOffsetFromCenter=new R(.5,.5).subtract1(this._cachedToTransform.scale1().divide(2).add1(this._cachedToTransform.translation()))),this._cachedFromImageOnCanvasSize=this.from().getCanvasSpaceUnclippedImageSize(this._fromCanvasSpaceNodeSize),this._cachedToImageOnCanvasSize=this.to().getCanvasSpaceUnclippedImageSize(this._toCanvasSpaceNodeSize)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(this._from.opacity()>0||this._to.opacity()>0)}isVolatile(){return!0}type(){return this._from.type()}blendMode(){return this._from.blendMode()}setIsEnabled(t){this._from.setIsEnabled(t),this._to.setIsEnabled(t)}isEnabledAndVisible(){return this._from.isEnabledAndVisible()||this._to.isEnabledAndVisible()}debugString(){return`VolatilePaint from=[${this._from.debugString()}] to=[${this._to.debugString()}]`}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}color(){return C.mix(this._from.color(),this._to.color(),this._getEasedT())}isOpaque(){return this._from.isOpaque()&&this._to.isOpaque()}transform(){let t=new R(.5,.5),r=this._from.transform().clone().translatedBy1(t),n=this._to.transform().clone().translatedBy1(t);return Hn.lerp1(r,n,this.t()).translatedBy1(t.negative())}allocateImageTransformForGeometrySize(t){let r=ee.new2(),n=R.lerp(this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize,this.t());if(this.from().imageScaleMode()=="STRETCH"||this.to().imageScaleMode()=="STRETCH"||this.from().imageScaleMode()!=this.to().imageScaleMode()){(this._cachedFromTransform==null||this._cachedToTransform==null||this._cachedFromOffsetFromCenter==null||this._cachedToOffsetFromCenter==null||this._cachedFromImageOnCanvasSize==null||this._cachedToImageOnCanvasSize==null)&&this._computeCachedImageDimensions();let o=R.lerp(this._cachedFromImageOnCanvasSize,this._cachedToImageOnCanvasSize,this.t()),a=n.divide1(o),s=R.lerp(this._cachedFromOffsetFromCenter,this._cachedToOffsetFromCenter,this.t()),l=new R(.5,.5).subtract1(s).subtract1(a.divide(2)),c=Xt.double_lerp(this._cachedFromTransform.toAngle(),this._cachedToTransform.toAngle(),this.t());return r.translatedBy1(l).rotatedBy(c).scaledBy1(a)}else{let o=this._from.allocateImageTransformForGeometrySize(n),a=this._to.allocateImageTransformForGeometrySize(n);return r.copyFrom(Hn.lerp1(o,a,this.t())),r}}opacity(){return Xt.double_clamp(Xt.double_lerp(this.from().opacity(),this.to().opacity(),this.t()),0,1)}colorAdjustIsActive(){return this._from.colorAdjustIsActive()||this._to.colorAdjustIsActive()}colorAdjustSetData(t){let r=wr.instance();t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_TINT,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().tint:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().tint:0,this.t()),-1,1)),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_COLOR,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().vibrance:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().vibrance:0,this.t()),-1,1)),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_SHADOWS,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().shadows:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().shadows:0,this.t()),-1,1)),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_HIGHLIGHTS,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().highlights:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().highlights:0,this.t()),-1,1)),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_EXPOSURE,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().exposure:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().exposure:0,this.t()),-1,1)),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_CONTRAST,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().contrast:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().contrast:0,this.t()),-.3,.3)),t.setUniformFloat(r.GLSLX_NAME_U_GLOBAL_TEMPERATURE,Xt.double_clamp(Xt.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().temperature:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().temperature:0,this.t()),-1,1))}equals1(t){return t.isVolatile()?this.equals2(t.asVolatilePaint()):!1}equals2(t){if(!t.isVolatile())return!1;let r=t;return this._from.equals2(r._from.asSinglePaint())&&this._to.equals2(r._to.asSinglePaint())&&this._getEasedT==r._getEasedT&&this._fromCanvasSpaceNodeSize.equals(r._fromCanvasSpaceNodeSize)&&this._toCanvasSpaceNodeSize.equals(r._toCanvasSpaceNodeSize)}clone(){return this.cloneAsVolatilePaint()}cloneAsVolatilePaint(){return new i(this._from.cloneAsSinglePaint(),this._to.cloneAsSinglePaint(),this._getEasedT,this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize)}hasAnyFullyTransparentAreas(){return this._from.hasAnyFullyTransparentAreas()&&this._to.hasAnyFullyTransparentAreas()}asVolatilePaint(){return this}eitherPaint(t){return t(this._from)||t(this._to)}static create(t,r,n,o,a){return new i(t,r,a,n,o)}},yA;(e=>e.FrozenPaint_EMPTY_LIST=[])(yA||(yA={}));var Ce;(z=>{function i(B,w){return[te.createSolid(B,w)]}z.createFromSolidColor=i;function e(B){return B}z.create1=e;function t(B){return B}z.create2=t;function r(B){return[B]}z.fromPaint=r;function n(B){return B}z.asPaintList=n;function o(B){return B.length==0}z.isEmpty=o;function a(B){return B.length}z.count=a;function s(B,w){return B[w]}z.get=s;function l(B){return B[0]}z.first=l;function c(B){return ce.List_last(B)}z.last=c;function d(B){return B.slice()}z.clone=d;function h(B){let w=!1;for(let P=0,H=B.length;P<H;P=P+1)B[P].type()=="EMOJI"&&(w=!0);return w}z.hasEmoji=h;function u(B,w){return jt.FrozenList_equals(B,w,(P,H)=>P==null||H==null?P==null==(H==null):P.equals1(H))}z.equals=u;function m(B){return B.length==1?B[0]:null}z.onlyPaintOrNull=m;function g(B){let w=m(B);return w!=null&&w.type()=="SOLID"&&!w.isVolatile()?w:null}z.onlySolidPaintOrNull=g;function _(B){for(let w=0,P=B.length;w<P;w=w+1){let H=B.length-1-w;if(!B[H].isEnabledAndVisible())continue;let Q=B[H];return Q!=null&&Q.type()=="SOLID"&&!Q.isVolatile()&&Q.asSinglePaint().isOpaque()?Q:null}return null}z.firstPaintIfSolidAndOpaqueOrNull=_;function f(B){return B.length==1&&B[0].type()=="EMOJI"}z.isEmojiPaint=f;function S(B){for(let w=0,P=B.length;w<P;w=w+1){let H=B[w].asSinglePaint();if(H!=null){if(H.blendMode()!="NORMAL"&&H.blendMode()!="PASS_THROUGH")return!1}else{let Q=B[w].asVolatilePaint();if(Q!=null&&Q.eitherPaint(Y=>Y.blendMode()!="NORMAL"&&Y.blendMode()!="PASS_THROUGH"))return!1}}return!0}z.isIsolated=S;function b(B){for(let w=0,P=B.length;w<P;w=w+1)if(B[w].isEnabledAndVisible())return!0;return!1}z.containsAtLeastOneVisiblePaint=b;function T(B){for(let w=0,P=B.length;w<P;w=w+1){let H=B[w].asSinglePaint(),Q=B[w].asVolatilePaint();if(H==null&&Q!=null&&Q.isVisible()||H!=null&&H.isVisible()&&!H.hasAnyFullyTransparentAreas())return!0}return!1}z.containsAtLeastOneVisibleNotFullyTransparentPaint=T;function y(B){for(let w=0,P=B.length;w<P;w=w+1){if(!B[w].isEnabledAndVisible())continue;let H=B[w].asSinglePaint();if(H!=null){if(H.isOpaque())return!0}else{let Q=B[w].asVolatilePaint();if(Q!=null&&Q.isOpaque())return!0}}return!1}z.containsAtLeastOneVisibleOpaquePaint=y;function I(B){for(let w=0,P=B.length;w<P;w=w+1){let H=B[w].asSinglePaint();if(H!=null){if(!H.isOpaque())return!0}else{let Q=B[w].asVolatilePaint();if(Q!=null&&!Q.isOpaque())return!0}}return!1}z.containsAtLeastOneNonOpaquePaint=I;function p(B){for(let w=0,P=B.length;w<P;w=w+1){let H=B[w].asSinglePaint();if(H==null&&B[w].asVolatilePaint()!=null||!H.hasAnyFullyTransparentAreas())return!1}return!0}z.hasAnyFullyTransparentAreas=p;function A(B){for(let w=0,P=B.length;w<P;w=w+1){let H=B[w].asSinglePaint();if(H!=null){if(H.hasAnimatingMedia())return!0}else{let Q=B[w].asVolatilePaint();if(Q!=null&&Q.eitherPaint(Y=>Y.hasAnimatingMedia()))return!0}}return!1}z.hasAnimatingMediaPaints=A;function v(B){for(let w=0,P=B.length;w<P;w=w+1)if(B[w].isVolatile())return!0;return!1}z.hasVolatilePaints=v;function E(B,w){var P,H;for(let Q=0,Y=B.length;Q<Y;Q=Q+1){let ne=B[Q].asSinglePaint();(ne==null?void 0:ne.video())!=null&&w(ne);let W=B[Q].asVolatilePaint();((P=W==null?void 0:W.to())==null?void 0:P.video())!=null&&w(W.to()),((H=W==null?void 0:W.from())==null?void 0:H.video())!=null&&w(W.from())}}z.forEachPaintWithVideo=E;function D(B){if(S(B))return[B];let w=[],P="NORMAL",H=[];for(let Q=0,Y=B.length;Q<Y;Q=Q+1){let ne=B[Q];(ne.blendMode()!=P||ne.blendMode()!="NORMAL")&&H.length!=0&&(w.push(H.slice()),H.length=0),P=ne.blendMode(),H.push(ne)}return H.length!=0&&w.push(H.slice()),w}z.isolatedPaints=D;function G(B){if(v(B))return B;if(B.length==2&&B[0].type()=="SOLID"&&ce.List_last(B).asSinglePaint().isGradient()){let P=B[0].asSinglePaint(),H=C.multiplyOpacity(P.color(),P.opacity()),Q=ce.List_last(B).clone(),Y=[],ne=-1,W=!0,K=Q.colorStops();for(let j=0,ge=K.length;j<ge;j=j+1){let Ue=K[j];if(ne>=0&&ne!=C.alpha(Ue.color)){W=!1;break}ne=C.alpha(Ue.color);let Tt=C.multiplyOpacity(Ue.color,Q.opacity());Y.push(new ot(C.blend(H,Tt),Ue.position))}if(W)return Q.setOpacity(1),Q.setColorStops1(Y),G([Q])}let w=B.length;for(let P=0;P<w;P=P+1){let H=B[P].asSinglePaint().optimized();if(H==B[P])continue;let Q=B.slice(0,P);for(Q.push(H);(P=P+1)<w;)Q.push(B[P].asSinglePaint().optimized());return Q}return B}z.optimize=G,z.SOLID_BLACK=[te.createSolid(C.BLACK,1)],z.EMPTY=[]})(Ce||(Ce={}));var to=(s=>(s[s.NONE=0]="NONE",s[s.CONTAIN=1]="CONTAIN",s[s.SCALE_DOWN=2]="SCALE_DOWN",s[s.MIN_ZOOM=3]="MIN_ZOOM",s[s.FREE=4]="FREE",s[s.SCALE_DOWN_TO_FIT_WIDTH=5]="SCALE_DOWN_TO_FIT_WIDTH",s[s.FIT_WIDTH=6]="FIT_WIDTH",s))(to||{});(t=>{function i(r,n){return r!=1&&r!=2&&r!=5&&r!=6&&!(r==3&&n)}t.userCanManuallyZoom=i;function e(r){return r!=1&&r!=2&&r!=0&&r!=4}t.topLevelFramesCanScroll=e})(to||(to={}));var ut=(p=>(p[p.UNKNOWN=0]="UNKNOWN",p[p.TIMER=1]="TIMER",p[p.ON_HOVER=2]="ON_HOVER",p[p.ON_PRESS=3]="ON_PRESS",p[p.ON_CLICK=4]="ON_CLICK",p[p.DRAG=5]="DRAG",p[p.REVERSE_HOVER=6]="REVERSE_HOVER",p[p.REVERSE_PRESS=7]="REVERSE_PRESS",p[p.MOUSE_DOWN=8]="MOUSE_DOWN",p[p.MOUSE_UP=9]="MOUSE_UP",p[p.MOUSE_IN=10]="MOUSE_IN",p[p.MOUSE_OUT=11]="MOUSE_OUT",p[p.MOUSE_ENTER=12]="MOUSE_ENTER",p[p.MOUSE_LEAVE=13]="MOUSE_LEAVE",p[p.ON_KEY_DOWN=14]="ON_KEY_DOWN",p[p.ON_GAMEPAD_DOWN=15]="ON_GAMEPAD_DOWN",p[p.ON_VOICE=16]="ON_VOICE",p[p.MOBILE_NAV=17]="MOBILE_NAV",p[p.LEFT_ARROW=18]="LEFT_ARROW",p[p.RIGHT_ARROW=19]="RIGHT_ARROW",p[p.ON_MEDIA_HIT=20]="ON_MEDIA_HIT",p[p.ON_MEDIA_END=21]="ON_MEDIA_END",p))(ut||{});(a=>{function i(s){switch(s){case 1:case 20:case 21:case 4:case 5:case 9:case 17:case 18:case 19:return!1;case 2:case 3:case 6:case 7:case 8:case 10:case 11:case 12:case 13:return!0;default:return!1}}a.isTransientAction=i;function e(s){switch(s){case 2:return 6;case 3:return 7;case 6:return 2;case 7:return 3;case 10:return 11;case 11:return 10;case 12:return 13;case 13:return 12;case 8:return 9;default:return 0}}a.getOppositeTransientAction=e;function t(s){switch(s){case"TIMER":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"REVERSE_HOVER":return 6;case"REVERSE_PRESS":return 7;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_GAMEPAD_DOWN":return 15;case"ON_VOICE":return 16;case"MOBILE_NAV":return 17;case"LEFT_ARROW":return 18;case"RIGHT_ARROW":return 19;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return 0}a.fromString=t;function r(s){return[1,18,19,20,21].indexOf(s)!=-1?0:1}a.getControlSource=r;function n(s){switch(s){case"AFTER_TIMEOUT":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"DRAG":return 5;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_VOICE":return 16;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return Le("fromInteractionType InteractionType not handled"),0}a.fromInteractionType=n;function o(s){switch(s){case 1:return"AFTER_TIMEOUT";case 2:return"ON_HOVER";case 3:return"ON_PRESS";case 4:return"ON_CLICK";case 5:return"DRAG";case 8:return"MOUSE_DOWN";case 9:return"MOUSE_UP";case 10:return"MOUSE_IN";case 11:return"MOUSE_OUT";case 12:return"MOUSE_ENTER";case 13:return"MOUSE_LEAVE";case 14:return"ON_KEY_DOWN";case 15:return"ON_KEY_DOWN";case 16:return"ON_VOICE";case 20:return"ON_MEDIA_HIT";case 21:return"ON_MEDIA_END"}return Le("mapToInteractionType TransitionAction not handled"),null}a.mapToInteractionType=o})(ut||(ut={}));var bn=(t=>(t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE",t))(bn||{});var sm=class{constructor(e,t,r,n){this.key=e,this.value=t,this.prev=r,this.next=n,this.lastUsedGeneration=0}},Ds=class{constructor(e,t=null){this._nodeByKey=new Map;this._size=0;this._head=null;this._tail=null;this._generation=1;this._maxElements=e,this._afterEvict=t}maximumCapacity(){return this._maxElements}atMaximumCapacity(){return this._size==this._maxElements}increaseCapacity(e){this._maxElements=this._maxElements+e}capacityUsedForGeneration(){return this.atMaximumCapacity()?this._tail.lastUsedGeneration==this._generation:!1}incrementGeneration(){if(this._generation===Number.MAX_SAFE_INTEGER-1){this._generation=1;for(let e of Array.from(this._nodeByKey.keys()))this._nodeByKey.get(e).lastUsedGeneration=0}else this._generation=this._generation+1}keys(){return Array.from(this._nodeByKey.keys())}_in(e){return this._nodeByKey.has(e)?(this._moveElemToHead(this._nodeByKey.get(e)),!0):!1}count(){return this._size}get1(e){return this._moveElemToHead(this._nodeByKey.get(e)),this._nodeByKey.get(e).value}get(e,t){let r=He.StringMap_get(this._nodeByKey,e,null);return r==null?t:(this._moveElemToHead(r),r.value)}tailElement(){return this._tail.value}set(e,t){let r=He.StringMap_get(this._nodeByKey,e,null);if(r!=null)this._moveElemToHead(r),r.value=t;else if(r=new sm(e,t,null,null),this._addElemAsHead(r),this._nodeByKey.set(e,r),this._size=this._size+1,this._size>this._maxElements){let n=this._tail.value,o=this._tail.key;this.remove(this._tail.key)}}remove(e){let t=He.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._nodeByKey.delete(t.key),this._removeFromList(t),this._size=this._size-1,this._afterEvict!=null&&this._afterEvict(t.key,t.value))}removeValue(e){let t=[];He.StringMap_each(this._nodeByKey,(r,n)=>{n.value==e&&t.push(r)}),t.forEach(r=>{this.remove(r)})}makeLeastRecent(e){let t=He.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._removeFromList(t),this._addElemAsTail(t))}_moveElemToHead(e){this._removeFromList(e),this._addElemAsHead(e)}_removeFromList(e){let t=e.prev,r=e.next;t!=null&&(t.next=r),r!=null&&(r.prev=t),e==this._tail&&(this._tail=t),e==this._head&&(this._head=r),e.next=e.prev=null}_addElemAsHead(e){this._head==null?this._head=this._tail=e:(e.prev=null,e.next=this._head,e.next.prev=e,this._head=e),this._head.lastUsedGeneration=this._generation}_addElemAsTail(e){this._tail==null?this._tail=this._head=e:(e.next=null,e.prev=this._tail,e.prev.next=e,this._tail=e),this._tail.lastUsedGeneration=0}};var ro=class ro{static numInitialTextures(){return X.shouldApplyMobileOptimizations()?3:6}static numInitialTiles(e){return ro.numInitialTextures()*e*e}_createNewTexture(){let e=this._context.createTexture(O.TextureFormat.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP,this._tilesPerSide*ro.TILE_SIZE,this._tilesPerSide*ro.TILE_SIZE,"TileAtlas"),t=this._context.createFramebuffer(e,null,"Tile Atlas");this._tileCacheFramebuffers.push(t)}allocateTile(){let e=`tile${this._tileIdCounter}`;this._tileIdCounter=this._tileIdCounter+1,this._tilesLRU.capacityUsedForGeneration()&&(this._createNewTexture(),this._tilesLRU.increaseCapacity(this._tilesPerSide*this._tilesPerSide),console.warn("allocated new texture in the atlas to handle demand for current frame"));let t=this._tilesLRU.atMaximumCapacity()?this._tilesLRU.tailElement().tileIndex:this._tilesLRU.count();return this._tilesLRU.set(e,new ro.CachedTileMetadata(t,!1,this._context.maxTextureSize())),e}maximumCapacity(){return this._tilesLRU.maximumCapacity()}prepareForNewFrame(){this._tilesLRU.incrementGeneration()}totalVRAM(){let e=0;for(let t of this._tileCacheFramebuffers)e=e+O.in_Texture.Texture_totalVRAM(t.colorTexture());return e}tilesPerTexture(){return this._tilesPerSide*this._tilesPerSide}tileIsStillValid(e){return this._tilesLRU._in(e)}framebufferForTile(e){let t=this._tilesLRU.get1(e).tileIndex;return this._tileCacheFramebuffers[t/(this._tilesPerSide*this._tilesPerSide)|0]}devalueTile(e){this._tilesLRU.makeLeastRecent(e)}viewportForTile(e,t){let r=this._tilesLRU.get1(e).tileIndex,n=St.int_remainder(r,this._tilesPerSide),o=St.int_remainder(r/this._tilesPerSide|0,this._tilesPerSide);t.setTo1(n*ro.TILE_SIZE,o*ro.TILE_SIZE,ro.TILE_SIZE,ro.TILE_SIZE)}clearCache(){let t=this._tileCacheFramebuffers.length*this._tilesPerSide*this._tilesPerSide;this._tilesLRU=new Ds(t,this._afterEvictOrNull)}constructor(e,t){this._afterEvictOrNull=null,this._tileIdCounter=0,this._tilesLRU=null,this._tilesPerSide=0,this._tileCacheFramebuffers=[],this._context=null,this._afterEvictOrNull=t,this._tilesPerSide=e.maxTextureSize()/ro.TILE_SIZE|0,this._tilesLRU=new Ds(ro.numInitialTiles(this._tilesPerSide),this._afterEvictOrNull),e.addContextResetHandler(()=>{this.clearCache()}),this._context=e;for(let r=0,n=ro.numInitialTextures();r<n;r=r+1)this._createNewTexture()}};ro.TILE_SIZE=512;var or=ro;(e=>{class i{cacheViewport(){let r=this.maxTextureSize/e.TILE_SIZE|0,n=St.int_remainder(this.tileIndex,r),o=St.int_remainder(this.tileIndex/r|0,r);return new V(n*e.TILE_SIZE,o*e.TILE_SIZE,e.TILE_SIZE,e.TILE_SIZE)}constructor(r,n,o){this.tileIndex=0,this.isValid=!1,this.includesBackgroundColor=!1,this.maxTextureSize=0,this.tileIndex=r,this.includesBackgroundColor=n,this.isValid=!0,this.maxTextureSize=o}}e.CachedTileMetadata=i})(or||(or={}));var LA=fs(TA());var cn=class{constructor(e,t){this.a=e,this.b=t}};var no=class i{constructor(){this._float=null,this._int=null,this._value=0,this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer)}reset(){this._value=0}value(){return this._value}hash1(e){this._float[0]=e,this._value=i.combine(this._value,this._int[0])}hash2(e){this._value=i.combine(this._value,e)}static combine(e,t){return t+-1640531527+(e<<6)+(e>>2)}};function vA(i,e,t){if(e==5&&i[4].equals(i[0])&&(e=e-1),e!=4)return!1;let s=.001,l=0,c=0;for(let d=0;d<e;d=d+1){let h=i[d],u=0;if(h.x()<t.left()+s)if(h.y()<t.top()+s)u=0;else if(h.y()>t.bottom()-s)u=2;else return!1;else if(h.x()>t.right()-s)if(h.y()<t.top()+s)u=1;else if(h.y()>t.bottom()-s)u=3;else return!1;else return!1;if(d>0){let m=l^u;if(m!=1&&m!=2)return!1}c|=1<<u,l=u}return c==15}var nc=class{constructor(e,t){this.bounds=e,this.isRect=t}},Ze=class i{constructor(){this.VERTEX_PATTERN_COUNT=5;this.VERTEX_PATTERN=[null,null,null,null,null];this._data=arguments[0],arguments.length==1?(this._cachedInfo=null,this._hash=null):arguments.length==3&&(this._cachedInfo=arguments[1],this._hash=new fe(arguments[2]))}_invalidateCachedData(){this._cachedInfo=null,this._hash=null}equals2(e){return e instanceof i?this.equals1(e):!1}equals1(e){return this._data.byteCount()!=e._data.byteCount()||this.hash()!=e.hash()?!1:yd.FrozenDataArray_equals(this._data,e._data)}clone(){return this.getMutableClone()}getMutableClone(){return new Pt(this._data.clone())}isEmpty(){return this._data.isEmpty()}start(){return 0}bounds(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.bounds}isRect(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.isRect}asRoundedRectPath(){return null}canBeAnalyticallyAntialiased(){return!1}hash(){if(this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._hash==null){let e=new no;for(let t=0,r=this._data.byteCount();t<r;t=t+1)e.hash2(this._data.byteAt(t));this._hash=new fe(e.value())}return this._hash.value}countCommands(){let e=0;for(let t=this.start();i.Command.isValid(t,this);t=i.Command.next(t,this))e=e+1;return e}_computeBoundsAndRectInfo(){let e=bt.INSTANCE;e.reset();for(let c=0,d=this.VERTEX_PATTERN_COUNT;c<d;c=c+1)this.VERTEX_PATTERN[c]=null;let t=!1,r=!1,n=0,o=R.new2(),a=c=>{n<this.VERTEX_PATTERN_COUNT&&(this.VERTEX_PATTERN[n]=c),e.include2(c),n=n+1};for(let c=this.start();i.Command.isValid(c,this);c=i.Command.next(c,this))switch(i.Command.kind(c,this)){case i.Command.Kind.CLOSE:{r=!1;break}case i.Command.Kind.MOVE_TO:{o=i.Command.point(c,this),r=!1;break}case i.Command.Kind.LINE_TO:case i.Command.Kind.QUADRATIC_TO:case i.Command.Kind.CUBIC_TO:{r||(a(o),r=!0),i.Command.kind(c,this)==i.Command.Kind.QUADRATIC_TO?(e.include2(i.Command.control1(c,this)),t=!0):i.Command.kind(c,this)==i.Command.Kind.CUBIC_TO&&(e.include2(i.Command.control1(c,this)),e.include2(i.Command.control2(c,this)),t=!0),o=i.Command.point(c,this),a(o);break}default:break}let s=e.isValid()?e.build():V.INVALID,l=!t&&n<=this.VERTEX_PATTERN_COUNT&&vA(this.VERTEX_PATTERN,n,s);return new nc(s,l)}toBezierPath(){return this}toString(){let e="";for(let t=this.start();i.Command.isValid(t,this);t=i.Command.next(t,this))switch(t!=this.start()&&(e+=" "),i.Command.kind(t,this)){case i.Command.Kind.CLOSE:{e+="Z";break}case i.Command.Kind.MOVE_TO:{e+=`M ${i.Command.moveToX(t,this)} ${i.Command.moveToY(t,this)}`;break}case i.Command.Kind.LINE_TO:{e+=`L ${i.Command.lineToX(t,this)} ${i.Command.lineToY(t,this)}`;break}case i.Command.Kind.QUADRATIC_TO:{e+=`Q ${i.Command.quadraticToFirstX(t,this)} ${i.Command.quadraticToFirstY(t,this)} ${i.Command.quadraticToX(t,this)} ${i.Command.quadraticToY(t,this)}`;break}case i.Command.Kind.CUBIC_TO:{e+=`C ${i.Command.cubicToFirstX(t,this)} ${i.Command.cubicToFirstY(t,this)} ${i.Command.cubicToSecondX(t,this)} ${i.Command.cubicToSecondY(t,this)} ${i.Command.cubicToX(t,this)} ${i.Command.cubicToY(t,this)}`;break}default:{break}}return e}data(){return this._data}};(e=>{let i;(W=>{function t(K,j){return j.data().byteAt(K)}W.kind=t;function r(K,j){let ge=t(K,j);return K+(ge==4?1+4*6:ge==3?1+4*4:ge==0?1:1+4*2)}W.next=r;function n(K,j){if(K>=j.data().byteCount())return!1;let ge=0;switch(t(K,j)){case 0:{ge=1;break}case 1:case 2:{ge=1+1*8;break}case 3:{ge=1+2*8;break}case 4:{ge=1+3*8;break}default:return!1}return K+ge<=j.data().byteCount()}W.isValid=n;function o(K,j){return l(K,j,t(K,j)==3?1:t(K,j)==4?2:0)}W.point=o;function a(K,j){return l(K,j,0)}W.control1=a;function s(K,j){return l(K,j,1)}W.control2=s;function l(K,j,ge){return new R(j.data().floatAt(K+1+8*ge),j.data().floatAt(K+1+8*ge+4))}W.pointAtIndex=l;function c(K,j){return j.data().floatAt(K+1)}W.moveToX=c;function d(K,j){return j.data().floatAt(K+(1+4))}W.moveToY=d;function h(K,j,ge){j.setFloatAt(K+1,ge)}W.setMoveToX=h;function u(K,j,ge){j.setFloatAt(K+(1+4),ge)}W.setMoveToY=u;function m(K,j){return j.data().floatAt(K+1)}W.lineToX=m;function g(K,j){return j.data().floatAt(K+(1+4))}W.lineToY=g;function _(K,j,ge){j.setFloatAt(K+1,ge)}W.setLineToX=_;function f(K,j,ge){j.setFloatAt(K+(1+4),ge)}W.setLineToY=f;function S(K,j){return j.data().floatAt(K+1)}W.quadraticToFirstX=S;function b(K,j){return j.data().floatAt(K+(1+4))}W.quadraticToFirstY=b;function T(K,j){return j.data().floatAt(K+(1+4*2))}W.quadraticToX=T;function y(K,j){return j.data().floatAt(K+(1+4*3))}W.quadraticToY=y;function I(K,j,ge){j.setFloatAt(K+1,ge)}W.setQuadraticToFirstX=I;function p(K,j,ge){j.setFloatAt(K+(1+4),ge)}W.setQuadraticToFirstY=p;function A(K,j,ge){j.setFloatAt(K+(1+4*2),ge)}W.setQuadraticToX=A;function v(K,j,ge){j.setFloatAt(K+(1+4*3),ge)}W.setQuadraticToY=v;function E(K,j){return j.data().floatAt(K+1)}W.cubicToFirstX=E;function D(K,j){return j.data().floatAt(K+(1+4))}W.cubicToFirstY=D;function G(K,j){return j.data().floatAt(K+(1+4*2))}W.cubicToSecondX=G;function U(K,j){return j.data().floatAt(K+(1+4*3))}W.cubicToSecondY=U;function M(K,j){return j.data().floatAt(K+(1+4*4))}W.cubicToX=M;function z(K,j){return j.data().floatAt(K+(1+4*5))}W.cubicToY=z;function B(K,j,ge){j.setFloatAt(K+1,ge)}W.setCubicToFirstX=B;function w(K,j,ge){j.setFloatAt(K+(1+4),ge)}W.setCubicToFirstY=w;function P(K,j,ge){j.setFloatAt(K+(1+4*2),ge)}W.setCubicToSecondX=P;function H(K,j,ge){j.setFloatAt(K+(1+4*3),ge)}W.setCubicToSecondY=H;function Q(K,j,ge){j.setFloatAt(K+(1+4*4),ge)}W.setCubicToX=Q;function Y(K,j,ge){j.setFloatAt(K+(1+4*5),ge)}W.setCubicToY=Y;let ne;($e=>($e[$e.CLOSE=0]="CLOSE",$e[$e.MOVE_TO=1]="MOVE_TO",$e[$e.LINE_TO=2]="LINE_TO",$e[$e.QUADRATIC_TO=3]="QUADRATIC_TO",$e[$e.CUBIC_TO=4]="CUBIC_TO"))(ne=W.Kind||(W.Kind={}))})(i=e.Command||(e.Command={}))})(Ze||(Ze={}));var gt=class gt extends Ze{constructor(e){super(e)}static mutableData(e){return e._data}append(e){this._invalidateCachedData(),!this.isEmpty()&&!e.isEmpty()&&Ze.Command.kind(e.start(),e)!=1&&this.moveTo1(0,0),this._data.appendBytes(e.data())}setFloatAt(e,t){this._invalidateCachedData(),this._data.setFloatAt(e,t)}moveTo1(e,t){return this._invalidateCachedData(),this._data.appendByte(1),this._data.appendFloat(e),this._data.appendFloat(t),this}moveTo2(e){return this.moveTo1(e.x(),e.y())}lineTo(e,t){return this._invalidateCachedData(),this._data.appendByte(2),this._data.appendFloat(e),this._data.appendFloat(t),this}quadraticTo(e,t,r,n){return this._invalidateCachedData(),this._data.appendByte(3),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(r),this._data.appendFloat(n),this}cubicTo1(e,t,r,n,o,a){return this._invalidateCachedData(),this._data.appendByte(4),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(r),this._data.appendFloat(n),this._data.appendFloat(o),this._data.appendFloat(a),this}cubicTo2(e,t,r){return this.cubicTo1(e.x(),e.y(),t.x(),t.y(),r.x(),r.y())}close(){return this._invalidateCachedData(),this._data.appendByte(0),this}transformBy(e){this._invalidateCachedData(),!this.isEmpty()&&Ze.Command.kind(this.start(),this)!=1&&this._data.prependBytes(new gt(new on).moveTo1(0,0)._data);for(let t=this.start();Ze.Command.isValid(t,this);t=Ze.Command.next(t,this))switch(Ze.Command.kind(t,this)){case 0:break;case 1:{gt._p0.setTo(Ze.Command.moveToX(t,this),Ze.Command.moveToY(t,this)),e.transformPoint(gt._p0),Ze.Command.setMoveToX(t,this,gt._p0.x()),Ze.Command.setMoveToY(t,this,gt._p0.y());break}case 2:{gt._p0.setTo(Ze.Command.lineToX(t,this),Ze.Command.lineToY(t,this)),e.transformPoint(gt._p0),Ze.Command.setLineToX(t,this,gt._p0.x()),Ze.Command.setLineToY(t,this,gt._p0.y());break}case 3:{gt._p0.setTo(Ze.Command.quadraticToFirstX(t,this),Ze.Command.quadraticToFirstY(t,this)),e.transformPoint(gt._p0),Ze.Command.setQuadraticToFirstX(t,this,gt._p0.x()),Ze.Command.setQuadraticToFirstY(t,this,gt._p0.y()),gt._p0.setTo(Ze.Command.quadraticToX(t,this),Ze.Command.quadraticToY(t,this)),e.transformPoint(gt._p0),Ze.Command.setQuadraticToX(t,this,gt._p0.x()),Ze.Command.setQuadraticToY(t,this,gt._p0.y());break}case 4:{gt._p0.setTo(Ze.Command.cubicToFirstX(t,this),Ze.Command.cubicToFirstY(t,this)),e.transformPoint(gt._p0),Ze.Command.setCubicToFirstX(t,this,gt._p0.x()),Ze.Command.setCubicToFirstY(t,this,gt._p0.y()),gt._p0.setTo(Ze.Command.cubicToSecondX(t,this),Ze.Command.cubicToSecondY(t,this)),e.transformPoint(gt._p0),Ze.Command.setCubicToSecondX(t,this,gt._p0.x()),Ze.Command.setCubicToSecondY(t,this,gt._p0.y()),gt._p0.setTo(Ze.Command.cubicToX(t,this),Ze.Command.cubicToY(t,this)),e.transformPoint(gt._p0),Ze.Command.setCubicToX(t,this,gt._p0.x()),Ze.Command.setCubicToY(t,this,gt._p0.y());break}default:break}}static new2(){return new gt(new on)}static fromRect(e){return gt._fromRect(e.x(),e.y(),e.width(),e.height())}static _fromRect(e,t,r,n){let o=gt.new2();return o.moveTo1(e,t).lineTo(e+r,t).lineTo(e+r,t+n).lineTo(e,t+n).close(),o}static fromRoundedRectWithSpread(e,t){return e.adjustCornerRadiiForSpread(t),gt.fromRoundedRect1(e)}static fromRoundedRect1(e){return e.vertexRadii()!=null?gt.fromRoundedRect3(e.left(),e.top(),e.width(),e.height(),e.vertexRadii()):gt.fromRoundedRect2(e.left(),e.top(),e.width(),e.height(),e.nodeRadius())}static fromRoundedRect2(e,t,r,n,o){if(o=Math.min(o,Math.min(r/2,n/2)),o==0)return gt._fromRect(e,t,r,n);let a=gt.new2(),s=gt.CIRCLE_APPROXIMATION_CONSTANT*o;return a.moveTo1(e,t+o).cubicTo1(e,t+o-s,e+o-s,t,e+o,t).lineTo(e+r-o,t).cubicTo1(e+r-o+s,t,e+r,t+o-s,e+r,t+o).lineTo(e+r,t+n-o).cubicTo1(e+r,t+n-o+s,e+r-o+s,t+n,e+r-o,t+n).lineTo(e+o,t+n).cubicTo1(e+o-s,t+n,e,t+n-o+s,e,t+n-o).close(),a}static fromRoundedRect3(e,t,r,n,o){let a=!0;for(let c=0,d=o.length;c<d;c=c+1)o[c]!=0&&(a=!1),o[c]=Math.min(o[c],Math.min(r/2,n/2));if(a)return gt._fromRect(e,t,r,n);let s=gt.new2(),l=o.map(c=>gt.CIRCLE_APPROXIMATION_CONSTANT*c);return s.moveTo1(e,t+o[0]).cubicTo1(e,t+o[0]-l[0],e+o[0]-l[0],t,e+o[0],t).lineTo(e+r-o[1],t).cubicTo1(e+r-o[1]+l[1],t,e+r,t+o[1]-l[1],e+r,t+o[1]).lineTo(e+r,t+n-o[2]).cubicTo1(e+r,t+n-o[2]+l[2],e+r-o[2]+l[2],t+n,e+r-o[2],t+n).lineTo(e+o[3],t+n).cubicTo1(e+o[3]-l[3],t+n,e,t+n-o[3]+l[3],e,t+n-o[3]).close(),s}static forEllipse(e){let t=new R(e.left()+e.width()/2,e.top()+e.height()/2),r=new R(e.width()/2,0),n=new R(0,e.height()/2),o=r.multiply(gt.CIRCLE_APPROXIMATION_CONSTANT),a=n.multiply(gt.CIRCLE_APPROXIMATION_CONSTANT),s=gt.new2();return s.moveTo2(t.add1(r)).cubicTo2(t.add1(r).add1(a),t.add1(o).add1(n),t.add1(n)).cubicTo2(t.subtract1(o).add1(n),t.subtract1(r).add1(a),t.subtract1(r)).cubicTo2(t.subtract1(r).subtract1(a),t.subtract1(o).subtract1(n),t.subtract1(n)).cubicTo2(t.add1(o).subtract1(n),t.add1(r).subtract1(a),t.add1(r)).close(),s}static forCenterStrokeAroundRect(e,t){let r=e.x(),n=e.y(),o=e.width(),a=e.height(),s=t/2,l=gt.new2();return l.moveTo1(r-s,n-s).lineTo(r+o+s,n-s).lineTo(r+o+s,n+a+s).lineTo(r-s,n+a+s).lineTo(r-s,n-s).lineTo(r+s,n+s).lineTo(r+s,n+a-s).lineTo(r+o-s,n+a-s).lineTo(r+o-s,n+s).lineTo(r+s,n+s).close(),l}};gt.CIRCLE_APPROXIMATION_CONSTANT=4/3*(Math.sqrt(2)-1),gt._p0=R.new2(),gt._p1=R.new2(),gt._p2=R.new2(),gt._p3=R.new2(),gt._r=V.new2();var Pt=gt;var Uo=class Uo{constructor(e,t,r){this.center=null,this.xRadius=0,this.yRadius=0,this._hash=0,this._cachedBezier=null,this.center=e,this.xRadius=t,this.yRadius=r,Uo.hasher.reset(),Uo.hasher.hash1(this.center.x()),Uo.hasher.hash1(this.center.y()),Uo.hasher.hash1(this.xRadius),Uo.hasher.hash1(this.yRadius),this._hash=Uo.hasher.value()}bounds(){return new V(this.center.x()-this.xRadius,this.center.y()-this.yRadius,this.xRadius*2,this.yRadius*2)}equals2(e){return e instanceof Uo?this.equals1(e):!1}equals1(e){return this.center.equals(e.center)&&this.xRadius==e.xRadius&&this.yRadius==e.yRadius}clone(){return new Uo(this.center.clone(),this.xRadius,this.yRadius)}hash(){return this._hash}isRect(){return!1}canBeAnalyticallyAntialiased(){return O.supportsWebGLExtensionOESStandardDerivatives()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Pt.forEllipse(this.bounds())),this._cachedBezier}asRoundedRectPath(){return null}static fromBounds(e){return new Uo(e.center(),e.width()/2,e.height()/2)}};Uo.hasher=new no;var Bi=Uo;var dn=class dn{constructor(e,t){this._rect=null,this._radii=null,this._hash=0,this._cachedBezier=null,this._rect=e,this._radii=t.clippedForRectOfBounds(e),dn.hasher.reset(),dn.hasher.hash1(this._rect.x()),dn.hasher.hash1(this._rect.y()),dn.hasher.hash1(this._rect.width()),dn.hasher.hash1(this._rect.height()),dn.hasher.hash1(this._radii.topLeft),dn.hasher.hash1(this._radii.topRight),dn.hasher.hash1(this._radii.bottomRight),dn.hasher.hash1(this._radii.bottomLeft),this._hash=dn.hasher.value()}radii(){return this._radii}bounds(){return this._rect}equals2(e){return e instanceof dn?this.equals1(e):!1}equals1(e){return this._rect.equals(e._rect)&&this._radii.equals(e._radii)}clone(){return new dn(this._rect.clone(),this._radii)}hash(){return this._hash}isRect(){return this._radii.isZeros()}canBeAnalyticallyAntialiased(){return O.supportsWebGLExtensionOESStandardDerivatives()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=Pt.fromRoundedRect3(this._rect.x(),this._rect.y(),this._rect.width(),this._rect.height(),this._radii.toList())),this._cachedBezier}asRoundedRectPath(){return this}static fromRect(e){return new dn(e,oo.fromNodeRadius(0))}static fromRoundedRect(e){let t=e.vertexRadii()!=null?oo.fromList(e.vertexRadii()):e.nodeRadius()!=0?oo.fromNodeRadius(e.nodeRadius()):oo.ZEROS;return new dn(e.rect(),t)}static isRoundedRectSupportedIgnoringCornerSmoothing(e){let t=e.vertexRadii();if(t!=null){let r=Math.max(Math.max(t[0],t[1]),Math.max(t[2],t[3])),n=Math.min(e.width()/2,e.height()/2);if(r>n)return!1}return!0}static isRoundedRectSupported(e){return e.cornerSmoothing()!=0?!1:dn.isRoundedRectSupportedIgnoringCornerSmoothing(e)}};dn.hasher=new no;var Ot=dn,Vi=class Vi{constructor(e,t,r,n){this.topLeft=0,this.topRight=0,this.bottomRight=0,this.bottomLeft=0,this.topLeft=Math.max(e,0),this.topRight=Math.max(t,0),this.bottomRight=Math.max(r,0),this.bottomLeft=Math.max(n,0)}isZeros(){return this.topLeft==0&&this.topRight==0&&this.bottomRight==0&&this.bottomLeft==0}isUniform(){return this.topRight==this.topLeft&&this.bottomRight==this.topLeft&&this.bottomLeft==this.topLeft}equals(e){return this.topLeft==e.topLeft&&this.topRight==e.topRight&&this.bottomRight==e.bottomRight&&this.bottomLeft==e.bottomLeft}clippedForRectOfBounds(e){let t=Math.min(e.width()/2,e.height()/2);return new Vi(Math.min(this.topLeft,t),Math.min(this.topRight,t),Math.min(this.bottomRight,t),Math.min(this.bottomLeft,t))}toList(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}static fromList(e){return new Vi(e[0],e[1],e[2],e[3])}static fromNodeRadius(e){return new Vi(e,e,e,e)}static fromRoundedRect(e){return e.vertexRadii()!=null?Vi.fromList(e.vertexRadii()):Vi.fromNodeRadius(e.nodeRadius())}};Vi.ZEROS=new Vi(0,0,0,0);var oo=Vi;var io=class i{constructor(e){this.handle=0,this._cachedInfo=null,this._hash=0,this.handle=e}_updateCachedInfoIfNecessary(){if(this._cachedInfo==null){let e=L().modules().uniquePath_Internal.bounds(this.handle),t=e.max.x-e.min.x,r=e.max.y-e.min.y,n=new V(e.min.x,e.min.y,t,r);this._cachedInfo=new nc(n,L().modules().uniquePath_Internal.isRect(this.handle))}}bounds(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.bounds}equals2(e){return e instanceof i?this.handle==e.handle:!1}clone(){return new i(this.handle)}hash(){return this._hash==null&&(this._hash=L().modules().uniquePath_Internal.getHash(this.handle)),this._hash}isRect(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.isRect}canBeAnalyticallyAntialiased(){return!1}toBezierPath(){throw new Error("We should never need to copy UniquePath data into JS")}asRoundedRectPath(){return null}compileLoopBlinnAndReturnVolatileTriangles(){let e=L().modules().uniquePath_Internal.loopBlinnCompile(this.handle);return e??(Le("Failed to compile UniquePath"),JI)}},JI=new Uint8Array([]);var wt=(re=>(re[re.MISSING__=0]="MISSING__",re[re.TEXT_ALIGN_HORIZONTAL=1]="TEXT_ALIGN_HORIZONTAL",re[re.TEXT_ALIGN_VERTICAL=2]="TEXT_ALIGN_VERTICAL",re[re.FONT_SIZE=3]="FONT_SIZE",re[re.TEXT_DATA=4]="TEXT_DATA",re[re.DERIVED_TEXT_DATA=5]="DERIVED_TEXT_DATA",re[re.HYPERLINK=6]="HYPERLINK",re[re.MENTION=7]="MENTION",re[re.VISIBLE=8]="VISIBLE",re[re.IS_BACKGROUND_ENABLED=9]="IS_BACKGROUND_ENABLED",re[re.IS_MASK=10]="IS_MASK",re[re.IS_MASK_OUTLINE__DEPRECATED=11]="IS_MASK_OUTLINE__DEPRECATED",re[re.IS_INTERNAL_ONLY=12]="IS_INTERNAL_ONLY",re[re.IS_FRAME_MASK_DISABLED=13]="IS_FRAME_MASK_DISABLED",re[re.IS_RESIZE_TO_FIT=14]="IS_RESIZE_TO_FIT",re[re.RECTANGLE_CORNER_RADII_INDEPENDENT=15]="RECTANGLE_CORNER_RADII_INDEPENDENT",re[re.INTERACTION_MAINTAINED__DEPRECATED=16]="INTERACTION_MAINTAINED__DEPRECATED",re[re.TRANSITION_PRESERVE_SCROLL__DEPRECATED=17]="TRANSITION_PRESERVE_SCROLL__DEPRECATED",re[re.TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED=18]="TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED",re[re.TYPE=19]="TYPE",re[re.HORIZONTAL_CONSTRAINT=20]="HORIZONTAL_CONSTRAINT",re[re.VERTICAL_CONSTRAINT=21]="VERTICAL_CONSTRAINT",re[re.BLEND_MODE=22]="BLEND_MODE",re[re.STROKE_ALIGN=23]="STROKE_ALIGN",re[re.RELATIVE_TRANSFORM=24]="RELATIVE_TRANSFORM",re[re.PARENT_INDEX=25]="PARENT_INDEX",re[re.CONNECTION_TYPE__DEPRECATED=26]="CONNECTION_TYPE__DEPRECATED",re[re.TRANSITION_TYPE__DEPRECATED=27]="TRANSITION_TYPE__DEPRECATED",re[re.EASING_TYPE__DEPRECATED=28]="EASING_TYPE__DEPRECATED",re[re.INTERACTION_TYPE__DEPRECATED=29]="INTERACTION_TYPE__DEPRECATED",re[re.NAVIGATION_TYPE__DEPRECATED=30]="NAVIGATION_TYPE__DEPRECATED",re[re.OVERLAY_POSITION_TYPE=31]="OVERLAY_POSITION_TYPE",re[re.OVERLAY_BACKGROUND_INTERACTION=32]="OVERLAY_BACKGROUND_INTERACTION",re[re.STYLE_TYPE=33]="STYLE_TYPE",re[re.OVERFLOW_DIRECTION=34]="OVERFLOW_DIRECTION",re[re.SCROLL_BEHAVIOR=35]="SCROLL_BEHAVIOR",re[re.MASK_TYPE=36]="MASK_TYPE",re[re.OPACITY=37]="OPACITY",re[re.BACKGROUND_OPACITY=38]="BACKGROUND_OPACITY",re[re.RECTANGLE_TOP_LEFT_CORNER_RADIUS=39]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",re[re.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=40]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",re[re.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=41]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",re[re.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=42]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",re[re.STROKE_WEIGHT=43]="STROKE_WEIGHT",re[re.CORNER_RADIUS=44]="CORNER_RADIUS",re[re.CORNER_SMOOTHING=45]="CORNER_SMOOTHING",re[re.TRANSITION_DURATION__DEPRECATED=46]="TRANSITION_DURATION__DEPRECATED",re[re.TRANSITION_TIMEOUT__DEPRECATED=47]="TRANSITION_TIMEOUT__DEPRECATED",re[re.INTERACTION_DURATION__DEPRECATED=48]="INTERACTION_DURATION__DEPRECATED",re[re.SIZE=49]="SIZE",re[re.OVERRIDE_KEY=50]="OVERRIDE_KEY",re[re.OVERRIDDEN_SYMBOL_ID=51]="OVERRIDDEN_SYMBOL_ID",re[re.INHERIT_FILL_STYLE_ID=52]="INHERIT_FILL_STYLE_ID",re[re.INHERIT_FILL_STYLE_ID_FOR_STROKE=53]="INHERIT_FILL_STYLE_ID_FOR_STROKE",re[re.INHERIT_FILL_STYLE_ID_FOR_BACKGROUND=54]="INHERIT_FILL_STYLE_ID_FOR_BACKGROUND",re[re.INHERIT_TEXT_STYLE_ID=55]="INHERIT_TEXT_STYLE_ID",re[re.INHERIT_EFFECT_STYLE_ID=56]="INHERIT_EFFECT_STYLE_ID",re[re.OVERLAY_RELATIVE_POSITION__DEPRECATED=57]="OVERLAY_RELATIVE_POSITION__DEPRECATED",re[re.BACKGROUND_PAINT_DATA=58]="BACKGROUND_PAINT_DATA",re[re.FILL_PAINT_DATA=59]="FILL_PAINT_DATA",re[re.STROKE_PAINT_DATA=60]="STROKE_PAINT_DATA",re[re.EFFECT_DATA=61]="EFFECT_DATA",re[re.NAME=62]="NAME",re[re.ARC_DATA=63]="ARC_DATA",re[re.BACKGROUND_COLOR=64]="BACKGROUND_COLOR",re[re.PROTOTYPE_BACKGROUND_COLOR=65]="PROTOTYPE_BACKGROUND_COLOR",re[re.PROTOTYPE_DEVICE=66]="PROTOTYPE_DEVICE",re[re.OVERLAY_BACKGROUND_APPEARANCE=67]="OVERLAY_BACKGROUND_APPEARANCE",re[re.EXPORT_SETTINGS_DATA=68]="EXPORT_SETTINGS_DATA",re[re.PROTOTYPE_START_NODE_ID=69]="PROTOTYPE_START_NODE_ID",re[re.CONNECTION_URL_DEPRECATED=70]="CONNECTION_URL_DEPRECATED",re[re.TRANSITION_NODE_ID_DEPRECATED=71]="TRANSITION_NODE_ID_DEPRECATED",re[re.VIDEO_PLAYBACK=72]="VIDEO_PLAYBACK",re[re.FILL_GEOMETRY=73]="FILL_GEOMETRY",re[re.STROKE_GEOMETRY=74]="STROKE_GEOMETRY",re[re.SYMBOL_DATA=75]="SYMBOL_DATA",re[re.COMPILED_VECTOR_DATA=76]="COMPILED_VECTOR_DATA",re[re.STACK_MODE=77]="STACK_MODE",re[re.STACK_REVERSE_Z_INDEX=78]="STACK_REVERSE_Z_INDEX",re[re.KEY_TRIGGER__DEPRECATED=79]="KEY_TRIGGER__DEPRECATED",re[re.IS_STATE_GROUP=80]="IS_STATE_GROUP",re[re.PROTOTYPE_INTERACTIONS=81]="PROTOTYPE_INTERACTIONS",re[re.VOICE_EVENT_PHRASE__DEPRECATED=82]="VOICE_EVENT_PHRASE__DEPRECATED",re[re.PROTOTYPE_STARTING_POINT=83]="PROTOTYPE_STARTING_POINT",re[re.SHAPE_WITH_TEXT_TYPE=84]="SHAPE_WITH_TEXT_TYPE",re[re.INTERACTIVE_SLIDE_CONFIG_DATA=85]="INTERACTIVE_SLIDE_CONFIG_DATA",re[re.INTERACTIVE_SLIDE_PARTICIPANT_DATA=86]="INTERACTIVE_SLIDE_PARTICIPANT_DATA",re[re.SCROLL_OFFSET=87]="SCROLL_OFFSET",re[re.USED_AS_BASE_SCREEN=88]="USED_AS_BASE_SCREEN",re[re.CURRENT_VIEWPORT_SIZE=89]="CURRENT_VIEWPORT_SIZE",re[re.HAS_BEEN_LOADED=90]="HAS_BEEN_LOADED",re[re.STYLE_ID_FOR_FILL=91]="STYLE_ID_FOR_FILL",re[re.STYLE_ID_FOR_STROKE_FILL=92]="STYLE_ID_FOR_STROKE_FILL",re[re.STYLE_ID_FOR_TEXT=93]="STYLE_ID_FOR_TEXT",re[re.STYLE_ID_FOR_EFFECT=94]="STYLE_ID_FOR_EFFECT",re[re.STYLE_ID_FOR_GRID=95]="STYLE_ID_FOR_GRID",re[re.SLIDE_THUMBNAIL_HASH=96]="SLIDE_THUMBNAIL_HASH",re[re.SLIDE_SPEAKER_NOTES=97]="SLIDE_SPEAKER_NOTES",re[re.PHASE=98]="PHASE",re[re.END__=99]="END__",re))(wt||{});var hr;(d=>{function i(h,u){let m=s();for(let g=0,_=h.length;g<_;g=g+1)t(m,h[g],u[g]);return m}d.new1=i;function e(h,u){return h.has(wt[u])}d._in=e;function t(h,u,m){let g=wt[u];d._remapKey.set(g,u),h.set(g,m)}d.set=t;function r(h,u,m=null){return He.StringMap_get(h,wt[u],m)}d.get=r;function n(h,u){h.delete(wt[u])}d.remove=n;function o(h,u){He.StringMap_each(h,(m,g)=>{u(d._remapKey.get(m),g)})}d.each=o;function a(h){let u=[];return He.StringMap_each(h,(m,g)=>{u.push(`${m}=${nt.toString(g)}`)}),`{${u.join(", ")}}`}d.toString=a;function s(){return new Map}d._new=s,d._remapKey=new Map,d.EMPTY=s()})(hr||(hr={}));var Go;(n=>{function i(o,a){return hr._in(o,a)}n._in=i;function e(o,a,s=null){return hr.get(o,a,s)}n.get=e;function t(o,a){hr.each(o,a)}n.each=t;function r(o){return hr.toString(o)}n.toString=r})(Go||(Go={}));var Zd;(P=>{function i(H,Q){P._p.setTo(0,0);for(let Y=H.start();Ze.Command.isValid(Y,H);Y=Ze.Command.next(Y,H)){switch(Ze.Command.kind(Y,H)){case Ze.Command.Kind.CLOSE:break;case Ze.Command.Kind.MOVE_TO:{P._p3.setTo(Ze.Command.moveToX(Y,H),Ze.Command.moveToY(Y,H)),P._p.copyFrom(P._p3);break}case Ze.Command.Kind.LINE_TO:{P._p3.setTo(Ze.Command.lineToX(Y,H),Ze.Command.lineToY(Y,H)),u(Q,P._p,P._p0,P._p3);break}case Ze.Command.Kind.QUADRATIC_TO:{let ne=P._p0.x(),W=P._p0.y(),K=Ze.Command.quadraticToFirstX(Y,H),j=Ze.Command.quadraticToFirstY(Y,H),ge=Ze.Command.quadraticToX(Y,H),Ue=Ze.Command.quadraticToY(Y,H);P._p1.setTo(K+(ne-K)/3,j+(W-j)/3),P._p2.setTo(K+(ge-K)/3,j+(Ue-j)/3),P._p3.setTo(ge,Ue),u(Q,P._p,P._p0,P._p3),s(Q,P._p0,P._p1,P._p2,P._p3,0,0);break}case Ze.Command.Kind.CUBIC_TO:{P._p1.setTo(Ze.Command.cubicToFirstX(Y,H),Ze.Command.cubicToFirstY(Y,H)),P._p2.setTo(Ze.Command.cubicToSecondX(Y,H),Ze.Command.cubicToSecondY(Y,H)),P._p3.setTo(Ze.Command.cubicToX(Y,H),Ze.Command.cubicToY(Y,H)),u(Q,P._p,P._p0,P._p3),s(Q,P._p0,P._p1,P._p2,P._p3,0,0);break}default:break}P._p0.copyFrom(P._p3)}}P.compile=i;function e(H){return Math.abs(H)<P._EPSILON?0:H}P._roundToZero=e;function t(H,Q){return H.squaredDistanceTo(Q)<P._EPSILON*P._EPSILON}P._approxEqual=t;function r(H,Q,Y){let ne=(Y.x()-Q.x())*(Q.y()-H.y())-(Y.y()-Q.y())*(Q.x()-H.x());return ne<0?-1:ne>0?1:0}P._orientation=r;function n(H,Q,Y,ne){return r(H,Q,Y)!=r(H,Q,ne)&&r(Y,ne,H)!=r(Y,ne,Q)}P._linesIntersect=n;function o(H,Q,Y,ne){let W=ne.x()-Q.x(),K=ne.y()-Q.y(),j=Y.x()-Q.x(),ge=Y.y()-Q.y(),Ue=H.x()-Q.x(),Tt=H.y()-Q.y(),$e=W*W+K*K,xt=W*j+K*ge,Vt=W*Ue+K*Tt,kt=j*j+ge*ge,pe=j*Ue+ge*Tt,Me=$e*kt-xt*xt;if(Me==0)return!1;let vt=1/Me,ct=(kt*Vt-xt*pe)*vt,qe=($e*pe-xt*Vt)*vt,tt=1e-4;return ct>=-tt&&qe>=-tt&&ct+qe<=1+tt}P._pointInTriangle=o;function a(H,Q,Y){return H.x*(Q.y*Y.z-Q.z*Y.y)+H.y*(Q.z*Y.x-Q.x*Y.z)+H.z*(Q.x*Y.y-Q.y*Y.x)}P._dotCross=a;function s(H,Q,Y,ne,W,K,j){if(K==0||j<4){let ct=W.x()-Q.x(),qe=W.y()-Q.y(),tt=(Y.x()-Q.x())*qe-(Y.y()-Q.y())*ct,Qe=(ne.x()-Q.x())*qe-(ne.y()-Q.y())*ct,Rt=3*tt-3*Qe,Et=-4*tt+2*Qe,Ut=tt,dt=Et*Et-4*Ut*Rt;if(dt>0){let N=-Et/(2*Rt),k=Math.sqrt(dt)/(2*Rt),$=N+k,ae=N-k;if(0<$&&$<1&&0<ae&&ae<1){let se=($+ae)/2;for(let oe=0;oe<10;oe=oe+1){let _e=tt-Qe,le=Qe-2*tt,x=se*(se*(se*_e+le)+tt),F=se*(3*se*_e+2*le)+tt;se-=x/F}let Re=Q.mixedWith(Y,se),Pe=Y.mixedWith(ne,se),we=ne.mixedWith(W,se),ve=Re.mixedWith(Pe,se),Ke=Pe.mixedWith(we,se),ht=ve.mixedWith(Ke,se);s(H,Q,Re,ve,ht,1,j+1),s(H,ht,Ke,we,W,1,j+1),u(H,Q,ht,W);return}}}P._b0.setTo(Q.x(),Q.y(),1),P._b1.setTo(Y.x(),Y.y(),1),P._b2.setTo(ne.x(),ne.y(),1),P._b3.setTo(W.x(),W.y(),1);let ge=a(P._b0,P._b3,P._b2),Ue=a(P._b1,P._b0,P._b3),Tt=a(P._b2,P._b1,P._b0),$e=ge-2*Ue+3*Tt,xt=-Ue+3*Tt,Vt=3*Tt,kt=1/Math.sqrt($e*$e+xt*xt+Vt*Vt);$e*=kt,xt*=kt,Vt*=kt;let pe=3*xt*xt-4*$e*Vt,Me=$e*$e*pe;switch($e=e($e),xt=e(xt),Vt=e(Vt),Me=e(Me),t(P._b0,P._b1)&&t(P._b0,P._b2)&&t(P._b0,P._b3)?0:Me<0?4:Me>0?5:$e==0&&xt==0?Vt==0?1:2:$e==0?3:pe<0?4:5){case 5:{let ct=Math.sqrt(Math.max(0,9*xt*xt-12*$e*Vt)),qe=3*xt-ct,tt=6*$e,Qe=3*xt+ct,Rt=tt,Et=tt-qe,Ut=Rt-Qe;c(H,Q,qe*Qe,qe*qe*qe,Qe*Qe*Qe,Y,(3*qe*Qe-qe*Rt-tt*Qe)/3,qe*qe*(qe-tt),Qe*Qe*(Qe-Rt),ne,(tt*(Rt-2*Qe)+qe*(3*Qe-2*Rt))/3,Et*Et*qe,Ut*Ut*Qe,W,Et*Ut,-Et*Et*Et,-Ut*Ut*Ut);break}case 4:{let ct=Math.sqrt(Math.max(0,4*$e*Vt-3*xt*xt)),qe=xt-ct,tt=2*$e,Qe=xt+ct,Rt=tt;if(K!=2||j<4){let dt=qe/tt,N=Qe/Rt,k=P._EPSILON<dt&&dt<1-P._EPSILON,$=P._EPSILON<N&&N<1-P._EPSILON;if(k&&$){l(H,Q,Y,ne,W,Math.min(dt,N),Math.max(dt,N),j+1);return}if(k){l(H,Q,Y,ne,W,dt,-1,j+1);return}if($){l(H,Q,Y,ne,W,N,-1,j+1);return}}let Et=tt-qe,Ut=Rt-Qe;c(H,Q,qe*Qe,qe*qe*Qe,qe*Qe*Qe,Y,(-qe*Rt-tt*Qe+3*qe*Qe)/3,-qe*(qe*(Rt-3*Qe)+2*tt*Qe)/3,-Qe*(qe*(2*Rt-3*Qe)+tt*Qe)/3,ne,(tt*(Rt-2*Qe)+qe*(3*Qe-2*Rt))/3,(tt-qe)*(qe*(2*Rt-3*Qe)+tt*Qe)/3,(Rt-Qe)*(qe*(Rt-3*Qe)+2*tt*Qe)/3,W,Et*Ut,-Et*Et*Ut,-Et*Ut*Ut);break}case 3:{let ct=Vt,qe=3*xt,tt=ct-qe;c(H,Q,ct,ct*ct*ct,1,Y,ct-qe/3,ct*ct*tt,1,ne,ct-qe*(2/3),tt*tt*ct,1,W,tt,tt*tt*tt,1);break}case 2:{c(H,Q,0,0,0,Y,1/3,0,1/3,ne,2/3,1/3,2/3,W,1,1,1);break}}}P._compileCubic=s;function l(H,Q,Y,ne,W,K,j,ge){let Ue=Q.mixedWith(Y,K),Tt=Y.mixedWith(ne,K),$e=ne.mixedWith(W,K),xt=Ue.mixedWith(Tt,K),Vt=Tt.mixedWith($e,K),kt=xt.mixedWith(Vt,K);if(u(H,Q,kt,W),s(H,Q,Ue,xt,kt,2,ge+1),j==-1){s(H,kt,Vt,$e,W,2,ge+1);return}let pe=kt,Me=Vt,vt=$e,ct=W,qe=(j-K)/(1-K),tt=pe.mixedWith(Me,qe),Qe=Me.mixedWith(vt,qe),Rt=vt.mixedWith(ct,qe),Et=tt.mixedWith(Qe,qe),Ut=Qe.mixedWith(Rt,qe),dt=Et.mixedWith(Ut,qe);s(H,pe,tt,Et,dt,2,ge+1),s(H,dt,Ut,Rt,ct,2,ge+1)}P._compileSubdividedCubic=l;function c(H,Q,Y,ne,W,K,j,ge,Ue,Tt,$e,xt,Vt,kt,pe,Me,vt){P._v0.set(Q,Y,ne,W),P._v1.set(K,j,ge,Ue),P._v2.set(Tt,$e,xt,Vt),P._v3.set(kt,pe,Me,vt);let ct=(Y+pe)*(.9/2)+(j+$e)*(.1/2),qe=(ne+Me)*(.9/2)+(ge+xt)*(.1/2),tt=(W+vt)*(.9/2)+(Ue+Vt)*(.1/2),Qe=ct*ct*ct-qe*tt>0,Rt=0,Et=0;for(let k=0;k<4;k=k+1){let $=St.int_remainder(k+1,4),ae=St.int_remainder(k+2,4),se=St.int_remainder(k+3,4),Re=P._v[$].xy,Pe=P._v[ae].xy,we=P._v[se].xy,ve=Re.distanceTo(Pe),Ke=Pe.distanceTo(we),ht=we.distanceTo(Re),oe=(ve+Ke+ht)/2,_e=oe*(oe-ve)*(oe-Ke)*(oe-ht);_e>Rt&&(Rt=_e,Et=k)}let Ut=St.int_remainder(Et+1,4),dt=St.int_remainder(Et+2,4),N=St.int_remainder(Et+3,4);if(o(P._v[Et].xy,P._v[Ut].xy,P._v[dt].xy,P._v[N].xy)){m(H,P._v[Ut],P._v[dt],P._v[N],Qe);return}n(Q,Tt,K,kt)?Q.squaredDistanceTo(Tt)<K.squaredDistanceTo(kt)?(m(H,P._v0,P._v1,P._v2,Qe),m(H,P._v0,P._v2,P._v3,Qe)):(m(H,P._v0,P._v1,P._v3,Qe),m(H,P._v1,P._v2,P._v3,Qe)):n(Q,kt,K,Tt)?Q.squaredDistanceTo(kt)<K.squaredDistanceTo(Tt)?(m(H,P._v0,P._v1,P._v3,!Qe),m(H,P._v0,P._v3,P._v2,Qe)):(m(H,P._v0,P._v1,P._v2,Qe),m(H,P._v2,P._v1,P._v3,Qe)):Q.squaredDistanceTo(K)<Tt.squaredDistanceTo(kt)?(m(H,P._v0,P._v2,P._v1,Qe),m(H,P._v0,P._v1,P._v3,Qe)):(m(H,P._v0,P._v2,P._v3,Qe),m(H,P._v3,P._v2,P._v1,Qe))}P._appendQuad=c;function d(H,Q,Y){return H.equals(Q)||H.equals(Y)||Q.equals(Y)}P._isEmptyTriangle=d;function h(H,Q,Y,ne,W,K){H.appendFloat(Q).appendFloat(Y),H.appendFloat(ne).appendFloat(W).appendFloat(K)}P._appendVertex=h;function u(H,Q,Y,ne){d(Q,Y,ne)||(h(H,Q.x(),Q.y(),.5,.5,.5),h(H,Y.x(),Y.y(),.5,.5,.5),h(H,ne.x(),ne.y(),.5,.5,.5))}P._appendTriangle1=u;function m(H,Q,Y,ne,W){if(!d(Q.xy,Y.xy,ne.xy)){let K=W?-1:1;h(H,Q.xy.x(),Q.xy.y(),Q.k*K,Q.l*K,Q.m),h(H,Y.xy.x(),Y.xy.y(),Y.k*K,Y.l*K,Y.m),h(H,ne.xy.x(),ne.xy.y(),ne.k*K,ne.l*K,ne.m)}}P._appendTriangle2=m;class g{setTo(Q,Y,ne){this.x=Q,this.y=Y,this.z=ne}squaredDistanceTo(Q){let Y=this.x-Q.x,ne=this.y-Q.y,W=this.z-Q.z;return Y*Y+ne*ne+W*W}constructor(){this.x=0,this.y=0,this.z=0}}P.Vector3=g;class _{set(Q,Y,ne,W){this.xy=Q,this.k=Y,this.l=ne,this.m=W}constructor(){this.xy=null,this.k=0,this.l=0,this.m=0}}P.Vector5=_;let f;(ne=>(ne[ne.INITIAL=0]="INITIAL",ne[ne.SUBDIVIDED_BECAUSE_OF_CROSSING=1]="SUBDIVIDED_BECAUSE_OF_CROSSING",ne[ne.SUBDIVIDED_BECAUSE_OF_LOOP=2]="SUBDIVIDED_BECAUSE_OF_LOOP"))(f=P.CompileState||(P.CompileState={}));let S;(j=>(j[j.POINT=0]="POINT",j[j.LINE=1]="LINE",j[j.QUADRATIC=2]="QUADRATIC",j[j.CUSP=3]="CUSP",j[j.LOOP=4]="LOOP",j[j.SERPENTINE=5]="SERPENTINE"))(S=P.SegmentClass||(P.SegmentClass={})),P._EPSILON=5e-4,P._p=R.new2(),P._p0=R.new2(),P._p1=R.new2(),P._p2=R.new2(),P._p3=R.new2(),P._b0=new g,P._b1=new g,P._b2=new g,P._b3=new g,P._v0=new _,P._v1=new _,P._v2=new _,P._v3=new _,P._v=[P._v0,P._v1,P._v2,P._v3]})(Zd||(Zd={}));var jd=class{constructor(e,t){this.key=e,this.value=t}},fi=class{each(e){zt.IntMap_each(this._buckets,(t,r)=>{for(let n of r)e(n.key,n.value)})}getOrInsertFallback(e){let t=this._hash(e),r=zt.IntMap_get(this._buckets,t,null);if(r!=null){for(let o of r)if(this._equals(e,o.key))return o.value}else r=[],this._buckets.set(t,r);let n=this._fallback(e);return r.push(new jd(e,n)),n}get(e,t){let r=this._hash(e),n=zt.IntMap_get(this._buckets,r,null);if(n!=null){for(let o of n)if(this._equals(e,o.key))return o.value}return t}set(e,t){let r=this._hash(e),n=zt.IntMap_get(this._buckets,r,null);n==null&&(n=[],this._buckets.set(r,n));for(let o of n)if(this._equals(e,o.key)){o.value=t;return}n.push(new jd(e,t))}remove(e){let t=this._hash(e),r=zt.IntMap_get(this._buckets,t,null);if(r!=null){for(let n=0,o=r.length;n<o;n=n+1)if(this._equals(e,r[n].key)){r.splice(n,1),r.length==0&&this._buckets.delete(t);break}}}constructor(e,t,r){this._buckets=new Map,this._hash=e,this._equals=t,this._fallback=r}};var $d=class{constructor(e,t,r,n){this.bufferArea=e,this.hasNoCurves=t,this.hasNoOverlaps=r,this.hasNoCurvesAndSameOrientation=n}},Ct;(b=>{function i(T){return`SCROLL_OFFSET::${T}`}b.forScrollOffset=i;function e(T){return`OVERLAY_POSITION::${T}`}b.forOverlayPosition=e;function t(T){return`ANIMATEABLE_TRANSLATION::${T}`}b.forAnimateableTranslation=t;function r(T){return`SHADOW_TRANSFORMATION::${T}`}b.forShadowTransformation=r;function n(T){return`ANIMATEABLE_OPACITY::${T}`}b.forAnimateableOpacity=n;function o(T){return`ANIMATEABLE_DISSOLVE::${T}`}b.forAnimateableDissolve=o;function a(T){return`DYNAMIC_GEOMETRY::${T}`}b.forDynamicGeometry=a;function s(T){return T.id.startsWith("SCROLL_OFFSET")}b.isScrollingTransform=s,b.ENTERING_TLF="ENTERING_TLF",b.EXITING_TLF="EXITING_TLF",b.ENTERING_OVERLAY="ENTERING_OVERLAY",b.EXITING_OVERLAY="EXITING_OVERLAY",b.ENTERING_OVERLAY_BACKGROUND="ENTERING_OVERLAY_BACKGROUND",b.EXITING_OVERLAY_BACKGROUND="EXITING_OVERLAY_BACKGROUND",b.OVERLAY_BACKGROUND="OVERLAY_BACKGROUND",b.SMART_ANIMATE_OVERLAY_TRANSLATION="SMART_ANIMATE_OVERLAY_TRANSLATION",b.OVERLAY_BACKGROUND_DISSOLVE="OVERLAY_BACKGROUND_DISSOLVE",b.DISSOLVE_TRANSITION="DISSOLVE_TRANSITION"})(Ct||(Ct={}));var bo;(d=>{function i(h){if(St.int_remainder(h.byteCount(),d.NUM_BYTES_PER_FLOAT)!=0)return!1;let u=h.byteCount()/d.NUM_BYTES_PER_FLOAT|0;if(St.int_remainder(u,d.NUM_FLOATS_PER_VERTEX)!=0)return!1;let m=u/d.NUM_FLOATS_PER_VERTEX|0;if(St.int_remainder(m,3)!=0)return!1;if(h.byteCount()>O.BufferChunk.BYTE_COUNT)throw new Error("This triangles chunk exceeds the maximum buffer size and will crash if we try to render it");return!0}d.isValid=i;function e(h){return h.byteCount()/(d.NUM_BYTES_PER_FLOAT*d.NUM_FLOATS_PER_VERTEX)|0}d.numVertices=e;function t(h,u){let m=u*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return h.floatAt(m)}d.xValueAt=t;function r(h,u){let m=u*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return h.floatAt(m+1*d.NUM_BYTES_PER_FLOAT)}d.yValueAt=r;function n(h,u){let m=t(h,u),g=r(h,u);return new R(m,g)}d.xyValueAt=n;function o(h,u){let m=u*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return h.floatAt(m+2*d.NUM_BYTES_PER_FLOAT)}d.kValueAt=o;function a(h,u){let m=u*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return h.floatAt(m+3*d.NUM_BYTES_PER_FLOAT)}d.lValueAt=a;function s(h,u){let m=u*d.NUM_FLOATS_PER_VERTEX*d.NUM_BYTES_PER_FLOAT;return h.floatAt(m+4*d.NUM_BYTES_PER_FLOAT)}d.mValueAt=s,d.NUM_BYTES_PER_FLOAT=4,d.NUM_FLOATS_PER_VERTEX=5})(bo||(bo={}));var On=class On{static UNIT_RECT(){return On._UNIT_RECT!=null||(On._UNIT_RECT=new On(Ot.fromRect(new V(0,0,1,1)),"NONZERO")),On._UNIT_RECT}static getOrCreate(e,t){return On._uniqueValues.getOrInsertFallback(new On.PathAndWindingRuleArgs(e,t))}constructor(e,t){this._path=null,this._windingRule=null,this._cachedTriangles=null,this._path=e,this._windingRule=t}equals(e){return e==null?!1:this._windingRule==e._windingRule&&this._path.equals2(e._path)}bounds(){return this._path.bounds()}isRect(){return this._path.isRect()}path(){return this._path}windingRule(){return this._windingRule}triangles(e,t){return this._cachedTriangles==null&&(this._cachedTriangles=this._convertToTriangles(e,t)),this._cachedTriangles}_allTrianglesHaveSameOrientation(e){let t=0;for(let r=0;r<bo.numVertices(e);r=r+3){let n=bo.xyValueAt(e,r),o=bo.xyValueAt(e,r+1),a=bo.xyValueAt(e,r+2),s=R.cross(o.subtract1(n),a.subtract1(n)),l=s<0?-1:s>0?1:0;if(l!=0){if(t==-l)return!1;t=l}}return!0}_convertToTriangles(e,t){let r=[],n=null;if(this._path instanceof io)n=this._path.compileLoopBlinnAndReturnVolatileTriangles();else{On.TEMP_ARRAY.clear();let c=this._path.toBezierPath();Zd.compile(c,On.TEMP_ARRAY),n=On.TEMP_ARRAY.bytes()}let o=t.stride()*3,a=O.BufferChunk.BYTE_COUNT,s=a-St.int_remainder(a,o),l=(n.length+s-1)/s|0;for(let c=0,d=l;c<d;c=c+1){let h=n.subarray(c*s,c*s+s),u=new on(h),m=e.allocate(t,h);if(m==null)continue;let g=!0;for(let S=0,b=bo.numVertices(u);S<b;S=S+1){let T=bo.kValueAt(u,S),y=bo.lValueAt(u,S),I=bo.mValueAt(u,S);if(T!=.5||y!=.5||I!=.5){g=!1;break}}let _=bo.numVertices(u)==3||this.isRect(),f=g&&this._allTrianglesHaveSameOrientation(u);r.push(new $d(m,g,_,f))}return l>1&&console.warn(`splitting ${n.length} byte geometry buffer into ${l} chunks`),r}};On.TEMP_ARRAY=new on,On._UNIT_RECT=null,On._uniqueValues=new fi(e=>e.hash,(e,t)=>e.equals(t),e=>new On(e.path,e.windingRule));var Ft=On;(e=>{class i{constructor(r,n){this.path=null,this.windingRule=null,this.hash=0,this.path=r,this.windingRule=n,this.hash=no.combine(r.hash(),n=="ODD"?1:0)}equals(r){return this.windingRule==r.windingRule&&this.path.equals2(r.path)}}e.PathAndWindingRuleArgs=i})(Ft||(Ft={}));var eu=class{path(){throw new Error("Not implemented")}bounds(){throw new Error("Not implemented")}geometryEquals(e){throw new Error("Not implemented")}constructor(e,t,r){this.type=e,this.windingRule=t,this.styleID=r}},Fr=class i extends eu{constructor(t,r,n,o){super(0,t,r);this._path=null,this._bounds=null,this._path=n,this._bounds=o}path(){return this._path}bounds(){return this._bounds}geometryEquals(t){return t instanceof i?t.windingRule==this.windingRule&&t.bounds().equals(this._bounds)&&t.path().equals2(this._path):!1}},oc=class extends eu{constructor(t,r,n,o){super(1,t,r);this._computePath=null,this._maxBounds=null,this._computePath=n,this._maxBounds=o}path(){return this._computePath()}bounds(){return this._maxBounds}geometryEquals(t){return t==this}},ao=class{constructor(e){this._overrideTable=null,this._overrideTable=e}get(e,t){if(this._overrideTable!=null&&this._overrideTable._in(e)){let r=this._overrideTable.styleByID1(e),n=r!=null?Go.get(r,91,null):null,o=null;if(n!=null&&(o=t.findStyle(nt.asStyleId(n))),o==null){let s=r!=null?nt.asGUID(Go.get(r,52,null)):null;o=t.findNode(s)}if(o!=null)return o.fillPaints();let a=r!=null?Go.get(r,59,null):null;if(a!=null)return nt.asPaintList(a)}return null}forEachPaint(e,t){var r;(r=this._overrideTable)==null||r.forEachFillPaint(e,t)}table(){return this._overrideTable}},xr=class{geometryEquals(e){return ce.List_equalsWithComparison(this.regions,e.regions,(t,r)=>t.geometryEquals(r))}isRect(){return this.regions.length==1?Ft.getOrCreate(this.regions[0].path(),this.regions[0].windingRule).isRect():!1}toString(){return`Geometry(bounds: ${this.bounds} with ${this.regions.length} regions)`}constructor(e,t,r,n){this.regions=e,this.styleIDs=t,this.bounds=r,this.paintOverrides=n}},tu=class extends xr{constructor(t,r,n,o,a){super(t,r,n,o);this.emojiCodepoints=a}},yt=class i{static equals(e,t){if(e!=null&&t!=null&&e.guids.length==t.guids.length){for(let r=0,n=e.guids.length;r<n;r=r+1)if(!J.equals(e.guids[r],t.guids[r]))return!1;return!0}return e==t}static equalsGUID(e,t){return e!=null&&t!=null&&e.guids.length==1?J.equals(e.guids[0],t):e==null&&t==null}toString(){return`[${this.guids.map(e=>e).join(", ")}]`}startsWith(e){if(this.guids==null)return e.guids==null;if(this.guids.length<e.guids.length)return!1;for(let t=0,r=e.guids.length;t<r;t=t+1)if(!J.equals(e.guids[t],this.guids[t]))return!1;return!0}slice1(e){return this.slice2(e,this.guids.length)}slice2(e,t){return new i(this.guids.slice(e,t))}cloneAndAppend(e){let t=this.guids.slice();return Or(t,e.guids),new i(t)}static fromString(e){if(e!=null&&e.length>=2&&e.startsWith("[")&&e.endsWith("]")){let t=e.slice(1,e.length-1).split(","),r=[];for(let n of t){let o=J.fromString(n.trim());if(o==null)return null;r.push(o)}return new i(r)}return null}constructor(e){this.guids=e}static ROOT_STABLE_PATH(){return new i([])}},yo;(n=>{function i(o){return o}n.map=i;function e(o){let a=[];return o.each((s,l)=>{a.push(`
  `+s.toString()+": "+hr.toString(l))}),a.join(", ")}n.toString=e;function t(){return new Gn(o=>o.toString())}n._new=t;function r(o,a){let s=new Gn(l=>l.toString());for(let l=0,c=o.length;l<c;l=l+1)s.set(o[l],a[l]);return s}n.new1=r})(yo||(yo={}));var ki=class{toString(){return`SymbolData(id=${this.masterID}, overrides=[${yo.toString(this.instanceOverrides)}])`}constructor(e,t){this.masterID=e,this.instanceOverrides=t}},ru=class{constructor(e,t){this.value=e,this.units=t}toString(){return`${this.value} ${this.units}`}},nu=class{constructor(e,t,r){this.family=e,this.style=t,this.postscript=r}toString(){return`${this.family} ${this.style}`}},Ls=class{constructor(e,t){this.type=e,this.value=t}},ou=class{constructor(e,t,r,n){this.suffix=e,this.imageType=t,this.constraint=r,this.contentsOnly=n}},_i=class i{static DEFAULT_FOR_TESTS(){return new i("DEFAULT_FLOW_FOR_TESTS","default flow for tests",dr.FIRST_POSITION)}constructor(e,t,r){this.name=e,this.description=t,this.position=r}},iu=class iu{size(){switch(this.rotation){case"NONE":return this.nonRotatedSize;case"CCW_90":return this.nonRotatedSize.flipped()}return this.nonRotatedSize}canvasSpaceImageSize(e){let t=e.nonRotatedImageSize.divide(e.scaleFactor);switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}canvasSpaceTopLeftOffset(e){let t=e.nonRotatedOffset,r=e.nonRotatedImageSize.divide(e.scaleFactor),n=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return new R(t.y(),r.x()-n.x()-t.x())}return t}canvasSpaceFramePresetSize(e){let t=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}os(){return this.presetIdentifier==null||this.presetIdentifier==""?0:this.presetIdentifier.indexOf("APPLE")!=-1?this.presetIdentifier.indexOf("MACBOOK")!=-1?4:2:this.presetIdentifier.indexOf("GOOGLE")!=-1?1:this.presetIdentifier.indexOf("MICROSOFT")!=-1?5:(console.error(`${this.presetIdentifier} OS could not be inferred`),0)}toString(){return`PrototypeDevice(${this.type}, ${this.size()}, ${this.presetIdentifier}, ${this.rotation})`}toJSON(){return{type:this.type,size:{x:this.size().x(),y:this.size().y()},presetIdentifier:this.presetIdentifier,rotation:this.rotation}}constructor(e,t,r,n){this.type=e,this.nonRotatedSize=t,this.presetIdentifier=r,this.rotation=n}};iu.DEFAULT=new iu("NONE",new R(0,0),null,"NONE");var jr=iu,ei=class{constructor(){arguments.length==0?(this.backgroundType="NONE",this.backgroundColor=C.new3(0,0,0,.25)):arguments.length==2&&(this.backgroundType=arguments[0],this.backgroundColor=arguments[1])}},kr=class{constructor(e=new Map){this._styleByID=e}_in(e){return this._styleByID.has(e)}styleByID1(e){return this._styleByID.get(e)}forEachStyle(e){for(let t of Array.from(this._styleByID.keys()))e(t,this._styleByID.get(t))}styleByID2(){return this._styleByID}forEachFillPaint(e,t){this.forEachStyle((r,n)=>{let o=Go.get(n,91,null),a=null;if(o!=null&&(a=e.findStyle(nt.asStyleId(o))),a==null){let s=n!=null?nt.asGUID(Go.get(n,52,null)):null;a=e.findNode(s)}if(a!=null){let s=a.fillPaints();s!=null&&t(s)}else if(Go._in(n,59)){let s=nt.asPaintList(Go.get(n,59,null));s!=null&&t(s)}})}};var ic=class{constructor(e,t,r){this.exitingTransitionRoot=e,this.swappedStablePath=t,this.hotspotInExitingTree=r}};function IA(i){return!i.hasNodeProperty(83)||i.prototypeStartingPoint()==null?!1:i.prototypeStartingPoint().name!=""||i.prototypeStartingPoint().description!=""||i.prototypeStartingPoint().position!=null&&dr.isValid(i.prototypeStartingPoint().position)}var $r;(n=>{function i(o){return o!="NONE"}n.hasOverflow=i;function e(o){return o=="HORIZONTAL"||o=="BOTH"}n.scrollsHorizontally=e;function t(o){return o=="VERTICAL"||o=="BOTH"}n.scrollsVertically=t;function r(o,a){switch(o){case"VERTICAL":return Math.abs(a.y());case"HORIZONTAL":return Math.abs(a.x());case"BOTH":return Math.abs(a.length());default:break}return 0}n.getDirectionSimilarity=r})($r||($r={}));var dm;(e=>{function i(t){let r=t,n=t.parent(),o=new R(0,0);for(;n!=null&&n.type()!="CANVAS";){let a=n.scrollDirection()!="NONE"&&n.hasNodeProperty(87),s=r.isFixed();a&&!s&&o.addUpdate1(n.scrollOffset()),r=n,n=n.parent()}return o}e.cumulativeScrollOffsetOfAncestors=i})(dm||(dm={}));function EA(i){switch(i){case"VERTICAL":return new R(0,1);case"HORIZONTAL":return new R(1,0);case"BOTH":{let e=new R(1,1);return e.divide(e.length())}default:break}return R.new2()}var sa;(a=>{function i(s,l,c,d,h){let u=s.stickyNodeInitialTopPosition,m=s.overflowingAncestorInitialTopPosition,g=u-m;if(d)return c.y()>g?ye.FrozenVector_new4(c.x(),g):c;{if(h)return ye.FrozenVector_new4(0,0);let _=l(),f=s.stickyNodeHeight,S=s.parentNodeHeight,b=s.parentNodeInitialTopPosition,y=u-b+f,I=S-y,p=_.y()>g&&_.y()<=g+I,A=_.y()>g+I;return p?ye.FrozenVector_new4(0,g-_.y()):A?ye.FrozenVector_new4(0,-I):ye.FrozenVector_new4(0,0)}}a.getRelativeScrollTranslationOfStickyScrollingNodeFromBounds=i;function e(s){let l=s.parent();if(l==null)return ye.FrozenVector_new4(0,0);let c=l.isFixed()&&l.parent()!=null&&l.parent().hasNodeProperty(87);if(s.isStandardScrolling()&&l.hasNodeProperty(87))return l.scrollOffset();if(s.isStickyScrolling()){let d=s.parent(),h=!0;for(;d!=null&&!d.hasNodeProperty(87);)h=!1,d=d.parent();if(d==null)return ye.FrozenVector_new4(0,0);let u=s.absoluteTransform().m12(),m=s.size().y(),g=l.absoluteTransform().m12(),_=l.size().y(),f=d.absoluteTransform().m12(),S=new o(u,m,g,_,f);return i(S,()=>r(l),l.scrollOffset(),h,c)}return ye.FrozenVector_new4(0,0)}a.getScrollTranslationOfNodeRelativeToParent1=e;function t(s){let l=s.parent();if(l==null)return ye.FrozenVector_new4(0,0);let c=h=>h.scrollDirection()!="NONE"&&h.hasOverflowingContentInScrollDirection(),d=l.isFixed()&&l.parent()!=null&&c(l.parent());if(s.isStandardScrolling()&&c(l))return l.scrollOffset();if(s.isStickyScrolling()){let h=s.parent(),u=!0;for(;h!=null&&!c(h);)u=!1,h=h.parent();if(h==null)return ye.FrozenVector_new4(0,0);let m=s.absoluteTransform().m12(),g=s.size().y(),_=l.absoluteTransform().m12(),f=l.size().y(),S=h.absoluteTransform().m12(),b=new o(m,g,_,f,S);return i(b,()=>n(l),l.scrollOffset(),u,d)}return ye.FrozenVector_new4(0,0)}a.getScrollTranslationOfNodeRelativeToParent2=t;function r(s){let l=ye.FrozenVector_new4(0,0),c=s;for(;c!=null&&(!c.hasNodeProperty(87)||c==s);){let d=e(c);l=l.add1(d),c=c.parent()}return l}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor1=r;function n(s){let l=h=>h.scrollDirection()!="NONE"&&h.hasOverflowingContentInScrollDirection(),c=ye.FrozenVector_new4(0,0),d=s;for(;d!=null&&(!l(d)||d==s);){let h=t(d);c=c.add1(h),d=d.parent()}return c}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor2=n;class o{constructor(l,c,d,h,u){this.stickyNodeInitialTopPosition=l,this.stickyNodeHeight=c,this.parentNodeInitialTopPosition=d,this.parentNodeHeight=h,this.overflowingAncestorInitialTopPosition=u}}a.StickyScrollBounds=o})(sa||(sa={}));var su=(r=>(r[r.BASE_SCREEN=0]="BASE_SCREEN",r[r.OVERLAY_OR_SUBLAYER=1]="OVERLAY_OR_SUBLAYER",r[r.DETERMINE_USING_NODE_FIELDS=2]="DETERMINE_USING_NODE_FIELDS",r))(su||{}),au=class{constructor(e){this._node=null,this._overrideRole=null,this._node=e}overrideRole(e){this._overrideRole=new fe(e)}clearRoleOverride(){this._overrideRole=null}_role(){return this._overrideRole!=null?this._overrideRole.value:2}canvasSpaceContentBounds(){return this.scrollDirection()=="NONE"?this._node.canvasSpaceRenderedBounds():this._scrollableContentBounds()}defaultScrollOffset(){return this._node.canvasSpaceBoundingBox().topLeft().subtract1(this.canvasSpaceContentBounds().topLeft())}minScrollOffsetX(){return-this.defaultScrollOffset().x()}minScrollOffsetY(){return-this.defaultScrollOffset().y()}maxScrollOffsetX(){return Math.max(this.minScrollOffsetX(),this.canvasSpaceContentBounds().right()-this._node.canvasSpaceBoundingBox().right())}maxScrollOffsetY(){return Math.max(this.minScrollOffsetY(),this.canvasSpaceContentBounds().bottom()-this._node.canvasSpaceBoundingBox().bottom())}hasOverflowingContentInXDirection(){return $r.scrollsHorizontally(this.scrollDirection())&&this.canvasSpaceContentBounds().width()>this._node.canvasSpaceBoundingBox().width()}hasOverflowingContentInYDirection(){return $r.scrollsVertically(this.scrollDirection())&&this.canvasSpaceContentBounds().height()>this._node.canvasSpaceBoundingBox().height()}shouldResizeToFitViewport(){return(this._role()==2?this._node.isTopLevel():this._role()==0)&&!this._node.isTooRotatedToScroll()}nodeSize(){if(this.shouldResizeToFitViewport()){let e=this._node.findContainingCanvasOrParent(),t=e.prototypeDevice(),r=e.currentViewportSize(),n=t.type=="NONE"||t.type=="PRESENTATION"?r:t.size();return new R(Math.min(this._node.fullSize().x(),n.x()),Math.min(this._node.fullSize().y(),n.y()))}else return this._node.fullSize()}nodeSpaceScrollableContentBounds(){let e=this._node.fullSize(),t=V.new2();if((this._role()==2?this._node.isTopLevel():this._role()==0)?!$r.hasOverflow(this._node.overflowDirection()):!this._node.isFrameMaskDisabled()&&this.scrollDirection()=="NONE")t.setTo1(0,0,e.x(),e.y());else{let o=this._node.canvasSpaceBoundingBox().topLeft();t.setTo1(o.x(),o.y(),e.x(),e.y());for(let a=0,s=this._node.childCount();a<s;a=a+1){let l=this._node.childAt1(a);l.isFixed()||(Vn?t.expandToInclude(l.canvasSpaceBoundingBox()):t.expandToInclude(l.canvasSpaceScrollingBounds()))}t.setX(t.x()-o.x()),t.setY(t.y()-o.y()),this._node.overflowDirection()=="VERTICAL"?(t.setX(0),t.setWidth(e.x())):this._node.overflowDirection()=="HORIZONTAL"?(t.setY(0),t.setHeight(e.y())):this._node.overflowDirection()=="BOTH"}return t}_scrollableContentBounds(){let e=this.nodeSpaceScrollableContentBounds();return e.transformInto1(e,this._node.absoluteTransform()),e}scrollDirection(){let e=this._role()==2?nt.asBool(this._node.get(88,!1)):this._role()==0;return this._node.constrainsAnchoredChildren()?this._node.isTopLevel()&&e?"BOTH":this._node.overflowDirection():"NONE"}scrollDirectionWithScrollableContent(){let e=this.scrollDirection(),t=this.canvasSpaceContentBounds(),r=this._node.canvasSpaceBoundingBox(),n=$r.scrollsVertically(e)&&t.height()>r.height(),o=$r.scrollsHorizontally(e)&&t.width()>r.width();return n&&o?"BOTH":n?"VERTICAL":o?"HORIZONTAL":"NONE"}hasScrollableParent(){let e=this._node.parent();return!(e==null||e.overflowDirection()=="NONE"&&!(e.isTopLevel()&&e.type()=="FRAME"))}isFixed(){return this.hasScrollableParent()?this._node.scrollBehavior()=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME":!1}isStickyScrolling(){return this._node.scrollBehavior()=="STICKY_SCROLLS"}isStandardScrolling(){return!this.isFixed()&&!this.isStickyScrolling()}scrollAndClipBoundsBySelfAndAncestors(e,t){let r=e.clone(),n=this._node;for(;n.parent()!=null;){let o=sa.getScrollTranslationOfNodeRelativeToParent1(n);r.translate2(o.negative());let a=n.parent();a.clipsToBoundingRectangle()&&t==0&&r.intersectWith(a.canvasSpaceBoundingBox()),n=a}return r}canvasSpaceScrolledBounds(e){return this.scrollAndClipBoundsBySelfAndAncestors(this._node.canvasSpaceBoundingBox(),e)}canvasSpaceScrolledInteractiveBounds(e){let t=this._node.canvasSpaceInteractiveBounds();return this.scrollAndClipBoundsBySelfAndAncestors(t,e)}scrollsInPreferredDirection(e){switch(e){case"HORIZONTAL":return $r.scrollsHorizontally(this.scrollDirection());case"VERTICAL":return $r.scrollsVertically(this.scrollDirection());case"BOTH":return this.scrollDirection()!="NONE"}return!1}hasOverflowingContentInScrollDirection(){let e=this.canvasSpaceContentBounds(),t=this._node.canvasSpaceBoundingBox();return $r.scrollsHorizontally(this.scrollDirection())&&e.width()>t.width()||$r.scrollsVertically(this.scrollDirection())&&e.height()>t.height()}};var Xa=.001,ti=class{path(){throw new Error("Not implemented")}optimized(){throw new Error("Not implemented")}equals(e){throw new Error("Not implemented")}withNewPaints(e){throw new Error("Not implemented")}canBeAnalyticallyAntialiased(){return this.path().path().canBeAnalyticallyAntialiased()}constructor(e,t,r){this.type=e,this.paints=t,this.maxBounds=r}};(e=>{let i;(n=>(n[n.STATIC=0]="STATIC",n[n.DYNAMIC=1]="DYNAMIC"))(i=e.PaintedGeometryType||(e.PaintedGeometryType={}))})(ti||(ti={}));var Qt=class i extends ti{constructor(t,r){super(0,r,t.bounds());this._isOptimized=!1,this._path=t}path(){return this._path}withNewPaints(t){return new i(this._path,t)}equals(t){if(this.type!=t.type)return!1;if(this.path()==null||t.path()==null){if(this.path()==null!=(t.path()==null))return!1}else if(!this.path().equals(t.path()))return!1;if(this.paints==null||t.paints==null){if(this.paints==null!=(t.paints==null))return!1}else if(!Ce.equals(this.paints,t.paints))return!1;return!0}optimized(){if(this._isOptimized)return this;let t=Ce.optimize(this.paints);return this.paints!=t?new i(this.path(),t):(this._isOptimized=!0,this)}},Ms=class i extends ti{constructor(t,r,n,o){super(1,r,n);this._isOptimized=!1,this._computePath=t,this.id=o}path(){return this._computePath()}withNewPaints(t){return new i(this._computePath,t,this.maxBounds,this.id)}equals(t){return this.type==t.type&&this.id==t.id}optimized(){if(this._isOptimized)return this;let t=Ce.optimize(this.paints);return this.paints!=t?new i(this._computePath,t,this.maxBounds,this.id):(this._isOptimized=!0,this)}},un=(m=>(m[m.METADATA=0]="METADATA",m[m.GROUP=1]="GROUP",m[m.SUPERSAMPLE_GROUP=2]="SUPERSAMPLE_GROUP",m[m.FILL=3]="FILL",m[m.FILL_STROKE=4]="FILL_STROKE",m[m.MASK=5]="MASK",m[m.BLUR=6]="BLUR",m[m.BLEND=7]="BLEND",m[m.COMPOSITE_TILE_GRID=8]="COMPOSITE_TILE_GRID",m[m.HARD_MASK_WITH_COLOR=9]="HARD_MASK_WITH_COLOR",m[m.VOLATILE_PROPERTY_BINDING=10]="VOLATILE_PROPERTY_BINDING",m[m.STATIC_TRANSFORM_BINDING=11]="STATIC_TRANSFORM_BINDING",m[m.DISSOLVE=12]="DISSOLVE",m))(un||{});var Ai;(o=>{function i(a,s){return a.has(s)}o.has=i;function e(a,s){return a.get(s)}o.get=e;function t(a,s,l){a.set(s,l)}o.set=t;function r(a){a.clear()}o.clear=r;function n(){return new Map}o._new=n})(Ai||(Ai={}));var br=class i{currentBounds(e){if(e==null)return this.maxBounds;if(Ai.has(e,this))return Ai.get(e,this);let t=this.computeBounds(e);return Ai.set(e,this,t),t}equals(e){return this.equalsWithinBounds(e,null)}equalsWithinBounds(e,t){if(e==this)return!0;if(t!=null){let r=e.maxBounds.overlaps(t),n=this.maxBounds.overlaps(t);if(!r&&!n)return!0;if(r!=n)return!1;if(!e.maxBounds.equals(this.maxBounds)){if(t.contains1(e.maxBounds)&&t.contains1(this.maxBounds))return!1;let o=V.fromRect(this.maxBounds).intersectedWith(t),a=V.fromRect(this.maxBounds).intersectedWith(t);if(!o.equals(a))return!1}}return e.op()!=this.op()?!1:this.equalsWithinBoundsImpl(e,t)}constructor(e,t){this.maxBounds=null,this._isOptimized=!1,this.flags=0,this.maxBounds=e,this.flags=t}hasNonIsolatedBlends(){return(1&this.flags)!=0}hasBackgroundBlurs(){return(2&this.flags)!=0}canBeUsedInBackgroundBlurs(){return!(4&this.flags)}hasVolatileContent(){return(8&this.flags)!=0}hasAnimatingMedia(){return(16&this.flags)!=0}maskNeedsSSAA(){return(32&this.flags)!=0}canCacheRasterized(){return!(this.hasNonIsolatedBlends()||this.hasBackgroundBlurs()||this.hasAnimatingMedia()||this.hasVolatileContent())}isRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.hasPerpendicularAxes(Xa))return!0}return!1}isAxisAlignedRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path().asRoundedRectPath()!=null&&e.transform.isAxisAligned(Xa))return!0}return!1}isAxisAlignedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.isAxisAligned(Xa))return!0}return!1}isRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path()instanceof Ot&&e.transform.hasPerpendicularAxes(Xa))return!0}return!1}desiredAntialiasing(){return this.op()!=3&&this.op()!=4?0:this.hasAnimatingMedia()||this.hasVolatileContent()?0:this.op()==3&&this.geometry.canBeAnalyticallyAntialiased()?1:2}opProfileString(){let e="RenderNodeOp: ";switch(this.op()){case 0:{e+="METADATA";break}case 2:{e+="SUPERSAMPLE_GROUP";break}case 1:{e+="GROUP";break}case 3:{e+="FILL";break}case 4:{let t=this;switch(e+="FILL_STROKE",t.mode){case 0:{e+=" mode=INSIDE";break}case 1:{e+=" mode=OUTSIDE";break}}break}case 5:{let t=this;switch(e+="MASK",t.type){case 0:{e+=" type=NORMAL";break}case 3:{e+=" type=BACKGROUND_BLUR";break}case 2:{e+=" type=INNER_SHADOW";break}case 4:{e+=" type=KNOCKOUT_SHADOW";break}case 1:{e+=" type=LUMINANCE";break}}break}case 6:{e+="BLUR";break}case 7:{e+="BLEND mode="+this.blendMode;break}case 9:{e+="HARD_MASK_WITH_COLOR";break}case 8:{e+="COMPOSITE_TILE_GRID";break}case 10:{let t=this;e+=`VOLATILE_PROPERTY_BINDING property=${ca.VolatileProperty_toString(t.property)}`;break}case 11:{e+=`STATIC_TRANSFORM_BINDING transform=${this.transform}`;break}case 12:{e+="DISSOLVE";break}default:throw new Error(`Unhandled node op ${un[this.op()]}`)}return e}debugString1(){return this.debugString2(i.DebugStringType.BASIC)}debugString2(e){let t=new i.GenerateStringState;return this._debugStringRecursive(this,t,!0,!1,e),t.result}_debugStringRecursive(e,t,r,n,o){let a=o!=i.DebugStringType.BASIC;t.result+=t.indent,r||(t.result+=n?"\u2514\u2500":"\u251C\u2500");let s=t.indent.length;switch(r||(t.indent+=n?"  ":"\u2502 "),e.op()){case 0:{let l=e;t.result+="METADATA",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 2:{let l=e;t.result+="SUPERSAMPLE_GROUP",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 1:{let l=e;t.result+="GROUP",this._appendFlagsToString(t,e),t.result+=`
`;for(let c=0,d=l.children.length;c<d;c=c+1){let h=l.children[c];this._debugStringRecursive(h,t,!1,c+1==l.children.length,o)}break}case 3:{let l=e,c=l.geometry.path().path(),d=c instanceof Bi?"CirclePath":c instanceof Ot?"RoundedRectPath":c instanceof Pt?"BezierPath":c instanceof Ze?"FrozenBezierPath":c instanceof io?"UniquePath":"UnknownPath";t.result+=`FILL path=${d} paints=`,this._appendPaintDataToString(t,l.geometry.paints,o),a&&(t.result+=` transform=${l.transform}`,t.result+=` paintSize=${l.paintSize}`),e.isRectFill()?t.result+=" isRect":e.isRoundedRectFill()&&(t.result+=" isRoundedRect"),this._appendFlagsToString(t,e),t.result+=`
`;break}case 4:{let l=e;switch(t.result+="FILL_STROKE",l.mode){case 0:{t.result+=" mode=INSIDE";break}case 1:{t.result+=" mode=OUTSIDE";break}}t.result+=" fills=",this._appendGeometriesToString(t,l.fillGeometries,o),t.result+=" strokes=",this._appendGeometriesToString(t,l.strokeGeometries,o),a&&(t.result+=` transform=${l.transform}`),this._appendFlagsToString(t,l),t.result+=`
`;break}case 5:{let l=e;switch(t.result+="MASK",l.type){case 0:{t.result+=" type=NORMAL";break}case 3:{t.result+=" type=BACKGROUND_BLUR";break}case 2:{t.result+=" type=INNER_SHADOW color=",this._appendColorToString(t,l.innerShadowFill);break}case 4:{t.result+=" type=KNOCKOUT_SHADOW";break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.alpha,t,!1,!1,o),this._debugStringRecursive(l.color,t,!1,!0,o);break}case 6:{let l=e;t.result+=`BLUR radius=${l.radius}`,a&&(t.result+=` clamp=${l.clamp}`),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 7:{let l=e;t.result+="BLEND mode=",t.result+=l.blendMode,t.result+=` opacity=${l.opacity}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 9:{let l=e;t.result+="HARD_MASK_WITH_COLOR color=",this._appendColorToString(t,l.color),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.alpha,t,!1,!0,o);break}case 8:{let l=e;t.result+="COMPOSITE_TILE_GRID",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.tree,t,!1,!0,o);break}case 10:{let l=e;switch(t.result+=`VOLATILE_PROPERTY_BINDING property=${ca.VolatileProperty_toString(l.property)}`,a&&(t.result+=` id=${l.id}`),l.property){case 3:{t.result+=` value=${l.maxTransformScale()}`;break}case 2:{t.result+=` value=${l.transform()}`,l.id.startsWith("SHADOW_TRANSFORMATION")&&(t.result+=" SHADOW_TRANSFORMATION");break}case 4:{t.result+=` value=${l.opacity()}`;break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 11:{let l=e;t.result+=`STATIC_TRANSFORM_BINDING transform=${l.transform}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.child,t,!1,!0,o);break}case 12:{let l=e;t.result+="DISSOLVE",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(l.startChild,t,!1,!1,o),this._debugStringRecursive(l.endChild,t,!1,!0,o);break}default:throw new Error(`Unhandled node op ${un[e.op()]}`)}t.indent=t.indent.slice(0,s)}_appendGeometriesToString(e,t,r){e.result+="[";for(let n=0,o=t.length;n<o;n=n+1){let a=t[n];n!=0&&(e.result+=", ");let s=a.path().path();s instanceof Pt?e.result+=`(${s.countCommands()} commands, `:s instanceof Bi?e.result+="EllipsePath, ":s instanceof Ot&&(e.result+="RoundedRectPath, "),this._appendPaintDataToString(e,a.paints,r),e.result+=")"}e.result+="]"}_appendFlagsToString(e,t){t.hasNonIsolatedBlends()&&(e.result+=" hasBlends"),t.hasBackgroundBlurs()&&(e.result+=" hasBgBlurs"),t.canBeUsedInBackgroundBlurs()&&(e.result+=" bgBlurSafe"),t.maskNeedsSSAA()&&(e.result+=" maskNeedsSSAA"),t.hasVolatileContent()&&(e.result+=" volatile"),t.canCacheRasterized()||(e.result+=" nocache")}_appendSinglePaintToString(e,t,r){let n=r!=i.DebugStringType.BASIC,o=t.asVolatilePaint();if(o!=null){e.result+="VOLATILE [",this._appendSinglePaintToString(e,o.from(),r),e.result+=" -> ",this._appendSinglePaintToString(e,o.to(),r),e.result+="]";return}let a=t.asSinglePaint();switch(a.type()){case"SOLID":{e.result+="color=",this._appendColorToString(e,a.color());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{e.result+="stops=[";let s=a.colorStops();for(let l=0,c=s.length;l<c;l=l+1){l>0&&(e.result+=", ");let d=s[l];e.result+=`${d.position}`,e.result+=" ",this._appendColorToString(e,d.color)}e.result+="]";break}case"IMAGE":case"VIDEO":{n&&(e.result+=` hash=${a.image()!=null?a.image().hash():"NULL"}`,e.result+=` thumbnail=${a.imageThumbnail()!=null?a.imageThumbnail().hash():"NULL"}`,e.result+=` imageScaleMode=${a.imageScaleMode()}`,e.result+=` imageRotationDeg=${a.rotationDeg()}`,e.result+=` imageScalingFactor=${a.scalingFactor()}`);break}default:break}n&&a.transform()!=null&&(e.result+=` transform=${a.transform()}`),e.result+=` opacity=${a.opacity()}`}_appendPaintDataToString(e,t,r){e.result+="[";for(let n=0,o=t.length;n<o;n=n+1){n>0&&(e.result+=",");let a=t[n];e.result+=a.type()+" ",this._appendSinglePaintToString(e,a,r)}e.result+="]"}_appendColorToString(e,t){C.isOpaque(t)?e.result+=C.toCSS(t):e.result+=`rgba(${C.red(t)}, ${C.green(t)}, ${C.blue(t)}, ${C.alpha(t)})`}static visitEachNodeInTree(e,t,r,n,o){if(e!=null&&!(n!=null&&o!=null&&!e.currentBounds(o).overlaps(n))){switch(t!=null&&t(e),e.op()){case 0:{let a=e;i.visitEachNodeInTree(a.child,t,r,n,o);break}case 2:{let a=e;i.visitEachNodeInTree(a.child,t,r,n,o);break}case 1:{let a=e;for(let s of a.children)i.visitEachNodeInTree(s,t,r,n,o);break}case 3:case 4:case 8:break;case 5:{let a=e;i.visitEachNodeInTree(a.alpha,t,r,n,o),i.visitEachNodeInTree(a.color,t,r,n,o);break}case 6:{let a=e;i.visitEachNodeInTree(a.child,t,r,n,o);break}case 7:{let a=e;i.visitEachNodeInTree(a.child,t,r,n,o);break}case 9:{let a=e;i.visitEachNodeInTree(a.alpha,t,r,n,o);break}case 10:{let a=e;i.visitEachNodeInTree(a.child,t,r,n,o);break}case 11:{let a=e;i.visitEachNodeInTree(a.child,t,r,n,o);break}case 12:{let a=e;i.visitEachNodeInTree(a.startChild,t,r,n,o),i.visitEachNodeInTree(a.endChild,t,r,n,o);break}default:throw new Error(`Unhandled node op ${un[e.op()]}`)}r!=null&&r(e)}}static geometryNodePaintSize(e){return e==null?null:e.op()==3||e.op()==4?e.paintSize:null}};(t=>{let i;(o=>(o[o.BASIC=0]="BASIC",o[o.EXTENDED=1]="EXTENDED"))(i=t.DebugStringType||(t.DebugStringType={}));class e{constructor(){this.result="",this.indent=""}}t.GenerateStringState=e})(br||(br={}));var Xe=class i extends br{constructor(t,r=!1){super(RA(t,null),rE(t));this.children=t,this._isFirstChildSolidBackground=r,this._isFirstChildSolidBackground}op(){return 1}isFirstChildSolidBackground(){return this._isFirstChildSolidBackground}canCacheRasterized(){return this.hasAnimatingMedia()||this.hasVolatileContent()||this.hasBackgroundBlurs()?!1:this._isFirstChildSolidBackground?!0:!this.hasNonIsolatedBlends()}computeBounds(t){return RA(this.children,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.children.length;for(let r=0;r<t;r=r+1){if(r==0&&this._isFirstChildSolidBackground)continue;let n=this.children[r],o=n.optimized();if(o==n&&n.op()!=1)continue;let a=this.children.slice(0,r),s=(l,c)=>{if(c.op()==1){let d=c;for(let h of d.children)l.push(h)}else l.push(c)};for(o!=null&&s(a,o);(r=r+1)<t;){let l=this.children[r].optimized();l!=null&&s(a,l)}return a.length==0?null:this._isFirstChildSolidBackground?a.length==1?null:new i(a,this._isFirstChildSolidBackground):i.wrap(a)}return this.children.length==1?this.children[0]:(this._isOptimized=!0,this)}equalsWithinBoundsImpl(t,r){let o=t.children;if(this.children.length!=o.length)return!1;for(let a=0,s=this.children.length;a<s;a=a+1)if(!this.children[a].equalsWithinBounds(o[a],r))return!1;return!0}static wrap(t){return t.length==1?t[0]:new i(t)}static wrapWithSolidBackground(t,r){let n=yr.solidColorRect(t.maxBounds,r,1);return new i([n,t],!0)}},Ho=class i extends br{constructor(t,r){super(t.maxBounds,r?t.flags|r:t.flags);this.child=t}op(){return 2}computeBounds(t){return this.child.computeBounds(t)}optimized(){if(this._isOptimized)return this;let t=o=>o.op()==5&&o.type==4,r=t(uu(this.child)),n=this.child.optimized();return n==null?null:r&&!t(uu(n))||!n.maskNeedsSSAA()&&!this.maskNeedsSSAA()?n:n!=this.child?new i(n,this.flags):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(t,r){let n=t;return this.child.equalsWithinBounds(n.child,r)}static thatShouldNotBeUnwrappedInOptimization(t){return new i(t,32)}},la=class i extends br{constructor(t,r){super(t.maxBounds,r|t.flags);this.child=t}op(){return 0}computeBounds(t){return this.child.computeBounds(t)}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null?null:t==this.child?(this._isOptimized=!0,this):new i(t,this.flags)}equalsWithinBoundsImpl(t,r){let n=t;return this.flags==t.flags&&this.child.equalsWithinBounds(n.child,r)}static createForBackgroundBlur(t){return new i(t,6)}},yr=class i extends br{constructor(t,r,n){super($I(t,r),aE(r));this.transform=t,this.geometry=r,this.paintSize=n}op(){return 3}geometryBounds(){return this.geometry.canBeAnalyticallyAntialiased()?this.transform.clone().transformRect(this.geometry.path().bounds().clone()):this.maxBounds}computeBounds(t){return this.maxBounds}withPaints(t){return new i(this.transform,this.geometry.withNewPaints(t),this.paintSize)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty()||!Ce.containsAtLeastOneVisiblePaint(this.geometry.paints))return null;let t=this.geometry.optimized(),r=t.type==0,n=t.canBeAnalyticallyAntialiased();if(r&&!n&&!t.path().isRect()&&(Ce.hasAnimatingMediaPaints(t.paints)||Ce.hasVolatilePaints(t.paints))){let o=new i(this.transform,new Qt(t.path(),[te.createSolid(C.BLACK,1)]),this.paintSize),a=new i(this.transform,new Qt(Ft.getOrCreate(Ot.fromRect(t.path().bounds()),"ODD"),t.paints),this.paintSize);return new pn(o,a).optimized()}return t==this.geometry?(this._isOptimized=!0,this):new i(this.transform,t,this.paintSize)}equalsWithinBoundsImpl(t,r){let n=t;return this.transform.equals1(n.transform)&&this.geometry.equals(n.geometry)&&this.paintSize.equals(n.paintSize)}static solidColorRect(t,r,n){let o=[te.createSolid(r,n)],a=ee.new2().translatedBy1(t.topLeft()).scaledBy1(t.size()),s=new Qt(Ft.UNIT_RECT(),o),l=ye.FrozenVector_ZERO;return new i(a,s,l)}};var ac=class i extends br{constructor(t,r,n,o,a){super(jI(t,r,n,a),ZI([r,n]));this.mode=0,this.transform=t,this.fillGeometries=r,this.strokeGeometries=n,this.paintSize=o,this.mode=a}op(){return 4}computeBounds(t){return this.maxBounds}optimized(){if(this._isOptimized)return this;let t=[];for(let o=0,a=this.strokeGeometries.length;o<a;o=o+1){let s=this.strokeGeometries[o];Ce.containsAtLeastOneVisiblePaint(s.paints)&&t.push(s)}if(this.maxBounds.isEmpty()||this.fillGeometries.length==0&&t.length==0)return null;let r=o=>{let a=[];for(let s=0,l=o.length;s<l;s=s+1){let c=o[s];a.push(new yr(this.transform,c,this.paintSize))}return Xe.wrap(a).optimized()};return t.length==0?r(this.fillGeometries):this.fillGeometries.length==0?this.mode==0?null:r(t):jt.FrozenList_equals(t,this.strokeGeometries,(o,a)=>o.equals(a))?(this._isOptimized=!0,this):new i(this.transform,this.fillGeometries,t,this.paintSize,this.mode).optimized()}equalsWithinBoundsImpl(t,r){let n=t;return this.transform.equals1(n.transform)&&jt.FrozenList_equals(this.fillGeometries,n.fillGeometries,(o,a)=>o.equals(a))&&jt.FrozenList_equals(this.strokeGeometries,n.strokeGeometries,(o,a)=>o.equals(a))&&this.paintSize.equals(n.paintSize)&&this.mode==n.mode}};var pn=class i extends br{constructor(){var e=(...args)=>{super(...args)};let t=arguments[0],r=arguments[1];if(arguments.length==5){let n=arguments[2];e(um(t,r,n,null),xA(t,r,n)),this.alpha=t,this.color=r,this.type=n,this.innerShadowFill=arguments[3],this.innerShadowAlphaRequiresHardMask=arguments[4]}else arguments.length==2&&(e(um(t,r,0,null),xA(t,r,0)),this.alpha=t,this.color=r,this.type=0,this.innerShadowFill=C.TRANSPARENT,this.innerShadowAlphaRequiresHardMask=!1)}op(){return 5}computeBounds(t){return um(this.alpha,this.color,this.type,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.alpha.optimized();if(t==null)return null;let r=this.color.optimized(),n=this.type!=4,o=this.type!=4&&this.type!=2;if(r!=null&&n&&(r=i.cullGroupChildren(r,t.maxBounds)),r!=null&&o&&(t=i.cullGroupChildren(t,r.maxBounds),t==null))return null;switch(this.type){case 0:case 1:{if(r==null)return null;let a=!1,s=t;if(t.isAxisAlignedRectFill()){let l=V.new2();l.copyFrom(s.geometryBounds()),l.expand1(Xa),a=l.contains1(r.maxBounds)}else if(t.isAxisAlignedRoundedRectFill()&&(X.optimizationExposureLogging()&&Lt.didEncounterRoundedRectOptimization(),X.roundedMaskOptimization())){let c=s.geometry.path().path().asRoundedRectPath().radii(),d=V.new2();d.copyFrom(s.geometryBounds()),d.expand1(Xa);let h=Math.max(Math.max(c.topLeft,c.topRight),Math.max(c.bottomLeft,c.bottomRight)),u=Math.min(d.width()/2,d.height()/2);if(h<=u){let m=V.new2();if(m.copyFrom(s.geometryBounds()),m.expand1(Xa),m.contains1(r.maxBounds)){let _=r.maxBounds,f=_.left(),S=_.right(),b=_.top(),T=_.bottom(),y=new R(m.left()+c.topLeft,m.top()+c.topLeft),I=new R(m.right()-c.topRight,m.top()+c.topRight),p=new R(m.left()+c.bottomLeft,m.bottom()-c.bottomLeft),A=new R(m.right()-c.bottomRight,m.bottom()-c.bottomRight);(f>=y.x()||b>=y.y()||Math.sqrt(Math.pow(f-y.x(),2)+Math.pow(b-y.y(),2))<=c.topLeft)&&(S<=I.x()||b>=I.y()||Math.sqrt(Math.pow(S-I.x(),2)+Math.pow(b-I.y(),2))<=c.topRight)&&(f>=p.x()||T<=p.y()||Math.sqrt(Math.pow(f-p.x(),2)+Math.pow(T-p.y(),2))<=c.bottomLeft)&&(S<=A.x()||T<=A.y()||Math.sqrt(Math.pow(S-A.x(),2)+Math.pow(T-A.y(),2))<=c.bottomRight)&&(a=!0)}}}if(a){let l=s.geometry.paints;if(Ce.containsAtLeastOneVisibleOpaquePaint(l))return r;let c=Ce.onlySolidPaintOrNull(l);if(c!=null)return new Wn("PASS_THROUGH",C.alphaF(c.color())*c.opacity(),r).optimized()}break}case 4:{if(r==null)return null;let a=t.maxBounds,s=r.maxBounds;if(!a.overlaps(s))return r;if(!t.hasVolatileContent()&&a.contains1(s))return null;break}case 2:{if(C.alpha(this.innerShadowFill)==0)return null;if(r==null&&t.op()==3&&!this.innerShadowAlphaRequiresHardMask){let a=t,s=a.geometry.paints,l=Ce.onlySolidPaintOrNull(s);if(l!=null)return a.withPaints([te.createSolid(C.multiplyOpacity(this.innerShadowFill,C.alphaF(l.color())),1)])}if(t.op()==9&&r!=null){let a=t;return new i(a.alpha,r,this.type,this.innerShadowFill,!0)}break}case 3:break}return t==this.alpha&&r==this.color?(this._isOptimized=!0,this):(r==null&&(r=new Xe([])),new i(t,r,this.type,this.innerShadowFill,this.innerShadowAlphaRequiresHardMask))}equalsWithinBoundsImpl(t,r){let n=t;return this.type==n.type&&this.innerShadowFill==n.innerShadowFill&&this.alpha.equalsWithinBounds(n.alpha,r)&&this.color.equalsWithinBounds(n.color,r)}static createForInnerShadow(t,r,n){return new i(t,r,2,n,!1)}static createForBackgroundBlur(t,r){return new i(t,r,3,C.TRANSPARENT,!1)}static createForKnockoutShadow(t,r){return new i(t,r,4,C.TRANSPARENT,!1)}static createForLuminanceMask(t,r){return new i(t,r,1,C.TRANSPARENT,!1)}static cullGroupChildren(t,r){if(t!=null&&!t.maxBounds.overlaps(r))return null;if(t!=null&&t.op()==1){let n=t,o=n.children.length;for(let a=0;a<o;a=a+1)if(!n.children[a].maxBounds.overlaps(r)){let l=n.children.slice(0,a);for(;(a=a+1)<o;)n.children[a].maxBounds.overlaps(r)&&l.push(n.children[a]);return Xe.wrap(l).optimized()}}return t}},so=class i extends br{constructor(t,r){super(C.alpha(r)>0?t.maxBounds:V.INVALID,nE(t));this.alpha=t,this.color=r}op(){return 9}computeBounds(t){return C.alpha(this.color)>0?this.alpha.currentBounds(t):V.INVALID}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.alpha.optimized();if(t==null)return null;if(t.op()==10){let n=t;return new pt(new i(n.child,this.color),n.id,n.property,n.getter).optimized()}t=CA(t,n=>(n.op()==7&&(n=n.child),n));let r=CA(t,n=>{if(n.op()==3){let o=n;if(!Ce.hasVolatilePaints(o.geometry.paints)&&!Ce.hasAnyFullyTransparentAreas(o.geometry.paints))return o.withPaints([te.createSolid(this.color,1)])}return n});return r!=t?r:t==this.alpha?(this._isOptimized=!0,this):new i(t,this.color)}equalsWithinBoundsImpl(t,r){let n=t;return this.color==n.color&&this.alpha.equalsWithinBounds(n.alpha,r)}},zn=class i extends br{constructor(t,r,n){super(NA(t,r,null),oE(r));this.radius=t,this.child=r,this.clamp=n}op(){return 6}computeBounds(t){return NA(this.radius,this.child,t)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let t=this.child.optimized();if(t==null)return null;if(this.radius==0)return t;if(t.op()==10&&this.clamp.isInvalid()){let r=t;return new pt(new i(this.radius,r.child,this.clamp),r.id,r.property,r.getter).optimized()}return t==this.child?(this._isOptimized=!0,this):new i(this.radius,t,this.clamp)}equalsWithinBoundsImpl(t,r){let n=t;return this.radius==n.radius&&this.clamp.equals(n.clamp)&&this.child.equalsWithinBounds(n.child,r)}},Wn=class i extends br{constructor(t,r,n){super(r>0?n.maxBounds:V.INVALID,iE(t,n));this.blendMode=null,this.opacity=0,this.child=null,this.blendMode=t,this.opacity=r,this.child=n}op(){return 7}computeBounds(t){return this.opacity>0?this.child.currentBounds(t):V.INVALID}optimized(){var n;if(this._isOptimized)return this;if(this.opacity==0||this.maxBounds.isEmpty())return null;let t=this.child.optimized();if(t==null)return null;if(this.opacity==1&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL"&&!t.hasNonIsolatedBlends()))return t;if((this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&t.op()==3){let o=t,a=(n=Ce.onlyPaintOrNull(o.geometry.paints))==null?void 0:n.asSinglePaint();if(a!=null){let s=a.cloneAsSinglePaint();return s.setOpacity(s.opacity()*this.opacity),o.withPaints([s])}}let r=this.opacity;if(t.op()==7){let o=t;this.blendMode==o.blendMode&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&(r=o.opacity*r,t=o.child)}return r==this.opacity&&t==this.child?(this._isOptimized=!0,this):new i(this.blendMode,r,t)}equalsWithinBoundsImpl(t,r){let n=t;return this.blendMode==n.blendMode&&this.opacity==n.opacity&&this.child.equalsWithinBounds(n.child,r)}},cu=class{constructor(e,t){this.tileHandleOrNull=null,this.neededImagesOrNull=null,this.key=e,this._cache=t}canvasSpaceBounds(){return this.key.bounds}textureRegionOrNull(){return this._cache.textureRegionOrNull(this)}bounds(){return this.key.bounds}};var du=class extends br{constructor(t,r){super(wA(t,null),t.flags);this._tiles=new Map,this._devicePixelsPerCanvasPixel=-1,this.tree=t,this._tileCache=r}op(){return 8}optimized(){return this._isOptimized=!0,this}computeBounds(t){return wA(this.tree,t)}equalsWithinBoundsImpl(t,r){let n=t;return this._tileCache==n._tileCache&&this.maxBounds.equals(n.maxBounds)&&this.tree.equalsWithinBounds(n.tree,r)}setDevicePixelPerCanvasPixel(t){this._devicePixelsPerCanvasPixel!=t&&(this._tiles=new Map,this._devicePixelsPerCanvasPixel=t)}numTilesNeededForBounds(t){let r=V.new3(t);r.intersectWith(this.maxBounds);let n=new R(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),o=or.TILE_SIZE/this._devicePixelsPerCanvasPixel,a=Math.floor((r.left()-n.x())/o)|0,s=Math.ceil((r.right()-n.x())/o)|0,l=Math.floor((r.top()-n.y())/o)|0,c=Math.ceil((r.bottom()-n.y())/o)|0;return(s-a)*(c-l)}forEachTileWithinBounds(t,r,n){if(!r.overlaps(this.maxBounds))return;let o=V.new3(r);o.intersectWith(this.maxBounds);let a=new R(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),s=or.TILE_SIZE/this._devicePixelsPerCanvasPixel,l=Math.floor((o.left()-a.x())/s)|0,c=Math.ceil((o.right()-a.x())/s)|0,d=Math.floor((o.top()-a.y())/s)|0,h=Math.ceil((o.bottom()-a.y())/s)|0,u=a.y()+d*s;for(let m=d;m<h;m=m+1,u+=s){let g=zt.IntMap_get(this._tiles,m,null);g==null&&(g=new Map,this._tiles.set(m,g));let _=a.x()+l*s;for(let f=l;f<c;f=f+1,_+=s){let S=zt.IntMap_get(g,f,null);if(S!=null){let y=S.value;y!=null&&n(y);continue}if(t==1)continue;let b=new V(_,u,s,s),T=this._tileCache.getOrInsertOrNull(this.tree,b);g.set(f,new fe(T)),T!=null&&n(T)}}}};var pt=class i extends br{constructor(t,r,n,o){super(eE(t,n),t.flags|8);this.child=t,this.id=r,this.property=n,this.getter=o}op(){return 10}computeBounds(t){switch(this.property){case 2:{let r=this.child.currentBounds(t).clone();return this.transform().transformRect(r),r}case 1:case 3:case 4:case 5:return this.child.currentBounds(t);case 0:return this.maxBounds;default:throw new Error(`Unhandled VolatileProperty value: ${ca.VolatileProperty_toString(this.property)}`)}}transform(){return this.getter()}opacity(){return+this.getter()}maxTransformScale(){return+this.getter()}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null||t.maxBounds.isEmpty()?null:t!=this.child?new i(t,this.id,this.property,this.getter):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(t,r){let n=t;return this.id==n.id&&this.property==n.property&&this.child.equals(n.child)}static forTranslation(t,r,n){let o=ee.new2();return i.forTransform(t,r,()=>(o.copyFrom(Nt.FrozenAffineTransform_IDENTITY),o.translatedBy1(n())))}static forTransform(t,r,n){return new i(t,r,2,n)}static forOpacity(t,r,n){return new i(t,r,4,n)}static forTransformIsolation(t){let r="ID_FOR_TRANSFORM_ISOLATION";return new i(t,r,1,null)}static forMaxTransformScale(t,r){let n=`ID_FOR_MAX_TRANSFORM_SCALE_${t}`;return new i(r,n,3,()=>t)}static forInverseTransform(t){let r="ID_FOR_INVERSE_TRANSFORM";return new i(t,r,0,null)}static forStateSwap(t){let r="ID_FOR_STATE_SWAP";return new i(t,r,5,null)}},To=class i extends br{constructor(t,r){super(tE(t,r),t.flags);this.child=t,this.transform=r}op(){return 11}computeBounds(t){return this.maxBounds}optimized(){if(this._isOptimized)return this;let t=this.child.optimized();return t==null||t.maxBounds.isEmpty()?null:this.transform.equals1(Nt.FrozenAffineTransform_IDENTITY)?t:t!=this.child?new i(t,this.transform):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(t,r){let n=t;return this.transform.equals1(n.transform)&&this.child.equalsWithinBounds(n.child,r!=null?this.transform.inverse().transformRect(V.new3(r)):null)}},en=class i extends br{constructor(t,r,n,o){super(OA(t,r,null),(t!=null?t.flags:0)|(r!=null?r.flags:0)|8);this.startChild=t,this.endChild=r,this.id=n,this.progressFn=o}op(){return 12}computeBounds(t){return OA(this.startChild,this.endChild,t)}progress(){return this.progressFn()}optimized(){if(this._isOptimized)return this;let t=this.startChild!=null?this.startChild.optimized():null,r=this.endChild!=null?this.endChild.optimized():null,n=t!=null&&!t.maxBounds.isEmpty(),o=r!=null&&!r.maxBounds.isEmpty();if(!n&&!o)return null;if(n)if(o){if(this.startChild.equals(this.endChild))return this.startChild}else return new pt(t,this.id,4,()=>1-this.progressFn());else return new pt(r,this.id,4,()=>this.progressFn());return this.startChild!=t||this.endChild!=r?new i(t,r,this.id,this.progressFn):(this._isOptimized=!0,this)}equalsWithinBoundsImpl(t,r){let n=t;return this.id==n.id&&this.startChild.equalsWithinBounds(n.startChild,r)&&this.endChild.equalsWithinBounds(n.endChild,r)}},ca;(e=>{function i(t){switch(t){case 0:return"INVERSE_TRANSFORM";case 1:return"TRANSFORM_ISOLATION";case 2:return"TRANSFORM";case 3:return"MAX_TRANSFORM_SCALE";case 4:return"OPACITY";case 5:return"STATE_SWAP";default:throw new Error("Unhandled VolatileProperty value")}}e.VolatileProperty_toString=i})(ca||(ca={}));function ZI(i){let e=0;for(let t of i)for(let r=0,n=t.length;r<n;r=r+1)Ce.hasAnimatingMediaPaints(t[r].paints)&&(e|=16),Ce.hasVolatilePaints(t[r].paints)&&(e|=8);return e}function CA(i,e){if(i.op()==11){let t=i,r=e(t.child);return r==t.child?t:r!=null?new To(r,t.transform):null}else return e(i)}function uu(i){return i.op()==11?i.child:i}function FA(i){if(i.op()==11){let e=i;return new cn(e.child,e.transform)}else if(i.op()==10){let e=i;if(e.property==2)return new cn(e.child,e.transform())}return new cn(i,null)}function RA(i,e){let t=new bt;for(let r of i)t.include3(r.currentBounds(e));return t.isValid()?t.build():V.INVALID}function um(i,e,t,r){if(t==2)return i.currentBounds(r);if(t==4)return e.currentBounds(r);if(bs&&t==3)return i.currentBounds(r);let n=i.currentBounds(r).clone();return n.intersectWith(e.currentBounds(r)),n}function NA(i,e,t){if(e.currentBounds(t).isEmpty())return e.currentBounds(t);let r=e.currentBounds(t).clone();return r.expand1(i),r}function lu(i,e){let t=new bt,r=!1;for(let o=0,a=e.length;o<a;o=o+1){let s=e[o];t.include3(s.maxBounds),s.canBeAnalyticallyAntialiased()&&(r=!0)}if(!t.isValid())return V.INVALID;let n=t.build();return i.transformRect(n),r&&n.expand1(4),n}function jI(i,e,t,r){if(r==0)return lu(i,e);let n=new bt;return n.include3(lu(i,e)),n.include3(lu(i,t)),n.isValid()?n.build():V.INVALID}function $I(i,e){return lu(i,[e])}function eE(i,e){switch(e){case 2:case 0:{let t=V.new2();return t.copyFrom(i.maxBounds),t.expandedBy1(1e6),t}case 4:case 3:case 1:case 5:return i.maxBounds;default:throw new Error(`Unhandled property ${ca.VolatileProperty_toString(e)}`)}}function tE(i,e){return e.transformRect(V.new3(i.maxBounds))}function OA(i,e,t){let r=new bt;return i!=null&&r.include3(i.currentBounds(t)),e!=null&&r.include3(e.currentBounds(t)),r.build()}function wA(i,e){let t=i.currentBounds(e).clone();return t.expand1(1),t}function rE(i){let e=0;for(let t of i)e|=t.flags;return e}function xA(i,e,t){let r=i.flags&-2|e.flags;return t!=0&&t!=4&&t!=1&&(r&=-2),t==2&&(r|=32),r}function nE(i){return i.flags&-2|32}function oE(i){return i.flags&-2}function iE(i,e){let t=e.flags;return i!="PASS_THROUGH"&&(t&=-2,t|=i!="NORMAL"?1:0),t}function aE(i){let e=0;return Ce.hasAnimatingMediaPaints(i.paints)&&(e|=16),(Ce.hasVolatilePaints(i.paints)||i.type==1)&&(e|=8),e}var Ar;(e=>{let i;(s=>(s[s.NON_RENDERABLE=0]="NON_RENDERABLE",s[s.RENDERABLE_GEOMETRY=1]="RENDERABLE_GEOMETRY",s[s.RENDERABLE_TEXT=2]="RENDERABLE_TEXT",s[s.RENDERABLE_GROUP=3]="RENDERABLE_GROUP",s[s.CUSTOM_RENDER_TREE=4]="CUSTOM_RENDER_TREE"))(i=e.RenderableContentType||(e.RenderableContentType={}))})(Ar||(Ar={}));var Ne;(le=>{function i(x,F,q){if(x>le.GEN_DURATION_LOG_THRESHOLD_S){let Z=`${su[F]}${q}`;le._trackingKeys.has(Z)||(De.trackEvent("Slow Render Tree Generation",{duration:x,frameRole:F,callSite:q}),le._trackingKeys.add(Z))}}le._logIfNecessary=i;function e(x,F){let q=new Fa;De.appTimerStart("generateRenderTree");let Z=x.renderTree();return De.appTimerStop("generateRenderTree"),i(q.elapsedSeconds(),1,F),Z}le.renderTreeWithPerfLogging1=e;function t(x,F,q){let Z=new Fa;De.appTimerStart("generateRenderTree");let ie=x.renderTree2(F);return De.appTimerStop("generateRenderTree"),i(Z.elapsedSeconds(),1,q),ie}le.renderTreeWithPerfLogging2=t;function r(x,F,q){let Z=new Fa;De.appTimerStart("generateRenderTree");let ie=x.renderTreeForBaseScreen2(F);return De.appTimerStop("generateRenderTree"),i(Z.elapsedSeconds(),0,q),ie}le.renderTreeForBaseScreenWithPerfLogging=r;function n(x,F,q){let Z=new Fa;De.appTimerStart("generateRenderTree");let ie=x.renderTreeForOverlay(F);return De.appTimerStop("generateRenderTree"),i(Z.elapsedSeconds(),1,q),ie}le.renderTreeForOverlayWithPerfLogging=n;function o(x,F,q){if(q!=null){let ie=x.getCachedRenderTree();if(ie!=null&&(ie.value==null||!q.overlaps(ie.value.maxBounds)))return null}let Z=null;switch(F.mode){case 0:{Z=x.renderTree();break}case 2:{Z=x.renderTreeWithoutBackgroundBlurs();break}case 1:{Z=F.shadowOwnerID==x.uniqueIdentifier()?x.renderTreeForShadowRoot():x.renderTreeForShadowDescendant();break}case 3:{Z=F.shadowOwnerID==x.uniqueIdentifier()?x.renderTreeForKnockoutShadowRoot():x.renderTreeForKnockoutShadowDescendant();break}default:throw new Error(`Unhandled render tree GenerateArgs mode: ${Ut[F.mode]}`)}return q!=null&&(Z==null||!q.overlaps(Z.maxBounds))?null:Z}le._generateRenderTreeForChild=o;function a(x){return x.scrollDirection()!="NONE"&&x.hasOverflowingContentInScrollDirection()}le._nodeCanScroll=a;function s(x,F,q){return X.useBackgroundBlurOpts()?q==null?!0:q.hasVolatileContent()?!1:!U(x,F):!1}le._canSkipWrappingInVolatileTransforms=s;function l(x,F){if(x.isRoot())return F;F=z(F,x);let q=x.indexInParent();if(x.moveToParent(),a(x)&&q<h(x)){let Z=x.clone(),ie=Ct.forScrollOffset(x.uniqueIdentifier());F=pt.forTranslation(F,ie,()=>Z.scrollOffset().negative())}return F=l(x,F),x.moveToChildAt(q),F}le._wrapInVolatileTransformsForAncestors=l;function c(x,F,q,Z,ie,de){return d(x,F,q,Z,ie,de)}le._generateChildrenWithMasking=c;function d(x,F,q,Z,ie,de){let he=a(x),xe=F.clone(),Ee=he?x.clone():null,Ae=[],Ge=[],ze=q,Be=Z;for(;ze<Be;){x.moveToChildAt(ze++);let mt=Ae.length==0||!ce.List_last(Ae).isStandardScrolling(),Fe=x.parent()!=null&&x.isStickyScrolling(),Dt=Ee!=null&&x.isFixed();Fe?(Ae.push(new ae("STICKY_SCROLLS")),ce.List_last(Ae).stickyScrollSceneNodes.push(x.clone())):!Fe&&!Dt&&mt&&Ae.push(new ae("SCROLLS"));let ar=Dt?Ge:ce.List_last(Ae).nodes,Zo=Ee==null||x.isFixed()?ie:null;if(!x.isVisibleMask()){let re=o(x,xe,Zo);re!=null&&ar.push(re),x.moveToParent();continue}let ih=x.maskType(),sy=xe.clone(),sd=o(x,sy,Zo),El=[];x.moveToParent();let ly=h(x);for(;ze<Be;){if(x.moveToChildAt(ze),x.stopsMaskPropagation()||ze==ly){x.moveToParent();break}if(sd!=null){let re=o(x,xe,Zo);re!=null&&El.push(re)}ze=ze+1,x.moveToParent()}sd!=null&&El.length!=0&&(de==0&&ze==Be?ar.push(Xe.wrap(El)):ih=="LUMINANCE"?ar.push(pn.createForLuminanceMask(sd,Xe.wrap(El))):ar.push(new pn(sd,Xe.wrap(El))))}let et=Ae.filter(mt=>mt.nodes.length!=0),Ye=Ct.forScrollOffset(x.uniqueIdentifier()),st=[];for(let mt of et)if(mt.isStandardScrolling())if(Ee!=null){let Fe=u(Ee,Xe.wrap(mt.nodes).optimized());st.push(pt.forTranslation(Fe,Ye,()=>Ee.scrollOffset().negative()))}else Or(st,mt.nodes);else if(mt.isStickyScrolling()){let Fe=[];for(let gr=0,ar=mt.nodes.length;gr<ar;gr=gr+1){let Zo=mt.nodes[gr],ih=mt.stickyScrollSceneNodes[gr];Fe.push(new cn(Zo,ih))}let Dt=Fe.map(gr=>{let ar=gr.a,Zo=gr.b;return pt.forTranslation(ar,Ye,()=>sa.getScrollTranslationOfNodeRelativeToParent2(Zo).negative())});Or(st,Dt)}if(Ge.length!=0){let mt=Xe.wrap(Ge).optimized();st.push(mt)}return new Xe(st).optimized()}le._generateChildrenWithMaskingNew=d;function h(x){for(let F=x.childCount()-1;F>=0;F=F-1){if(x.moveToChildAt(F),!x.isFixed())return x.moveToParent(),F+1;x.moveToParent()}return 0}le._indexOfFirstValidFixedChild=h;function u(x,F){if(F.hasAnimatingMedia()||F.hasVolatileContent()||F.hasBackgroundBlurs()||!F.hasNonIsolatedBlends())return F;let q=Ce.firstPaintIfSolidAndOpaqueOrNull(x.fillPaintsToRender());return q==null?F:Xe.wrapWithSolidBackground(F,q.color())}le._wrapScrollingContentWithSolidBackground=u;function m(x,F,q,Z,ie,de,he){if(X.backgroundBlurBoundsOpt(),F.parent()==null)return null;let xe=F.indexInParent();F.moveToParent();let Ee=g(x,F,q,Z,ie,de,xe,he);return F.moveToChildAt(xe),Ee}le._generateBackground=m;function g(x,F,q,Z,ie,de,he,xe){let Ee=new N(2),Ae=c(F,Ee,0,he,q,0);if(Z!=null){if(a(F)&&he<h(F)){let Be=F.clone(),et=Ct.forScrollOffset(Be.uniqueIdentifier());Z=pt.forTranslation(Z,et,()=>Be.scrollOffset().negative())}Ae==null?Ae=Z:Ae=Xe.wrap([Ae,Z]).optimized()}Ae=Y(Ae,F.clone(),Ee,1,ie);let Ge=!1;F.isFrameLike()&&F.clipsChildren()&&(Ge=Ce.containsAtLeastOneVisibleOpaquePaint(F.fillPaintsToRender()));let ze=X.getViewerMode()==X.ViewerMode.PROTOTYPE&&F.isTopLevel();if(!F.isRoot()&&!Ge&&!ze)Ae=m(Ee,F,q,Ae,ie,de,xe);else{let Be=!xe&&!s(de,F,Ae);Be&&(Ae=l(F,Ae)),Ae!=null&&(Ae=new Xe([Ae,p(de,new N(2))]),M(de)&&Be&&(Ae=pt.forInverseTransform(Ae)))}return Ae}le._generateBackgroundFromParent=g;function _(x,F,q){let Z=null;switch(F){case 1:{Z=x.renderTreeForShadowRoot();break}case 3:{Z=x.renderTreeForKnockoutShadowRoot();break}default:throw new Error(`Unhandled shadow mode: ${Ut[F]}`)}if(Z!=null&&q!=null){if(x.shouldOptimizeShadowForAnimation(q)){let ie=x.clone(),de=ie.absoluteTransform(),he=de.inverse();Z=pt.forTransform(Z,Ct.forShadowTransformation(ie.uniqueIdentifier()),()=>{let xe=ie.absoluteTransform(),Ee=xe.inverse();Ee.multiply(ee.new2().translatedBy1(q)),Ee.multiply(xe);let Ae=ee.new2();return Ae.multiply(de),Ae.multiply(Ee),Ae.multiply(he),Ae})}else{let ie=ee.translated(q.x(),q.y());Z=new To(Z,ie)}Z=Z.optimized()}return Z}le._generateRenderTreeForShadow=_;function f(x,F){if(F.effects()!=null)for(let q=0,Z=F.effects().length;q<Z;q=q+1){let ie=F.effects()[q];if(ie.type()!="INNER_SHADOW"||!ie.isVisibleForRendering())continue;let de=_(F,1,null);if(de!=null){let he=_(F,1,ie.blurOffset());if(he==null)he=new Xe([]);else{if(ie.spread()!=0&&(he=I(he,-ie.spread(),F,ie.type()),he==null))continue;he=new so(he,C.BLACK)}de=new so(de,C.BLACK);let xe=pn.createForInnerShadow(de,new zn(ie.blurRadius(),he,V.INVALID),C.withAlpha(ie.blurColor(),Math.ceil(ie.opacity()*255)|0));xe=new Wn(ie.blendMode(),1,xe),x!=null?x=new Ho(new Xe([x,xe])):x=xe}}return x}le._wrapWithInnerShadows=f;function S(x){let F=x.renderableContentType();if(F!=Ar.RenderableContentType.RENDERABLE_GEOMETRY&&F!=Ar.RenderableContentType.RENDERABLE_TEXT&&F!=Ar.RenderableContentType.RENDERABLE_GROUP||F==Ar.RenderableContentType.RENDERABLE_GROUP&&x.childCount()>0&&!x.clipsChildren())return!1;let q=x.fillPaints(),Z=x.strokePaints(),ie=x.fillGeometry(),de=ie!=null&&ie.regions.length!=0,he=x.strokeGeometry(),xe=he!=null&&he.regions.length!=0,Ee=de&&q!=null&&Ce.containsAtLeastOneVisibleOpaquePaint(q),Ae=!xe||Z==null||Ce.containsAtLeastOneVisibleOpaquePaint(Z);if(F==Ar.RenderableContentType.RENDERABLE_TEXT){let ze=x.textData().styleOverrideTable().styleByID2();for(let Be of Array.from(ze.keys())){let et=ze.get(Be),Ye=hr.get(et,59,null);if(Ye!=null&&!Ce.containsAtLeastOneVisibleOpaquePaint(nt.asPaintData(Ye))){Ee=!1;break}}}return Ee&&(Ae||x.strokeAlign()=="INSIDE")}le._hasOpaqueGeometry=S;function b(x,F,q,Z,ie,de){if(!F.isForShadows()||x.strokeAlign()!="OUTSIDE"&&x.strokeAlign()!="CENTER"||!Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(Z)||!Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(q)||!x.hasDefaultStrokeParameters())return null;let he=x.effects();if(!he)return null;for(let ar=0;ar<he.length;ar++)if(he[ar].type()!="DROP_SHADOW"&&he[ar].isVisibleForRendering())return null;let xe=ie.length==1&&ie[0].path().isRect(),Ee=!1,Ae=null;if(!xe&&(Ae=x.roundedRectInfo(),!(Ae&&Ae.isSimpleRoundedRect())))return null;let Ge=x.strokeAlign()=="OUTSIDE"?2:1,ze=x.strokeAlign()=="OUTSIDE"?1:.5,Be=x.strokeWeight()*Ge,et=x.strokeWeight()*ze,Ye=x.size().withOnesForZeros().add(Be),st=new V(-Be/2,-Be/2,Ye.x(),Ye.y()),mt=Ae&&Ae.nodeRadius()>0?Ae.nodeRadius()+et:Ae&&Ae.vertexRadii().length>0?Ae.vertexRadii()[0]+et:0,Fe=null;if(xe)Fe=new Ft(Ot.fromRect(st),"NONZERO");else{let ar=new Di(1,st.topLeft(),st.size(),[mt,mt,mt,mt],0);Fe=new Ft(Ot.fromRoundedRect(ar),"NONZERO")}let Dt=[];Dt.push(new Qt(Fe,q));let gr=[];return Vt(de,Dt,x.size(),gr),Xe.wrap(gr)}le.attemptToReplaceStrokeWithExpandedFillForDropShadow=b;function T(x,F){let q=x.isInsideOutlineMask(),Z=[],ie=[],de=null,he=Q(F,x,0),xe=Q(F,x,1);if(x.renderableContentType()==Ar.RenderableContentType.RENDERABLE_TEXT)xt(Z,x,he,x.scene(),q,F);else{let Fe=F.mode==3?0:1;$e(Z,x,0,he,x.uniqueIdentifier(),F,Fe)}let Ee=[],Ae;x.containsIndependentBordersStrokeMask()?x.generateStrokeAndStrokeMaskGeometries(ie,Ee,xe):$e(ie,x,1,xe,x.uniqueIdentifier(),F,1);let Ge=x.size().withOnesForZeros(),ze=x.strokeAlign();F.isForShadows()&&ze=="INSIDE"&&Qe(Z)&&Qe(ie)&&(ie.length=0);let Be=x.effects(),et=x.absoluteTransform();if(X.useFastStrokeShadow()){let Fe=b(x,F,he,xe,Z,et);if(Fe)return new se(Fe,de)}if(Ee.length&&(Ae=new yr(et,Ee[0],Ge)),ct(Z)&&ct(ie)&&!F.isForShadows()&&tt(Be)&&!(bs&&qe(Be,"FOREGROUND_BLUR")&&qe(Be,"INNER_SHADOW"))){let Fe=[],Dt=[];Vt(et,Z,Ge,Fe);let gr=f(Xe.wrap(Fe),x);de=new fe(2),Dt.push(gr);let ar=[];return ze=="CENTER"?Vt(et,ie,Ge,ar):Me(ze,et,Z,ie,Ge,ar),new se(K(Dt,ar,Ae),de)}if(ze=="CENTER"||Z.length==0){let Fe=[],Dt=[];return Vt(et,Z,Ge,Fe),Vt(et,ie,Ge,Dt),new se(K(Fe,Dt,Ae),de)}if(he!=null&&xe!=null&&(Ce.isIsolated(he)&&Ce.isIsolated(xe)||F.isForShadows())&&ie.length!=0&&!Ae){let Fe=[],Dt=[];for(let ar of Z)Ce.isEmojiPaint(ar.paints)?Fe.push(ar):Dt.push(ar);let gr=[];return Vt(et,Fe,Ge,gr),gr.push(new ac(et,Dt,ie,Ge,ze=="INSIDE"?0:1)),new se(Xe.wrap(gr),de)}let st=[],mt=[];return Vt(et,Z,Ge,st),Me(ze,et,Z,ie,Ge,mt),new se(K(st,mt,Ae),de)}le._generateRenderTreeForGeometry=T;function y(x,F){if(!x.visible()||x.opacity()<=0&&!(2&x.willChange()))return null;let q=null,Z=0;switch(x.renderableContentType()){case Ar.RenderableContentType.NON_RENDERABLE:return null;case Ar.RenderableContentType.RENDERABLE_GEOMETRY:case Ar.RenderableContentType.RENDERABLE_TEXT:{let ie=T(x,F);q=ie.node,ie.layerWrap!=null&&(Z=ie.layerWrap.value);break}case Ar.RenderableContentType.RENDERABLE_GROUP:{!(F.isForShadows()&&x.clipsChildren()&&Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(x.fillPaintsToRender()))&&(q=c(x,F,0,x.childCount(),null,1));break}case Ar.RenderableContentType.CUSTOM_RENDER_TREE:{Z=2,q=x.customRenderTree(F);break}}return Y(q,x,F,Z,0)}le.generateRenderTree=y;function I(x,F,q,Z){if(!q.isSpreadEligibleNode())return x;if(x.op()==10){let Fe=x,Dt=I(Fe.child,F,q,Z);return Dt==null?null:new pt(Dt,Fe.id,Fe.property,Fe.getter)}else if(x.op()==11){let Fe=x,Dt=I(Fe.child,F,q,Z);return Dt==null?null:new To(Dt,Fe.transform)}else if(x.op()==2){let Dt=I(x.child,F,q,Z);return Dt==null?null:new Ho(Dt)}else if(x.op()==12){let Fe=x,Dt=Fe.startChild!=null?I(Fe.startChild,F,q,Z):null,gr=Fe.endChild!=null?I(Fe.endChild,F,q,Z):null;return Dt!=null||gr!=null?new en(Dt,gr,Fe.id,Fe.progressFn):null}let ie=q.fillGeometry()!=null&&q.fillGeometry().regions.length!=0&&Ce.containsAtLeastOneVisiblePaint(q.fillPaints()),de=q.strokeGeometry()!=null&&q.strokeGeometry().regions.length!=0&&Ce.containsAtLeastOneVisiblePaint(q.strokePaints()),he=ie&&!de,xe=!ie&&de,Ee=null,Ae=x,Ge=()=>{De.trackEvent("unexpected_spread_shadow_node",{sceneNode:q.paintsDebugString(),renderNode:x.debugString1()})};for(;Ee==null;)switch(Ae.op()){case 3:case 4:{Ee=Ae;break}case 5:{Ae=Ae.alpha;break}case 7:{Ae=Ae.child;break}case 1:{let Fe=null;br.visitEachNodeInTree(Ae,Dt=>{(Dt.op()==3||Dt.op()==4)&&(Fe==null||br.geometryNodePaintSize(Dt).area()>br.geometryNodePaintSize(Fe).area())&&(Fe=Dt)},null),Ae=Fe;break}case 0:{Ae=Ae.child,Ge();break}case 9:{Ae=Ae.alpha,Ge();break}case 6:{Ae=Ae.child,Ge();break}default:return Ge(),Le("Unexpected wrapped node for spread shadow"),x}if(Ee==null||Ee.op()!=3&&Ee.op()!=4)return Le(`Failed to find geometryNode after search; got ${un[Ee.op()]}`),x;let ze=null,Be=null,et=null;switch(Ee.op()){case 3:{let Fe=Ee;ze=Be=Fe.paintSize,et=Fe.transform;break}case 4:{let Fe=Ee;ze=Be=Fe.paintSize,et=Fe.transform;break}default:return Le(`Unexpected node type ${un[Ee.op()]}`),x}if(de&&q.strokeAlign()!="INSIDE"){let Fe=q.strokeAlign()=="OUTSIDE"?2:1;ze=ze.add(q.strokeWeight()*Fe)}if(Z=="DROP_SHADOW"){if(ze.x()<=-(2*F)||ze.y()<=-(2*F))return null}else Z=="INNER_SHADOW"&&(F=Math.max(F,-Math.min(ze.x(),ze.y())/2));let Ye=Be.add(2*F),st=Ye.divide1(Be),mt=ee.new2().translatedBy2(-F,-F).scaledBy1(st);if(he){let Fe=q.fillGeometryForSpread(mt,F,Ce.SOLID_BLACK);return new yr(et,Fe,Ye)}else if(xe){let Fe=q.strokeGeometryForSpread(mt,F,Be,Ce.SOLID_BLACK);if(Fe==null){if(Z=="DROP_SHADOW")return null;Fe=new Qt(new Ft(Ot.fromRect(Br.FrozenRect_EMPTY),"NONZERO"),Ce.SOLID_BLACK)}return new yr(et,Fe,Ye)}else{let Fe=q.strokeGeometryForSpread(mt,F,Be,Ce.SOLID_BLACK);return Fe==null?null:new yr(et,Fe,Ye)}}le._blurChildWithSpread=I;function p(x,F){let q=[];for(let Z=0,ie=x.effects().length;Z<ie;Z=Z+1){let de=x.effects()[Z];if(de.type()=="DROP_SHADOW"&&de.isVisibleForRendering()){if(F.mode==2&&!de.showShadowBehindNode())continue;let he=_(x,1,de.blurOffset());if(he!=null){if(de.spread()!=0&&(he=I(he,de.spread(),x,de.type()),he==null))continue;let xe=new so(he,C.multiplyOpacity(de.blurColor(),de.opacity())),Ee=null,Ae=xe.optimized();if(Ae!=null&&(Ee=new zn(de.blurRadius(),new Ho(Ae),V.INVALID)),Ee!=null&&!de.showShadowBehindNode()&&!S(x)){let Ge=_(x,3,null);Ee=new Ho(pn.createForKnockoutShadow(Ge,Ee))}Ee!=null&&q.push(new Wn(de.blendMode(),1,Ee))}}}return new Xe(q)}le._dropShadowsForNode=p;function A(x){let F=x.parent();if(F==null)return x.absoluteTransform();let q=F.absoluteTransform().clone();return q.invert()?(q.multiply(x.absoluteTransform()),q):ee.new2()}le._transformRelativeToParent=A;function v(x,F,q,Z,ie,de){let he=F.size(),xe=Z>0&&F.clipsChildren()&&q!=0,Ee=null,Ae=null,Ge=Q(de,F,0);de.isForShadows()&&Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(Ge)&&(Ge=vt(1)),Ce.forEachPaintWithVideo(Ge,et=>{let Ye=et.video().getVideoManager();Ye!=null&&Ye.associatePaintWithNode(et,F)});let ze=F.absoluteTransform(),Be=[];if(xe){Ee=Ft.getOrCreate(Ot.fromRect(V.new4(ye.FrozenVector_ZERO,he).expandedBy1(Z)),"ODD");let et=Ce.isolatedPaints(Ge);for(let Ye=0,st=et.length;Ye<st;Ye=Ye+1)ie.push(new Qt(Ee,et[Ye]))}else if(F.fillGeometry()!=null&&F.fillGeometry().regions.length!=0)$e(ie,F,0,Ge,F.uniqueIdentifier(),de,1);else if(Tt(0,F)){Ae=Ft.getOrCreate(Ot.fromRect(V.new4(ye.FrozenVector_ZERO,he)),"ODD");let et=Ce.isolatedPaints(Ge);for(let Ye=0,st=et.length;Ye<st;Ye=Ye+1)ie.push(new Qt(Ae,et[Ye]))}if(Vt(ze,ie,he,Be),!F.clipsChildren()){let et=[],Ye=[],st,mt=Q(de,F,1);F.containsIndependentBordersStrokeMask()?F.generateStrokeAndStrokeMaskGeometries(et,Ye,mt):$e(et,F,1,mt,F.uniqueIdentifier(),de,1),Ye.length&&(st=new yr(ze,Ye[0],he));let Fe=[];F.strokeAlign()=="CENTER"||ie.length==0?Vt(ze,et,he,Fe):Me(F.strokeAlign(),ze,ie,et,he,Fe),Be.push(K([],Fe,st))}return x!=null&&Be.push(x),x=Xe.wrap(Be),x}le._wrapTreeWithFrameFillPaints=v;function E(x,F,q,Z,ie){let de=F.size(),he=Z>0&&F.clipsChildren()&&q!=0,xe=null,Ee=null,Ae=F.absoluteTransform();if(he?xe=Ft.getOrCreate(Ot.fromRect(V.new4(ye.FrozenVector_ZERO,de).expandedBy1(Z)),"ODD"):Ee=Ft.getOrCreate(Ot.fromRect(V.new4(ye.FrozenVector_ZERO,de)),"ODD"),F.clipsChildren()){let Ge=[],ze=[];he?Ge.push(new Qt(xe,vt(1))):F.fillGeometry()!=null&&F.fillGeometry().regions.length!=0?$e(Ge,F,0,vt(1),F.uniqueIdentifier(),ie,1):Ge.push(new Qt(Ee,vt(1))),Vt(Ae,Ge,de,ze),x=new pn(Xe.wrap(ze),x)}return x}le._wrapTreeWithFrameMasks=E;function D(x){return x.containerSupportsFillStrokeAndCorners()?x.fillPaints():x.fillPaintsToRender()}le._fillPaintsToRender=D;function G(x,F,q,Z){let ie=F.size();if(!ie.isZero()){let de=null,he=F.clipsChildren(),xe=D(F);if(Ce.containsAtLeastOneVisiblePaint(xe)){let Ee=[],Ae=[],Ge=null;q.isForShadows()&&Ce.containsAtLeastOneVisibleNotFullyTransparentPaint(xe)?Ge=vt(1):Ge=j(q,xe,0),de=Ft.getOrCreate(Ot.fromRect(V.new4(ye.FrozenVector_ZERO,ie).expandedBy1(he?Z:0)),"ODD");let ze=Ce.isolatedPaints(Ge);for(let Be=0,et=ze.length;Be<et;Be=Be+1){let Ye=ze[Be];Ee.push(new Qt(de,Ye))}Vt(F.absoluteTransform(),Ee,ie,Ae),x!=null&&Ae.push(x),x=Xe.wrap(Ae)}if(x!=null&&he){de==null&&(de=Ft.getOrCreate(Ot.fromRect(V.new4(ye.FrozenVector_ZERO,ie).expandedBy1(Z)),"ODD"));let Ee=new Qt(de,vt(1));x=new pn(new yr(F.absoluteTransform(),Ee,ie),x)}}return x}le._wrapTreeWithFrameBackgroundOrFillIgnoringGeometry=G;function U(x,F){let q=x.clone(),Z=q.parent(),ie=!0;for(;q!=null;){if(F!=null&&q.uniqueIdentifier()==F.uniqueIdentifier())return!1;if(1&q.willChange()||q.overlayRenderData()!=null)return!0;if(Z==null||F!=null&&Z.uniqueIdentifier()==F.uniqueIdentifier())return!1;if(!ie){let de=q.indexInParent();if(a(Z)&&de<h(Z))return!0}ie=!1,q=Z,Z=Z.parent()}return!1}le._hasVolatileTransformOnAncestor=U;function M(x){return X.useBackgroundBlurOpts()?U(x,null):!0}le._needInverseTransform=M;function z(x,F){if(1&F.willChange()){let q=Nt.FrozenAffineTransform_IDENTITY,Z=F.parent();Z!=null&&(q=Z.absoluteTransform());let ie=F.absoluteTransform().clone(),de=ie.invert(),he=F.clone();x=pt.forTransform(x,Ct.forAnimateableTranslation(F.uniqueIdentifier()),()=>{let Ee=ee.new2();return Ee.multiply(q),Ee.multiply(A(he)),Ee.multiply(ie),Ee});let xe=F.maxTransformScale();xe!=1&&(x=pt.forMaxTransformScale(xe,x))}return x}le._wrapTreeInVolatileTransform=z;function B(x,F){if(x.backgroundAppearance.backgroundType=="NONE")return null;let q=Ue(x.backgroundAppearance,F.scene().findNode(F.overrideKey()).canvasSpaceBoundingBox());return q!=null?(x.backgroundTransitionProgress!=null&&(q=pt.forOpacity(q,Ct.OVERLAY_BACKGROUND,x.backgroundTransitionProgress)),pt.forInverseTransform(q)):null}le._generateRenderTreeForOverlayBackground=B;function w(x,F,q){let Z=[];for(let ie=0,de=x.count();ie<de;ie=ie+1){let he=x.keys()[ie];if(he==F)break;let xe=x.get(he),Ee=xe.overlayNode,Ae=B(xe,q.clone()),Ge=Ee.renderTreeWithoutBackgroundBlurs();if(Ae!=null&&Z.push(Ae),Ge!=null){let ze=xe.bounds.center(),Be=Ee.canvasSpaceBoundingBox().center(),et=ze.subtract1(Be),Ye=mt=>()=>mt,st=pt.forInverseTransform(pt.forTranslation(Ge,Ct.forOverlayPosition(ie),Ye(et)));Z.push(st)}}return new Xe(Z)}le._generateIntermediateOverlays=w;function P(x,F,q,Z,ie){let de=V.new2();de.copyFrom(x.bounds);let he=x.baseTlfCursor.clone(),xe=F.overlayRenderData(),Ee=[],Ae=g(Z,he.clone(),de,null,ie,F.clone(),he.childCount(),!1);Ae!=null&&Ee.push(Ae);let Ge=w(xe,x.overlayId,he.clone());Ge!=null&&Ee.push(Ge);let ze=B(x,he);ze!=null&&Ee.push(ze);let Be=null;return x.overlayId!=F.uniqueIdentifier()&&(Be=m(Z,F,q,null,ie,F.clone(),!0),Be!=null&&(Be=pt.forInverseTransform(pt.forTranslation(Be,Ct.ENTERING_OVERLAY,()=>(x.transform!=null?x.transform():ye.FrozenVector_new4(0,0)).add1(x.animationTransform!=null?x.animationTransform():ye.FrozenVector_new4(0,0)))))),Be!=null&&Ee.push(Be),new Xe(Ee)}le._generateBackgroundBlurForOverlays=P;function H(x,F,q,Z){let ie=_(x,1,null);if(ie!=null){let de=null,he=null;if(Lt.didEncounterBackgroundBlurBoundsOpt(),X.backgroundBlurBoundsOpt()&&(de=V.new2(),de.copyFrom(ie.maxBounds)),x.overlayRenderData()!=null){let xe=x.clone(),Ee=null,Ae=x.overlayRenderData();for(;xe!=null&&(Ee=Ae.get(xe.uniqueIdentifier()),Ee==null);)xe=xe.parent();if(xe==null||Ee==null)return Le("Blurred node with overlay data cannot be found in an overlay"),F;de=V.new2(),de.copyFrom(Ee.bounds),he=P(Ee,x.clone(),ie.maxBounds,q,Z)}else he=m(q,x,de,null,Z,x.clone(),!1);if(he!=null){let xe=null,Ee=uu(ie),Ae=Ee.op()==3?Ee:null;Ae!=null&&Ae.geometry.type==ti.PaintedGeometryType.STATIC?xe=Ae.geometryBounds():xe=ie.maxBounds;let Ge=new zn(Z,he,xe),ze=pn.createForBackgroundBlur(ie,Ge);F=new Xe([ze,F])}F=la.createForBackgroundBlur(F)}return F}le._generateBackgroundBlur=H;function Q(x,F,q){let Z=F.isInsideOutlineMask(),ie=q==0?F.fillPaints():F.strokePaints(),de=ie!=null&&Ce.containsAtLeastOneVisiblePaint(ie);return Z?vt(de?1:0):j(x,ie,q)}le._getFinalizedPaintData=Q;function Y(x,F,q,Z,ie){let de=[],he=Z==0&&F.isFrameLike()&&F.containerSupportsFillStrokeAndCorners()&&!F.isGroup()&&F.clipsChildren(),xe=F.isFrameLike()&&!F.size().isZero(),Ee=F.overlayRenderData()==null&&F.isTopLevel()&&F.isFrameLike()&&Ce.containsAtLeastOneVisibleOpaquePaint(F.fillPaintsToRender())||F.type()==="SLIDE",Ae=!F.containerSupportsFillStrokeAndCorners()||F.isGroup(),Ge=xe&&!Ae;xe&&(Ae?x=G(x,F,q,ie):x=v(x,F,Z,ie,de,q)),x!=null&&(x=x.optimized());let ze=!q.isForShadows()&&F.effects()!=null,Be=[];if(ze)if(x!=null){if(q.mode==0)for(let st=0,mt=F.effects().length;st<mt;st=st+1){let Fe=F.effects()[st];if(Fe.type()=="BACKGROUND_BLUR"){Fe.isVisibleForRendering()&&!S(F)&&(x=H(F,x,q,Fe.blurRadius()));break}}(Z==1||Z==0)&&(x=f(x,F)),Ee||Be.push(p(F,q))}else Ee||Be.push(p(F,q));if(x==null&&Be.length==0&&!he)return x;let et=he&&F.strokeAlign()=="INSIDE";if(Ge&&!et&&x!=null&&(x=E(x,F,Z,ie,q)),he&&!kt(F,q,de)){let st=F.absoluteTransform(),mt=[],Fe=[],Dt=Q(q,F,1),gr=[],ar;x!=null&&gr.push(x),F.containsIndependentBordersStrokeMask()?F.generateStrokeAndStrokeMaskGeometries(mt,Fe,Dt):$e(mt,F,1,Dt,F.uniqueIdentifier(),q,1),Fe.length&&(ar=new yr(st,Fe[0],F.size()));let Zo=[];F.strokeAlign()=="CENTER"||de.length==0||et?Vt(st,mt,F.size(),Zo):Me(F.strokeAlign(),st,de,mt,F.size(),Zo),x=K(gr,Zo,ar)}else et=!1;if(he&&F.strokeAlign()=="OUTSIDE"&&F.clipsChildren()&&(x=Ho.thatShouldNotBeUnwrappedInOptimization(x)),Ge&&et&&x!=null&&(x=E(x,F,Z,ie,q)),x!=null?x=new Xe([new Xe(Be),x]):x=new Xe(Be),x!=null&&ze)for(let st=0,mt=F.effects().length;st<mt;st=st+1){let Fe=F.effects()[st];if(Fe.type()=="FOREGROUND_BLUR"){Fe.isVisibleForRendering()&&(x=new zn(Fe.blurRadius(),x,V.INVALID));break}}if(q.isForShadows()&&q.shadowOwnerID==F.uniqueIdentifier())return x.optimized();let Ye=2&F.willChange()?1:F.opacity();if(x=new Wn(F.blendMode(),Ye,x),x=x.optimized(),x!=null&&2&F.willChange()){let st=F.clone();x=new pt(x,Ct.forAnimateableOpacity(st.uniqueIdentifier()),4,()=>st.opacity())}return x!=null&&(x=z(x,F)),x}le._wrapTreeWithLayerProperties=Y;function ne(x){if(x==null)return null;let F=!1;for(let Z=0,ie=x.length;Z<ie;Z=Z+1){let de=x[Z].asVolatilePaint();if(de!=null){if(de.from().image()!=null&&de.from().image().isDecoded()||de.from().imageThumbnail()!=null&&de.from().imageThumbnail().isDecoded()||de.to().image()!=null&&de.to().image().isDecoded()||de.to().imageThumbnail()!=null&&de.to().imageThumbnail().isDecoded()){F=!0;break}}else if(x[Z].asSinglePaint()!=null){let he=x[Z].asSinglePaint();if(he.image()!=null&&he.image().isDecoded()||he.imageThumbnail()!=null&&he.imageThumbnail().isDecoded()){F=!0;break}}if(!x[Z].isEnabledAndVisible()){F=!0;break}}if(!F)return x;let q=[];for(let Z=0,ie=x.length;Z<ie;Z=Z+1){if(!x[Z].isEnabledAndVisible())continue;let de=x[Z].asVolatilePaint();if(de!=null){let he=de.cloneAsVolatilePaint();he.from().setDecodedImageIsReady(he.from().image()!=null&&he.from().image().isDecoded()),he.to().setDecodedImageIsReady(he.to().image()!=null&&he.to().image().isDecoded()),he.from().setDecodedImageThumbnailIsReady(he.from().imageThumbnail()!=null&&he.from().imageThumbnail().isDecoded()),he.to().setDecodedImageThumbnailIsReady(he.to().imageThumbnail()!=null&&he.to().imageThumbnail().isDecoded()),q.push(he)}else if(x[Z].asSinglePaint()!=null){let he=x[Z].asSinglePaint().cloneAsSinglePaint();he.setDecodedImageIsReady(he.image()!=null&&he.image().isDecoded()),he.setDecodedImageThumbnailIsReady(he.imageThumbnail()!=null&&he.imageThumbnail().isDecoded()),q.push(he)}}return q}le._filteredPaintsWithImageAvailability=ne;function W(x,F,q){if(x!=3||q==1&&F.length==0)return F;let Z=[];for(let ie=0,de=F.length;ie<de;ie=ie+1){let he=F[ie];if(he.type()=="IMAGE"||he.type()=="EMOJI"||he.type()=="VIDEO")Z.push(he);else return[te.createSolid(C.BLACK,1)]}return Z.length==0&&Z.push(te.SOLID_BLACK),Z}le._filteredPaintsForKnockoutShadow=W;function K(x,F,q){return q?(x.push(new pn(q,new Xe(F))),new Xe(x)):new Xe(x.concat(F))}le.wrapFillsStrokesAndStrokeMasks=K;function j(x,F,q){return W(x.mode,ne(F),q)}le._substitutePaintsAsNeeded=j;function ge(x,F,q,Z,ie,de){if(J.equals(F.overrideKey(),J._new(4e7,2)))return!1;let xe=F.strokeGeometry()!=null&&F.strokeGeometry().regions.length!=0&&Ce.containsAtLeastOneVisiblePaint(F.strokePaints());if(Z!=0||xe&&!pe(F,de,ie))return!1;for(let Ee of q.regions)if(Ee.type==1)return!1;switch(F.type()){case"ELLIPSE":{if(F.arcData()==null||Ce.hasEmoji(ie))return!1;let Ee=F.arcData(),Ae=Ee.innerRadius<=0,Ge=Ee.endingAngle-Ee.startingAngle,ze=Math.abs(Ge)>2*Math.PI-.001,Be=F.size().withOnesForZeros();if(Ae&&ze&&q.regions.length==1&&q.regions[0].type==0){let Ye=Be.divide(2),st=new Bi(Ye,Ye.x(),Ye.y()),mt=new Ft(st,"NONZERO"),Fe=Ce.isolatedPaints(ie);for(let Dt=0,gr=Fe.length;Dt<gr;Dt=Dt+1){let ar=Fe[Dt];x.push(new Qt(mt,ar))}return!0}break}case"RECTANGLE":case"ROUNDED_RECTANGLE":case"FRAME":case"STAMP":case"SYMBOL":case"INSTANCE":{let Ee=F.roundedRectInfo();if(!Ot.isRoundedRectSupported(Ee))return!1;let Ae=Ot.fromRoundedRect(Ee),Ge=new Ft(Ae,"NONZERO"),ze=Ce.isolatedPaints(ie);for(let Be=0,et=ze.length;Be<et;Be=Be+1){let Ye=ze[Be];x.push(new Qt(Ge,Ye))}return!0}}return!1}le._attemptToGenerateAAAGeometry=ge;function Ue(x,F){switch(x.backgroundType){case"NONE":return null;case"SOLID_COLOR":{if(F==null)return null;let q=x.backgroundColor,Z=1;return yr.solidColorRect(F,q,Z)}}throw new Error(`Unhandled backgroundType ${x.backgroundType}`)}le.renderTreeForOverlayBackground=Ue;function Tt(x,F){if(x==0){let q=F.fillPaints(),Z=F!=null&&F.clipsChildren();return F!=null&&(Z||Ce.containsAtLeastOneVisiblePaint(q)||F.strokeAlign()!="CENTER"&&Tt(1,F))}else if(x==1){let q=F.strokePaints();return Ce.containsAtLeastOneVisiblePaint(q)&&F.hasNonZeroStrokeWeight()}return!1}le._isGeometryNecessary=Tt;function $e(x,F,q,Z,ie,de,he){let xe=q==0?F.fillGeometry():F.strokeGeometry();if(q==0&&he==1&&!Tt(q,F)&&(xe=null),xe==null||Z==null)return;if(Ce.forEachPaintWithVideo(Z,Ae=>{let Ge=Ae.video().getVideoManager();Ge!=null&&Ge.associatePaintWithNode(Ae,F)}),F.hasPerRegionFillPaints()&&q==0){F.forEachRegionWithFillPaintBatch((Ae,Ge)=>{let ze=Ce.isolatedPaints(Ge);for(let Be=0,et=ze.length;Be<et;Be=Be+1){let Ye=ne(ze[Be]);Ce.forEachPaintWithVideo(Ye,mt=>{let Fe=mt.video().getVideoManager();Fe!=null&&Fe.associatePaintWithNode(mt,F)});let st=Ft.getOrCreate(Ae.path(),Ae.windingRule);x.push(new Qt(st,Ye))}});return}if(ge(x,F,xe,q,Z,de))return;let Ee=Ce.isolatedPaints(Z);for(let Ae=0,Ge=Ee.length;Ae<Ge;Ae=Ae+1){let ze=Ee[Ae],Be=null,et=()=>{if(Be!=null){let Ye=Be.compilePaths(),st=Ft.getOrCreate(Ye,Be.windingRule);x.push(new Qt(st,ze)),Be=null}};for(let Ye of xe.regions)Ye.bounds().isEmpty()||(Ye.type==0?Be!=null&&Be.canAddRegion(Ye)?Be.add(Ye):(et(),Be=new ve(Ye)):(et(),x.push(new Ms(()=>new Ft(Ye.path(),Ye.windingRule),ze,Ye.bounds(),Ct.forDynamicGeometry(ie)))));et()}}le._generateGeometries=$e;function xt(x,F,q,Z,ie,de){let he=F.textGeometry();if(he==null||q==null)return;let xe=Ae=>{var Be,et;let Ge=Mr.getEmojiImageUrl(Ae),ze=((Be=F.derivedTextData())==null?void 0:Be.usedEmojiImages())??((et=F.textData())==null?void 0:et.usedEmojiImagesDEPRECATED());for(let Ye of ze)if(Ye.url()==Ge){let st=new te("EMOJI");return st.setOpacity(1),st.setBlendMode("NORMAL"),st.setImage(Ye),j(de,[st],0)}return null},Ee=Ae=>{let Ge=he.paintOverrides.get(Ae,Z);return Ge!=null?j(de,Ge,0):j(de,q,0)};for(let Ae=0,Ge=he.regions.length;Ae<Ge;Ae=Ae+1){let ze=he.regions[Ae];if(he.emojiCodepoints[Ae].length>0){let Ye=Ft.getOrCreate(ze.path(),ze.windingRule),st=xe(he.emojiCodepoints[Ae]);if(st==null)continue;x.push(new Qt(Ye,st));continue}let Be=Ee(ze.styleID);if(Be==null)continue;for(let Ye=0,st=Be.length;Ye<st;Ye=Ye+1){let mt=Be[Ye].asSinglePaint();(mt==null?void 0:mt.video())!=null&&mt.video().getVideoManager().associatePaintWithNode(mt,F)}let et=Ce.isolatedPaints(Be);for(let Ye=0,st=et.length;Ye<st;Ye=Ye+1){let mt=et[Ye];if(!ze.bounds().isEmpty()){let Fe=Ft.getOrCreate(ze.path(),ze.windingRule);x.push(new Qt(Fe,mt))}}}}le._generateGeometriesForText=xt;function Vt(x,F,q,Z){for(let ie=0,de=F.length;ie<de;ie=ie+1){let he=F[ie];if(Ce.containsAtLeastOneVisiblePaint(he.paints)){let xe=new yr(x,he,q),Ee=he.paints;Ee.length!=0&&Ee[0].blendMode()!="NORMAL"?Z.push(new Wn(Ee[0].blendMode(),1,xe)):Z.push(xe)}}}le._generateFills=Vt;function kt(x,F,q){if(F.mode!=1||x.strokeAlign()!="INSIDE")return!1;for(let Z=0,ie=q.length;Z<ie;Z=Z+1){let de=q[Z];if(Ce.containsAtLeastOneVisibleOpaquePaint(de.paints))return!0}return!1}le._canSkipInsideStrokesForShadows1=kt;function pe(x,F,q){return F.mode!=1||x.strokeAlign()!="INSIDE"?!1:Ce.containsAtLeastOneVisibleOpaquePaint(q)}le._canSkipInsideStrokesForShadows2=pe;function Me(x,F,q,Z,ie,de){let he=[];for(let xe=0,Ee=q.length;xe<Ee;xe=xe+1){let Ae=q[xe];he.push(new Qt(Ae.path(),Ce.EMPTY))}for(let xe=0,Ee=Z.length;xe<Ee;xe=xe+1){let Ae=Z[xe],Ge=Ae.paints,ze=[Ae],Be=new ac(F,he,ze,ie,x=="INSIDE"?0:1);Ge.length!=0&&de.push(new Wn(Ge[0].blendMode(),1,Be))}}le._generateFillStrokes=Me;function vt(x){return x==1?Ce.SOLID_BLACK:Ce.EMPTY}le._outlineMaskPaintData=vt;function ct(x){for(let F=0,q=x.length;F<q;F=F+1){let Z=x[F];if(Ce.containsAtLeastOneVisiblePaint(Z.paints))return!0}return!1}le._isAnyGeometryVisible=ct;function qe(x,F){for(let q=0,Z=x.length;q<Z;q=q+1){let ie=x[q];if(ie.type()==F&&ie.isEnabledAndVisible())return!0}return!1}le._hasVisibleEffectsOfType=qe;function tt(x){for(let F=0,q=x.length;F<q;F=F+1)if(x[F].isEnabledAndVisible())return!0;return!1}le._hasVisibleEffects=tt;function Qe(x){if(x.length!=1)return!1;let F=x[0].paints;return F.length==1&&F[0].type()=="SOLID"}le._isSingleSolidGeometry=Qe;function Rt(){return le._flushBeforeMasks}le.flushBeforeMasks=Rt;function Et(x){le._flushBeforeMasks=x}le.setFlushBeforeMasks=Et;let Ut;(ie=>(ie[ie.NORMAL=0]="NORMAL",ie[ie.SHADOW=1]="SHADOW",ie[ie.WITHOUT_BACKGROUND_BLURS=2]="WITHOUT_BACKGROUND_BLURS",ie[ie.KNOCKOUT_SHADOW=3]="KNOCKOUT_SHADOW"))(Ut=le.RenderMode||(le.RenderMode={}));let dt;(q=>(q[q.INCLUDE=0]="INCLUDE",q[q.IGNORE=1]="IGNORE"))(dt=le.IncludeUnnecessaryGeometry||(le.IncludeUnnecessaryGeometry={}));class N{constructor(F,q=null){this.mode=F,this.shadowOwnerID=q}clone(){return new N(this.mode,this.shadowOwnerID)}isForShadows(){return this.mode==1||this.mode==3}}le.GenerateArgs=N;let k;(q=>(q[q.FILL=0]="FILL",q[q.STROKE=1]="STROKE"))(k=le.GeometryType||(le.GeometryType={}));let $;(q=>(q[q.IGNORE=0]="IGNORE",q[q.INCLUDE=1]="INCLUDE"))($=le.LastMask||(le.LastMask={}));class ae{constructor(F){this.nodes=null,this.scrollBehavior=null,this.stickyScrollSceneNodes=null,this.stickyScrollNodeStartingTopBounds_DEPRECATED=null,this.nodes=[],this.scrollBehavior=F,this.stickyScrollSceneNodes=[],this.stickyScrollNodeStartingTopBounds_DEPRECATED=[]}isFixed(){return this.scrollBehavior=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"}isStickyScrolling(){return this.scrollBehavior=="STICKY_SCROLLS"}isStandardScrolling(){return this.scrollBehavior=="SCROLLS"}}le.ContiguousRenderNodes=ae;class se{constructor(F,q){this.node=F,this.layerWrap=q}}le.GeometryRenderTreeResult=se;let Re;(Z=>(Z[Z.WITH_INNER_SHADOWS_AND_TOP_STROKE=0]="WITH_INNER_SHADOWS_AND_TOP_STROKE",Z[Z.WITH_INNER_SHADOWS_ONLY=1]="WITH_INNER_SHADOWS_ONLY",Z[Z.WITHOUT_LAYER_WRAPS=2]="WITHOUT_LAYER_WRAPS"))(Re=le.LayerWrap||(le.LayerWrap={}));let Pe;(q=>(q[q.FILL_PAINT_DATA=0]="FILL_PAINT_DATA",q[q.STROKE_PAINT_DATA=1]="STROKE_PAINT_DATA"))(Pe=le.PaintType||(le.PaintType={}));class we{constructor(F){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.minX=F.left(),this.maxX=F.right(),this.minY=F.top(),this.maxY=F.bottom()}}le.RBushRect=we;class ve{constructor(F){this.windingRule=null,this._uniquePathsOnly=!1,this._collisionTracker=new LA.default,this._paths=[],this.windingRule=F.windingRule,this._uniquePathsOnly=F.path()instanceof io,this.add(F)}compilePaths(){if(this._paths.length==1)return this._paths[0];if(this._uniquePathsOnly){let q=[];for(let de of this._paths)q.push(de.handle);let Z=L().modules().uniquePathHelpers.getVolatileConcatenatedPaths(q),ie=new Uint8Array(Z);return new Ze(new on(ie))}let F=this._paths[0].toBezierPath().getMutableClone();for(let q=1,Z=this._paths.length;q<Z;q=q+1)F.append(this._paths[q].toBezierPath());return F}canAddRegion(F){return F.windingRule==this.windingRule&&this._uniquePathsOnly==F.path()instanceof io&&!this._collisionTracker.collides(new we(F.path().bounds()))}add(F){this._paths.push(F.path()),this._collisionTracker.insert(new we(F.path().bounds()))}}le.PathBatch=ve;let Ke;(q=>(q[q.ALL_PAINTS_INVISIBLE=0]="ALL_PAINTS_INVISIBLE",q[q.HAS_VISIBLE_PAINTS=1]="HAS_VISIBLE_PAINTS"))(Ke=le.PaintVisibility||(le.PaintVisibility={})),le.GEN_DURATION_LOG_THRESHOLD_S=.15,le._trackingKeys=new Set,le._flushBeforeMasks=!1})(Ne||(Ne={}));var Bs=class{constructor(e,t){this.type=e,this.interruptIndex=t}},pu=class extends Bs{constructor(t,r,n,o){super(3,0);this.node=t,this.transform=r,this.canvasSpaceTileBounds=n,this.inverseVolatileTransform=o}},hu=class extends Bs{constructor(t){super(2,0);this.scissor=t}},mu=class extends Bs{constructor(t,r,n,o,a){super(4,0);this.blendIsNoOp=t,this.node=r,this.transform=n,this.canvasSpaceTileBounds=o,this.inverseVolatileTransform=a}},Si=class extends Bs{constructor(t,r,n,o,a){super(1,a);this.node=t,this.transform=r,this.canvasSpaceTilebounds=n,this.inverseVolatileTransform=o}};var Vs=class Vs{texture(e){return this._texture==null&&(this._texture=e.createTextureWithPixels(O.TextureFormat.RGBA_LINEAR_CLAMP,Vs.WIDTH,Vs.HEIGHT,this.pixels,"GradientData")),this._texture}totalVRAM(){return this._texture!=null?O.in_Texture.Texture_totalVRAM(this._texture):0}constructor(e){this.pixels=e,this._texture=null}};Vs.WIDTH=1024,Vs.HEIGHT=2;var da=Vs,sc=class i{constructor(){this._table=null;let e=new no;this._table=new fi(t=>i._hashGradient(e,t),(t,r)=>t.equals2(r),t=>i._evaluateGradient(t))}allocate(e){return this._table.getOrInsertFallback(e)}totalVRAM(){let e=0;return this._table.each((t,r)=>{e=e+r.totalVRAM()}),e}static _hashGradient(e,t){let r=t.colorStops(),n=r.length;e.hash2(Ya.shouldWrap(t.type())?1:0),e.hash2(n);for(let o=0,a=n;o<a;o=o+1){let s=r[o];e.hash2(s.color),e.hash1(s.position)}return e.value()}static _evaluateGradient(e){let t=new Uint8Array(da.WIDTH*da.HEIGHT*4),r=e.flattenedStops(),n=r.length;if(n!=0){let o=1,a=r[0],s=a,l=0;for(let c=0;c<da.WIDTH;c=c+1){let d=c/(da.WIDTH-1);for(;a.position<d&&o<n;)s=a,a=r[o],o=o+1;let h=s.position,u=a.position,m=d<h?0:d>u?1:h<u?(d-h)/(u-h):0,g=s.color,_=a.color,f=((g>>>24)+((_>>>24)-(g>>>24))*m)/255;for(let S=0;S<4;S=S+1){let b=g&255,T=_&255,y=b+(T-b)*m,I=.5+257*(S<3?y*f:y)|0;t[l]=I>>8,t[l+da.WIDTH*4]=I,g>>=8,_>>=8,l=l+1}}}return new da(t)}};var Mt=class Mt{static SUPERSAMPLE_COUNT(){return this._CACHED_SUPERSAMPLE_COUNT==null&&(this._CACHED_SUPERSAMPLE_COUNT=X.useSSAA()?4:2),this._CACHED_SUPERSAMPLE_COUNT}static SSAA_SIZE(){return or.TILE_SIZE*Mt.SUPERSAMPLE_COUNT()}constructor(e,t,r){this._delegate=null,this._context=null,this._bufferPool=null,this._quadArea=null,this._solidColorMaterial=null,this._gradientPaintMaterial=null,this._lerpGradientPaintMaterial=null,this._stencilMaterial=null,this._imageMaterial=null,this._lerpImageMaterial=null,this._imageColorAdjustMaterial=null,this._lerpImageColorAdjustMaterial=null,this._aaaShapeSolidColorMaterial=null,this._aaaShapeGradientPaintMaterial=null,this._aaaShapeLerpGradientPaintMaterial=null,this._aaaShapeImageMaterial=null,this._aaaShapeLerpImageMaterial=null,this._aaaShapeImageColorAdjustMaterial=null,this._aaaShapeLerpImageColorAdjustMaterial=null,this._gradientDataCache=new Map,this._gradientPool=new sc,this._batchAntialiasing=null,this._currentBatchScissorBuilder=new bt,this._shouldFlushAfterStencilCover=!1,this._materialStrings=wr.instance(),this.computeStates=new Map([["ODD",new O.StencilState(new O.StencilFaceState(0,O.Comparison.ALWAYS,1,1,O.StencilOperation.KEEP,O.StencilOperation.INVERT,O.StencilOperation.INVERT))],["NONZERO",new O.StencilState(new O.StencilFaceState(0,O.Comparison.ALWAYS,Mt.WINDING_MASK,Mt.WINDING_MASK,O.StencilOperation.KEEP,O.StencilOperation.INCREMENT_WRAP,O.StencilOperation.INCREMENT_WRAP),new O.StencilFaceState(0,O.Comparison.ALWAYS,Mt.WINDING_MASK,Mt.WINDING_MASK,O.StencilOperation.KEEP,O.StencilOperation.DECREMENT_WRAP,O.StencilOperation.DECREMENT_WRAP))]]),this.useStates=new Map([["ODD",new O.StencilState(new O.StencilFaceState(0,O.Comparison.NOT_EQUAL,1,0,O.StencilOperation.KEEP,O.StencilOperation.KEEP,O.StencilOperation.KEEP))],["NONZERO",new O.StencilState(new O.StencilFaceState(0,O.Comparison.NOT_EQUAL,Mt.WINDING_MASK,0,O.StencilOperation.KEEP,O.StencilOperation.KEEP,O.StencilOperation.KEEP))]]),this.clearStates=new Map([["ODD",new O.StencilState(new O.StencilFaceState(0,O.Comparison.NOT_EQUAL,1,Mt.WINDING_MASK,O.StencilOperation.ZERO,O.StencilOperation.ZERO,O.StencilOperation.ZERO))],["NONZERO",new O.StencilState(new O.StencilFaceState(0,O.Comparison.NOT_EQUAL,Mt.WINDING_MASK,Mt.WINDING_MASK,O.StencilOperation.ZERO,O.StencilOperation.ZERO,O.StencilOperation.ZERO))]]),this.setFillStates=new Map([["ODD",new O.StencilState(new O.StencilFaceState(Mt.FILL,O.Comparison.NOT_EQUAL,1,Mt.NOT_STROKE,O.StencilOperation.KEEP,O.StencilOperation.REPLACE,O.StencilOperation.REPLACE))],["NONZERO",new O.StencilState(new O.StencilFaceState(Mt.FILL,O.Comparison.NOT_EQUAL,Mt.WINDING_MASK,Mt.NOT_STROKE,O.StencilOperation.KEEP,O.StencilOperation.REPLACE,O.StencilOperation.REPLACE))]]),this.setStrokeStates=new Map([["ODD",new O.StencilState(new O.StencilFaceState(Mt.STROKE,O.Comparison.NOT_EQUAL,1,Mt.NOT_FILL,O.StencilOperation.KEEP,O.StencilOperation.REPLACE,O.StencilOperation.REPLACE))],["NONZERO",new O.StencilState(new O.StencilFaceState(Mt.STROKE,O.Comparison.NOT_EQUAL,Mt.WINDING_MASK,Mt.NOT_FILL,O.StencilOperation.KEEP,O.StencilOperation.REPLACE,O.StencilOperation.REPLACE))]]),this.compoundUseStates=new Map([[0,new O.StencilState(new O.StencilFaceState(Mt.FILL_AND_STROKE,O.Comparison.EQUAL,Mt.FILL_AND_STROKE,0,O.StencilOperation.KEEP,O.StencilOperation.KEEP,O.StencilOperation.KEEP))],[1,new O.StencilState(new O.StencilFaceState(Mt.STROKE,O.Comparison.EQUAL,Mt.FILL_AND_STROKE,0,O.StencilOperation.KEEP,O.StencilOperation.KEEP,O.StencilOperation.KEEP))]]),this.compoundClearStates=new Map([[0,new O.StencilState(new O.StencilFaceState(Mt.FILL_AND_STROKE,O.Comparison.EQUAL,Mt.FILL_AND_STROKE,-1,O.StencilOperation.ZERO,O.StencilOperation.ZERO,O.StencilOperation.ZERO))],[1,new O.StencilState(new O.StencilFaceState(Mt.STROKE,O.Comparison.EQUAL,Mt.FILL_AND_STROKE,-1,O.StencilOperation.ZERO,O.StencilOperation.ZERO,O.StencilOperation.ZERO))]]),this._delegate=e,this._context=t,this._bufferPool=r,this._solidColorMaterial=this._context.createMaterial("solidColor",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT),this._gradientPaintMaterial=this._context.createMaterial("gradientPaint",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_GRADIENT_FRAGMENT),this._lerpGradientPaintMaterial=this._context.createMaterial("lerpGradientPaint",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_GRADIENT_FRAGMENT),this._stencilMaterial=this._context.createMaterial("stencil",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_LOOP_BLINN_VERTEX,this._materialStrings.GLSLX_SOURCE_LOOP_BLINN_FRAGMENT),this._imageMaterial=this._context.createMaterial("image",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_IMAGE_FRAGMENT),this._lerpImageMaterial=this._context.createMaterial("lerpImage",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_IMAGE_FRAGMENT),this._imageColorAdjustMaterial=this._context.createMaterial("imageColorAdjust",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_IMAGE_COLOR_ADJUST_FRAGMENT),this._lerpImageColorAdjustMaterial=this._context.createMaterial("lerpImageColorAdjust",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT),O.supportsWebGLExtensionOESStandardDerivatives()&&(this._aaaShapeSolidColorMaterial=this._context.createMaterial("aaaShapeSolidColor",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_SOLID_COLOR_PAINT_FRAGMENT),this._aaaShapeGradientPaintMaterial=this._context.createMaterial("aaaShapeGradientPaint",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_GRADIENT_FRAGMENT),this._aaaShapeLerpGradientPaintMaterial=this._context.createMaterial("aaaShapeLerpGradientPaint",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_GRADIENT_FRAGMENT),this._aaaShapeImageMaterial=this._context.createMaterial("aaaShapeImage",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_IMAGE_FRAGMENT),this._aaaShapeLerpImageMaterial=this._context.createMaterial("aaaShapeLerpImage",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_FRAGMENT),this._aaaShapeImageColorAdjustMaterial=this._context.createMaterial("aaaShapeImageColorAdjust",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_IMAGE_COLOR_ADJUST_FRAGMENT),this._aaaShapeLerpImageColorAdjustMaterial=this._context.createMaterial("aaaShapeLerpImageColorAdjust",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_TWO_NON_SOLID_COLOR_PAINT_VERTEX,this._materialStrings.GLSLX_SOURCE_AAA_SHAPE_LERP_IMAGE_COLOR_ADJUST_FRAGMENT)),this._quadArea=this._bufferPool.allocate(O.VertexFormat.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._shouldFlushAfterStencilCover=this._checkShouldFlushAfterStencilCover()}totalVRAM(){return this._gradientPool.totalVRAM()}clearGradientCache(){this._gradientDataCache=new Map,this._gradientPool=new sc}canSkipStencil(e,t,r){return t.hasNoCurves?!!(t.hasNoOverlaps||e=="NONZERO"&&t.hasNoCurvesAndSameOrientation&&!Ce.containsAtLeastOneNonOpaquePaint(r)):!1}currentBatchAA(){return this._batchAntialiasing}currentBatchScissor(){return this._currentBatchScissorBuilder.build()}includeBoundsInBatchScissor(e){this._currentBatchScissorBuilder.include3(e)}beginBatch(e){this._batchAntialiasing=new fe(e),this._batchAntialiasing.value==2&&this._delegate.pushSSAARenderState(null)}finishBatch(){if(this._delegate.supersampleState().level==1&&this._delegate.supersampleState().mode==0&&this._batchAntialiasing.value==2){let e=this.currentBatchScissor();this._delegate.currentTile().pushScissor2(e)}this._currentBatchScissorBuilder.reset(),this._batchAntialiasing.value==2&&this._delegate.popSSAARenderState(),this._batchAntialiasing=null}renderStencilQuad(e,t,r){let n=this._solidColorMaterial,o=ee.new3(e).translatedBy1(t.topLeft()).scaledBy1(t.size());O.in_Material.Material_setUniformMat32(n,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,o),this._context.setStencilState(r),O.in_Context.Context_setKeepBlendState(this._context),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,n,this._quadArea),this._delegate.markDidDraw()}renderFill(e,t){if(t.geometry.paints.length==0)return;let r=t.geometry.type==ti.PaintedGeometryType.DYNAMIC?t.geometry.path().bounds().size():t.paintSize,n=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform),o=this._delegate.currentTile(),a=o.tileSize(),s=ee.new2().scaledBy2(a).multipliedBy1(e).multipliedBy1(t.transform),l=O.FrozenScissors.isEmpty(o.scissors())?new V(0,0,a,a):O.FrozenScissors.last(o.scissors()),c=V.new3(t.geometry.path().bounds());if(s.transformRect(c),c.intersectWith(l),this.includeBoundsInBatchScissor(c),t.geometry.canBeAnalyticallyAntialiased()){O.in_Context.Context_setPremultipliedBlendState(this._context),this.renderAAAShape(n,t.geometry,r,a);return}let d=t.geometry.path().windingRule(),h=t.geometry.path().triangles(this._bufferPool,O.VertexFormat.getPositionF2CoordF3()),u=!0;for(let m=0,g=h.length;m<g;m=m+1)if(!this.canSkipStencil(d,h[m],t.geometry.paints)){u=!1;break}u?(O.in_Context.Context_setPremultipliedBlendState(this._context),this.renderGeometryDirectly(n,t.geometry,r,a)):(this.renderStencilGeometry(n,t.geometry,this.computeStates.get(d)),O.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(n,t.geometry,r,this.useStates.get(d),this.clearStates.get(d),a),this._context.setStencilState(O.StencilState.NONE))}renderFillStroke(e,t){let r=this._delegate.currentTile(),n=r.tileSize(),o=ee.new2().scaledBy2(n).multipliedBy1(e).multipliedBy1(t.transform),a=O.FrozenScissors.isEmpty(r.scissors())?new V(0,0,n,n):O.FrozenScissors.last(r.scissors()),s=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform);for(let l=0,c=t.fillGeometries.length;l<c;l=l+1){let d=t.fillGeometries[l],h=V.new3(d.path().bounds());o.transformRect(h),this.includeBoundsInBatchScissor(h.intersectedWith(a));let u=d.path().windingRule();this.renderStencilGeometry(s,d,this.computeStates.get(u)),O.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(s,d,t.paintSize,this.useStates.get(u),this.setFillStates.get(u),n)}for(let l=0,c=t.strokeGeometries.length;l<c;l=l+1){let d=t.strokeGeometries[l],h=V.new3(d.path().bounds());o.transformRect(h),this.includeBoundsInBatchScissor(h.intersectedWith(a));let u=d.path().windingRule();this.renderStencilGeometry(s,d,this.computeStates.get(u)),this.renderStencilQuad(s,d.path().bounds(),this.setStrokeStates.get(u)),O.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(s,d,t.paintSize,this.compoundUseStates.get(t.mode),this.compoundClearStates.get(t.mode),n)}if(t.strokeGeometries.length!=0){let l=ce.List_last(t.strokeGeometries).path().bounds(),c=ce.List_last(t.fillGeometries).path().bounds();l.contains1(c)||this.renderStencilQuad(s,c,this.compoundClearStates.get(t.mode))}this._context.setStencilState(O.StencilState.NONE)}uvTransformFromBounds(e,t){let r=ee.new2();return r.scale4(1/t.x(),1/t.y()),r.translate1(e.topLeft()),r.scale3(e.size()),r}canSkipPaint(e,t,r,n){let o=r.asSinglePaint();if(o==null)return!1;if((o.type()=="GRADIENT_RADIAL"||o.type()=="GRADIENT_DIAMOND")&&o.lastStopIsTransparent()){let a=ee.new3(o.transform());if(a.multiply(t),a.invert()){let s=ce.List_last(o.colorStops()).position*.5,l=new R(.5,.5),c=V.new4(l.subtract(s),l.add(s));return ee.new3(e).translatedBy1(n.topLeft()).scaledBy1(n.size()).multipliedBy1(a).transformRect(c),!V.CLIP.overlaps(c)}}return!1}_findOrCreateGradientData(e){let t=zt.IntMap_get(this._gradientDataCache,e.id(),null);return t==null&&(t=this._gradientPool.allocate(e),this._gradientDataCache.set(e.id(),t)),t}_setAaaShapeUniforms(e,t,r){if(e.setUniformVec21(this._materialStrings.GLSLX_NAME_U_UV_SCALE,r.x(),r.y()),O.in_Material.Material_setUniformVec22(e,this._materialStrings.GLSLX_NAME_U_PATH_SIZE,t.bounds().size()),t instanceof Bi){let n=t;e.setUniformInt(this._materialStrings.GLSLX_NAME_U_SHAPE_TYPE,fu.ELLIPSE),O.in_Material.Material_setUniformVec22(e,this._materialStrings.GLSLX_NAME_U_ELLIPSE_CENTER,n.center.subtract1(n.bounds().topLeft())),e.setUniformVec21(this._materialStrings.GLSLX_NAME_U_ELLIPSE_RADII,n.xRadius,n.yRadius)}else if(t instanceof Ot){let n=t;e.setUniformInt(this._materialStrings.GLSLX_NAME_U_SHAPE_TYPE,fu.ROUNDED_RECT),O.in_Material.Material_setUniformVec43(e,this._materialStrings.GLSLX_NAME_U_RECT,t.bounds().translatedBy(t.bounds().topLeft())),e.setUniformVec41(this._materialStrings.GLSLX_NAME_U_CORNER_RADII,Math.max(n.radii().topLeft,0),Math.max(n.radii().topRight,0),Math.max(n.radii().bottomRight,0),Math.max(n.radii().bottomLeft,0))}else throw new Error("Unxpected path type")}renderAAAShape(e,t,r,n){let o=t.paints,a=t.path().bounds(),s=e.clone(),l=s.invert(),c=2/n,d=s.scale1().x()*c,h=a.clone().expandedBy1(d),u=ee.new3(e).translatedBy1(h.topLeft()).scaledBy1(h.size()),m=this.uvTransformFromBounds(a,r),g=new R(h.width()/a.width(),h.height()/a.height()),_=t.path().path();for(let f=0,S=o.length;f<S;f=f+1){let b=o[f];if(!this.canSkipPaint(e,m,b,a))if(b.type()=="SOLID"){let T=this._aaaShapeSolidColorMaterial;this._setAaaShapeUniforms(T,_,g),O.in_Material.Material_setUniformMat32(T,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),O.in_Material.Material_setUniformVec42(T,this._materialStrings.GLSLX_NAME_U_COLOR,C.premultiplied(b.color())),T.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,b.opacity()),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,T,this._quadArea),this._delegate.markDidDraw()}else if(Ya.isGradient(b.type())){let T=ee.new3(b.transform()).multipliedBy1(m),y=null,I=b.asVolatilePaint();if(I!=null){y=this._aaaShapeLerpGradientPaintMaterial;let p=this._findOrCreateGradientData(I.from()).texture(this._context),A=this._findOrCreateGradientData(I.to()).texture(this._context);p.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),A.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),y.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,p,0),y.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,A,1),y.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,I.t())}else{let p=b.asSinglePaint();y=this._aaaShapeGradientPaintMaterial;let A=this._findOrCreateGradientData(p).texture(this._context);A.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),y.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,A,0)}this._setAaaShapeUniforms(y,_,g),O.in_Material.Material_setUniformMat32(y,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),O.in_Material.Material_setUniformMat32(y,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,T),y.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,gu.get(b.type())),y.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,b.opacity()),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,y,this._quadArea),this._delegate.markDidDraw()}else if(b.type()=="IMAGE"||b.type()=="VIDEO"){let T=ee.new3(m).scaledBy3(1/a.size().x(),1/a.size().y()),y=!0,I=b.asVolatilePaint();if(I!=null){let p=this.getImageToDraw(I.from(),r,e,T,I.from().imageScaleMode(),n);if(p!=null){let A=ee.new2(),v=null;if(I.from().image()==I.to().image()&&!(I.from().imageScaleMode()=="TILE"||I.to().imageScaleMode()=="TILE"))v=this._aaaShapeImageMaterial,I.colorAdjustIsActive()&&(v=this._aaaShapeImageColorAdjustMaterial,I.colorAdjustSetData(v)),A=this.allocateObjectSpaceToNormalizedImageSpaceTransform(I,r,m);else{v=this._aaaShapeLerpImageMaterial,I.colorAdjustIsActive()&&(v=this._aaaShapeLerpImageColorAdjustMaterial,I.colorAdjustSetData(v)),A=this.allocateObjectSpaceToNormalizedImageSpaceTransform(I.from(),r,m);let D=this.getImageToDraw(I.to(),r,e,T,I.to().imageScaleMode(),n);if(D==null)y=!1;else{let G=this.getOrCreateVideoTexture(I.to());G==null&&(G=this._delegate.getOrCreateImageTexture(D));let U=this.allocateObjectSpaceToNormalizedImageSpaceTransform(I.to(),r,m);O.in_Material.Material_setUniformMat32(v,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,U),G!=null&&G.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),v.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,G,1),v.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,Xt.double_clamp(I.t(),0,1))}}v.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PIXEL_RATIO,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale());let E=this.getOrCreateVideoTexture(I.from());E==null&&(E=this._delegate.getOrCreateImageTexture(p)),y&&E!=null&&(E!=null&&E.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(b,v),O.in_Material.Material_setUniformMat32(v,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),O.in_Material.Material_setUniformMat32(v,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,A),v.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,I.opacity()),v.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,E,0),this._setAaaShapeUniforms(v,_,g),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,v,this._quadArea),this._delegate.markDidDraw())}}else{let p=b.asSinglePaint(),A=null;if(A=this.getOrCreateVideoTexture(p),A==null){let v=this.getImageToDraw(p,r,e,T,p.imageScaleMode(),n);v!=null&&(A=this._delegate.getOrCreateImageTexture(v))}if(A!=null){let v=this._aaaShapeImageMaterial;p.colorAdjustIsActive()&&(v=this._aaaShapeImageColorAdjustMaterial,p.colorAdjustSetData(v));let E=this.allocateObjectSpaceToNormalizedImageSpaceTransform(p,r,m);A.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(b,v),O.in_Material.Material_setUniformMat32(v,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),O.in_Material.Material_setUniformMat32(v,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,E),v.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,p.opacity()),v.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,A,0),v.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PIXEL_RATIO,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale()),this._setAaaShapeUniforms(v,_,g),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,v,this._quadArea),this._delegate.markDidDraw()}}}else b.type()=="EMOJI"&&Le("Emoji should always be rendered by renderGeometryDirectly")}}renderGeometryDirectly(e,t,r,n){let o=t.path().triangles(this._bufferPool,O.VertexFormat.getPositionF2CoordF3()),a=t.paints,s=t.path().bounds(),l=this.uvTransformFromBounds(s,r),c=null;for(let d=0,h=a.length;d<h;d=d+1){let u=a[d];if(!this.canSkipPaint(e,l,u,s))switch(u.type()){case"SOLID":{c=this._solidColorMaterial,O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),O.in_Material.Material_setUniformVec42(c,this._materialStrings.GLSLX_NAME_U_COLOR,C.premultiplied(u.color())),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,u.opacity());for(let m=0,g=o.length;m<g;m=m+1)o[m].bufferArea!=null&&(this._delegate.drawToCurrentTile(O.Primitive.TRIANGLES,c,o[m].bufferArea),this._delegate.markDidDraw());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let m=ee.new3(u.transform()).scaledBy3(1/r.x(),1/r.y()),g=u.asVolatilePaint();if(g!=null){c=this._lerpGradientPaintMaterial;let _=this._findOrCreateGradientData(g.from()).texture(this._context),f=this._findOrCreateGradientData(g.to()).texture(this._context);_.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),f.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),c.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,_,0),c.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,f,1),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,g.t())}else{let _=u.asSinglePaint();c=this._gradientPaintMaterial;let f=this._findOrCreateGradientData(_).texture(this._context);f.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),c.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,f,0)}O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,m),c.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,gu.get(u.type())),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,u.opacity());for(let _=0,f=o.length;_<f;_=_+1)o[_].bufferArea!=null&&(this._delegate.drawToCurrentTile(O.Primitive.TRIANGLES,c,o[_].bufferArea),this._delegate.markDidDraw());break}case"IMAGE":case"VIDEO":{let m=ee.new2().scaledBy3(1/r.x(),1/r.y()),g=u.asVolatilePaint();if(g!=null){let _=this.getImageToDraw(g.from(),r,e,m,g.from().imageScaleMode(),n);if(_!=null){let f=ee.new2(),S=!0;if(g.from().image()==g.to().image()&&!(g.from().imageScaleMode()=="TILE"||g.to().imageScaleMode()=="TILE"))c=this._imageMaterial,g.colorAdjustIsActive()&&(c=this._imageColorAdjustMaterial,g.colorAdjustSetData(c)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g,r,m);else{let T=this.getImageToDraw(g.to(),r,e,m,g.to().imageScaleMode(),n);if(T==null)S=!1;else{c=this._lerpImageMaterial,g.colorAdjustIsActive()&&(c=this._lerpImageColorAdjustMaterial,g.colorAdjustSetData(c)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g.from(),r,m);let y=this._delegate.getOrCreateImageTexture(T),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(g.to(),r,m);O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,I),this._setupClampingForImageOrGIF(T.image,y),c.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,y,1),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,Xt.double_clamp(g.t(),0,1))}}let b=this._delegate.getOrCreateImageTexture(_);if(S&&b!=null){O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,f),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,g.opacity()),this._setupRepeatingForImage(u,c),this._setupClampingForImageOrGIF(_.image,b),c.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,b,0);for(let T=0,y=o.length;T<y;T=T+1)o[T].bufferArea!=null&&(this._delegate.drawToCurrentTile(O.Primitive.TRIANGLES,c,o[T].bufferArea),this._delegate.markDidDraw())}}}else{let _=u.asSinglePaint(),f=null;if(f=this.getOrCreateVideoTexture(_),f==null){let S=this.getImageToDraw(_,r,e,m,_.imageScaleMode(),n);S!=null&&(f=this._delegate.getOrCreateImageTexture(S),f!=null&&this._setupClampingForImageOrGIF(S.image,f))}if(f!=null){let S=this.allocateObjectSpaceToNormalizedImageSpaceTransform(_,r,m);c=this._imageMaterial,_.colorAdjustIsActive()&&(c=this._imageColorAdjustMaterial,_.colorAdjustSetData(c)),O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,S),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,_.opacity()),this._setupRepeatingForImage(u,c),c.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,f,0);for(let b=0,T=o.length;b<T;b=b+1)o[b].bufferArea!=null&&(this._delegate.drawToCurrentTile(O.Primitive.TRIANGLES,c,o[b].bufferArea),this._delegate.markDidDraw())}}break}case"EMOJI":{let m=u.asSinglePaint();if(m==null)continue;let g=this._delegate.getOrCreateImageTexture(new bi(m.image(),2));if(m.decodedImageIsReady()||(g=null),g!=null){let _=g;c=this._imageMaterial;let f=ee.new2().scaledBy3(1/s.width(),1/s.height()).translatedBy2(-s.left(),-s.top());O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),O.in_Material.Material_setUniformMat32(c,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,f),c.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,m.opacity()),c.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,_,0),_!=null&&_.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP);for(let S=0,b=o.length;S<b;S=S+1)o[S].bufferArea!=null&&(this._delegate.drawToCurrentTile(O.Primitive.TRIANGLES,c,o[S].bufferArea),this._delegate.markDidDraw())}break}}}}_setupRepeatingForImage(e,t){let r=!1,n=e.asVolatilePaint();n!=null?n.eitherPaint(o=>o.imageScaleMode()=="TILE")&&(r=!0):e.asSinglePaint()!=null&&(r=e.asSinglePaint().imageScaleMode()=="TILE"),t.setUniformInt(this._materialStrings.GLSLX_NAME_U_EMULATE_WRAP_ADDRESS,r?1:0),t.setUniformInt(this._materialStrings.GLSLX_NAME_U_EMULATE_BORDER_ADDRESS,r?0:1)}_setupClampingForImageOrGIF(e,t){e.isGIF()?t.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP):t.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP)}renderStencilGeometry(e,t,r){let n=t.path().triangles(this._bufferPool,O.VertexFormat.getPositionF2CoordF3()),o=this._stencilMaterial;O.in_Material.Material_setUniformMat32(o,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),this._context.setStencilState(r),O.in_Context.Context_setKeepBlendState(this._context);for(let a=0,s=n.length;a<s;a=a+1)n[a].bufferArea!=null&&(this._delegate.drawToCurrentTile(O.Primitive.TRIANGLES,o,n[a].bufferArea),this._delegate.markDidDraw())}_checkShouldFlushAfterStencilCover(){return!!X.shouldFlushAfterStencilCover()}renderCoverQuad(e,t,r,n,o,a){let s=t.paints;if(s.length==0){this.renderStencilQuad(e,t.path().bounds(),o),this._shouldFlushAfterStencilCover&&this._context.flush();return}let l=t.path().bounds(),c=ee.new3(e).translatedBy1(l.topLeft()).scaledBy1(l.size()),d=this.uvTransformFromBounds(l,r),h=null;for(let u=0,m=s.length;u<m;u=u+1){let g=s[u],_=u+1==m;if(!(!_&&this.canSkipPaint(e,d,g,l)))switch(this._context.setStencilState(_?o:n),g.type()){case"SOLID":{h=this._solidColorMaterial,O.in_Material.Material_setUniformMat32(h,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,c),O.in_Material.Material_setUniformVec42(h,this._materialStrings.GLSLX_NAME_U_COLOR,C.premultiplied(g.color())),h.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,g.opacity()),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,h,this._quadArea),this._delegate.markDidDraw();break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let f=ee.new3(g.transform()).multipliedBy1(d),S=g.asVolatilePaint();if(S!=null){h=this._lerpGradientPaintMaterial;let b=this._findOrCreateGradientData(S.from()).texture(this._context),T=this._findOrCreateGradientData(S.to()).texture(this._context);b.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),T.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),h.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,b,0),h.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,T,1),h.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,S.t())}else{let b=g.asSinglePaint();h=this._gradientPaintMaterial;let T=this._findOrCreateGradientData(b).texture(this._context);T.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),h.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,T,0)}O.in_Material.Material_setUniformMat32(h,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,c),O.in_Material.Material_setUniformMat32(h,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,f),h.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,gu.get(g.type())),h.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,g.opacity()),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,h,this._quadArea),this._delegate.markDidDraw();break}case"IMAGE":case"VIDEO":{let f=ee.new3(d).scaledBy3(1/l.size().x(),1/l.size().y()),S=!0,b=!1,T=g.asVolatilePaint();if(T!=null){let y=this.getImageToDraw(T.from(),r,e,f,T.from().imageScaleMode(),a);if(y!=null){let I=ee.new2();if(T.from().image()==T.to().image()&&!(T.from().imageScaleMode()=="TILE"||T.to().imageScaleMode()=="TILE"))h=this._imageMaterial,T.colorAdjustIsActive()&&(h=this._imageColorAdjustMaterial,T.colorAdjustSetData(h)),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(T,r,d);else{h=this._lerpImageMaterial,T.colorAdjustIsActive()&&(h=this._lerpImageColorAdjustMaterial,T.colorAdjustSetData(h)),I=this.allocateObjectSpaceToNormalizedImageSpaceTransform(T.from(),r,d);let A=this.getImageToDraw(T.to(),r,e,f,T.to().imageScaleMode(),a);if(A==null)S=!1;else{let v=this._delegate.getOrCreateImageTexture(A),E=this.allocateObjectSpaceToNormalizedImageSpaceTransform(T.to(),r,d);O.in_Material.Material_setUniformMat32(h,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM1,E),v!=null&&v.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),h.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,v,1),h.setUniformFloat(this._materialStrings.GLSLX_NAME_U_PROGRESS,Xt.double_clamp(T.t(),0,1))}}let p=this._delegate.getOrCreateImageTexture(y);S&&p!=null&&(p!=null&&p.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(g,h),O.in_Material.Material_setUniformMat32(h,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,c),O.in_Material.Material_setUniformMat32(h,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,I),h.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,T.opacity()),h.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,p,0),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,h,this._quadArea),this._delegate.markDidDraw(),b=!0)}}else{let y=g.asSinglePaint(),I=null;if(I=this.getOrCreateVideoTexture(y),I==null){let p=this.getImageToDraw(y,r,e,f,y.imageScaleMode(),a);p!=null&&(I=this._delegate.getOrCreateImageTexture(p))}if(I!=null){h=this._imageMaterial,y.colorAdjustIsActive()&&(h=this._imageColorAdjustMaterial,y.colorAdjustSetData(h));let p=this.allocateObjectSpaceToNormalizedImageSpaceTransform(y,r,d);I.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(g,h),O.in_Material.Material_setUniformMat32(h,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,c),O.in_Material.Material_setUniformMat32(h,this._materialStrings.GLSLX_NAME_U_PAINT_TRANSFORM0,p),h.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,y.opacity()),h.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,I,0),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,h,this._quadArea),this._delegate.markDidDraw(),b=!0}}_&&!b&&(O.in_Material.Material_setUniformMat32(this._solidColorMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,c),O.in_Material.Material_setUniformVec42(this._solidColorMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,C.TRANSPARENT),this._solidColorMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,0),this._delegate.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._solidColorMaterial,this._quadArea),this._delegate.markDidDraw());break}case"EMOJI":{Le("Emoji should always be rendered by renderGeometryDirectly");break}}}this._shouldFlushAfterStencilCover&&this._context.flush()}allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,r){let n=e.allocateImageTransformForGeometrySize(t);return ee.new2().multipliedBy1(n).multipliedBy1(r)}getImageToDraw(e,t,r,n,o,a){if(e.image()==null&&e.imageThumbnail()==null)return null;e.imageThumbnail()!=null&&this._delegate.getOrCreateImageTexture(new bi(e.imageThumbnail(),1)),e.image()!=null&&e.image().isGIF()&&this._delegate.getOrCreateImageTexture(new bi(e.image(),0));let s=e.decodedImageThumbnailIsReady()?e.decodedImageThumbnail():null,l=!1;if(e.imageThumbnail()==null)l=!0;else if(s!=null){let c=this.allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,n),d=ee.new3(c);d.invert();let h=ee.new2().scaledBy2(a).multipliedBy1(r).multipliedBy1(d).scaledBy3(1/s.width(),1/s.height()),u=h.axisX().length(),m=h.axisY().length();l=Math.max(m,u)>1||e.image()!=null&&e.image().isGIF(),o=="TILE"&&(l=!0)}if(l&&(this._delegate.getOrCreateImageTexture(new bi(e.image(),0)),e.decodedImageIsReady())){let c=e.decodedImage();if(c!=null)return new bi(c,0)}if(s!=null)return new bi(s,1);if(e.decodedImageIsReady()){let c=e.decodedImage();if(c!=null)return new bi(c,0)}return null}getOrCreateVideoTexture(e){var t;return(t=e==null?void 0:e.video())==null?void 0:t.getOrCreateTexture(e,this._context,O.TextureFormat.RGBA_NEAREST_CLAMP)}};Mt.FILL=128,Mt.STROKE=64,Mt.NOT_FILL=255^Mt.FILL,Mt.NOT_STROKE=255^Mt.STROKE,Mt.FILL_AND_STROKE=Mt.FILL|Mt.STROKE,Mt.WINDING_MASK=255^Mt.FILL_AND_STROKE,Mt._CACHED_SUPERSAMPLE_COUNT=null;var Dr=Mt,fu;(t=>(t.ELLIPSE=0,t.ROUNDED_RECT=1))(fu||(fu={}));var Au=class{activate(e){this.reset(),this._isEnabled=!0,this._invalidateFn=e}deactivate(){this.isEnabled()&&(this._invalidateFn(),this.reset())}isEnabled(){return this._isEnabled}reset(){this._isPlaying=!1,this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._framesUntilUpdate=this._frameDelay,this._filteredTree=null,this._invalidateFn=null,this._frameDelay=this._defaultFrameDelay}play(){this.isEnabled()&&(this._isPlaying=!0,this._invalidateFn())}pause(){this.isEnabled()&&(this._isPlaying=!1)}forward(){this.isEnabled()&&(this._maxLayersToRender=Math.min(this._maxLayersToRender+1,this._totalLayersInRenderTree),this._invalidateFn())}backward(){this.isEnabled()&&(this._maxLayersToRender=Math.max(this._maxLayersToRender-1,1),this._invalidateFn())}rewind(){this.isEnabled()&&(this._maxLayersToRender=1,this._invalidateFn())}increaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.max(this._minFrameDelay,this._frameDelay-5))}decreaseSpeed(){this.isEnabled()&&(this._frameDelay=Math.min(this._maxFrameDelay,this._frameDelay+5))}finishLayerByLayerDrawToScreen(){this.isEnabled()&&this._isPlaying&&(this._maxLayersToRender>=this._totalLayersInRenderTree||(this._invalidateFn(),this._framesUntilUpdate=this._framesUntilUpdate-1,this._framesUntilUpdate<=0&&(this._maxLayersToRender=this._maxLayersToRender+1,this._framesUntilUpdate=this._frameDelay)))}_filterCompositeTileGridNodes(e){switch(e.op()){case 0:{let t=e;return new la(this._filterCompositeTileGridNodes(t.child),t.flags)}case 2:{let t=e;return new Ho(this._filterCompositeTileGridNodes(t.child))}case 1:{let t=e,r=[];for(let n=0,o=t.children.length;n<o;n=n+1){let a=this._filterCompositeTileGridNodes(t.children[n]);r.push(a)}return new Xe(r,t.isFirstChildSolidBackground())}case 3:case 4:return e;case 5:{let t=e,r=this._filterCompositeTileGridNodes(t.alpha),n=this._filterCompositeTileGridNodes(t.color);return new pn(r,n,t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return new zn(t.radius,this._filterCompositeTileGridNodes(t.child),t.clamp)}case 7:{let t=e;return new Wn(t.blendMode,t.opacity,this._filterCompositeTileGridNodes(t.child))}case 9:{let t=e;return new so(this._filterCompositeTileGridNodes(t.alpha),t.color)}case 8:{let t=e;return this._filterCompositeTileGridNodes(t.tree)}case 10:{let t=e;return new pt(this._filterCompositeTileGridNodes(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new To(this._filterCompositeTileGridNodes(t.child),t.transform)}case 12:{let t=e,r=this._filterCompositeTileGridNodes(t.startChild),n=this._filterCompositeTileGridNodes(t.endChild);return new en(r,n,t.id,t.progressFn)}default:throw new Error(`Unhandled node op ${un[e.op()]}`)}return null}_renderTreeWithNLayers(e,t){let r=(a,s)=>new cn(a,s);if(t<=0)return r(null,0);let n=[];switch(e.op()){case 0:{let a=e;n.push(a.child);break}case 2:{let a=e;n.push(a.child);break}case 1:{let a=e;for(let s=0,l=a.children.length;s<l;s=s+1){let c=a.children[s];n.push(c)}break}case 3:case 4:return r(e,t-1);case 5:{let a=e;n.push(a.color),n.push(a.alpha);break}case 6:{let a=e;n.push(a.child);break}case 7:{let a=e;n.push(a.child);break}case 9:{let a=e;n.push(a.alpha);break}case 8:{let a=e;n.push(a.tree);break}case 10:{let a=e;n.push(a.child);break}case 11:{let a=e;n.push(a.child);break}case 12:{let a=e;n.push(a.startChild),n.push(a.endChild);break}default:throw new Error(`Unhandled node op ${un[e.op()]}`)}let o=[];for(let a=0,s=n.length;a<s;a=a+1){let l=n[a],c=this._renderTreeWithNLayers(l,t);if(t=c.b,o.push(c.a),t<=0)return r(new Xe(o).optimized(),0)}return this._isRenderableLayer(e)?t>0?r(e,t-1):r(new Xe(o).optimized(),0):r(e,t)}_isRenderableLayer(e){switch(e.op()){case 8:case 1:case 0:return!1}return!0}_countLayers(e){let t=0;switch(e.op()){case 0:{let r=e;t=t+this._countLayers(r.child);break}case 2:{let r=e;t=t+this._countLayers(r.child);break}case 1:{let r=e;for(let n=0,o=r.children.length;n<o;n=n+1){let a=r.children[n];t=t+this._countLayers(a)}break}case 3:case 4:break;case 5:{let r=e;t=t+this._countLayers(r.alpha),t=t+this._countLayers(r.color);break}case 6:{let r=e;t=t+this._countLayers(r.child);break}case 7:{let r=e;t=t+this._countLayers(r.child);break}case 9:{let r=e;t=t+this._countLayers(r.alpha);break}case 8:{let r=e;t=t+this._countLayers(r.tree);break}case 10:{let r=e;t=t+this._countLayers(r.child);break}case 11:{let r=e;t=t+this._countLayers(r.child);break}case 12:{let r=e;t=t+this._countLayers(r.startChild),t=t+this._countLayers(r.endChild);break}default:throw new Error(`Unhandled node op ${un[e.op()]}`)}return this._isRenderableLayer(e)&&(t=t+1),t}treeToRender(e){if(!this.isEnabled())return e;e!=this._originalTree&&(this._totalLayersInRenderTree=this._countLayers(e),this._filteredTree=this._filterCompositeTileGridNodes(e),this._originalTree=e);let t=this._renderTreeWithNLayers(this._filteredTree,this._maxLayersToRender).a;return t!=this._lastTreeToRender&&console.log(`LayerByLayerRendering: rendering ${this._maxLayersToRender} instructions out of ${this._totalLayersInRenderTree}
`+t.debugString1()),this._lastTreeToRender=t,t}constructor(){this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._maxFrameDelay=60,this._defaultFrameDelay=45,this._minFrameDelay=5,this._frameDelay=60,this._framesUntilUpdate=0,this._filteredTree=null,this._originalTree=null,this._invalidateFn=null,this._isPlaying=!1,this._lastTreeToRender=null}};var _u=(r=>(r[r.FULL_SIZE=0]="FULL_SIZE",r[r.THUMBNAIL=1]="THUMBNAIL",r[r.EMOJI=2]="EMOJI",r))(_u||{}),bi=class{hash(){return`${this.image.objectHash()}:${_u[this.purpose]}`}constructor(e,t){this.image=e,this.purpose=t}};var lc;(n=>{function i(){return new Map}n._new=i;function e(o,a){o.set(a.hash(),a)}n.add=e;function t(o){let a=o;return Array.from(a.values())}n.asList=t;function r(o,a){let s=a,l=o;He.StringMap_each(s,(c,d)=>{l.set(c,d)})}n.addAllImagesInSet=r})(lc||(lc={}));var pm=class{constructor(e,t,r){this.includesBackgroundColor=e,this.status=t,this.neededImagesOrNull=r}};function BA(){return Dr.SSAA_SIZE()}var vo=class i{constructor(e,t){this._frameBudgetInformation=null;this._interruptedCommands=new Array;this._interruptArgs=null;this._currentlyInDissolveCounter=0;this._currentlyInVolatilePropertyCounter=0;this._canvas=null,this._backgroundEnabled=!0,this._didDraw=!1,this._includesBackgroundColor=!1,this._boundsCache=null,this._canvasSpaceTileBounds=null,this._neededImagesOrNull=null,this._context=null,this._quadArea=null,this._bufferPool=null,this._transparentClearTexture=null,this._tileStack=null,this._ssaaState=new hm,this._downsampleNeedsBlend=!1,this._shouldDisableAllAntialiasing=!1,this._clampedBlurMaterial=null,this._unclampedBlurMaterial=null,this._rectangleBlurMaterial=null,this._roundedRectangleBlurMaterial=null,this._upscaleTileMaterial=null,this._downscaleTileMaterial=null,this._hardMaskWithColorAndDownscaleTileMaterial=null,this._blendTextureMaterial=null,this._lerpTileMaterial=null,this._blendTileSimpleMaterial=null,this._blendTileCustomMaterial=null,this._maskInnerShadowTileMaterial=null,this._maskInnerShadowTileAndFirstHardMaskAlpha=null,this._maskBackgroundBlurTileMaterial=null,this._maskTileMaterial=null,this._maskTileLuminanceMaterial=null,this._maskTileLuminancePassThroughMaterial=null,this._maskTilePassThroughMaterial=null,this._maskKnockoutShadowTileMaterial=null,this._maskKnockoutShadowTilePassThroughMaterial=null,this._hardMaskTileWithColorMaterial=null,this._drawTextureMaterial=null,this._clearOnWindowsMaterial=null,this._superSSAA4x4DownsampleMaterial=null,this._requestImage=null,this._pathRasterizer=null,this._layerByLayerRendering=new Au,this._context=e,this._bufferPool=t,this._materialStrings=wr.instance(),this._quadArea=this._bufferPool.allocate(O.VertexFormat.getPositionF2CoordF3(),new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._transparentClearTexture=e.createTextureWithPixels(O.TextureFormat.RGBA_LINEAR_CLAMP,1,1,new Uint8Array([0,0,0,0]),"Transparent clear texture"),this._tileStack=new i.TileStack(e,(n,o)=>{this.clear(n,o)},this._transparentClearTexture),this._pathRasterizer=new Dr(this,this._context,this._bufferPool);let r=this._context.graphicsCardName();Ne.setFlushBeforeMasks(r.indexOf("NVIDIA")!=-1&&r.indexOf("Direct3D11")!=-1||X.getFeatureFlags().flush_before_masks),this._clampedBlurMaterial=this._context.createMaterial("clampedBlur",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_CLAMPED_BLUR_TILE_FRAGMENT),this._unclampedBlurMaterial=this._context.createMaterial("unclampedBlur",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_UNCLAMPED_BLUR_TILE_FRAGMENT),this._rectangleBlurMaterial=this._context.createMaterial("rectangleBlur",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_RECTANGLE_BLUR_VERTEX,this._materialStrings.GLSLX_SOURCE_RECTANGLE_BLUR_FRAGMENT),this._roundedRectangleBlurMaterial=this._context.createMaterial("roundedRectangleBlur",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_VERTEX,this._materialStrings.GLSLX_SOURCE_ROUNDED_RECTANGLE_BLUR_FRAGMENT),this._upscaleTileMaterial=this._context.createMaterial("upscaleTile",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_UPSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_UPSAMPLE_TILE_FRAGMENT),this._downscaleTileMaterial=this._context.createMaterial("downscaleTile",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_FRAGMENT),this._hardMaskWithColorAndDownscaleTileMaterial=this._context.createMaterial("hardMaskWithColorAndDownscaleTile",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DOWNSAMPLE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_HARD_MASK_WITH_COLOR_AND_DOWNSAMPLE_TILE_FRAGMENT),this._blendTextureMaterial=this._context.createMaterial("blendTexture",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT),this._lerpTileMaterial=this._context.createMaterial("lerpTexture",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_LERP_TILE_FRAGMENT),this._clearOnWindowsMaterial=this._context.createMaterial("clearOnWindows",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_SOLID_COLOR_PAINT_FRAGMENT),this._blendTileSimpleMaterial=this._context.createMaterial("blendTileSimple",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_TEXTURE_FRAGMENT),this._blendTileCustomMaterial=this._context.createMaterial("blendTileCustom",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_BLEND_MODE_FRAGMENT),this._maskInnerShadowTileMaterial=this._context.createMaterial("maskInnerShadowTile",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_FRAGMENT),this._maskInnerShadowTileAndFirstHardMaskAlpha=this._context.createMaterial("maskInnerShadowTileAndFirstHardMaskAlpha",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_INNER_SHADOW_TILE_AND_FIRST_HARD_MASK_ALPHA_FRAGMENT),this._maskBackgroundBlurTileMaterial=this._context.createMaterial("maskBackgroundBlurTile",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_BACKGROUND_BLUR_TILE_FRAGMENT),this._maskTileMaterial=this._context.createMaterial("maskTile",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_FRAGMENT),this._maskTileLuminanceMaterial=this._context.createMaterial("maskTileLuminance",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_LUMINANCE_FRAGMENT),this._maskTileLuminancePassThroughMaterial=this._context.createMaterial("maskTileLuminancePassThrough",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_LUMINANCE_PASS_THROUGH_FRAGMENT),this._maskTilePassThroughMaterial=this._context.createMaterial("maskTilePassThrough",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_TILE_PASS_THROUGH_FRAGMENT),this._maskKnockoutShadowTileMaterial=this._context.createMaterial("maskKnockoutShadowTile",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_FRAGMENT),this._maskKnockoutShadowTilePassThroughMaterial=this._context.createMaterial("maskKnockoutShadowTile",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_MASK_KNOCKOUT_SHADOW_TILE_PASS_THROUGH_FRAGMENT),this._hardMaskTileWithColorMaterial=this._context.createMaterial("hardMaskWithColor",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_TILE_VERTEX,this._materialStrings.GLSLX_SOURCE_HARD_MASK_TILE_WITH_COLOR_FRAGMENT),this._drawTextureMaterial=this._context.createMaterial("drawTexture",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_DRAW_TEXTURE_VERTEX,this._materialStrings.GLSLX_SOURCE_DRAW_TEXTURE_FRAGMENT),this._superSSAA4x4DownsampleMaterial=this._context.createMaterial("superSSAA4x4Downsample",O.VertexFormat.getPositionF2CoordF3(),this._materialStrings.GLSLX_SOURCE_CLIP_SPACE_QUAD_VERTEX,this._materialStrings.GLSLX_SOURCE_SUPER_SSAA4X4_DOWNSAMPLE_TEXTURE_FRAGMENT)}context(){return this._context}bufferPool(){return this._bufferPool}totalVRAM(){let e=0;return e=e+this._pathRasterizer.totalVRAM(),e=e+this._tileStack.totalVRAM(),e}upscaleRectForSSAA(e){let t=Dr.SSAA_SIZE()/or.TILE_SIZE|0;return e.scaledBy1(t)}downscaleRectForSSAA(e){let t=or.TILE_SIZE/Dr.SSAA_SIZE();return e.scaledBy1(t)}setBackgroundEnabled(e){this._backgroundEnabled=e}currentTextureSize(){return this._currentTile1().tileSize()}markDidDraw(){this._didDraw=!0}pushSSAARenderState(e){if(this._shouldDisableAllAntialiasing){Le("Pushing SSAA state during final composite");return}if(this._ssaaState.level==0){this._tileStack.setSSAARenderState(),this._ssaaState.mode=e==null?0:1;let t=null;this._tileStack.isEmpty()||(t=this.upscaleRectForSSAA(O.FrozenScissors.last(this._currentTile1().scissors()).clone())),e!=null&&this._needsBackgroundColor(e)?(this.duplicateTile1(t),this._downsampleNeedsBlend=!0):(this._downsampleNeedsBlend=!1,this._tileStack.pushTile(t))}this._ssaaState!=null&&(this._ssaaState.level+=1)}popSSAARenderState(){if(this._shouldDisableAllAntialiasing){Le("Popping SSAA state during final composite");return}if(this._ssaaState!=null&&(this._ssaaState.level-=1),this._ssaaState.level==0){let e=this._tileStack.popTile();this._tileStack.unsetSSAARenderState(),this._downsampleNeedsBlend?O.in_Context.Context_setCopyBlendState(this._context):O.in_Context.Context_setPremultipliedBlendState(this._context),this.downsampleSuperSSAATile(e),this._tileStack.freeTileToPool(e)}}supersampleState(){return this._ssaaState}currentTile(){return this._currentTile1()}computeTileTransform(){return ee.new2().scaledBy2(1/this._canvasSpaceTileBounds.size().x()).translatedBy1(new R(-this._canvasSpaceTileBounds.x(),-this._canvasSpaceTileBounds.y()))}canvasSpaceToViewSpaceScale(){return this._tileSize/this._canvasSpaceTileBounds.size().x()}drawTileContinued(e,t,r,n,o,a,s){this._canvasSpaceTileBounds=new V(t,r,n,n),this._boundsCache=a.boundsCache;let l=this.computeTileTransform(),c=new Su(a.renderTree,l,this._interruptArgs.framebuffer,this._interruptArgs.originalOutputTextureFormat);if(this._currentTile1().bind(),!c.equals(this._interruptArgs)||this._interruptedCommands.length==0)return Le("Clearing interrupt state, prototype in potentially precarious state."),null;this._interruptArgs.framebuffer.colorTexture().format()!=O.TextureFormat.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP);let h=this._interruptedCommands;return this._interruptedCommands=new Array,this._frameBudgetInformation=s,h.forEach(m=>{if(this._interruptedCommands.length>0)this._interruptedCommands.push(m);else switch(m.type){case 1:let g=m;this.visitWithCanvasSpaceTileBounds(g.node,g.transform,g.canvasSpaceTilebounds,g.inverseVolatileTransform,g.interruptIndex);break;case 2:let _=m;this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(_.scissor);break;case 3:let f=m;this.visitGroupChildWithSSAA(f.node,f.transform,f.canvasSpaceTileBounds,f.inverseVolatileTransform);break;case 4:let S=m;this.renderBlend(S.blendIsNoOp,S.node,S.transform,S.canvasSpaceTileBounds,S.inverseVolatileTransform,1);break;default:}}),this._interruptedCommands.length>0?this._interruptArgs=c:this._tileStack.popScissorFromCurrentTile(),this._interruptedCommands.length==0&&this._interruptArgs.originalOutputTextureFormat!=O.TextureFormat.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(this._interruptArgs.originalOutputTextureFormat),this.drawTileFinish(c,e,this._interruptArgs.framebuffer)}cleanUpExistingInterrupt(){for(this._interruptArgs.originalOutputTextureFormat!=O.TextureFormat.RGBA_LINEAR_CLAMP&&this._interruptArgs.framebuffer.colorTexture().setFormat(this._interruptArgs.originalOutputTextureFormat),this._interruptedCommands=new Array,this._interruptArgs=null,this._frameBudgetInformation=null,this._currentlyInDissolveCounter=0,this._currentlyInVolatilePropertyCounter=0;this._tileStack.count()>0;)if(this._tileStack.count()==1&&!this._tileStack.last().isBackedBySingleTileTexture()){this._tileStack.popScissorFromCurrentTile(),this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(C.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(O.Clear.COLOR);let e=this._tileStack.popTile();this._tileStack.assertPoolAfterRender()}else this._tileStack.freeTileToPool(this._tileStack.popTile())}drawTile(e,t,r,n,o,a,s){return this._context.annotateAndReturn(`Draw tile (${t}, ${r})`,()=>{let l=o.colorTexture().format();a.useLargeTilesForDrawToScreen&&this._tileStack.setDrawToScreenLargeTileState(),a.shouldDisableAllAntialiasing,l!=O.TextureFormat.RGBA_LINEAR_CLAMP&&o.colorTexture().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._requestImage=a.requestImage,this._boundsCache=a.boundsCache,this._canvasSpaceTileBounds=new V(t,r,n,n),this._tileSize=a.useLargeTilesForDrawToScreen?Dr.SSAA_SIZE():or.TILE_SIZE,this._shouldDisableAllAntialiasing=a.shouldDisableAllAntialiasing,this._neededImagesOrNull=a.shouldCollectNeededImages?lc._new():null;let c=this.computeTileTransform(),d=a.renderTree;this._frameBudgetInformation=s;let h=new Su(d,c,o,l);if(this._didDraw=!1,this._includesBackgroundColor=!1,this._includesBackgroundColor=d!=null&&this.nodeNeedsBackgroundColor(d,c),this._includesBackgroundColor){let m=C.premultiplied(C.TRANSPARENT);this._tileStack.pushTileBackedByExistingFramebufferAndClearToColor(o,e,a,m)}else this._tileStack.pushTileBackedByExistingFramebuffer(o,e,a);if(d!=null){let m=this.allocateAndComputeTileScissor(c,this.bounds(d));this._tileStack.last().pushScissor2(m);let g=ee.new2();this.visit(d,ee.new3(c),g,0),this._interruptedCommands.length==0&&this._tileStack.popScissorFromCurrentTile()}this._interruptedCommands.length>0&&(this._interruptArgs=h);let u=this.drawTileFinish(h,e,o);return this._interruptedCommands.length==0&&l!=O.TextureFormat.RGBA_LINEAR_CLAMP&&o.colorTexture().setFormat(l),a.useLargeTilesForDrawToScreen&&this._tileStack.unsetDrawToScreenLargeTileState(),u})}setCanvas(e){this._canvas!=e&&(this._canvas=e,this._pathRasterizer.clearGradientCache())}drawToCurrentTile(e,t,r){let n=this._currentTile1().needsColorClear(),o=this._context.currentStencilState().isEnabled&&this._currentTile1().needsDepthStencilClear();if(n||o){let a=this._context.currentStencilState(),s=this._context.currentBlendState();this._context.setStencilState(O.StencilState.NONE),O.in_Context.Context_setCopyBlendState(this._context);let l=n&&o?O.Clear.ALL:n?O.Clear.COLOR:O.Clear.DEPTH_STENCIL;this._currentTile1().doDeferredClear(l),this._context.setStencilState(a),this._context.setBlendState(s)}this._context.draw(e,t,r),this._currentTile1().setIsColorClear(!1)}clear(e,t){this._context.setFramebuffer(t),this._context.clear(O.Clear.COLOR,e)}_currentTile1(){return this._tileStack.last()}_currentTile2(e){return this._tileStack.get(this._tileStack.count()-e-1)}_needsBackgroundColor(e){return e.hasNonIsolatedBlends()||e.hasBackgroundBlurs()}bounds(e){return e.currentBounds(this._boundsCache)}nodeNeedsBackgroundColor(e,t){let r=V.new3(this.bounds(e));t.transformRect(r);let n=V.UNIT.overlaps(r);if(e==null||!this._needsBackgroundColor(e)||!n)return!1;if(e.op()==1){let o=e;for(let a of o.children){let s=V.new3(this.bounds(a)),l=V.UNIT.overlaps(t.transformRect(s));if(this._needsBackgroundColor(a)&&l)return!0}return!1}return!0}drawTileFinish(e,t,r){if(this._interruptedCommands.length==0){this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(C.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(O.Clear.COLOR);let n=this._tileStack.popTile();this._interruptArgs=null,this._tileStack.assertPoolAfterRender()}else this._context.setFramebuffer(null);return this._frameBudgetInformation=null,new pm(this._includesBackgroundColor,this._interruptedCommands.length>0?1:0,this._neededImagesOrNull)}visit(e,t,r,n){let o=V.new3(V.UNIT),a=ee.new3(t);a.invert();let s=a.transformRect(o);this.visitWithCanvasSpaceTileBounds(e,t,s,r,n)}visitWithCanvasSpaceTileBounds(e,t,r,n,o){this._context.annotateProfile(e.opProfileString(),()=>{this._visitWithCanvasSpaceTileBounds(e,t,r,n,o)})}_visitWithCanvasSpaceTileBounds(e,t,r,n,o){var a;if(r.overlaps(this.bounds(e))&&!O.FrozenScissors.isEmpty(this._currentTile1().scissors())){if(this._frameBudgetInformation){if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Si(e,t,r,n,o));return}else if(!this._frameBudgetInformation.permitsMoreWork()){Lt.didEncounterIntraTileInterruptOpt();let s=this._ssaaState.level!=0||this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,l=this._currentlyInDissolveCounter>0;if(!(this._currentlyInVolatilePropertyCounter>0)&&!l&&!s&&X.enableIntraTileInterrupts()){this._interruptedCommands.push(new Si(e,t,r,n,o));return}}}switch(e.op()){case 0:{let s=e;this.visitWithCanvasSpaceTileBounds(s.child,t,r,n,0);break}case 2:{let s=e;this._shouldDisableAllAntialiasing?this.visitWithCanvasSpaceTileBounds(s.child,t,r,n,0):(this.pushSSAARenderState(s.child),this.visitWithCanvasSpaceTileBounds(s.child,t,r,n,0),this.popSSAARenderState());break}case 1:{let s=e;this.visitGroupHelper(s,t,r,n,o);break}case 3:{let s=e,l=this._shouldDisableAllAntialiasing?0:s.desiredAntialiasing();this._pathRasterizer.beginBatch(l),this._pathRasterizer.renderFill(t,s),this._pathRasterizer.finishBatch();break}case 4:{let s=e,l=this._shouldDisableAllAntialiasing?0:s.desiredAntialiasing();this._pathRasterizer.beginBatch(l),this._pathRasterizer.renderFillStroke(t,s),this._pathRasterizer.finishBatch();break}case 5:{let s=e,l=(s.type==0||s.type==4||s.type==1)&&s.hasNonIsolatedBlends(),c=this.allocateAndComputeTileScissor(t,this.bounds(s.color)),d=s.type==0&&!s.hasNonIsolatedBlends()&&s.alpha.isAxisAlignedRectFill()&&s.alpha.op()==3&&Ce.containsAtLeastOneVisibleOpaquePaint(s.alpha.geometry.paints),h=d?s.alpha.geometryBounds():this.bounds(s.alpha),u=s.type==2||bs&&s.type==3?this.allocateAndComputeTileScissor(t,h):s.type==4?c:this.allocateAndComputeTileScissor(t,h).intersectedWith(c);if(d){let f=this._tileStack.takeScissorFromCurrentTile();if(u.intersectWith(f),this._tileStack.pushScissor(u),this.visitWithCanvasSpaceTileBounds(s.color,t,r,n,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new hu(f));return}else{this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(f);return}}let m=V.new3(O.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(u);if(o<1){if(m.isEmpty())return;if(l?(this.duplicateTile1(m),this.duplicateTile1(m)):s.type==3?this._tileStack.pushTileAndClearToColor(C.premultiplied(this._canvas.computedBackgroundColor()),m):this._tileStack.pushTile(m),this.visitWithCanvasSpaceTileBounds(s.color,t,r,n,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new Si(e,t,r,n,1));return}}if(o<2&&(this._tileStack.pushTile(m),this.visitWithCanvasSpaceTileBounds(s.alpha,t,r,n,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Si(e,t,r,n,2));return}let g=this._tileStack.popTile(),_=this._tileStack.popTile();switch(s.type){case 0:{if(l){let f=this._tileStack.popTile();this.maskTilePassThrough(f,g,_,m),this._tileStack.freeTileToPool(f)}else this.maskTile(g,_,m);break}case 1:{if(l){let f=this._tileStack.popTile();this.maskTileLuminancePassThrough(f,g,_,m),this._tileStack.freeTileToPool(f)}else this.maskTileLuminance(g,_,m);break}case 4:{if(l){let f=this._tileStack.popTile();this.maskKnockoutShadowTilePassThrough(f,g,_,m),this._tileStack.freeTileToPool(f)}else this.maskKnockoutShadowTile(g,_,m);break}case 3:{this.maskBackgroundBlurTile(g,_,m);break}case 2:{this.maskInnerShadowTile(g,_,m,s.innerShadowFill,s.innerShadowAlphaRequiresHardMask);break}}this._tileStack.freeTileToPool(g),this._tileStack.freeTileToPool(_);break}case 9:{let s=e,l=this.allocateAndComputeTileScissor(t,this.bounds(s.alpha)),c=V.new3(O.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);if(c.isEmpty())return;if(o<1&&(this._tileStack.pushTile(c),this.visitWithCanvasSpaceTileBounds(s.alpha,t,r,n,0),this._interruptedCommands.length>0)){this._interruptedCommands.push(new Si(e,t,r,n,1));return}let d=this._tileStack.popTile();this.hardMaskTileWithColor(d,s.color,c),this._tileStack.freeTileToPool(d);break}case 6:{let s=e,l=V.new3(this.bounds(s));t.transformRect(l),l.scaledBy1(this.currentTextureSize());let c=s.radius*t.scale1().max1(),d=V.new3(O.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);if(d.isEmpty())return;if(c<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(s.child,t,r,n,0);return}let h=FA(s.child),u=h.a,m=h.b??Nt.FrozenAffineTransform_IDENTITY,g=u.isRectFill()?u:null;if(g!=null&&s.clamp.isInvalid()){let f=Ce.onlySolidPaintOrNull(g.geometry.paints);if(f!=null){let S=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(m).multipliedBy1(g.transform);this.renderBlurredRectangle(S,g.geometry.path().bounds(),C.multiplyOpacity(f.color(),f.opacity()),s.radius);return}}let _=u.isRoundedRectFill()?u:null;if(_!=null&&s.clamp.isInvalid()){let f=_.geometry.path().path(),S=f.radii();if(S.isUniform()){let b=Ce.onlySolidPaintOrNull(_.geometry.paints);if(b!=null){let T=S.topLeft,y=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(m).multipliedBy1(_.transform);this.renderBlurredRoundedRectangle(y,f.bounds(),T,C.multiplyOpacity(b.color(),b.opacity()),s.radius);return}}}this.renderBlur(e,t,c,d,n,s.clamp,r,o);break}case 7:{let s=e,l=dE(s.blendMode)&&(this._currentTile1().isColorClear()||this._currentTile1().needsColorClear())&&s.opacity==1;this.renderBlend(l,s,t,r,n,0);break}case 8:{let s=e;this.visitCompositeChildWithOpacity(s,1,t,r);break}case 10:{this._currentlyInVolatilePropertyCounter++;let s=e;switch(s.property){case 2:{let l=ee.new3(t);l.multipliedBy1(s.transform());let c=ee.new3(s.transform());c.invert()||c.copyFrom(Nt.FrozenAffineTransform_IDENTITY),c.multipliedBy1(n),this.visit(s.child,l,c,0);break}case 1:{let l=ee.new2();this.visitWithCanvasSpaceTileBounds(s.child,t,r,l,0);break}case 0:{let l=ee.new2(),c=ee.new2();l.copyFrom(t).multipliedBy1(n),this.visit(s.child,l,c,0);break}case 4:{let l=s.opacity(),c=!1;if(l==1)this.visitWithCanvasSpaceTileBounds(s.child,t,r,n,0),c=!0;else if(l==0)c=!0;else if(s.child.op()==3){let d=s.child,h=(a=Ce.onlyPaintOrNull(d.geometry.paints))==null?void 0:a.asSinglePaint();if(h!=null){let u=h.cloneAsSinglePaint();u.setOpacity(u.opacity()*l),this.visitWithCanvasSpaceTileBounds(d.withPaints([u]),t,r,n,0),c=!0}}else if(s.child.op()==8){let d=s.child;this.visitCompositeChildWithOpacity(d,l,t,r),c=!0}if(!c){let d=this.allocateAndComputeTileScissor(t,this.bounds(s.child)),h=V.new3(O.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(d);s.child.hasNonIsolatedBlends()?this.duplicateTile1(h):this._tileStack.pushTile(h),this.visitWithCanvasSpaceTileBounds(s.child,t,r,n,0),s.child.hasNonIsolatedBlends()?this.blendAndPopTile("PASS_THROUGH",l):this.blendAndPopTile("NORMAL",l)}break}case 3:{this.visitWithCanvasSpaceTileBounds(s.child,t,r,n,0);break}case 5:{this.visitWithCanvasSpaceTileBounds(s.child,t,r,n,0);break}default:throw new Error(`Unhandled VolatileProperty value ${ca.VolatileProperty_toString(s.property)}`)}this._currentlyInVolatilePropertyCounter--;break}case 11:{let s=e,l=ee.new3(t);l.multipliedBy1(s.transform);let c=ee.new3(s.transform);c.invert()||c.copyFrom(Nt.FrozenAffineTransform_IDENTITY),c.multipliedBy1(n),this.visit(s.child,l,c,0);break}case 12:{this._currentlyInDissolveCounter++;let s=e,l=this.allocateAndComputeTileScissor(t,this.bounds(s.startChild)),c=this.allocateAndComputeTileScissor(t,this.bounds(s.endChild)),d=V.new2();d.copyFrom(O.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);let h=d.clone().scaledBy1(1/this.currentTextureSize());s.startChild.hasNonIsolatedBlends()?this.duplicateTile1(d):this._tileStack.pushTile(d),this.visitWithCanvasSpaceTileBounds(s.startChild,t,r,n,0);let u=this._tileStack.popTile();d.copyFrom(O.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(c);let m=d.clone().scaledBy1(1/this.currentTextureSize());s.endChild.hasNonIsolatedBlends()?this.duplicateTile1(d):this._tileStack.pushTile(d),this.visitWithCanvasSpaceTileBounds(s.endChild,t,r,n,0);let g=this._tileStack.popTile();this._lerpTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,u.colorTextureForSampling(),0),this._lerpTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,g.colorTextureForSampling(),1),O.in_Material.Material_setUniformVec43(this._lerpTileMaterial,this._materialStrings.GLSLX_NAME_U_TEXTURE0_UV_SPACE_SCISSOR,h),O.in_Material.Material_setUniformVec43(this._lerpTileMaterial,this._materialStrings.GLSLX_NAME_U_TEXTURE1_UV_SPACE_SCISSOR,m),this._lerpTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,Xt.double_clamp(s.progress(),0,1)),O.in_Context.Context_setPremultipliedBlendState(this._context);let _=this.allocateAndComputeTileScissor(t,this.bounds(e));this._tileStack.pushScissor(_),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._lerpTileMaterial,this._quadArea),this._tileStack.popScissorFromCurrentTile(),this._tileStack.freeTileToPool(g),this._tileStack.freeTileToPool(u),this._currentlyInDissolveCounter--;break}}}}visitCompositeChildWithOpacity(e,t,r,n){let o=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(r),a=this.allocateAndComputeTileScissor(r,this.bounds(e));this._tileStack.pushScissor(a),e.forEachTileWithinBounds(1,n,s=>{let l=s.textureRegionOrNull();if(l!=null&&(this.drawTextureRegion2(l,s.canvasSpaceBounds(),o,1,t),s.neededImagesOrNull!=null)){let c=lc.asList(s.neededImagesOrNull);for(let d of c)this.getOrCreateImageTexture(d)}}),this._tileStack.popScissorFromCurrentTile()}visitGroupHelper(e,t,r,n,o){if(o<1){for(let a of e.children)this.visitGroupChildWithSSAA(a,t,r,n);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Si(e,t,r,n,1));return}}this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.finishBatch()}visitGroupChildWithSSAA(e,t,r,n){if(!O.FrozenScissors.last(this._currentTile1().scissors()).overlaps(this.allocateAndComputeTileScissor(t,this.bounds(e))))return;let a=this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,s=e.desiredAntialiasing()==2&&!this._shouldDisableAllAntialiasing;if(this._interruptedCommands.length>0){this._interruptedCommands.push(new pu(e,t,r,n));return}s&&!a?this._pathRasterizer.beginBatch(2):!s&&a&&this._pathRasterizer.finishBatch(),s?e.op()==3?this._pathRasterizer.renderFill(t,e):e.op()==4&&this._pathRasterizer.renderFillStroke(t,e):this.visitWithCanvasSpaceTileBounds(e,t,r,n,0)}allocateAndComputeTileScissor(e,t){let r=V.new3(t);e.transformRect(r);let n=r.scaledBy1(this.currentTextureSize());return X.useIntBoundariesForScissor()?n.expandToInts():n.round(),n}renderBlurredRectangle(e,t,r,n){C.alpha(r)!=0&&(O.in_Material.Material_setUniformMat32(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),O.in_Material.Material_setUniformVec42(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,C.premultiplied(r)),O.in_Material.Material_setUniformVec43(this._rectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),this._rectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_BLUR_RADIUS,n),O.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._rectangleBlurMaterial,this._quadArea),this._didDraw=!0)}renderBlurredRoundedRectangle(e,t,r,n,o){C.alpha(n)!=0&&(O.in_Material.Material_setUniformMat32(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,e),O.in_Material.Material_setUniformVec42(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,C.premultiplied(n)),O.in_Material.Material_setUniformVec43(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),this._roundedRectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_CORNER_RADIUS_OVER_BLUR_RADIUS,r/o),O.in_Material.Material_setUniformVec22(this._roundedRectangleBlurMaterial,this._materialStrings.GLSLX_NAME_U_HALF_SIZE_OVER_BLUR_RADIUS,t.size().divide(2*o)),this._roundedRectangleBlurMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_BLUR_RADIUS,o),O.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._roundedRectangleBlurMaterial,this._quadArea),this._didDraw=!0)}renderBlur(e,t,r,n,o,a,s,l){let c=e,d=32,h=.5,u=1/(1+2*r),m=Math.min(d,u*r*this.currentTextureSize()),g=m/this.currentTextureSize(),_=g/r;_>2/h/this.currentTextureSize()&&(_=Math.round(_*(this.currentTextureSize()*h))/(this.currentTextureSize()*h),m=Math.min(d/h,_*r*this.currentTextureSize()),g=m/this.currentTextureSize());let f=ee.new2().translatedBy2(.5,.5).scaledBy2(_).translatedBy2(-.5,-.5),S=V.new3(n).scaledBy1(1/this.currentTextureSize());f.transformRect(S);let b=V.new3(S).expandedBy2(0,g),T=V.new3(b).expandedBy2(g,0),y=f.multipliedBy1(t),I=null;if(!a.isInvalid()){I=y.transformRect(a.clone()),I.scaledBy1(this.currentTextureSize());let E=Math.ceil(I.left()-.5)+.5,D=Math.ceil(I.top()-.5)+.5,G=Math.floor(I.right()+.5)-.5,U=Math.floor(I.bottom()+.5)-.5;I=new V(E,D,G-E,U-D),I.scaledBy1(1/this.currentTextureSize())}let p=m>4,A=p&&c.child.op()==9;if(l<1){if(this._tileStack.pushTile(V.new3(T).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),A){let E=c.child;this.visit(E.alpha,y,o,0)}else this.visit(c.child,y,o,0);if(this._interruptedCommands.length>0){this._interruptedCommands.push(new Si(e,t,s,o,1));return}}let v=!1;if(p){let E=m*h,D=V.new3(T).scaledBy1(h),G=V.new3(b).scaledBy1(h),U=V.new3(S).scaledBy1(h),M=null;if(I!=null){M=V.new3(I).scaledBy1(h),M.scaledBy1(this.currentTextureSize());let ne=Math.ceil(M.left()-.5)+.5,W=Math.ceil(M.top()-.5)+.5,K=Math.floor(M.right()+.5)-.5,j=Math.floor(M.bottom()+.5)-.5;M=new V(ne,W,K-ne,j-W),M.scaledBy1(1/this.currentTextureSize())}let z=this._tileStack.popTile(),B=V.new3(D).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();if(this._tileStack.pushTile(B,v),A){let ne=c.child;this.hardMaskWithColorAndDownscaleTile(z,ne.color,D,T)}else this.downscaleTile(z,D,T);this._tileStack.freeTileToPool(z);let w=this._tileStack.popTile(),P=V.new3(G).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(P,v),this.blurTile(w,1/this.currentTextureSize(),0,V.new3(P).scaledBy1(1/this.currentTextureSize()),E,M),this._tileStack.freeTileToPool(w);let H=this._tileStack.popTile(),Q=V.new3(U).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(Q,v),this.blurTile(H,0,1/this.currentTextureSize(),V.new3(Q).scaledBy1(1/this.currentTextureSize()),E,M),this._tileStack.freeTileToPool(H);let Y=this._tileStack.popTile();this.upscaleTile(Y,n.scaledBy1(1/this.currentTextureSize()),U),this._tileStack.freeTileToPool(Y)}else{let E=this._tileStack.popTile(),D=V.new3(b).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(D,v),this.blurTile(E,1/this.currentTextureSize(),0,V.new3(D).scaledBy1(1/this.currentTextureSize()),m,I),this._tileStack.freeTileToPool(E);let G=this._tileStack.popTile(),U=V.new3(S).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTile(U,v),this.blurTile(G,0,1/this.currentTextureSize(),V.new3(U).scaledBy1(1/this.currentTextureSize()),m,I),this._tileStack.freeTileToPool(G);let M=this._tileStack.popTile();this.upscaleTile(M,n.scaledBy1(1/this.currentTextureSize()),S),this._tileStack.freeTileToPool(M)}}hardMaskTileWithColor(e,t,r){let n=V.new3(r);O.in_Material.Material_setUniformVec43(this._hardMaskTileWithColorMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(n)),O.in_Material.Material_setUniformVec42(this._hardMaskTileWithColorMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,C.premultiplied(t)),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._hardMaskTileWithColorMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),O.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._hardMaskTileWithColorMaterial,this._quadArea),this._didDraw=!0,e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP)}blurTile(e,t,r,n,o,a){let s=null;a==null?s=this._unclampedBlurMaterial:(s=this._clampedBlurMaterial,O.in_Material.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_BLUR_CLAMP,a)),O.in_Material.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_QUAD,n),s.setUniformFloat(this._materialStrings.GLSLX_NAME_U_COUNT,o),s.setUniformVec21(this._materialStrings.GLSLX_NAME_U_BLUR_DELTA,t,r),s.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),O.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,s,this._quadArea),this._didDraw=!0}scissorQuad(e){return e.scaledBy1(1/this.currentTextureSize())}blendAndPopTile(e,t){if(e=="PASS_THROUGH"||e=="NORMAL"||e=="SCREEN"){let r=this._tileStack.popTile(),n=this.scissorQuad(V.new3(O.FrozenScissors.last(r.scissors())));O.in_Material.Material_setUniformVec43(this._blendTileSimpleMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,n),e=="PASS_THROUGH"?(this._blendTileSimpleMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,1),O.in_Context.Context_setInterpolateBlendState(this._context,t)):(this._blendTileSimpleMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,t),e=="SCREEN"?O.in_Context.Context_setScreenBlendState(this._context):O.in_Context.Context_setPremultipliedBlendState(this._context)),r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._blendTileSimpleMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,r.colorTextureForSampling(),0),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._blendTileSimpleMaterial,this._quadArea),this._didDraw=!0,r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(r)}else{this.duplicateTile2(O.FrozenScissors.last(this._currentTile1().scissors()),1);let r=this._tileStack.popTile(),n=this._tileStack.popTile(),o=this.scissorQuad(V.new3(O.FrozenScissors.last(n.scissors())));O.in_Material.Material_setUniformVec43(this._blendTileCustomMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,o),this._blendTileCustomMaterial.setUniformInt(this._materialStrings.GLSLX_NAME_U_TYPE,uE.get(e)),this._blendTileCustomMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,t),n.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._blendTileCustomMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,n.colorTextureForSampling(),0),this._blendTileCustomMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,r.colorTextureForSampling(),1),O.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._blendTileCustomMaterial,this._quadArea),this._didDraw=!0,r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(r),this._tileStack.freeTileToPool(n)}}upscaleTile(e,t,r){O.in_Material.Material_setUniformVec43(this._upscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),O.in_Material.Material_setUniformVec43(this._upscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,r),this._upscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),O.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._upscaleTileMaterial,this._quadArea),this._didDraw=!0}downscaleTile(e,t,r){O.in_Material.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,t),O.in_Material.Material_setUniformVec43(this._downscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,r),this._downscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),O.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._downscaleTileMaterial,this._quadArea),this._didDraw=!0}hardMaskWithColorAndDownscaleTile(e,t,r,n){O.in_Material.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,r),O.in_Material.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_SOURCE,n),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),O.in_Material.Material_setUniformVec42(this._hardMaskWithColorAndDownscaleTileMaterial,this._materialStrings.GLSLX_NAME_U_COLOR,C.premultiplied(t)),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_TEXTURE_SIZE,this.currentTextureSize()),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_TEXTURE_PX,1/this.currentTextureSize()),O.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._hardMaskWithColorAndDownscaleTileMaterial,this._quadArea),this._didDraw=!0}_advanceGIFAndUpload(e,t){let r=e.gif().nextFrameIfNecessary();r!=null&&O.in_Texture.Texture_resize3(t,e.width(),e.height(),_r.createFromPixels(e.width(),e.height(),r))}getOrCreateImageTexture(e){var o,a;if((e==null?void 0:e.image)==null)return null;this._neededImagesOrNull!=null&&lc.add(this._neededImagesOrNull,e);let t=e.image,r=e.purpose,n=t.texture();return n!=null?t.gif()!=null&&this._advanceGIFAndUpload(t,n):(((o=t.decodedData())==null?void 0:o.pixels)!=null||t.gif()!=null)&&(n=this._context.createTexture(O.TextureFormat.RGBA_NEAREST_CLAMP,t.width(),t.height(),"Image"),n.setShouldUnloadImageBuffer(X.shouldApplyMobileOptimizations()),t.setTexture(n),((a=t.decodedData())==null?void 0:a.pixels)!=null?(O.in_Texture.Texture_resize3(t.texture(),t.width(),t.height(),t.decodedData()),X.shouldApplyMobileOptimizations()&&t.freeMemoryForDecodedData()):t.gif()!=null&&this._advanceGIFAndUpload(t,n)),t.state()==0&&this._requestImage(t,r),n}duplicateTile1(e){this.duplicateTile2(e,0)}duplicateTile2(e,t){let r=this._currentTile2(t),n=r.isColorClear()||r.needsColorClear(),o=n;this._tileStack.pushTile(e,o);let a=this._currentTile1();if(n)return;let s=r.colorTextureForSampling();s.setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP);let l=r.uvSpaceRect(),c=this.scissorQuad(V.new3(e)),d=new V(l.x()+l.width()*c.x(),l.y()+l.height()*c.y(),l.width()*c.width(),l.height()*c.height()),h=new V(-1+2*c.x(),-1+2*c.y(),2*c.width(),2*c.height());this.drawTexture1(s,d,null,h,0),s.setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP)}renderBlend(e,t,r,n,o,a){if(a<1){let s=this.allocateAndComputeTileScissor(r,this.bounds(t.child)),l=V.new3(O.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(s);if(l.isEmpty())return;if(e?this._currentTile1().pushScissor2(l.clone()):t.blendMode=="PASS_THROUGH"?this.duplicateTile1(l):this._tileStack.pushTile(l),this.visitWithCanvasSpaceTileBounds(t.child,r,n,o,0),this._interruptedCommands.length>0){this._interruptedCommands.push(new mu(e,t,r,n,o));return}}e?this._currentTile1().popScissor():this.blendAndPopTile(t.blendMode,t.opacity)}maskBackgroundBlurTile(e,t,r){Ne.flushBeforeMasks()&&this._context.flush();let n=V.new3(r);O.in_Material.Material_setUniformVec43(this._maskBackgroundBlurTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(n)),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._maskBackgroundBlurTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),this._maskBackgroundBlurTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),O.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._maskBackgroundBlurTileMaterial,this._quadArea),this._didDraw=!0,e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP)}maskInnerShadowTile(e,t,r,n,o){Ne.flushBeforeMasks()&&this._context.flush();let a=V.new3(r),s=o?this._maskInnerShadowTileAndFirstHardMaskAlpha:this._maskInnerShadowTileMaterial;O.in_Material.Material_setUniformVec43(s,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(a)),O.in_Material.Material_setUniformVec42(s,this._materialStrings.GLSLX_NAME_U_COLOR,C.premultiplied(n)),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),s.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),s.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),O.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,s,this._quadArea),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTile(e,t,r){Ne.flushBeforeMasks()&&this._context.flush();let n=V.new3(r);O.in_Material.Material_setUniformVec43(this._maskTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(n)),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),this._maskTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),O.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._maskTileMaterial,this._quadArea),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminance(e,t,r){Ne.flushBeforeMasks()&&this._context.flush();let n=V.new3(r);O.in_Material.Material_setUniformVec43(this._maskTileLuminanceMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(n)),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileLuminanceMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),this._maskTileLuminanceMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),O.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._maskTileLuminanceMaterial,this._quadArea),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminancePassThrough(e,t,r,n){Ne.flushBeforeMasks()&&this._context.flush();let o=V.new3(n);O.in_Material.Material_setUniformVec43(this._maskTileLuminancePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,r.colorTextureForSampling(),0),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),this._maskTileLuminancePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_MASK_TEXTURE,t.colorTextureForSampling(),2),O.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._maskTileLuminancePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTilePassThrough(e,t,r,n){Ne.flushBeforeMasks()&&this._context.flush();let o=V.new3(n);O.in_Material.Material_setUniformVec43(this._maskTilePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,r.colorTextureForSampling(),0),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),this._maskTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_MASK_TEXTURE,t.colorTextureForSampling(),2),O.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._maskTilePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTile(e,t,r){Ne.flushBeforeMasks()&&this._context.flush();let n=V.new3(r);O.in_Material.Material_setUniformVec43(this._maskKnockoutShadowTileMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(n)),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,t.colorTextureForSampling(),0),this._maskKnockoutShadowTileMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),O.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._maskKnockoutShadowTileMaterial,this._quadArea),e.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTilePassThrough(e,t,r,n){Ne.flushBeforeMasks()&&this._context.flush();let o=V.new3(n);O.in_Material.Material_setUniformVec43(this._maskKnockoutShadowTilePassThroughMaterial,this._materialStrings.GLSLX_NAME_U_QUAD,this.scissorQuad(o)),r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,r.colorTextureForSampling(),0),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE1,e.colorTextureForSampling(),1),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_MASK_TEXTURE,t.colorTextureForSampling(),2),O.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._maskKnockoutShadowTilePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(O.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}downsampleSuperSSAATile(e){let t=this.downscaleRectForSSAA(O.FrozenScissors.last(e.scissors()).clone());t.expand1(1),t.round(),this._tileStack.pushScissor(t);let r=null;switch(Dr.SUPERSAMPLE_COUNT()){case 4:{r=this._superSSAA4x4DownsampleMaterial;break}case 2:{r=this._blendTextureMaterial;break}default:throw new Error(`Unrecognized SUPERSAMPLE_COUNT (${Dr.SUPERSAMPLE_COUNT()}) when downsampling`)}r.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,1),r.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e.colorTextureForSampling(),0),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,r,this._quadArea),this._tileStack.popScissorFromCurrentTile()}drawTextureRegion1(e,t,r){this.drawTextureRegion2(e,t,Nt.FrozenAffineTransform_IDENTITY,r,1)}drawTextureRegion2(e,t,r,n,o){let a=e.uvSpaceRect,s=null;if(e.texture.format().minFilter==O.PixelFilter.LINEAR||e.texture.format().magFilter==O.PixelFilter.LINEAR){s=a.clone();let l=1/e.texture.width();s.contract(l/2)}this.drawTexture2(e.texture,e.uvSpaceRect,s,t,r,n,o)}drawTexture1(e,t,r,n,o){this.drawTexture2(e,t,r,n,Nt.FrozenAffineTransform_IDENTITY,o,1)}drawTexture2(e,t,r,n,o,a,s){this._setupDrawTextureState(e,t,r,n,o,a,s),this.drawToCurrentTile(O.Primitive.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea),this._didDraw=!0}drawTextureToCurrentFramebuffer(e,t,r,n,o,a,s){this._setupDrawTextureState(e,t,r,n,o,a,s),this._context.draw(O.Primitive.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea)}_setupDrawTextureState(e,t,r,n,o,a,s){switch(a){case 0:{O.in_Context.Context_setCopyBlendState(this._context);break}case 1:{O.in_Context.Context_setPremultipliedBlendState(this._context);break}}O.in_Material.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_UV_SPACE_CLAMPING_RECT,r??t),O.in_Material.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_UV_SPACE_SOURCE_RECT,t),O.in_Material.Material_setUniformMat32(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_TO_CLIP_SPACE_TRANSFORM,o),O.in_Material.Material_setUniformVec43(this._drawTextureMaterial,this._materialStrings.GLSLX_NAME_U_DESTINATION_RECT,n),this._drawTextureMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_OPACITY,s),this._drawTextureMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,e,0)}renderLayerByLayerActivate(e){this._layerByLayerRendering.activate(e)}renderLayerByLayerDeactivate(){this._layerByLayerRendering.deactivate()}finishLayerByLayerDrawToScreen(){this._layerByLayerRendering.finishLayerByLayerDrawToScreen()}isLayerByLayerRenderingEnabled(){return this._layerByLayerRendering.isEnabled()}treeToRender(e){return this._layerByLayerRendering.treeToRender(e)}renderLayerByLayerPlay(){this._layerByLayerRendering.play()}renderLayerByLayerPause(){this._layerByLayerRendering.pause()}renderLayerByLayerForward(){this._layerByLayerRendering.forward()}renderLayerByLayerBackward(){this._layerByLayerRendering.backward()}renderLayerByLayerRewind(){this._layerByLayerRendering.rewind()}renderLayerByLayerIncreaseSpeed(){this._layerByLayerRendering.increaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._layerByLayerRendering.decreaseSpeed()}};(r=>{class i{constructor(o,a,s,l,c,d,h){this.renderTree=o,this.shouldCollectNeededImages=a,this.boundsCache=s,this.requestImage=l,this.shouldDisableAllAntialiasing=c,this.outputTextureNeedsClear=d,this.useLargeTilesForDrawToScreen=h}}r.Options=i;class e{constructor(o,a,s){this._context=null,this._clear=null,this._transparentClearTexture=null,this._tilePools=new Map([[or.TILE_SIZE,[]],[Dr.SSAA_SIZE(),[]]]),this._stack=[],this._tileSizeState=r.TileStack.TileSizeState.REGULAR,this._liveTileCount=new Map([[or.TILE_SIZE,0],[Dr.SSAA_SIZE(),0]]),this._sharedStencilTexture=null,this._sharedSSAAStencilTexture=null,this._context=o,this._clear=a,this._transparentClearTexture=s,this._defaultScissors=new Map([[or.TILE_SIZE,new V(0,0,or.TILE_SIZE,or.TILE_SIZE)],[Dr.SSAA_SIZE(),new V(0,0,Dr.SSAA_SIZE(),Dr.SSAA_SIZE())]])}setSSAARenderState(){this._tileSizeState=r.TileStack.TileSizeState.SUPERSAMPLING}unsetSSAARenderState(){this._tileSizeState=r.TileStack.TileSizeState.REGULAR}setDrawToScreenLargeTileState(){this._tileSizeState=r.TileStack.TileSizeState.DRAW_TO_SCREEN_LARGE_TILES}unsetDrawToScreenLargeTileState(){this._tileSizeState=r.TileStack.TileSizeState.REGULAR}isEmpty(){return this._stack.length==0}count(){return this._stack.length}get(o){return this._stack[o]}last(){return this._stack.length==0?null:ce.List_last(this._stack)}assertPoolAfterRender(){}popScissorFromCurrentTile(){ce.List_last(this._stack).popScissor()}takeScissorFromCurrentTile(){return ce.List_last(this._stack).takeScissor()}freeTileToPool(o){o.clearScissors(),o.setIsColorClear(!1),o.setNeedsColorClear(!0),o.setNeedsDepthStencilClear(!0),o.setScissorForClear(null),o.tileSize()==Dr.SSAA_SIZE()?this._tilePools.get(Dr.SSAA_SIZE()).push(o):this._tilePools.get(or.TILE_SIZE).push(o)}pushScissor(o){let a=ce.List_last(this._stack);a.pushScissor2(o.clone());let s=a.scissorForClear()}pushTile(o,a=!0){let s=this._allocateTileFromPool();this._stack.push(s),s.bind(),a||s.setNeedsColorClear(!1),s.backingColorTexture().hasContentBeenInitialized()||s.setNeedsColorClear(!0),s.backingDepthStencilTexture()!=null&&!s.backingDepthStencilTexture().hasContentBeenInitialized()&&s.setNeedsDepthStencilClear(!0),X.viewerScissorClear()&&s.setScissorForClear(o??this.defaultTileScissor()),this.pushScissor(o)}pushTileAndClearToColor(o,a){this.pushTile(a),o!=C.TRANSPARENT&&ce.List_last(this._stack).clearToColor(o)}pushTileBackedByExistingFramebuffer(o,a,s){let l=s.outputTextureNeedsClear,c=s.useLargeTilesForDrawToScreen?Dr.SSAA_SIZE():or.TILE_SIZE,d=!l,h=new r.TileStackTile(1,c,this._context,o,a,this._clear,d,this._transparentClearTexture);this._stack.push(h),h.bind(),h.setNeedsColorClear(l),h.setNeedsDepthStencilClear(l)}pushTileBackedByExistingFramebufferAndClearToColor(o,a,s,l){this.pushTileBackedByExistingFramebuffer(o,a,s),l!=C.TRANSPARENT&&ce.List_last(this._stack).clearToColor(l)}popTile(){let o=this._stack.pop(),a=this.last();return a!=null?a.bind():this._context.setFramebuffer(null),o}totalVRAM(){let o=0;this._sharedStencilTexture!=null&&(o=o+O.in_Texture.Texture_totalVRAM(this._sharedStencilTexture));for(let a of this._tilePools.get(or.TILE_SIZE))o=o+O.in_Texture.Texture_totalVRAM(a.backingColorTexture());for(let a of this._tilePools.get(Dr.SSAA_SIZE()))o=o+O.in_Texture.Texture_totalVRAM(a.backingColorTexture());for(let a of this._stack)o=o+O.in_Texture.Texture_totalVRAM(a.backingColorTexture());return o}_pool(){return this._tileSizeState==r.TileStack.TileSizeState.REGULAR?this._tilePools.get(or.TILE_SIZE):this._tilePools.get(Dr.SSAA_SIZE())}_size(){return this._tileSizeState==r.TileStack.TileSizeState.REGULAR?or.TILE_SIZE:Dr.SSAA_SIZE()}defaultTileScissor(){return this._defaultScissors.get(this._size())}_purpose(){return this._tileSizeState==r.TileStack.TileSizeState.REGULAR?"TileStack":this._tileSizeState==r.TileStack.TileSizeState.SUPERSAMPLING?"SSAATileStack":"DrawToScreenLargeTiles"}_sizeState(){return this._tileSizeState}_allocateTileFromPool(){let o=this._pool(),a=this._size(),s=this._purpose(),l=this._sizeState(),c=null;if(o!=null&&o.length!=0)c=o.pop();else{this._liveTileCount.set(a,this._liveTileCount.get(a)+1);let d=null;l==r.TileStack.TileSizeState.REGULAR?(this._sharedStencilTexture==null&&(this._sharedStencilTexture=this._context.createTexture(O.TextureFormat.STENCIL,a,a,s)),d=this._sharedStencilTexture):(l==r.TileStack.TileSizeState.SUPERSAMPLING||l==r.TileStack.TileSizeState.DRAW_TO_SCREEN_LARGE_TILES)&&(this._sharedSSAAStencilTexture==null&&(this._sharedSSAAStencilTexture=this._context.createTexture(O.TextureFormat.STENCIL,a,a,s)),d=this._sharedSSAAStencilTexture),c=new r.TileStackTile(0,a,s,d,this._context,this._clear,this._transparentClearTexture)}return c}_isAllocatedUnusedTile(o){return o!=null&&o!=this.last()&&this._stack.indexOf(o)==-1&&this._tilePools.get(or.TILE_SIZE).indexOf(o)==-1&&this._tilePools.get(Dr.SSAA_SIZE()).indexOf(o)==-1}}r.TileStack=e,(o=>{let n;(c=>(c[c.REGULAR=0]="REGULAR",c[c.SUPERSAMPLING=1]="SUPERSAMPLING",c[c.DRAW_TO_SCREEN_LARGE_TILES=2]="DRAW_TO_SCREEN_LARGE_TILES"))(n=o.TileSizeState||(o.TileSizeState={}))})(e=r.TileStack||(r.TileStack={}));class t{constructor(){this._scissorForClear=null;if(arguments[0]==0){let[,o,a,s,l,c,d]=arguments;this._context=null,this._clear=null,this._framebuffer=null,this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=null,this._isColorClear=!1,this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=l,this._clear=c,this._framebuffer=this._context.createFramebuffer(this._context.createTexture(O.TextureFormat.RGBA_LINEAR_CLAMP,o,o,a),s,a),this._framebuffer.setViewport(0,0,o,o),this._isBackedBySingleTileTexture=!0,this._transparentClearTexture=d,this._isColorClear=!0}else if(arguments[0]==1){let[o,a,s,l,c,d,h,u]=arguments;this._context=null,this._clear=null,this._framebuffer=null,this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=null,this._isColorClear=!1,this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=s,this._clear=d,this._framebuffer=l,this._framebuffer.setViewport(c.x()|0,c.y()|0,a,a),this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=u,this._isColorClear=h}}uvSpaceRect(){if(this._isBackedBySingleTileTexture)return V.UNIT;{let o=this._framebuffer.viewport(),a=this._framebuffer.colorTexture();return new V(o.x()/a.width(),o.y()/a.height(),o.width()/a.width(),o.height()/a.height())}}tileSize(){return this._framebuffer.viewport().width()|0}colorTextureForSampling(){return this._isColorClear||this._needsColorClear?this._transparentClearTexture:this._framebuffer.colorTexture()}backingColorTexture(){return this._framebuffer.colorTexture()}backingDepthStencilTexture(){return this._framebuffer.depthStencilTexture()}context(){return this._context}framebuffer(){return this._framebuffer}isBackedBySingleTileTexture(){return this._isBackedBySingleTileTexture}deleteTexture(){this._framebuffer.deleteTexture()}popScissor(){this._framebuffer.popScissor()}takeScissor(){let o=this._framebuffer.takeScissor();if(this._isBackedBySingleTileTexture)return o;let a=this._framebuffer.viewport();return o.setX(o.x()-a.x()),o.setY(o.y()-a.y()),o}scissors(){let o=this._framebuffer.scissors();if(this._isBackedBySingleTileTexture)return o;let a=[],s=this._framebuffer.viewport();for(let l=0,c=O.FrozenScissors.count(o);l<c;l=l+1){let d=V.new3(O.FrozenScissors.get(o,l));d.setX(d.x()-s.x()),d.setY(d.y()-s.y()),a.push(d)}return a}pushScissor1(o,a,s,l){if(this._isBackedBySingleTileTexture)this._framebuffer.pushScissor1(o,a,s,l);else{let c=this._framebuffer.viewport();this._framebuffer.pushScissor1((c.x()|0)+o,(c.y()|0)+a,s,l)}}pushScissor2(o){this.pushScissor1(o.x()|0,o.y()|0,o.width()|0,o.height()|0)}clearScissors(){this._framebuffer.clearScissors()}updateScissor(){this._framebuffer.updateScissor()}bind(){this._context.setFramebuffer(this._framebuffer)}clearToColor(o){if(this.needsColorClear()||this.needsDepthStencilClear()){let s=this.needsColorClear()&&this.needsDepthStencilClear()?O.Clear.ALL:this.needsColorClear()?O.Clear.COLOR:O.Clear.DEPTH_STENCIL;this.doDeferredClear(s)}if(o==C.TRANSPARENT&&this.isColorClear())return;let a=this._framebuffer.takeAllScissors();if(this._scissorForClear!=null)this._framebuffer.pushScissor2(this._scissorForClear.clone());else if(!this._isBackedBySingleTileTexture){let s=this._framebuffer.viewport();this._framebuffer.pushScissor1(s.x()|0,s.y()|0,s.width()|0,s.height()|0)}this._clear(o,this._framebuffer),(this._scissorForClear!=null||!this._isBackedBySingleTileTexture)&&this._framebuffer.popScissor(),this._framebuffer.replaceAllScissors(a),this._isColorClear=o==C.TRANSPARENT}doDeferredClear(o){let a=this._framebuffer.takeAllScissors();if(this._scissorForClear!=null)this._framebuffer.pushScissor2(this._scissorForClear.clone());else if(!this._isBackedBySingleTileTexture){let s=this._framebuffer.viewport();this._framebuffer.pushScissor1(s.x()|0,s.y()|0,s.width()|0,s.height()|0)}this._context.clear(o),(this._scissorForClear!=null||!this._isBackedBySingleTileTexture)&&this._framebuffer.popScissor(),this._framebuffer.replaceAllScissors(a),(o==O.Clear.ALL||o==O.Clear.COLOR)&&(this._needsColorClear=!1,this._isColorClear=!0),(o==O.Clear.ALL||o==O.Clear.DEPTH_STENCIL)&&(this._needsDepthStencilClear=!1)}setNeedsColorClear(o){this._needsColorClear=o}needsColorClear(){return this._needsColorClear}setNeedsDepthStencilClear(o){this._needsDepthStencilClear=o}needsDepthStencilClear(){return this._needsDepthStencilClear}setIsColorClear(o){this._isColorClear=o}isColorClear(){return this._isColorClear}setScissorForClear(o){this._scissorForClear=o}scissorForClear(){return this._scissorForClear}}r.TileStackTile=t})(vo||(vo={}));var Su=class{constructor(e,t,r,n){this.node=e,this.transform=t,this.framebuffer=r,this.originalOutputTextureFormat=n}equals(e){return e==this?!0:e==null?!1:e.node==this.node&&e.transform.equals2(this.transform,.001)}};var hm=class{constructor(){this.level=0,this.mode=0}};function bu(i,e,t){return t==null?C.BLACK:i!=null?e==4?t.computedBackgroundColor():X.prototypeBackgroundColorOverride!=null&&X.prototypeBackgroundColorOverride.value!=C.TRANSPARENT?C.rgbaToRgb(X.prototypeBackgroundColorOverride.value):t.prototypeBackgroundColor()!=C.TRANSPARENT?C.rgbaToRgb(t.prototypeBackgroundColor()):C.BLACK:t.computedBackgroundColor()}function dE(i){switch(i){case"PASS_THROUGH":case"NORMAL":case"DARKEN":case"MULTIPLY":case"LINEAR_BURN":case"COLOR_BURN":case"LIGHTEN":case"SCREEN":case"LINEAR_DODGE":case"COLOR_DODGE":case"OVERLAY":case"SOFT_LIGHT":case"HARD_LIGHT":case"DIFFERENCE":case"EXCLUSION":case"HUE":case"SATURATION":case"COLOR":case"LUMINOSITY":return!0;default:break}return!1}var uE=new Map([["PASS_THROUGH",0],["NORMAL",1],["DARKEN",2],["MULTIPLY",3],["LINEAR_BURN",4],["COLOR_BURN",5],["LIGHTEN",6],["SCREEN",7],["LINEAR_DODGE",8],["COLOR_DODGE",9],["OVERLAY",10],["SOFT_LIGHT",11],["HARD_LIGHT",12],["DIFFERENCE",13],["EXCLUSION",14],["HUE",15],["SATURATION",16],["COLOR",17],["LUMINOSITY",18]]),gu=new Map([["SOLID",0],["GRADIENT_LINEAR",1],["GRADIENT_RADIAL",2],["GRADIENT_ANGULAR",3],["GRADIENT_DIAMOND",4],["IMAGE",5],["EMOJI",6],["VIDEO",7]]);var cc=(o=>(o[o.OTHER=0]="OTHER",o[o.PRERENDER_FULLSIZE=1]="PRERENDER_FULLSIZE",o[o.PRERENDER_THUMB=2]="PRERENDER_THUMB",o[o.ON_SCREEN_FULLSIZE=3]="ON_SCREEN_FULLSIZE",o[o.ON_SCREEN_THUMB=4]="ON_SCREEN_THUMB",o))(cc||{}),ri=class ri{compare(e){let t=St.int_compare(this.type,e.type);return t!=0?t:St.int_compare(this.generation,e.generation)}toString(){return`${cc[this.type]}:${this.generation}`}static advanceGeneration(){ri._generation=ri._generation+1}static forType(e){return new ri(e,ri._generation)}static forOnScreenPurpose(e){let t=ua.ImagePriorityType_forOnScreenPurpose(e);return ri.forType(t)}static forPrerenderPurpose(e){let t=ua.ImagePriorityType_forPrerenderPurpose(e);return ri.forType(t)}static max(e,t){return e.compare(t)>0?e:t}constructor(e,t){this.type=e,this.generation=t}};ri.OTHER=new ri(0,0),ri._generation=0;var hn=ri,yu=class{insertOrUpdate(e,t){let r=this._queue.getPriority(e);(r==null||t.compare(r.value)>0)&&this._queue.insertOrUpdate(e,t)}peek(){return this._queue.peek()}getPriority(e){let t=this._queue.getPriority(e);return t!=null?new fe(t.value):null}maxPriority(){return this._queue.count()==0?null:new fe(this._queue.maxPriority())}remove(e){this._queue.remove(e)}clear(){this._queue=new Mi((e,t)=>e.compare(t))}allImages(){return this._queue.allValues()}count(){return this._queue.count()}isEmpty(){return this.count()==0}takeFirst(){return this._queue.pop()}constructor(){this._queue=new Mi((e,t)=>e.compare(t))}},ua;(n=>{function i(o){return o==3||o==4}n.ImagePriorityType_isOnScreen=i;function e(o){return o==1||o==2}n.ImagePriorityType_isPrerender=e;function t(o){switch(o){case 0:return 3;case 1:case 2:return 4}throw new Error("Unhandled case")}n.ImagePriorityType_forOnScreenPurpose=t;function r(o){switch(o){case 0:return 1;case 1:case 2:return 2}throw new Error("Unhandled case")}n.ImagePriorityType_forPrerenderPurpose=r})(ua||(ua={}));var pa;(e=>{function i(t){return t!="NONE"&&t!="PRESENTATION"}e.hasDevice=i})(pa||(pa={}));var ir;(n=>{function i(o){return o=="BOOLEAN_OPERATION"||o=="VECTOR"||o=="STAR"||o=="LINE"||o=="ELLIPSE"||o=="RECTANGLE"||o=="REGULAR_POLYGON"||o=="ROUNDED_RECTANGLE"||o=="TEXT"||o=="STAMP"||o=="WASHI_TAPE"}n.isGeometryLeaf=i;function e(o){return o=="FRAME"||o=="SYMBOL"||o=="INSTANCE"||o=="SECTION"||r(o)||o=="TABLE_CELL"||o=="SLIDE"}n.isFrameLike=e;function t(o){return o=="RECTANGLE"||o=="ROUNDED_RECTANGLE"||o=="ELLIPSE"||o=="STAMP"||e(o)}n.isRectOrEllipseLike=t;function r(o){return o=="STICKY"||o=="SHAPE_WITH_TEXT"||o=="CONNECTOR"||o=="CODE_BLOCK"||o=="MEDIA"||o=="SECTION_OVERLAY"||o=="TABLE"}n.isImmutableFrame=r})(ir||(ir={}));var Ja;(t=>{function i(r){return`${r.sessionID}:${r.localID}`}t.toString=i;function e(r,n){return r.sessionID==n.sessionID&&r.localID==n.localID}t.equals=e})(Ja||(Ja={}));var dc;(e=>{function i(t){return t.guid!==void 0?"VariableID:"+Ja.toString(t.guid):t.assetRef!==void 0&&t.assetRef.key!=null&&t.assetRef.version!=null?"VariableID:"+t.assetRef.key+"/"+t.assetRef.version:""}e.toString=i})(dc||(dc={}));var tn;(a=>{function i(s){let l=s.depth!==void 0?s.depth:-1;return`${r(s)}-${l}`}a.hash=i;function e(s,l){return i(s)==i(l)}a.equals=e;function t(s){return i(s)}a.toString=t;function r(s){let l=s.startingNode!==void 0?s.startingNode:null;return l!=null?`${l.sessionID}:${l.localID}`:"-1:-1"}a.nodeIdString=r;function n(s){let l=s.startingNode!==void 0?s.startingNode:null,c=l!=null?`${l.sessionID}:${l.localID}`:"-1:-1",d=s.depth!==void 0?s.depth:-1;return`${c}-${d}`}a.serializeForMultiplayerURL=n;function o(s,l){if((s.depth!==void 0?s.depth:-1)!=0)return!1;let d=s.startingNode!==void 0?s.startingNode:null;for(;l!=null;){if(Ja.equals(J.toFigGUID(l.id()),d))return!0;l=l.parent()}return!1}a.fullyLoadsNode=o})(tn||(tn={}));var mm;(t=>{function i(){return J._new(-1,t._nextLocalID=t._nextLocalID+1)}t.generateId=i,t._nextLocalID=0})(mm||(mm={}));var VA=null;function kA(i){VA=i}function ke(){return VA}function UA(i,e){let t=e(i)||0;switch(t){case 1:return 1;case 0:break;case 2:return 0}for(let r=0,n=i.childCount();r<n;r=r+1)if(i.childAt1(r)!==void 0)switch(t=UA(i.childAt1(r),e),t){case 1:return 1;case 0:break;case 2:return 0}return 0}function Wr(i,e){UA(i,e)}var Tu=class{constructor(e,t,r,n){this.ax=0,this.bx=0,this.cx=0,this.cy=0,this.by=0,this.ay=0,this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by}_sampleCurveX(e){return((this.ax*e+this.bx)*e+this.cx)*e}_sampleCurveY(e){return((this.ay*e+this.by)*e+this.cy)*e}_sampleCurveDerivativeX(e){return(3*this.ax*e+2*this.bx)*e+this.cx}_sampleCurveDerivativeY(e){return(3*this.ay*e+2*this.by)*e+this.cy}_solveCurveX(e,t){let r=0,n=0,o=0,a=0,s=0;o=e;for(let l=0;l<8;l=l+1){if(a=this._sampleCurveX(o)-e,Math.abs(a)<t)return o;if(s=this._sampleCurveDerivativeX(o),Math.abs(s)<1e-6)break;o=o-a/s}if(r=0,n=1,o=e,o<r)return r;if(o>n)return n;for(;r<n;){if(a=this._sampleCurveX(o),Math.abs(a-e)<t)return o;e>a?r=o:n=o,o=(n-r)*.5+r}return o}solve(e,t){return this._sampleCurveY(this._solveCurveX(e,t))}getYDerivativeForXValue(e,t){let r=this._solveCurveX(e,t),n=this._sampleCurveDerivativeX(r);return Math.abs(n)>0?this._sampleCurveDerivativeY(r)/n:this._sampleCurveDerivativeY(r)}},vu=class{constructor(e,t){this._bezier=null,this._bezierInverse=null,this._durationSeconds=0,this._bezier=this.bezierForEasingFunction(e),this._bezierInverse=this.inverseBezierForEasingFunction(e),this._durationSeconds=t}bezierForEasingFunction(e){return e==null||e.length!=4?null:new Tu(e[0],e[1],e[2],e[3])}inverseBezierForEasingFunction(e){return e==null||e.length!=4?null:new Tu(e[1],e[0],e[3],e[2])}_solveEpsilon(e){return 1/(200*e)}getYValueForXValue(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezier.solve(e,t)}getDerivative(e,t){if(this._bezier==null)return 1;let r=this._solveEpsilon(this._durationSeconds);return this._bezier.getYDerivativeForXValue(e,r)}invert(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezierInverse.solve(e,t)}};var gm=class{constructor(e,t,r,n){this.m_w0=0,this.m_zeta=0,this.m_wd=0,this.m_A=0,this.m_B=0,this.m_w0=Math.sqrt(t/e),this.m_zeta=r/(2*Math.sqrt(t*e)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-n)/this.m_wd):(this.m_A=1,this.m_B=-n+this.m_w0)}solve(e){return this.m_zeta<1?e=Math.exp(-e*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*e)+this.m_B*Math.sin(this.m_wd*e)):e=(this.m_A+this.m_B*e)*Math.exp(-e*this.m_w0),1-e}solveInverse(e){let t=0,r=0,n=Math.PI/this.m_w0,o=this.solve(n),a=0,s=.001,l=15;for(let c=0;c<l;c=c+1){a=(e-r)/(o-r)*(n-t)+t;let d=this.solve(a);if(Math.abs(d-e)<s)return a;d>e?(t=a,r=d):(n=a,o=d)}return a}},Iu=class{constructor(e,t){this._spring=null,this._durationSeconds=0,this._spring=this.convertFunctionToUnitSpring(e),this._durationSeconds=t}convertFunctionToUnitSpring(e){return e==null||e.length!=4?null:new gm(e[0],e[1],e[2],e[3])}getYValueForXValue(e){if(this._spring==null)return e;let t=e*this._durationSeconds;return this._spring.solve(t)}getDerivative(e,t){return this._spring==null?1:t}invert(e){return this._spring==null?e:this._spring.solveInverse(e)/this._durationSeconds}};var yn=class yn{static easingFunctionCallbackCleanup(e){yn.easingFunctionCache.delete(e)}static cleanCache(){for(var e of yn.easingFunctionCache.entries())e[1].deref()===void 0&&(yn.easingFunctionCache.delete(e[0]),yn.easingFunctionCacheFinalizer.unregister(e[1]))}static makeEasingFunctionWithEasingType(e,t,r){yn.cleanCache();let n=null;n=this.createCacheKey(e,t,this.getAnimationType(r));let o=yn.easingFunctionCache.get(n);if(o!==void 0)return o.deref();let a=new yn(e,t,r),s=new WeakRef(a);return yn.easingFunctionCache.set(n,s),yn.easingFunctionCacheFinalizer.register(a,n,s),a}static makeEasingFunction(e,t){return yn.makeEasingFunctionWithEasingType(e,t,null)}static createCacheKey(e,t,r){let n=[];for(var o of e)n.push(o.toFixed(2));return n.push(";"),n.push(t.toFixed(2)),n.push(r),n.join()}static getAnimationType(e){return e=="GENTLE_SPRING"||e=="SPRING_PRESET_ONE"||e=="SPRING_PRESET_TWO"||e=="SPRING_PRESET_THREE"||e=="CUSTOM_SPRING"?1:0}constructor(e,t,r){this._easingFunction=e,this._animationType=yn.getAnimationType(r),this._durationSeconds=t,this._createAnimationUnit(this._easingFunction),this.bounds=yn.boundsForEasingFunction(this._easingFunction)}_createAnimationUnit(e){this._animationType==0?this._animationFunction=new vu(e,this._durationSeconds):this._animationType==1&&(this._animationFunction=new Iu(e,this._durationSeconds))}get(e){return this._animationFunction.getYValueForXValue(e)}getDerivative(e,t){return this._animationFunction.getDerivative(e,t)}invert(e){return this._animationFunction.invert(e)}static boundsForEasingFunction(e){if(e==null)return Br.FrozenRect_new3(V.fromMinAndMax(0,0,1,1));let t=ye.FrozenVector_new4(0,0),r=ye.FrozenVector_new4(e[0],e[1]),n=ye.FrozenVector_new4(e[2],e[3]),o=ye.FrozenVector_new4(1,1),a=t.clone(),s=o.clone(),l=t.negative().add1(r),c=t.subtract1(r.multiply(2)).add1(n),d=t.negative().add1(r.multiply(3)).subtract1(n.multiply(3)).add1(o),h=c.multiply1(c).subtract1(d.multiply1(l));if(h.x()>0){h.setX(Math.sqrt(h.x()));for(let u of[(-c.x()-h.x())/d.x(),(-c.x()+h.x())/d.x()])if(u>0&&u<1){let m=1-u,g=m*m*m*t.x()+3*m*m*u*r.x()+3*m*u*u*n.x()+u*u*u*o.x();a.setX(Math.min(a.x(),g)),s.setX(Math.max(s.x(),g))}}if(h.y()>0){h.setY(Math.sqrt(h.y()));for(let u of[(-c.y()-h.y())/d.y(),(-c.y()+h.y())/d.y()])if(u>0&&u<1){let m=1-u,g=m*m*m*t.y()+3*m*m*u*r.y()+3*m*u*u*n.y()+u*u*u*o.y();a.setY(Math.min(a.y(),g)),s.setY(Math.max(s.y(),g))}}return V.fromMinAndMax(a.x(),a.y(),s.x(),s.y())}static easingValuesForPreset(e){switch(e){case"IN_CUBIC":return[.42,0,1,1];case"OUT_CUBIC":return[0,0,.58,1];case"INOUT_CUBIC":return[.42,0,.58,1];case"LINEAR":return[0,0,1,1];case"IN_BACK_CUBIC":return[.3,-.05,.7,-.5];case"OUT_BACK_CUBIC":return[.45,1.45,.8,1];case"INOUT_BACK_CUBIC":return[.7,-.4,.4,1.4];case"CUSTOM_CUBIC":return[0,0,.58,1];case"GENTLE_SPRING":return[1,100,15,0];case"SPRING_PRESET_ONE":return[1,300,20,0];case"SPRING_PRESET_TWO":return[1,600,15,0];case"SPRING_PRESET_THREE":return[1,80,20,0];case"CUSTOM_SPRING":return[1,100,15,0]}return[0,0,.58,1]}};yn.easingFunctionCache=new Map,yn.easingFunctionCacheFinalizer=new FinalizationRegistry(yn.easingFunctionCallbackCleanup);var wn=yn;var mn;(a=>{function i(s){return s=="PUSH_FROM_LEFT"||s=="PUSH_FROM_RIGHT"||s=="PUSH_FROM_TOP"||s=="PUSH_FROM_BOTTOM"}a.isPush=i;function e(s){return s=="MOVE_FROM_LEFT"||s=="MOVE_FROM_RIGHT"||s=="MOVE_FROM_TOP"||s=="MOVE_FROM_BOTTOM"}a.isMove=e;function t(s){return s=="SLIDE_FROM_LEFT"||s=="SLIDE_FROM_RIGHT"||s=="SLIDE_FROM_TOP"||s=="SLIDE_FROM_BOTTOM"}a.isSlide=t;function r(s){return s=="MOVE_OUT_TO_LEFT"||s=="MOVE_OUT_TO_RIGHT"||s=="MOVE_OUT_TO_TOP"||s=="MOVE_OUT_TO_BOTTOM"}a.isMoveOut=r;function n(s){return s=="SLIDE_OUT_TO_LEFT"||s=="SLIDE_OUT_TO_RIGHT"||s=="SLIDE_OUT_TO_TOP"||s=="SLIDE_OUT_TO_BOTTOM"}a.isSlideOut=n;function o(s){return i(s)||e(s)||r(s)||t(s)||n(s)}a.supportsSmartAnimate=o})(mn||(mn={}));var zo=class zo{constructor(e,t,r,n,o){this._id=null,this._event=null,this._actions=null,this._allActions=null,this._isDeleted=!1,this._stateManagementVersion=0,this._hoverLastHandledFrameNum=-1,this._id=e,this._event=t,this._actions=r,this._isDeleted=n,this._stateManagementVersion=o,this._allActions=this.getAllActions()}getAllActions(){let e=[];for(let t of this.actions())if(e.push(t),t.connectionType()=="CONDITIONAL")for(let r of t.conditionalActions())for(let n of r.actions())e.push(n);return e}id(){return this._id!=null?this._id:J.invalid()}event(){return this._event!=null?this._event:Qn.createDefault()}action(){return this._actions!=null&&this._actions.length!=0?new fe(this._actions[0]):null}actions(){return this._actions!=null?this._actions:[]}allActions(){return this._allActions!=null?this._allActions:[]}isDeleted(){return this._isDeleted}stateManagementVersion(){return this._stateManagementVersion}withEvent(e){return new zo(this._id,e,this._actions,this._isDeleted,this._stateManagementVersion)}withActions(e){return new zo(this._id,this._event,e,this._isDeleted,this._stateManagementVersion)}withStateManagementVersion(e){return new zo(this._id,this._event,this._actions,this._isDeleted,e)}isValid(){return this.event().interactionType()=="NONE"||this._actions==null||this._actions.length==0?!1:this.action()!=null&&this.action().value.connectionType()!="NONE"}apply(e){let t=this.action(),r=e.action(),n=[];t!=null&&r!=null?n=[t.value.apply(r.value)]:t!=null?n=[t.value]:r!=null&&(n=[r.value]);let o=this._event,a=e._event,s=null;return o!=null&&a!=null?s=o.apply(a):o!=null?s=o:a!=null&&(s=a),new zo(this._id,s,n,e._isDeleted,e._stateManagementVersion)}setHoverLastHandledFrameNum(e){this._hoverLastHandledFrameNum=e}getHoverLastHandledFrameNum(){return this._hoverLastHandledFrameNum}toString(){let e="";return e+="PrototypeInteraction(",this._id!=null&&(e+=`id: ${this._id},`),this._event!=null&&(e+=`event: ${this._event.debugString()},`),this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=`isDeleted: ${this._isDeleted},`,e+=")",e}getAllActionsWithSpecificConnectionType(e){let t=[];for(let r of this.actions())if(r.connectionType()==e)t.push(r);else if(r.connectionType()=="CONDITIONAL")for(let n of r.conditionalActions())for(let o of n.actions())r.connectionType()==e&&t.push(r);return t}getAllActionsWithSpecificTransitionType(e){let t=[];for(let r of this.actions())if(r.transitionType()==e)t.push(r);else if(r.connectionType()=="CONDITIONAL")for(let n of r.conditionalActions())for(let o of n.actions())o.transitionType()==e&&t.push(o);return t}getAllValidTransitionActionsInInteraction(){let e=[];for(let t of this.actions())if(J.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1)e.push(t);else if(t.connectionType()=="CONDITIONAL")for(let r of t.conditionalActions())for(let n of r.actions())J.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1&&e.push(t);return e}interactionContainsTransitionAction(){for(let e of this.actions()){if(J.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0;if(e.connectionType()=="CONDITIONAL"){for(let t of e.conditionalActions())for(let r of t.actions())if(J.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0}}return!1}interactionContainsSpecificConnectionTypeAction(e){for(let t of this.actions()){if(t.connectionType()==e)return!0;if(t.connectionType()=="CONDITIONAL"){for(let r of t.conditionalActions())for(let n of r.actions())if(t.connectionType()==e)return!0}}return!1}getFirstActionInInteractionWithSpecificNavigation(e){for(let t of this.actions())if(t.navigationType()==e)return t;return null}static createDefault(){return new zo(J.invalid(),Qn.createDefault(),[],!1,0)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:J.equals(e._id,t._id)&&Qn.equals(e._event,t._event)&&ce.List_equalsWithComparison(e._actions,t._actions,(r,n)=>Qr.equals(r,n))&&e._isDeleted==t._isDeleted&&e._stateManagementVersion==t._stateManagementVersion}static applyInteractions(e,t){if(e==null&&t==null)return zo.EMPTY_LIST;if(e==null)return t;if(t==null)return e;let r=e.slice();return t.forEach(n=>{let o=!1;for(let a=0,s=e.length;a<s;a=a+1){let l=e[a];if(J.equals(l.id(),n.id())){r[a]=l.apply(n),o=!0;break}}o||r.push(n)}),r.filter(n=>!n._isDeleted)}static whichAncestorToSwapState(e,t,r){let n=e!=null?e.scene().findNode(t):null,o=n==null?void 0:n.findContainingStateGroupOrSelf();if(o==null)return null;let a=e;for(;a!=null;){let s=null;a.type()=="INSTANCE"?s=e.scene().findNode(a.symbolID()):r==zo.StateSwapPolicy.INCLUDE_SYMBOLS&&a.type()=="SYMBOL"&&(s=a);let l=s==null?void 0:s.findContainingStateGroupOrSelf();if(o==l)return a;a=a.parent()}return null}static whichInstanceToSwap(e,t){return zo.whichAncestorToSwapState(e,t,zo.StateSwapPolicy.INSTANCES_ONLY)}};zo.EMPTY_LIST=[];var Zt=zo;(e=>{let i;(n=>(n[n.INCLUDE_SYMBOLS=0]="INCLUDE_SYMBOLS",n[n.INSTANCES_ONLY=1]="INSTANCES_ONLY"))(i=e.StateSwapPolicy||(e.StateSwapPolicy={}))})(Zt||(Zt={}));var Za=class Za{interactionType(){let e=this._interactionType!=null?this._interactionType:"ON_CLICK";return e=="NONE"?"ON_CLICK":e}interactionMaintained(){return this._interactionMaintained!=null?this._interactionMaintained.value:!1}interactionDuration(){return this._interactionDuration!=null&&this._interactionDuration.value>=0?this._interactionDuration.value:.3}keyTrigger(){return this._keyTrigger!=null?this._keyTrigger:{}}transitionTimeout(){return this._transitionTimeout!=null&&this._transitionTimeout.value>=0?this._transitionTimeout.value:.8}mediaHitTime(){return this._mediaHitTime!=null?this._mediaHitTime.value:0}withInteractionType(e){return new Za(e,this._interactionMaintained,this._interactionDuration,this._keyTrigger,this._transitionTimeout,this._mediaHitTime)}apply(e){let t=this._interactionType,r=this._interactionMaintained,n=this._interactionDuration,o=this._keyTrigger,a=this._transitionTimeout,s=this._mediaHitTime;return e._interactionType!=null&&(t=e._interactionType),e._interactionMaintained!=null&&(r=e._interactionMaintained),e._interactionDuration!=null&&(n=e._interactionDuration),e._keyTrigger!=null&&(o=e._keyTrigger),e._transitionTimeout!=null&&(a=e._transitionTimeout),e._mediaHitTime!=null&&(s=e._mediaHitTime),new Za(t,r,n,o,a,s)}debugString(){let e="";return e+="PrototypeEvent(",this._interactionType!=null&&(e+=`interactionType: ${this._interactionType},`),this._interactionMaintained!=null&&(e+=`interactionMaintained: ${this._interactionMaintained.value},`),this._interactionDuration!=null&&(e+=`interactionDuration: ${this._interactionDuration.value},`),this._keyTrigger!=null&&(e+=`keyTrigger: ${JSON.stringify(this._keyTrigger)},`),this._transitionTimeout!=null&&(e+=`transitionTimeout: ${this._transitionTimeout.value},`),this._mediaHitTime!=null&&(e+=`mediaHitTime: ${this._mediaHitTime.value},`),e+=")",e}static createDefault(){let e={};return e.keyCodes=[],e.triggerDevice="KEYBOARD",new Za("NONE",new fe(!1),new fe(0),e,new fe(0),new fe(0))}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e._interactionType==t._interactionType&&fe.equals(e._interactionMaintained,t._interactionMaintained)&&fe.equals(e._interactionDuration,t._interactionDuration)&&fm.equals(e._keyTrigger,t._keyTrigger)&&fe.equals(e._transitionTimeout,t._transitionTimeout)}constructor(e,t,r,n,o,a){this._interactionType=e,this._interactionMaintained=t,this._interactionDuration=r,this._keyTrigger=n,this._transitionTimeout=o,this._mediaHitTime=a}};Za.NULL_EVENT=new Za(null,null,null,null,null,null);var Qn=Za,uc=class uc{constructor(e,t=""){this._actions=e,this._condition=t}actions(){return this._actions}condition(){return this._condition}debugString(){let e="";return e+="ConditionalActions(",this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=")",e}static createDefault(){return new uc([])}static equals(e,t){if(e==null!=(t==null))return!1;if(e==null)return!0;let r=ce.List_equalsWithComparison(e._actions,t._actions,(o,a)=>Qr.equals(o,a)),n=e._condition==t._condition;return r&&n}};uc.NULL_CONDITIONAL_ACTIONS=new uc(null);var pc=uc,rn=class rn{constructor(e,t,r,n,o,a,s,l,c,d,h,u,m,g,_,f,S,b,T,y,I,p,A,v){this._transitionNodeID=null,this._transitionType=null,this._transitionDuration=null,this._easingType=null,this._easingFunctionValues=null,this._transitionShouldSmartAnimate=null,this._connectionType=null,this._connectionURL=null,this._overlayRelativePosition=null,this._navigationType=null,this._transitionPreserveScroll=null,this._extraScrollOffset=null,this._mediaAction=null,this._transitionResetVideoPosition=null,this._openUrlInNewTab=null,this._mediaSkipToTime=null,this._mediaSkipByAmount=null,this._transitionResetScrollPosition=null,this._conditionalActions=null,this._transitionResetInteractiveComponents=null,this._targetVariableID=null,this._targetVariableData=null,this.easingFunction=null,this._transitionNodeID=e,this._transitionType=t,this._transitionDuration=r,this._easingType=n,this._easingFunctionValues=o,this._transitionShouldSmartAnimate=a,this._connectionType=s,this._connectionURL=l,this._overlayRelativePosition=c,this._navigationType=d,this._transitionPreserveScroll=h,this.easingFunction=this.easingFunctionFromAction(),this._extraScrollOffset=u,this._mediaAction=m,this._transitionResetVideoPosition=g,this._openUrlInNewTab=_,this._mediaSkipToTime=f,this._mediaSkipByAmount=S,this._transitionResetScrollPosition=b,this._conditionalActions=T,this._transitionResetInteractiveComponents=y,this._targetVariableID=I,this._targetVariableData=p,this._targetVariableModeID=A,this._targetVariableSetKey=v}transitionNodeID(){return this._connectionType==null||this.connectionType()=="INTERNAL_NODE"||this.connectionType()=="UPDATE_MEDIA_RUNTIME"?this._transitionNodeID!=null?this._transitionNodeID:J.invalid():J.invalid()}transitionType(){let e=this._transitionType!=null?this._transitionType:"INSTANT_TRANSITION";return this.navigationType()=="OVERLAY"&&(e=="FADE"||mn.isPush(e)||mn.isSlide(e))?"INSTANT_TRANSITION":e}transitionDuration(){return this.transitionType()=="INSTANT_TRANSITION"?0:this._transitionDuration!=null&&this._transitionDuration.value>=0?this._transitionDuration.value:.3}easingType(){return this._easingType!=null?this._easingType:"OUT_CUBIC"}easingFunctionValues(){switch(this.easingType()){case"CUSTOM_CUBIC":case"GENTLE_SPRING":case"SPRING_PRESET_ONE":case"SPRING_PRESET_TWO":case"SPRING_PRESET_THREE":case"CUSTOM_SPRING":return this._easingFunctionValues!=null?this._easingFunctionValues:wn.easingValuesForPreset(this.easingType());default:break}return wn.easingValuesForPreset(this.easingType())}transitionShouldSmartAnimate(){return this._transitionShouldSmartAnimate!=null?this._transitionShouldSmartAnimate.value:!1}connectionType(){return this._connectionType!=null?this._connectionType:"NONE"}connectionURL(){return this.connectionType()=="URL"?this._connectionURL:null}overlayRelativePosition(){return this._overlayRelativePosition!=null?this._overlayRelativePosition:R.new2()}navigationType(){return this._navigationType!=null?this._navigationType:"NAVIGATE"}mediaAction(){return this._mediaAction!=null?this._mediaAction:"PLAY"}transitionPreserveScroll(){return this.transitionType()=="SMART_ANIMATE"||mn.supportsSmartAnimate(this.transitionType())&&this.transitionShouldSmartAnimate()?!0:mn.isSlide(this.transitionType())||mn.isPush(this.transitionType())||mn.isMove(this.transitionType())?!1:this._transitionPreserveScroll!=null?this._transitionPreserveScroll.value:!1}transitionResetVideoPosition(){return this._transitionResetVideoPosition!=null?this._transitionResetVideoPosition.value:!1}transitionResetScrollPosition(){return this._transitionResetScrollPosition!=null?this._transitionResetScrollPosition.value:!1}transitionResetInteractiveComponents(){return this._transitionResetInteractiveComponents!=null?this._transitionResetInteractiveComponents.value:!1}openUrlInNewTab(){return this._openUrlInNewTab!=null?this._openUrlInNewTab.value:!0}extraScrollOffset(){return this._extraScrollOffset!=null?this._extraScrollOffset:R.new2()}mediaSkipToTime(){return this._mediaSkipToTime!=null&&this._mediaSkipToTime.value>=0?this._mediaSkipToTime.value:0}mediaSkipByAmount(){return this._mediaSkipByAmount!=null&&this._mediaSkipByAmount.value>=0?this._mediaSkipByAmount.value:5}conditionalActions(){return this._conditionalActions!=null?this._conditionalActions:[]}targetVariableID(){return this._targetVariableID}targetVariableData(){return this._targetVariableData}targetVariableModeID(){return this._targetVariableModeID}targetVariableSetKey(){return this._targetVariableSetKey}withTransitionNodeID(e){return new rn(e,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withTransitionType(e){return new rn(this._transitionNodeID,e,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withTransitionShouldSmartAnimate(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,new fe(e),this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withConnectionType(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,e,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withConnectionURL(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,e,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withOverlayRelativePosition(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,e,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withNavigationType(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,e,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withTransitionPreserveScroll(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,new fe(e),this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withMediaAction(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,new fe(this.transitionPreserveScroll()),this._extraScrollOffset,e,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withTransitionResetVideoPosition(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,new fe(e),this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withOpenUrlInNewTab(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,new fe(e),this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withTransitionResetInteractiveComponents(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,new fe(e),this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}withTransitionResetScrollPosition(e){return new rn(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,new fe(e),this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData,this._targetVariableModeID,this._targetVariableSetKey)}easingFunctionFromAction(){return wn.makeEasingFunctionWithEasingType(this.easingFunctionValues(),this.transitionDuration(),this._easingType)}apply(e){let t=this._transitionNodeID,r=this._transitionType,n=this._transitionDuration,o=this._easingType,a=this._easingFunctionValues,s=this._transitionShouldSmartAnimate,l=this._connectionType,c=this._connectionURL,d=this._overlayRelativePosition,h=this._navigationType,u=this._transitionPreserveScroll,m=this._extraScrollOffset,g=this._mediaAction,_=this._transitionResetVideoPosition,f=this._openUrlInNewTab,S=this._mediaSkipToTime,b=this._mediaSkipByAmount,T=this._transitionResetScrollPosition,y=this._conditionalActions,I=this._transitionResetInteractiveComponents,p=this._targetVariableID,A=this._targetVariableData,v=this._targetVariableModeID,E=this._targetVariableSetKey;return e._transitionNodeID!=null&&(t=e._transitionNodeID),e._transitionType!=null&&(r=e._transitionType),e._transitionDuration!=null&&(n=e._transitionDuration),e._easingType!=null&&(o=e._easingType),e._easingFunctionValues!=null&&(a=e._easingFunctionValues),e._transitionShouldSmartAnimate!=null&&(s=e._transitionShouldSmartAnimate),e._connectionType!=null&&(l=e._connectionType),e._connectionURL!=null&&(c=e._connectionURL),e._overlayRelativePosition!=null&&(d=e._overlayRelativePosition),e._navigationType!=null&&(h=e._navigationType),e._transitionPreserveScroll!=null&&(u=e._transitionPreserveScroll),e._extraScrollOffset!=null&&(m=e._extraScrollOffset),e._mediaAction!=null&&(g=e._mediaAction),e._transitionResetVideoPosition!=null&&(_=e._transitionResetVideoPosition),e._openUrlInNewTab!=null&&(f=e._openUrlInNewTab),e._mediaSkipToTime!=null&&(S=e._mediaSkipToTime),e._mediaSkipByAmount!=null&&(b=e._mediaSkipByAmount),e._transitionResetScrollPosition!=null&&(T=e._transitionResetScrollPosition),e._conditionalActions!=null&&(y=e._conditionalActions),e._transitionResetInteractiveComponents!=null&&(I=e._transitionResetInteractiveComponents),e._targetVariableID!=null&&(p=e._targetVariableID),e._targetVariableData!=null&&(A=e._targetVariableData),new rn(t,r,n,o,a,s,l,c,d,h,u,m,g,_,f,S,b,T,y,I,p,A,v,E)}debugString(){let e="";return e+="PrototypeAction(",this._transitionNodeID!=null&&(e+=`transitionNodeID: ${this._transitionNodeID},`),this._transitionType!=null&&(e+=`transitionType: ${this._transitionType},`),this._transitionDuration!=null&&(e+=`transitionDuration: ${this._transitionDuration.value},`),this._easingType!=null&&(e+=`easingType: ${this._easingType},`),this._easingFunctionValues!=null&&(e+=`easingFunctionValues: ${this._easingFunctionValues.map(t=>t.toString()).join(",")},`),this._transitionShouldSmartAnimate!=null&&(e+=`transitionShouldSmartAnimate: ${this._transitionShouldSmartAnimate.value},`),this._connectionType!=null&&(e+=`connectionType: ${this._connectionType},`),this._connectionURL!=null&&(e+=`connectionURL: ${this._connectionURL},`),this._overlayRelativePosition!=null&&(e+=`overlayRelativePosition: ${this._overlayRelativePosition},`),this._navigationType!=null&&(e+=`navigationType: ${this._navigationType},`),this._transitionPreserveScroll!=null&&(e+=`transitionPreserveScroll: ${this._transitionPreserveScroll.value},`),this._extraScrollOffset!=null&&(e+=`extraScrollOffset: ${this._extraScrollOffset},`),this._mediaAction!=null&&(e+=`mediaAction: ${this._mediaAction},`),this._transitionResetVideoPosition!=null&&(e+=`transitionResetVideoPosition: ${this._transitionResetVideoPosition.value},`),this._openUrlInNewTab!=null&&(e+=`openUrlInNewTab: ${this._openUrlInNewTab.value},`),this._mediaSkipToTime!=null&&(e+=`mediaSkipToTime: ${this._mediaSkipToTime.value},`),this._mediaSkipByAmount!=null&&(e+=`mediaSkipByAmount: ${this._mediaSkipByAmount.value},`),this._transitionResetScrollPosition!=null&&(e+=`transitionResetScrollPosition: ${this._transitionResetScrollPosition.value},`),this._conditionalActions!=null&&(e+=`conditionalActions: ${this._conditionalActions[0].debugString()},`),this._transitionResetInteractiveComponents!=null&&(e+=`transitionResetInteractiveComponents: ${this._transitionResetInteractiveComponents.value},`),e+=")",e}static createDefault(){return new rn(J.invalid(),"INSTANT_TRANSITION",new fe(0),"IN_CUBIC",wn.easingValuesForPreset("IN_CUBIC"),new fe(!1),"NONE",null,new R(0,0),"NAVIGATE",new fe(!1),new R(0,0),"PLAY",new fe(!1),new fe(!0),new fe(0),new fe(5),new fe(!1),[],new fe(!1),null,null,null,null)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:J.equals(e._transitionNodeID,t._transitionNodeID)&&e._transitionType==t._transitionType&&fe.equals(e._transitionDuration,t._transitionDuration)&&e._easingType==t._easingType&&ce.List_equalsWithComparison(e._easingFunctionValues,t._easingFunctionValues,(r,n)=>Math.abs(r-n)<1e-6)&&fe.equals(e._transitionShouldSmartAnimate,t._transitionShouldSmartAnimate)&&e._connectionType==t._connectionType&&e._connectionURL==t._connectionURL&&R.equals_(e._overlayRelativePosition,t._overlayRelativePosition)&&e._navigationType==t._navigationType&&fe.equals(e._transitionPreserveScroll,t._transitionPreserveScroll)&&fe.equals(e._transitionResetVideoPosition,t._transitionResetVideoPosition)&&fe.equals(e._openUrlInNewTab,t._openUrlInNewTab)&&R.equals_(e._extraScrollOffset,t._extraScrollOffset)&&e._mediaAction==t._mediaAction&&fe.equals(e._mediaSkipToTime,t._mediaSkipToTime)&&fe.equals(e._mediaSkipByAmount,t._mediaSkipByAmount)&&fe.equals(e._transitionResetScrollPosition,t._transitionResetScrollPosition)&&ce.List_equalsWithComparison(e._conditionalActions,t._conditionalActions,(r,n)=>pc.equals(r,n))&&fe.equals(e._transitionResetInteractiveComponents,t._transitionResetInteractiveComponents)}};rn.NULL_ACTION=new rn(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[],null,null,null,null,null);var Qr=rn,fm;(e=>{function i(t,r){return t==null!=(r==null)?!1:t==null?!0:ce.List_equalsWithComparison(t.keyCodes,r.keyCodes,(n,o)=>n==o)&&t.triggerDevice==r.triggerDevice}e.equals=i})(fm||(fm={}));var yi=class i{constructor(e,t,r,n,o,a,s,l){this._styleOverrideTable=e,this._fontSizes=t,this._hyperlinkBoxesDEPRECATED=r,this._characters=n,this._lines=o,this._characterStyleIds=a,this._usedEmojiCodepointsDEPRECATED=s,this._usedEmojiImagesDEPRECATED=l}characters(){return this._characters}characterStyleIds(){return this._characterStyleIds}lines(){return this._lines}styleOverrideTable(){return this._styleOverrideTable}fontSizes(){return this._fontSizes}hyperlinkBoxesDEPRECATED(){return this._hyperlinkBoxesDEPRECATED}usedEmojiCodepointsDEPRECATED(){return this._usedEmojiCodepointsDEPRECATED}usedEmojiImagesDEPRECATED(){return this._usedEmojiImagesDEPRECATED}static forTests1(){return new i(new kr,null,[],"",[],[],[],[])}static forTests2(e){return new i(e,null,[],"",[],[],[],[])}static forTests3(e){return new i(new kr,null,[],"",[],[],e,[])}},Eu=class{constructor(e){this.paintOverrides=null,this.styleOverrideTable=null,this.paintOverrides=new ao(e),this.styleOverrideTable=e}};var Cu;(t=>{function i(r){return J._new(r,t._nextLocalID=t._nextLocalID+1)}t.make=i,t._nextLocalID=0})(Cu||(Cu={}));var ja=class i{constructor(){this.assertEquals=AssertLib.strictEqual,this.trackingCalls=[],this._uninstall=null,this._uninstall=De.mockTrackEvent((e,t,r)=>{this.trackingCalls.push(new i.TrackingPayload(e,t,r))})}uninstall(){this._uninstall()}expectTrackToHaveBeenCalledWith1(e,t){this.expectTrackToHaveBeenCalledWith2(e,t,{})}expectTrackToHaveBeenCalledWith2(e,t,r){this.trackingCalls.some(n=>n.equalsWithSubsetOfArgs(new i.TrackingPayload(e,t,r)))}};(e=>{class i{equalsWithSubsetOfArgs(r){if(this.name!=r.name)return!1;for(let n of Object.keys(r.args))if(r.args[n]!==this.args[n])return!1;for(let n of Object.keys(r.options))if(r.options[n]!==this.options[n])return!1;return!0}constructor(r,n,o){this.name=r,this.args=n,this.options=o}}e.TrackingPayload=i})(ja||(ja={}));function Wo(i){if(!Fo())throw new Error(i)}function pE(i){ks=ks+1;let e=J._new(1,ks);for(let t=0,r=i.totalNodeCount();t<r&&i.findNode(e)!=null;t=t+1)ks=ks+1,e=J._new(1,ks);return e}function gn(i,e){let t=i.scene().createNode(pE(i.scene()));return t.setVisible(!0),t.setOpacity(1),t.setType(e),e!="CANVAS"&&e!="DOCUMENT"&&(t.setRelativeTransform(ee.new2()),t.setSize(new R(100,100))),i.appendChild(t),t}function at(i,e){return sr(i,e,C.BLACK)}function lo(i,e,t){let r=gn(i,"FRAME");return r.setName(e),r.setBackgroundOpacity(1),r.setIsBackgroundEnabled(!0),r.setIsFrameMaskDisabled(!1),r.setIsResizeToFit(!1),r.setContainerSupportsFillStrokeAndCorners(!0),r.setTestOnlyFillPaints([t]),r}function $a(i,e,t,r,n){let o=gn(i,"FRAME");return o.setName(e),o.setBackgroundOpacity(1),o.setIsBackgroundEnabled(!0),o.setIsFrameMaskDisabled(!1),o.setIsResizeToFit(!1),o.setContainerSupportsFillStrokeAndCorners(!0),o.setTestOnlyFillPaints(t),o.setTestOnlyStrokeGeometry(new xr([new Fr("NONZERO",0,Pt.forCenterStrokeAroundRect(n,10),n)],null,n,null)),o.setTestOnlyStrokePaints(r),o}function sr(i,e,t){let r=new te("SOLID");return r.setColor(t),r.setOpacity(1),r.setIsEnabled(!0),lo(i,e,r)}function GA(i,e){let t=te.createLinearGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);return lo(i,e,t)}function ni(i){let e=gn(i,"FRAME");return e.setName("Group"),e.setBackgroundOpacity(1),ma(e,!1),e.setIsResizeToFit(!0),e}function Us(i){let e=gn(i,"BOOLEAN_OPERATION");return e.setName("Boolean Operation"),e.setBackgroundOpacity(1),e.setIsBackgroundEnabled(!1),e.setIsResizeToFit(!0),e}function Ui(i,e){let t=ni(i);return t.setName(e),t}function lt(i){return at(i,"Frame")}function HA(i){return gn(i,"VECTOR")}function Tn(i){return gn(i,"RECTANGLE")}function rt(i,e){let t=Tn(i);return t.setName(e),t}function zA(i,e){let t=gn(i,"ROUNDED_RECTANGLE");return t.setCornerRadius(e),t}function Ru(i){return gn(i,"TEXT")}function hE(i,e){let t=Ru(i);return t.setName(e),t}function oi(i){return gn(i,"SYMBOL")}function ha(i,e){let t=gn(i,"INSTANCE");return t.setTestOnlySymbolData(new ki(e.id(),yo.new1([],[]))),t}function Qo(i){let e=new V(0,0,i.width(),i.height()),t=new Fr("NONZERO",0,Ot.fromRect(e),e);return new xr([t],null,t.bounds(),new ao(new kr))}function WA(i,e){let t=new Fr("NONZERO",0,Pt.fromRoundedRect1(new Di(2,V.new3(i),e,null,0)),i);return new xr([t],null,t.bounds(),new ao(new kr))}function QA(i){let e=Pt.new2();e.moveTo1(i.topLeft().x(),i.topLeft().y()).lineTo(i.topRight().x(),i.topRight().y()).lineTo(i.bottomLeft().x(),i.bottomLeft().y()).close();let t=new Fr("NONZERO",0,e,i);return new xr([t],null,t.bounds(),new ao(new kr))}function KA(i){let e=[];bt.INSTANCE.reset();for(let t of i)e.push(new Fr("NONZERO",0,Pt.fromRect(t),t)),bt.INSTANCE.include3(t);return new xr(e,null,bt.INSTANCE.build(),new ao(new kr))}function Gs(i,e){_m(i,e.id())}function _m(i,e){let t=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],r=t.action()!=null?t.action().value:Qr.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([r.withTransitionNodeID(e).withConnectionType("INTERNAL_NODE")])])}function Pr(i,e,t,r,n){return Nu(i,e,t,r,n,!1)}function Nu(i,e,t,r,n,o){switch(n){case"NAVIGATE":{Gs(i,e);break}case"OVERLAY":{hc(i,e);break}case"SWAP":{Sm(i,e);break}case"SWAP_STATE":{mE(i,e);break}}let a=i.prototypeInteractions()[0];return i.setTestOnlyPrototypeInteractions([a.withEvent(a.event().withInteractionType(t)).withActions([a.action().value.withTransitionType(r).withTransitionShouldSmartAnimate(o)]).withStateManagementVersion(1)]),i.prototypeInteractions()[0]}function Ou(i){let e=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],t=e.action()!=null?e.action().value:Qr.createDefault();i.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("BACK")])])}function hc(i,e){Am(i,e,R.new2())}function Am(i,e,t){let r=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],n=r.action()!=null?r.action().value:Qr.createDefault();i.setTestOnlyPrototypeInteractions([r.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withOverlayRelativePosition(t).withNavigationType("OVERLAY")])])}function Sm(i,e){let t=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],r=t.action()!=null?t.action().value:Qr.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([r.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP")])])}function mE(i,e){let t=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],r=t.action()!=null?t.action().value:Qr.createDefault();i.setTestOnlyPrototypeInteractions([t.withActions([r.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP_STATE")])])}function bm(i){let e=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0],t=e.action()!=null?e.action().value:Qr.createDefault();i.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("CLOSE")])])}function wu(i,e){let t=i.prototypeInteractions().length==0?Zt.createDefault():i.prototypeInteractions()[0];i.setTestOnlyPrototypeInteractions([t.withEvent(t.event().withInteractionType(e))])}function Je(i,e,t){let r=ee.new2();r.translate1(e),i.setRelativeTransform(r),i.setSize(t)}function ue(i,e){let t=rt(i,e);return t.setTestOnlyFillPaints([te.createSolid(C.RED,1)]),t.setTestOnlyFillGeometry(Qo(V.new4(new R(0,0),t.size()))),t}function Ht(i,e,t,r){let n=rt(i,e);return n.setTestOnlyFillPaints([te.createSolid(t,r)]),n.setTestOnlyFillGeometry(Qo(V.new4(new R(0,0),n.size()))),n}function xu(i,e,t){let r=rt(i,e);return r.setTestOnlyFillPaints(t),r.setTestOnlyFillGeometry(Qo(V.new4(new R(0,0),r.size()))),r}function mc(i,e,t){let r=rt(i,e);return r.setSize(t),r.setTestOnlyFillPaints(Ce.fromPaint(new te("IMAGE"))),r.setTestOnlyFillGeometry(Qo(V.new4(new R(0,0),r.size()))),r}function ym(i,e,t){let r=gn(i,"VECTOR");return r.setName(e),r.setSize(t),r.setTestOnlyFillPaints(Ce.fromPaint(new te("IMAGE"))),r.setTestOnlyFillGeometry(QA(V.new4(new R(0,0),r.size()))),r}function vn(i,e,t,r,n){let o=rt(i,e);return o.setSize(n),o.setTestOnlyFillPaints([te.createSolid(t,r)]),o.setTestOnlyFillGeometry(Qo(V.new4(new R(0,0),o.size()))),o}function Tm(i,e,t,r,n){let o=gn(i,"VECTOR");return o.setName(e),o.setSize(n),o.setTestOnlyFillPaints([te.createSolid(t,r)]),o.setTestOnlyFillGeometry(QA(V.new4(new R(0,0),o.size()))),o}function qA(i,e){let t=hE(i,e);return t.setTestOnlyFillPaints([te.createSolid(C.RED,1)]),t.setTestOnlyTextData(yi.forTests1()),t}function vm(i){Pu(i,[])}function Pu(i,e){if(Wo("Should only be used in tests"),L()==null)throw new Error("Expected PrototypeLib to be initialized");let t=[i],r=[];for(let a=0,s=e.length;a<s;a=a+1){let l={};l.bytes=e[a],r.push(l)}let n={type:"NODE_CHANGES",sessionID:0,ackID:0,blobs:r,nodeChanges:t},o=ke().encodeMessage(n);L().applyLocalNodeChangesForTests(o)}function ma(i,e){if(Wo("Writing to paints is only supported in tests because it's not fully implemented"),ir.isFrameLike(i.type())){let t=[],r=i.fillPaints();if(r!=null)for(let n=0,o=r.length;n<o;n=n+1){let a=r[n].clone();a.setIsEnabled(e),t.push(a)}i.setTestOnlyFillPaints(t)}else i.setIsBackgroundEnabled(!1)}var ks=0;var gc=(M=>(M[M.BOOL=0]="BOOL",M[M.DOUBLE=1]="DOUBLE",M[M.INT=2]="INT",M[M.STRING=3]="STRING",M[M.STRING_ENUM=4]="STRING_ENUM",M[M.AFFINE_TRANSFORM=5]="AFFINE_TRANSFORM",M[M.ARC_DATA=6]="ARC_DATA",M[M.GUID=7]="GUID",M[M.STYLE_ID=8]="STYLE_ID",M[M.OVERLAY_BACKGROUND_APPEARANCE=9]="OVERLAY_BACKGROUND_APPEARANCE",M[M.VECTOR=10]="VECTOR",M[M.EFFECT_LIST=11]="EFFECT_LIST",M[M.PAINT_LIST=12]="PAINT_LIST",M[M.PROTOTYPE_INTERACTION_LIST=13]="PROTOTYPE_INTERACTION_LIST",M[M.GEOMETRY=14]="GEOMETRY",M[M.PARENT_INDEX=15]="PARENT_INDEX",M[M.PROTOTYPE_DEVICE=16]="PROTOTYPE_DEVICE",M[M.PROTOTYPE_STARTING_POINT=17]="PROTOTYPE_STARTING_POINT",M[M.VIDEO_PLAYBACK=18]="VIDEO_PLAYBACK",M[M.KEY_TRIGGER=19]="KEY_TRIGGER",M[M.SYMBOL_DATA=20]="SYMBOL_DATA",M[M.TEXT_DATA=21]="TEXT_DATA",M[M.DERIVED_TEXT_DATA=22]="DERIVED_TEXT_DATA",M[M.VECTOR_DATA=23]="VECTOR_DATA",M[M.HYPERLINK=24]="HYPERLINK",M[M.MENTION=25]="MENTION",M[M.STRING_STRING_MULTIPLAYER_MAP=26]="STRING_STRING_MULTIPLAYER_MAP",M[M.OTHER__=27]="OTHER__",M[M.END__=28]="END__",M))(gc||{});function Hs(i){switch(i){case 90:case 12:case 9:case 13:case 10:case 11:case 14:case 80:case 8:case 16:case 15:case 17:case 18:case 88:case 78:return 0;case 38:case 44:case 45:case 3:case 48:case 37:case 39:case 40:case 41:case 42:case 43:case 46:case 47:return 1;case 64:case 65:return 2;case 70:case 62:case 82:case 97:case 96:return 3;case 22:case 26:case 20:case 21:case 28:case 29:case 30:case 32:case 34:case 31:case 98:case 35:case 84:case 77:case 23:case 33:case 1:case 2:case 27:case 19:return 4;case 24:return 5;case 63:return 6;case 50:case 51:case 69:case 52:case 53:case 54:case 56:case 55:case 71:return 7;case 91:case 92:case 93:case 94:case 95:return 8;case 67:return 9;case 89:case 57:case 87:case 49:return 10;case 61:return 11;case 58:case 59:case 60:return 12;case 81:return 13;case 73:case 74:return 14;case 25:return 15;case 66:return 16;case 83:return 17;case 79:return 19;case 75:return 20;case 4:return 21;case 5:return 22;case 76:return 23;case 72:return 18;case 6:return 24;case 7:return 25;case 85:case 86:return 26;case 68:case 36:return 27;default:return 28}}function ku(i){return Uu(i.map(([e,t])=>new Array(e).fill(t,0,e)))}function Uu(i){return i.reduce((e,t)=>e.concat(Array.isArray(t)?Uu(t):t),[])}var YA=[0,1,2,3].concat(...ku([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function Tr(){let i=this;function e(n){let o=i.dyn_tree,a=i.stat_desc.static_tree,s=i.stat_desc.extra_bits,l=i.stat_desc.extra_base,c=i.stat_desc.max_length,d,h,u,m,g,_,f=0;for(m=0;m<=15;m++)n.bl_count[m]=0;for(o[n.heap[n.heap_max]*2+1]=0,d=n.heap_max+1;d<573;d++)h=n.heap[d],m=o[o[h*2+1]*2+1]+1,m>c&&(m=c,f++),o[h*2+1]=m,!(h>i.max_code)&&(n.bl_count[m]++,g=0,h>=l&&(g=s[h-l]),_=o[h*2],n.opt_len+=_*(m+g),a&&(n.static_len+=_*(a[h*2+1]+g)));if(f!==0){do{for(m=c-1;n.bl_count[m]===0;)m--;n.bl_count[m]--,n.bl_count[m+1]+=2,n.bl_count[c]--,f-=2}while(f>0);for(m=c;m!==0;m--)for(h=n.bl_count[m];h!==0;)u=n.heap[--d],!(u>i.max_code)&&(o[u*2+1]!=m&&(n.opt_len+=(m-o[u*2+1])*o[u*2],o[u*2+1]=m),h--)}}function t(n,o){let a=0;do a|=n&1,n>>>=1,a<<=1;while(--o>0);return a>>>1}function r(n,o,a){let s=[],l=0,c,d,h;for(c=1;c<=15;c++)s[c]=l=l+a[c-1]<<1;for(d=0;d<=o;d++)h=n[d*2+1],h!==0&&(n[d*2]=t(s[h]++,h))}i.build_tree=function(n){let o=i.dyn_tree,a=i.stat_desc.static_tree,s=i.stat_desc.elems,l,c,d=-1,h;for(n.heap_len=0,n.heap_max=573,l=0;l<s;l++)o[l*2]!==0?(n.heap[++n.heap_len]=d=l,n.depth[l]=0):o[l*2+1]=0;for(;n.heap_len<2;)h=n.heap[++n.heap_len]=d<2?++d:0,o[h*2]=1,n.depth[h]=0,n.opt_len--,a&&(n.static_len-=a[h*2+1]);for(i.max_code=d,l=Math.floor(n.heap_len/2);l>=1;l--)n.pqdownheap(o,l);h=s;do l=n.heap[1],n.heap[1]=n.heap[n.heap_len--],n.pqdownheap(o,1),c=n.heap[1],n.heap[--n.heap_max]=l,n.heap[--n.heap_max]=c,o[h*2]=o[l*2]+o[c*2],n.depth[h]=Math.max(n.depth[l],n.depth[c])+1,o[l*2+1]=o[c*2+1]=h,n.heap[1]=h++,n.pqdownheap(o,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],e(n),r(o,i.max_code,n.bl_count)}}Tr._length_code=[0,1,2,3,4,5,6,7].concat(...ku([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));Tr.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];Tr.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];Tr.d_code=function(i){return i<256?YA[i]:YA[256+(i>>>7)]};Tr.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];Tr.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];Tr.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];Tr.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function In(i,e,t,r,n){let o=this;o.static_tree=i,o.extra_bits=e,o.extra_base=t,o.elems=r,o.max_length=n}var gE=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],fE=ku([[144,8],[112,9],[24,7],[8,8]]);In.static_ltree=Uu(gE.map((i,e)=>[i,fE[e]]));var _E=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],AE=ku([[30,5]]);In.static_dtree=Uu(_E.map((i,e)=>[i,AE[e]]));In.static_l_desc=new In(In.static_ltree,Tr.extra_lbits,256+1,286,15);In.static_d_desc=new In(In.static_dtree,Tr.extra_dbits,0,30,15);In.static_bl_desc=new In(null,Tr.extra_blbits,0,19,7);var SE=9,bE=8;function Ti(i,e,t,r,n){let o=this;o.good_length=i,o.max_lazy=e,o.nice_length=t,o.max_chain=r,o.func=n}var JA=0,Bu=1,es=2,ii=[new Ti(0,0,0,0,JA),new Ti(4,4,8,4,Bu),new Ti(4,5,16,8,Bu),new Ti(4,6,32,32,Bu),new Ti(4,4,16,16,es),new Ti(8,16,32,32,es),new Ti(8,16,128,128,es),new Ti(8,32,128,256,es),new Ti(32,128,258,1024,es),new Ti(32,258,258,4096,es)],Fu=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],Ko=0,Du=1,fc=2,Lu=3,yE=32,Im=42,Mu=113,_c=666,Em=8,TE=0,Cm=1,vE=2,Nr=3,Vu=258,Io=Vu+Nr+1;function XA(i,e,t,r){let n=i[e*2],o=i[t*2];return n<o||n==o&&r[e]<=r[t]}function IE(){let i=this,e,t,r,n,o,a,s,l,c,d,h,u,m,g,_,f,S,b,T,y,I,p,A,v,E,D,G,U,M,z,B,w,P,H=new Tr,Q=new Tr,Y=new Tr;i.depth=[];let ne,W,K,j,ge,Ue;i.bl_count=[],i.heap=[],B=[],w=[],P=[];function Tt(){c=2*o,h[m-1]=0;for(let oe=0;oe<m-1;oe++)h[oe]=0;D=ii[G].max_lazy,M=ii[G].good_length,z=ii[G].nice_length,E=ii[G].max_chain,I=0,S=0,A=0,b=v=Nr-1,y=0,u=0}function $e(){let oe;for(oe=0;oe<286;oe++)B[oe*2]=0;for(oe=0;oe<30;oe++)w[oe*2]=0;for(oe=0;oe<19;oe++)P[oe*2]=0;B[256*2]=1,i.opt_len=i.static_len=0,W=K=0}function xt(){H.dyn_tree=B,H.stat_desc=In.static_l_desc,Q.dyn_tree=w,Q.stat_desc=In.static_d_desc,Y.dyn_tree=P,Y.stat_desc=In.static_bl_desc,ge=0,Ue=0,j=8,$e()}i.pqdownheap=function(oe,_e){let le=i.heap,x=le[_e],F=_e<<1;for(;F<=i.heap_len&&(F<i.heap_len&&XA(oe,le[F+1],le[F],i.depth)&&F++,!XA(oe,x,le[F],i.depth));)le[_e]=le[F],_e=F,F<<=1;le[_e]=x};function Vt(oe,_e){let le=-1,x,F=oe[0*2+1],q=0,Z=7,ie=4;F===0&&(Z=138,ie=3),oe[(_e+1)*2+1]=65535;for(let de=0;de<=_e;de++)x=F,F=oe[(de+1)*2+1],!(++q<Z&&x==F)&&(q<ie?P[x*2]+=q:x!==0?(x!=le&&P[x*2]++,P[16*2]++):q<=10?P[17*2]++:P[18*2]++,q=0,le=x,F===0?(Z=138,ie=3):x==F?(Z=6,ie=3):(Z=7,ie=4))}function kt(){let oe;for(Vt(B,H.max_code),Vt(w,Q.max_code),Y.build_tree(i),oe=19-1;oe>=3&&P[Tr.bl_order[oe]*2+1]===0;oe--);return i.opt_len+=3*(oe+1)+5+5+4,oe}function pe(oe){i.pending_buf[i.pending++]=oe}function Me(oe){pe(oe&255),pe(oe>>>8&255)}function vt(oe){pe(oe>>8&255),pe(oe&255&255)}function ct(oe,_e){let le,x=_e;Ue>16-x?(le=oe,ge|=le<<Ue&65535,Me(ge),ge=le>>>16-Ue,Ue+=x-16):(ge|=oe<<Ue&65535,Ue+=x)}function qe(oe,_e){let le=oe*2;ct(_e[le]&65535,_e[le+1]&65535)}function tt(oe,_e){let le,x=-1,F,q=oe[0*2+1],Z=0,ie=7,de=4;for(q===0&&(ie=138,de=3),le=0;le<=_e;le++)if(F=q,q=oe[(le+1)*2+1],!(++Z<ie&&F==q)){if(Z<de)do qe(F,P);while(--Z!==0);else F!==0?(F!=x&&(qe(F,P),Z--),qe(16,P),ct(Z-3,2)):Z<=10?(qe(17,P),ct(Z-3,3)):(qe(18,P),ct(Z-11,7));Z=0,x=F,q===0?(ie=138,de=3):F==q?(ie=6,de=3):(ie=7,de=4)}}function Qe(oe,_e,le){let x;for(ct(oe-257,5),ct(_e-1,5),ct(le-4,4),x=0;x<le;x++)ct(P[Tr.bl_order[x]*2+1],3);tt(B,oe-1),tt(w,_e-1)}function Rt(){Ue==16?(Me(ge),ge=0,Ue=0):Ue>=8&&(pe(ge&255),ge>>>=8,Ue-=8)}function Et(){ct(Cm<<1,3),qe(256,In.static_ltree),Rt(),1+j+10-Ue<9&&(ct(Cm<<1,3),qe(256,In.static_ltree),Rt()),j=7}function Ut(oe,_e){let le,x,F;if(i.dist_buf[W]=oe,i.lc_buf[W]=_e&255,W++,oe===0?B[_e*2]++:(K++,oe--,B[(Tr._length_code[_e]+256+1)*2]++,w[Tr.d_code(oe)*2]++),!(W&8191)&&G>2){for(le=W*8,x=I-S,F=0;F<30;F++)le+=w[F*2]*(5+Tr.extra_dbits[F]);if(le>>>=3,K<Math.floor(W/2)&&le<Math.floor(x/2))return!0}return W==ne-1}function dt(oe,_e){let le,x,F=0,q,Z;if(W!==0)do le=i.dist_buf[F],x=i.lc_buf[F],F++,le===0?qe(x,oe):(q=Tr._length_code[x],qe(q+256+1,oe),Z=Tr.extra_lbits[q],Z!==0&&(x-=Tr.base_length[q],ct(x,Z)),le--,q=Tr.d_code(le),qe(q,_e),Z=Tr.extra_dbits[q],Z!==0&&(le-=Tr.base_dist[q],ct(le,Z)));while(F<W);qe(256,oe),j=oe[256*2+1]}function N(){Ue>8?Me(ge):Ue>0&&pe(ge&255),ge=0,Ue=0}function k(oe,_e,le){N(),j=8,le&&(Me(_e),Me(~_e)),i.pending_buf.set(l.subarray(oe,oe+_e),i.pending),i.pending+=_e}function $(oe,_e,le){ct((TE<<1)+(le?1:0),3),k(oe,_e,!0)}function ae(oe,_e,le){let x,F,q=0;G>0?(H.build_tree(i),Q.build_tree(i),q=kt(),x=i.opt_len+3+7>>>3,F=i.static_len+3+7>>>3,F<=x&&(x=F)):x=F=_e+5,_e+4<=x&&oe!=-1?$(oe,_e,le):F==x?(ct((Cm<<1)+(le?1:0),3),dt(In.static_ltree,In.static_dtree)):(ct((vE<<1)+(le?1:0),3),Qe(H.max_code+1,Q.max_code+1,q+1),dt(B,w)),$e(),le&&N()}function se(oe){ae(S>=0?S:-1,I-S,oe),S=I,e.flush_pending()}function Re(){let oe,_e,le,x;do{if(x=c-A-I,x===0&&I===0&&A===0)x=o;else if(x==-1)x--;else if(I>=o+o-Io){l.set(l.subarray(o,o+o),0),p-=o,I-=o,S-=o,oe=m,le=oe;do _e=h[--le]&65535,h[le]=_e>=o?_e-o:0;while(--oe!==0);oe=o,le=oe;do _e=d[--le]&65535,d[le]=_e>=o?_e-o:0;while(--oe!==0);x+=o}if(e.avail_in===0)return;oe=e.read_buf(l,I+A,x),A+=oe,A>=Nr&&(u=l[I]&255,u=(u<<f^l[I+1]&255)&_)}while(A<Io&&e.avail_in!==0)}function Pe(oe){let _e=65535,le;for(_e>r-5&&(_e=r-5);;){if(A<=1){if(Re(),A===0&&oe==0)return Ko;if(A===0)break}if(I+=A,A=0,le=S+_e,(I===0||I>=le)&&(A=I-le,I=le,se(!1),e.avail_out===0)||I-S>=o-Io&&(se(!1),e.avail_out===0))return Ko}return se(oe==4),e.avail_out===0?oe==4?fc:Ko:oe==4?Lu:Du}function we(oe){let _e=E,le=I,x,F,q=v,Z=I>o-Io?I-(o-Io):0,ie=z,de=s,he=I+Vu,xe=l[le+q-1],Ee=l[le+q];v>=M&&(_e>>=2),ie>A&&(ie=A);do if(x=oe,!(l[x+q]!=Ee||l[x+q-1]!=xe||l[x]!=l[le]||l[++x]!=l[le+1])){le+=2,x++;do;while(l[++le]==l[++x]&&l[++le]==l[++x]&&l[++le]==l[++x]&&l[++le]==l[++x]&&l[++le]==l[++x]&&l[++le]==l[++x]&&l[++le]==l[++x]&&l[++le]==l[++x]&&le<he);if(F=Vu-(he-le),le=he-Vu,F>q){if(p=oe,q=F,F>=ie)break;xe=l[le+q-1],Ee=l[le+q]}}while((oe=d[oe&de]&65535)>Z&&--_e!==0);return q<=A?q:A}function ve(oe){let _e=0,le;for(;;){if(A<Io){if(Re(),A<Io&&oe==0)return Ko;if(A===0)break}if(A>=Nr&&(u=(u<<f^l[I+(Nr-1)]&255)&_,_e=h[u]&65535,d[I&s]=h[u],h[u]=I),_e!==0&&(I-_e&65535)<=o-Io&&U!=2&&(b=we(_e)),b>=Nr)if(le=Ut(I-p,b-Nr),A-=b,b<=D&&A>=Nr){b--;do I++,u=(u<<f^l[I+(Nr-1)]&255)&_,_e=h[u]&65535,d[I&s]=h[u],h[u]=I;while(--b!==0);I++}else I+=b,b=0,u=l[I]&255,u=(u<<f^l[I+1]&255)&_;else le=Ut(0,l[I]&255),A--,I++;if(le&&(se(!1),e.avail_out===0))return Ko}return se(oe==4),e.avail_out===0?oe==4?fc:Ko:oe==4?Lu:Du}function Ke(oe){let _e=0,le,x;for(;;){if(A<Io){if(Re(),A<Io&&oe==0)return Ko;if(A===0)break}if(A>=Nr&&(u=(u<<f^l[I+(Nr-1)]&255)&_,_e=h[u]&65535,d[I&s]=h[u],h[u]=I),v=b,T=p,b=Nr-1,_e!==0&&v<D&&(I-_e&65535)<=o-Io&&(U!=2&&(b=we(_e)),b<=5&&(U==1||b==Nr&&I-p>4096)&&(b=Nr-1)),v>=Nr&&b<=v){x=I+A-Nr,le=Ut(I-1-T,v-Nr),A-=v-1,v-=2;do++I<=x&&(u=(u<<f^l[I+(Nr-1)]&255)&_,_e=h[u]&65535,d[I&s]=h[u],h[u]=I);while(--v!==0);if(y=0,b=Nr-1,I++,le&&(se(!1),e.avail_out===0))return Ko}else if(y!==0){if(le=Ut(0,l[I-1]&255),le&&se(!1),I++,A--,e.avail_out===0)return Ko}else y=1,I++,A--}return y!==0&&(le=Ut(0,l[I-1]&255),y=0),se(oe==4),e.avail_out===0?oe==4?fc:Ko:oe==4?Lu:Du}function ht(oe){return oe.total_in=oe.total_out=0,oe.msg=null,i.pending=0,i.pending_out=0,t=Mu,n=0,xt(),Tt(),0}i.deflateInit=function(oe,_e,le,x,F,q){return x||(x=Em),F||(F=bE),q||(q=0),oe.msg=null,_e==-1&&(_e=6),F<1||F>SE||x!=Em||le<9||le>15||_e<0||_e>9||q<0||q>2?-2:(oe.dstate=i,a=le,o=1<<a,s=o-1,g=F+7,m=1<<g,_=m-1,f=Math.floor((g+Nr-1)/Nr),l=new Uint8Array(o*2),d=[],h=[],ne=1<<F+6,i.pending_buf=new Uint8Array(ne*4),r=ne*4,i.dist_buf=new Uint16Array(ne),i.lc_buf=new Uint8Array(ne),G=_e,U=q,ht(oe))},i.deflateEnd=function(){return t!=Im&&t!=Mu&&t!=_c?-2:(i.lc_buf=null,i.dist_buf=null,i.pending_buf=null,h=null,d=null,l=null,i.dstate=null,t==Mu?-3:0)},i.deflateParams=function(oe,_e,le){let x=0;return _e==-1&&(_e=6),_e<0||_e>9||le<0||le>2?-2:(ii[G].func!=ii[_e].func&&oe.total_in!==0&&(x=oe.deflate(1)),G!=_e&&(G=_e,D=ii[G].max_lazy,M=ii[G].good_length,z=ii[G].nice_length,E=ii[G].max_chain),U=le,x)},i.deflateSetDictionary=function(oe,_e,le){let x=le,F,q=0;if(!_e||t!=Im)return-2;if(x<Nr)return 0;for(x>o-Io&&(x=o-Io,q=le-x),l.set(_e.subarray(q,q+x),0),I=x,S=x,u=l[0]&255,u=(u<<f^l[1]&255)&_,F=0;F<=x-Nr;F++)u=(u<<f^l[F+(Nr-1)]&255)&_,d[F&s]=h[u],h[u]=F;return 0},i.deflate=function(oe,_e){let le,x,F,q,Z;if(_e>4||_e<0)return-2;if(!oe.next_out||!oe.next_in&&oe.avail_in!==0||t==_c&&_e!=4)return oe.msg=Fu[2- -2],-2;if(oe.avail_out===0)return oe.msg=Fu[2- -5],-5;if(e=oe,q=n,n=_e,t==Im&&(x=Em+(a-8<<4)<<8,F=(G-1&255)>>1,F>3&&(F=3),x|=F<<6,I!==0&&(x|=yE),x+=31-x%31,t=Mu,vt(x)),i.pending!==0){if(e.flush_pending(),e.avail_out===0)return n=-1,0}else if(e.avail_in===0&&_e<=q&&_e!=4)return e.msg=Fu[2- -5],-5;if(t==_c&&e.avail_in!==0)return oe.msg=Fu[2- -5],-5;if(e.avail_in!==0||A!==0||_e!=0&&t!=_c){switch(Z=-1,ii[G].func){case JA:Z=Pe(_e);break;case Bu:Z=ve(_e);break;case es:Z=Ke(_e);break;default:}if((Z==fc||Z==Lu)&&(t=_c),Z==Ko||Z==fc)return e.avail_out===0&&(n=-1),0;if(Z==Du){if(_e==1)Et();else if($(0,0,!1),_e==3)for(le=0;le<m;le++)h[le]=0;if(e.flush_pending(),e.avail_out===0)return n=-1,0}}return _e!=4?0:1}}function ZA(){let i=this;i.next_in_index=0,i.next_out_index=0,i.avail_in=0,i.total_in=0,i.avail_out=0,i.total_out=0}ZA.prototype={deflateInit:function(i,e){let t=this;return t.dstate=new IE,e||(e=15),t.dstate.deflateInit(t,i,e)},deflate:function(i){let e=this;return e.dstate?e.dstate.deflate(e,i):-2},deflateEnd:function(){let i=this;if(!i.dstate)return-2;let e=i.dstate.deflateEnd();return i.dstate=null,e},deflateParams:function(i,e){let t=this;return t.dstate?t.dstate.deflateParams(t,i,e):-2},deflateSetDictionary:function(i,e){let t=this;return t.dstate?t.dstate.deflateSetDictionary(t,i,e):-2},read_buf:function(i,e,t){let r=this,n=r.avail_in;return n>t&&(n=t),n===0?0:(r.avail_in-=n,i.set(r.next_in.subarray(r.next_in_index,r.next_in_index+n),e),r.next_in_index+=n,r.total_in+=n,n)},flush_pending:function(){let i=this,e=i.dstate.pending;e>i.avail_out&&(e=i.avail_out),e!==0&&(i.next_out.set(i.dstate.pending_buf.subarray(i.dstate.pending_out,i.dstate.pending_out+e),i.next_out_index),i.next_out_index+=e,i.dstate.pending_out+=e,i.total_out+=e,i.avail_out-=e,i.dstate.pending-=e,i.dstate.pending===0&&(i.dstate.pending_out=0))}};function EE(i){let e=this,t=new ZA,r=CE(i&&i.chunkSize?i.chunkSize:64*1024),n=0,o=new Uint8Array(r),a=i?i.level:-1;typeof a>"u"&&(a=-1),t.deflateInit(a),t.next_out=o,e.append=function(s,l){let c,d,h=0,u=0,m=0,g=[];if(s.length){t.next_in_index=0,t.next_in=s,t.avail_in=s.length;do{if(t.next_out_index=0,t.avail_out=r,c=t.deflate(n),c!=0)throw new Error("deflating: "+t.msg);t.next_out_index&&(t.next_out_index==r?g.push(new Uint8Array(o)):g.push(o.slice(0,t.next_out_index))),m+=t.next_out_index,l&&t.next_in_index>0&&t.next_in_index!=h&&(l(t.next_in_index),h=t.next_in_index)}while(t.avail_in>0||t.avail_out===0);return g.length>1?(d=new Uint8Array(m),g.forEach(function(_){d.set(_,u),u+=_.length})):d=g[0]||new Uint8Array(0),d}},e.flush=function(){let s,l,c=0,d=0,h=[];do{if(t.next_out_index=0,t.avail_out=r,s=t.deflate(4),s!=1&&s!=0)throw new Error("deflating: "+t.msg);r-t.avail_out>0&&h.push(o.slice(0,t.next_out_index)),d+=t.next_out_index}while(t.avail_in>0||t.avail_out===0);return t.deflateEnd(),l=new Uint8Array(d),h.forEach(function(u){l.set(u,c),c+=u.length}),l}}function CE(i){return i+5*(Math.floor(i/16383)+1)}var jA=EE;var Eo=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],AS=1440,RE=0,NE=4,OE=9,wE=5,xE=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],PE=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],FE=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],DE=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],LE=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ME=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ga=15;function wm(){let i=this,e,t,r,n,o,a;function s(c,d,h,u,m,g,_,f,S,b,T){let y,I,p,A,v,E,D,G,U,M,z,B,w,P,H;M=0,v=h;do r[c[d+M]]++,M++,v--;while(v!==0);if(r[0]==h)return _[0]=-1,f[0]=0,0;for(G=f[0],E=1;E<=ga&&r[E]===0;E++);for(D=E,G<E&&(G=E),v=ga;v!==0&&r[v]===0;v--);for(p=v,G>v&&(G=v),f[0]=G,P=1<<E;E<v;E++,P<<=1)if((P-=r[E])<0)return-3;if((P-=r[v])<0)return-3;for(r[v]+=P,a[1]=E=0,M=1,w=2;--v!==0;)a[w]=E+=r[M],w++,M++;v=0,M=0;do(E=c[d+M])!==0&&(T[a[E]++]=v),M++;while(++v<h);for(h=a[p],a[0]=v=0,M=0,A=-1,B=-G,o[0]=0,z=0,H=0;D<=p;D++)for(y=r[D];y--!==0;){for(;D>B+G;){if(A++,B+=G,H=p-B,H=H>G?G:H,(I=1<<(E=D-B))>y+1&&(I-=y+1,w=D,E<H))for(;++E<H&&!((I<<=1)<=r[++w]);)I-=r[w];if(H=1<<E,b[0]+H>AS)return-3;o[A]=z=b[0],b[0]+=H,A!==0?(a[A]=v,n[0]=E,n[1]=G,E=v>>>B-G,n[2]=z-o[A-1]-E,S.set(n,(o[A-1]+E)*3)):_[0]=z}for(n[1]=D-B,M>=h?n[0]=128+64:T[M]<u?(n[0]=T[M]<256?0:32+64,n[2]=T[M++]):(n[0]=g[T[M]-u]+16+64,n[2]=m[T[M++]-u]),I=1<<D-B,E=v>>>B;E<H;E+=I)S.set(n,(z+E)*3);for(E=1<<D-1;v&E;E>>>=1)v^=E;for(v^=E,U=(1<<B)-1;(v&U)!=a[A];)A--,B-=G,U=(1<<B)-1}return P!==0&&p!=1?-5:0}function l(c){let d;for(e||(e=[],t=[],r=new Int32Array(ga+1),n=[],o=new Int32Array(ga),a=new Int32Array(ga+1)),t.length<c&&(t=[]),d=0;d<c;d++)t[d]=0;for(d=0;d<ga+1;d++)r[d]=0;for(d=0;d<3;d++)n[d]=0;o.set(r.subarray(0,ga),0),a.set(r.subarray(0,ga+1),0)}i.inflate_trees_bits=function(c,d,h,u,m){let g;return l(19),e[0]=0,g=s(c,0,19,19,null,null,h,d,u,e,t),g==-3?m.msg="oversubscribed dynamic bit lengths tree":(g==-5||d[0]===0)&&(m.msg="incomplete dynamic bit lengths tree",g=-3),g},i.inflate_trees_dynamic=function(c,d,h,u,m,g,_,f,S){let b;return l(288),e[0]=0,b=s(h,0,c,257,FE,DE,g,u,f,e,t),b!=0||u[0]===0?(b==-3?S.msg="oversubscribed literal/length tree":b!=-4&&(S.msg="incomplete literal/length tree",b=-3),b):(l(288),b=s(h,c,d,0,LE,ME,_,m,f,e,t),b!=0||m[0]===0&&c>257?(b==-3?S.msg="oversubscribed distance tree":b==-5?(S.msg="incomplete distance tree",b=-3):b!=-4&&(S.msg="empty distance tree with lengths",b=-3),b):0)}}wm.inflate_trees_fixed=function(i,e,t,r){return i[0]=OE,e[0]=wE,t[0]=xE,r[0]=PE,0};var Gu=0,$A=1,eS=2,tS=3,rS=4,nS=5,oS=6,Rm=7,iS=8,Hu=9;function BE(){let i=this,e,t=0,r,n=0,o=0,a=0,s=0,l=0,c=0,d=0,h,u=0,m,g=0;function _(f,S,b,T,y,I,p,A){let v,E,D,G,U,M,z,B,w,P,H,Q,Y,ne,W,K;z=A.next_in_index,B=A.avail_in,U=p.bitb,M=p.bitk,w=p.write,P=w<p.read?p.read-w-1:p.end-w,H=Eo[f],Q=Eo[S];do{for(;M<20;)B--,U|=(A.read_byte(z++)&255)<<M,M+=8;if(v=U&H,E=b,D=T,K=(D+v)*3,(G=E[K])===0){U>>=E[K+1],M-=E[K+1],p.win[w++]=E[K+2],P--;continue}do{if(U>>=E[K+1],M-=E[K+1],G&16){for(G&=15,Y=E[K+2]+(U&Eo[G]),U>>=G,M-=G;M<15;)B--,U|=(A.read_byte(z++)&255)<<M,M+=8;v=U&Q,E=y,D=I,K=(D+v)*3,G=E[K];do if(U>>=E[K+1],M-=E[K+1],G&16){for(G&=15;M<G;)B--,U|=(A.read_byte(z++)&255)<<M,M+=8;if(ne=E[K+2]+(U&Eo[G]),U>>=G,M-=G,P-=Y,w>=ne)W=w-ne,w-W>0&&2>w-W?(p.win[w++]=p.win[W++],p.win[w++]=p.win[W++],Y-=2):(p.win.set(p.win.subarray(W,W+2),w),w+=2,W+=2,Y-=2);else{W=w-ne;do W+=p.end;while(W<0);if(G=p.end-W,Y>G){if(Y-=G,w-W>0&&G>w-W)do p.win[w++]=p.win[W++];while(--G!==0);else p.win.set(p.win.subarray(W,W+G),w),w+=G,W+=G,G=0;W=0}}if(w-W>0&&Y>w-W)do p.win[w++]=p.win[W++];while(--Y!==0);else p.win.set(p.win.subarray(W,W+Y),w),w+=Y,W+=Y,Y=0;break}else if(!(G&64))v+=E[K+2],v+=U&Eo[G],K=(D+v)*3,G=E[K];else return A.msg="invalid distance code",Y=A.avail_in-B,Y=M>>3<Y?M>>3:Y,B+=Y,z-=Y,M-=Y<<3,p.bitb=U,p.bitk=M,A.avail_in=B,A.total_in+=z-A.next_in_index,A.next_in_index=z,p.write=w,-3;while(!0);break}if(G&64)return G&32?(Y=A.avail_in-B,Y=M>>3<Y?M>>3:Y,B+=Y,z-=Y,M-=Y<<3,p.bitb=U,p.bitk=M,A.avail_in=B,A.total_in+=z-A.next_in_index,A.next_in_index=z,p.write=w,1):(A.msg="invalid literal/length code",Y=A.avail_in-B,Y=M>>3<Y?M>>3:Y,B+=Y,z-=Y,M-=Y<<3,p.bitb=U,p.bitk=M,A.avail_in=B,A.total_in+=z-A.next_in_index,A.next_in_index=z,p.write=w,-3);if(v+=E[K+2],v+=U&Eo[G],K=(D+v)*3,(G=E[K])===0){U>>=E[K+1],M-=E[K+1],p.win[w++]=E[K+2],P--;break}}while(!0)}while(P>=258&&B>=10);return Y=A.avail_in-B,Y=M>>3<Y?M>>3:Y,B+=Y,z-=Y,M-=Y<<3,p.bitb=U,p.bitk=M,A.avail_in=B,A.total_in+=z-A.next_in_index,A.next_in_index=z,p.write=w,0}i.init=function(f,S,b,T,y,I){e=Gu,c=f,d=S,h=b,u=T,m=y,g=I,r=null},i.proc=function(f,S,b){let T,y,I,p=0,A=0,v=0,E,D,G,U;for(v=S.next_in_index,E=S.avail_in,p=f.bitb,A=f.bitk,D=f.write,G=D<f.read?f.read-D-1:f.end-D;;)switch(e){case Gu:if(G>=258&&E>=10&&(f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,b=_(c,d,h,u,m,g,f,S),v=S.next_in_index,E=S.avail_in,p=f.bitb,A=f.bitk,D=f.write,G=D<f.read?f.read-D-1:f.end-D,b!=0)){e=b==1?Rm:Hu;break}o=c,r=h,n=u,e=$A;case $A:for(T=o;A<T;){if(E!==0)b=0;else return f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);E--,p|=(S.read_byte(v++)&255)<<A,A+=8}if(y=(n+(p&Eo[T]))*3,p>>>=r[y+1],A-=r[y+1],I=r[y],I===0){a=r[y+2],e=oS;break}if(I&16){s=I&15,t=r[y+2],e=eS;break}if(!(I&64)){o=I,n=y/3+r[y+2];break}if(I&32){e=Rm;break}return e=Hu,S.msg="invalid literal/length code",b=-3,f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);case eS:for(T=s;A<T;){if(E!==0)b=0;else return f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);E--,p|=(S.read_byte(v++)&255)<<A,A+=8}t+=p&Eo[T],p>>=T,A-=T,o=d,r=m,n=g,e=tS;case tS:for(T=o;A<T;){if(E!==0)b=0;else return f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);E--,p|=(S.read_byte(v++)&255)<<A,A+=8}if(y=(n+(p&Eo[T]))*3,p>>=r[y+1],A-=r[y+1],I=r[y],I&16){s=I&15,l=r[y+2],e=rS;break}if(!(I&64)){o=I,n=y/3+r[y+2];break}return e=Hu,S.msg="invalid distance code",b=-3,f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);case rS:for(T=s;A<T;){if(E!==0)b=0;else return f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);E--,p|=(S.read_byte(v++)&255)<<A,A+=8}l+=p&Eo[T],p>>=T,A-=T,e=nS;case nS:for(U=D-l;U<0;)U+=f.end;for(;t!==0;){if(G===0&&(D==f.end&&f.read!==0&&(D=0,G=D<f.read?f.read-D-1:f.end-D),G===0&&(f.write=D,b=f.inflate_flush(S,b),D=f.write,G=D<f.read?f.read-D-1:f.end-D,D==f.end&&f.read!==0&&(D=0,G=D<f.read?f.read-D-1:f.end-D),G===0)))return f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);f.win[D++]=f.win[U++],G--,U==f.end&&(U=0),t--}e=Gu;break;case oS:if(G===0&&(D==f.end&&f.read!==0&&(D=0,G=D<f.read?f.read-D-1:f.end-D),G===0&&(f.write=D,b=f.inflate_flush(S,b),D=f.write,G=D<f.read?f.read-D-1:f.end-D,D==f.end&&f.read!==0&&(D=0,G=D<f.read?f.read-D-1:f.end-D),G===0)))return f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);b=0,f.win[D++]=a,G--,e=Gu;break;case Rm:if(A>7&&(A-=8,E++,v--),f.write=D,b=f.inflate_flush(S,b),D=f.write,G=D<f.read?f.read-D-1:f.end-D,f.read!=f.write)return f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);e=iS;case iS:return b=1,f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);case Hu:return b=-3,f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b);default:return b=-2,f.bitb=p,f.bitk=A,S.avail_in=E,S.total_in+=v-S.next_in_index,S.next_in_index=v,f.write=D,f.inflate_flush(S,b)}},i.free=function(){}}var aS=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],zs=0,Nm=1,sS=2,lS=3,cS=4,dS=5,zu=6,Wu=7,uS=8,ts=9;function VE(i,e){let t=this,r=zs,n=0,o=0,a=0,s,l=[0],c=[0],d=new BE,h=0,u=new Int32Array(AS*3),m=0,g=new wm;t.bitk=0,t.bitb=0,t.win=new Uint8Array(e),t.end=e,t.read=0,t.write=0,t.reset=function(_,f){f&&(f[0]=m),r==zu&&d.free(_),r=zs,t.bitk=0,t.bitb=0,t.read=t.write=0},t.reset(i,null),t.inflate_flush=function(_,f){let S,b,T;return b=_.next_out_index,T=t.read,S=(T<=t.write?t.write:t.end)-T,S>_.avail_out&&(S=_.avail_out),S!==0&&f==-5&&(f=0),_.avail_out-=S,_.total_out+=S,_.next_out.set(t.win.subarray(T,T+S),b),b+=S,T+=S,T==t.end&&(T=0,t.write==t.end&&(t.write=0),S=t.write-T,S>_.avail_out&&(S=_.avail_out),S!==0&&f==-5&&(f=0),_.avail_out-=S,_.total_out+=S,_.next_out.set(t.win.subarray(T,T+S),b),b+=S,T+=S),_.next_out_index=b,t.read=T,f},t.proc=function(_,f){let S,b,T,y,I,p,A,v;for(y=_.next_in_index,I=_.avail_in,b=t.bitb,T=t.bitk,p=t.write,A=p<t.read?t.read-p-1:t.end-p;;){let E,D,G,U,M,z,B,w;switch(r){case zs:for(;T<3;){if(I!==0)f=0;else return t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);I--,b|=(_.read_byte(y++)&255)<<T,T+=8}switch(S=b&7,h=S&1,S>>>1){case 0:b>>>=3,T-=3,S=T&7,b>>>=S,T-=S,r=Nm;break;case 1:E=[],D=[],G=[[]],U=[[]],wm.inflate_trees_fixed(E,D,G,U),d.init(E[0],D[0],G[0],0,U[0],0),b>>>=3,T-=3,r=zu;break;case 2:b>>>=3,T-=3,r=lS;break;case 3:return b>>>=3,T-=3,r=ts,_.msg="invalid block type",f=-3,t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f)}break;case Nm:for(;T<32;){if(I!==0)f=0;else return t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);I--,b|=(_.read_byte(y++)&255)<<T,T+=8}if((~b>>>16&65535)!=(b&65535))return r=ts,_.msg="invalid stored block lengths",f=-3,t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);n=b&65535,b=T=0,r=n!==0?sS:h!==0?Wu:zs;break;case sS:if(I===0||A===0&&(p==t.end&&t.read!==0&&(p=0,A=p<t.read?t.read-p-1:t.end-p),A===0&&(t.write=p,f=t.inflate_flush(_,f),p=t.write,A=p<t.read?t.read-p-1:t.end-p,p==t.end&&t.read!==0&&(p=0,A=p<t.read?t.read-p-1:t.end-p),A===0)))return t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);if(f=0,S=n,S>I&&(S=I),S>A&&(S=A),t.win.set(_.read_buf(y,S),p),y+=S,I-=S,p+=S,A-=S,(n-=S)!==0)break;r=h!==0?Wu:zs;break;case lS:for(;T<14;){if(I!==0)f=0;else return t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);I--,b|=(_.read_byte(y++)&255)<<T,T+=8}if(o=S=b&16383,(S&31)>29||(S>>5&31)>29)return r=ts,_.msg="too many length or distance symbols",f=-3,t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);if(S=258+(S&31)+(S>>5&31),!s||s.length<S)s=[];else for(v=0;v<S;v++)s[v]=0;b>>>=14,T-=14,a=0,r=cS;case cS:for(;a<4+(o>>>10);){for(;T<3;){if(I!==0)f=0;else return t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);I--,b|=(_.read_byte(y++)&255)<<T,T+=8}s[aS[a++]]=b&7,b>>>=3,T-=3}for(;a<19;)s[aS[a++]]=0;if(l[0]=7,S=g.inflate_trees_bits(s,l,c,u,_),S!=0)return f=S,f==-3&&(s=null,r=ts),t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);a=0,r=dS;case dS:for(;S=o,!(a>=258+(S&31)+(S>>5&31));){let P,H;for(S=l[0];T<S;){if(I!==0)f=0;else return t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);I--,b|=(_.read_byte(y++)&255)<<T,T+=8}if(S=u[(c[0]+(b&Eo[S]))*3+1],H=u[(c[0]+(b&Eo[S]))*3+2],H<16)b>>>=S,T-=S,s[a++]=H;else{for(v=H==18?7:H-14,P=H==18?11:3;T<S+v;){if(I!==0)f=0;else return t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);I--,b|=(_.read_byte(y++)&255)<<T,T+=8}if(b>>>=S,T-=S,P+=b&Eo[v],b>>>=v,T-=v,v=a,S=o,v+P>258+(S&31)+(S>>5&31)||H==16&&v<1)return s=null,r=ts,_.msg="invalid bit length repeat",f=-3,t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);H=H==16?s[v-1]:0;do s[v++]=H;while(--P!==0);a=v}}if(c[0]=-1,M=[],z=[],B=[],w=[],M[0]=9,z[0]=6,S=o,S=g.inflate_trees_dynamic(257+(S&31),1+(S>>5&31),s,M,z,B,w,u,_),S!=0)return S==-3&&(s=null,r=ts),f=S,t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);d.init(M[0],z[0],u,B[0],u,w[0]),r=zu;case zu:if(t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,(f=d.proc(t,_,f))!=1)return t.inflate_flush(_,f);if(f=0,d.free(_),y=_.next_in_index,I=_.avail_in,b=t.bitb,T=t.bitk,p=t.write,A=p<t.read?t.read-p-1:t.end-p,h===0){r=zs;break}r=Wu;case Wu:if(t.write=p,f=t.inflate_flush(_,f),p=t.write,A=p<t.read?t.read-p-1:t.end-p,t.read!=t.write)return t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);r=uS;case uS:return f=1,t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);case ts:return f=-3,t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f);default:return f=-2,t.bitb=b,t.bitk=T,_.avail_in=I,_.total_in+=y-_.next_in_index,_.next_in_index=y,t.write=p,t.inflate_flush(_,f)}}},t.free=function(_){t.reset(_,null),t.win=null,u=null},t.set_dictionary=function(_,f,S){t.win.set(_.subarray(f,f+S),0),t.read=t.write=S},t.sync_point=function(){return r==Nm?1:0}}var kE=32,UE=8,GE=0,pS=1,hS=2,mS=3,gS=4,fS=5,Om=6,Ac=7,_S=12,fa=13,HE=[0,0,255,255];function zE(){let i=this;i.mode=0,i.method=0,i.was=[0],i.need=0,i.marker=0,i.wbits=0;function e(t){return!t||!t.istate?-2:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=Ac,t.istate.blocks.reset(t,null),0)}i.inflateEnd=function(t){return i.blocks&&i.blocks.free(t),i.blocks=null,0},i.inflateInit=function(t,r){return t.msg=null,i.blocks=null,r<8||r>15?(i.inflateEnd(t),-2):(i.wbits=r,t.istate.blocks=new VE(t,1<<r),e(t),0)},i.inflate=function(t,r){let n,o;if(!t||!t.istate||!t.next_in)return-2;let a=t.istate;for(r=r==NE?-5:0,n=-5;;)switch(a.mode){case GE:if(t.avail_in===0)return n;if(n=r,t.avail_in--,t.total_in++,((a.method=t.read_byte(t.next_in_index++))&15)!=UE){a.mode=fa,t.msg="unknown compression method",a.marker=5;break}if((a.method>>4)+8>a.wbits){a.mode=fa,t.msg="invalid win size",a.marker=5;break}a.mode=pS;case pS:if(t.avail_in===0)return n;if(n=r,t.avail_in--,t.total_in++,o=t.read_byte(t.next_in_index++)&255,((a.method<<8)+o)%31!==0){a.mode=fa,t.msg="incorrect header check",a.marker=5;break}if(!(o&kE)){a.mode=Ac;break}a.mode=hS;case hS:if(t.avail_in===0)return n;n=r,t.avail_in--,t.total_in++,a.need=(t.read_byte(t.next_in_index++)&255)<<24&4278190080,a.mode=mS;case mS:if(t.avail_in===0)return n;n=r,t.avail_in--,t.total_in++,a.need+=(t.read_byte(t.next_in_index++)&255)<<16&16711680,a.mode=gS;case gS:if(t.avail_in===0)return n;n=r,t.avail_in--,t.total_in++,a.need+=(t.read_byte(t.next_in_index++)&255)<<8&65280,a.mode=fS;case fS:return t.avail_in===0?n:(n=r,t.avail_in--,t.total_in++,a.need+=t.read_byte(t.next_in_index++)&255,a.mode=Om,2);case Om:return a.mode=fa,t.msg="need dictionary",a.marker=0,-2;case Ac:if(n=a.blocks.proc(t,n),n==-3){a.mode=fa,a.marker=0;break}if(n==0&&(n=r),n!=1)return n;n=r,a.blocks.reset(t,a.was),a.mode=_S;case _S:return t.avail_in=0,1;case fa:return-3;default:return-2}},i.inflateSetDictionary=function(t,r,n){let o=0,a=n;if(!t||!t.istate||t.istate.mode!=Om)return-2;let s=t.istate;return a>=1<<s.wbits&&(a=(1<<s.wbits)-1,o=n-a),s.blocks.set_dictionary(r,o,a),s.mode=Ac,0},i.inflateSync=function(t){let r,n,o,a,s;if(!t||!t.istate)return-2;let l=t.istate;if(l.mode!=fa&&(l.mode=fa,l.marker=0),(r=t.avail_in)===0)return-5;for(n=t.next_in_index,o=l.marker;r!==0&&o<4;)t.read_byte(n)==HE[o]?o++:t.read_byte(n)!==0?o=0:o=4-o,n++,r--;return t.total_in+=n-t.next_in_index,t.next_in_index=n,t.avail_in=r,l.marker=o,o!=4?-3:(a=t.total_in,s=t.total_out,e(t),t.total_in=a,t.total_out=s,l.mode=Ac,0)},i.inflateSyncPoint=function(t){return!t||!t.istate||!t.istate.blocks?-2:t.istate.blocks.sync_point()}}function SS(){}SS.prototype={inflateInit:function(i){let e=this;return e.istate=new zE,i||(i=15),e.istate.inflateInit(e,i)},inflate:function(i){let e=this;return e.istate?e.istate.inflate(e,i):-2},inflateEnd:function(){let i=this;if(!i.istate)return-2;let e=i.istate.inflateEnd(i);return i.istate=null,e},inflateSync:function(){let i=this;return i.istate?i.istate.inflateSync(i):-2},inflateSetDictionary:function(i,e){let t=this;return t.istate?t.istate.inflateSetDictionary(t,i,e):-2},read_byte:function(i){return this.next_in[i]},read_buf:function(i,e){return this.next_in.subarray(i,i+e)}};function WE(i){let e=this,t=new SS,r=i&&i.chunkSize?Math.floor(i.chunkSize*2):128*1024,n=RE,o=new Uint8Array(r),a=!1;t.inflateInit(),t.next_out=o,e.append=function(s,l){let c=[],d,h,u=0,m=0,g=0;if(s.length!==0){t.next_in_index=0,t.next_in=s,t.avail_in=s.length;do{if(t.next_out_index=0,t.avail_out=r,t.avail_in===0&&!a&&(t.next_in_index=0,a=!0),d=t.inflate(n),a&&d===-5){if(t.avail_in!==0)throw new Error("inflating: bad input")}else if(d!==0&&d!==1)throw new Error("inflating: "+t.msg);if((a||d===1)&&t.avail_in===s.length)throw new Error("inflating: bad input");t.next_out_index&&(t.next_out_index===r?c.push(new Uint8Array(o)):c.push(o.slice(0,t.next_out_index))),g+=t.next_out_index,l&&t.next_in_index>0&&t.next_in_index!=u&&(l(t.next_in_index),u=t.next_in_index)}while(t.avail_in>0||t.avail_out===0);return c.length>1?(h=new Uint8Array(g),c.forEach(function(_){h.set(_,m),m+=_.length})):h=c[0]||new Uint8Array(0),h}},e.flush=function(){t.inflateEnd()}}var bS=WE;var QE={chunkSize:524288,maxWorkers:typeof navigator<"u"&&navigator.hardwareConcurrency||2,terminateWorkerTimeout:5e3,useWebWorkers:!0,workerScripts:void 0},co=Object.assign({},QE);function xm(){return co}function Ws(i){if(i.baseURL!==void 0&&(co.baseURL=i.baseURL),i.chunkSize!==void 0&&(co.chunkSize=i.chunkSize),i.maxWorkers!==void 0&&(co.maxWorkers=i.maxWorkers),i.terminateWorkerTimeout!==void 0&&(co.terminateWorkerTimeout=i.terminateWorkerTimeout),i.useWebWorkers!==void 0&&(co.useWebWorkers=i.useWebWorkers),i.Deflate!==void 0&&(co.Deflate=i.Deflate),i.Inflate!==void 0&&(co.Inflate=i.Inflate),i.workerScripts!==void 0){if(i.workerScripts.deflate){if(!Array.isArray(i.workerScripts.deflate))throw new Error("workerScripts.deflate must be an array");co.workerScripts||(co.workerScripts={}),co.workerScripts.deflate=i.workerScripts.deflate}if(i.workerScripts.inflate){if(!Array.isArray(i.workerScripts.inflate))throw new Error("workerScripts.inflate must be an array");co.workerScripts||(co.workerScripts={}),co.workerScripts.inflate=i.workerScripts.inflate}}}var Sc={application:{"andrew-inset":"ez",annodex:"anx","atom+xml":"atom","atomcat+xml":"atomcat","atomserv+xml":"atomsrv",bbolin:"lin",cap:["cap","pcap"],"cu-seeme":"cu","davmount+xml":"davmount",dsptype:"tsp",ecmascript:["es","ecma"],futuresplash:"spl",hta:"hta","java-archive":"jar","java-serialized-object":"ser","java-vm":"class",javascript:"js",m3g:"m3g","mac-binhex40":"hqx",mathematica:["nb","ma","mb"],msaccess:"mdb",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx",pdf:"pdf","pgp-keys":"key","pgp-signature":["asc","sig"],"pics-rules":"prf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],rar:"rar","rdf+xml":"rdf","rss+xml":"rss",rtf:"rtf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd"],"xspf+xml":"xspf",zip:"zip","vnd.android.package-archive":"apk","vnd.cinderella":"cdy","vnd.google-earth.kml+xml":"kml","vnd.google-earth.kmz":"kmz","vnd.mozilla.xul+xml":"xul","vnd.ms-excel":["xls","xlb","xlt","xlm","xla","xlc","xlw"],"vnd.ms-pki.seccat":"cat","vnd.ms-pki.stl":"stl","vnd.ms-powerpoint":["ppt","pps","pot"],"vnd.oasis.opendocument.chart":"odc","vnd.oasis.opendocument.database":"odb","vnd.oasis.opendocument.formula":"odf","vnd.oasis.opendocument.graphics":"odg","vnd.oasis.opendocument.graphics-template":"otg","vnd.oasis.opendocument.image":"odi","vnd.oasis.opendocument.presentation":"odp","vnd.oasis.opendocument.presentation-template":"otp","vnd.oasis.opendocument.spreadsheet":"ods","vnd.oasis.opendocument.spreadsheet-template":"ots","vnd.oasis.opendocument.text":"odt","vnd.oasis.opendocument.text-master":"odm","vnd.oasis.opendocument.text-template":"ott","vnd.oasis.opendocument.text-web":"oth","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","vnd.openxmlformats-officedocument.presentationml.template":"potx","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","vnd.smaf":"mmf","vnd.stardivision.calc":"sdc","vnd.stardivision.chart":"sds","vnd.stardivision.draw":"sda","vnd.stardivision.impress":"sdd","vnd.stardivision.math":["sdf","smf"],"vnd.stardivision.writer":["sdw","vor"],"vnd.stardivision.writer-global":"sgl","vnd.sun.xml.calc":"sxc","vnd.sun.xml.calc.template":"stc","vnd.sun.xml.draw":"sxd","vnd.sun.xml.draw.template":"std","vnd.sun.xml.impress":"sxi","vnd.sun.xml.impress.template":"sti","vnd.sun.xml.math":"sxm","vnd.sun.xml.writer":"sxw","vnd.sun.xml.writer.global":"sxg","vnd.sun.xml.writer.template":"stw","vnd.symbian.install":["sis","sisx"],"vnd.visio":["vsd","vst","vss","vsw"],"vnd.wap.wbxml":"wbxml","vnd.wap.wmlc":"wmlc","vnd.wap.wmlscriptc":"wmlsc","vnd.wordperfect":"wpd","vnd.wordperfect5.1":"wp5","x-123":"wk","x-7z-compressed":"7z","x-abiword":"abw","x-apple-diskimage":"dmg","x-bcpio":"bcpio","x-bittorrent":"torrent","x-cbr":["cbr","cba","cbt","cb7"],"x-cbz":"cbz","x-cdf":["cdf","cda"],"x-cdlink":"vcd","x-chess-pgn":"pgn","x-cpio":"cpio","x-csh":"csh","x-debian-package":["deb","udeb"],"x-director":["dcr","dir","dxr","cst","cct","cxt","w3d","fgd","swa"],"x-dms":"dms","x-doom":"wad","x-dvi":"dvi","x-httpd-eruby":"rhtml","x-font":"pcf.Z","x-freemind":"mm","x-gnumeric":"gnumeric","x-go-sgf":"sgf","x-graphing-calculator":"gcf","x-gtar":["gtar","taz"],"x-hdf":"hdf","x-httpd-php":["phtml","pht","php"],"x-httpd-php-source":"phps","x-httpd-php3":"php3","x-httpd-php3-preprocessed":"php3p","x-httpd-php4":"php4","x-httpd-php5":"php5","x-ica":"ica","x-info":"info","x-internet-signup":["ins","isp"],"x-iphone":"iii","x-iso9660-image":"iso","x-java-jnlp-file":"jnlp","x-jmol":"jmz","x-killustrator":"kil","x-koan":["skp","skd","skt","skm"],"x-kpresenter":["kpr","kpt"],"x-kword":["kwd","kwt"],"x-latex":"latex","x-lha":"lha","x-lyx":"lyx","x-lzh":"lzh","x-lzx":"lzx","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-ms-wmd":"wmd","x-ms-wmz":"wmz","x-msdos-program":["com","exe","bat","dll"],"x-msi":"msi","x-netcdf":["nc","cdf"],"x-ns-proxy-autoconfig":["pac","dat"],"x-nwc":"nwc","x-object":"o","x-oz-application":"oza","x-pkcs7-certreqresp":"p7r","x-python-code":["pyc","pyo"],"x-qgis":["qgs","shp","shx"],"x-quicktimeplayer":"qtl","x-redhat-package-manager":"rpm","x-ruby":"rb","x-sh":"sh","x-shar":"shar","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","x-stuffit":"sit","x-sv4cpio":"sv4cpio","x-sv4crc":"sv4crc","x-tar":"tar","x-tcl":"tcl","x-tex-gf":"gf","x-tex-pk":"pk","x-texinfo":["texinfo","texi"],"x-trash":["~","%","bak","old","sik"],"x-troff":["t","tr","roff"],"x-troff-man":"man","x-troff-me":"me","x-troff-ms":"ms","x-ustar":"ustar","x-wais-source":"src","x-wingz":"wz","x-x509-ca-cert":["crt","der","cer"],"x-xcf":"xcf","x-xfig":"fig","x-xpinstall":"xpi",applixware:"aw","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-capability":"cdmia","cdmi-container":"cdmic","cdmi-domain":"cdmid","cdmi-object":"cdmio","cdmi-queue":"cdmiq","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-tdpfr":"pfr","gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx","mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s","oebps-package+xml":"opf","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps","patch-ops-error+xml":"xer","pgp-encrypted":"pgp",pkcs10:"p10","pkcs7-mime":["p7m","p7c"],"pkcs7-signature":"p7s",pkcs8:"p8","pkix-attr-cert":"ac","pkix-crl":"crl","pkix-pkipath":"pkipath",pkixcmp:"pki","pls+xml":"pls","prs.cww":"cww","pskc+xml":"pskcxml","reginfo+xml":"rif","relax-ng-compact-syntax":"rnc","resource-lists+xml":"rl","resource-lists-diff+xml":"rld","rls-services+xml":"rs","rpki-ghostbusters":"gbr","rpki-manifest":"mft","rpki-roa":"roa","rsd+xml":"rsd","sbml+xml":"sbml","scvp-cv-request":"scq","scvp-cv-response":"scs","scvp-vp-request":"spq","scvp-vp-response":"spp",sdp:"sdp","set-payment-initiation":"setpay","set-registration-initiation":"setreg","shf+xml":"shf","sparql-query":"rq","sparql-results+xml":"srx",srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","timestamped-data":"tsd","vnd.3gpp.pic-bw-large":"plb","vnd.3gpp.pic-bw-small":"psb","vnd.3gpp.pic-bw-var":"pvb","vnd.3gpp2.tcap":"tcap","vnd.3m.post-it-notes":"pwn","vnd.accpac.simply.aso":"aso","vnd.accpac.simply.imp":"imp","vnd.acucobol":"acu","vnd.acucorp":["atc","acutc"],"vnd.adobe.air-application-installer-package+zip":"air","vnd.adobe.formscentral.fcdt":"fcdt","vnd.adobe.fxp":["fxp","fxpl"],"vnd.adobe.xdp+xml":"xdp","vnd.adobe.xfdf":"xfdf","vnd.ahead.space":"ahead","vnd.airzip.filesecure.azf":"azf","vnd.airzip.filesecure.azs":"azs","vnd.amazon.ebook":"azw","vnd.americandynamics.acc":"acc","vnd.amiga.ami":"ami","vnd.anser-web-certificate-issue-initiation":"cii","vnd.anser-web-funds-transfer-initiation":"fti","vnd.antix.game-component":"atx","vnd.apple.installer+xml":"mpkg","vnd.apple.mpegurl":"m3u8","vnd.aristanetworks.swi":"swi","vnd.astraea-software.iota":"iota","vnd.audiograph":"aep","vnd.blueice.multipass":"mpm","vnd.bmi":"bmi","vnd.businessobjects":"rep","vnd.chemdraw+xml":"cdxml","vnd.chipnuts.karaoke-mmd":"mmd","vnd.claymore":"cla","vnd.cloanto.rp9":"rp9","vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"vnd.cluetrust.cartomobile-config":"c11amc","vnd.cluetrust.cartomobile-config-pkg":"c11amz","vnd.commonspace":"csp","vnd.contact.cmsg":"cdbcmsg","vnd.cosmocaller":"cmc","vnd.crick.clicker":"clkx","vnd.crick.clicker.keyboard":"clkk","vnd.crick.clicker.palette":"clkp","vnd.crick.clicker.template":"clkt","vnd.crick.clicker.wordbank":"clkw","vnd.criticaltools.wbs+xml":"wbs","vnd.ctc-posml":"pml","vnd.cups-ppd":"ppd","vnd.curl.car":"car","vnd.curl.pcurl":"pcurl","vnd.dart":"dart","vnd.data-vision.rdz":"rdz","vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"vnd.dece.ttml+xml":["uvt","uvvt"],"vnd.dece.unspecified":["uvx","uvvx"],"vnd.dece.zip":["uvz","uvvz"],"vnd.denovo.fcselayout-link":"fe_launch","vnd.dna":"dna","vnd.dolby.mlp":"mlp","vnd.dpgraph":"dpg","vnd.dreamfactory":"dfac","vnd.ds-keypoint":"kpxx","vnd.dvb.ait":"ait","vnd.dvb.service":"svc","vnd.dynageo":"geo","vnd.ecowin.chart":"mag","vnd.enliven":"nml","vnd.epson.esf":"esf","vnd.epson.msf":"msf","vnd.epson.quickanime":"qam","vnd.epson.salt":"slt","vnd.epson.ssf":"ssf","vnd.eszigno3+xml":["es3","et3"],"vnd.ezpix-album":"ez2","vnd.ezpix-package":"ez3","vnd.fdf":"fdf","vnd.fdsn.mseed":"mseed","vnd.fdsn.seed":["seed","dataless"],"vnd.flographit":"gph","vnd.fluxtime.clip":"ftc","vnd.framemaker":["fm","frame","maker","book"],"vnd.frogans.fnc":"fnc","vnd.frogans.ltf":"ltf","vnd.fsc.weblaunch":"fsc","vnd.fujitsu.oasys":"oas","vnd.fujitsu.oasys2":"oa2","vnd.fujitsu.oasys3":"oa3","vnd.fujitsu.oasysgp":"fg5","vnd.fujitsu.oasysprs":"bh2","vnd.fujixerox.ddd":"ddd","vnd.fujixerox.docuworks":"xdw","vnd.fujixerox.docuworks.binder":"xbd","vnd.fuzzysheet":"fzs","vnd.genomatix.tuxedo":"txd","vnd.geogebra.file":"ggb","vnd.geogebra.tool":"ggt","vnd.geometry-explorer":["gex","gre"],"vnd.geonext":"gxt","vnd.geoplan":"g2w","vnd.geospace":"g3w","vnd.gmx":"gmx","vnd.grafeq":["gqf","gqs"],"vnd.groove-account":"gac","vnd.groove-help":"ghf","vnd.groove-identity-message":"gim","vnd.groove-injector":"grv","vnd.groove-tool-message":"gtm","vnd.groove-tool-template":"tpl","vnd.groove-vcard":"vcg","vnd.hal+xml":"hal","vnd.handheld-entertainment+xml":"zmm","vnd.hbci":"hbci","vnd.hhe.lesson-player":"les","vnd.hp-hpgl":"hpgl","vnd.hp-hpid":"hpid","vnd.hp-hps":"hps","vnd.hp-jlyt":"jlt","vnd.hp-pcl":"pcl","vnd.hp-pclxl":"pclxl","vnd.hydrostatix.sof-data":"sfd-hdstx","vnd.ibm.minipay":"mpy","vnd.ibm.modcap":["afp","listafp","list3820"],"vnd.ibm.rights-management":"irm","vnd.ibm.secure-container":"sc","vnd.iccprofile":["icc","icm"],"vnd.igloader":"igl","vnd.immervision-ivp":"ivp","vnd.immervision-ivu":"ivu","vnd.insors.igm":"igm","vnd.intercon.formnet":["xpw","xpx"],"vnd.intergeo":"i2g","vnd.intu.qbo":"qbo","vnd.intu.qfx":"qfx","vnd.ipunplugged.rcprofile":"rcprofile","vnd.irepository.package+xml":"irp","vnd.is-xpr":"xpr","vnd.isac.fcs":"fcs","vnd.jam":"jam","vnd.jcp.javame.midlet-rms":"rms","vnd.jisp":"jisp","vnd.joost.joda-archive":"joda","vnd.kahootz":["ktz","ktr"],"vnd.kde.karbon":"karbon","vnd.kde.kchart":"chrt","vnd.kde.kformula":"kfo","vnd.kde.kivio":"flw","vnd.kde.kontour":"kon","vnd.kde.kpresenter":["kpr","kpt"],"vnd.kde.kspread":"ksp","vnd.kde.kword":["kwd","kwt"],"vnd.kenameaapp":"htke","vnd.kidspiration":"kia","vnd.kinar":["kne","knp"],"vnd.koan":["skp","skd","skt","skm"],"vnd.kodak-descriptor":"sse","vnd.las.las+xml":"lasxml","vnd.llamagraphics.life-balance.desktop":"lbd","vnd.llamagraphics.life-balance.exchange+xml":"lbe","vnd.lotus-1-2-3":"123","vnd.lotus-approach":"apr","vnd.lotus-freelance":"pre","vnd.lotus-notes":"nsf","vnd.lotus-organizer":"org","vnd.lotus-screencam":"scm","vnd.lotus-wordpro":"lwp","vnd.macports.portpkg":"portpkg","vnd.mcd":"mcd","vnd.medcalcdata":"mc1","vnd.mediastation.cdkey":"cdkey","vnd.mfer":"mwf","vnd.mfmp":"mfm","vnd.micrografx.flo":"flo","vnd.micrografx.igx":"igx","vnd.mif":"mif","vnd.mobius.daf":"daf","vnd.mobius.dis":"dis","vnd.mobius.mbk":"mbk","vnd.mobius.mqy":"mqy","vnd.mobius.msl":"msl","vnd.mobius.plc":"plc","vnd.mobius.txf":"txf","vnd.mophun.application":"mpn","vnd.mophun.certificate":"mpc","vnd.ms-artgalry":"cil","vnd.ms-cab-compressed":"cab","vnd.ms-excel.addin.macroenabled.12":"xlam","vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","vnd.ms-excel.sheet.macroenabled.12":"xlsm","vnd.ms-excel.template.macroenabled.12":"xltm","vnd.ms-fontobject":"eot","vnd.ms-htmlhelp":"chm","vnd.ms-ims":"ims","vnd.ms-lrm":"lrm","vnd.ms-officetheme":"thmx","vnd.ms-powerpoint.addin.macroenabled.12":"ppam","vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","vnd.ms-powerpoint.slide.macroenabled.12":"sldm","vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","vnd.ms-powerpoint.template.macroenabled.12":"potm","vnd.ms-project":["mpp","mpt"],"vnd.ms-word.document.macroenabled.12":"docm","vnd.ms-word.template.macroenabled.12":"dotm","vnd.ms-works":["wps","wks","wcm","wdb"],"vnd.ms-wpl":"wpl","vnd.ms-xpsdocument":"xps","vnd.mseq":"mseq","vnd.musician":"mus","vnd.muvee.style":"msty","vnd.mynfc":"taglet","vnd.neurolanguage.nlu":"nlu","vnd.nitf":["ntf","nitf"],"vnd.noblenet-directory":"nnd","vnd.noblenet-sealer":"nns","vnd.noblenet-web":"nnw","vnd.nokia.n-gage.data":"ngdat","vnd.nokia.n-gage.symbian.install":"n-gage","vnd.nokia.radio-preset":"rpst","vnd.nokia.radio-presets":"rpss","vnd.novadigm.edm":"edm","vnd.novadigm.edx":"edx","vnd.novadigm.ext":"ext","vnd.oasis.opendocument.chart-template":"otc","vnd.oasis.opendocument.formula-template":"odft","vnd.oasis.opendocument.image-template":"oti","vnd.olpc-sugar":"xo","vnd.oma.dd2+xml":"dd2","vnd.openofficeorg.extension":"oxt","vnd.openxmlformats-officedocument.presentationml.slide":"sldx","vnd.osgeo.mapguide.package":"mgp","vnd.osgi.dp":"dp","vnd.osgi.subsystem":"esa","vnd.palm":["pdb","pqa","oprc"],"vnd.pawaafile":"paw","vnd.pg.format":"str","vnd.pg.osasli":"ei6","vnd.picsel":"efif","vnd.pmi.widget":"wg","vnd.pocketlearn":"plf","vnd.powerbuilder6":"pbd","vnd.previewsystems.box":"box","vnd.proteus.magazine":"mgz","vnd.publishare-delta-tree":"qps","vnd.pvi.ptid1":"ptid","vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"vnd.realvnc.bed":"bed","vnd.recordare.musicxml":"mxl","vnd.recordare.musicxml+xml":"musicxml","vnd.rig.cryptonote":"cryptonote","vnd.rn-realmedia":"rm","vnd.rn-realmedia-vbr":"rmvb","vnd.route66.link66+xml":"link66","vnd.sailingtracker.track":"st","vnd.seemail":"see","vnd.sema":"sema","vnd.semd":"semd","vnd.semf":"semf","vnd.shana.informed.formdata":"ifm","vnd.shana.informed.formtemplate":"itp","vnd.shana.informed.interchange":"iif","vnd.shana.informed.package":"ipk","vnd.simtech-mindmapper":["twd","twds"],"vnd.smart.teacher":"teacher","vnd.solent.sdkm+xml":["sdkm","sdkd"],"vnd.spotfire.dxp":"dxp","vnd.spotfire.sfs":"sfs","vnd.stepmania.package":"smzip","vnd.stepmania.stepchart":"sm","vnd.sus-calendar":["sus","susp"],"vnd.svd":"svd","vnd.syncml+xml":"xsm","vnd.syncml.dm+wbxml":"bdm","vnd.syncml.dm+xml":"xdm","vnd.tao.intent-module-archive":"tao","vnd.tcpdump.pcap":["pcap","cap","dmp"],"vnd.tmobile-livetv":"tmo","vnd.trid.tpt":"tpt","vnd.triscape.mxs":"mxs","vnd.trueapp":"tra","vnd.ufdl":["ufd","ufdl"],"vnd.uiq.theme":"utz","vnd.umajin":"umj","vnd.unity":"unityweb","vnd.uoml+xml":"uoml","vnd.vcx":"vcx","vnd.visionary":"vis","vnd.vsf":"vsf","vnd.webturbo":"wtb","vnd.wolfram.player":"nbp","vnd.wqd":"wqd","vnd.wt.stf":"stf","vnd.xara":"xar","vnd.xfdl":"xfdl","vnd.yamaha.hv-dic":"hvd","vnd.yamaha.hv-script":"hvs","vnd.yamaha.hv-voice":"hvp","vnd.yamaha.openscoreformat":"osf","vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","vnd.yamaha.smaf-audio":"saf","vnd.yamaha.smaf-phrase":"spf","vnd.yellowriver-custom-menu":"cmp","vnd.zul":["zir","zirz"],"vnd.zzazz.deck+xml":"zaz","voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-ace-compressed":"ace","x-authorware-bin":["aab","x32","u32","vox"],"x-authorware-map":"aam","x-authorware-seg":"aas","x-blorb":["blb","blorb"],"x-bzip":"bz","x-bzip2":["bz2","boz"],"x-cfs-compressed":"cfs","x-chat":"chat","x-conference":"nsc","x-dgc-compressed":"dgc","x-dtbncx+xml":"ncx","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-eva":"eva","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-freearc":"arc","x-gca-compressed":"gca","x-glulx":"ulx","x-gramps-xml":"gramps","x-install-instructions":"install","x-lzh-compressed":["lzh","lha"],"x-mie":"mie","x-mobipocket-ebook":["prc","mobi"],"x-ms-application":"application","x-ms-shortcut":"lnk","x-ms-xbap":"xbap","x-msbinder":"obd","x-mscardfile":"crd","x-msclip":"clp","x-msdownload":["exe","dll","com","bat","msi"],"x-msmediaview":["mvb","m13","m14"],"x-msmetafile":["wmf","wmz","emf","emz"],"x-msmoney":"mny","x-mspublisher":"pub","x-msschedule":"scd","x-msterminal":"trm","x-mswrite":"wri","x-nzb":"nzb","x-pkcs12":["p12","pfx"],"x-pkcs7-certificates":["p7b","spc"],"x-research-info-systems":"ris","x-silverlight-app":"xap","x-sql":"sql","x-stuffitx":"sitx","x-subrip":"srt","x-t3vm-image":"t3","x-tads":"gam","x-tex":"tex","x-tex-tfm":"tfm","x-tgif":"obj","x-xliff+xml":"xlf","x-xz":"xz","x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"xaml+xml":"xaml","xcap-diff+xml":"xdf","xenc+xml":"xenc","xml-dtd":"dtd","xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",envoy:"evy",fractals:"fif","internet-property-stream":"acx",olescript:"axs","vnd.ms-outlook":"msg","vnd.ms-pkicertstore":"sst","x-compress":"z","x-compressed":"tgz","x-gzip":"gz","x-perfmon":["pma","pmc","pml","pmr","pmw"],"x-pkcs7-mime":["p7c","p7m"],"ynd.ms-pkipko":"pko"},audio:{amr:"amr","amr-wb":"awb",annodex:"axa",basic:["au","snd"],flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"prs.sid":"sid","x-aiff":["aif","aiff","aifc"],"x-gsm":"gsm","x-ms-wma":"wma","x-ms-wax":"wax","x-pn-realaudio":"ram","x-realaudio":"ra","x-sd2":"sd2","x-wav":"wav",adpcm:"adp",mp4:"mp4a",s3m:"s3m",silk:"sil","vnd.dece.audio":["uva","uvva"],"vnd.digital-winds":"eol","vnd.dra":"dra","vnd.dts":"dts","vnd.dts.hd":"dtshd","vnd.lucent.voice":"lvp","vnd.ms-playready.media.pya":"pya","vnd.nuera.ecelp4800":"ecelp4800","vnd.nuera.ecelp7470":"ecelp7470","vnd.nuera.ecelp9600":"ecelp9600","vnd.rip":"rip",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},chemical:{"x-alchemy":"alc","x-cache":["cac","cache"],"x-cache-csf":"csf","x-cactvs-binary":["cbin","cascii","ctab"],"x-cdx":"cdx","x-chem3d":"c3d","x-cif":"cif","x-cmdf":"cmdf","x-cml":"cml","x-compass":"cpa","x-crossfire":"bsd","x-csml":["csml","csm"],"x-ctx":"ctx","x-cxf":["cxf","cef"],"x-embl-dl-nucleotide":["emb","embl"],"x-gamess-input":["inp","gam","gamin"],"x-gaussian-checkpoint":["fch","fchk"],"x-gaussian-cube":"cub","x-gaussian-input":["gau","gjc","gjf"],"x-gaussian-log":"gal","x-gcg8-sequence":"gcg","x-genbank":"gen","x-hin":"hin","x-isostar":["istr","ist"],"x-jcamp-dx":["jdx","dx"],"x-kinemage":"kin","x-macmolecule":"mcm","x-macromodel-input":["mmd","mmod"],"x-mdl-molfile":"mol","x-mdl-rdfile":"rd","x-mdl-rxnfile":"rxn","x-mdl-sdfile":["sd","sdf"],"x-mdl-tgf":"tgf","x-mmcif":"mcif","x-mol2":"mol2","x-molconn-Z":"b","x-mopac-graph":"gpt","x-mopac-input":["mop","mopcrt","mpc","zmt"],"x-mopac-out":"moo","x-ncbi-asn1":"asn","x-ncbi-asn1-ascii":["prt","ent"],"x-ncbi-asn1-binary":["val","aso"],"x-pdb":["pdb","ent"],"x-rosdal":"ros","x-swissprot":"sw","x-vamas-iso14976":"vms","x-vmd":"vmd","x-xtel":"xtel","x-xyz":"xyz"},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.djvu":["djvu","djv"],"vnd.wap.wbmp":"wbmp","x-canon-cr2":"cr2","x-canon-crw":"crw","x-cmu-raster":"ras","x-coreldraw":"cdr","x-coreldrawpattern":"pat","x-coreldrawtemplate":"cdt","x-corelphotopaint":"cpt","x-epson-erf":"erf","x-icon":"ico","x-jg":"art","x-jng":"jng","x-nikon-nef":"nef","x-olympus-orf":"orf","x-photoshop":"psd","x-portable-anymap":"pnm","x-portable-bitmap":"pbm","x-portable-graymap":"pgm","x-portable-pixmap":"ppm","x-rgb":"rgb","x-xbitmap":"xbm","x-xpixmap":"xpm","x-xwindowdump":"xwd",bmp:"bmp",cgm:"cgm",g3fax:"g3",ktx:"ktx","prs.btif":"btif",sgi:"sgi","vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"vnd.dwg":"dwg","vnd.dxf":"dxf","vnd.fastbidsheet":"fbs","vnd.fpx":"fpx","vnd.fst":"fst","vnd.fujixerox.edmics-mmr":"mmr","vnd.fujixerox.edmics-rlc":"rlc","vnd.ms-modi":"mdi","vnd.ms-photo":"wdp","vnd.net-fpx":"npx","vnd.xiff":"xif",webp:"webp","x-3ds":"3ds","x-cmx":"cmx","x-freehand":["fh","fhc","fh4","fh5","fh7"],"x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod",pipeg:"jfif"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},model:{iges:["igs","iges"],mesh:["msh","mesh","silo"],vrml:["wrl","vrml"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"],"x3d+binary":["x3db","x3dbz"],"vnd.collada+xml":"dae","vnd.dwf":"dwf","vnd.gdl":"gdl","vnd.gtw":"gtw","vnd.mts":"mts","vnd.vtu":"vtu"},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx",scriptlet:["sct","wsc"],texmacs:["tm","ts"],"tab-separated-values":"tsv","vnd.sun.j2me.app-descriptor":"jad","vnd.wap.wml":"wml","vnd.wap.wmlscript":"wmls","x-bibtex":"bib","x-boo":"boo","x-c++hdr":["h++","hpp","hxx","hh"],"x-c++src":["c++","cpp","cxx","cc"],"x-component":"htc","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcalendar":"vcs","x-vcard":"vcf",n3:"n3","prs.lines.tag":"dsc",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl","uri-list":["uri","uris","urls"],vcard:"vcard","vnd.curl":"curl","vnd.curl.dcurl":"dcurl","vnd.curl.scurl":"scurl","vnd.curl.mcurl":"mcurl","vnd.dvb.subtitle":"sub","vnd.fly":"fly","vnd.fmi.flexstor":"flx","vnd.graphviz":"gv","vnd.in3d.3dml":"3dml","vnd.in3d.spot":"spot","x-asm":["s","asm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{avif:".avif","3gpp":"3gp",annodex:"axv",dl:"dl",dv:["dif","dv"],fli:"fli",gl:"gl",mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.dece.hd":["uvh","uvvh"],"vnd.dece.mobile":["uvm","uvvm"],"vnd.dece.pd":["uvp","uvvp"],"vnd.dece.sd":["uvs","uvvs"],"vnd.dece.video":["uvv","uvvv"],"vnd.dvb.file":"dvb","vnd.fvt":"fvt","vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"},"x-conference":{"x-cooltalk":"ice"},"x-world":{"x-vrml":["vrm","vrml","wrl","flr","wrz","xaf","xof"]}},AL=(()=>{let i={};for(let e in Sc)if(Sc.hasOwnProperty(e)){for(let t in Sc[e])if(Sc[e].hasOwnProperty(t)){let r=Sc[e][t];if(typeof r=="string")i[r]=e+"/"+t;else for(let n=0;n<r.length;n++)i[r[n]]=e+"/"+t}}return i})();var yS=[];for(let i=0;i<256;i++){let e=i;for(let t=0;t<8;t++)e&1?e=e>>>1^3988292384:e=e>>>1;yS[i]=e}var Pm=class{constructor(e){this.crc=e||-1}append(e){let t=this.crc|0;for(let r=0,n=e.length|0;r<n;r++)t=t>>>8^yS[(t^e[r])&255];this.crc=t}get(){return~this.crc}},_a=Pm;var Fm=qE;function qE(i){if(typeof TextEncoder>"u"){i=unescape(encodeURIComponent(i));let e=new Uint8Array(i.length);for(let t=0;t<e.length;t++)e[t]=i.charCodeAt(t);return e}else return new TextEncoder().encode(i)}var Kn={concat(i,e){if(i.length===0||e.length===0)return i.concat(e);let t=i[i.length-1],r=Kn.getPartial(t);return r===32?i.concat(e):Kn._shiftRight(e,r,t|0,i.slice(0,i.length-1))},bitLength(i){let e=i.length;if(e===0)return 0;let t=i[e-1];return(e-1)*32+Kn.getPartial(t)},clamp(i,e){if(i.length*32<e)return i;i=i.slice(0,Math.ceil(e/32));let t=i.length;return e=e&31,t>0&&e&&(i[t-1]=Kn.partial(e,i[t-1]&2147483648>>e-1,1)),i},partial(i,e,t){return i===32?e:(t?e|0:e<<32-i)+i*1099511627776},getPartial(i){return Math.round(i/1099511627776)||32},_shiftRight(i,e,t,r){for(r===void 0&&(r=[]);e>=32;e-=32)r.push(t),t=0;if(e===0)return r.concat(i);for(let a=0;a<i.length;a++)r.push(t|i[a]>>>e),t=i[a]<<32-e;let n=i.length?i[i.length-1]:0,o=Kn.getPartial(n);return r.push(Kn.partial(e+o&31,e+o>32?t:r.pop(),1)),r}},bc={bytes:{fromBits(i){let t=Kn.bitLength(i)/8,r=new Uint8Array(t),n;for(let o=0;o<t;o++)o&3||(n=i[o/4]),r[o]=n>>>24,n<<=8;return r},toBits(i){let e=[],t,r=0;for(t=0;t<i.length;t++)r=r<<8|i[t],(t&3)===3&&(e.push(r),r=0);return t&3&&e.push(Kn.partial(8*(t&3),r)),e}}},Dm={};Dm.sha1=function(i){i?(this._h=i._h.slice(0),this._buffer=i._buffer.slice(0),this._length=i._length):this.reset()};Dm.sha1.prototype={blockSize:512,reset:function(){let i=this;return i._h=this._init.slice(0),i._buffer=[],i._length=0,i},update:function(i){let e=this;typeof i=="string"&&(i=bc.utf8String.toBits(i));let t=e._buffer=Kn.concat(e._buffer,i),r=e._length,n=e._length=r+Kn.bitLength(i);if(n>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let o=new Uint32Array(t),a=0;for(let s=e.blockSize+r-(e.blockSize+r&e.blockSize-1);s<=n;s+=e.blockSize)e._block(o.subarray(16*a,16*(a+1))),a+=1;return t.splice(0,16*a),e},finalize:function(){let i=this,e=i._buffer,t=i._h;e=Kn.concat(e,[Kn.partial(1,1)]);for(let r=e.length+2;r&15;r++)e.push(0);for(e.push(Math.floor(i._length/4294967296)),e.push(i._length|0);e.length;)i._block(e.splice(0,16));return i.reset(),t},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(i,e,t,r){if(i<=19)return e&t|~e&r;if(i<=39)return e^t^r;if(i<=59)return e&t|e&r|t&r;if(i<=79)return e^t^r},_S:function(i,e){return e<<i|e>>>32-i},_block:function(i){let e=this,t=e._h,r=Array(80);for(let c=0;c<16;c++)r[c]=i[c];let n=t[0],o=t[1],a=t[2],s=t[3],l=t[4];for(let c=0;c<=79;c++){c>=16&&(r[c]=e._S(1,r[c-3]^r[c-8]^r[c-14]^r[c-16]));let d=e._S(5,n)+e._f(c,o,a,s)+l+r[c]+e._key[Math.floor(c/20)]|0;l=s,s=a,a=e._S(30,o),o=n,n=d}t[0]=t[0]+n|0,t[1]=t[1]+o|0,t[2]=t[2]+a|0,t[3]=t[3]+s|0,t[4]=t[4]+l|0}};var Lm={};Lm.aes=class{constructor(i){let e=this;e._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],e._tables[0][0][0]||e._precompute();let t=e._tables[0][4],r=e._tables[1],n=i.length,o,a,s,l=1;if(n!==4&&n!==6&&n!==8)throw new Error("invalid aes key size");for(e._key=[a=i.slice(0),s=[]],o=n;o<4*n+28;o++){let c=a[o-1];(o%n===0||n===8&&o%n===4)&&(c=t[c>>>24]<<24^t[c>>16&255]<<16^t[c>>8&255]<<8^t[c&255],o%n===0&&(c=c<<8^c>>>24^l<<24,l=l<<1^(l>>7)*283)),a[o]=a[o-n]^c}for(let c=0;o;c++,o--){let d=a[c&3?o:o-4];o<=4||c<4?s[c]=d:s[c]=r[0][t[d>>>24]]^r[1][t[d>>16&255]]^r[2][t[d>>8&255]]^r[3][t[d&255]]}}encrypt(i){return this._crypt(i,0)}decrypt(i){return this._crypt(i,1)}_precompute(){let i=this._tables[0],e=this._tables[1],t=i[4],r=e[4],n=[],o=[],a,s,l,c;for(let d=0;d<256;d++)o[(n[d]=d<<1^(d>>7)*283)^d]=d;for(let d=a=0;!t[d];d^=s||1,a=o[a]||1){let h=a^a<<1^a<<2^a<<3^a<<4;h=h>>8^h&255^99,t[d]=h,r[h]=d,c=n[l=n[s=n[d]]];let u=c*16843009^l*65537^s*257^d*16843008,m=n[h]*257^h*16843008;for(let g=0;g<4;g++)i[g][d]=m=m<<24^m>>>8,e[g][h]=u=u<<24^u>>>8}for(let d=0;d<5;d++)i[d]=i[d].slice(0),e[d]=e[d].slice(0)}_crypt(i,e){if(i.length!==4)throw new Error("invalid aes block size");let t=this._key[e],r=t.length/4-2,n=[0,0,0,0],o=this._tables[e],a=o[0],s=o[1],l=o[2],c=o[3],d=o[4],h=i[0]^t[0],u=i[e?3:1]^t[1],m=i[2]^t[2],g=i[e?1:3]^t[3],_=4,f,S,b;for(let T=0;T<r;T++)f=a[h>>>24]^s[u>>16&255]^l[m>>8&255]^c[g&255]^t[_],S=a[u>>>24]^s[m>>16&255]^l[g>>8&255]^c[h&255]^t[_+1],b=a[m>>>24]^s[g>>16&255]^l[h>>8&255]^c[u&255]^t[_+2],g=a[g>>>24]^s[h>>16&255]^l[u>>8&255]^c[m&255]^t[_+3],_+=4,h=f,u=S,m=b;for(let T=0;T<4;T++)n[e?3&-T:T]=d[h>>>24]<<24^d[u>>16&255]<<16^d[m>>8&255]<<8^d[g&255]^t[_++],f=h,h=u,u=m,m=g,g=f;return n}};var TS={getRandomValues(i){let e=new Uint32Array(i.buffer),t=r=>{let n=987654321,o=4294967295;return function(){return n=36969*(n&65535)+(n>>16)&o,r=18e3*(r&65535)+(r>>16)&o,(((n<<16)+r&o)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let r=0,n;r<i.length;r+=4){let o=t((n||Math.random())*4294967296);n=o()*987654071,e[r/4]=o()*4294967296|0}return i}},Mm={};Mm.ctrGladman=class{constructor(i,e){this._prf=i,this._initIv=e,this._iv=e}reset(){this._iv=this._initIv}update(i){return this.calculate(this._prf,i,this._iv)}incWord(i){if((i>>24&255)===255){let e=i>>16&255,t=i>>8&255,r=i&255;e===255?(e=0,t===255?(t=0,r===255?r=0:++r):++t):++e,i=0,i+=e<<16,i+=t<<8,i+=r}else i+=1<<24;return i}incCounter(i){(i[0]=this.incWord(i[0]))===0&&(i[1]=this.incWord(i[1]))}calculate(i,e,t){let r;if(!(r=e.length))return[];let n=Kn.bitLength(e);for(let o=0;o<r;o+=4){this.incCounter(t);let a=i.encrypt(t);e[o]^=a[0],e[o+1]^=a[1],e[o+2]^=a[2],e[o+3]^=a[3]}return Kn.clamp(e,n)}};var Qs={importKey(i){return new Qs.hmacSha1(bc.bytes.toBits(i))},pbkdf2(i,e,t,r){if(t=t||1e4,r<0||t<0)throw new Error("invalid params to pbkdf2");let n=(r>>5)+1<<2,o,a,s,l,c,d=new ArrayBuffer(n),h=new DataView(d),u=0,m=Kn;for(e=bc.bytes.toBits(e),c=1;u<(n||1);c++){for(o=a=i.encrypt(m.concat(e,[c])),s=1;s<t;s++)for(a=i.encrypt(a),l=0;l<a.length;l++)o[l]^=a[l];for(s=0;u<(n||1)&&s<o.length;s++)h.setInt32(u,o[s]),u+=4}return d.slice(0,r/8)}};Qs.hmacSha1=class{constructor(i){let e=this,t=e._hash=Dm.sha1,r=[[],[]],n=t.prototype.blockSize/32;e._baseHash=[new t,new t],i.length>n&&(i=t.hash(i));for(let o=0;o<n;o++)r[0][o]=i[o]^909522486,r[1][o]=i[o]^1549556828;e._baseHash[0].update(r[0]),e._baseHash[1].update(r[1]),e._resultHash=new t(e._baseHash[0])}reset(){let i=this;i._resultHash=new i._hash(i._baseHash[0]),i._updated=!1}update(i){let e=this;e._updated=!0,e._resultHash.update(i)}digest(){let i=this,e=i._resultHash.finalize(),t=new i._hash(i._baseHash[1]).update(e).finalize();return i.reset(),t}encrypt(i){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(i),this.digest(i)}};var rs="Invalid pasword",Ks=16,YE="raw",vS={name:"PBKDF2"},XE={name:"HMAC"},JE="SHA-1",ZE=Object.assign({hash:XE},vS),IS=Object.assign({iterations:1e3,hash:{name:JE}},vS),jE=["deriveBits"],Tc=[8,12,16],yc=[16,24,32],Aa=10,ES=[0,0,0,0],qu=typeof crypto<"u",CS=qu&&typeof crypto.subtle<"u",vi=bc.bytes,RS=Lm.aes,NS=Mm.ctrGladman,OS=Qs.hmacSha1,Qu=class{constructor(e,t,r){Object.assign(this,{password:e,signed:t,strength:r-1,pendingInput:new Uint8Array(0)})}async append(e){let t=this;if(t.password){let n=Co(e,0,Tc[t.strength]+2);await $E(t,n,t.password),t.password=null,t.aesCtrGladman=new NS(new RS(t.keys.key),Array.from(ES)),t.hmac=new OS(t.keys.authentication),e=Co(e,Tc[t.strength]+2)}let r=new Uint8Array(e.length-Aa-(e.length-Aa)%Ks);return wS(t,e,r,0,Aa,!0)}flush(){let e=this,t=e.pendingInput,r=Co(t,0,t.length-Aa),n=Co(t,t.length-Aa),o=new Uint8Array(0);if(r.length){let s=vi.toBits(r);e.hmac.update(s);let l=e.aesCtrGladman.update(s);o=vi.fromBits(l)}let a=!0;if(e.signed){let s=Co(vi.fromBits(e.hmac.digest()),0,Aa);for(let l=0;l<Aa;l++)s[l]!=n[l]&&(a=!1)}return{valid:a,data:o}}},Ku=class{constructor(e,t){Object.assign(this,{password:e,strength:t-1,pendingInput:new Uint8Array(0)})}async append(e){let t=this,r=new Uint8Array(0);t.password&&(r=await e0(t,t.password),t.password=null,t.aesCtrGladman=new NS(new RS(t.keys.key),Array.from(ES)),t.hmac=new OS(t.keys.authentication));let n=new Uint8Array(r.length+e.length-e.length%Ks);return n.set(r,0),wS(t,e,n,r.length,0)}flush(){let e=this,t=new Uint8Array(0);if(e.pendingInput.length){let n=e.aesCtrGladman.update(vi.toBits(e.pendingInput));e.hmac.update(n),t=vi.fromBits(n)}let r=Co(vi.fromBits(e.hmac.digest()),0,Aa);return{data:Bm(t,r),signature:r}}};function wS(i,e,t,r,n,o){let a=e.length-n;i.pendingInput.length&&(e=Bm(i.pendingInput,e),t=o0(t,a-a%Ks));let s;for(s=0;s<=a-Ks;s+=Ks){let l=vi.toBits(Co(e,s,s+Ks));o&&i.hmac.update(l);let c=i.aesCtrGladman.update(l);o||i.hmac.update(c),t.set(vi.fromBits(c),s+r)}return i.pendingInput=Co(e,s),t}async function $E(i,e,t){await xS(i,t,Co(e,0,Tc[i.strength]));let r=Co(e,Tc[i.strength]),n=i.keys.passwordVerification;if(n[0]!=r[0]||n[1]!=r[1])throw new Error(rs)}async function e0(i,e){let t=t0(new Uint8Array(Tc[i.strength]));return await xS(i,e,t),Bm(t,i.keys.passwordVerification)}async function xS(i,e,t){let r=Fm(e),n=await r0(YE,r,ZE,!1,jE),o=await n0(Object.assign({salt:t},IS),n,8*(yc[i.strength]*2+2)),a=new Uint8Array(o);i.keys={key:vi.toBits(Co(a,0,yc[i.strength])),authentication:vi.toBits(Co(a,yc[i.strength],yc[i.strength]*2)),passwordVerification:Co(a,yc[i.strength]*2)}}function t0(i){return qu&&typeof crypto.getRandomValues=="function"?crypto.getRandomValues(i):TS.getRandomValues(i)}function r0(i,e,t,r,n){return qu&&CS&&typeof crypto.subtle.importKey=="function"?crypto.subtle.importKey(i,e,t,r,n):Qs.importKey(e)}async function n0(i,e,t){return qu&&CS&&typeof crypto.subtle.deriveBits=="function"?await crypto.subtle.deriveBits(i,e,t):Qs.pbkdf2(e,i.salt,IS.iterations,t)}function Bm(i,e){let t=i;return i.length+e.length&&(t=new Uint8Array(i.length+e.length),t.set(i,0),t.set(e,i.length)),t}function o0(i,e){if(e&&e>i.length){let t=i;i=new Uint8Array(e),i.set(t,0)}return i}function Co(i,e,t){return i.subarray(e,t)}var qs=12,Yu=class{constructor(e,t){let r=this;Object.assign(r,{password:e,passwordVerification:t}),LS(r,e)}append(e){let t=this;if(t.password){let r=PS(t,e.subarray(0,qs));if(t.password=null,r[qs-1]!=t.passwordVerification)throw new Error(rs);e=e.subarray(qs)}return PS(t,e)}flush(){return{valid:!0,data:new Uint8Array(0)}}},Xu=class{constructor(e,t){let r=this;Object.assign(r,{password:e,passwordVerification:t}),LS(r,e)}append(e){let t=this,r,n;if(t.password){t.password=null;let o=crypto.getRandomValues(new Uint8Array(qs));o[qs-1]=t.passwordVerification,r=new Uint8Array(e.length+o.length),r.set(FS(t,o),0),n=qs}else r=new Uint8Array(e.length),n=0;return r.set(FS(t,e),n),r}flush(){return{data:new Uint8Array(0)}}};function PS(i,e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=MS(i)^e[r],Vm(i,t[r]);return t}function FS(i,e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=MS(i)^e[r],Vm(i,e[r]);return t}function LS(i,e){i.keys=[305419896,591751049,878082192],i.crcKey0=new _a(i.keys[0]),i.crcKey2=new _a(i.keys[2]);for(let t=0;t<e.length;t++)Vm(i,e.charCodeAt(t))}function Vm(i,e){i.crcKey0.append([e]),i.keys[0]=~i.crcKey0.get(),i.keys[1]=DS(i.keys[1]+BS(i.keys[0])),i.keys[1]=DS(Math.imul(i.keys[1],134775813)+1),i.crcKey2.append([i.keys[1]>>>24]),i.keys[2]=~i.crcKey2.get()}function MS(i){let e=i.keys[2]|2;return BS(Math.imul(e,e^1)>>>8)}function BS(i){return i&255}function DS(i){return i&4294967295}var Gm="deflate",Ju="inflate",vc="Invalid signature",km=class{constructor(e,{signature:t,password:r,signed:n,compressed:o,zipCrypto:a,passwordVerification:s,encryptionStrength:l},{chunkSize:c}){let d=!!r;Object.assign(this,{signature:t,encrypted:d,signed:n,compressed:o,inflate:o&&new e({chunkSize:c}),crc32:n&&new _a,zipCrypto:a,decrypt:d&&a?new Yu(r,s):new Qu(r,n,l)})}async append(e){let t=this;return t.encrypted&&e.length&&(e=await t.decrypt.append(e)),t.compressed&&e.length&&(e=await t.inflate.append(e)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),e}async flush(){let e=this,t,r=new Uint8Array(0);if(e.encrypted){let n=e.decrypt.flush();if(!n.valid)throw new Error(vc);r=n.data}if((!e.encrypted||e.zipCrypto)&&e.signed){let n=new DataView(new Uint8Array(4).buffer);if(t=e.crc32.get(),n.setUint32(0,t),e.signature!=n.getUint32(0,!1))throw new Error(vc)}return e.compressed&&(r=await e.inflate.append(r)||new Uint8Array(0),await e.inflate.flush()),{data:r,signature:t}}},Um=class{constructor(e,{encrypted:t,signed:r,compressed:n,level:o,zipCrypto:a,password:s,passwordVerification:l,encryptionStrength:c},{chunkSize:d}){Object.assign(this,{encrypted:t,signed:r,compressed:n,deflate:n&&new e({level:o||5,chunkSize:d}),crc32:r&&new _a,zipCrypto:a,encrypt:t&&a?new Xu(s,l):new Ku(s,c)})}async append(e){let t=this,r=e;return t.compressed&&e.length&&(r=await t.deflate.append(e)),t.encrypted&&r.length&&(r=await t.encrypt.append(r)),(!t.encrypted||t.zipCrypto)&&t.signed&&e.length&&t.crc32.append(e),r}async flush(){let e=this,t,r=new Uint8Array(0);if(e.compressed&&(r=await e.deflate.flush()||new Uint8Array(0)),e.encrypted){r=await e.encrypt.append(r);let n=e.encrypt.flush();t=n.signature;let o=new Uint8Array(r.length+n.data.length);o.set(r,0),o.set(n.data,r.length),r=o}return(!e.encrypted||e.zipCrypto)&&e.signed&&(t=e.crc32.get()),{data:r,signature:t}}};function VS(i,e,t){if(e.codecType.startsWith(Gm))return new Um(i,e,t);if(e.codecType.startsWith(Ju))return new km(i,e,t)}var kS="init",US="append",Hm="flush",i0="message",GS=!0,Zu=(i,e,t,r,n,o,a)=>(Object.assign(i,{busy:!0,codecConstructor:e,options:Object.assign({},t),scripts:a,terminate(){i.worker&&!i.busy&&(i.worker.terminate(),i.interface=null)},onTaskFinished(){i.busy=!1,n(i)}}),o?s0(i,r):a0(i,r));function a0(i,e){let t=VS(i.codecConstructor,i.options,e);return{async append(r){try{return await t.append(r)}catch(n){throw i.onTaskFinished(),n}},async flush(){try{return await t.flush()}finally{i.onTaskFinished()}},abort(){i.onTaskFinished()}}}function s0(i,e){let t,r={type:"module"};if(!i.interface){if(!GS)i.worker=n(r,e.baseURL);else try{i.worker=n({},e.baseURL)}catch{GS=!1,i.worker=n(r,e.baseURL)}i.worker.addEventListener(i0,s,!1),i.interface={append(l){return o({type:US,data:l})},flush(){return o({type:Hm})},abort(){i.onTaskFinished()}}}return i.interface;function n(l,c){let d,h;d=i.scripts[0],typeof d=="function"&&(d=d());try{h=new URL(d,c)}catch{h=d}return new Worker(h,l)}async function o(l){if(!t){let c=i.options,d=i.scripts.slice(1);await a({scripts:d,type:kS,options:c,config:{chunkSize:e.chunkSize}})}return a(l)}function a(l){let c=i.worker,d=new Promise((h,u)=>t={resolve:h,reject:u});try{if(l.data)try{l.data=l.data.buffer,c.postMessage(l,[l.data])}catch{c.postMessage(l)}else c.postMessage(l)}catch(h){t.reject(h),t=null,i.onTaskFinished()}return d}function s(l){let c=l.data;if(t){let d=c.error,h=c.type;if(d){let u=new Error(d.message);u.stack=d.stack,t.reject(u),t=null,i.onTaskFinished()}else if(h==kS||h==Hm||h==US){let u=c.data;h==Hm?(t.resolve({data:new Uint8Array(u),signature:c.signature}),t=null,i.onTaskFinished()):t.resolve(u&&new Uint8Array(u))}}}}var ns=[],zm=[];function Wm(i,e,t){let n=!(!e.compressed&&!e.signed&&!e.encrypted)&&(e.useWebWorkers||e.useWebWorkers===void 0&&t.useWebWorkers),o=n&&t.workerScripts?t.workerScripts[e.codecType]:[];if(ns.length<t.maxWorkers){let s={};return ns.push(s),Zu(s,i,e,t,a,n,o)}else{let s=ns.find(l=>!l.busy);return s?(HS(s),Zu(s,i,e,t,a,n,o)):new Promise(l=>zm.push({resolve:l,codecConstructor:i,options:e,webWorker:n,scripts:o}))}function a(s){if(zm.length){let[{resolve:l,codecConstructor:c,options:d,webWorker:h,scripts:u}]=zm.splice(0,1);l(Zu(s,c,d,t,a,h,u))}else s.worker?(HS(s),Number.isFinite(t.terminateWorkerTimeout)&&t.terminateWorkerTimeout>=0&&(s.terminateTimeout=setTimeout(()=>{ns=ns.filter(l=>l!=s),s.terminate()},t.terminateWorkerTimeout))):ns=ns.filter(l=>l!=s)}}function HS(i){i.terminateTimeout&&(clearTimeout(i.terminateTimeout),i.terminateTimeout=null)}var zS=i=>{if(typeof URL.createObjectURL=="function"){let e=()=>URL.createObjectURL(new Blob([`const{Array:t,Object:e,Math:n,Error:r,Uint8Array:i,Uint16Array:o,Uint32Array:s,Int32Array:f,DataView:c,TextEncoder:l,crypto:u,postMessage:a}=globalThis,w=[];for(let t=0;256>t;t++){let e=t;for(let t=0;8>t;t++)1&e?e=e>>>1^3988292384:e>>>=1;w[t]=e}class h{constructor(t){this.t=t||-1}append(t){let e=0|this.t;for(let n=0,r=0|t.length;r>n;n++)e=e>>>8^w[255&(e^t[n])];this.t=e}get(){return~this.t}}const d={concat(t,e){if(0===t.length||0===e.length)return t.concat(e);const n=t[t.length-1],r=d.i(n);return 32===r?t.concat(e):d.o(e,r,0|n,t.slice(0,t.length-1))},l(t){const e=t.length;if(0===e)return 0;const n=t[e-1];return 32*(e-1)+d.i(n)},u(t,e){if(32*t.length<e)return t;const r=(t=t.slice(0,n.ceil(e/32))).length;return e&=31,r>0&&e&&(t[r-1]=d.h(e,t[r-1]&2147483648>>e-1,1)),t},h:(t,e,n)=>32===t?e:(n?0|e:e<<32-t)+1099511627776*t,i:t=>n.round(t/1099511627776)||32,o(t,e,n,r){for(void 0===r&&(r=[]);e>=32;e-=32)r.push(n),n=0;if(0===e)return r.concat(t);for(let i=0;i<t.length;i++)r.push(n|t[i]>>>e),n=t[i]<<32-e;const i=t.length?t[t.length-1]:0,o=d.i(i);return r.push(d.h(e+o&31,e+o>32?n:r.pop(),1)),r}},p={p:{k(t){const e=d.l(t)/8,n=new i(e);let r;for(let i=0;e>i;i++)0==(3&i)&&(r=t[i/4]),n[i]=r>>>24,r<<=8;return n},g(t){const e=[];let n,r=0;for(n=0;n<t.length;n++)r=r<<8|t[n],3==(3&n)&&(e.push(r),r=0);return 3&n&&e.push(d.h(8*(3&n),r)),e}}},y={v:function(t){t?(this.m=t.m.slice(0),this.S=t.S.slice(0),this._=t._):this.reset()}};y.v.prototype={blockSize:512,reset:function(){const t=this;return t.m=this.I.slice(0),t.S=[],t._=0,t},update:function(t){const e=this;"string"==typeof t&&(t=p.A.g(t));const n=e.S=d.concat(e.S,t),i=e._,o=e._=i+d.l(t);if(o>9007199254740991)throw new r("Cannot hash more than 2^53 - 1 bits");const f=new s(n);let c=0;for(let t=e.blockSize+i-(e.blockSize+i&e.blockSize-1);o>=t;t+=e.blockSize)e.C(f.subarray(16*c,16*(c+1))),c+=1;return n.splice(0,16*c),e},V:function(){const t=this;let e=t.S;const r=t.m;e=d.concat(e,[d.h(1,1)]);for(let t=e.length+2;15&t;t++)e.push(0);for(e.push(n.floor(t._/4294967296)),e.push(0|t._);e.length;)t.C(e.splice(0,16));return t.reset(),r},I:[1732584193,4023233417,2562383102,271733878,3285377520],B:[1518500249,1859775393,2400959708,3395469782],D:(t,e,n,r)=>t>19?t>39?t>59?t>79?void 0:e^n^r:e&n|e&r|n&r:e^n^r:e&n|~e&r,U:(t,e)=>e<<t|e>>>32-t,C:function(e){const r=this,i=r.m,o=t(80);for(let t=0;16>t;t++)o[t]=e[t];let s=i[0],f=i[1],c=i[2],l=i[3],u=i[4];for(let t=0;79>=t;t++){16>t||(o[t]=r.U(1,o[t-3]^o[t-8]^o[t-14]^o[t-16]));const e=r.U(5,s)+r.D(t,f,c,l)+u+o[t]+r.B[n.floor(t/20)]|0;u=l,l=c,c=r.U(30,f),f=s,s=e}i[0]=i[0]+s|0,i[1]=i[1]+f|0,i[2]=i[2]+c|0,i[3]=i[3]+l|0,i[4]=i[4]+u|0}};const b={getRandomValues(t){const e=new s(t.buffer),r=t=>{let e=987654321;const r=4294967295;return()=>(e=36969*(65535&e)+(e>>16)&r,(((e<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r)/4294967296+.5)*(n.random()>.5?1:-1))};for(let i,o=0;o<t.length;o+=4){const t=r(4294967296*(i||n.random()));i=987654071*t(),e[o/4]=4294967296*t()|0}return t}},k={importKey:t=>new k.M(p.p.g(t)),P(t,e,n,i){if(n=n||1e4,0>i||0>n)throw new r("invalid params to pbkdf2");const o=1+(i>>5)<<2;let s,f,l,u,a;const w=new ArrayBuffer(o),h=new c(w);let y=0;const b=d;for(e=p.p.g(e),a=1;(o||1)>y;a++){for(s=f=t.encrypt(b.concat(e,[a])),l=1;n>l;l++)for(f=t.encrypt(f),u=0;u<f.length;u++)s[u]^=f[u];for(l=0;(o||1)>y&&l<s.length;l++)h.setInt32(y,s[l]),y+=4}return w.slice(0,i/8)},M:class{constructor(t){const e=this,n=e.R=y.v,r=[[],[]],i=n.prototype.blockSize/32;e.H=[new n,new n],t.length>i&&(t=n.hash(t));for(let e=0;i>e;e++)r[0][e]=909522486^t[e],r[1][e]=1549556828^t[e];e.H[0].update(r[0]),e.H[1].update(r[1]),e.K=new n(e.H[0])}reset(){const t=this;t.K=new t.R(t.H[0]),t.L=!1}update(t){this.L=!0,this.K.update(t)}digest(){const t=this,e=t.K.V(),n=new t.R(t.H[1]).update(e).V();return t.reset(),n}encrypt(t){if(this.L)throw new r("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}}},g={name:"PBKDF2"},v=e.assign({hash:{name:"HMAC"}},g),m=e.assign({iterations:1e3,hash:{name:"SHA-1"}},g),S=["deriveBits"],z=[8,12,16],_=[16,24,32],I=[0,0,0,0],A=void 0!==u,C=A&&void 0!==u.subtle,V=p.p,B=class{constructor(t){const e=this;e.T=[[[],[],[],[],[]],[[],[],[],[],[]]],e.T[0][0][0]||e.j();const n=e.T[0][4],i=e.T[1],o=t.length;let s,f,c,l=1;if(4!==o&&6!==o&&8!==o)throw new r("invalid aes key size");for(e.B=[f=t.slice(0),c=[]],s=o;4*o+28>s;s++){let t=f[s-1];(s%o==0||8===o&&s%o==4)&&(t=n[t>>>24]<<24^n[t>>16&255]<<16^n[t>>8&255]<<8^n[255&t],s%o==0&&(t=t<<8^t>>>24^l<<24,l=l<<1^283*(l>>7))),f[s]=f[s-o]^t}for(let t=0;s;t++,s--){const e=f[3&t?s:s-4];c[t]=4>=s||4>t?e:i[0][n[e>>>24]]^i[1][n[e>>16&255]]^i[2][n[e>>8&255]]^i[3][n[255&e]]}}encrypt(t){return this.F(t,0)}decrypt(t){return this.F(t,1)}j(){const t=this.T[0],e=this.T[1],n=t[4],r=e[4],i=[],o=[];let s,f,c,l;for(let t=0;256>t;t++)o[(i[t]=t<<1^283*(t>>7))^t]=t;for(let u=s=0;!n[u];u^=f||1,s=o[s]||1){let o=s^s<<1^s<<2^s<<3^s<<4;o=o>>8^255&o^99,n[u]=o,r[o]=u,l=i[c=i[f=i[u]]];let a=16843009*l^65537*c^257*f^16843008*u,w=257*i[o]^16843008*o;for(let n=0;4>n;n++)t[n][u]=w=w<<24^w>>>8,e[n][o]=a=a<<24^a>>>8}for(let n=0;5>n;n++)t[n]=t[n].slice(0),e[n]=e[n].slice(0)}F(t,e){if(4!==t.length)throw new r("invalid aes block size");const n=this.B[e],i=n.length/4-2,o=[0,0,0,0],s=this.T[e],f=s[0],c=s[1],l=s[2],u=s[3],a=s[4];let w,h,d,p=t[0]^n[0],y=t[e?3:1]^n[1],b=t[2]^n[2],k=t[e?1:3]^n[3],g=4;for(let t=0;i>t;t++)w=f[p>>>24]^c[y>>16&255]^l[b>>8&255]^u[255&k]^n[g],h=f[y>>>24]^c[b>>16&255]^l[k>>8&255]^u[255&p]^n[g+1],d=f[b>>>24]^c[k>>16&255]^l[p>>8&255]^u[255&y]^n[g+2],k=f[k>>>24]^c[p>>16&255]^l[y>>8&255]^u[255&b]^n[g+3],g+=4,p=w,y=h,b=d;for(let t=0;4>t;t++)o[e?3&-t:t]=a[p>>>24]<<24^a[y>>16&255]<<16^a[b>>8&255]<<8^a[255&k]^n[g++],w=p,p=y,y=b,b=k,k=w;return o}},E=class{constructor(t,e){this.O=t,this.W=e,this.q=e}reset(){this.q=this.W}update(t){return this.G(this.O,t,this.q)}J(t){if(255==(t>>24&255)){let e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}else t+=1<<24;return t}N(t){0===(t[0]=this.J(t[0]))&&(t[1]=this.J(t[1]))}G(t,e,n){let r;if(!(r=e.length))return[];const i=d.l(e);for(let i=0;r>i;i+=4){this.N(n);const r=t.encrypt(n);e[i]^=r[0],e[i+1]^=r[1],e[i+2]^=r[2],e[i+3]^=r[3]}return d.u(e,i)}},D=k.M;class U{constructor(t,n,r){e.assign(this,{password:t,signed:n,X:r-1,Y:new i(0)})}async append(e){const n=this;if(n.password){const i=K(e,0,z[n.X]+2);await(async(t,e,n)=>{await R(t,n,K(e,0,z[t.X]));const i=K(e,z[t.X]),o=t.keys.passwordVerification;if(o[0]!=i[0]||o[1]!=i[1])throw new r("Invalid pasword")})(n,i,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt),e=K(e,z[n.X]+2)}return P(n,e,new i(e.length-10-(e.length-10)%16),0,10,!0)}flush(){const t=this,e=t.Y,n=K(e,0,e.length-10),r=K(e,e.length-10);let o=new i(0);if(n.length){const e=V.g(n);t.$.update(e);const r=t.Z.update(e);o=V.k(r)}let s=!0;if(t.signed){const e=K(V.k(t.$.digest()),0,10);for(let t=0;10>t;t++)e[t]!=r[t]&&(s=!1)}return{valid:s,data:o}}}class M{constructor(t,n){e.assign(this,{password:t,X:n-1,Y:new i(0)})}async append(e){const n=this;let r=new i(0);n.password&&(r=await(async(t,e)=>{const n=(r=new i(z[t.X]),A&&"function"==typeof u.getRandomValues?u.getRandomValues(r):b.getRandomValues(r));var r;return await R(t,e,n),H(n,t.keys.passwordVerification)})(n,n.password),n.password=null,n.Z=new E(new B(n.keys.key),t.from(I)),n.$=new D(n.keys.tt));const o=new i(r.length+e.length-e.length%16);return o.set(r,0),P(n,e,o,r.length,0)}flush(){const t=this;let e=new i(0);if(t.Y.length){const n=t.Z.update(V.g(t.Y));t.$.update(n),e=V.k(n)}const n=K(V.k(t.$.digest()),0,10);return{data:H(e,n),signature:n}}}function P(t,e,n,r,o,s){const f=e.length-o;let c;for(t.Y.length&&(e=H(t.Y,e),n=((t,e)=>{if(e&&e>t.length){const n=t;(t=new i(e)).set(n,0)}return t})(n,f-f%16)),c=0;f-16>=c;c+=16){const i=V.g(K(e,c,c+16));s&&t.$.update(i);const o=t.Z.update(i);s||t.$.update(o),n.set(V.k(o),c+r)}return t.Y=K(e,c),n}async function R(t,n,r){const o=(t=>{if(void 0===l){const e=new i((t=unescape(encodeURIComponent(t))).length);for(let n=0;n<e.length;n++)e[n]=t.charCodeAt(n);return e}return(new l).encode(t)})(n),s=await((t,e,n,r,i)=>A&&C&&"function"==typeof u.subtle.importKey?u.subtle.importKey("raw",e,n,!1,i):k.importKey(e))(0,o,v,0,S),f=await(async(t,e,n)=>A&&C&&"function"==typeof u.subtle.deriveBits?await u.subtle.deriveBits(t,e,n):k.P(e,t.salt,m.iterations,n))(e.assign({salt:r},m),s,8*(2*_[t.X]+2)),c=new i(f);t.keys={key:V.g(K(c,0,_[t.X])),tt:V.g(K(c,_[t.X],2*_[t.X])),passwordVerification:K(c,2*_[t.X])}}function H(t,e){let n=t;return t.length+e.length&&(n=new i(t.length+e.length),n.set(t,0),n.set(e,t.length)),n}function K(t,e,n){return t.subarray(e,n)}class L{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;if(e.password){const n=j(e,t.subarray(0,12));if(e.password=null,n[11]!=e.passwordVerification)throw new r("Invalid pasword");t=t.subarray(12)}return j(e,t)}flush(){return{valid:!0,data:new i(0)}}}class T{constructor(t,n){e.assign(this,{password:t,passwordVerification:n}),F(this,t)}append(t){const e=this;let n,r;if(e.password){e.password=null;const o=u.getRandomValues(new i(12));o[11]=e.passwordVerification,n=new i(t.length+o.length),n.set(x(e,o),0),r=12}else n=new i(t.length),r=0;return n.set(x(e,t),r),n}flush(){return{data:new i(0)}}}function j(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,n[r]);return n}function x(t,e){const n=new i(e.length);for(let r=0;r<e.length;r++)n[r]=W(t)^e[r],O(t,e[r]);return n}function F(t,e){t.keys=[305419896,591751049,878082192],t.et=new h(t.keys[0]),t.nt=new h(t.keys[2]);for(let n=0;n<e.length;n++)O(t,e.charCodeAt(n))}function O(t,e){t.et.append([e]),t.keys[0]=~t.et.get(),t.keys[1]=G(t.keys[1]+q(t.keys[0])),t.keys[1]=G(n.imul(t.keys[1],134775813)+1),t.nt.append([t.keys[1]>>>24]),t.keys[2]=~t.nt.get()}function W(t){const e=2|t.keys[2];return q(n.imul(e,1^e)>>>8)}function q(t){return 255&t}function G(t){return 4294967295&t}class J{constructor(t,{signature:n,password:r,signed:i,compressed:o,zipCrypto:s,passwordVerification:f,encryptionStrength:c},{rt:l}){const u=!!r;e.assign(this,{signature:n,encrypted:u,signed:i,compressed:o,it:o&&new t({rt:l}),ot:i&&new h,zipCrypto:s,decrypt:u&&s?new L(r,f):new U(r,i,c)})}async append(t){const e=this;return e.encrypted&&t.length&&(t=await e.decrypt.append(t)),e.compressed&&t.length&&(t=await e.it.append(t)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),t}async flush(){const t=this;let e,n=new i(0);if(t.encrypted){const e=t.decrypt.flush();if(!e.valid)throw new r("Invalid signature");n=e.data}if((!t.encrypted||t.zipCrypto)&&t.signed){const n=new c(new i(4).buffer);if(e=t.ot.get(),n.setUint32(0,e),t.signature!=n.getUint32(0,!1))throw new r("Invalid signature")}return t.compressed&&(n=await t.it.append(n)||new i(0),await t.it.flush()),{data:n,signature:e}}}class N{constructor(t,{encrypted:n,signed:r,compressed:i,level:o,zipCrypto:s,password:f,passwordVerification:c,encryptionStrength:l},{rt:u}){e.assign(this,{encrypted:n,signed:r,compressed:i,st:i&&new t({level:o||5,rt:u}),ot:r&&new h,zipCrypto:s,encrypt:n&&s?new T(f,c):new M(f,l)})}async append(t){const e=this;let n=t;return e.compressed&&t.length&&(n=await e.st.append(t)),e.encrypted&&n.length&&(n=await e.encrypt.append(n)),(!e.encrypted||e.zipCrypto)&&e.signed&&t.length&&e.ot.append(t),n}async flush(){const t=this;let e,n=new i(0);if(t.compressed&&(n=await t.st.flush()||new i(0)),t.encrypted){n=await t.encrypt.append(n);const r=t.encrypt.flush();e=r.signature;const o=new i(n.length+r.data.length);o.set(n,0),o.set(r.data,n.length),n=o}return t.encrypted&&!t.zipCrypto||!t.signed||(e=t.ot.get()),{data:n,signature:e}}}const Q={init(t){t.scripts&&t.scripts.length&&importScripts.apply(void 0,t.scripts);const e=t.options;let n;self.initCodec&&self.initCodec(),e.codecType.startsWith("deflate")?n=self.Deflate:e.codecType.startsWith("inflate")&&(n=self.Inflate),X=((t,e,n)=>e.codecType.startsWith("deflate")?new N(t,e,n):e.codecType.startsWith("inflate")?new J(t,e,n):void 0)(n,e,t.config)},append:async t=>({data:await X.append(t.data)}),flush:()=>X.flush()};let X;function Y(e){return Z(e.map((([e,n])=>new t(e).fill(n,0,e))))}function Z(e){return e.reduce(((e,n)=>e.concat(t.isArray(n)?Z(n):n)),[])}addEventListener("message",(async t=>{const e=t.data,n=e.type,r=Q[n];if(r)try{e.data&&(e.data=new i(e.data));const t=await r(e)||{};if(t.type=n,t.data)try{t.data=t.data.buffer,a(t,[t.data])}catch(e){a(t)}else a(t)}catch(t){a({type:n,error:{message:t.message,stack:t.stack}})}}));const $=[0,1,2,3].concat(...Y([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function tt(){const t=this;function e(t,e){let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}t.ft=r=>{const i=t.ct,o=t.ut.lt,s=t.ut.wt;let f,c,l,u=-1;for(r.ht=0,r.dt=573,f=0;s>f;f++)0!==i[2*f]?(r.yt[++r.ht]=u=f,r.bt[f]=0):i[2*f+1]=0;for(;2>r.ht;)l=r.yt[++r.ht]=2>u?++u:0,i[2*l]=1,r.bt[l]=0,r.kt--,o&&(r.gt-=o[2*l+1]);for(t.vt=u,f=n.floor(r.ht/2);f>=1;f--)r.St(i,f);l=s;do{f=r.yt[1],r.yt[1]=r.yt[r.ht--],r.St(i,1),c=r.yt[1],r.yt[--r.dt]=f,r.yt[--r.dt]=c,i[2*l]=i[2*f]+i[2*c],r.bt[l]=n.max(r.bt[f],r.bt[c])+1,i[2*f+1]=i[2*c+1]=l,r.yt[1]=l++,r.St(i,1)}while(r.ht>=2);r.yt[--r.dt]=r.yt[1],(e=>{const n=t.ct,r=t.ut.lt,i=t.ut.zt,o=t.ut._t,s=t.ut.It;let f,c,l,u,a,w,h=0;for(u=0;15>=u;u++)e.At[u]=0;for(n[2*e.yt[e.dt]+1]=0,f=e.dt+1;573>f;f++)c=e.yt[f],u=n[2*n[2*c+1]+1]+1,u>s&&(u=s,h++),n[2*c+1]=u,c>t.vt||(e.At[u]++,a=0,o>c||(a=i[c-o]),w=n[2*c],e.kt+=w*(u+a),r&&(e.gt+=w*(r[2*c+1]+a)));if(0!==h){do{for(u=s-1;0===e.At[u];)u--;e.At[u]--,e.At[u+1]+=2,e.At[s]--,h-=2}while(h>0);for(u=s;0!==u;u--)for(c=e.At[u];0!==c;)l=e.yt[--f],l>t.vt||(n[2*l+1]!=u&&(e.kt+=(u-n[2*l+1])*n[2*l],n[2*l+1]=u),c--)}})(r),((t,n,r)=>{const i=[];let o,s,f,c=0;for(o=1;15>=o;o++)i[o]=c=c+r[o-1]<<1;for(s=0;n>=s;s++)f=t[2*s+1],0!==f&&(t[2*s]=e(i[f]++,f))})(i,t.vt,r.At)}}function et(t,e,n,r,i){const o=this;o.lt=t,o.zt=e,o._t=n,o.wt=r,o.It=i}tt.Ct=[0,1,2,3,4,5,6,7].concat(...Y([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),tt.Vt=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],tt.Bt=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],tt.Et=t=>256>t?$[t]:$[256+(t>>>7)],tt.Dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt.Ut=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tt.Mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],tt.Pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const nt=Y([[144,8],[112,9],[24,7],[8,8]]);et.Rt=Z([12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227].map(((t,e)=>[t,nt[e]])));const rt=Y([[30,5]]);function it(t,e,n,r,i){const o=this;o.Ht=t,o.Kt=e,o.Lt=n,o.Tt=r,o.jt=i}et.xt=Z([0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23].map(((t,e)=>[t,rt[e]]))),et.Ft=new et(et.Rt,tt.Dt,257,286,15),et.Ot=new et(et.xt,tt.Ut,0,30,15),et.Wt=new et(null,tt.Mt,0,19,7);const ot=[new it(0,0,0,0,0),new it(4,4,8,4,1),new it(4,5,16,8,1),new it(4,6,32,32,1),new it(4,4,16,16,2),new it(8,16,32,32,2),new it(8,16,128,128,2),new it(8,32,128,256,2),new it(32,128,258,1024,2),new it(32,258,258,4096,2)],st=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function ft(t,e,n,r){const i=t[2*e],o=t[2*n];return o>i||i==o&&r[e]<=r[n]}function ct(){const t=this;let e,r,s,f,c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z,_,I,A,C,V,B,E,D,U,M,P,R,H;const K=new tt,L=new tt,T=new tt;let j,x,F,O,W,q;function G(){let e;for(e=0;286>e;e++)P[2*e]=0;for(e=0;30>e;e++)R[2*e]=0;for(e=0;19>e;e++)H[2*e]=0;P[512]=1,t.kt=t.gt=0,x=F=0}function J(t,e){let n,r=-1,i=t[1],o=0,s=7,f=4;0===i&&(s=138,f=3),t[2*(e+1)+1]=65535;for(let c=0;e>=c;c++)n=i,i=t[2*(c+1)+1],++o<s&&n==i||(f>o?H[2*n]+=o:0!==n?(n!=r&&H[2*n]++,H[32]++):o>10?H[36]++:H[34]++,o=0,r=n,0===i?(s=138,f=3):n==i?(s=6,f=3):(s=7,f=4))}function N(e){t.qt[t.pending++]=e}function Q(t){N(255&t),N(t>>>8&255)}function X(t,e){let n;const r=e;q>16-r?(n=t,W|=n<<q&65535,Q(W),W=n>>>16-q,q+=r-16):(W|=t<<q&65535,q+=r)}function Y(t,e){const n=2*t;X(65535&e[n],65535&e[n+1])}function Z(t,e){let n,r,i=-1,o=t[1],s=0,f=7,c=4;for(0===o&&(f=138,c=3),n=0;e>=n;n++)if(r=o,o=t[2*(n+1)+1],++s>=f||r!=o){if(c>s)do{Y(r,H)}while(0!=--s);else 0!==r?(r!=i&&(Y(r,H),s--),Y(16,H),X(s-3,2)):s>10?(Y(18,H),X(s-11,7)):(Y(17,H),X(s-3,3));s=0,i=r,0===o?(f=138,c=3):r==o?(f=6,c=3):(f=7,c=4)}}function $(){16==q?(Q(W),W=0,q=0):8>q||(N(255&W),W>>>=8,q-=8)}function nt(e,r){let i,o,s;if(t.Gt[x]=e,t.Jt[x]=255&r,x++,0===e?P[2*r]++:(F++,e--,P[2*(tt.Ct[r]+256+1)]++,R[2*tt.Et(e)]++),0==(8191&x)&&E>2){for(i=8*x,o=_-v,s=0;30>s;s++)i+=R[2*s]*(5+tt.Ut[s]);if(i>>>=3,F<n.floor(x/2)&&i<n.floor(o/2))return!0}return x==j-1}function rt(e,n){let r,i,o,s,f=0;if(0!==x)do{r=t.Gt[f],i=t.Jt[f],f++,0===r?Y(i,e):(o=tt.Ct[i],Y(o+256+1,e),s=tt.Dt[o],0!==s&&(i-=tt.Vt[o],X(i,s)),r--,o=tt.Et(r),Y(o,n),s=tt.Ut[o],0!==s&&(r-=tt.Bt[o],X(r,s)))}while(x>f);Y(256,e),O=e[513]}function it(){q>8?Q(W):q>0&&N(255&W),W=0,q=0}function ct(e,n,r){X(0+(r?1:0),3),((e,n)=>{it(),O=8,Q(n),Q(~n),t.qt.set(a.subarray(e,e+n),t.pending),t.pending+=n})(e,n)}function lt(n){((e,n,r)=>{let i,o,s=0;E>0?(K.ft(t),L.ft(t),s=(()=>{let e;for(J(P,K.vt),J(R,L.vt),T.ft(t),e=18;e>=3&&0===H[2*tt.Pt[e]+1];e--);return t.kt+=14+3*(e+1),e})(),i=t.kt+3+7>>>3,o=t.gt+3+7>>>3,o>i||(i=o)):i=o=n+5,n+4>i||-1==e?o==i?(X(2+(r?1:0),3),rt(et.Rt,et.xt)):(X(4+(r?1:0),3),((t,e,n)=>{let r;for(X(t-257,5),X(e-1,5),X(n-4,4),r=0;n>r;r++)X(H[2*tt.Pt[r]+1],3);Z(P,t-1),Z(R,e-1)})(K.vt+1,L.vt+1,s+1),rt(P,R)):ct(e,n,r),G(),r&&it()})(0>v?-1:v,_-v,n),v=_,e.Nt()}function ut(){let t,n,r,i;do{if(i=w-A-_,0===i&&0===_&&0===A)i=c;else if(-1==i)i--;else if(_>=c+c-262){a.set(a.subarray(c,c+c),0),I-=c,_-=c,v-=c,t=y,r=t;do{n=65535&d[--r],d[r]=c>n?0:n-c}while(0!=--t);t=c,r=t;do{n=65535&h[--r],h[r]=c>n?0:n-c}while(0!=--t);i+=c}if(0===e.Qt)return;t=e.Xt(a,_+A,i),A+=t,3>A||(p=255&a[_],p=(p<<g^255&a[_+1])&k)}while(262>A&&0!==e.Qt)}function at(t){let e,n,r=V,i=_,o=C;const s=_>c-262?_-(c-262):0;let f=M;const l=u,w=_+258;let d=a[i+o-1],p=a[i+o];U>C||(r>>=2),f>A&&(f=A);do{if(e=t,a[e+o]==p&&a[e+o-1]==d&&a[e]==a[i]&&a[++e]==a[i+1]){i+=2,e++;do{}while(a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&a[++i]==a[++e]&&w>i);if(n=258-(w-i),i=w-258,n>o){if(I=t,o=n,n>=f)break;d=a[i+o-1],p=a[i+o]}}}while((t=65535&h[t&l])>s&&0!=--r);return o>A?A:o}t.bt=[],t.At=[],t.yt=[],P=[],R=[],H=[],t.St=(e,n)=>{const r=t.yt,i=r[n];let o=n<<1;for(;o<=t.ht&&(o<t.ht&&ft(e,r[o+1],r[o],t.bt)&&o++,!ft(e,i,r[o],t.bt));)r[n]=r[o],n=o,o<<=1;r[n]=i},t.Yt=(e,S,I,x,F,J)=>(x||(x=8),F||(F=8),J||(J=0),e.Zt=null,-1==S&&(S=6),1>F||F>9||8!=x||9>I||I>15||0>S||S>9||0>J||J>2?-2:(e.$t=t,l=I,c=1<<l,u=c-1,b=F+7,y=1<<b,k=y-1,g=n.floor((b+3-1)/3),a=new i(2*c),h=[],d=[],j=1<<F+6,t.qt=new i(4*j),s=4*j,t.Gt=new o(j),t.Jt=new i(j),E=S,D=J,(e=>(e.te=e.ee=0,e.Zt=null,t.pending=0,t.ne=0,r=113,f=0,K.ct=P,K.ut=et.Ft,L.ct=R,L.ut=et.Ot,T.ct=H,T.ut=et.Wt,W=0,q=0,O=8,G(),(()=>{w=2*c,d[y-1]=0;for(let t=0;y-1>t;t++)d[t]=0;B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt,_=0,v=0,A=0,m=C=2,z=0,p=0})(),0))(e))),t.re=()=>42!=r&&113!=r&&666!=r?-2:(t.Jt=null,t.Gt=null,t.qt=null,d=null,h=null,a=null,t.$t=null,113==r?-3:0),t.ie=(t,e,n)=>{let r=0;return-1==e&&(e=6),0>e||e>9||0>n||n>2?-2:(ot[E].jt!=ot[e].jt&&0!==t.te&&(r=t.st(1)),E!=e&&(E=e,B=ot[E].Kt,U=ot[E].Ht,M=ot[E].Lt,V=ot[E].Tt),D=n,r)},t.oe=(t,e,n)=>{let i,o=n,s=0;if(!e||42!=r)return-2;if(3>o)return 0;for(o>c-262&&(o=c-262,s=n-o),a.set(e.subarray(s,s+o),0),_=o,v=o,p=255&a[0],p=(p<<g^255&a[1])&k,i=0;o-3>=i;i++)p=(p<<g^255&a[i+2])&k,h[i&u]=d[p],d[p]=i;return 0},t.st=(n,i)=>{let o,w,b,V,U;if(i>4||0>i)return-2;if(!n.se||!n.fe&&0!==n.Qt||666==r&&4!=i)return n.Zt=st[4],-2;if(0===n.ce)return n.Zt=st[7],-5;var M;if(e=n,V=f,f=i,42==r&&(w=8+(l-8<<4)<<8,b=(E-1&255)>>1,b>3&&(b=3),w|=b<<6,0!==_&&(w|=32),w+=31-w%31,r=113,N((M=w)>>8&255),N(255&M)),0!==t.pending){if(e.Nt(),0===e.ce)return f=-1,0}else if(0===e.Qt&&V>=i&&4!=i)return e.Zt=st[7],-5;if(666==r&&0!==e.Qt)return n.Zt=st[7],-5;if(0!==e.Qt||0!==A||0!=i&&666!=r){switch(U=-1,ot[E].jt){case 0:U=(t=>{let n,r=65535;for(r>s-5&&(r=s-5);;){if(1>=A){if(ut(),0===A&&0==t)return 0;if(0===A)break}if(_+=A,A=0,n=v+r,(0===_||_>=n)&&(A=_-n,_=n,lt(!1),0===e.ce))return 0;if(_-v>=c-262&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 1:U=(t=>{let n,r=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_),0===r||(_-r&65535)>c-262||2!=D&&(m=at(r)),3>m)n=nt(0,255&a[_]),A--,_++;else if(n=nt(_-I,m-3),A-=m,m>B||3>A)_+=m,m=0,p=255&a[_],p=(p<<g^255&a[_+1])&k;else{m--;do{_++,p=(p<<g^255&a[_+2])&k,r=65535&d[p],h[_&u]=d[p],d[p]=_}while(0!=--m);_++}if(n&&(lt(!1),0===e.ce))return 0}return lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i);break;case 2:U=(t=>{let n,r,i=0;for(;;){if(262>A){if(ut(),262>A&&0==t)return 0;if(0===A)break}if(3>A||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_),C=m,S=I,m=2,0!==i&&B>C&&c-262>=(_-i&65535)&&(2!=D&&(m=at(i)),5>=m&&(1==D||3==m&&_-I>4096)&&(m=2)),3>C||m>C)if(0!==z){if(n=nt(0,255&a[_-1]),n&&lt(!1),_++,A--,0===e.ce)return 0}else z=1,_++,A--;else{r=_+A-3,n=nt(_-1-S,C-3),A-=C-1,C-=2;do{++_>r||(p=(p<<g^255&a[_+2])&k,i=65535&d[p],h[_&u]=d[p],d[p]=_)}while(0!=--C);if(z=0,m=2,_++,n&&(lt(!1),0===e.ce))return 0}}return 0!==z&&(n=nt(0,255&a[_-1]),z=0),lt(4==t),0===e.ce?4==t?2:0:4==t?3:1})(i)}if(2!=U&&3!=U||(r=666),0==U||2==U)return 0===e.ce&&(f=-1),0;if(1==U){if(1==i)X(2,3),Y(256,et.Rt),$(),9>1+O+10-q&&(X(2,3),Y(256,et.Rt),$()),O=7;else if(ct(0,0,!1),3==i)for(o=0;y>o;o++)d[o]=0;if(e.Nt(),0===e.ce)return f=-1,0}}return 4!=i?0:1}}function lt(){const t=this;t.le=0,t.ue=0,t.Qt=0,t.te=0,t.ce=0,t.ee=0}function ut(t){const e=new lt,o=(s=t&&t.rt?t.rt:65536)+5*(n.floor(s/16383)+1);var s;const f=new i(o);let c=t?t.level:-1;void 0===c&&(c=-1),e.Yt(c),e.se=f,this.append=(t,n)=>{let s,c,l=0,u=0,a=0;const w=[];if(t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,s=e.st(0),0!=s)throw new r("deflating: "+e.Zt);e.ue&&(e.ue==o?w.push(new i(f)):w.push(f.slice(0,e.ue))),a+=e.ue,n&&e.le>0&&e.le!=l&&(n(e.le),l=e.le)}while(e.Qt>0||0===e.ce);return w.length>1?(c=new i(a),w.forEach((t=>{c.set(t,u),u+=t.length}))):c=w[0]||new i(0),c}},this.flush=()=>{let t,n,s=0,c=0;const l=[];do{if(e.ue=0,e.ce=o,t=e.st(4),1!=t&&0!=t)throw new r("deflating: "+e.Zt);o-e.ce>0&&l.push(f.slice(0,e.ue)),c+=e.ue}while(e.Qt>0||0===e.ce);return e.re(),n=new i(c),l.forEach((t=>{n.set(t,s),s+=t.length})),n}}lt.prototype={Yt:function(t,e){const n=this;return n.$t=new ct,e||(e=15),n.$t.Yt(n,t,e)},st:function(t){const e=this;return e.$t?e.$t.st(e,t):-2},re:function(){const t=this;if(!t.$t)return-2;const e=t.$t.re();return t.$t=null,e},ie:function(t,e){const n=this;return n.$t?n.$t.ie(n,t,e):-2},oe:function(t,e){const n=this;return n.$t?n.$t.oe(n,t,e):-2},Xt:function(t,e,n){const r=this;let i=r.Qt;return i>n&&(i=n),0===i?0:(r.Qt-=i,t.set(r.fe.subarray(r.le,r.le+i),e),r.le+=i,r.te+=i,i)},Nt:function(){const t=this;let e=t.$t.pending;e>t.ce&&(e=t.ce),0!==e&&(t.se.set(t.$t.qt.subarray(t.$t.ne,t.$t.ne+e),t.ue),t.ue+=e,t.$t.ne+=e,t.ee+=e,t.ce-=e,t.$t.pending-=e,0===t.$t.pending&&(t.$t.ne=0))}};const at=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],wt=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],ht=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],dt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],pt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],yt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],bt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function kt(){let t,e,n,r,i,o;function s(t,e,s,f,c,l,u,a,w,h,d){let p,y,b,k,g,v,m,S,z,_,I,A,C,V,B;_=0,g=s;do{n[t[e+_]]++,_++,g--}while(0!==g);if(n[0]==s)return u[0]=-1,a[0]=0,0;for(S=a[0],v=1;15>=v&&0===n[v];v++);for(m=v,v>S&&(S=v),g=15;0!==g&&0===n[g];g--);for(b=g,S>g&&(S=g),a[0]=S,V=1<<v;g>v;v++,V<<=1)if(0>(V-=n[v]))return-3;if(0>(V-=n[g]))return-3;for(n[g]+=V,o[1]=v=0,_=1,C=2;0!=--g;)o[C]=v+=n[_],C++,_++;g=0,_=0;do{0!==(v=t[e+_])&&(d[o[v]++]=g),_++}while(++g<s);for(s=o[b],o[0]=g=0,_=0,k=-1,A=-S,i[0]=0,I=0,B=0;b>=m;m++)for(p=n[m];0!=p--;){for(;m>A+S;){if(k++,A+=S,B=b-A,B=B>S?S:B,(y=1<<(v=m-A))>p+1&&(y-=p+1,C=m,B>v))for(;++v<B&&(y<<=1)>n[++C];)y-=n[C];if(B=1<<v,h[0]+B>1440)return-3;i[k]=I=h[0],h[0]+=B,0!==k?(o[k]=g,r[0]=v,r[1]=S,v=g>>>A-S,r[2]=I-i[k-1]-v,w.set(r,3*(i[k-1]+v))):u[0]=I}for(r[1]=m-A,s>_?d[_]<f?(r[0]=256>d[_]?0:96,r[2]=d[_++]):(r[0]=l[d[_]-f]+16+64,r[2]=c[d[_++]-f]):r[0]=192,y=1<<m-A,v=g>>>A;B>v;v+=y)w.set(r,3*(I+v));for(v=1<<m-1;0!=(g&v);v>>>=1)g^=v;for(g^=v,z=(1<<A)-1;(g&z)!=o[k];)k--,A-=S,z=(1<<A)-1}return 0!==V&&1!=b?-5:0}function c(s){let c;for(t||(t=[],e=[],n=new f(16),r=[],i=new f(15),o=new f(16)),e.length<s&&(e=[]),c=0;s>c;c++)e[c]=0;for(c=0;16>c;c++)n[c]=0;for(c=0;3>c;c++)r[c]=0;i.set(n.subarray(0,15),0),o.set(n.subarray(0,16),0)}this.ae=(n,r,i,o,f)=>{let l;return c(19),t[0]=0,l=s(n,0,19,19,null,null,i,r,o,t,e),-3==l?f.Zt="oversubscribed dynamic bit lengths tree":-5!=l&&0!==r[0]||(f.Zt="incomplete dynamic bit lengths tree",l=-3),l},this.we=(n,r,i,o,f,l,u,a,w)=>{let h;return c(288),t[0]=0,h=s(i,0,n,257,dt,pt,l,o,a,t,e),0!=h||0===o[0]?(-3==h?w.Zt="oversubscribed literal/length tree":-4!=h&&(w.Zt="incomplete literal/length tree",h=-3),h):(c(288),h=s(i,n,r,0,yt,bt,u,f,a,t,e),0!=h||0===f[0]&&n>257?(-3==h?w.Zt="oversubscribed distance tree":-5==h?(w.Zt="incomplete distance tree",h=-3):-4!=h&&(w.Zt="empty distance tree with lengths",h=-3),h):0)}}function gt(){const t=this;let e,n,r,i,o=0,s=0,f=0,c=0,l=0,u=0,a=0,w=0,h=0,d=0;function p(t,e,n,r,i,o,s,f){let c,l,u,a,w,h,d,p,y,b,k,g,v,m,S,z;d=f.le,p=f.Qt,w=s.he,h=s.de,y=s.write,b=y<s.read?s.read-y-1:s.end-y,k=at[t],g=at[e];do{for(;20>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(c=w&k,l=n,u=r,z=3*(u+c),0!==(a=l[z]))for(;;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15,v=l[z+2]+(w&at[a]),w>>=a,h-=a;15>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;for(c=w&g,l=i,u=o,z=3*(u+c),a=l[z];;){if(w>>=l[z+1],h-=l[z+1],0!=(16&a)){for(a&=15;a>h;)p--,w|=(255&f.pe(d++))<<h,h+=8;if(m=l[z+2]+(w&at[a]),w>>=a,h-=a,b-=v,m>y){S=y-m;do{S+=s.end}while(0>S);if(a=s.end-S,v>a){if(v-=a,y-S>0&&a>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--a);else s.ye.set(s.ye.subarray(S,S+a),y),y+=a,S+=a,a=0;S=0}}else S=y-m,y-S>0&&2>y-S?(s.ye[y++]=s.ye[S++],s.ye[y++]=s.ye[S++],v-=2):(s.ye.set(s.ye.subarray(S,S+2),y),y+=2,S+=2,v-=2);if(y-S>0&&v>y-S)do{s.ye[y++]=s.ye[S++]}while(0!=--v);else s.ye.set(s.ye.subarray(S,S+v),y),y+=v,S+=v,v=0;break}if(0!=(64&a))return f.Zt="invalid distance code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3;c+=l[z+2],c+=w&at[a],z=3*(u+c),a=l[z]}break}if(0!=(64&a))return 0!=(32&a)?(v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,1):(f.Zt="invalid literal/length code",v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,-3);if(c+=l[z+2],c+=w&at[a],z=3*(u+c),0===(a=l[z])){w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--;break}}else w>>=l[z+1],h-=l[z+1],s.ye[y++]=l[z+2],b--}while(b>=258&&p>=10);return v=f.Qt-p,v=v>h>>3?h>>3:v,p+=v,d-=v,h-=v<<3,s.he=w,s.de=h,f.Qt=p,f.te+=d-f.le,f.le=d,s.write=y,0}t.init=(t,o,s,f,c,l)=>{e=0,a=t,w=o,r=s,h=f,i=c,d=l,n=null},t.be=(t,y,b)=>{let k,g,v,m,S,z,_,I=0,A=0,C=0;for(C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S;;)switch(e){case 0:if(z>=258&&m>=10&&(t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,b=p(a,w,r,h,i,d,t,y),C=y.le,m=y.Qt,I=t.he,A=t.de,S=t.write,z=S<t.read?t.read-S-1:t.end-S,0!=b)){e=1==b?7:9;break}f=a,n=r,s=h,e=1;case 1:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>>=n[g+1],A-=n[g+1],v=n[g],0===v){c=n[g+2],e=6;break}if(0!=(16&v)){l=15&v,o=n[g+2],e=2;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}if(0!=(32&v)){e=7;break}return e=9,y.Zt="invalid literal/length code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 2:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}o+=I&at[k],I>>=k,A-=k,f=w,n=i,s=d,e=3;case 3:for(k=f;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}if(g=3*(s+(I&at[k])),I>>=n[g+1],A-=n[g+1],v=n[g],0!=(16&v)){l=15&v,u=n[g+2],e=4;break}if(0==(64&v)){f=v,s=g/3+n[g+2];break}return e=9,y.Zt="invalid distance code",b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 4:for(k=l;k>A;){if(0===m)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,m--,I|=(255&y.pe(C++))<<A,A+=8}u+=I&at[k],I>>=k,A-=k,e=5;case 5:for(_=S-u;0>_;)_+=t.end;for(;0!==o;){if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);t.ye[S++]=t.ye[_++],z--,_==t.end&&(_=0),o--}e=0;break;case 6:if(0===z&&(S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z&&(t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,S==t.end&&0!==t.read&&(S=0,z=S<t.read?t.read-S-1:t.end-S),0===z)))return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);b=0,t.ye[S++]=c,z--,e=0;break;case 7:if(A>7&&(A-=8,m++,C--),t.write=S,b=t.ke(y,b),S=t.write,z=S<t.read?t.read-S-1:t.end-S,t.read!=t.write)return t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);e=8;case 8:return b=1,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);case 9:return b=-3,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b);default:return b=-2,t.he=I,t.de=A,y.Qt=m,y.te+=C-y.le,y.le=C,t.write=S,t.ke(y,b)}},t.ge=()=>{}}kt.ve=(t,e,n,r)=>(t[0]=9,e[0]=5,n[0]=wt,r[0]=ht,0);const vt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function mt(t,e){const n=this;let r,o=0,s=0,c=0,l=0;const u=[0],a=[0],w=new gt;let h=0,d=new f(4320);const p=new kt;n.de=0,n.he=0,n.ye=new i(e),n.end=e,n.read=0,n.write=0,n.reset=(t,e)=>{e&&(e[0]=0),6==o&&w.ge(t),o=0,n.de=0,n.he=0,n.read=n.write=0},n.reset(t,null),n.ke=(t,e)=>{let r,i,o;return i=t.ue,o=n.read,r=(o>n.write?n.end:n.write)-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r,o==n.end&&(o=0,n.write==n.end&&(n.write=0),r=n.write-o,r>t.ce&&(r=t.ce),0!==r&&-5==e&&(e=0),t.ce-=r,t.ee+=r,t.se.set(n.ye.subarray(o,o+r),i),i+=r,o+=r),t.ue=i,n.read=o,e},n.be=(t,e)=>{let i,f,y,b,k,g,v,m;for(b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g;;){let S,z,_,I,A,C,V,B;switch(o){case 0:for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}switch(i=7&f,h=1&i,i>>>1){case 0:f>>>=3,y-=3,i=7&y,f>>>=i,y-=i,o=1;break;case 1:S=[],z=[],_=[[]],I=[[]],kt.ve(S,z,_,I),w.init(S[0],z[0],_[0],0,I[0],0),f>>>=3,y-=3,o=6;break;case 2:f>>>=3,y-=3,o=3;break;case 3:return f>>>=3,y-=3,o=9,t.Zt="invalid block type",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}break;case 1:for(;32>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if((~f>>>16&65535)!=(65535&f))return o=9,t.Zt="invalid stored block lengths",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);s=65535&f,f=y=0,o=0!==s?2:0!==h?7:0;break;case 2:if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(0===v&&(g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v&&(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,g==n.end&&0!==n.read&&(g=0,v=g<n.read?n.read-g-1:n.end-g),0===v)))return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(e=0,i=s,i>k&&(i=k),i>v&&(i=v),n.ye.set(t.Xt(b,i),g),b+=i,k-=i,g+=i,v-=i,0!=(s-=i))break;o=0!==h?7:0;break;case 3:for(;14>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(c=i=16383&f,(31&i)>29||(i>>5&31)>29)return o=9,t.Zt="too many length or distance symbols",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);if(i=258+(31&i)+(i>>5&31),!r||r.length<i)r=[];else for(m=0;i>m;m++)r[m]=0;f>>>=14,y-=14,l=0,o=4;case 4:for(;4+(c>>>10)>l;){for(;3>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}r[vt[l++]]=7&f,f>>>=3,y-=3}for(;19>l;)r[vt[l++]]=0;if(u[0]=7,i=p.ae(r,u,a,d,t),0!=i)return-3==(e=i)&&(r=null,o=9),n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);l=0,o=5;case 5:for(;i=c,258+(31&i)+(i>>5&31)>l;){let s,w;for(i=u[0];i>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(i=d[3*(a[0]+(f&at[i]))+1],w=d[3*(a[0]+(f&at[i]))+2],16>w)f>>>=i,y-=i,r[l++]=w;else{for(m=18==w?7:w-14,s=18==w?11:3;i+m>y;){if(0===k)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);e=0,k--,f|=(255&t.pe(b++))<<y,y+=8}if(f>>>=i,y-=i,s+=f&at[m],f>>>=m,y-=m,m=l,i=c,m+s>258+(31&i)+(i>>5&31)||16==w&&1>m)return r=null,o=9,t.Zt="invalid bit length repeat",e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w=16==w?r[m-1]:0;do{r[m++]=w}while(0!=--s);l=m}}if(a[0]=-1,A=[],C=[],V=[],B=[],A[0]=9,C[0]=6,i=c,i=p.we(257+(31&i),1+(i>>5&31),r,A,C,V,B,d,t),0!=i)return-3==i&&(r=null,o=9),e=i,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);w.init(A[0],C[0],d,V[0],d,B[0]),o=6;case 6:if(n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,1!=(e=w.be(n,t,e)))return n.ke(t,e);if(e=0,w.ge(t),b=t.le,k=t.Qt,f=n.he,y=n.de,g=n.write,v=g<n.read?n.read-g-1:n.end-g,0===h){o=0;break}o=7;case 7:if(n.write=g,e=n.ke(t,e),g=n.write,v=g<n.read?n.read-g-1:n.end-g,n.read!=n.write)return n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);o=8;case 8:return e=1,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);case 9:return e=-3,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e);default:return e=-2,n.he=f,n.de=y,t.Qt=k,t.te+=b-t.le,t.le=b,n.write=g,n.ke(t,e)}}},n.ge=t=>{n.reset(t,null),n.ye=null,d=null},n.me=(t,e,r)=>{n.ye.set(t.subarray(e,e+r),0),n.read=n.write=r},n.Se=()=>1==o?1:0}const St=[0,0,255,255];function zt(){const t=this;function e(t){return t&&t.ze?(t.te=t.ee=0,t.Zt=null,t.ze.mode=7,t.ze._e.reset(t,null),0):-2}t.mode=0,t.method=0,t.Ie=[0],t.Ae=0,t.marker=0,t.Ce=0,t.Ve=e=>(t._e&&t._e.ge(e),t._e=null,0),t.Be=(n,r)=>(n.Zt=null,t._e=null,8>r||r>15?(t.Ve(n),-2):(t.Ce=r,n.ze._e=new mt(n,1<<r),e(n),0)),t.it=(t,e)=>{let n,r;if(!t||!t.ze||!t.fe)return-2;const i=t.ze;for(e=4==e?-5:0,n=-5;;)switch(i.mode){case 0:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,8!=(15&(i.method=t.pe(t.le++)))){i.mode=13,t.Zt="unknown compression method",i.marker=5;break}if(8+(i.method>>4)>i.Ce){i.mode=13,t.Zt="invalid win size",i.marker=5;break}i.mode=1;case 1:if(0===t.Qt)return n;if(n=e,t.Qt--,t.te++,r=255&t.pe(t.le++),((i.method<<8)+r)%31!=0){i.mode=13,t.Zt="incorrect header check",i.marker=5;break}if(0==(32&r)){i.mode=7;break}i.mode=2;case 2:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae=(255&t.pe(t.le++))<<24&4278190080,i.mode=3;case 3:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<16&16711680,i.mode=4;case 4:if(0===t.Qt)return n;n=e,t.Qt--,t.te++,i.Ae+=(255&t.pe(t.le++))<<8&65280,i.mode=5;case 5:return 0===t.Qt?n:(n=e,t.Qt--,t.te++,i.Ae+=255&t.pe(t.le++),i.mode=6,2);case 6:return i.mode=13,t.Zt="need dictionary",i.marker=0,-2;case 7:if(n=i._e.be(t,n),-3==n){i.mode=13,i.marker=0;break}if(0==n&&(n=e),1!=n)return n;n=e,i._e.reset(t,i.Ie),i.mode=12;case 12:return t.Qt=0,1;case 13:return-3;default:return-2}},t.Ee=(t,e,n)=>{let r=0,i=n;if(!t||!t.ze||6!=t.ze.mode)return-2;const o=t.ze;return i<1<<o.Ce||(i=(1<<o.Ce)-1,r=n-i),o._e.me(e,r,i),o.mode=7,0},t.De=t=>{let n,r,i,o,s;if(!t||!t.ze)return-2;const f=t.ze;if(13!=f.mode&&(f.mode=13,f.marker=0),0===(n=t.Qt))return-5;for(r=t.le,i=f.marker;0!==n&&4>i;)t.pe(r)==St[i]?i++:i=0!==t.pe(r)?0:4-i,r++,n--;return t.te+=r-t.le,t.le=r,t.Qt=n,f.marker=i,4!=i?-3:(o=t.te,s=t.ee,e(t),t.te=o,t.ee=s,f.mode=7,0)},t.Ue=t=>t&&t.ze&&t.ze._e?t.ze._e.Se():-2}function _t(){}function It(t){const e=new _t,o=t&&t.rt?n.floor(2*t.rt):131072,s=new i(o);let f=!1;e.Be(),e.se=s,this.append=(t,n)=>{const c=[];let l,u,a=0,w=0,h=0;if(0!==t.length){e.le=0,e.fe=t,e.Qt=t.length;do{if(e.ue=0,e.ce=o,0!==e.Qt||f||(e.le=0,f=!0),l=e.it(0),f&&-5===l){if(0!==e.Qt)throw new r("inflating: bad input")}else if(0!==l&&1!==l)throw new r("inflating: "+e.Zt);if((f||1===l)&&e.Qt===t.length)throw new r("inflating: bad input");e.ue&&(e.ue===o?c.push(new i(s)):c.push(s.slice(0,e.ue))),h+=e.ue,n&&e.le>0&&e.le!=a&&(n(e.le),a=e.le)}while(e.Qt>0||0===e.ce);return c.length>1?(u=new i(h),c.forEach((t=>{u.set(t,w),w+=t.length}))):u=c[0]||new i(0),u}},this.flush=()=>{e.Ve()}}_t.prototype={Be:function(t){const e=this;return e.ze=new zt,t||(t=15),e.ze.Be(e,t)},it:function(t){const e=this;return e.ze?e.ze.it(e,t):-2},Ve:function(){const t=this;if(!t.ze)return-2;const e=t.ze.Ve(t);return t.ze=null,e},De:function(){const t=this;return t.ze?t.ze.De(t):-2},Ee:function(t,e){const n=this;return n.ze?n.ze.Ee(n,t,e):-2},pe:function(t){return this.fe[t]},Xt:function(t,e){return this.fe.subarray(t,t+e)}},self.initCodec=()=>{self.Deflate=ut,self.Inflate=It};
`],{type:"text/javascript"}));i({workerScripts:{inflate:[e],deflate:[e]}})}};var ju=class{constructor(){this.size=0}init(){this.initialized=!0}},Ic=class extends ju{},$u=class extends ju{writeUint8Array(e){this.size+=e.length}};var Ys=class extends Ic{constructor(e){super(),this.array=e,this.size=e.length}readUint8Array(e,t){return this.array.slice(e,e+t)}},Xs=class extends $u{constructor(){super(),this.array=new Uint8Array(0)}writeUint8Array(e){super.writeUint8Array(e);let t=this.array;this.array=new Uint8Array(t.length+e.length),this.array.set(t),this.array.set(e,t.length)}getData(){return this.array}};var Qm="/",l0=new Date(2107,11,31),c0=new Date(1980,0,1);var d0="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),WS=i=>{let e="";for(let t=0;t<i.length;t++)e+=d0[i[t]];return e};var ep=u0;function u0(i,e){if(e&&e.trim().toLowerCase()=="cp437")return WS(i);if(typeof TextDecoder>"u"){let t=new FileReader;return new Promise((r,n)=>{t.onload=o=>r(o.target.result),t.onerror=()=>n(t.error),t.readAsText(new Blob([i]))})}else return new TextDecoder(e).decode(i)}var qm="Abort error";async function Ym(i,e,t,r,n,o,a){let s=Math.max(o.chunkSize,64);return l();async function l(c=0,d=0){let h=a.signal,u=n();if(c<u){Km(h,i);let m=await e.readUint8Array(c+r,Math.min(s,u-c)),g=m.length;Km(h,i);let _=await i.append(m);if(Km(h,i),d+=await QS(t,_),a.onprogress)try{a.onprogress(c+g,u)}catch{}return l(c+s,d)}else{let m=await i.flush();return d+=await QS(t,m.data),{signature:m.signature,length:d}}}}function Km(i,e){if(i&&i.aborted)throw e.abort(),new Error(qm)}async function QS(i,e){return e.length&&await i.writeUint8Array(e),e.length}var p0=["filename","rawFilename","directory","encrypted","compressedSize","uncompressedSize","lastModDate","rawLastModDate","comment","rawComment","signature","extraField","rawExtraField","bitFlag","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","filenameUTF8","commentUTF8","offset","zip64","compressionMethod","extraFieldNTFS","lastAccessDate","creationDate","extraFieldExtendedTimestamp","version","versionMadeBy","msDosCompatible","internalFileAttribute","externalFileAttribute"],os=class{constructor(e){p0.forEach(t=>this[t]=e[t])}};var tp="File format is not recognized",sb="End of central directory not found",lb="End of Zip64 central directory not found",cb="End of Zip64 central directory locator not found",db="Central directory header not found",ub="Local file header not found",pb="Zip64 extra field not found",hb="File contains encrypted entry",mb="Encryption method not supported",ag="Compression method not supported",KS="utf-8",qS="cp437",YS=["uncompressedSize","compressedSize","offset"],js=class{constructor(e,t={}){Object.assign(this,{reader:e,options:t,config:xm()})}async*getEntriesGenerator(e={}){let t=this,r=t.reader;if(r.initialized||await r.init(),r.size<22)throw new Error(tp);let n=await b0(r,101010256,r.size,22,65535*16);if(!n)throw new Error(sb);let o=xn(n),a=fn(o,12),s=fn(o,16),l=Ro(o,8),c=0;if(s==4294967295||a==4294967295||l==65535){let m=await Sa(r,n.offset-20,20),g=xn(m);if(fn(g,0)!=117853008)throw new Error(lb);s=rp(g,8);let _=await Sa(r,s,56),f=xn(_),S=n.offset-20-56;if(fn(f,0)!=101075792&&s!=S){let b=s;s=S,c=s-b,_=await Sa(r,s,56),f=xn(_)}if(fn(f,0)!=101075792)throw new Error(cb);l=rp(f,32),a=rp(f,40),s-=a}if(s<0||s>=r.size)throw new Error(tp);let d=0,h=await Sa(r,s,a),u=xn(h);if(a){let m=n.offset-a;if(fn(u,d)!=33639248&&s!=m){let g=s;s=m,c=s-g,h=await Sa(r,s,a),u=xn(h)}}if(s<0||s>=r.size)throw new Error(tp);for(let m=0;m<l;m++){let g=new sg(r,t.config,t.options);if(fn(u,d)!=33639248)throw new Error(db);gb(g,u,d+6);let _=!!g.bitFlag.languageEncodingFlag,f=d+46,S=f+g.filenameLength,b=S+g.extraFieldLength,T=Ro(u,d+4),y=(T&0)==0;Object.assign(g,{versionMadeBy:T,msDosCompatible:y,compressedSize:0,uncompressedSize:0,commentLength:Ro(u,d+32),directory:y&&(Zs(u,d+38)&16)==16,offset:fn(u,d+42)+c,internalFileAttribute:fn(u,d+34),externalFileAttribute:fn(u,d+38),rawFilename:h.subarray(f,S),filenameUTF8:_,commentUTF8:_,rawExtraField:h.subarray(S,b)});let I=b+g.commentLength;g.rawComment=h.subarray(b,I);let p=Js(t,e,"filenameEncoding"),A=Js(t,e,"commentEncoding"),[v,E]=await Promise.all([ep(g.rawFilename,g.filenameUTF8?KS:p||qS),ep(g.rawComment,g.commentUTF8?KS:A||qS)]);g.filename=v,g.comment=E,!g.directory&&g.filename.endsWith(Qm)&&(g.directory=!0),await fb(g,g,u,d+6);let D=new os(g);if(D.getData=(G,U)=>g.getData(G,D,U),d=I,e.onprogress)try{e.onprogress(m+1,l,new os(g))}catch{}yield D}return!0}async getEntries(e={}){let t=[],r=this.getEntriesGenerator(e),n=r.next();for(;!(await n).done;)t.push((await n).value),n=r.next();return t}async close(){}};var sg=class{constructor(e,t,r){Object.assign(this,{reader:e,config:t,options:r})}async getData(e,t,r={}){let n=this,{reader:o,offset:a,extraFieldAES:s,compressionMethod:l,config:c,bitFlag:d,signature:h,rawLastModDate:u,compressedSize:m}=n,g=n.localDirectory={};o.initialized||await o.init();let _=await Sa(o,a,30),f=xn(_),S=Js(n,r,"password");if(S=S&&S.length&&S,s&&s.originalCompressionMethod!=99)throw new Error(ag);if(l!=0&&l!=8)throw new Error(ag);if(fn(f,0)!=67324752)throw new Error(ub);gb(g,f,4),_=await Sa(o,a,30+g.filenameLength+g.extraFieldLength),g.rawExtraField=_.subarray(30+g.filenameLength),await fb(n,g,f,4),t.lastAccessDate=g.lastAccessDate,t.creationDate=g.creationDate;let b=n.encrypted&&g.encrypted,T=b&&!s;if(b){if(!T&&s.strength===void 0)throw new Error(mb);if(!S)throw new Error(hb)}let y=await Wm(c.Inflate,{codecType:Ju,password:S,zipCrypto:T,encryptionStrength:s&&s.strength,signed:Js(n,r,"checkSignature"),passwordVerification:T&&(d.dataDescriptor?u>>>8&255:h>>>24&255),signature:h,compressed:l!=0,encrypted:b,useWebWorkers:Js(n,r,"useWebWorkers")},c);e.initialized||await e.init();let I=Js(n,r,"signal"),p=a+30+g.filenameLength+g.extraFieldLength;return await Ym(y,o,e,p,()=>m,c,{onprogress:r.onprogress,signal:I}),e.getData()}};function gb(i,e,t){let r=i.rawBitFlag=Ro(e,t+2),n=(r&1)==1,o=fn(e,t+6);Object.assign(i,{encrypted:n,version:Ro(e,t),bitFlag:{level:(r&6)>>1,dataDescriptor:(r&8)==8,languageEncodingFlag:(r&2048)==2048},rawLastModDate:o,lastModDate:y0(o),filenameLength:Ro(e,t+22),extraFieldLength:Ro(e,t+24)})}async function fb(i,e,t,r){let n=e.rawExtraField,o=e.extraField=new Map,a=xn(new Uint8Array(n)),s=0;try{for(;s<n.length;){let _=Ro(a,s),f=Ro(a,s+2);o.set(_,{type:_,data:n.slice(s+4,s+4+f)}),s+=4+f}}catch{}let l=Ro(t,r+4);e.signature=fn(t,r+10),e.uncompressedSize=fn(t,r+18),e.compressedSize=fn(t,r+14);let c=o.get(1);c&&(f0(c,e),e.extraFieldZip64=c);let d=o.get(28789);d&&(await XS(d,"filename","rawFilename",e,i),e.extraFieldUnicodePath=d);let h=o.get(25461);h&&(await XS(h,"comment","rawComment",e,i),e.extraFieldUnicodeComment=h);let u=o.get(39169);u?(_0(u,e,l),e.extraFieldAES=u):e.compressionMethod=l;let m=o.get(10);m&&(A0(m,e),e.extraFieldNTFS=m);let g=o.get(21589);g&&(S0(g,e),e.extraFieldExtendedTimestamp=g)}function f0(i,e){e.zip64=!0;let t=xn(i.data);i.values=[];for(let n=0;n<Math.floor(i.data.length/8);n++)i.values.push(rp(t,0+n*8));let r=YS.filter(n=>e[n]==4294967295);for(let n=0;n<r.length;n++)i[r[n]]=i.values[n];YS.forEach(n=>{if(e[n]==4294967295)if(i[n]!==void 0)e[n]=i[n];else throw new Error(pb)})}async function XS(i,e,t,r,n){let o=xn(i.data);i.version=Zs(o,0),i.signature=fn(o,1);let a=new _a;a.append(n[t]);let s=xn(new Uint8Array(4));s.setUint32(0,a.get(),!0),i[e]=await ep(i.data.subarray(5)),i.valid=!n.bitFlag.languageEncodingFlag&&i.signature==fn(s,0),i.valid&&(r[e]=i[e],r[e+"UTF8"]=!0)}function _0(i,e,t){let r=xn(i.data);i.vendorVersion=Zs(r,0),i.vendorId=Zs(r,2);let n=Zs(r,4);i.strength=n,i.originalCompressionMethod=t,e.compressionMethod=i.compressionMethod=Ro(r,5)}function A0(i,e){let t=xn(i.data),r=4,n;try{for(;r<i.data.length&&!n;){let o=Ro(t,r),a=Ro(t,r+2);o==1&&(n=i.data.slice(r+4,r+4+a)),r+=4+a}}catch{}try{if(n&&n.length==24){let o=xn(n),a=o.getBigUint64(0,!0),s=o.getBigUint64(8,!0),l=o.getBigUint64(16,!0);Object.assign(i,{rawLastModDate:a,rawLastAccessDate:s,rawCreationDate:l});let c=Zm(a),d=Zm(s),h=Zm(l),u={lastModDate:c,lastAccessDate:d,creationDate:h};Object.assign(i,u),Object.assign(e,u)}}catch{}}function S0(i,e){let t=xn(i.data),r=Zs(t,0),n=[],o=[];(r&1)==1&&(n.push("lastModDate"),o.push("rawLastModDate")),(r&2)==2&&(n.push("lastAccessDate"),o.push("rawLastAccessDate")),(r&4)==4&&(n.push("creationDate"),o.push("rawCreationDate"));let a=1;n.forEach((s,l)=>{if(i.data.length>=a+4){let c=fn(t,a);e[s]=i[s]=new Date(c*1e3);let d=o[l];i[d]=c}a+=4})}async function b0(i,e,t,r,n){let o=new Uint8Array(4),a=xn(o);T0(a,0,e);let s=r+n;return await l(r)||await l(Math.min(s,t));async function l(c){let d=t-c,h=await Sa(i,d,c);for(let u=h.length-r;u>=0;u--)if(h[u]==o[0]&&h[u+1]==o[1]&&h[u+2]==o[2]&&h[u+3]==o[3])return{offset:d+u,buffer:h.slice(u,u+r).buffer}}}function Js(i,e,t){return e[t]===void 0?i.options[t]:e[t]}function y0(i){let e=(i&4294901760)>>16,t=i&65535;try{return new Date(1980+((e&65024)>>9),((e&480)>>5)-1,e&31,(t&63488)>>11,(t&2016)>>5,(t&31)*2,0)}catch{}}function Zm(i){return new Date(Number(i/BigInt(1e4)-BigInt(116444736e5)))}function Zs(i,e){return i.getUint8(e)}function Ro(i,e){return i.getUint16(e,!0)}function fn(i,e){return i.getUint32(e,!0)}function rp(i,e){return Number(i.getBigUint64(e,!0))}function T0(i,e,t){i.setUint32(e,t,!0)}function xn(i){return new DataView(i.buffer)}function Sa(i,e,t){return i.readUint8Array(e,t)}var _M=new Uint8Array([7,0,2,0,65,69,3,0,0]);var TM=512*1024;var P0={},Ab;try{Ab=P0.url}catch{}Ws({baseURL:Ab});zS(Ws);Ws({Deflate:jA,Inflate:bS});var lp=fs(Rl());var Cc,Gi,cg,lg={env:{emscripten_notify_memory_growth:function(i){cg=new Uint8Array(Gi.exports.memory.buffer)}}},np=class{init(){return Cc||(typeof fetch<"u"?Cc=fetch("data:application/wasm;base64,"+Sb).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,lg)).then(this._init):Cc=WebAssembly.instantiate(Buffer.from(Sb,"base64"),lg).then(this._init),Cc)}_init(e){Gi=e.instance,lg.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Gi)throw new Error("ZSTDDecoder: Await .init() before decoding.");let r=e.byteLength,n=Gi.exports.malloc(r);cg.set(e,n),t=t||Number(Gi.exports.ZSTD_findDecompressedSize(n,r));let o=Gi.exports.malloc(t),a=Gi.exports.ZSTD_decompress(o,t,n,r),s=cg.slice(o,o+a);return Gi.exports.free(n),Gi.exports.free(o),s}},Sb="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";function op(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(op||(op={}));function dg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(dg||(dg={}));function ug(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(ug||(ug={}));function pg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(pg||(pg={}));function $s(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})($s||($s={}));function hg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(hg||(hg={}));function mg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(mg||(mg={}));function gg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(gg||(gg={}));function fg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(fg||(fg={}));function ip(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(ip||(ip={}));function _g(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(_g||(_g={}));function Ag(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(Ag||(Ag={}));function Sg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(Sg||(Sg={}));function el(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(el||(el={}));function bg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(bg||(bg={}));function yg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(yg||(yg={}));function Tg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(Tg||(Tg={}));function vg(i){return i}(t=>{t.INVALID=t("");function e(r){return r}t.toString=e})(vg||(vg={}));var bb;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(bb||(bb={}));var yb;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(yb||(yb={}));var Tb;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(Tb||(Tb={}));var vb;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(vb||(vb={}));var Ib;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(Ib||(Ib={}));var Eb;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(Eb||(Eb={}));var Cb;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(Cb||(Cb={}));var Rb;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(Rb||(Rb={}));var Nb;(o=>(o.toString=Hi,o.fromString=zi,o.fromKiwi=Wi,o.isEqual=Qi,o.isValid=Ki))(Nb||(Nb={}));function Hi({key:i,version:e}){return`${op.toString(i)}/${ip.toString(e)}`}function zi(i){let e=i.split("/");if(e.length!==2)return null;let[t,r]=e;return t&&r?{key:t,version:r}:null}function Wi({key:i,version:e}){return!i||!e?null:{key:i,version:e}}function Qi(i,e){return!i||!e?i===e:i.key===e.key&&i.version===e.version}function Ki({key:i,version:e}){return!!(i&&e)}var Oe=class i{blendMode(){return this._blendMode}blurColor(){return this._blurColor}blurOffset(){return this._blurOffset}blurRadius(){return this._blurRadius}spread(){return this._spread}isEnabled(){return this._isEnabled}opacity(){return this._opacity}showShadowBehindNode(){return this._showShadowBehindNode}type(){return this._type}setBlendMode(e){this._blendMode=e}setBlurColor(e){this._blurColor=e}setBlurOffset(e){this._blurOffset=e}setBlurOffset1(e){this._blurOffset=e.clone()}setBlurRadius(e){this._blurRadius=e}setSpread(e){this._spread=e}setIsEnabled(e){this._isEnabled=e}setOpacity(e){this._opacity=e}setShowShadowBehindNode(e){this._showShadowBehindNode=e}setType(e){this._type=e}clone(){let e=new i;return e.setBlendMode(this.blendMode()),e.setBlurColor(this.blurColor()),e.setBlurOffset1(this.blurOffset().clone()),e.setBlurRadius(this.blurRadius()),e.setSpread(this.spread()),e.setIsEnabled(this.isEnabled()),e.setOpacity(this.opacity()),e.setShowShadowBehindNode(this.showShadowBehindNode()),e.setType(this.type()),e}isVisibleForRendering(){switch(this.type()){case"DROP_SHADOW":return this.isEnabled()&&C.alpha(this.blurColor())>0&&this.opacity()>0;case"INNER_SHADOW":return this.isEnabled()&&C.alpha(this.blurColor())>0&&this.opacity()>0&&(this.blurRadius()>0||this.blurOffset().x()!=0||this.blurOffset().y()!=0||this.spread()>0);case"BACKGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0;case"FOREGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0}return!1}isEnabledAndVisible(){return this.isEnabled()&&this.opacity()>0}equals(e){return this.blendMode()==e.blendMode()&&this.blurColor()==e.blurColor()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.spread()==e.spread()&&this.showShadowBehindNode()==e.showShadowBehindNode()&&this.isEnabled()==e.isEnabled()&&this.opacity()==e.opacity()&&this.type()==e.type()}static createForegroundBlur(e){let t=new i;return t.setType("FOREGROUND_BLUR"),t.setBlurRadius(e),t}static createBackgroundBlur(e){let t=new i;return t.setType("BACKGROUND_BLUR"),t.setBlurRadius(e),t}static createInnerShadow(e,t,r,n){let o=new i;return o.setType("INNER_SHADOW"),o.setBlurRadius(e),o.setBlurOffset(t),o.setBlurColor(r),o.setOpacity(n),o}static createDropShadow(e,t,r,n,o=0,a=!0){let s=new i;return s.setType("DROP_SHADOW"),s.setBlurRadius(e),s.setBlurOffset(t),s.setBlurColor(r),s.setOpacity(n),s.setSpread(o),s.setShowShadowBehindNode(a),s}constructor(){this._blendMode="NORMAL",this._blurColor=C.TRANSPARENT,this._blurOffset=ye.FrozenVector_ZERO,this._blurRadius=0,this._spread=0,this._isEnabled=!0,this._opacity=1,this._showShadowBehindNode=!1,this._type="DROP_SHADOW"}};var tl=class{imageType(){return this._imageType}setImageType(e){this._imageType=e}constructor(e,t){this._ctx=null,this._decodeCallback=null,this._failureCallback=null,this._texture=null,this._imageHash=null,this._isImageMockLoading=!1,this._mockDecodedData=null,this._imageType=1,this._ctx=e,this._imageHash=t}width(){return 0}height(){return 0}url(){return"https://dummy-url"}hash(){return this._imageHash}state(){return this._mockDecodedData!=null?2:this._isImageMockLoading?1:0}gif(){return null}decodedData(){return this._mockDecodedData}texture(){return this._texture}setTexture(e){this._texture=e}loadDidFail(){return!1}objectHash(){return`Image(${this._imageHash})`}fetchAndDecode(e,t,r){this._isImageMockLoading||(this._decodeCallback=t,this._failureCallback=r,this._isImageMockLoading=!0,this._ctx.markImageFetched(this))}imageLoads(){this._isImageMockLoading&&(this._mockDecodedData=_r.createFromPixels(1,1,new Uint8Array(1)),this._decodeCallback(this._mockDecodedData),this._isImageMockLoading=!1)}imageFailsToLoad(){this._isImageMockLoading=!1,this._failureCallback(0)}freeMemoryForDecodedDataAndTexture(){return this.freeMemoryForDecodedData(),this._texture=null,!0}freeMemoryForDecodedData(){return this._mockDecodedData=null,this._isImageMockLoading=!1,!0}isDecoded(){return this._mockDecodedData!=null}isGIF(){return!1}};var ba=class i{constructor(e,t,r){this._hyperlinkBoxes=e,this._usedEmojiCodepoints=t,this._usedEmojiImages=r}hyperlinkBoxes(){return this._hyperlinkBoxes}usedEmojiCodepoints(){return this._usedEmojiCodepoints}usedEmojiImages(){return this._usedEmojiImages}static forTests(e){return new i([],e,[])}};var ap=class{constructor(e,t,r,n){this.node=e,this.property=t,this.oldVal=r,this.newVal=n}},ai=class ai{constructor(e){this._listeners=new Set;this._revisionNumber=0;this._handle=0,this._observers=new zr,this._nodes=new Map,this._cachedRoot=null,this._isBetweenJoinStartAndJoinEnd=!1,this._loadedTlfs=[],this._deferUnregisteringNodes=!1,this._deferredUnregisters=null,this._handle=e}handle(){return this._handle}firstUserCanvasOrNull(){for(let e=0,t=this.root().childCount();e<t;e=e+1){let r=this.root().childAt1(e);if(r.type()=="CANVAS"&&!r.isInternalOnly())return r}return null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}broadcastPropertyChange(e){ai.VERBOSE&&console.log(`broadcasting change for property '${wt[e.property]}' on node '${e.node.id()}'`),this._observers.forEach(t=>{t.handleSceneGraphEvent(e)}),this._revisionNumber+=1;for(let t of this._listeners)t()}onChange(e){return this._listeners.add(e),()=>{var t;return(t=this._listeners)==null?void 0:t.delete(e)}}getRevisionNumber(){return this._revisionNumber}setAllTlfsLoaded(){this.setTlfsLoaded(e=>!0)}setTlfsLoaded(e){this._loadedTlfs=[],Wr(this.root(),t=>t.type()=="DOCUMENT"||t.type()=="CANVAS"||t.type()=="SECTION"||t.type()=="SLIDE_GRID"||t.type()=="SLIDE_ROW"?0:t.isTopLevel()?(t.setHasBeenLoaded(e(t)),t.hasBeenLoaded()&&this._loadedTlfs.push(t),0):2)}hierarchyDebugString(){let e="",t=(r,n)=>{let o=r.symbolID(),a=o!=null?` -> ${o}`:"";e+=`${n}${r.id()} ${r.name()}${a}
`,n+="  ";for(let s=0,l=r.childCount();s<l;s=s+1)t(r.childAt1(s),n)};return t(this.root(),""),e}dangerouslyRegisterNode(e){if(e.scene()!=this)throw new Error("Scene mismatch when registering node");let t=this.findNode(e.id());if(t!=null&&t!=e)throw new Error("Unexpected existing node when registering node");this._nodes.set(e.id(),e)}dangerouslyUnregisterNode(e){if(this._deferUnregisteringNodes){this._deferredUnregisters.push(e);return}this._nodes.delete(e),J.isRoot(e)&&(this._cachedRoot=null)}dangerouslyDeferNodeRemovalScope(e){this._deferredUnregisters=[],this._deferUnregisteringNodes=!0,e(),this._deferUnregisteringNodes=!1;for(let t of this._deferredUnregisters)this.dangerouslyUnregisterNode(t);this._deferredUnregisters=null}markLoaded(){var e;(e=L())==null||e.markSceneLoaded(this)}destroy(){var e;(e=L())==null||e.destroyScene(this)}setFileKey(e){var t;(t=L())==null||t.modules().prototype.setSceneMetadata(e)}applyMessageToScene(e){var n;let t=We.milliseconds();(n=L())==null||n.applyNodeChanges(e);let r=We.milliseconds()-t;r>100&&console.warn(`applyMessageToScene took ${r/1e3} seconds`)}totalNodeCount(){return this._nodes.size}each(e){He.StringMap_each(this._nodes,(t,r)=>{e(r)})}findNode(e){return e==null?null:He.StringMap_get(this._nodes,e,null)}findNodeByStablePath(e){if(e==null||e.guids==null)return null;let t=L().findNode(this,e);return this.findNode(t)}findStyle(e){let t=L().sceneGraphTsApi().styleByIdOrNull(e);return this.findNode(t)}createNode(e){if(!Fo())throw new Error("Should not be creating nodes in Skew while running fullview");let t={};return t.guid=J.toFigGUID(e),t.phase="CREATED",vm(t),this.findNode(e)}removeNode(e){if(!Fo())throw new Error("Should not be removing nodes in Skew while running fullview");let t={};t.guid=J.toFigGUID(e),t.phase="REMOVED",vm(t);let r=this.findNode(e)}root(){return this._cachedRoot==null&&(this._cachedRoot=this.findNode(J._new(0,0)),this._cachedRoot.updateIsRooted()),this._cachedRoot}regenerateDirtySymbolInstances(e){L().updateSymbolInstancesForTests()}updateDirtyStyleConsumers(){L().updateStylesForTests()}findNodeFromDeveloperFriendlyId(e){if(e.charCodeAt(0)==84){let t=e.slice(1).split(";");if(t.length!=3)return console.error("Table cell developer friendly id does not have 3 guids"),null;let r=J.fromString(t[0]),n=this.findNode(r);if(n==null)return console.error("Cannot find table from table cell developer friendly id"),null;let o=J.fromString(t[1]),a=J.fromString(t[2]);return n.getTableCellAt(o,a)}else if(e.charCodeAt(0)==73){let t=e.slice(1).split(";"),r=J.fromString(t[0]),n=this.findNode(r),o=null;o=(s,l)=>{if(s==null)return null;if(l(s))return s;for(let c=0,d=s.childCount();c<d;c=c+1){let h=o(s.childAt1(c),l);if(h!=null)return h}return null};let a=new yt(t.map(s=>J.fromString(s)));return o(n,s=>yt.equals(s.stablePath(),a))}else return this.findNode(e)}static createCanvasInScene(e,t){let r=e.createNode(t);return r.setType("CANVAS"),r.setVisible(!0),r.setOpacity(1),r.setName("canvas"),r.setCurrentViewportSize(new R(1e6,1e6)),e.root().appendChild(r),r}static createLoadedFrameWithCanvasContent(e,t){let r=new bt,n=[];Wr(t,l=>l.isTopLevel()?(r.include3(l.fullSizeCanvasSpaceBoundingBox()),n.push(l),2):0);let o=r.build();o.expand1(150);let a=t.fillPaintsToRender()[0].asSinglePaint();a.opacity()==0&&(a=te.createSolid(C.WHITE,1));let s=lo(t,"frame",a);Je(s,o.topLeft(),o.size()),s.setTestOnlyFillGeometry(Qo(s.fullSizeCanvasSpaceBoundingBox()));for(let l of n){let c=l.relativeTransform().clone();c.translate1(s.relativeTransform().translation().negative()),l.setParentIndex(new Vr(J.invalid(),dr.fromString(""))),s.appendChild(l),l.setRelativeTransform(c)}return e.setTlfsLoaded(l=>l==s?!0:l.hasBeenLoaded()),s}static createScene(e,t){return L().createSceneAndSetActive(e,t)}static createSceneWithCanvasForTests1(){return ai.createSceneWithCanvasForTests2(X.ViewerMode.PROTOTYPE)}static createSceneWithCanvasForTests2(e){var r;X.setViewerMode(e);let t=ai.createScene(ai.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,null);return(r=L())==null||r.modules().prototype.setSceneMetadata("1"),ai.createCanvasInScene(t,J._new(0,1)),t.markLoaded(),t}};ai.MAX_GUID_VALUE=2147483647,ai.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER=ai.MAX_GUID_VALUE-1,ai.VERBOSE=!1;var _t=ai;function Ig(i){return i.x()==375&&i.y()==812?"APPLE_IPHONE_X_SILVER":i.x()==414&&i.y()==736?"APPLE_IPHONE_8_PLUS_SILVER":i.x()==375&&i.y()==667?"APPLE_IPHONE_8_SILVER":i.x()==320&&i.y()==568?"APPLE_IPHONE_SE_SILVER":i.x()==411&&i.y()==731?"GOOGLE_PIXEL_2_CLEARLY_WHITE":i.x()==768&&i.y()==1024?"APPLE_IPAD_MINI_4_SILVER":i.x()==1024&&i.y()==1366?"APPLE_IPAD_PRO_SILVER":i.x()==1440&&i.y()==990?"MICROSOFT_SURFACE_PRO_3":i.x()==1368&&i.y()==912?"MICROSOFT_SURFACE_PRO_4":i.x()==312&&i.y()==390?"APPLE_WATCH_42MM_STEEL_PLUS_WHITE_CLOSED":i.x()==272&&i.y()==340?"APPLE_WATCH_38MM_STEEL_PLUS_WHITE_CLOSED":null}var Te=class Te{constructor(e,t=null){this._paths=new Map;this._imageManager=e,this._videoManager=t}static hash(e,t){return t instanceof Array&&t.length===0?e:t}static hasFileHeader(e){for(let t=0,r=Te.FILE_HEADER.length;t<r;t=t+1)if(t>=e.length||e[t]!=Te.FILE_HEADER[t])return!1;return!0}static parseChunkType(e){return e.length!=Te.CHUNK_TAG_LEN?Te.ChunkType.UNKNOWN:(r=>{for(let n=0,o=e.length;n<o;n=n+1)if(e[n]!=r[n])return!1;return!0})(Te.THUMBNAIL_CHUNK_TAG)?Te.ChunkType.THUMBNAIL:Te.ChunkType.UNKNOWN}static readInt32(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}static _logVerbose(e){console.log(e)}static _logVerbosePropertyChange(e,t){console.log(`decoded property change '${t}' for node '${e}'`)}static encodeGUID(e){return J.toFigGUID(e)}static encodeGUIDPath(e){let t={};return e.guids!=null&&(t.guids=e.guids.map(r=>Te.encodeGUID(r))),t}static encodeInstanceStateChange(e,t){let r={};return r.stateID=Te.encodeGUID(e.newStateId()),r.interactionID=Te.encodeGUID(e.interactionAddress.interactionId),e.interactionAddress.hotspotStablePath!=null&&(r.hotspotStablePath=Te.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),e.stablePath!=null&&(r.instanceStablePath=Te.encodeGUIDPath(e.stablePath)),r.phase=t,r}static encodePrototypeStateChange(e){let t={};if(e.oldStateAndOverlays!=null){let r={};e.oldStateAndOverlays.stateId!=null&&(r.baseScreenID=Te.encodeGUID(e.oldStateAndOverlays.stateId),r.overlays=e.oldStateAndOverlays.overlays.map(n=>Te.encodeOverlayData(n,null))),t.oldState=r}if(e.newStateAndOverlays!=null){let r={};e.newStateAndOverlays.stateId!=null&&(r.baseScreenID=Te.encodeGUID(e.newStateAndOverlays.stateId),r.overlays=e.newStateAndOverlays.overlays.map(n=>Te.encodeOverlayData(n,null))),t.newState=r}return e.interactionAddress.hotspotStablePath!=null&&(t.hotspotBlueprintID=Te.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),t.isHotspotInNewPresentedState=[6,7].indexOf(e.cause)==-1,t.interactionID=Te.encodeGUID(e.interactionAddress.interactionId),t.direction=e.direction==0?"FORWARD":"REVERSE",t}static encodeOverlayData(e,t){let r={};return r.hotspotBlueprintId=Te.encodeGUIDPath(e.openingHotspotStablePath),t!=null&&(r.hotspotGuid=Te.encodeGUID(t)),r.overlayGuid=Te.encodeGUID(e.id),r.prototypeInteractionGuid=Te.encodeGUID(e.openingInteractionId),r.swapGuid=Te.encodeGUID(e.overlayDataModelId),r}static encodeMatrix(e){let t={};return t.m00=e.m00(),t.m01=e.m01(),t.m02=e.m02(),t.m10=e.m10(),t.m11=e.m11(),t.m12=e.m12(),t}static encodeVector1(e){let t={};return t.x=e.x(),t.y=e.y(),t}static encodeVector2(e){let t={};return t.x=e.x(),t.y=e.y(),t}static decodeGUID(e){let t=null,r=e.sessionID|0;if(r<0){let n=e.localID|0;r==-1&&(n==-1||n==-2)?t=J._new(r,n):(Le("Negative session ID encountered in GUID deserialization"),t=J._new(e.sessionID,e.localID))}else t=J._new(e.sessionID,e.localID);return nt.asGUID(t)}static decodeGUID_instanceHACK(e){return J._new(e.sessionID|0,e.localID)}static decodeGUIDPath(e){if(e.guids===void 0)return null;let t=[];for(let r of e.guids){let n=Te.decodeGUID(r);if(n==null)return null;t.push(n)}return new yt(t)}static decodeStyleId(e){let t=e.guid!=null?Te.decodeGUID(e.guid):null,r=e.assetRef!=null?{key:e.assetRef.key,version:e.assetRef.version}:null,n={guid:t,ref:r};return nt.asStyleId(n)}static decodeParentIndex(e){return new Vr(Te.decodeGUID(e.guid),dr.fromString(e.position))}static decodeVector(e){return new R(e.x,e.y)}static decodeMatrix(e){return new ee(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}static decodeColor(e){return C.new3(e.r,e.g,e.b,e.a)}static decodeFontName(e){let t=e.postscript!==void 0?e.postscript:"";return new nu(e.family,e.style,t)}static decodeNumber(e){return new ru(e.value,e.units)}static decodeStops(e){let t=[];for(let r of e)t.push(new ot(Te.decodeColor(r.color),r.position));return t}static decodePrototypeDevice(e){let t=Te.decodeVector(e.size),r=e.presetIdentifier!==void 0?e.presetIdentifier:null;e.type=="PRESET"&&(r==null||r.length==0)&&(r=Ig(t));let n=e.rotation!==void 0?e.rotation:"NONE";return new jr(e.type,t,r,n)}static decodePrototypeStartingPoint(e){return new _i(e.name,e.description,dr.fromString(e.position))}static encodePrototypeStartingPoint(e){let t={};return t.name=e.name,t.description=e.description,t.position=dr.toString(e.position),t}static decodeOverlayBackgroundAppearance(e){return new ei(e.backgroundType!==void 0?e.backgroundType:"NONE",e.backgroundColor!==void 0?Te.decodeColor(e.backgroundColor):C.TRANSPARENT)}static decodeVideoPlayback(e){return{autoplay:e.autoplay!==void 0?e.autoplay:!1,mediaLoop:e.mediaLoop!==void 0?e.mediaLoop:!1,muted:e.muted!==void 0?e.muted:!1}}static decodeEffects(e){let t=[];for(let n of e){let o=new Oe;o.setType(n.type),n.color!==void 0&&(o.setBlurColor(C.withAlpha(Te.decodeColor(n.color),255)),o.setOpacity(n.color.a)),n.blendMode!==void 0&&o.setBlendMode(n.blendMode),n.offset!==void 0&&o.setBlurOffset1(Te.decodeVector(n.offset)),n.radius!==void 0&&o.setBlurRadius(n.radius),n.visible!==void 0&&o.setIsEnabled(n.visible),n.spread!==void 0&&o.setSpread(n.spread),n.showShadowBehindNode!==void 0?o.setShowShadowBehindNode(n.showShadowBehindNode):o.setShowShadowBehindNode(!0),t.push(o)}let r=t;return nt.asEffectList(r)}static decodeExportConstraint(e){return e.type!==void 0&&e.value!==void 0?new Ls(e.type,e.value):new Ls("CONTENT_SCALE",1)}static decodeExportSettings(e,t){let r=[];for(let n of e){let o=null;n.suffix!==void 0?o=n.suffix:o="";let a=null;n.imageType!==void 0?a=n.imageType:a="PNG";let s=null;n.constraint!==void 0?s=Te.decodeExportConstraint(n.constraint):s=new Ls("CONTENT_SCALE",1);let l=t;n.contentsOnly!==void 0&&(l=n.contentsOnly),r.push(new ou(o,a,s,l))}return r}static decodePrototypeInteractions(e){return e.map(t=>Te.decodePrototypeInteraction(t))}static decodePrototypeInteraction(e){let t=e.id!==void 0?Te.decodeGUID(e.id):null,r=e.event!==void 0?Te.decodePrototypeEvent(e.event):null,n=e.actions!==void 0?e.actions.map(s=>Te.decodePrototypeAction(s)):null,o=e.isDeleted!==void 0?e.isDeleted:!1,a=e.stateManagementVersion!==void 0?e.stateManagementVersion:0;return new Zt(t,r,n,o,a)}static encodePrototypeInteractionForTests(e){let t={};t.id=Te.encodeGUID(e.id()),t.isDeleted=e.isDeleted(),t.stateManagementVersion=e.stateManagementVersion(),t.event=Te.encodePrototypeEventForTests(e.event());let r=[],n=e.actions();for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];r.push(Te.encodePrototypeActionForTests(s))}return t.actions=r,t}static decodePrototypeEvent(e){let t=e.interactionType!==void 0?e.interactionType:null,r=e.interactionMaintained!==void 0?new fe(e.interactionMaintained):null,n=e.interactionDuration!==void 0?new fe(e.interactionDuration):null,o=e.keyTrigger!==void 0?e.keyTrigger:null,a=e.transitionTimeout!==void 0?new fe(e.transitionTimeout):null,s=e.mediaHitTime!==void 0?new fe(e.mediaHitTime):null;return new Qn(t,r,n,o,a,s)}static encodePrototypeEventForTests(e){let t={};return t.interactionType=e.interactionType(),t.interactionMaintained=e.interactionMaintained(),t.interactionDuration=e.interactionDuration(),t.keyTrigger=e.keyTrigger(),t.keyTrigger.keyCodes=e.keyTrigger().keyCodes,t.keyTrigger.triggerDevice=e.keyTrigger().triggerDevice,t.transitionTimeout=e.transitionTimeout(),t.mediaHitTime=e.mediaHitTime(),t}static decodeConditionalActions(e){let t=[],r=e.actions!==void 0?e.actions.map(o=>Te.decodePrototypeAction(o)):t,n=e.condition!==void 0?Te.variableDataToJson(e.condition):"";return new pc(r,n)}static encodeConditionalActionsForTests(e){let t={},r=[],n=e.actions();for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];r.push(Te.encodePrototypeActionForTests(s))}return t.actions=r,t}static decodePrototypeAction(e){let t=e.transitionNodeID!==void 0?Te.decodeGUID(e.transitionNodeID):null,r=e.transitionType!==void 0?e.transitionType:null,n=e.transitionDuration!==void 0?new fe(e.transitionDuration):null,o=e.easingType!==void 0?e.easingType:null,a=e.easingFunction!==void 0?e.easingFunction:null,s=e.transitionShouldSmartAnimate!==void 0?new fe(e.transitionShouldSmartAnimate):null,l=e.connectionType!==void 0?e.connectionType:null,c=e.connectionURL!==void 0?e.connectionURL:null,d=e.overlayRelativePosition!==void 0?Te.decodeVector(e.overlayRelativePosition):null,h=e.navigationType!==void 0?e.navigationType:null,u=e.transitionPreserveScroll!==void 0?new fe(e.transitionPreserveScroll):null,m=e.extraScrollOffset!==void 0?Te.decodeVector(e.extraScrollOffset):null,g=e.mediaAction!==void 0?e.mediaAction:null,_=e.transitionResetVideoPosition!==void 0?new fe(e.transitionResetVideoPosition):null,f=e.openUrlInNewTab!==void 0?new fe(e.openUrlInNewTab):null,S=e.mediaSkipToTime!==void 0?new fe(e.mediaSkipToTime):null,b=e.mediaSkipByAmount!==void 0?new fe(e.mediaSkipByAmount):null,T=e.transitionResetScrollPosition!==void 0?new fe(e.transitionResetScrollPosition):null,y=e.conditionalActions!==void 0?e.conditionalActions.map(D=>Te.decodeConditionalActions(D)):null,I=e.transitionResetInteractiveComponents!==void 0?new fe(e.transitionResetInteractiveComponents):null,p=e.targetVariable!==void 0?dc.toString(e.targetVariable.id):null,A=e.targetVariableData!==void 0?Te.variableDataToJson(e.targetVariableData):null,v=e.targetVariableModeID!==void 0?Te.decodeGUID(e.targetVariableModeID):null,E=e.targetVariableSetKey!==void 0?e.targetVariableSetKey:null;return new Qr(t,r,n,o,a,s,l,c,d,h,u,m,g,_,f,S,b,T,y,I,p,A,v,E)}static variableDataToJson(e){let t={},r=e.dataType;switch(t.type=Te.variableDataTypeToEnumValue(r),t.resolvedType=Te.variableResolvedDataTypeToEnumValue(e.resolvedDataType),r){case"BOOLEAN":{t.value=e.value.boolValue;break}case"STRING":{t.value=e.value.textValue;break}case"FLOAT":{t.value=e.value.floatValue;break}case"COLOR":{let n={};n.r=e.value.colorValue.r,n.g=e.value.colorValue.g,n.b=e.value.colorValue.b,n.a=e.value.colorValue.a,t.value=n;break}case"ALIAS":{t.value=dc.toString(e.value.alias);break}case"EXPRESSION":{t.value=Te.expressionToJson(e.value.expressionValue);break}case"MAP":throw new Error("Did not implement variableDataToJson for MAP data type")}return t}static variableDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"ALIAS":return 3;case"COLOR":return 4;case"EXPRESSION":return 5;case"MAP":return 6;case"SYMBOL_ID":return 7;case"FONT_STYLE":return 8;case"TEXT_DATA":return 9;case"INVALID":return 10}throw new Error(`Invalid variable data type: ${e}`)}static variableResolvedDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"COLOR":return 3;case"MAP":return 4;case"SYMBOL_ID":return 5;case"FONT_STYLE":return 6;case"TEXT_DATA":return 7}throw new Error(`Invalid resolved variable data type: ${e}`)}static expressionToJson(e){let t={};t.expressionFunction=Te.expressionFunctionToEnumValue(e.expressionFunction);let r=[];for(let n=0;n<e.expressionArguments.length;n=n+1)r.push(Te.variableDataToJson(e.expressionArguments[n]));return t.expressionArguments=r,t}static expressionFunctionToEnumValue(e){switch(e){case"ADDITION":return 0;case"SUBTRACTION":return 1;case"RESOLVE_VARIANT":return 2;case"MULTIPLY":return 3;case"DIVIDE":return 4;case"EQUALS":return 5;case"NOT_EQUAL":return 6;case"LESS_THAN":return 7;case"LESS_THAN_OR_EQUAL":return 8;case"GREATER_THAN":return 9;case"GREATER_THAN_OR_EQUAL":return 10;case"AND":return 11;case"OR":return 12;case"NOT":return 13;case"STRINGIFY":return 14;case"TERNARY":return 15;case"VAR_MODE_LOOKUP":return 16;case"NEGATE":return 17;case"IS_TRUTHY":return 18}throw new Error(`Invalid expression function: ${e}`)}static encodePrototypeActionForTests(e){let t={};t.transitionNodeID=Te.encodeGUID(e.transitionNodeID()),t.transitionType=e.transitionType(),t.transitionDuration=e.transitionDuration(),t.easingType=e.easingType(),t.easingFunction=e.easingFunctionValues(),t.transitionShouldSmartAnimate=e.transitionShouldSmartAnimate(),t.connectionType=e.connectionType(),t.connectionURL=e.connectionURL(),t.overlayRelativePosition=Te.encodeVector1(e.overlayRelativePosition()),t.navigationType=e.navigationType(),t.transitionPreserveScroll=e.transitionPreserveScroll(),t.extraScrollOffset=Te.encodeVector1(e.extraScrollOffset()),t.mediaAction=e.mediaAction(),t.transitionResetVideoPosition=e.transitionResetVideoPosition(),t.openUrlInNewTab=e.openUrlInNewTab(),t.mediaSkipToTime=e.mediaSkipToTime(),t.mediaSkipByAmount=e.mediaSkipByAmount(),t.transitionResetScrollPosition=e.transitionResetScrollPosition();let r=[],n=e.conditionalActions();for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];r.push(Te.encodeConditionalActionsForTests(s))}return t.conditionalActions=r,t.transitionResetInteractiveComponents=e.transitionResetInteractiveComponents(),t}static serializeValueToKiwiForTests1(e,t){let r={},n=[];return Te.serializeValueToKiwiForTests2(e,t,r,n),new cn(r,n)}static serializeValueToKiwiForTests2(e,t,r,n){if(!Fo())throw new Error("Should only serialize values to kiwi when running tests");if(e==59||e==60){let o=nt.asPaintList(t);if(o==null)throw new Error("attempt to set null paint list");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let c=o[s].asSinglePaint(),d={};if(d.type=c.type(),d.opacity=c.opacity(),d.visible=c.isEnabled(),d.blendMode=c.blendMode(),c.colorStops()!=null){let u=[];for(let m=0,g=c.colorStops().length;m<g;m=m+1){let _=c.colorStops()[m],f={},S={};S.r=C.redF(_.color),S.g=C.greenF(_.color),S.b=C.blueF(_.color),S.a=C.alphaF(_.color),f.color=S,f.position=_.position,u.push(f)}d.stops=u}let h={};if(h.r=C.redF(c.color()),h.g=C.greenF(c.color()),h.b=C.blueF(c.color()),h.a=C.alphaF(c.color()),d.color=h,c.image()!=null){let u={};u.hash=Mr.hexToBytes(c.image().hash()),d.image=u,d.imageScaleMode=c.imageScaleMode()}a.push(d)}e==59?r.fillPaints=a:e==60&&(r.strokePaints=a)}else if(e==75){let o=t;if(o==null)throw new Error("attempt to set null symbol data");let a={};a.symbolID=Te.encodeGUID(o.masterID);let s=[];yo.map(o.instanceOverrides).each((l,c)=>{let d={};d.guidPath=Te.encodeGUIDPath(l),hr.each(c,(h,u)=>{Te.serializeValueToKiwiForTests2(h,u,d,[])}),s.push(d)}),a.symbolOverrides=s,r.symbolData=a}else if(e==73||e==74){let o=t;if(o==null)throw new Error("attempt to set null geometry");let a=[];for(let s=0,l=o.regions.length;s<l;s=s+1){let c=o.regions[s],d={};d.windingRule=c.windingRule,d.styleID=c.styleID,d.commandsBlob=n.length,n.push(Pt.mutableData(c.path().toBezierPath().getMutableClone()).bytes()),a.push(d)}e==73?r.fillGeometry=a:r.strokeGeometry=a}else if(e==4){let o=t;if(o==null)throw new Error("attempt to set null textData");let a={};a.characters=o.characters();let s=[];o.styleOverrideTable().forEachStyle((c,d)=>{Go.each(d,(h,u)=>{let g=Te.serializeValueToKiwiForTests1(h,u).a;g.styleID=c,s.push(g)})}),a.styleOverrideTable=s;let l=[];o.usedEmojiCodepointsDEPRECATED().forEach(c=>{let d={};d.emojiCodePoints=c,l.push(d)}),a.glyphs=l,r.textData=a}else if(e==5){let o=t;if(o==null)throw new Error("attempt to set null textData");let a={},s=[];o.usedEmojiCodepoints().forEach(l=>{let c={};c.emojiCodePoints=l,s.push(c)}),a.glyphs=s,a.hyperlinkBoxes=o.hyperlinkBoxes().map(l=>({guid:l.guid,bounds:l.bounds,hyperlinkID:l.hyperlinkID,url:l.url})),r.derivedTextData=a}else if(e==61){let o=nt.asEffectList(t);if(o==null)throw new Error("attempt to set null effects");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let c=o[s],d={};d.blendMode=c.blendMode(),d.radius=c.blurRadius(),d.spread=c.spread(),d.visible=c.isEnabled(),d.showShadowBehindNode=c.showShadowBehindNode(),d.type=c.type();let h={};h.r=C.redF(c.blurColor()),h.g=C.greenF(c.blurColor()),h.b=C.blueF(c.blurColor()),h.a=c.opacity(),d.color=h;let u=Te.encodeVector2(c.blurOffset());d.offset=u,a.push(d)}r.effects=a}else if(e==51){let o=nt.asGUID(t);if(o==null)throw new Error("attempt to set null overridenSymbolID");r.overriddenSymbolID=Te.encodeGUID(o)}else if(e==81){let o=t;if(o==null)throw new Error("attempt to set null prototypeInteractions");let a=[];for(let s=0,l=o.length;s<l;s=s+1){let d=o[s];a.push(Te.encodePrototypeInteractionForTests(d))}r.prototypeInteractions=a}else if(e==98){let o=nt.asStringEnum(t,null);if(o==null)throw new Error("Bad node phase");r.phase=o}else{let o=Hs(e);throw new Error(`unsupported setter for node field ${wt[e]} and type ${gc[o]}`)}}_imageDecoded(e,t,r){this._imageManager!=null&&this._imageManager.onNewImage(e,t,r)}_imageByHexHashOrNull(e,t){var r;return(r=this._imageManager)==null?void 0:r.findImageByHexHash(e,t)}decodeImage(e,t,r){let n=Mr.bytesToHex(e.hash),o=this._imageByHexHashOrNull(n,1);if(o==null){let a=null;if(e.dataBlob!==void 0){let s=e.dataBlob;s<0||s>=t.length?console.warn(`ignoring invalid compressed data index ${s} for blob count ${t.length}`):a=t[s].bytes}Vn?o=new tl(null,n):o=Mr.createImage(e.hash,a,r),this._imageDecoded(n,1,o)}return o}decodeVideo(e){let t=new Uint8Array(e.hash);return this._videoManager.buildVideoResource(t)}decodeEmojiImage(e){let t=e.map(n=>n.toString(16)).join("-"),r=this._imageByHexHashOrNull(t,0);return r==null&&(r=Mr.createEmojiImage2(t),this._imageDecoded(t,0,r)),r}decodePaints(e,t){let r=[];for(let o of e){let a=new te(o.type);if(o.blendMode!==void 0&&a.setBlendMode(o.blendMode),o.color!==void 0){let s=Te.decodeColor(o.color);a.setOpacity(C.alphaF(s)),a.setColor(C.withAlpha(s,255))}if(o.opacity!==void 0&&a.setOpacity(a.opacity()*o.opacity),o.stops!==void 0&&a.setColorStops1(Te.decodeStops(o.stops)),o.transform!==void 0&&a.setTransform1(Te.decodeMatrix(o.transform)),o.visible!==void 0&&a.setIsEnabled(o.visible),o.imageScaleMode!==void 0&&a.setImageScaleMode(o.imageScaleMode),o.rotation!==void 0&&a.setRotationDeg(o.rotation),o.scale!==void 0&&a.setScalingFactor(o.scale),o.paintFilter!==void 0&&a.setFilterColorAdjust(o.paintFilter),o.originalImageWidth!==void 0&&a.setOriginalImageWidth(o.originalImageWidth),o.originalImageHeight!==void 0&&a.setOriginalImageHeight(o.originalImageHeight),o.emojiCodePoints!==void 0)a.setImage(this.decodeEmojiImage(o.emojiCodePoints));else{let s=!1;o.animatedImage!==void 0&&o.animatedImage.hash!==void 0?(a.setImage(this.decodeImage(o.animatedImage,t,0)),o.animationFrame!==void 0&&o.animationFrame!=0&&(s=!0)):o.video!==void 0&&o.video.hash!==void 0?(a.setVideo(this.decodeVideo(o.video)),o.image!==void 0&&o.image.hash!==void 0&&a.setImage(this.decodeImage(o.image,t,1))):o.image!==void 0&&o.image.hash!==void 0&&a.setImage(this.decodeImage(o.image,t,1)),!s&&o.imageThumbnail!==void 0&&o.imageThumbnail.hash!==void 0&&a.setImageThumbnail(this.decodeImage(o.imageThumbnail,t,1))}a.opacity()!=0&&a.opacity()<1/250&&a.setOpacity(1/250),r.push(a)}let n=r;return nt.asPaintList(n)}decodePath(e,t){let r=zt.IntMap_get(this._paths,e,null);return r==null&&(e<0||e>=t.length?(console.warn(`ignoring invalid path index ${e} for blob count ${t.length}`),r=new Pt(new on)):r=new Pt(new on(new Uint8Array(t[e].bytes))),this._paths.set(e,r)),r}decodeGeometry(e,t){let r=[],n=null;for(let o of e){let a="ODD";if(o.commandsBlob===void 0){console.warn("ignoring path with missing required field: 'commandsBlob'");continue}o.windingRule!==void 0&&(a=o.windingRule);let s=this.decodePath(o.commandsBlob,t);r.push(new Fr(a,0,s,s.bounds())),o.styleID!==void 0&&(n==null&&(n=[]),n.push(o.styleID))}bt.INSTANCE.reset();for(let o of r)bt.INSTANCE.include3(o.bounds());return new xr(r,n,bt.INSTANCE.build(),null)}decodeTextData(e,t){let r=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new kr,n=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[],o=null,a=r.styleByID2();for(let s of Array.from(a.keys())){let l=a.get(s),c=hr.get(l,3,null);if(c!=null){if(o==null)o=c;else if(c!==o){o="mixed";break}}}return new yi(r,o,n,e.characters!==void 0?e.characters:"",e.lines!==void 0?e.lines:[],e.characterStyleIDs!==void 0?e.characterStyleIDs:[],[],[])}decodeDerivedTextData(e,t){let r=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[];return new ba(r,[],[])}decodeVectorData(e,t){let r=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new kr;return new Eu(r)}decodeSymbolData(e,t){return e.symbolID===void 0?(console.warn("ignoring symbol data with missing required field: 'symbolID'"),null):new ki(Te.decodeGUID(e.symbolID),e.symbolOverrides!==void 0?this.decodeOverrides(e.symbolOverrides,t):yo._new())}decodeOverrides(e,t){let r=yo._new();for(let n of e)if(n.guidPath!==void 0){let o=Te.decodeGUIDPath(n.guidPath),a=hr._new();this.decodeNodeChange(n,t,(s,l)=>{hr.set(a,s,l)}),yo.map(r).set(o,a)}return r}decodeStyleOverrideTable(e,t){let r=new Map;for(let n of e)n.styleID!==void 0&&this.decodeNodeChange(n,t,(o,a)=>{r.has(n.styleID)||r.set(n.styleID,hr._new()),hr.set(r.get(n.styleID),o,a)});return new kr(r)}decodeNodeChange(e,t,r){e.type!==void 0&&r(19,e.type),e.backgroundColor!==void 0&&r(64,Te.decodeColor(e.backgroundColor)),e.backgroundEnabled!==void 0&&r(9,e.backgroundEnabled),e.backgroundOpacity!==void 0&&r(38,e.backgroundOpacity),e.blendMode!==void 0&&r(22,e.blendMode),e.connectionType!==void 0&&r(26,e.connectionType),e.connectionURL!==void 0&&r(70,e.connectionURL),e.cornerRadius!==void 0&&r(44,e.cornerRadius),e.rectangleTopLeftCornerRadius!==void 0&&r(39,e.rectangleTopLeftCornerRadius),e.rectangleTopRightCornerRadius!==void 0&&r(40,e.rectangleTopRightCornerRadius),e.rectangleBottomLeftCornerRadius!==void 0&&r(41,e.rectangleBottomLeftCornerRadius),e.rectangleBottomRightCornerRadius!==void 0&&r(42,e.rectangleBottomRightCornerRadius),e.rectangleCornerRadiiIndependent!==void 0&&r(15,e.rectangleCornerRadiiIndependent),e.cornerSmoothing!==void 0&&r(45,e.cornerSmoothing),e.easingType!==void 0&&r(28,e.easingType),e.effects!==void 0&&r(61,Te.decodeEffects(e.effects)),e.arcData!==void 0&&r(63,e.arcData),e.shapeWithTextType!==void 0&&r(84,e.shapeWithTextType),e.fillGeometry!==void 0&&r(73,this.decodeGeometry(e.fillGeometry,t)),e.fillPaints!==void 0&&r(59,this.decodePaints(e.fillPaints,t)),e.frameMaskDisabled!==void 0&&r(13,e.frameMaskDisabled),e.interactionType!==void 0&&r(29,e.interactionType),e.internalOnly!==void 0&&r(12,e.internalOnly),e.isStateGroup!==void 0&&r(80,e.isStateGroup),e.mask!==void 0&&r(10,e.mask),e.maskIsOutline!==void 0&&r(11,e.maskIsOutline),e.name!==void 0&&r(62,e.name),e.navigationType!==void 0&&r(30,e.navigationType),e.opacity!==void 0&&r(37,lr.Math_clamp(e.opacity,0,1)),e.overlayBackgroundInteraction!==void 0&&r(32,e.overlayBackgroundInteraction),e.overlayBackgroundAppearance!==void 0&&r(67,Te.decodeOverlayBackgroundAppearance(e.overlayBackgroundAppearance)),e.overlayPositionType!==void 0&&r(31,e.overlayPositionType),e.overlayRelativePosition!==void 0&&r(57,Te.decodeVector(e.overlayRelativePosition)),e.overriddenSymbolID!==void 0&&r(51,Te.decodeGUID(e.overriddenSymbolID)),e.overrideKey!==void 0&&r(50,Te.decodeGUID(e.overrideKey)),e.parentIndex!==void 0&&r(25,Te.decodeParentIndex(e.parentIndex)),e.prototypeBackgroundColor!==void 0&&r(65,Te.decodeColor(e.prototypeBackgroundColor)),e.prototypeDevice!==void 0&&r(66,Te.decodePrototypeDevice(e.prototypeDevice)),e.prototypeStartNodeID!==void 0&&r(69,Te.decodeGUID(e.prototypeStartNodeID)),e.prototypeStartingPoint!==void 0&&r(83,Te.decodePrototypeStartingPoint(e.prototypeStartingPoint)),e.resizeToFit!==void 0&&r(14,e.resizeToFit),e.scrollDirection!==void 0&&r(34,e.scrollDirection),e.size!==void 0&&r(49,Te.decodeVector(e.size)),e.strokeAlign!==void 0&&r(23,e.strokeAlign),e.strokeGeometry!==void 0&&r(74,this.decodeGeometry(e.strokeGeometry,t)),e.strokePaints!==void 0&&r(60,this.decodePaints(e.strokePaints,t)),e.symbolData!==void 0&&r(75,this.decodeSymbolData(e.symbolData,t)),e.videoPlayback!==void 0&&r(72,Te.decodeVideoPlayback(e.videoPlayback)),e.stackReverseZIndex!==void 0&&r(78,e.stackReverseZIndex),e.textData!==void 0&&r(4,this.decodeTextData(e.textData,t)),e.derivedTextData!==void 0&&r(5,this.decodeDerivedTextData(e.derivedTextData,t)),e.vectorData!==void 0&&r(76,this.decodeVectorData(e.vectorData,t)),e.transform!==void 0&&r(24,Te.decodeMatrix(e.transform)),e.transitionNodeID!==void 0&&r(71,Te.decodeGUID(e.transitionNodeID)),e.transitionType!==void 0&&r(27,e.transitionType),e.transitionShouldSmartAnimate!==void 0&&r(18,e.transitionShouldSmartAnimate),e.transitionDuration!==void 0&&r(46,e.transitionDuration),e.transitionTimeout!==void 0&&r(47,e.transitionTimeout),e.interactionMaintained!==void 0&&r(16,e.interactionMaintained),e.interactionDuration!==void 0&&r(48,e.interactionDuration),e.transitionPreserveScroll!==void 0&&r(17,e.transitionPreserveScroll),e.visible!==void 0&&r(8,e.visible),e.styleType!==void 0&&r(33,e.styleType),e.inheritFillStyleID!==void 0&&r(52,Te.decodeGUID(e.inheritFillStyleID)),e.inheritFillStyleIDForStroke!==void 0&&r(53,Te.decodeGUID(e.inheritFillStyleIDForStroke)),e.inheritEffectStyleID!==void 0&&r(56,Te.decodeGUID(e.inheritEffectStyleID)),e.inheritTextStyleID!==void 0&&r(55,Te.decodeGUID(e.inheritTextStyleID)),e.styleIdForFill!==void 0&&r(91,Te.decodeStyleId(e.styleIdForFill)),e.styleIdForStrokeFill!==void 0&&r(92,Te.decodeStyleId(e.styleIdForStrokeFill)),e.styleIdForEffect!==void 0&&r(94,Te.decodeStyleId(e.styleIdForEffect)),e.styleIdForText!==void 0&&r(93,Te.decodeStyleId(e.styleIdForText)),e.horizontalConstraint!==void 0&&r(20,e.horizontalConstraint),e.verticalConstraint!==void 0&&r(21,e.verticalConstraint),e.scrollBehavior!==void 0&&r(35,e.scrollBehavior),e.keyTrigger!==void 0&&r(79,e.keyTrigger),e.prototypeInteractions!==void 0&&r(81,Te.decodePrototypeInteractions(e.prototypeInteractions)),e.fontSize!==void 0&&r(3,e.fontSize),e.textAlignHorizontal!==void 0&&r(1,e.textAlignHorizontal),e.textAlignVertical!==void 0&&r(2,e.textAlignVertical),e.strokeWeight!==void 0&&r(43,e.strokeWeight),e.hyperlink!==void 0&&r(6,e.hyperlink),e.mention!==void 0&&r(7,e.mention),e.interactiveSlideConfigData!==void 0&&r(85,e.interactiveSlideConfigData),e.interactiveSlideParticipantData!==void 0&&r(86,e.interactiveSlideParticipantData),e.slideSpeakerNotes!==void 0&&r(97,e.slideSpeakerNotes),e.slideSpeakerNotes!==void 0&&r(96,e.slideThumbnailHash),e.transitionType!==void 0&&e.transitionType=="MAGIC_MOVE"&&r(27,"SMART_ANIMATE")}decompressZlibOrZstd(e){let t=new jn;try{let r=jo.inflateRaw(e);t.resolve(r)}catch{let r=new np;r.init().then(o=>{t.resolve(r.decode(e))},o=>{t.resolve(null)})}return t}async decodeSceneForViewerAndPrototypeLib1(e){return this.decodeSceneForViewerAndPrototypeLib2(e,null)}_isProbablyZipFile(e){return e[0]=="P".charCodeAt(0)&&e[1]=="K".charCodeAt(0)}async decodeSceneForViewerAndPrototypeLib2(e,t){if(this._isProbablyZipFile(e)){let l=(await new js(new Ys(e)).getEntries()).find(c=>c.filename==="canvas.fig");if(!(l!=null&&l.getData))throw new Error("Cannot find canvas.fig in zip file");e=await l.getData(new Xs)}let r=new jn,n=e.length,o=Te.FILE_HEADER.length;if(Te.hasFileHeader(e)&&o+4<=n){let a=Te.readInt32(e,o);if(o=o+4,a>=1&&o+4<=n){let s=Te.readInt32(e,o);o=o+4,o+s+4<=n?this.decompressZlibOrZstd(e.subarray(o,o+s)).then1(l=>{let c=lp.compileSchema(lp.decodeBinarySchema(l));o=o+s;let d=Te.readInt32(e,o);if(o=o+4,o+d<=n){let h=e.subarray(o,o+d);o=o+d;let u=!1;for(;o<n;){o+4>e.length&&r.resolve(null);let m=Te.readInt32(e,o);if(o=o+4,m==0)continue;o+Te.CHUNK_TAG_LEN>n&&r.resolve(null);let g=e.subarray(o,o+Te.CHUNK_TAG_LEN);o=o+Te.CHUNK_TAG_LEN;let _=m-Te.CHUNK_TAG_LEN;switch(o+_>n&&r.resolve(null),o=o+_,Te.parseChunkType(g)){case Te.ChunkType.THUMBNAIL:{u&&r.resolve(null),u=!0;break}case Te.ChunkType.UNKNOWN:break}}this.decompressZlibOrZstd(new Uint8Array(h)).then1(m=>{let g=c.decodeMessage(m);if(g.type!==void 0&&g.type=="NODE_CHANGES"){let _=_t.createScene(_t.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,a);t!=null&&_.setFileKey(t),_.applyMessageToScene(m),r.resolve(_)}else r.resolve(null)})}else r.resolve(null)}):r.resolve(null)}else r.resolve(null)}else r.resolve(null);return r.realPromise()}};Te.VERBOSE=!1,Te.FILE_HEADER=[102,105,103,45,107,105,119,105],Te.CHUNK_TAG_LEN=8,Te.THUMBNAIL_CHUNK_TAG=[137,80,78,71,13,10,26,10];var It=Te;(t=>{let i;(o=>(o[o.THUMBNAIL=0]="THUMBNAIL",o[o.UNKNOWN=1]="UNKNOWN"))(i=t.ChunkType||(t.ChunkType={}));class e{constructor(n){this.timeSpentApplyingMessageToSceneMs=n}}t.TimingInfo=e})(It||(It={}));var qn;(n=>{function i(o,a){return o==a?!0:o==26?a==71||a==70:!1}n.affects=i;function e(o){return o==59||o==60||o==52||o==53||o==91||o==92||o==4||o==5}n.affectsImagesUsedByNode=e;function t(o){switch(o){case 98:case 25:case 8:case 26:case 70:case 48:case 16:case 29:case 34:case 65:case 66:case 81:case 69:case 83:case 35:case 46:case 71:case 17:case 47:case 27:case 30:case 31:case 57:case 32:case 67:return!0}return!1}n.isPrototypeStructuralChange=t;function r(o){switch(o){case 29:case 16:case 48:case 79:case 82:case 71:case 27:case 46:case 28:case 47:case 18:case 26:case 70:case 57:case 30:case 17:case 4:case 5:return!0}return!1}n.isInteractionProperty=r})(qn||(qn={}));function Ob(i,e){switch(e){case 22:return ke().BlendMode[i];case 26:return ke().ConnectionType[i];case 20:return ke().ConstraintType[i];case 21:return ke().ConstraintType[i];case 28:return ke().EasingType[i];case 29:return ke().InteractionType[i];case 30:return ke().NavigationType[i];case 32:return ke().OverlayBackgroundInteraction[i];case 34:return ke().ScrollDirection[i];case 31:return ke().OverlayPositionType[i];case 98:return ke().NodePhase[i];case 35:return ke().ScrollBehavior[i];case 84:return ke().ShapeWithTextType[i];case 77:return ke().StackMode[i];case 23:return ke().StrokeAlign[i];case 33:return ke().StyleType[i];case 1:return ke().TextAlignHorizontal[i];case 2:return ke().TextAlignVertical[i];case 27:return ke().TransitionType[i];case 19:return ke().NodeType[i];default:throw new Error(`Given field ${wt[e]} is not a string enum field`)}}function cp(i,e,t){switch(Hs(t)){case 0:return i.getBool(e,t);case 1:return i.getDouble(e,t);case 2:return i.getInt(e,t);case 3:return i.getString(e,t);case 4:return Ob(i.getInt(e,t),t);case 5:return i.getAffineTransform(e,t);case 6:return i.getArcData(e,t);case 7:return i.getGUID(e,t);case 8:return i.getStyleId(e,t);case 10:return i.getVector(e,t);case 11:return i.getEffectList(e);case 12:return i.getPaintList(e,t);case 15:return i.getParentIndex(e);case 13:case 9:case 19:case 17:case 16:case 18:case 24:case 25:case 26:return i.getField(e,t);case 20:case 23:return null;case 14:case 21:case 22:case 27:return null;default:return Le(`Unhandled node field ${wt[t]} in getCppNodeValue`),null}}function wb(i,e,t,r,n){switch(Hs(r)){case 0:return i.getBool_SGEO(n);case 1:return i.getDouble_SGEO(n);case 2:return i.getInt_SGEO(n,r);case 3:return i.getString_SGEO(n);case 4:return Ob(i.getInt_SGEO(n,r),r);case 5:return i.getAffineTransform_SGEO(n);case 6:return i.getArcData_SGEO(n);case 7:return i.getGUID_SGEO(n);case 8:return i.getStyleId_SGEO(n);case 10:return i.getVector_SGEO(n);case 11:return i.getEffectList_SGEO(n);case 12:return i.getPaintList_SGEO(n);case 15:return i.getParentIndex_SGEO(n);case 13:return i.getPrototypeInteractions_SGEO(n);case 9:case 19:case 17:case 16:case 18:case 24:case 25:case 26:return i.getField_SGEO(n);case 20:case 23:return null;case 14:case 21:case 22:case 27:return null;default:return Le(`Unhandled node field ${wt[r]} in getCppSGEOValue`),null}}function Ii(i,e,t,r){let n=It.serializeValueToKiwiForTests1(t,r),o=n.a,a=n.b;o.guid=It.encodeGUID(e.id()),Pu(o,a)}var Rc=class{constructor(e){this._imagesByNodeId=null,this._nodeIdsByImage=null,e.addAppObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage=new Gn(t=>t.objectHash())}imagesUsedByNode(e){return He.StringMap_get(this._imagesByNodeId,e,new Map)}nodesUsedByImage(e){return Array.from(this._nodeIdsByImage.get(e,new Map).values())}nodesThatUseAnImage(){return Array.from(this._imagesByNodeId.keys())}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage.clear(),t!=null&&this._addImageNodeReferencesInSubtree(t.root())}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_trackImageUse(e,t){this._imagesByNodeId.has(e.id())||this._imagesByNodeId.set(e.id(),new Map),this._imagesByNodeId.get(e.id()).set(t.objectHash(),t),this._nodeIdsByImage._in(t)||this._nodeIdsByImage.set(t,new Map),this._nodeIdsByImage.get(t).set(e.id(),e.id())}_removeImageUse(e,t){Array.from(this._imagesByNodeId.keys()).indexOf(e.id())!=-1&&(this._imagesByNodeId.get(e.id()).delete(t.objectHash()),this._imagesByNodeId.get(e.id()).size==0&&this._imagesByNodeId.delete(e.id())),this._nodeIdsByImage._in(t)&&(this._nodeIdsByImage.get(t).delete(e.id()),this._nodeIdsByImage.get(t).size==0&&this._nodeIdsByImage.remove(t))}handleSceneGraphEvent(e){let t=qn.affectsImagesUsedByNode(e.property);if(!(!(t||e.property==8||e.property==25)||!(e.node.isVisibleInCanvas()||e.property==8&&nt.asBool(e.oldVal)&&!nt.asBool(e.newVal)&&(e.node.parent()!=null&&e.node.parent().isVisibleInCanvas())))){if(t){let n=e.node.collectUniqueUsedImages(),o=He.StringMap_get(this._imagesByNodeId,e.node.id(),new Map);for(let a of Array.from(o.keys()))n.has(a)||this._removeImageUse(e.node,o.get(a));for(let a of Array.from(n.keys()))o.has(a)||this._trackImageUse(e.node,n.get(a))}else if(e.property==8){let n=nt.asBool(e.oldVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1),o=nt.asBool(e.newVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1);!n&&o?this._addImageNodeReferencesInSubtree(e.node):n&&!o&&this._removeImageNodeReferencesInSubtree(e.node)}else if(e.property==25){let n=e.oldVal!=null&&nt.isParentIndex(e.oldVal)?nt.asParentIndex(e.oldVal):null,o=e.newVal!=null&&nt.isParentIndex(e.newVal)?nt.asParentIndex(e.newVal):null,a=n!=null?e.node.scene().findNode(n.id):null,s=o!=null?e.node.scene().findNode(o.id):null,l=a!=null&&a.isRooted(),c=s!=null&&s.isRooted();l&&!c?this._removeImageNodeReferencesInSubtree(e.node):!l&&c&&this._addImageNodeReferencesInSubtree(e.node)}}}_removeImageNodeReferencesInSubtree(e){for(let t=0,r=e.childCount();t<r;t=t+1)this._removeImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._removeImageUse(e,t.image()),t.imageThumbnail()!=null&&this._removeImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._removeImageUse(e,t)})}_addImageNodeReferencesInSubtree(e){if(e.visible()){for(let t=0,r=e.childCount();t<r;t=t+1)this._addImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._trackImageUse(e,t.image()),t.imageThumbnail()!=null&&this._trackImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._trackImageUse(e,t)})}}};var dp=class{clear(){this._images=[],this._imageByHash=new Map}allImages(){return this._images}appendIfMissing(e){this._imageByHash.has(e.objectHash())||(this._imageByHash.set(e.objectHash(),e),this._images.push(e))}count(){return this._images.length}isEmpty(){return this.count()==0}takeFirst(){let e=this._images.shift();return this._imageByHash.delete(e.objectHash()),e}constructor(){this._images=[],this._imageByHash=new Map}};var up=class{constructor(e,t,r,n){this._loadType=null,this._delaySeconds=0,this._startCondition=null,this._endCondition=null,this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0,this._numGIFs=0,this._loadType=e,this._delaySeconds=t,this._startCondition=r,this._endCondition=n}reset(){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0}_hasMetStartCondition(){return this._startConditionSeconds>=0}_hasMetEndCondition(){return this._endConditionSeconds>=0}onFrame(){!this._hasMetStartCondition()&&this._startCondition()&&(this._startConditionSeconds=We.seconds()),this._hasMetStartCondition()&&!this._hasMetEndCondition()&&this._endCondition()&&(this._endConditionSeconds=We.seconds()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&We.seconds()-this._endConditionSeconds>=this._delaySeconds&&(this.trackEvent(),this.reset()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&!this._endCondition()&&(this._endConditionSeconds=-1)}trackSuccess(e){this._hasMetStartCondition()&&(this._numSuccesses=this._numSuccesses+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackFailure(e){this._hasMetStartCondition()&&(this._numFailures=this._numFailures+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackEvent(){De.trackEvent("images_loaded",{viewer_mode:X.getViewerMode(),load_type:this._loadType,num_successes:this._numSuccesses,num_failures:this._numFailures,num_gifs:this._numGIFs,duration_s:this._endConditionSeconds-this._startConditionSeconds,fast_image_decode:Mr.browserSupportsFastImageDecoding()},{forwardToDatadog:!0})}};var pp=class i{delayBetweenInvalidations(){return Vn||Oi?0:2}constructor(e,t){this._scene=null,this._appState=null,this._prototypeStructure=null,this._previousFileKey="",this._imageResources=new Map,this._emojiResources=new Map,this._imageUseTracker=null,this.MAX_SIMULTANEOUS_PRELOADING=4,this._imageQueue=new yu,this._outboundRequestPriorities=new Map,this._thumbLoadTracker=null,this._fullsizeImageLoadTracker=null,this._requestsInFlight=0,this._needsUpdate=!1,this._needAllThumbnails=!0,this._newlyLoadedImages=new dp,this._topLevelGuidsNeeded=new ln,this.onImageLoaded=null,this.lastImageLoadedCallbackTime=0,this._pendingRequestSuccessForImage=new Map,this._pendingRequestFailureForImage=new Map,this._shouldInvestigateNextImageFailure=!0,this._showImageFetchFailureUI=null,_o()!==null&&!_o().getImageMemoryStats&&(_o().getImageMemoryStats=()=>{let n=Cr.getMax("WEBGL_TEXTURE (Image)"),o=Cr.getMax("Decoded image data in RAM (MB)");return{vramMaxForImages:n,ramMaxForImages:o}},_o().getNumRequestsInFlight=()=>this._requestsInFlight),this._imageUseTracker=new Rc(e),this._appState=e,this._prototypeStructure=e.prototypeStructure(),this._showImageFetchFailureUI=t,e.addAppObserver(this),e.addFrameObserver(this),e.prototypeState().addObserver(this);let r=2==0?0:2.5;this._thumbLoadTracker=new up("thumbs_loaded",r,()=>this._computeTopImagePriority().type==4,()=>this._computeTopImagePriority().type<4),this._fullsizeImageLoadTracker=new up("fullsize_images_loaded",r,()=>this._computeTopImagePriority().type>=3,()=>this._computeTopImagePriority().type<3)}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){var t,r;if(hn.advanceGeneration(),e.oldStateId()==null&&this._onTransitionGraphChange(),this._restartGIFsOnEnteringScreens(e),this.clearUnneededTextures(e),this._needAllThumbnails){let n=(r=(t=this._scene)==null?void 0:t.findNode(e.newStateId()))==null?void 0:r.canvas();this.preloadAllThumbnails(n)}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}clearQueuesAndDecodedDataForAllImages(e){this._imageQueue.clear(),this._clearDecodedDataForAllImagesRecursive(e)}_clearDecodedDataForAllImagesRecursive(e){if(e!=null){this.clearDecodedDataForAllImages(e);for(let t=0,r=e.childCount();t<r;t=t+1){let n=e.childAt1(t);this._clearDecodedDataForAllImagesRecursive(n)}}}clearDecodedDataForAllImages(e){e.forEachSinglePaint(t=>{if(t.image()==null)return;let r=this._imageUseTracker.nodesUsedByImage(t.image());t.image().freeMemoryForDecodedDataAndTexture()&&r.forEach(n=>{var o;(o=this._scene.findNode(n))==null||o.invalidateRenderTreeForSelfAndParents()})}),e.forEachSinglePaint(t=>{if(t.imageThumbnail()==null)return;let r=this._imageUseTracker.nodesUsedByImage(t.imageThumbnail());t.imageThumbnail().freeMemoryForDecodedDataAndTexture()&&r.forEach(n=>{var o;(o=this._scene.findNode(n))==null||o.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(t=>{let r=this._imageUseTracker.nodesUsedByImage(t);t.freeMemoryForDecodedDataAndTexture()&&r.forEach(n=>{var o;(o=this._scene.findNode(n))==null||o.invalidateRenderTreeForSelfAndParents()})})}clearQueuesAndDecodedDataForFullResolutionImages(e){this._imageQueue.clear();let t=this._appState.currentFileKey();e!=null&&this._previousFileKey!=null&&this._previousFileKey.length>1&&t!=this._previousFileKey&&this._clearDecodedDataForFullResolutionImagesRecursive(e),this._previousFileKey=t}_clearDecodedDataForFullResolutionImagesRecursive(e){if(e!=null){this.clearDecodedDataForFullResolutionImages(e);for(let t=0,r=e.childCount();t<r;t=t+1){let n=e.childAt1(t);this._clearDecodedDataForFullResolutionImagesRecursive(n)}}}clearDecodedDataForFullResolutionImages(e){e.forEachSinglePaint(t=>{var n;if(t.image()==null)return;let r=this._imageUseTracker.nodesUsedByImage(t.image());if(!(t.imageThumbnail()!=null&&t.image().objectHash()==t.imageThumbnail().objectHash())){for(let o of r){let a=(n=this._scene.findNode(o))==null?void 0:n.topLevelAncestor();if(a!=null&&this._topLevelGuidsNeeded._in(a.id()))return}t.image().freeMemoryForDecodedDataAndTexture()&&r.forEach(o=>{var a;(a=this._scene.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})}}),e.forEachEmojiInTextData(t=>{var n;let r=this._imageUseTracker.nodesUsedByImage(t);for(let o of r){let a=(n=this._scene.findNode(o))==null?void 0:n.topLevelAncestor();if(a!=null&&this._topLevelGuidsNeeded._in(a.id()))return}t.freeMemoryForDecodedDataAndTexture()&&r.forEach(o=>{var a;(a=this._scene.findNode(o))==null||a.invalidateRenderTreeForSelfAndParents()})})}_restartGIFsOnEnteringScreens(e){var n;if(e.newStateId()!=null&&e.newStateId()!=e.oldStateId()){let o=(n=this._scene)==null?void 0:n.findNode(e.newStateId());o!=null&&this._restartGIFsInSubtree(o)}let t=e.newOverlayData(),r=e.oldOverlayData();for(let o=0,a=t.length;o<a;o=o+1)if(o>=r.length||r[o].id!=t[o].id){let s=this._scene.findNode(t[o].id);s!=null&&this._restartGIFsInSubtree(s)}}_restartGIFsInSubtree(e){e.restartGifs(),e.forEachChild(t=>{this._restartGIFsInSubtree(t)})}clearUnneededTextures(e){if(this._scene!=null&&this._appState.baseScreenId()!=null){this._topLevelGuidsNeeded=new ln,this._prototypeStructure.getPrerenderingJobs(null).forEach(t=>{let r=t.asScreen();r!=null&&this._topLevelGuidsNeeded.add(r.nodeId)}),e.oldStateId()!=null&&this._topLevelGuidsNeeded.add(e.oldStateId()),e.newStateId()!=null&&this._topLevelGuidsNeeded.add(e.newStateId());for(let t of this._imageUseTracker.nodesThatUseAnImage()){let r=this._scene.findNode(J.fromString(t));if(r==null)continue;let n=r.topLevelAncestor();n!=null&&this._topLevelGuidsNeeded._in(n.id())||this.clearDecodedDataForFullResolutionImages(r)}}}handleSceneChange(e,t){e!=null&&this.clearQueuesAndDecodedDataForFullResolutionImages(e.root()),this._scene=t,this._needAllThumbnails=!0,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._onTransitionGraphChange()}preloadAllThumbnails(e){this._scene==null||e==null||(He.StringMap_each(i.getThumbnailsInSubtree(e),(t,r)=>{this._imageQueue.insertOrUpdate(r,hn.OTHER)}),this._needAllThumbnails=!1)}handleActiveCanvasChange(e,t){this.clearQueuesAndDecodedDataForFullResolutionImages(e),this.preloadAllThumbnails(t)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.property==71||e.property==69||e.property==25)&&this._onTransitionGraphChange()}resetForRenderingTests(){this._imageQueue.clear(),this._newlyLoadedImages.clear(),this.lastImageLoadedCallbackTime=0}onFrame(){this._needsUpdate&&this._traverseSceneForImages(),!this._newlyLoadedImages.isEmpty()&&We.seconds()-this.lastImageLoadedCallbackTime>=this.delayBetweenInvalidations()&&(this.lastImageLoadedCallbackTime=We.seconds(),this._onImagesLoaded()),this._thumbLoadTracker.onFrame(),this._fullsizeImageLoadTracker.onFrame(),this._needsUpdate=!1}_computeTopImagePriority(){let e=hn.OTHER;this._imageQueue.count()>0&&(e=hn.max(e,this._imageQueue.maxPriority().value));for(let t of Array.from(this._outboundRequestPriorities.values()))e=hn.max(e,t);return e}findImageByHexHash(e,t){return t==0?He.StringMap_get(this._emojiResources,e,null):He.StringMap_get(this._imageResources,e,null)}onNewImage(e,t,r){let n=t==0?this._emojiResources:this._imageResources;n.has(e)||(n.set(e,r),this._appState.baseScreenId()==null)||(this._imageQueue.insertOrUpdate(r,hn.OTHER),this._processNextItemFromRenderQueues())}requestImageForRendering(e,t){this._imageQueue.insertOrUpdate(e,t),this._processNextItemFromRenderQueues()}_onImagesLoaded(){if(this.onImageLoaded!=null){if(this._scene!=null)for(let e=0,t=this._newlyLoadedImages.allImages().length;e<t;e=e+1){let r=this._newlyLoadedImages.allImages()[e];for(let n of this._imageUseTracker.nodesUsedByImage(r)){let o=this._scene.findNode(n);o!=null&&this.onImageLoaded(o)}}this._newlyLoadedImages.clear()}}_onTransitionGraphChange(){this._needsUpdate=!0}_traverseSceneForImages(){let e=this._appState.baseScreenId();this._scene!=null&&e!=null&&this._processNextItemFromRenderQueues()}postMessageToPerfTests(e){_o().figmaPerfTesting&&_o().postMessage({name:e,value:0},"*")}incrementRequestsInFlight(e){this._requestsInFlight=this._requestsInFlight+e,Cr.trackNumber("Image requests in flight",this._requestsInFlight),this._requestsInFlight==0&&this.postMessageToPerfTests("IMAGES_FINISHED_LOADING")}_requestImage(e,t,r,n){this._pendingRequestSuccessForImage.has(e.objectHash())||this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestSuccessForImage.get(e.objectHash()).push(r),this._pendingRequestFailureForImage.has(e.objectHash())||this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.get(e.objectHash()).push(n),e!=null&&e.state()==1&&this._processNextItemFromRenderQueues(),this._outboundRequestPriorities.set(e.objectHash(),hn.max(t,He.StringMap_get(this._outboundRequestPriorities,e.objectHash(),hn.OTHER))),this.incrementRequestsInFlight(1),e.fetchAndDecode(1,o=>{this._thumbLoadTracker.trackSuccess(e.imageType()),this._fullsizeImageLoadTracker.trackSuccess(e.imageType()),this.incrementRequestsInFlight(-1),this._newlyLoadedImages.appendIfMissing(e);for(let a of this._pendingRequestSuccessForImage.get(e.objectHash()))a(o);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash()),this._processNextItemFromRenderQueues()},o=>{if((ua.ImagePriorityType_isOnScreen(t.type)||ua.ImagePriorityType_isPrerender(t.type))&&o==0&&this._shouldInvestigateNextImageFailure){this._shouldInvestigateNextImageFailure=!1;let s=l=>{l==0?(this._showImageFetchFailureUI(),De.trackEvent("show_image_failure_ui",{imagePriority:cc[t.type]})):this._shouldInvestigateNextImageFailure=!0};new Zn(e.url()).get().then(l=>{s(l.status)},l=>{s(l.status)})}this._thumbLoadTracker.trackFailure(e.imageType()),this._fullsizeImageLoadTracker.trackFailure(e.imageType()),this.incrementRequestsInFlight(-1),this._processNextItemFromRenderQueues();for(let s of this._pendingRequestFailureForImage.get(e.objectHash()))s(t);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash())})}_processNextItemFromRenderQueues(){if(this._requestsInFlight>=this.MAX_SIMULTANEOUS_PRELOADING||this._imageQueue.count()==0)return;let e=this._imageQueue.peek(),t=this._imageQueue.getPriority(e);this._imageQueue.remove(e),this._requestImage(e,t.value,r=>{},r=>{if(r.type==2||r.type==4)for(let o of this._imageUseTracker.nodesUsedByImage(e)){let a=this._scene.findNode(o);a!=null&&a.forEachSinglePaint(s=>{let l=s.imageThumbnail()!=null&&s.imageThumbnail().objectHash()==e.objectHash(),c=s.imageThumbnail()!=null&&s.image()!=null&&s.image().objectHash()==s.imageThumbnail().objectHash();if(l&&!c&&s.image()!=null){let d=e!=null?e.objectHash():null,h=s.image()!=null?s.image().objectHash():null;console.warn(`Failed to fetch thumbnail ${d}; fetching full size image ${h}`);let u=r.type==2?hn.forType(1):r.type==4?hn.forType(3):hn.OTHER;this.requestImageForRendering(s.image(),u)}})}})}hasPendingImages(){return this._needsUpdate||this._requestsInFlight>0||ua.ImagePriorityType_isOnScreen(this._computeTopImagePriority().type)||!this._newlyLoadedImages.isEmpty()}static getThumbnailsInSubtree(e){let t=new Map,r=new Map;return i._getImagesInSubtree(e,t,r),r}static _getImagesInSubtree(e,t,r){e.forEachSinglePaint(n=>{n.image()!=null&&t.set(n.image().objectHash(),n.image()),n.imageThumbnail()!=null&&r.set(n.imageThumbnail().objectHash(),n.imageThumbnail())}),e.forEachEmojiInTextData(n=>{r.set(n.objectHash(),n)});for(let n=0,o=e.childCount();n<o;n=n+1){let a=e.childAt1(n);i._getImagesInSubtree(a,t,r)}}};var Pn;(t=>{function i(r){return r!=-1}t.WeakHandle_isValid=i;function e(r){return r}t.WeakHandle_toInt=e})(Pn||(Pn={}));var hp=class{textAlignHorizontal(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getTextAlignHorizontal(2);return ke().TextAlignHorizontal[e]}setTextAlignHorizontal(e){L().prepareCppNodeForAccess(this);let t=ke().TextAlignHorizontal[e];L().nodeTsApiGenerated().setTextAlignHorizontal(t,2)}textAlignVertical(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getTextAlignVertical(2);return ke().TextAlignVertical[e]}setTextAlignVertical(e){L().prepareCppNodeForAccess(this);let t=ke().TextAlignVertical[e];L().nodeTsApiGenerated().setTextAlignVertical(t,2)}fontSize(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getFontSize(2)}setFontSize(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setFontSize(t,2)}visible(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getVisible(2)}setVisible(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setVisible(t,2)}isBackgroundEnabled(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getBackgroundEnabled(2)}setIsBackgroundEnabled(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setBackgroundEnabled(t,2)}isMask(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getIsMask(2)}setIsMask(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setIsMask(t,2)}isMaskOutline_DEPRECATED(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getIsMaskOutline_DEPRECATED(2)}setIsMaskOutline_DEPRECATED(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setIsMaskOutline_DEPRECATED(t,2)}isInternalOnly(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getIsInternalOnly(2)}setIsInternalOnly(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setIsInternalOnly(t,2)}isFrameMaskDisabled(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getIsFrameClippingDisabled(2)}setIsFrameMaskDisabled(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setIsFrameClippingDisabled(t,2)}isResizeToFit(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getResizeToFit(2)}setIsResizeToFit(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setResizeToFit(t,2)}rectangleCornerRadiiIndependent(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getRectangleCornerRadiiIndependent(2)}setRectangleCornerRadiiIndependent(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setRectangleCornerRadiiIndependent(t,2)}horizontalConstraint(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getHorizontalConstraint(2);return ke().ConstraintType[e]}setHorizontalConstraint(e){L().prepareCppNodeForAccess(this);let t=ke().ConstraintType[e];L().nodeTsApiGenerated().setHorizontalConstraint(t,2)}verticalConstraint(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getVerticalConstraint(2);return ke().ConstraintType[e]}setVerticalConstraint(e){L().prepareCppNodeForAccess(this);let t=ke().ConstraintType[e];L().nodeTsApiGenerated().setVerticalConstraint(t,2)}blendMode(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getBlendMode(2);return ke().BlendMode[e]}setBlendMode(e){L().prepareCppNodeForAccess(this);let t=ke().BlendMode[e];L().nodeTsApiGenerated().setBlendMode(t,2)}strokeAlign(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getStrokeAlign(2);return ke().StrokeAlign[e]}setStrokeAlign(e){L().prepareCppNodeForAccess(this);let t=ke().StrokeAlign[e];L().nodeTsApiGenerated().setStrokeAlign(t,2)}overlayPositionType(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getOverlayPositionType(2);return ke().OverlayPositionType[e]}setOverlayPositionType(e){L().prepareCppNodeForAccess(this);let t=ke().OverlayPositionType[e];L().nodeTsApiGenerated().setOverlayPositionType(t,2)}overlayBackgroundInteraction(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getOverlayBackgroundInteraction(2);return ke().OverlayBackgroundInteraction[e]}setOverlayBackgroundInteraction(e){L().prepareCppNodeForAccess(this);let t=ke().OverlayBackgroundInteraction[e];L().nodeTsApiGenerated().setOverlayBackgroundInteraction(t,2)}styleType(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getStyleType(2);return ke().StyleType[e]}setStyleType(e){L().prepareCppNodeForAccess(this);let t=ke().StyleType[e];L().nodeTsApiGenerated().setStyleType(t,2)}overflowDirection(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getOverflowDirection(2);return ke().ScrollDirection[e]}setOverflowDirection(e){L().prepareCppNodeForAccess(this);let t=ke().ScrollDirection[e];L().nodeTsApiGenerated().setOverflowDirection(t,2)}scrollBehavior(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getScrollBehavior(2);return ke().ScrollBehavior[e]}setScrollBehavior(e){L().prepareCppNodeForAccess(this);let t=ke().ScrollBehavior[e];L().nodeTsApiGenerated().setScrollBehavior(t,2)}maskType(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getMaskType(2);return ke().MaskType[e]}setMaskType(e){L().prepareCppNodeForAccess(this);let t=ke().MaskType[e];L().nodeTsApiGenerated().setMaskType(t,2)}opacity(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getOpacity(2)}setOpacity(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setOpacity(t,2)}backgroundOpacity(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getBackgroundOpacity(2)}setBackgroundOpacity(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setBackgroundOpacity(t,2)}rectangleTopLeftCornerRadius(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getRectangleTopLeftCornerRadius(2)}setRectangleTopLeftCornerRadius(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setRectangleTopLeftCornerRadius(t,2)}rectangleTopRightCornerRadius(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getRectangleTopRightCornerRadius(2)}setRectangleTopRightCornerRadius(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setRectangleTopRightCornerRadius(t,2)}rectangleBottomLeftCornerRadius(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getRectangleBottomLeftCornerRadius(2)}setRectangleBottomLeftCornerRadius(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setRectangleBottomLeftCornerRadius(t,2)}rectangleBottomRightCornerRadius(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getRectangleBottomRightCornerRadius(2)}setRectangleBottomRightCornerRadius(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setRectangleBottomRightCornerRadius(t,2)}strokeWeight(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getStrokeWeight(2)}setStrokeWeight(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setStrokeWeight(t,2)}cornerRadius(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getCornerRadius(2)}setCornerRadius(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setCornerRadius(t,2)}cornerSmoothing(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getCornerSmoothing(2)}setCornerSmoothing(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setCornerSmoothing(t,2)}overrideKey(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getOverrideKey(2)}setOverrideKey(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setOverrideKey(t,2)}overriddenSymbolID(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getOverriddenSymbolID(2)}stackReverseZIndex(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getStackReverseZIndex(2)}setStackReverseZIndex(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setStackReverseZIndex(t,2)}isStateGroup(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getIsStateGroup(2)}setIsStateGroup(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setIsStateGroup(t,2)}shapeWithTextType(){L().prepareCppNodeForAccess(this);let e=L().nodeTsApiGenerated().getShapeWithTextType(2);return ke().ShapeWithTextType[e]}setShapeWithTextType(e){L().prepareCppNodeForAccess(this);let t=ke().ShapeWithTextType[e];L().nodeTsApiGenerated().setShapeWithTextType(t,2)}usedAsBaseScreen(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getUsedAsBaseScreen(2)}setUsedAsBaseScreen(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setUsedAsBaseScreen(t,2)}hasBeenLoaded(){return L().prepareCppNodeForAccess(this),L().nodeTsApiGenerated().getHasBeenLoaded(2)}setHasBeenLoaded(e){L().prepareCppNodeForAccess(this);let t=e;L().nodeTsApiGenerated().setHasBeenLoaded(t,2)}};var Eg;(e=>{function i(){return new Map}e._new=i})(Eg||(Eg={}));var is=class{toString(){return this.name+" "+this.relativeChildIndex.toString()}toStringWithPrefix(e){let t=e?this.name.split("/")[0]:this.name;return t=t.trim(),t+" "+this.relativeChildIndex.toString()}constructor(e,t){this.name=e,this.relativeChildIndex=t}},mp=class i{getData(e,t){let r=this.getAllDataForNode(e);return r!=null&&r.has(t)?r.get(t):null}getAllDataForNode(e){let t=this.getSubTrie(e);return t!=null?t.cache:null}insert(e,t,r){if(e.length==0){this.cache.set(t,r);return}let n=e[0].toString(),o=e.slice(1,e.length);this.children.has(n)||this.children.set(n,new i),this.children.get(n).insert(o,t,r)}remove(e,t){if(e.length==0){this.cache.delete(t);return}let r=e[0].toString(),n=e.slice(1,e.length);this.children.has(r)||this.children.set(r,new i),this.children.get(r).remove(n,t)}forEach(e){for(let t of Array.from(this.cache.keys()))e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;let t=e[0].toString();return this.children.has(t)?this.children.get(t).getSubTrie(e.slice(1,e.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.cache.keys()))e!=null&&e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).uninitialize2(e),this.children.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this.toStringHelper(e),r="";for(let n of t)r=r+`${n}
`;return r}toStringHelper(e){let t=[];for(let r of Array.from(this.cache.keys()))t.push(e==null?r:`${r}: ${e(this.cache.get(r))}`);for(let r of Array.from(this.children.keys())){let n=this.children.get(r).toStringHelper(e);for(let o of n)t.push(`${r}/${o}`)}return t}constructor(){this.cache=Eg._new(),this.children=new Map}},ya=class{getData(e,t){if(e.length==0)return null;let r=this._getSSTDataCacheFromLowerNodeStorage(e);return r!=null&&r.has(t)?r.get(t):null}getAllDataForNode(e){return e.length==0?null:this._getSSTDataCacheFromLowerNodeStorage(e)}_getSSTDataCacheFromTLFStorage(e){let t=e[0].toString();return this.tlfNodeStorage.has(t)?this.tlfNodeStorage.get(t).getAllDataForNode([]):null}_getSSTDataCacheFromLowerNodeStorage(e){let t=this._getFirstNodeName(e);return this.lowerNodeStorage.has(t)?this.lowerNodeStorage.get(t).getAllDataForNode(e.slice(1,e.length)):null}insert(e,t,r){e.length!=0&&this._insertIntoLowerNodeStorage(e,t,r)}remove(e,t){e.length!=0&&this._deleteFromLowerNodeStorage(e,t)}_deleteFromTLFStorage(e,t){let r=e[0].toString();this.tlfNodeStorage.has(r)&&this.tlfNodeStorage.get(r).remove(e.slice(1,e.length),t)}_deleteFromLowerNodeStorage(e,t){let r=this._getFirstNodeName(e);this.lowerNodeStorage.has(r)&&this.lowerNodeStorage.get(r).remove(e.slice(1,e.length),t)}_insertIntoTLFStorage(e,t,r){let n=e[0].toString();this.tlfNodeStorage.has(n)||this.tlfNodeStorage.set(n,new mp),this.tlfNodeStorage.get(n).insert(e.slice(1,e.length),t,r)}_insertIntoLowerNodeStorage(e,t,r){let n=this._getFirstNodeName(e);this.lowerNodeStorage.has(n)||this.lowerNodeStorage.set(n,new mp),this.lowerNodeStorage.get(n).insert(e.slice(1,e.length),t,r)}forEach(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).forEach(e);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;let t=e,r=this._getFirstNodeName(t);return this.lowerNodeStorage.has(r)?this.lowerNodeStorage.get(r).getSubTrie(t.slice(1,t.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).uninitialize2(e),this.tlfNodeStorage.delete(t);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).uninitialize2(e),this.lowerNodeStorage.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this._toStringHelper(e),r="";for(let n of t)r=r+`${n}
`;return r}_toStringHelper(e){let t=[];for(let r of Array.from(this.lowerNodeStorage.keys())){let n=this.lowerNodeStorage.get(r).toStringHelper(e);for(let o of n)t.push(`*/${r}/${o}`)}for(let r of Array.from(this.tlfNodeStorage.keys())){let n=this.tlfNodeStorage.get(r).toStringHelper(e);for(let o of n)t.push(`[TLF]/${r}/${o}`)}return t}_getFirstNodeName(e){return e.length==1?e[0].toStringWithPrefix(!0):Cg.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING}constructor(){this.lowerNodeStorage=new Map,this.tlfNodeStorage=new Map}},vr;(l=>{function i(){l._cachedNodePaths.clear()}l.clearCachedNodePaths=i;function e(c){if(c==null)return[];if(l._cachedNodePaths.has(c.uniqueIdentifier()))return l._cachedNodePaths.get(c.uniqueIdentifier());let d=c.getSemanticNodePath();return l._cachedNodePaths.set(c.uniqueIdentifier(),d),d}l.getSemanticNodePath=e;function t(c){return c.type()=="FRAME"||c.type()=="INSTANCE"}l._isValidTLFType=t;function r(c){return c.isTopLevel()&&t(c)}l._isValidSemanticTLF=r;function n(c){if(c.isTopLevel()&&!t(c))return[];let d=[],h=!0;for(let u=c.clone();h&&u!=null;u=u.parent())d.splice(0,0,new is(u.name(),o(u))),r(u)&&(h=!1);return d}l.getSemanticNodePathHelper=n;function o(c){if(r(c)||c.parent()==null)return 0;let d=c.parent().clone(),h=[],u=d.childCount();for(let m=0;m<u;m=m+1){let g=d.clone();g.moveToChildAt(m),g.name()==c.name()&&h.push(g.uniqueIdentifier())}return h.indexOf(c.uniqueIdentifier())}l.getRelativeChildIndex=o,l.DEFAULT_STORAGE_KEY="storage_key",l._cachedNodePaths=new Map})(vr||(vr={}));var Pb;(l=>{function i(c){return c}l.SSTDataCache_asMap=i;function e(c){return Array.from(c.keys())}l.SSTDataCache_keys=e;function t(c,d){return c.has(d)}l.SSTDataCache_has=t;function r(c){return c.size}l.SSTDataCache_size=r;function n(c,d){c.delete(d)}l.remove=n;function o(c,d){return c.get(d)}l.SSTDataCache_get=o;function a(c,d,h){c.set(d,h)}l.SSTDataCache_set=a;function s(c,d){c.forEach(d)}l.SSTDataCache_forEach=s})(Pb||(Pb={}));var Cg;(e=>e.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING="TLF Placeholder")(Cg||(Cg={}));var Kt=class i{constructor(e,t=null){this.node=e,this._overlayRenderData=t}clone(){return new i(this.node,this.overlayRenderData())}setNode(e){this.node=e}moveToChildAt(e){this.node=this.node.childAt2(e,!0)}moveToParent(){this.node=this.node.parent()}isRoot(){return this.node.parent()==null}indexInParent(){return this.node.indexInParent()}renderableContentType(){switch(this.node.type()){case"NONE":case"DOCUMENT":case"SLICE":case"INTERACTIVE_SLIDE_ELEMENT":return Ar.RenderableContentType.NON_RENDERABLE;case"CANVAS":case"GROUP":case"FRAME":case"SYMBOL":case"INSTANCE":case"STICKY":case"CODE_BLOCK":case"MEDIA":case"SECTION_OVERLAY":case"WIDGET":case"SHAPE_WITH_TEXT":case"CONNECTOR":case"SECTION":case"TABLE":case"TABLE_CELL":case"SLIDE":return Ar.RenderableContentType.RENDERABLE_GROUP;case"BOOLEAN_OPERATION":case"ELLIPSE":case"LINE":case"RECTANGLE":case"REGULAR_POLYGON":case"ROUNDED_RECTANGLE":case"STAR":case"VECTOR":case"HIGHLIGHT":case"STAMP":case"WASHI_TAPE":return Ar.RenderableContentType.RENDERABLE_GEOMETRY;case"TEXT":return Ar.RenderableContentType.RENDERABLE_TEXT}return Le("Unhandled scene node type while getting cursor renderable content type"),Ar.RenderableContentType.NON_RENDERABLE}isFrameLike(){return ir.isFrameLike(this.type())}isTopLevel(){return this.node.isTopLevel()}willChange(){return 0}shouldOptimizeShadowForAnimation(e){return!1}paintsDebugString(){return`SceneCursor ${this.node.paintsDebugString()}`}customRenderTree(e){return null}name(){return this.node.name()}scene(){return this.node.scene()}parent(){return this.node.parent()!=null?new i(this.node.parent()):null}blendMode(){return this.node.blendMode()}opacity(){return this.node.opacity()}visible(){return this.node.visible()}isVisibleMask(){return this.node.visible()&&this.node.isMask()}maskType(){return this.node.maskType()}isSpreadEligibleNode(){return this.node.isSpreadEligibleNode()}type(){return this.node.type()}childCount(){return this.node.childCount()}absoluteTransform(){return this.node!=null?this.node.absoluteTransform():Nt.FrozenAffineTransform_IDENTITY}maxTransformScale(){return 1}clipsChildren(){return this.node.clipsToBoundingRectangle()}stopsMaskPropagation(){return this.node.isMask()||this.node.clipsToBoundingRectangle()}arcData(){return this.node.arcData()}roundedRectInfo(){return this.node.roundedRectInfo()}fillGeometry(){return this.node.fillGeometry()}strokeGeometry(){return this.node.strokeGeometry()}fillGeometryForSpread(e,t,r){return this.node.fillGeometryForSpread(e,t,r)}strokeGeometryForSpread(e,t,r,n){return this.node.strokeGeometryForSpread(e,t,r,n)}size(){return this.node.size()}strokeAlign(){return this.node.strokeAlign()}strokeWeight(){return this.node.strokeWeight()}hasDefaultStrokeParameters(){return this.node.hasDefaultStrokeParameters()}strokeJoin(){return this.node.strokeJoin()}setStrokeJoin(e){this.node.setStrokeJoin(e)}strokeMiterLimit(){return this.node.strokeMiterLimit()}setStrokeMiterLimit(e){this.node.setStrokeMiterLimit(e)}id(){return this.node.id()}uniqueIdentifier(){return this.node.id()}isInsideOutlineMask(){return this.node.isInsideOutlineMask()}textData(){return this.node.textData()}derivedTextData(){return this.node.derivedTextData()}textGeometry(){return this.node.textGeometry()}getCachedRenderTree(){return this.node.getCachedRenderTree()}renderTree(){return this.node.renderTree1()}renderTreeWithoutBackgroundBlurs(){return this.node.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){return this.node.renderTreeForShadowRoot1()}renderTreeForShadowDescendant(){return this.node.renderTreeForShadowDescendant1()}renderTreeForKnockoutShadowRoot(){return this.node.renderTreeForKnockoutShadowRoot1()}renderTreeForKnockoutShadowDescendant(){return this.node.renderTreeForKnockoutShadowDescendant1()}isFixed(){return this.node.isFixed()}isStandardScrolling(){return this.node.isStandardScrolling()}isStickyScrolling(){return this.node.isStickyScrolling()}scrollOffset(){return this.node.scrollOffset()}scrollDirection(){return this.node.scrollDirection()}hasOverflowingContentInScrollDirection(){return this.node.hasOverflowingContentInScrollDirection()}effects(){return this.node.effects()}fillPaints(){return this.node.fillPaints()}strokePaints(){return this.node.strokePaints()}fillPaintsToRender(){return this.node.fillPaintsToRender()}videoPlayback(){return this.node.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this.node.containerSupportsFillStrokeAndCorners()}isGroup(){return this.node.isGroup()}hasNonZeroStrokeWeight(){return this.node.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this.node.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this.node.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this.node.overrideKey()}getSemanticNodePath(){return vr.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this.node.hasBackgroundBlurs()}overlayRenderData(){return this._overlayRenderData}containsIndependentBordersStrokeMask(){return this.node.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,t,r){return this.node.generateStrokeAndStrokeMaskGeometries(e,t,r)}};var ft=class ft extends hp{constructor(t,r,n){super();this._scene=null,this._id=null,this._scrollingLogic=null,this._handle=0,this._cachedType=null,this._absoluteTransform=Nt.FrozenAffineTransform_IDENTITY,this._flags=5,this._cachedChildren=[],this._cachedParent=null,this._isPartOfLoop=!1,this.transitioningFrom=null,this._lastParent=null,this._lazyInteractionsMigrationValue=null,this._cachedCanvasSpaceGeometryBounds=Br.FrozenRect_EMPTY,this._cachedCanvasSpaceRenderedBounds=Br.FrozenRect_EMPTY,this._cachedCanvasSpaceScrollingBounds=Br.FrozenRect_EMPTY,this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._overlayCacheKey=null,this._scene=r,this._id=n,this._scrollingLogic=new au(this),this._handle=t}handle(){return this._handle}updateAfterPropertyChange(t){t==25?(this.updateDirtyFlagsForPropertyChange(t,this._lastParent),this._lastParent=this.parent()):this.updateDirtyFlagsForPropertyChange(t,null),t==19&&(this._cachedType=null)}linkToParent(t,r){t!=null&&(this._cachedParent=t,this._addFlagsToSelfAndChildren(1),t._cachedChildren.splice(r,0,this),this.updateIsRooted())}unlinkFromParent(){this._cachedParent!=null&&(ce.List_removeOne(this._cachedParent._cachedChildren,this),this._cachedParent=null,this.updateIsRooted())}hasOverflowingContentInScrollDirection(){return this._scrollingLogic.hasOverflowingContentInScrollDirection()}scrollsInPreferredDirection(t){return this._scrollingLogic.scrollsInPreferredDirection(t)}scrollAndClipBoundsBySelfAndAncestors(t,r){return this._scrollingLogic.scrollAndClipBoundsBySelfAndAncestors(t,r)}canvasSpaceScrolledBounds(t){return this._scrollingLogic.canvasSpaceScrolledBounds(t)}canvasSpaceScrolledInteractiveBounds(t){return this._scrollingLogic.canvasSpaceScrolledInteractiveBounds(t)}scrollDirection(){return this._scrollingLogic.scrollDirection()}scrollDirectionWithScrollableContent(){return this._scrollingLogic.scrollDirectionWithScrollableContent()}isFixed(){return this._scrollingLogic.isFixed()}isStandardScrolling(){return this._scrollingLogic.isStandardScrolling()}isStickyScrolling(){return this._scrollingLogic.isStickyScrolling()}defaultScrollOffset(){return this._scrollingLogic.defaultScrollOffset()}canvasSpaceContentBounds(){return this._scrollingLogic.canvasSpaceContentBounds()}nodeSpaceScrollableContentBounds(){return this._scrollingLogic.nodeSpaceScrollableContentBounds()}minScrollOffsetX(){return this._scrollingLogic.minScrollOffsetX()}minScrollOffsetY(){return this._scrollingLogic.minScrollOffsetY()}maxScrollOffsetX(){return this._scrollingLogic.maxScrollOffsetX()}maxScrollOffsetY(){return this._scrollingLogic.maxScrollOffsetY()}hasOverflowingContentInXDirection(){return this._scrollingLogic.hasOverflowingContentInXDirection()}hasOverflowingContentInYDirection(){return this._scrollingLogic.hasOverflowingContentInYDirection()}isSpreadEligibleNode(){return ir.isFrameLike(this.type())?this.isFrameBackgroundVisible()&&this.clipsToBoundingRectangle():ir.isRectOrEllipseLike(this.type())}id(){return this._id}isRooted(){return(2&this._flags)!=0}parent(){return this._cachedParent}scene(){return this._scene}isInvisibleOrTransparent(){return!this.visible()||this.opacity()<=0}containerSupportsFillStrokeAndCorners(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().containerSupportsFillStrokeAndCorners(2)}setContainerSupportsFillStrokeAndCorners(t){return L().prepareCppNodeForAccess(this),L().nodeTsApi().setContainerSupportsFillStrokeAndCorners(t,2)}fillPaintsToRender(){return this.containerSupportsFillStrokeAndCorners()?this.fillPaints():this.hasNodeProperty(38)&&this.hasNodeProperty(64)?[te.createSolid(this.computedBackgroundColor(),1)]:Ce.EMPTY}computedBackgroundColor(){return this.isBackgroundEnabled()?C.multiplyOpacity(this.backgroundColor(),this.backgroundOpacity()):C.TRANSPARENT}isInsideOutlineMask(){return this.isMask()&&(this.isMaskOutline_DEPRECATED()||this.maskType()=="OUTLINE")||(this.parent()!=null?this.parent().isInsideOutlineMask():!1)}isOrInSymbol(){return this.type()=="SYMBOL"?!0:this.parent()!=null?this.parent().isOrInSymbol():!1}isStack(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getIsStack(2)}isInstanceSublayer(){return this.stablePath().guids.length>1}isPrimaryInstance(){return this.stablePath().guids.length==1&&this.isInstance()}isState(){return this.type()=="SYMBOL"&&this.parent()!=null&&this.parent().isStateGroup()}isInstance(){return this.type()=="INSTANCE"}isOrInInstance(){return this.isInstanceSublayer()||this.isPrimaryInstance()}isSymbol(){return this.type()=="SYMBOL"}findContainingPrimaryInstance(){return this.isOrInInstance()?this.scene().findNode(this.stablePath().guids[0]):null}getBackingSymbolParent(){var t;return this.isInstance()?(t=this.scene().findNode(this.symbolID()))==null?void 0:t.parent():null}findNearestAncestorOrNull(t){let r=this;for(;r!=null&&r.type()!="CANVAS"&&r.type()!="DOCUMENT";){if(r.type()==t)return r;r=r.parent()}return null}findContainingCanvasOrSelf(){let t=this;for(;t!=null;){if(t.type()=="CANVAS")return t;if(t.parent()==null)break;t=t.parent()}return null}constrainsAnchoredChildren(){return ir.isFrameLike(this.type())&&!this.isResizeToFit()}size(){return this._scrollingLogic.nodeSize()}prototypeDevice(){return X.deviceFramesSupported()?this.storedPrototypeDevice():jr.DEFAULT}findContainingCanvasOrParent(){let t=this.parent();for(;t!=null&&t.type()!="CANVAS"&&t.parent()!=null;)t=t.parent();return t}guidPath(){return L().getOverridePath(this)}stablePath(){return L().getStablePath(this)}removeSelfAndSubtree(){L().prepareCppNodeForAccess(this),L().nodeTsApi().removeSelfAndChildren(2)}type(){if(this._cachedType==null||this._cachedType=="NONE"){L().prepareCppNodeForAccess(this);let t=L().nodeTsApiGenerated().getType(2);this._cachedType=ke().NodeType[t]}return this._cachedType}setType(t){L().prepareCppNodeForAccess(this);let r=ke().NodeType[t];L().nodeTsApiGenerated().setType(r,2)}name(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getName(2)}setName(t){L().prepareCppNodeForAccess(this);let r=L().nodeTsApi().setName(t,2);r!=""&&Le(r)}scrollOffset(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getScrollOffset(2);return new R(t.x,t.y)}setScrollOffset(t){L().prepareCppNodeForAccess(this);let r=L().nodeTsApi().setScrollOffset({x:t.x(),y:t.y()},2);r!=""&&Le(r)}currentViewportSize(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getCurrentViewportSize(2);return new R(t.x,t.y)}setCurrentViewportSize(t){L().prepareCppNodeForAccess(this);let r=L().nodeTsApi().setCurrentViewportSize({x:t.x(),y:t.y()},2);r!=""&&Le(r)}fullSize(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getSize(2);return new R(t.x,t.y)}setSize(t){L().prepareCppNodeForAccess(this);let r=L().nodeTsApi().setSize(t.x(),t.y(),2);r!=""&&Le(r)}relativeTransform(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getRelativeTransform(2);return new ee(t.m00,t.m01,t.m02,t.m10,t.m11,t.m12)}setRelativeTransform(t){this.setRelativeTransform1(t)}setRelativeTransform1(t){L().prepareCppNodeForAccess(this);let r=L().nodeTsApi().setRelativeTransform(t.m00(),t.m01(),t.m02(),t.m10(),t.m11(),t.m12(),2);r!=""&&Le(r)}interactiveSlideConfigData(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getInteractiveSlideConfigData(2)}setInteractiveSlideConfigData(t,r){return L().prepareCppNodeForAccess(this),L().nodeTsApi().setInteractiveSlideConfigData(t,r,2)}interactiveSlideParticipantData(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getInteractiveSlideParticipantData(2)}setInteractiveSlideParticipantData(t,r){return L().prepareCppNodeForAccess(this),L().nodeTsApi().setInteractiveSlideParticipantData(t,r,2)}slideSpeakerNotes(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getSlideSpeakerNotes(2)}slideThumbnailHash(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getSlideThumbnailHash(2)}stackMode(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getStackMode(2);return ke().StackMode[t]}setStackMode(t){L().prepareCppNodeForAccess(this);let r=ke().StackMode[t];L().nodeTsApi().setStackMode(r,2)}arcData(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getArcData(2)}setArcData(t){L().prepareCppNodeForAccess(this);let r=L().nodeTsApi().setArcData(t.startingAngle,t.endingAngle,t.innerRadius,2);r!=""&&Le(r)}backgroundColor(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getBackgroundColor(2);return C.new3(t.red,t.green,t.blue,t.alpha)}setBackgroundColor(t){L().prepareCppNodeForAccess(this);let r=L().nodeTsApi().setBackgroundColor(C.toColorF(t),2);r!=""&&Le(r)}prototypeBackgroundColor(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getPrototypeBackgroundColor(2);return C.fromColorF(t)}setPrototypeBackgroundColor(t){L().prepareCppNodeForAccess(this);let r={red:C.redF(t),green:C.greenF(t),blue:C.blueF(t),alpha:C.alphaF(t)},n=L().nodeTsApi().setPrototypeBackgroundColor(r,2);n!=""&&Le(n)}parentIndex(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getParentIndex(2),r=t.parent;return new Vr(r,t.position)}setParentIndex(t){L().prepareCppNodeForAccess(this);let r={parent:t.id,position:t.position},n=L().nodeTsApi().setParentIndex(r,2);n!=""&&Le(n)}fillPaints(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getFillPaints(2);return Pn.WeakHandle_isValid(t)?L().modules().paintData_Internal.getOrCreateSkewCopy(t):[]}getBoundVariables(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getBoundVariables(2)}getResolvedVariableModes(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getResolvedVariableModes(2)}getResolvedVariableModesWithSetKeys(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getResolvedVariableModesWithSetKeys(2)}getExplicitVariableModes(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getExplicitVariableModes(2)}getExplicitVariableModesWithSetKeys(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getExplicitVariableModesWithSetKeys(2)}setExplicitVariableModeForCollection(t,r){return L().prepareCppNodeForAccess(this),L().nodeTsApi().setExplicitVariableModeForCollection(t,r,2)}setExplicitVariableModeForCollectionWithSetKey(t,r){return L().prepareCppNodeForAccess(this),L().nodeTsApi().setExplicitVariableModeForCollectionWithSetKey(t,r,2)}clearExplicitVariableConsumerModeForCollection(t){return L().prepareCppNodeForAccess(this),L().nodeTsApi().clearExplicitVariableConsumerModeForCollection(t,2)}clearExplicitVariableConsumerModeForCollectionWithSetKey(t){return L().prepareCppNodeForAccess(this),L().nodeTsApi().clearExplicitVariableConsumerModeForCollectionWithSetKey(t,2)}setTestOnlyFillPaints(t){Wo("Paint serialization only partially implemented in Skew"),Ii(L(),this,59,t)}strokePaints(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getStrokePaints(2);return Pn.WeakHandle_isValid(t)?L().modules().paintData_Internal.getOrCreateSkewCopy(t):[]}setTestOnlyStrokePaints(t){Wo("Paint serialization only partially implemented in Skew"),Ii(L(),this,60,t)}effects(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getEffects(2);return Pn.WeakHandle_isValid(t)?L().modules().effectData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyEffects(t){Wo("Effect serialization only partially implemented in Skew"),Ii(L(),this,61,t)}symbolID(){return this.isInstance()?(L().prepareCppNodeForAccess(this),L().nodeTsApi().getSymbolId(2)):J.invalid()}setTestOnlySymbolData(t){Wo("SymbolData serialization only partially implemented in Skew"),Ii(L(),this,75,t)}fillGeometry(){if(2==0&&ir.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners())return Qo(this.canvasSpaceBoundingBox());L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getFillGeometryRegions(2);return L().idlRegionsToGeometry(t,null)}setTestOnlyFillGeometry(t){Wo("Geometry serialization only partially implemented in Skew"),Ii(L(),this,73,t)}strokeGeometry(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getStrokeGeometryRegions(2);return L().idlRegionsToGeometry(t,null)}setTestOnlyStrokeGeometry(t){Wo("Geometry serialization only partially implemented in Skew"),Ii(L(),this,74,t)}textGeometry(){let t=this.textData();if(t==null)return null;L().prepareCppNodeForAccess(this);let r=L().nodeTsApi().getTextGeometryRegions(2),n=new ao(t.styleOverrideTable());return L().idlRegionsToTextGeometry(r,n)}prototypeInteractions(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getPrototypeInteractions(2);return Pn.WeakHandle_isValid(t)?L().modules().prototypeInteractions_Internal.getOrCreateSkewCopy(t):[]}setTestOnlyPrototypeInteractions(t){Wo("PrototypeInteraction[] serialization only partially implemented in Skew"),Ii(L(),this,81,t)}prototypeStartingPoint(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getPrototypeStartingPoint(2);if(t==null)return null;let r=t;return new _i(r.name,r.description,dr.fromString(r.position))}setPrototypeStartingPoint(t){L().prepareCppNodeForAccess(this);let r={name:t.name,description:t.description,position:dr.toString(t.position)},n=L().nodeTsApi().setPrototypeStartingPoint(r,2);n!=""&&Le(n)}storedPrototypeDevice(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getPrototypeDevice(2);if(t==null)return null;let r=t;return new jr(ke().PrototypeDeviceType[r.type],new R(r.size.x,r.size.y),r.presetIdentifier,ke().DeviceRotation[r.rotation])}setPrototypeDevice(t){L().prepareCppNodeForAccess(this);let r={type:ke().PrototypeDeviceType[t.type],size:{x:t.size().x(),y:t.size().y()},presetIdentifier:t.presetIdentifier,rotation:ke().DeviceRotation[t.rotation]};L().nodeTsApi().setPrototypeDevice(r,2)}overlayBackgroundAppearance(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getOverlayBackgroundAppearance(2);if(t==null)return null;let r=t;return new ei(ke().OverlayBackgroundType[r.backgroundType],C.fromColorF(r.backgroundColor))}setOverlayBackgroundAppearance(t){L().prepareCppNodeForAccess(this);let r={backgroundType:ke().OverlayBackgroundType[t.backgroundType],backgroundColor:C.toColorF(t.backgroundColor)},n=L().nodeTsApi().setOverlayBackgroundAppearance(r,2);n!=""&&Le(n)}textData(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getTextData(2);return Pn.WeakHandle_isValid(t)?L().modules().textData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyTextData(t){Wo("TextData serialization only partially implemented in Skew"),Ii(L(),this,4,t)}derivedTextData(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getDerivedTextData(2);return Pn.WeakHandle_isValid(t)?L().modules().derivedTextData_Internal.getOrCreateSkewCopy(t):null}setTestOnlyDerivedTextData(t){Wo("DerivedTextData serialization only partially implemented in Skew"),Ii(L(),this,5,t)}vectorData(){L().prepareCppNodeForAccess(this);let t=L().nodeTsApi().getVectorData(2);return Pn.WeakHandle_isValid(t)?L().modules().compiledVectorData_Internal.getOrCreateSkewCopy(t):null}hasDefaultStrokeParameters(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getHasDefaultStrokeParameters(2)}strokeJoin(){switch(L().prepareCppNodeForAccess(this),L().nodeTsApi().getStrokeJoin(2)){default:case 0:return"MITER";case 1:return"BEVEL";case 2:return"ROUND"}}setStrokeJoin(t){L().prepareCppNodeForAccess(this);let r=0;switch(t){case"MITER":r=0;break;case"BEVEL":r=1;break;case"ROUND":r=2;break}L().nodeTsApi().setStrokeJoin(r,2)}setStrokeMiterLimit(t){L().prepareCppNodeForAccess(this),L().nodeTsApi().setStrokeMiterLimit(t,2)}strokeMiterLimit(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getStrokeMiterLimit(2)}videoPlayback(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getVideoPlayback(2)}setVideoPlayback(t){L().prepareCppNodeForAccess(this),L().nodeTsApi().setVideoPlayback(t,2)}accessibleLabel(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getAccessibleLabel(2)}hasNodeProperty(t){return L().hasNodeProperty(this,t)}get(t,r=null){let n=cp(L(),this,t);return n??r}each(t){L().forEachField(this,r=>{t(r,this.get(r))})}isVisibleInCanvas(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().isVisibleInCanvas(2)}supportsBackgroundPaints(){return ir.isFrameLike(this.type())&&!this.containerSupportsFillStrokeAndCorners()}supportsGeometry(){return ir.isGeometryLeaf(this.type())||ir.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners()}findPrototypeInteraction(t){if(t==null)return null;let r=this.prototypeInteractions().filter(n=>J.equals(n.id(),t));return r.length==0?null:(r.length>1&&Le("Found multiple prototype interactions with the same GUID"),r[0])}updateDirtyFlagsForPropertyChange(t,r){this._handlePropertyChangeForTransform(t),this._handlePropertyChangeForBounds(t,r),this._handlePropertyChangeForRenderTree(t,r),this._handlePropertyChangeForInteractions(t)}_handlePropertyChangeForTransform(t){if((t==88||t==24||t==66||t==35||t==89)&&this._addFlagsToSelfAndChildren(1),t==20||t==21){let r=this;for(;r!=null&&!(r.isFixed()||r.hasOwnConstraintValues());)r=r.parent();r!=null&&r.isFixed()&&r.dirtyTransform()}}_handlePropertyChangeForInteractions(t){qn.isInteractionProperty(t)&&(this._lazyInteractionsMigrationValue=null)}map(t){return this._cachedChildren.map(t)}forEachChild(t){this._cachedChildren.forEach(t)}forEachDescendantPreorder(t){this._cachedChildren.forEach(r=>{t(r),r.forEachDescendantPreorder(t)})}childCount(){return this._cachedChildren.length}childAt1(t){return this.childAt2(t,!1)}childAt2(t,r){return r&&this.stackReverseZIndex()&&this.isStack()?this._cachedChildren[this.childCount()-t-1]:this._cachedChildren[t]}indexInParent(){if(this._cachedParent==null)return-1;let t=this._cachedParent._cachedChildren.indexOf(this);return this._cachedParent.stackReverseZIndex()&&this._cachedParent.isStack()&&(t=this._cachedParent.childCount()-t-1),t}updateIsRooted(){let t=this._cachedParent!=null?this._cachedParent.isRooted():this==this._scene.root();if(t!=this.isRooted()){this._flags=t?this._flags|2:this._flags&-3,t&&this._addFlagsToSelfAndChildren(1);for(let r of this._cachedChildren)r.updateIsRooted()}}appendChild(t){let r=this._cachedChildren.length==0?dr.FIRST_POSITION:dr.after(ce.List_last(this._cachedChildren).parentIndex().position);t.setParentIndex(new Vr(this.id(),r))}collectUniqueUsedImages(){let t=new Map;return this.forEachSinglePaint(r=>{(r.type()=="IMAGE"||r.type()=="EMOJI"||r.type()=="VIDEO")&&(r.image()!=null&&t.set(r.image().objectHash(),r.image()),r.imageThumbnail()!=null&&t.set(r.imageThumbnail().objectHash(),r.imageThumbnail()))}),this.forEachEmojiInTextData(r=>{t.set(r.objectHash(),r)}),t}forEachSinglePaint(t){var n,o;let r=a=>{let s=a.asVolatilePaint();s!=null&&(t(s.from()),t(s.to()));let l=a.asSinglePaint();l!=null&&t(l)};this.fillPaints().forEach(r),this.strokePaints().forEach(r),(o=(n=this.textData())==null?void 0:n.styleOverrideTable())==null||o.forEachFillPaint(this.scene(),a=>{a.forEach(r)}),this.hasPerRegionFillPaints()&&this.forEachRegionWithFillPaintBatch((a,s)=>{s.forEach(r)})}forEachEmojiInTextData(t){var r,n,o;this._cachedType=="TEXT"&&(((r=this.derivedTextData())==null?void 0:r.usedEmojiImages())!=null?this.derivedTextData().usedEmojiImages().forEach(a=>{t(a)}):(o=(n=this.textData())==null?void 0:n.usedEmojiImagesDEPRECATED())==null||o.forEach(a=>{t(a)}))}textHyperlinkBoxes(){var t,r;return this._cachedType!="TEXT"?[]:((t=this.derivedTextData())==null?void 0:t.hyperlinkBoxes())!=null?this.derivedTextData().hyperlinkBoxes():((r=this.textData())==null?void 0:r.hyperlinkBoxesDEPRECATED())??[]}textHasMixedFontSizes(){return this._cachedType!="TEXT"||this.textData()==null||this.textData().fontSizes()===null?!1:this.textData().fontSizes()==="mixed"?!0:(L().prepareCppNodeForAccess(this),this.textData().fontSizes()!=L().nodeTsApiGenerated().getFontSize(2))}restartGifs(){this.forEachSinglePaint(t=>{let r=t.image();if(r==null||!r.isGIF())return;let n=r.gif();n!=null&&n.restart()})}clipsToBoundingRectangle(){return ir.isFrameLike(this.type())&&!this.isFrameMaskDisabled()&&!this.isResizeToFit()}isAxisAligned(){let r=this.absoluteTransform();return Math.abs(r.m00())<1e-4&&Math.abs(r.m11())<1e-4||Math.abs(r.m01())<1e-4&&Math.abs(r.m10())<1e-4}isAxisAlignedRectFill(){return this.fillGeometry()!=null&&this.fillPaints().length!=0&&this.strokePaints().length==0&&this.fillGeometry().isRect()&&this.isAxisAligned()}isInSymbol(){let t=!1;for(let r=this;r!=null;r=r.parent())if(r.type()=="SYMBOL"){t=!0;break}return t}_addScrollableChildFramesToListRecursive(t){for(let r of this._cachedChildren)r.scrollDirection()!="NONE"&&t.push(r),r._addScrollableChildFramesToListRecursive(t)}scrollableFrameDescendants(){let t=[];return this._addScrollableChildFramesToListRecursive(t),t}isGroup(){return ir.isFrameLike(this.type())&&this.isResizeToFit()}hasOwnConstraintValues(){return this.type()!="BOOLEAN_OPERATION"&&this.type()!="CANVAS"&&this.type()!="DOCUMENT"&&!this.isGroup()}_collectConstraintValuesInSubtree(t){let r=null;return Wr(this,n=>{if(!n.hasOwnConstraintValues())return 0;let o=t(n);if(r==null)r=new fe(o);else if(r.value!=o)return r=null,1;return 2}),r}horizontalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(t=>t.horizontalConstraint())}verticalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(t=>t.verticalConstraint())}_withOverriddenFrameRole(t,r){this._scrollingLogic.overrideRole(t),this._addFlagsToSelfAndChildren(1),this._invalidateRenderTreeForSelf();for(let n=0,o=this.childCount();n<o;n=n+1){let a=this.childAt1(n);a.isFixed()&&Wr(a,s=>{s._invalidateRenderTreeForSelf()})}r(),this._scrollingLogic.clearRoleOverride()}actingAsOverlayOrSublayerForRendertreeGeneration(t){this._withOverriddenFrameRole(1,t)}actingAsBaseScreenForRendertreeGeneration(t){this._withOverriddenFrameRole(0,t)}_translateFixedElementIfNecessary(t){if(!this.isFixed()||this.parent()==null||this.parent().scrollDirection()=="NONE")return;let r=this.parent();if($r.scrollsHorizontally(r.scrollDirection())){let n=this.horizontalConstraintOfSubtree();n!=null&&(n.value=="MAX"?t.translate2(r.size().x()-r.fullSize().x(),0):n.value=="CENTER"&&t.translate2((r.size().x()-r.fullSize().x())/2,0))}if($r.scrollsVertically(r.scrollDirection())){let n=this.verticalConstraintOfSubtree();n!=null&&(n.value=="MAX"?t.translate2(0,r.size().y()-r.fullSize().y()):n.value=="CENTER"&&t.translate2(0,(r.size().y()-r.fullSize().y())/2))}}hasPerRegionFillPaints(){if(this.type()!="VECTOR"||this.fillGeometry()==null)return!1;let t=this.fillGeometry().styleIDs;return t==null?!1:t.some(r=>r!=0)}forEachRegionWithFillPaintBatch(t){var a;let r=this.fillGeometry(),n=(a=this.vectorData())==null?void 0:a.paintOverrides,o=this.fillPaints();if(!(n==null||r==null))for(let s=0;s<r.regions.length;s=s+1){let l=o;if(s<r.styleIDs.length){let d=r.styleIDs[s],h=n.get(d,this.scene());h!=null&&(l=h)}let c=r.regions[s];t(c,l)}}relativeTransformAccountingForFixedOffset(){let t=this.relativeTransform().clone();return this._translateFixedElementIfNecessary(t),t}absoluteTransform(){if(this.isRooted()&&1&this._flags){let t=this.relativeTransformAccountingForFixedOffset();if(this._cachedParent!=null){let r=this._cachedParent.absoluteTransform().clone();r.multiply(t),t=r}this._absoluteTransform=t,this._flags&=-2}return this._absoluteTransform}dirtyTransform(){this._addFlagsToSelfAndChildren(1),this._addFlagsToSelfAndChildren(4)}copyNodeCachedTransformAndBounds(t){this._absoluteTransform=t._absoluteTransform,this._cachedCanvasSpaceGeometryBounds=t._cachedCanvasSpaceGeometryBounds,this._cachedCanvasSpaceRenderedBounds=t._cachedCanvasSpaceRenderedBounds,this._cachedCanvasSpaceScrollingBounds=t._cachedCanvasSpaceScrollingBounds}_addFlagsToParents(t){this.parent()!=null&&this.parent()._addFlagsToSelfAndParents(t)}_addFlagsToSelfAndParents(t){for(let r=this;r!=null;r=r.parent())r._flags|=t}_addFlagsToSelfAndChildren(t){this._flags|=t;for(let r of this._cachedChildren)r._addFlagsToSelfAndChildren(t)}isFrameBackgroundVisible(){if(!ir.isFrameLike(this.type()))return!1;let t=this.containerSupportsFillStrokeAndCorners()?this.fillPaints():null;if(t==null)return C.alpha(this.computedBackgroundColor())>0;for(let r=0,n=t.length;r<n;r=r+1)if(t[r].isEnabledAndVisible())return!0;return!1}hasBackgroundBlurs(){if(this.effects().filter(r=>r.type()=="BACKGROUND_BLUR").length>0)return!0;let t=!1;return this.forEachChild(r=>{r.hasBackgroundBlurs()&&(t=!0)}),t}hasNonZeroStrokeWeight(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getHasNonZeroStrokeWeight(2)}styleId(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().styleId(2)}inheritedStyleId(t){return L().prepareCppNodeForAccess(this),L().nodeTsApi().inheritedStyleId(t,2)}setInheritStyleId(t,r){return L().prepareCppNodeForAccess(this),L().nodeTsApi().setInheritStyleId(t,r,2)}setStyleSortPosition(t){return L().prepareCppNodeForAccess(this),L().nodeTsApi().setStyleSortPosition(t,2)}tableCellRowId(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().tableCellColumnId(2)}tableCellColumnId(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().tableCellColumnId(2)}getTableCellAt(t,r){L().prepareCppNodeForAccess(this);let n=L().nodeTsApi().getTableCellGuid(2,t,r);return this._scene.findNode(n)}canvasSpaceGeometryBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceGeometryBounds}canvasSpaceRenderedBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceRenderedBounds}canvasSpaceScrollingBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceScrollingBounds}canvasSpaceInteractiveBounds(){let t=this.fillOrTextGeometry(),r=this.strokeGeometry(),n=V.new2(),o=this.size();n.setTo1(0,0,o.x(),o.y());let a=new bt;a.include3(n),t!=null&&a.include3(t.bounds),r!=null&&this.strokeAlign()!="INSIDE"&&a.include3(r.bounds);let s=a.build();return s.transformInto1(s,this.absoluteTransform()),s}canvasSpacePreviewBounds(){let t=this.strokeGeometry(),r=V.new2();r.setTo1(0,0,this.fullSize().x(),this.fullSize().y());let n=new bt;n.include3(r),t!=null&&this.strokeAlign()!="INSIDE"&&n.include3(t.bounds);let o=n.build();if(o.transformInto1(o,this.absoluteTransform()),this._scrollingLogic.shouldResizeToFitViewport()){let a=this.parent().prototypeDevice(),s=a.type=="NONE"||a.type=="PRESENTATION"?this.parent().currentViewportSize():a.size(),l=this.findContainingCanvasOrParent();if(a=l.prototypeDevice(),s=a.type=="NONE"||a.type=="PRESENTATION"?l.currentViewportSize():a.size(),!o.size().min2(s).equals(o.size())){let c=V.new4(this.canvasSpaceBoundingBox().topLeft(),s);o.intersectWith(c)}}return o}canvasSpaceBoundingBox(){let t=V.new2(),r=this.size();return t.setTo1(0,0,r.x(),r.y()),t.transformInto1(t,this.absoluteTransform()),t}fullSizeCanvasSpaceBoundingBox(){let t=V.new2();return t.setTo1(0,0,this.fullSize().x(),this.fullSize().y()),t.transformInto1(t,this.absoluteTransform()),t}_updateBoundsIfNeeded(){if(!this.isRooted()||!(4&this._flags))return;for(let n of this._cachedChildren)n._updateBoundsIfNeeded();ft._geometryBuilder.reset(),ft._renderedBuilder.reset(),ft._scrollingBuilder.reset(),ft._effectBuilder.reset();let t=0,r=this.effects();for(let n=0,o=r.length;n<o;n=n+1){let a=r[n];a.isEnabledAndVisible()&&a.type()=="FOREGROUND_BLUR"&&(t+=a.blurRadius())}t>0&&(ft._effectBuilder.include1(-t,-t),ft._effectBuilder.include1(t,t));for(let n=0,o=r.length;n<o;n=n+1){let a=r[n];if(a.isEnabledAndVisible()&&a.type()=="DROP_SHADOW"){let s=t+a.blurRadius()+a.spread();ft._effectBuilder.include1(a.blurOffset().x()-s,a.blurOffset().y()-s),ft._effectBuilder.include1(a.blurOffset().x()+s,a.blurOffset().y()+s)}}if(ir.isGeometryLeaf(this.type())){let n=this.fillOrTextGeometry(),o=this.strokeGeometry(),a=this.absoluteTransform();n!=null&&ft._geometryBuilder.include4(n.bounds,a),o!=null&&(this.strokeAlign()!="INSIDE"||n==null||n.regions.length==0||n.bounds.isInvalid())&&ft._geometryBuilder.include4(o.bounds,a)}else for(let n of this._cachedChildren)n.isInvisibleOrTransparent()||(ft._geometryBuilder.include3(n._cachedCanvasSpaceGeometryBounds),ft._renderedBuilder.include3(n._cachedCanvasSpaceRenderedBounds)),n.visible()&&ft._scrollingBuilder.include3(n._cachedCanvasSpaceScrollingBounds);if(ir.isFrameLike(this.type())){let n=this.canvasSpaceBoundingBox();if(this.clipsToBoundingRectangle()){let o=ft._geometryBuilder.build(),a=ft._renderedBuilder.build(),s=ft._scrollingBuilder.build();o.intersectWith(n),a.intersectWith(n),s.intersectWith(n),ft._geometryBuilder.reset(),ft._renderedBuilder.reset(),ft._scrollingBuilder.reset(),ft._geometryBuilder.include3(o),ft._renderedBuilder.include3(a),ft._scrollingBuilder.include3(s)}if(this.containerSupportsFillStrokeAndCorners()){let o=this.fillOrTextGeometry(),a=this.strokeGeometry(),s=this.absoluteTransform();o!=null&&ft._geometryBuilder.include4(o.bounds,s),a!=null&&(this.strokeAlign()!="INSIDE"||o==null||o.regions.length==0||o.bounds.isInvalid())&&ft._geometryBuilder.include4(a.bounds,s)}(this.isFrameBackgroundVisible()||this.parent()!=null&&this.parent().type()=="CANVAS"&&this.clipsToBoundingRectangle())&&(ft._geometryBuilder.include3(n),ft._renderedBuilder.include3(n)),ft._scrollingBuilder.include3(n)}this._cachedCanvasSpaceGeometryBounds=ft._geometryBuilder.build(),ft._renderedBuilder.include3(this._cachedCanvasSpaceGeometryBounds),ft._scrollingBuilder.include3(this._cachedCanvasSpaceGeometryBounds),ft._effectBuilder.isValidOrZeroArea()&&(ft._effectBuilder.buildTo(ft._effectBounds),ft._renderedBuilder.include3(ft._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,ft._effectBounds)),ft._scrollingBuilder.include3(ft._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,ft._effectBounds))),this._cachedCanvasSpaceRenderedBounds=ft._renderedBuilder.build(),this._cachedCanvasSpaceScrollingBounds=ft._scrollingBuilder.build(),this._flags&=-5}_handlePropertyChangeForBounds(t,r){switch(t){case 22:case 20:case 21:case 12:case 51:case 75:case 62:case 26:case 70:case 28:case 48:case 16:case 29:case 65:case 66:case 69:case 46:case 71:case 17:case 47:case 27:case 30:case 87:break;case 64:case 8:{this._addFlagsToParents(4);break}default:{this._addFlagsToParents(4),this._addFlagsToSelfAndChildren(4),t==25&&r!=null&&r._addFlagsToSelfAndParents(4);break}}}developerFriendlyId(){if(this.type()=="TABLE_CELL"){let n=this.parent();return n==null?(console.error("Orphaned table cell"),null):"T"+[n.id(),this.tableCellRowId(),this.tableCellColumnId()].map(a=>a).join(";")}if(!this.isInstanceSublayer())return this.id();let t=this;for(;t!=null&&!t.isPrimaryInstance();)t=t.parent();return t==null?(console.error("Unable to find primary instance backing node"),null):"I"+this.stablePath().guids.map(n=>n).join(";")}fillOrTextGeometry(){return this.type()=="TEXT"?this.textGeometry():this.fillGeometry()}fillRegionPaints(){return ft._computeRegionPaintsFromStyles(this.fillOrTextGeometry(),this.fillPaints(),this.scene())}strokeRegionPaints(){return ft._computeRegionPaintsFromStyles(this.strokeGeometry(),this.strokePaints(),this.scene())}hasMoreThanOneCornerRadius(){let t=this.rectangleTopLeftCornerRadius();return this.rectangleTopRightCornerRadius()!=t||this.rectangleBottomLeftCornerRadius()!=t||this.rectangleBottomRightCornerRadius()!=t}roundedRectInfo(){return this._instantiateRoundedRect()}_instantiateRoundedRect(){if(this.rectangleCornerRadiiIndependent()){let t=[this.rectangleTopLeftCornerRadius(),this.rectangleTopRightCornerRadius(),this.rectangleBottomRightCornerRadius(),this.rectangleBottomLeftCornerRadius()];return new Di(1,ye.FrozenVector_ZERO,this.size(),t,this.cornerSmoothing())}else return new Di(0,ye.FrozenVector_ZERO,this.size(),this.cornerRadius(),this.cornerSmoothing())}fillGeometryForSpread(t,r,n){let o=null;if(this.type()=="ELLIPSE"){let a={m00:t.m00(),m01:t.m01(),m02:t.m02(),m10:t.m10(),m11:t.m11(),m12:t.m12()},s=L().getFillGeometryForSpread(a,r,this);o=new io(s)}else{let a=this._instantiateRoundedRect();a.transform(t),a.adjustCornerRadiiForSpread(r),o=Ot.fromRoundedRect(a)}return new Qt(new Ft(o,"NONZERO"),n)}strokeGeometryForSpread(t,r,n,o){let a=null,s=this.strokeAlign()=="INSIDE"?2:this.strokeAlign()=="CENTER"?1:0,l=!n.subtract(2*r+s*this.strokeWeight()).isPositive(),c=2-s;if(Ce.containsAtLeastOneVisiblePaint(this.fillPaints())||l){let d=ee.new2(),u=n.add(this.strokeWeight()*c).add(2*r).divide1(n),m=-r-this.strokeWeight()*c/2;if(d.translate2(m,m),d.scale3(u),this.type()=="ELLIPSE"){let g=new V(0,0,this.size().x(),this.size().y());d.transformRect(g),a=Pt.forEllipse(g)}else{let g=this._instantiateRoundedRect();g.transform(d),a=Pt.fromRoundedRectWithSpread(g,r+c*this.strokeWeight()/2)}}else{if(this.strokeWeight()+2*r<=0)return null;if(this.type()=="ELLIPSE"){let d=V.new4(ye.FrozenVector_ZERO,this.size());t.transformRect(d),d.expand1(c*this.strokeWeight()/2),a=Pt.forEllipse(d),d.contract(2*r+this.strokeWeight()),a.append(Pt.forEllipse(d))}else{let d=this._instantiateRoundedRect();d.transform(t),d.expand(c*this.strokeWeight()/2),a=Pt.fromRoundedRectWithSpread(d,r+c*this.strokeWeight()/2),d.contract(2*r+this.strokeWeight()),a.append(Pt.fromRoundedRectWithSpread(d,-(2*r+this.strokeWeight())))}}return new Qt(new Ft(a,"ODD"),o)}isTopLevel(){return this.parent()!=null&&this.parent().isTopLevelParent()}isTopLevelParent(){return ft.isTopLevelParentNodeType(this.type())}static isTopLevelParentNodeType(t){return t=="CANVAS"||t=="SECTION"||t=="SLIDE_ROW"||t=="SLIDE_GRID"}topLevelAncestor(){let t=this;for(;t!=null;){if(t.isTopLevel())return t;t=t.parent()}return null}canvas(){var n,o;let t=this.type()=="CANVAS"?this:(n=this.topLevelAncestor())==null?void 0:n.parent();return t=((o=this.topLevelAncestor())==null?void 0:o.parent().type())=="SECTION"||this.type()=="SLIDE"||this.type()=="SLIDE_ROW"?this.findContainingCanvasOrParent():t,t}isAncestorOf(t){for(let r=t;r!=null;r=r.parent())if(r==this)return!0;return!1}forSelfAndAncestors(t){for(let r=this;r!=null;r=r.parent())t(r)}findContainingStateGroupOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.isStateGroup())return t;return null}findContainingScrollingFrameOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.scrollDirection()!="NONE"&&!t.isTooRotatedToScroll())return t;return null}findContainingInstanceOrSelf(){for(let t=this;t!=null;t=t.parent())if(t.type()=="INSTANCE")return t;return null}findAllSectionsInNode(){let t=this,r=[];r.push(t);let n=[];for(;r.length>0;){let o=r.shift();for(let a=0,s=o.childCount();a<s;a=a+1){let l=o.childAt1(a);l!=null&&l.type()=="SECTION"&&(r.push(l),n.push(l))}}return n}findAllTopLevelNodesInNode(t){let r=[];if(t.type()!="CANVAS"&&t.type()!="SECTION")return r;let n=[];for(n.push(t);n.length>0;){let o=n.shift();for(let a=0,s=o.childCount();a<s;a=a+1){let l=o.childAt1(a);l.type()=="SECTION"&&n.push(l),r.push(l)}}return r}buildAncestors(){let t=[];return this.forSelfAndAncestors(r=>{t.push(r)}),t.reverse(),t}isAboveInLayerOrder(t){let r=this.buildAncestors(),n=t.buildAncestors();for(let o=0,a=Math.min(r.length,n.length);o<a;o=o+1)if(r[o]!=n[o]){let s=r[o],l=n[o];return s.indexInParent()>l.indexInParent()}return r.length==n.length?!1:r.length>n.length}isTooRotatedToScroll(){return Math.abs(this.absoluteTransform().toAngle())>=Math.PI/180}debugString(){let t="";if(t+=this.hierarchyString()+`

`,this.type()=="INSTANCE"){let r=`stablePath: ${this.stablePath()}`;t+=r+`

`}return t+=`{
`,this.each((r,n)=>{t+=`  ${wt[r]}: ${nt.toString(n)}
`}),t+="}",t+=`

`,t}paintsDebugString(){let t=this.strokePaints().some(r=>r.isEnabledAndVisible())?` strokeAlign=${this.strokeAlign()} weight=${this.strokeWeight()}`:"";return`Node type=${this.type()} size=${this.size()}
 -- fills=[${this.fillPaints().map(r=>r.debugString()).join(", ")}]
 -- strokes=[${this.strokePaints().map(r=>r.debugString()).join(", ")}]`+t}_makeIndent(t,r){let o="";if(r){for(let a=0,s=2*(t-1);a<s;a=a+1)o+="-";return o+="> ",o}else{for(let a=0,s=2*t;a<s;a=a+1)o+=" ";return o}}hierarchyString(){let t=[],r=this._hierarchyStringForAncestors(t);return r==0&&(t.push("(null parent)"),r=r+1),this._hierarchyStringWithChildren(r,!0,t),t.join(`
`)}_hierarchyStringLocal(t,r){let n=this._makeIndent(t,r);return n+=`${this.type()}: '${this.name()??"null"}' (${this.id()})`,(this.isInstanceSublayer()||this.isPrimaryInstance())&&(n+=` stablePath: ${this.stablePath()}`),this.isInSymbol()&&(n+=` (overrideKey: ${this.overrideKey()})`),this.type()=="INSTANCE"&&(n+=` (symbol: ${this.symbolID()??"null"})`),n+=` hasBeenLoaded: ${this.hasBeenLoaded()?"\u2714":"\u25FB\uFE0F"}`,n}_hierarchyStringForAncestors(t){let r=0,n=[];for(this.forSelfAndAncestors(o=>{o!=this&&n.push(o)});n.length>0;)t.push(n.pop()._hierarchyStringLocal(r,!1)),r=r+1;return r}_hierarchyStringWithChildren(t,r,n){n.push(this._hierarchyStringLocal(t,r));for(let o=0,a=this.childCount();o<a;o=o+1)this.childAt1(o)._hierarchyStringWithChildren(t+1,!1,n)}_invalidateRenderTreeForSelf(){this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null}invalidateRenderTreeForSelfAndParents(){for(let t=this;t!=null;t=t.parent())t._invalidateRenderTreeForSelf()}invalidateRenderTreeForChildren(){for(let t=0,r=this.childCount();t<r;t=t+1){let n=this.childAt1(t);n._invalidateRenderTreeForSelf(),n.invalidateRenderTreeForChildren()}}invalidateNestedBackgroundBlurRenderTrees(t,r){var s;let n=this.topLevelAncestor();if(!this.isTopLevelParent()&&(n==null||!t.has(n.id()))&&(Lt.didEncounterNestedBBNotInDirtyNodes(),X.viewerSkipNotDirtyTreeOpt()))return!1;let o=(s=this._renderTree)==null?void 0:s.value;if(o!=null&&!o.hasBackgroundBlurs())return!1;if(this.transitioningFrom!=null){if(o==null||o.hasBackgroundBlurs()){let l=this.topLevelAncestor();if(l!=null&&t.has(l.id()))return this._invalidateRenderTreeForSelf(),!0}return!1}let a=!1;for(let l=0,c=this.childCount();l<c;l=l+1)a=this.childAt2(l,!0).invalidateNestedBackgroundBlurRenderTrees(t,r)||a;if(a)return this._invalidateRenderTreeForSelf(),!0;if(!ir.isGeometryLeaf(this.type())&&!ir.isFrameLike(this.type()))return!1;if(this.effects().length!=0){let l=this.supportsGeometry()?this.canvasSpaceGeometryBounds():this.canvasSpaceBoundingBox();for(let c=0,d=this.effects().length;c<d;c=c+1){let h=this.effects()[c];if(h.isVisibleForRendering()&&h.type()=="BACKGROUND_BLUR"){let u=V.new3(l).expandedBy1(h.blurRadius()),m=!1,g=this.topLevelAncestor();if(g!=null&&t.has(g.id())&&(m=!0),m)return this._invalidateRenderTreeForSelf(),r.push(u),!0}}}return!1}getCachedRenderTree(){return this._renderTree}getCachedRenderTreeForBaseScreen(){return this._renderTreeAsBaseScreen}renderTree1(){return this.renderTree2(new Kt(this))}renderTree2(t){if(t.overlayRenderData()!=null&&t.overlayRenderData().hasTransition()&&t.hasBackgroundBlurs()){let r=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);return Ne.generateRenderTree(t,r)}if(this._renderTree==null){let r=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);this.actingAsOverlayOrSublayerForRendertreeGeneration(()=>{this._renderTree=new fe(Ne.generateRenderTree(t,r))}),(this._renderTree.value==null||!this._renderTree.value.hasBackgroundBlurs())&&(this._renderTreeWithoutBackgroundBlurs=this._renderTree)}return this._renderTree.value}renderTreeForBaseScreen1(){return this.renderTreeForBaseScreen2(new Kt(this))}renderTreeForBaseScreen2(t){if(this._renderTreeAsBaseScreen==null){let r=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);this.actingAsBaseScreenForRendertreeGeneration(()=>{this._renderTreeAsBaseScreen=new fe(Ne.generateRenderTree(t,r))})}return this._renderTreeAsBaseScreen.value}renderTreeWithoutBackgroundBlurs(){if(this._renderTreeWithoutBackgroundBlurs==null){let t=new Kt(this),r=new Ne.GenerateArgs(Ne.RenderMode.WITHOUT_BACKGROUND_BLURS);this._renderTreeWithoutBackgroundBlurs=new fe(Ne.generateRenderTree(t,r))}return this._renderTreeWithoutBackgroundBlurs.value}renderTreeForShadowRoot1(){return this.renderTreeForShadowRoot2(new Kt(this))}renderTreeForShadowRoot2(t){if(this._renderTreeForShadowRoot==null){let r=new Ne.GenerateArgs(Ne.RenderMode.SHADOW,t.uniqueIdentifier());this._renderTreeForShadowRoot=new fe(Ne.generateRenderTree(t,r))}return this._renderTreeForShadowRoot.value}renderTreeForShadowDescendant1(){return this.renderTreeForShadowDescendant2(new Kt(this))}renderTreeForShadowDescendant2(t){if(this._renderTreeForShadowDescendant==null){let r=new Ne.GenerateArgs(Ne.RenderMode.SHADOW);this._renderTreeForShadowDescendant=new fe(Ne.generateRenderTree(t,r))}return this._renderTreeForShadowDescendant.value}renderTreeForKnockoutShadowRoot1(){return this.renderTreeForKnockoutShadowRoot2(new Kt(this))}renderTreeForKnockoutShadowRoot2(t){if(this._renderTreeForKnockoutShadowRoot==null){let r=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW,t.uniqueIdentifier());this._renderTreeForKnockoutShadowRoot=new fe(Ne.generateRenderTree(t,r))}return this._renderTreeForKnockoutShadowRoot.value}renderTreeForKnockoutShadowDescendant1(){return this.renderTreeForKnockoutShadowDescendant2(new Kt(this))}renderTreeForKnockoutShadowDescendant2(t){if(this._renderTreeForKnockoutShadowDescendant==null){let r=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW);this._renderTreeForKnockoutShadowDescendant=new fe(Ne.generateRenderTree(t,r))}return this._renderTreeForKnockoutShadowDescendant.value}renderTreeForOverlay(t){let r=!1;t.overlayRenderData()!=null&&this._overlayCacheKey!=t.overlayRenderData().overlayCacheKey()&&(this._invalidateRenderTreeForSelf(),r=!0);let n=this.renderTree2(t);return r&&(this._overlayCacheKey=t.overlayRenderData().overlayCacheKey()),n}containsIndependentBordersStrokeMask(){return L().prepareCppNodeForAccess(this),L().nodeTsApi().getContainsIndependentBordersStrokeMask(2)}generateStrokeAndStrokeMaskGeometries(t,r,n){let o=this.strokeGeometry(),a=this.strokeGeometry().styleIDs,s=new Set(a);(!s.has(0)||!s.has(1))&&Le("Expected IDs 0 and 1 in stroke mask geometry");for(let l=0;l<o.regions.length;l++){let c=l<a.length?a[l]:0,d=o.regions[l];if(d.bounds().isEmpty())continue;let h=Ft.getOrCreate(d.path(),d.windingRule);if(c==1)r.push(new Qt(h,Ce.SOLID_BLACK));else{let u=Ce.isolatedPaints(n);for(let m=0;m<u.length;m++)t.push(new Qt(h,u[m]))}}}_handlePropertyChangeForRenderTree(t,r){switch(t){case 24:case 78:{this.invalidateRenderTreeForSelfAndParents(),this.invalidateRenderTreeForChildren();break}case 25:{this.invalidateRenderTreeForSelfAndParents(),r!=null&&r.invalidateRenderTreeForSelfAndParents();break}case 89:case 66:{let n=this.findAllTopLevelNodesInNode(this);for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];s!=null&&s.invalidateRenderTreeForSelfAndParents()}break}case 64:case 9:case 38:case 22:case 59:case 3:case 13:case 10:case 11:case 37:case 14:case 80:case 35:case 34:case 49:case 23:case 74:case 60:case 1:case 2:case 4:case 76:case 19:case 8:case 61:case 52:case 53:case 55:case 56:case 91:case 92:case 93:case 94:case 63:case 73:case 75:case 44:case 39:case 40:case 41:case 42:case 15:case 45:case 62:{this.invalidateRenderTreeForSelfAndParents();break}}}static _applyEffectSpread(t,r){if(r!=null){let n=t.clone();return n.translate1(r.centerX(),r.centerY()),n.expand2(r.width()/2,r.height()/2),n}return t}static _computeRegionPaintsFromStyles(t,r,n){if(t!=null){let o=r!=null?r.filter(l=>l.isEnabledAndVisible()):[],a=new Map,s=t.paintOverrides;return o.length==0&&o.push(te.TRANSPARENT),t.regions.map(l=>{let c=o,d=l.styleID;if(d!=0&&s!=null){let h=zt.IntMap_get(a,d,null);if(h==null){let u=s.get(d,n);u!=null&&(h=u.filter(m=>m.isEnabledAndVisible()),a.set(d,h))}h!=null&&(c=h)}return c})}return ft.EMPTY_REGION_PAINTS}};ft._geometryBuilder=new bt,ft._renderedBuilder=new bt,ft._scrollingBuilder=new bt,ft._effectBuilder=new bt,ft._effectBounds=V.new2(),ft.EMPTY_REGION_PAINTS=[];var gp=ft;var Rg=class{constructor(e,t){this.clone=e,this.source=t}},Ng=class{constructor(e,t){this.transitionRootStablePath=e,this.cloneOps=t}},rl=class{constructor(e,t){this._appState=null,this._modules=null,this._cachedViewNode=null,this._modules=e,this._appState=t,t.addFrameObserver(this._prototype())}modules(){return this._modules}appState(){return this._appState}nodeTsApi(){var e;return(e=this._modules)==null?void 0:e.nodeTsApi}nodeTsApiGenerated(){var e;return(e=this._modules)==null?void 0:e.nodeTsApiGenerated}sceneGraphTsApi(){var e;return(e=this._modules)==null?void 0:e.sceneGraphTsApi}_prototype(){var e;return(e=this._modules)==null?void 0:e.prototype}fonts(){var e;return(e=this._modules)==null?void 0:e.fonts}dumpFileForTests(){return this._prototype().dumpFile()}getNodeChangesForSwap(e,t,r){let n=this._prototype().getNodeChangesForSwap(e.guids,t,r),o=this._appState.scene(),a=n.clones.map(s=>{let l=o.findNode(s.clone),c=o.findNode(s.source);return new Rg(l,c)});return new Ng(new yt(n.transitionRootStablePath),a)}runSetVariable(e,t,r,n){return this._prototype().runSetVariable(e,t,r,n)}runSetVariableMode(e,t,r){return this._prototype().runSetVariableMode(e,t,r)}getFirstTruthyConditionalIndex(e,t){return this._prototype().getFirstTruthyConditionalIndex(e,t)}getICActionsForSetVariableAction(e,t,r,n,o){return this._prototype().getICActionsForSetVariableAction(e,t,r,n,o)}shouldDisallowSwap(e,t){return this._prototype().shouldDisallowSwap(e.guids,t)}applyExistingVariableChangesToIFLLoadedNodes(){this._prototype().applyExistingVariableChangesToIFLLoadedNodes()}updateImmutableFramesAndLayoutDirtyGroupsAndStacks(){this._prototype().updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}prepareCppNodeForAccess(e){e!=this._cachedViewNode&&(this.nodeTsApi().setGlobalUnstableNodeByHandle(e.handle()),this._cachedViewNode=e)}createSceneAndSetActive(e,t){let r=this._prototype().createSceneWithDangerousLoadingFlag(e,t);this._prototype().setActiveScene(r);let n=_n.instance.findScene(r);if(n==null)throw new Error("Failed to create scene in C++");return this._setSceneAsActiveIfNeeded(n),n}destroyScene(e){this._prototype().destroyScene(e.handle())}markSceneLoaded(e){this._prototype().markSceneLoaded(e.handle())}resetLocalChanges(){this._prototype().resetLocalChanges()}isOrContainsBaseScreen(e){return this._prototype().isOrContainsBaseScreen(e)}resetLocalVariableChanges(){this._prototype().resetLocalVariableChanges()}resetLocalVariableModeChanges(){this._prototype().resetLocalVariableModeChanges()}resetLocalInstanceChanges(e){this._prototype().resetLocalInstanceChanges(e)}resetLocalNestedInstanceChanges(e){this._prototype().resetLocalNestedInstanceChanges(e)}nodeHasLocalSymbolChanges(e){return this._prototype().nodeHasLocalSymbolChanges(e)}getNumStateTransitions(e){return this._prototype().getNumStateTransitions(e)}_setSceneAsActiveIfNeeded(e){this._prototype().getActiveScene()!=e.handle()&&this._prototype().setActiveScene(e.handle())}applyNodeChanges(e){this._prototype().applyNodeChanges(e,Po)}reset(){this._prototype()!=null&&this._prototype().reset()}findNode(e,t){return this._setSceneAsActiveIfNeeded(e),this._prototype().findNodeByStablePath(t.guids)}idlRegionsToGeometry(e,t){if(e===null||e==null)return null;let r=[],n=[];bt.INSTANCE.reset();for(let a of e){let s=new io(a.path),l=new Fr(a.windingRule==1?"ODD":"NONZERO",a.styleID,s,s.bounds());r.push(l),n.push(a.styleID),bt.INSTANCE.include3(l.bounds())}let o=t??new ao(new kr(new Map));return new xr(r,n,bt.INSTANCE.build(),o)}idlRegionsToTextGeometry(e,t){if(e==null)return null;let r=[],n=[],o=[];bt.INSTANCE.reset();for(let s of e){let l=new io(s.path),c=new Fr(s.windingRule==1?"ODD":"NONZERO",s.styleID,l,l.bounds());r.push(c),n.push(s.styleID),o.push(s.emojiCodePoints),bt.INSTANCE.include3(c.bounds())}let a=t??new ao(new kr(new Map));return new tu(r,n,bt.INSTANCE.build(),a,o)}getFillGeometryForSpread(e,t,r){return this.prepareCppNodeForAccess(r),this._prototype().getFillGeometryForSpread(e,t,2)}getAffineTransform(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getAffineTransform(t),new ee(At.retAffineTransform_m00,At.retAffineTransform_m01,At.retAffineTransform_m02,At.retAffineTransform_m10,At.retAffineTransform_m11,At.retAffineTransform_m12)}getAffineTransform_SGEO(e){return this._prototype().getAffineTransform_SGEO(e),new ee(At.retAffineTransform_m00,At.retAffineTransform_m01,At.retAffineTransform_m02,At.retAffineTransform_m10,At.retAffineTransform_m11,At.retAffineTransform_m12)}getArcData(e,t){this.prepareCppNodeForAccess(e),this._prototype().getArcData(t);let r={};return r.startingAngle=At.retArcData_startAngle,r.endingAngle=At.retArcData_endAngle,r.innerRadius=At.retArcData_innerRadius,r}getArcData_SGEO(e){this._prototype().getArcData_SGEO(e);let t={};return t.startingAngle=At.retArcData_startAngle,t.endingAngle=At.retArcData_endAngle,t.innerRadius=At.retArcData_innerRadius,t}getBool(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getBool(t)}getBool_SGEO(e){return this._prototype().getBool_SGEO(e)}getDouble(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getDouble(t)}getDouble_SGEO(e){return this._prototype().getDouble_SGEO(e)}getEffectList(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getEffectList();return Pn.WeakHandle_isValid(t)?this._modules.effectData_Internal.getOrCreateSkewCopy(t):[]}getEffectList_SGEO(e){let t=this._prototype().getEffectList_SGEO(e);return Pn.WeakHandle_isValid(t)?this._modules.effectData_Internal.getOrCreateSkewCopy(t):[]}getGUID(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getGUID(t),J._new(At.retGUID_sessionId,At.retGUID_localId)}getGUID_SGEO(e){return this._prototype().getGUID_SGEO(e),J._new(At.retGUID_sessionId,At.retGUID_localId)}getStyleId(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getStyleId(t),{guid:At.retStyleId.guid,ref:At.retStyleId.ref}}getStyleId_SGEO(e){return this._prototype().getStyleId_SGEO(e),{guid:At.retStyleId.guid,ref:At.retStyleId.ref}}getInt(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getInt(t)}getInt_SGEO(e,t){return this._prototype().getInt_SGEO(e,t)}getPaintList(e,t){this.prepareCppNodeForAccess(e);let r=this._prototype().getPaintList(t);return Pn.WeakHandle_isValid(r)?this._modules.paintData_Internal.getOrCreateSkewCopy(r):[]}getPaintList_SGEO(e){let t=this._prototype().getPaintList_SGEO(e);return Pn.WeakHandle_isValid(t)?this._modules.paintData_Internal.getOrCreateSkewCopy(t):[]}getField(e,t){this.prepareCppNodeForAccess(e);let r=this._prototype().getField(t);if(r.length==0)return null;let n=ke().decodeMessage(r);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField");let o=n.nodeChanges[0],a=[],s=null;return this._appState.serialization().decodeNodeChange(o,a,(l,c)=>{s=c}),s}getField_SGEO(e){let t=this._prototype().getField_SGEO(e);if(t.length==0)return null;let r=ke().decodeMessage(t);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField_SGEO");let n=r.nodeChanges[0],o=[],a=null;return this._appState.serialization().decodeNodeChange(n,o,(s,l)=>{a=l}),a}getParentIndex(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getParentIndex();return Vr.fromString(t)}getParentIndex_SGEO(e){return Vr.fromString(this._prototype().getParentIndex_SGEO(e))}getPrototypeInteractions_SGEO(e){let t=this._prototype().getPrototypeInteractions_SGEO(e);return Pn.WeakHandle_isValid(t)?this._modules.prototypeInteractions_Internal.getOrCreateSkewCopy(t):[]}getString(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getString(t)}getString_SGEO(e){return this._prototype().getString_SGEO(e)}getVector(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getVector(t),new R(At.retVector_x,At.retVector_y)}getVector_SGEO(e){return this._prototype().getVector_SGEO(e),new R(At.retVector_x,At.retVector_y)}getOverridePath(e){return this.prepareCppNodeForAccess(e),new yt(this._prototype().overridePath())}getStablePath(e){return this.prepareCppNodeForAccess(e),new yt(this._prototype().stablePath())}hasNodeProperty(e,t){return this.prepareCppNodeForAccess(e),this._prototype().hasNodeProperty(t)}forEachField(e,t){this.prepareCppNodeForAccess(e),At.forEachFieldCallback=t,this._prototype().forEachField(),At.forEachFieldCallback=null}applyLocalNodeChangesForTests(e){if(!Fo())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().applyLocalNodeChangesForTests(e)}clearDirtyTextLayoutForTests(e){if(!Fo())throw new Error("Should not be calling flushLayoutForTests outside of tests");this._prototype().clearDirtyTextLayoutForTests(e.handle())}updateSymbolInstancesForTests(){if(!Fo())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateSymbolInstancesForTests()}updateStylesForTests(){if(!Fo())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateStylesForTests()}topLevelPrototypeStartingPointsSorted(e){return this._prototype().topLevelPrototypeStartingPointsSorted(e)}},fp=class fp{isReady(){return this._isReady}createScene(e){return new _t(e)}setViewer(e){this._viewer=e}getViewer(){return this._viewer}handleUncompressedMessage(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.handleUncompressedMessage(e,t)}getSceneLoadingPhase(){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.getSceneLoadingPhase()}handleUncompressedSchema(e){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.handleUncompressedSchema(e)}didReceiveNodeChanges(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.didReceiveNodeChanges(e,t)}setMultiplayer(e){this._multiplayer=e}findScene(e){return L().modules().prototype.getScene(e)}findNode(e){return zt.IntMap_get(this._nodes,e,null)}setReverseVariantBindingsForICsDisabled(e){let t=this._reverseVariantBindingsForICsDisabled;return this._reverseVariantBindingsForICsDisabled=e,t}reverseVariantBindingsForICsDisabled(){return this._reverseVariantBindingsForICsDisabled}ready(){this._isReady=!0}track(e,t){De.trackEventJSON1(e,t)}triggerViewerEvent(e,t){this._viewer!==null&&this._viewer.trigger(e,t)}Node_created(e,t,r,n){if(t!=null){let o=new gp(e,t,J._new(r,n));this._nodes.set(e,o),t.dangerouslyRegisterNode(o)}else throw new Error("Cannot create node with null scene")}Node_destroyed(e){let t=this.findNode(e);if(t!=null){let r=t.scene();r!=null&&r.dangerouslyUnregisterNode(t.id()),this._nodes.delete(e)}}triggerSceneGraphEvent(e,t,r){let n=this.findNode(e);if(n==null)return;let o=n.scene();if(o!=null){let a=t,s=n.id(),l=wb(L(),o,s,a,r),c=null,d=!1;a==98?nt.asStringEnum(l,"CREATED")=="CREATED"?(c="REMOVED",d=!0):c="CREATED":c=cp(L(),n,a),o.broadcastPropertyChange(new ap(n,a,l,c)),d&&o.dangerouslyUnregisterNode(s)}}updateNodeAfterPropertyChange(e,t){let r=this.findNode(e);r!=null&&r.updateAfterPropertyChange(t)}linkNodeToParent(e,t,r){let n=this.findNode(e);n!=null&&n.linkToParent(this.findNode(t),r)}unlinkNodeFromParent(e){let t=this.findNode(e);t!=null&&t.unlinkFromParent()}debugPrototypeActionFromPreview(e){top.postMessage({debugPrototypeActionFromPreview:e},window.origin)}didEncounterTimeSlicedIFLMessage(){Lt.didEncounterTimeSlicedIFLMessage()}timeSliceIFLEnabled(){return X.prototypeIFLTimeSlice()}retAffineTransform(e,t,r,n,o,a){At.retAffineTransform_m00=e,At.retAffineTransform_m01=t,At.retAffineTransform_m02=r,At.retAffineTransform_m10=n,At.retAffineTransform_m11=o,At.retAffineTransform_m12=a}retArcData(e,t,r){At.retArcData_startAngle=e,At.retArcData_endAngle=t,At.retArcData_innerRadius=r}retGUID(e,t){At.retGUID_sessionId=e,At.retGUID_localId=t}retStyleId(e){At.retStyleId=e}retVector(e,t){At.retVector_x=e,At.retVector_y=t}forEachFieldCallback(e){At.forEachFieldCallback!=null&&At.forEachFieldCallback(e)}constructor(){this._viewer=null,this._isReady=!1,this._multiplayer=null,this._nodes=new Map,this._reverseVariantBindingsForICsDisabled=!1}};fp.instance=new fp;var _n=fp,At;(_=>(_.retAffineTransform_m00=0,_.retAffineTransform_m01=0,_.retAffineTransform_m02=0,_.retAffineTransform_m10=0,_.retAffineTransform_m11=0,_.retAffineTransform_m12=0,_.retArcData_startAngle=0,_.retArcData_endAngle=0,_.retArcData_innerRadius=0,_.retGUID_sessionId=0,_.retGUID_localId=0,_.retStyleId=null,_.retVector_x=0,_.retVector_y=0,_.forEachFieldCallback=null))(At||(At={}));var Nc;(a=>{function i(s,l,c){s.set(l,c)}a.Map_set1=i;function e(s,l){return s.get(l)}a.Map_get1=e;function t(s,l,c){let d=s.get(l);return d!==void 0?d:c}a.Map_getOrDefault=t;function r(s){return Array.from(s.keys())}a.Map_keys=r;function n(s){return Array.from(s.values())}a.Map_values=n;function o(s,l){let c=new Map;for(let d=0,h=s.length;d<h;d=d+1)c.set(s[d],l[d]);return c}a.Map_new1=o})(Nc||(Nc={}));var Fb;(r=>{function i(n,o){return n.get(o)}r.WeakMap_get1=i;function e(n,o,a){n.set(o,a)}r.WeakMap_set1=e;function t(n,o){let a=new WeakMap;for(let s=0,l=n.length;s<l;s=s+1)a.set(n[s],o[s]);return a}r.WeakMap_new1=t})(Fb||(Fb={}));var qi=class i{startAnimation(e,t){this._animationCurve=e,this._animationStartTime=We.seconds(),this._animationEndTime=this._animationStartTime+t}animationProgress(){let e=(We.seconds()-this._animationStartTime)/(this._animationEndTime-this._animationStartTime);return this._animationCurve==i.Curve.EASE_IN_OUT?e*=e*e*(e*(e*6-15)+10):(e=1-e,e=1-e*e*e*e*e),Math.min(e,1)}constructor(){this._animationCurve=i.Curve.EASE_IN_OUT,this._animationStartTime=0,this._animationEndTime=0}};(e=>{let i;(n=>(n[n.EASE_IN_OUT=0]="EASE_IN_OUT",n[n.DECAY=1]="DECAY"))(i=e.Curve||(e.Curve={}))})(qi||(qi={}));var uo=class uo{zoomScale(){return this._boundsMapping.viewPixelsPerCanvasPixel()}viewSpaceBounds(){return this._boundsMapping.viewSpaceBounds()}resetStateForTests(){this._boundsMapping=new _p,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._dummyOffset=R.new2(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._boundsOfDevicePreview=V.new2(),this._minZoom=0,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=R.new2(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=V.new2()}pixelSpaceBounds(e){let t=this.viewSpaceBounds();return new V(t.left()*e,t.top()*e,t.width()*e,t.height()*e)}_clampingBoundsForCanvasSpaceOffset(){return this._boundsMapping.clampingBoundsForCanvasSpaceOffset()}copyFrom(e){this._boundsMapping=e._boundsMapping.clone(),this._boundsOfDevicePreview.copyFrom(e._boundsOfDevicePreview),this._isInvalid=e._isInvalid,this._minZoom=e._minZoom,this._scrollPadding=e._scrollPadding}offsetX(){return this.offset().x()}offsetY(){return this.offset().y()}offset(){return this._boundsMapping.canvasSpaceOrigin().negative()}_setCanvasSpaceOffsetTo(e){this._boundsMapping.setCanvasSpaceOriginTo(e.negative())}canvasSpaceToViewSpace1(){return X.isInlinePreview()?this.canvasSpaceToViewSpace2(1):this.canvasSpaceToViewSpace2(0)}canvasSpaceToViewSpace2(e){return this._boundsMapping.canvasSpaceToViewSpace(e)}viewSpaceToCanvasSpace1(){return X.isInlinePreview()?this._boundsMapping.viewSpaceToCanvasSpace(1):this._boundsMapping.viewSpaceToCanvasSpace(0)}viewSpaceToCanvasSpace2(e){return this._boundsMapping.viewSpaceToCanvasSpace(e)}viewSpaceToClipSpace(){let e=ee.new2().copyFrom(Nt.FrozenAffineTransform_IDENTITY);return e.copyFrom(Nt.FrozenAffineTransform_IDENTITY),e.scale4(1,-1),e.translate2(-1,-1),e.scale4(2/this.viewSpaceBounds().width(),2/this.viewSpaceBounds().height()),e}canvasSpaceToClipSpace1(){return X.isInlinePreview()?this.canvasSpaceToClipSpace2(1):this.canvasSpaceToClipSpace2(0)}canvasSpaceToClipSpace2(e){let t=this.viewSpaceToClipSpace();return t.multipliedBy2(this.canvasSpaceToViewSpace2(e)),t}computeCanvasSpaceBounds1(e){X.isInlinePreview()?this.computeCanvasSpaceBounds2(e,1):this.computeCanvasSpaceBounds2(e,0)}computeCanvasSpaceBounds2(e,t){this._boundsMapping.computeCanvasSpaceBounds(e,t)}isInvalid(){return this._isInvalid}invalidate(){this._isInvalid=!0}setBounds(e){(this.viewSpaceBounds()==null||!this.viewSpaceBounds().equals(e))&&(this._boundsMapping.setViewSpaceBounds(e),this._isInvalid=!0)}_setCamera1(e,t,r,n){e==1?this._setCameraWithAnimation(t,r,qi.Curve.EASE_IN_OUT,n):(this._isAnimating=!1,(!this.offset().equals(t)||this.zoomScale()!=r)&&(this._setCanvasSpaceOffsetTo(t),this._boundsMapping.setViewPixelsPerCanvasPixel(r),this._isInvalid=!0))}_setCamera2(e,t,r){this._setCamera1(e,t,r,uo.ANIMATION_DURATION)}_setCameraWithAnimation(e,t,r,n){this._animationManager.startAnimation(r,n),this._animationOffsetStart=this.offset().clone(),this._animationOffsetEnd=e.clone(),this._animationZoomScaleStart=this.zoomScale(),this._animationZoomScaleEnd=this._clampedZoomScale(t),this._calculateBoundsForClamping(this._animationZoomScaleEnd,this._animationEndBounds),this._clampedAnimationOffsetEnd.setTo(lr.Math_clamp(e.x(),this._animationEndBounds.left(),this._animationEndBounds.right()),lr.Math_clamp(e.y(),this._animationEndBounds.top(),this._animationEndBounds.bottom())),this._isAnimating=!0,this._isInvalid=!0}_clampCameraOffset(){if(!this._useClamping)return;this._dummyOffset.copyFrom(this.offset()),this._updateBoundsForClamping(),this._setCanvasSpaceOffsetTo(this._dummyOffset);let e=lr.Math_clamp(this.offsetX(),this._clampingBoundsForCanvasSpaceOffset().left(),this._clampingBoundsForCanvasSpaceOffset().right()),t=lr.Math_clamp(this.offsetY(),this._clampingBoundsForCanvasSpaceOffset().top(),this._clampingBoundsForCanvasSpaceOffset().bottom()),r=1e-6;if(Math.abs(this.offsetX()-e)>r||Math.abs(this.offsetY()-t)>r)if(this._isAnimating&&this._animationZoomScaleStart==this._animationZoomScaleEnd)this.offsetX()!=e&&(this._animationOffsetStart=new R(e,this._animationOffsetStart.y()),this._animationOffsetEnd=new R(e,this._animationOffsetEnd.y()),this._setCanvasSpaceOffsetTo(new R(e,this.offset().y()))),this.offsetY()!=t&&(this._animationOffsetStart=new R(this._animationOffsetStart.x(),t),this._animationOffsetEnd=new R(this._animationOffsetEnd.x(),t),this._setCanvasSpaceOffsetTo(new R(this.offset().x(),t))),this._animationOffsetStart.equals(this._animationOffsetEnd)&&(this._isAnimating=!1);else if(this._isAnimating){if(this._alreadySetAnimationClamp)return;this._animationOffsetStart=this.offset(),this._animationOffsetEnd=this._clampedAnimationOffsetEnd,this._alreadySetAnimationClamp=!0}else this._setCamera2(0,new R(e,t),this.zoomScale());this.zoomScale()<this._minZoom&&this._boundsMapping.setViewPixelsPerCanvasPixel(this._minZoom)}setCameraZoom(e,t){let r=e==1&&this._isAnimating;this._setCamera2(e,r?this._animationOffsetEnd:this.offset(),t)}adjustCameraZoom1(e,t){let r=e==1&&this._isAnimating;this._setCamera2(e,r?this._animationOffsetEnd:this.offset(),(r?this._animationZoomScaleEnd:this.zoomScale())*t)}adjustCameraZoom2(e,t,r){let n=e==1&&this._isAnimating;this._setCamera1(e,n?this._animationOffsetEnd:this.offset(),(n?this._animationZoomScaleEnd:this.zoomScale())*t,r)}adjustCameraZoomRounded(e,t){let r=e==1&&this._isAnimating;this.setCameraZoom(1,Math.pow(2,Math.round(Math.log((r?this._animationZoomScaleEnd:this.zoomScale())*t)/Math.log(2))))}setCameraOffset1(e,t){this.setCameraOffset2(e,t,uo.ANIMATION_DURATION)}setCameraOffset2(e,t,r){let n=e==1&&this._isAnimating;this._setCamera1(e,t,n?this._animationZoomScaleEnd:this.zoomScale(),r),this._clampCameraOffset()}panCamera(e){this._setCamera2(0,this.offset().add1(e.divide(this.zoomScale())),this.zoomScale()),this._clampCameraOffset()}flingCameraOffset(e,t){this._setCameraWithAnimation((this._isAnimating?this._animationOffsetEnd:this.offset()).add1(e.divide(this.zoomScale())),this._isAnimating?this._animationZoomScaleEnd:this.zoomScale(),qi.Curve.DECAY,t),this._clampCameraOffset()}adjustCameraZoomWithPin(e,t){let r=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add1(t.subtract1(this.viewSpaceBounds().size().divide(2)).multiply(1/r-1/this.zoomScale())),r),this._clampCameraOffset()}adjustCameraZoomAndOffset(e,t,r){let n=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add1(r.subtract1(this.viewSpaceBounds().size().divide(2)).divide(n)).subtract1(t.subtract1(this.viewSpaceBounds().size().divide(2)).divide(this.zoomScale())),n),this._clampCameraOffset()}zoomToFit1(e,t,r){this._zoomToFit(e,t,uo.ZOOM_TO_FIT_PADDING,r)}zoomToFit2(e,t){this._zoomToFit(e,t,uo.ZOOM_TO_FIT_PADDING,uo.ANIMATION_DURATION)}zoomToFitExactly(e,t){this._zoomToFit(e,t,0,uo.ANIMATION_DURATION)}_zoomToFit(e,t,r,n){t.isEmpty()||(this._setCamera1(e,t.center().negative(),this.viewSpaceBounds().size().subtract(2*r).divide1(t.size()).min1(),n),this._clampCameraOffset())}prepareForRendering(){if(this._isAnimating){let e=this._animationManager.animationProgress();e>=1?(this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.clone()),this._boundsMapping.setViewPixelsPerCanvasPixel(this._animationZoomScaleEnd),this._isAnimating=!1,this._alreadySetAnimationClamp=!1):(this._boundsMapping.setViewPixelsPerCanvasPixel(1/(1/this._animationZoomScaleStart+(1/this._animationZoomScaleEnd-1/this._animationZoomScaleStart)*e)),this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.subtract1(this._animationOffsetStart).multiply(e).add1(this._animationOffsetStart)))}this._isInvalid=this._isAnimating}getScaleFactorForCurrentTlf(e,t,r){let n=Rn.canvasSpaceContentSize(e,r);if(n.x()===0||n.y()===0)return 1;switch(t){case 5:return n.x()>this.viewSpaceBounds().width()?this.viewSpaceBounds().width()/n.x():1;case 6:return this.viewSpaceBounds().width()/n.x();case 2:case 1:{let o=1/Math.max(n.x()/this.viewSpaceBounds().width(),n.y()/this.viewSpaceBounds().height());return t==2&&(o=Math.min(o,1)),o=Math.ceil(o*e.y())/e.y(),o}case 3:return 1;case 0:return 1;case 4:return 0;default:return 1}}_clampedZoomScale(e){let t=Math.max(this._minZoom,uo.ZOOM_MIN);return Math.max(t,Math.min(e,uo.ZOOM_MAX))}setScrollPadding(e){this._scrollPadding=e}previewBoundsIncludingDeviceFrame(e,t,r){return r!=null&&pa.hasDevice(r.type)?Rn.adjustNodeBoundsForDevice(e,r):X.isInlinePreview()?e:t}_snapOffsetToPixelGrid(e,t){let r=e.add1(t).multiply(this.zoomScale()*2);r.setX(Math.floor(r.x())),r.setY(Math.floor(r.y()));let n=r.divide(this.zoomScale()*2).subtract1(t);return t.add1(n.subtract1(e))}_calculateBoundsForClamping(e,t){let r=this._boundsOfDevicePreview.isInvalid()?V.new2():this._boundsOfDevicePreview,n=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[2])/e,r.width()/2),o=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[3])/e,r.height()/2),a=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[0])/e,r.width()/2),s=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[1])/e,r.height()/2),l=-r.right()+n,c=-r.bottom()+o,d=-r.left()-a,h=-r.top()-s,u=d-l,m=h-c;t.setTo1(l,c,u,m)}_updateBoundsForClamping(){let e=V.new2();this._calculateBoundsForClamping(this.zoomScale(),e),this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(e)}updateForBaseScreen(e,t,r){this.updateForCurrentPreview(e==null?void 0:e.canvasSpaceBoundingBox(),e==null?void 0:e.canvasSpacePreviewBounds(),t,r)}updateForCurrentPreview(e,t,r,n){if(t==null||e==null){this._useClamping=!1;return}switch(this._boundsOfDevicePreview.copyFrom(this.previewBoundsIncludingDeviceFrame(e,t,n)),this._minZoom=this.getScaleFactorForCurrentTlf(t.size(),r,n),r){case 4:{this._useClamping=!1;break}case 3:case 5:case 0:case 6:{this._useClamping=!0,this._updateBoundsForClamping(),this._clampCameraOffset();let o=n!=null&&n.type!="NONE";to.userCanManuallyZoom(r,o)||this.setCameraZoom(0,this._minZoom);break}case 1:case 2:{this._useClamping=!0;let o=this._snapOffsetToPixelGrid(t.topLeft(),this._boundsOfDevicePreview.center().negative());this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(new V(o.x(),o.y(),0,0)),this._setCamera2(0,o,this._minZoom);break}}}constructor(){this._boundsMapping=new _p,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._boundsOfDevicePreview=V.new2(),this._dummyOffset=R.new2(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._minZoom=0,this._animationManager=new qi,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=R.new2(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=V.new2()}};uo.ZOOM_MIN=Math.pow(2,-6),uo.ZOOM_MAX=Math.pow(2,8),uo.ZOOM_TO_FIT_PADDING=50,uo.ANIMATION_DURATION=.2;var qo=uo,_p=class i{canvasSpaceOrigin(){return this._defaultCanvasSpaceOrigin().add1(this._canvasSpaceOriginDelta)}setCanvasSpaceOriginTo(e){this._canvasSpaceOriginDelta=e.subtract1(this._defaultCanvasSpaceOrigin())}viewSpaceBounds(){return this._viewSpaceBounds}setViewSpaceBounds(e){this._viewSpaceBounds=e}viewPixelsPerCanvasPixel(){return this._viewPixelsPerCanvasPixel}setViewPixelsPerCanvasPixel(e){this._viewPixelsPerCanvasPixel=e}clampingBoundsForCanvasSpaceOffset(){return this._clampingBoundsForCanvasSpaceOffset}setClampingBoundsForCanvasSpaceOffset(e){this._clampingBoundsForCanvasSpaceOffset.copyFrom(e)}canvasSpaceToViewSpace(e){let t=Nn.new2().translatedBy2(this._viewSpaceBounds.width()/2,this._viewSpaceBounds.height()/2).scaledBy(this._viewPixelsPerCanvasPixel).translatedBy1(this.canvasSpaceOrigin().negative()),r=Nn.new2();if(e==0){let n=R.new3(this.canvasSpaceOrigin()).rounded(),o=t.transformPoint(n),a=-(o.x()-Math.floor(o.x())),s=-(o.y()-Math.floor(o.y()));r.translate1(a,s)}return r.multiply(t),r}viewSpaceToCanvasSpace(e){let t=this.canvasSpaceToViewSpace(e).clone();return t.invert(),t}computeCanvasSpaceBounds(e,t){this._viewSpaceBounds.transformInto2(e,this.viewSpaceToCanvasSpace(t))}_defaultCanvasSpaceOrigin(){return this._clampingBoundsForCanvasSpaceOffset!=null?this._clampingBoundsForCanvasSpaceOffset.bottomRight().negative():ye.FrozenVector_ZERO}clone(){let e=new i;return e._canvasSpaceOriginDelta=this._canvasSpaceOriginDelta.clone(),e._viewPixelsPerCanvasPixel=this._viewPixelsPerCanvasPixel,e._viewSpaceBounds=this._viewSpaceBounds.clone(),e._clampingBoundsForCanvasSpaceOffset=this._clampingBoundsForCanvasSpaceOffset.clone(),e}constructor(){this._canvasSpaceOriginDelta=R.new2(),this._viewPixelsPerCanvasPixel=1,this._viewSpaceBounds=null,this._clampingBoundsForCanvasSpaceOffset=V.new2()}};var Oc=class i{constructor(e,t,r){this._numStatesTransferred=0;this._numStatesReset=0;this._appState=null,this._prototypeState=null,this._semanticChangeHistoryStorage=new ya,this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set,this._swapStateCallback=null,this._appState=e,this._prototypeState=t,this._swapStateCallback=r,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this)}static getStateGroupID(e){var n;let t=e!=null?e.scene().findNode(e==null?void 0:e.symbolID()):null,r=(n=t==null?void 0:t.findContainingStateGroupOrSelf())==null?void 0:n.id();return r??J.invalid()}getComponentHistory(e,t){if(e.length==0)return[];let r=this._semanticChangeHistoryStorage.getData(e,t);return r??[]}setComponentHistory(e,t,r){this._semanticChangeHistoryStorage.insert(e,t,r)}handleStateChangeCommitted(e,t){}_transferChildComponentStates(e){e!=null&&e.forEachChild(t=>{this._setInstanceChangeHistory(t),this._transferChildComponentStates(t)})}_hasStateToTranfer(e,t){return t.length>0&&e.symbolID()!=ce.List_last(t).newStateId()}_setInstanceChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=vr.getSemanticNodePath(new Kt(e)),r=this.getComponentHistory(t,i.getStateGroupID(e)),n=this._prototypeState.getStateMachineOrNull(e.stablePath());n!=null&&this._hasStateToTranfer(e,r)&&!this._stateAlreadyManagedByVariables(e)&&(n.setChangeHistory(r),this._swapStateCallback(e.stablePath(),ce.List_last(r).newStateId(),0),this._numStatesTransferred++)}}_resetChildComponentStates(e,t){e!=null&&e.forEachChild(r=>{this._clearInstanceChangeHistory(r,t),this._resetChildComponentStates(r,t)})}_nodeIsInstance(e){return e!=null&&e.type()=="INSTANCE"}_nodeHasStoredState(e,t){let r=L();return!t&&r!=null&&this._nodeIsInstance(e)?r.nodeHasLocalSymbolChanges(e.id()):!1}_clearInstanceChangeHistory(e,t){var r,n;if(e!=null&&(this._isInteractiveComponent(e)||this._nodeHasStoredState(e,t))&&!this._stateAlreadyManagedByVariables(e)){this._numStatesReset++,t?(r=L())==null||r.resetLocalNestedInstanceChanges([e.id()]):(n=L())==null||n.resetLocalInstanceChanges([e.id()]);let o=vr.getSemanticNodePath(new Kt(e));this._semanticChangeHistoryStorage.remove(o,i.getStateGroupID(e))}}_hasStateToStore(e,t,r){if(t==null||t.length==0)return!1;if(r==null||r.length==0)return!0;let n=ce.List_last(r);return e.symbolID()!=n.newStateId()}_storeChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=this._prototypeState.getStateMachineOrNull(e.stablePath());if(t!=null){let r=vr.getSemanticNodePath(new Kt(e)),n=i.getStateGroupID(e),o=this.getComponentHistory(r,n),a=t.changeHistory();this._hasStateToStore(e,a,o)&&!this._stateAlreadyManagedByVariables(e)&&this.setComponentHistory(r,n,a)}}}_storeChangeHistoryForChildren(e){e!=null&&e.forEachChild(t=>{this._storeChangeHistory(t),this._storeChangeHistoryForChildren(t)})}_semanticPathToString(e){let t=vr.getSemanticNodePath(new Kt(e)),r=":/:",n=i.getStateGroupID(e);return t.length==1?t[0].toStringWithPrefix(!0):t.reduce((o,a,s)=>s==0?o:o+a.toString()+r,"")+r+n}_recordInteraction(e,t){if(t.transitionParameters.navigationType=="SWAP_STATE"&&!ut.isTransientAction(t.cause)){let r=this._appState.scene().findNodeByStablePath(e);if(r==null)return;let n=this._semanticPathToString(r);this._semanticPathInteracted.add(n)}}_semanticPathHasBeenInteractedWith(e){return this._semanticPathInteracted.has(this._semanticPathToString(e))}_nodeHasBeenInteractedWith(e){return i.getStateGroupID(e)!=J.invalid()?this._semanticPathHasBeenInteractedWith(e):!1}_isInteractiveComponent(e){return this._nodeIsInstance(e)?i.getStateGroupID(e)!=J.invalid():!1}_stateAlreadyManagedByVariables(e){return e!=null&&e.getBoundVariables().componentProperties}handleStateChangeAborted(e){}handleStateChangeInitiated(e){if(e.stateManagementVersion()==1){let t=e.oldStateAndOverlays.topId(),r=e.newStateAndOverlays.topId(),n=this._appState.scene().findNode(t),o=this._appState.scene().findNode(r);this._storeChangeHistory(n),this._storeChangeHistoryForChildren(n),e.resetInteractiveComponents()==0?(this._numStatesReset=0,this._clearInstanceChangeHistory(o,!1),this._resetChildComponentStates(o,!1),this._sendStateResetLog()):(this._numStatesTransferred=0,this._setInstanceChangeHistory(o),this._transferChildComponentStates(o),this._sendStateTransferLog())}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._semanticChangeHistoryStorage.uninitialize1(),this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set}handleHsmAborted(e,t){}handleHsmCommitted(e,t,r){t.stateManagementVersion()==1&&this._recordInteraction(e,t)}handleHsmRequested(e,t){if(t.stateManagementVersion()==1){let r=this._appState.scene().findNodeByStablePath(e);this._storeChangeHistoryForChildren(r)}}handleHsmInitiated(e,t){if(t.stateManagementVersion()==1){let r=this._appState.scene().findNodeByStablePath(e);t.resetInteractiveComponents()!=0?(this._numStatesTransferred=0,this._transferChildComponentStates(r),this._sendStateTransferLog()):(this._numStatesReset=0,this._resetChildComponentStates(r,!0),this._sendStateResetLog())}}_sendStateTransferLog(){this._numStatesTransferred>0&&De.trackDefinedEvent("prototype.viewer_interaction_state_transferred",{count:this._numStatesTransferred})}_sendStateResetLog(){this._numStatesReset>0&&De.trackDefinedEvent("prototype.viewer_interaction_state_reset",{count:this._numStatesReset})}debugString(){return this._semanticChangeHistoryStorage.toString2(e=>{let t="",r=Math.max(e.length-4,0);r!=0&&(t="..., ");for(let n=r,o=e.length;n<o;n=n+1){let a=e[n];t+=`${(a==null?void 0:a.oldStateId())??"null"}->${a==null?void 0:a.newStateId()}`,n!=e.length-1&&(t+=", ")}return t})}};var wc=class i{constructor(e,t,r,n,o,a,s){this.id=null,this.overlayDataModelId=null,this.openingHotspotStablePath=null,this.openingInteractionId=null,this.openingTransition=null,this.oldOverlayDerivedModes=null,this.newOverlayExplicitModes=null,this.id=e,this.overlayDataModelId=t,this.openingHotspotStablePath=r,this.openingInteractionId=n,this.openingTransition=o,this.oldOverlayDerivedModes=a,this.newOverlayExplicitModes=s}cloneWithId(e,t){return new i(e,this.overlayDataModelId,this.openingHotspotStablePath,this.openingInteractionId,this.openingTransition,t)}openingTransitionType(){return this.openingTransition.transitionType}},nl=class{constructor(e,t,r,n,o,a,s,l){this.overlayId=e,this.overlayNode=t,this.bounds=r,this.baseTlfCursor=n,this.backgroundAppearance=o,this.backgroundTransitionProgress=a,this.transform=s,this.animationTransform=l}},Yi=class{constructor(e=new Map){this._hasTransitionComputed=!1;this._hasTransition=!1;this._multiOverlayMap=e}hasTransition(){if(this._hasTransitionComputed)return this._hasTransition;for(let e of Array.from(this._multiOverlayMap.keys()))if(this._multiOverlayMap.get(e).backgroundTransitionProgress!=null||this._multiOverlayMap.get(e).transform!=null||this._multiOverlayMap.get(e).animationTransform!=null){this._hasTransition=!0,this._hasTransitionComputed=!0;break}return this._hasTransition}count(){return this._multiOverlayMap.size}addEntry(e,t){this._multiOverlayMap.set(e,t),this._hasTransitionComputed=!1}removeEntry(e){this._multiOverlayMap.delete(e),this._hasTransitionComputed=!1}get(e){return He.StringMap_get(this._multiOverlayMap,e,null)}keys(){return Array.from(this._multiOverlayMap.keys())}overlayCacheKey(){let e=[];for(let t of this.keys())e.push(t);return new yt(e)}},xc=class{id(){return this._data.id}overlayDataModelId(){return this._data.overlayDataModelId}openingHotspotStablePath(){return this._data.openingHotspotStablePath}previousOverlay(){return this._previousOverlay}openingTransitionType(){return this._data.openingTransitionType()}node(){return this.scene.findNode(this.id())}backgroundInteraction(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?"NONE":e.overlayBackgroundInteraction()}backgroundAppearance(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?new ei:e.overlayBackgroundAppearance()}positionType(){let e=this.scene.findNode(this._data.overlayDataModelId);return e==null?"CENTER":e.overlayPositionType()}relativePosition(){return this._data.openingTransition.overlayRelativePosition}renderedOrigin(e){let t=this.node();if(t==null)return ye.FrozenVector_new1();let r=null;if(this.positionType()=="MANUAL"){if(this._stackPosition>0){let o=this.scene.findNode(this._previousOverlay.id()).canvasSpaceBoundingBox(),a=this._previousOverlay.renderedOrigin(e),s=this.scene.findNodeByStablePath(this.openingHotspotStablePath());s!=null&&(r=s.canvasSpaceScrolledBounds(1).topLeft().add1(a.subtract1(o.topLeft())))}if(r==null){let n=this.scene.findNodeByStablePath(this.openingHotspotStablePath());n!=null&&(r=n.canvasSpaceScrolledBounds(1).topLeft())}if(r==null)return ye.FrozenVector_new1()}return Pc.BoundOverlay_computeOrigin(t,e,this._data.openingTransition,r,this.positionType())}renderedBounds(e){let t=this.scene.findNode(this._data.id);if(t==null)return Br.FrozenRect_new1();let r=t.canvasSpaceBoundingBox().size(),n=this.renderedOrigin(e);return Br.FrozenRect_new4(n.x(),n.y(),r.x(),r.y())}deltaFromRenderedPositionToCanvasSpacePosition(e){let t=this.scene.findNode(this._data.id);return t==null?new R(0,0):this.renderedOrigin(e).subtract1(t.canvasSpaceBoundingBox().topLeft())}baseTlfSpaceToOverlaySpace1(e,t){let r=this.scene.findNode(this._data.id);if(r==null||t==null||e==null)return ye.FrozenVector_ZERO;let n=this.renderedOrigin(e),o=r.canvasSpaceBoundingBox().topLeft();return t.add1(o).subtract1(n)}baseTlfSpaceToOverlaySpace2(e,t){return V.new4(this.baseTlfSpaceToOverlaySpace1(e,t.topLeft()),t.size())}overlaySpaceToBaseTlfSpace1(e,t){let r=this.baseTlfSpaceToOverlaySpace1(e,t);return t.add1(t.subtract1(r))}overlaySpaceToBaseTlfSpace2(e,t){return V.new4(this.overlaySpaceToBaseTlfSpace1(e,t.topLeft()),t.size())}constructor(e,t,r,n){this.scene=e,this._data=t,this._previousOverlay=r,this._stackPosition=n}},Pc;(t=>{function i(r,n,o,a,s){if(r==null)return R.new2();let l=r.canvasSpaceBoundingBox().size();if(s=="MANUAL")return new R(a.x()+o.overlayRelativePosition.x(),a.y()+o.overlayRelativePosition.y());{let c=n.canvasSpaceBoundingBox(),d=c.topLeft(),h=c.size(),u=d.x();switch(s){case"TOP_LEFT":case"BOTTOM_LEFT":break;case"TOP_CENTER":case"CENTER":case"BOTTOM_CENTER":{u+=h.x()/2-l.x()/2;break}case"TOP_RIGHT":case"BOTTOM_RIGHT":{u+=h.x()-l.x();break}}let m=d.y();switch(s){case"TOP_LEFT":case"TOP_CENTER":case"TOP_RIGHT":break;case"CENTER":{m+=h.y()/2-l.y()/2;break}case"BOTTOM_LEFT":case"BOTTOM_CENTER":case"BOTTOM_RIGHT":{m+=h.y()-l.y();break}}return new R(u,m)}}t.BoundOverlay_computeOrigin=i;function e(r,n,o,a,s){let l=r.canvasSpaceBoundingBox().size(),c=i(r,n,o,a,s);return Br.FrozenRect_new4(c.x(),c.y(),l.x(),l.y())}t.BoundOverlay_computeNewBounds=e})(Pc||(Pc={}));var Ap=class i{opacity1(){return this._opacity}translation1(){return this._translation}transform1(){return this._transform}scaling1(){return this._scaling}transformOrigin1(){return this._transformOrigin}fillPaints1(){return this._fillPaints}strokePaints1(){return this._strokePaints}cornerRadii1(){return this._cornerRadii}rectangleSize1(){return this._rectangleSize}clone(){var t,r;let e=new i;return e._opacity=this._opacity,e._translation=this._translation.clone(),e._transform=this._transform.clone(),e._scaling=this._scaling,e._transformOrigin=(t=this._transformOrigin)==null?void 0:t.clone(),e._fillPaints=this._fillPaints,e._strokePaints=this._strokePaints,e._cornerRadii=this._cornerRadii,e._rectangleSize=(r=this._rectangleSize)==null?void 0:r.clone(),e}_areVectorsEqual(e,t){return e==null&&t==null?!0:e==null||t==null?!1:e.equals(t)}equals(e){return this._opacity==e.opacity1()&&this._transform.equals1(e.transform1())&&this._scaling.equals(e.scaling1())&&this._areVectorsEqual(this._transformOrigin,e.transformOrigin1())&&this.translation1().equals(e.translation1())&&jt.FrozenList_equals(this._fillPaints,e.fillPaints1(),(t,r)=>t.equals1(r))&&jt.FrozenList_equals(this._strokePaints,e.strokePaints1(),(t,r)=>t.equals1(r))&&this._cornerRadii.equals(e.cornerRadii1())&&this._areVectorsEqual(this._rectangleSize,e.rectangleSize1())}equalTransformsUpToTranslation(e,t){return this.equalTransformsUpToTranslationAndScaling(e,t)&&this._scaling.equals(e.scaling1())}equalTransformsUpToTranslationAndScaling(e,t){let r=Hn.from(this.transform1()),n=Hn.from(e.transform1()),o=Math.abs(r.angleDegrees-n.angleDegrees)<=t,a=Math.abs(r.m00-n.m00)<=t&&Math.abs(r.m01-n.m01)<=t&&Math.abs(r.m10-n.m10)<=t&&Math.abs(r.m11-n.m11)<=t;return o&&a}opacity2(e){return this._opacity=e,this}translation2(e){return this._translation=e,this}transform2(e){return e!=null,this._transform=e,this}scaling2(e){return this._scaling=e,this}transformOrigin2(e){return this._transformOrigin=e,this}fillPaints2(e){return this._fillPaints=e,this}strokePaints2(e){return this._strokePaints=e,this}cornerRadii2(e){return this._cornerRadii=e,this}rectangleSize2(e){return this._rectangleSize=e,this}withScaledTranslation(e){return this.clone().translation2(this._translation.multiply1(e))}constructor(){this._opacity=1,this._translation=R.new2(),this._transform=Nt.FrozenAffineTransform_new1(),this._scaling=R.new2().withOnesForZeros(),this._transformOrigin=null,this._fillPaints=[],this._strokePaints=[],this._cornerRadii=oo.ZEROS,this._rectangleSize=null}},nn=class i{constructor(e){e?(this._isTransformEqual=!1,this._from=e._from.clone(),this._to=e._to.clone(),this._shouldDoLegacyImageRectSizeTransition=e._shouldDoLegacyImageRectSizeTransition,this._shouldTransitionGeometryForRoundedRectangles=e._shouldTransitionGeometryForRoundedRectangles,this._isTransformEqual=e._isTransformEqual):(this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._from=new Ap,this._to=new Ap,this._isTransformEqual=!0)}from(){return this._from}to(){return this._to}opacity(e,t){return this._from.opacity2(e),this._to.opacity2(t),this}translation(e,t){return this._from.translation2(e),this._to.translation2(t),this}transform(e,t){return this._isTransformEqual=e.equals2(t,1e-6),this._from.transform2(e),this._to.transform2(t),this}scaling(e,t){return this._from.scaling2(e),this._to.scaling2(t),this}shouldDoLegacyImageRectSizeTransition(e){return this._shouldDoLegacyImageRectSizeTransition=e,this}transitionGeometryForRoundedRectangles(e,t,r,n){return this._from.rectangleSize2(e),this._from.cornerRadii2(t),this._to.rectangleSize2(r),this._to.cornerRadii2(n),this._shouldTransitionGeometryForRoundedRectangles=!0,this}transformOrigin(e,t){return this._from.transformOrigin2(e),this._to.transformOrigin2(t),this}fillPaints1(e,t){return this._from.fillPaints2(e),this._to.fillPaints2(t),this}strokePaints1(e,t){return this._from.strokePaints2(e),this._to.strokePaints2(t),this}_getPaints(e,t,r){let n=[];for(let o=0,a=t.length;o<a;o=o+1){let s=t[o],l=r[o];if(s.equals2(l))n.push(s);else{let c=s,d=l;c.opacity()==0&&(c=l.cloneAsSinglePaint(),c.setOpacity(0)),d.opacity()==0&&(d=s.cloneAsSinglePaint(),d.setOpacity(0)),n.push(rc.create(c,d,this._from.transformOrigin1().multiply(2),this._to.transformOrigin1().multiply(2),e))}}return n}fillGeometryForRoundedRectangles(e,t){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let r=Math.max(1-t.top(),t.bottom(),1),n=V.new4(ye.FrozenVector_ZERO,this._from.rectangleSize1().multiply(r).max2(this._to.rectangleSize1().multiply(r))),o=new oc("NONZERO",0,()=>{let a=R.lerp(this._from.rectangleSize1(),this._to.rectangleSize1(),e()),s=this._from.cornerRadii1().toList(),l=this._to.cornerRadii1().toList(),c=[];for(let d=0;d<4;d=d+1)c.push(Math.max(Xt.double_lerp(s[d],l[d],e()),0));return new Ot(new V(0,0,Math.abs(a.x()),Math.abs(a.y())),oo.fromList(c))},n);return new xr([o],[],n,null)}fillGeometryForSpreadDynamic(e,t,r,n,o,a){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let s=this._from.rectangleSize1().add(2*t),l=this._to.rectangleSize1().add(2*t),c=Math.max(1-a.top(),a.bottom(),1),d=V.new4(ye.FrozenVector_ZERO,this._from.rectangleSize1().multiply(c).max2(this._to.rectangleSize1().multiply(c))).expandedBy1(t),h=this._from.cornerRadii1().toList(),u=this._to.cornerRadii1().toList();for(let g=0;g<4;g=g+1)h[g]=h[g]==0?0:h[g]+t,u[g]=u[g]==0?0:u[g]+t;let m=new oc("NONZERO",0,()=>{let g=R.lerp(s,l,r()),_=[];for(let f=0;f<4;f=f+1)_.push(Math.max(Xt.double_lerp(h[f],u[f],r()),0));return new Ot(new V(-t,-t,Math.abs(g.x()),Math.abs(g.y())),oo.fromList(_))},d);return new Ms(()=>new Ft(m.path(),m.windingRule),n,m.bounds(),Ct.forDynamicGeometry(o))}fillPaints2(e){return this._getPaints(e,this._from.fillPaints1(),this._to.fillPaints1())}strokePaints2(e){return this._getPaints(e,this._from.strokePaints1(),this._to.strokePaints1())}hasTransitioningPaints(){return this._to.fillPaints1().length!=0&&this._from.fillPaints1().length!=0||this._to.strokePaints1().length!=0&&this._from.strokePaints1().length!=0}hasLegacyTransitioningSizesForImageRect(){return this._shouldDoLegacyImageRectSizeTransition}hasTransitioningGeometryForRoundedRectangles(){return this._shouldTransitionGeometryForRoundedRectangles}hasTransitioningTranslation(){return this._from.translation1()==null&&this._to.translation1()==null?!1:this._from.translation1()==null||this.to().translation1()==null?!0:!this._from.translation1().equals(this.to().translation1())}hasTransitioningTransform(){return this._from.transform1()==null&&this._to.transform1()==null?!1:this._from.transform1()==null||this.to().transform1()==null?!0:!this._from.transform1().equals1(this.to().transform1())}hasTransitioningScaling(){return this._from.scaling1()==null&&this._to.scaling1()==null?!1:this._from.scaling1()==null||this.to().scaling1()==null?!0:!this._from.scaling1().equals(this.to().scaling1())}hasTransitioningTransformOrigin(){return this._from.transformOrigin1()==null&&this._to.transformOrigin1()==null?!1:this._from.transformOrigin1()==null||this.to().transformOrigin1()==null?!0:!this._from.transformOrigin1().equals(this.to().transformOrigin1())}interpolateOpacity(e){return Xt.double_clamp(Xt.double_lerp(this.from().opacity1(),this.to().opacity1(),e),0,1)}interpolateTranslation(e){return R.lerp(this.from().translation1(),this.to().translation1(),e)}interpolateTransform(e){let t=this.from().transform1(),r=this.to().transform1();if(t.toAngle()!=r.toAngle()&&this.from().transformOrigin1()!=null&&this.to().transformOrigin1()!=null){let n=t.clone().translatedBy1(this.from().transformOrigin1()),o=r.clone().translatedBy1(this.to().transformOrigin1()),a=Hn.lerp1(n,o,e),s=R.lerp(this.from().transformOrigin1(),this.to().transformOrigin1(),e),l=ee.new2().translatedBy1(s.negative());return a.multiply(l),a}else return this._isTransformEqual?t:Hn.lerp1(t,r,e)}interpolateScaling(e){return R.lerp(this.from().scaling1(),this.to().scaling1(),e)}clone(){return new i(this)}withScaledTranslation(e){let t=this.clone();return t._from=t._from.withScaledTranslation(e),t._to=t._to.withScaledTranslation(e),t}},Se=class Se{constructor(){this._reversed=null;arguments.length==0?(this._enteringFrameTransition=new nn,this._exitingFrameTransition=new nn,this._drawsEnteringFrameOnTopOfExitingFrame=!0,this._isDissolve=!1):arguments.length==4&&(this._enteringFrameTransition=arguments[0],this._exitingFrameTransition=arguments[1],this._drawsEnteringFrameOnTopOfExitingFrame=arguments[2],this._isDissolve=arguments[3])}enteringFrameTransition(){return this._enteringFrameTransition}exitingFrameTransition(){return this._exitingFrameTransition}drawsEnteringFrameOnTopOfExitingFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame}isDissolve(){return this._isDissolve}enteringFrameTranslation(e,t){return this._enteringFrameTransition.translation(e,t),this._reversed=null,this}enteringFrameOpacity(e,t){return this._enteringFrameTransition.opacity(e,t),this._reversed=null,this}exitingFrameTranslation(e,t){return this._exitingFrameTransition.translation(e,t),this._reversed=null,this}exitingFrameOpacity(e,t){return this._exitingFrameTransition.opacity(e,t),this._reversed=null,this}drawExitingFrameOnTopOfEnteringFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._reversed=null,this}dissolve(){return this._isDissolve=!0,this._reversed=null,this}freeze(){return this}clone(){return new Se(this._enteringFrameTransition.clone(),this._exitingFrameTransition.clone(),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}reversed(){if(this._reversed==null){let e=new Se().enteringFrameTranslation(this.exitingFrameTransition().to().translation1(),this.exitingFrameTransition().from().translation1()).enteringFrameOpacity(this.exitingFrameTransition().to().opacity1(),this.exitingFrameTransition().from().opacity1()).exitingFrameTranslation(this.enteringFrameTransition().to().translation1(),this.enteringFrameTransition().from().translation1()).exitingFrameOpacity(this.enteringFrameTransition().to().opacity1(),this.enteringFrameTransition().from().opacity1());this.isDissolve()&&e.dissolve(),this.drawsEnteringFrameOnTopOfExitingFrame()&&e.drawExitingFrameOnTopOfEnteringFrame(),this._reversed=e}return this._reversed}withScaledTranslation(e){return new Se(this._enteringFrameTransition.withScaledTranslation(e),this._exitingFrameTransition.withScaledTranslation(e),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}static get(e){switch(e){case"INSTANT_TRANSITION":return Se.INSTANT_TRANSITION;case"DISSOLVE":return Se.DISSOLVE;case"SMART_ANIMATE":return Se.DISSOLVE;case"SLIDE_FROM_LEFT":return Se.SLIDE_FROM_LEFT;case"SLIDE_FROM_RIGHT":return Se.SLIDE_FROM_RIGHT;case"SLIDE_FROM_TOP":return Se.SLIDE_FROM_TOP;case"SLIDE_FROM_BOTTOM":return Se.SLIDE_FROM_BOTTOM;case"PUSH_FROM_LEFT":return Se.PUSH_FROM_LEFT;case"PUSH_FROM_RIGHT":return Se.PUSH_FROM_RIGHT;case"PUSH_FROM_TOP":return Se.PUSH_FROM_TOP;case"PUSH_FROM_BOTTOM":return Se.PUSH_FROM_BOTTOM;case"MOVE_FROM_LEFT":return Se.MOVE_FROM_LEFT;case"MOVE_FROM_RIGHT":return Se.MOVE_FROM_RIGHT;case"MOVE_FROM_TOP":return Se.MOVE_FROM_TOP;case"MOVE_FROM_BOTTOM":return Se.MOVE_FROM_BOTTOM;case"SLIDE_OUT_TO_LEFT":return Se.SLIDE_OUT_TO_LEFT;case"SLIDE_OUT_TO_RIGHT":return Se.SLIDE_OUT_TO_RIGHT;case"SLIDE_OUT_TO_TOP":return Se.SLIDE_OUT_TO_TOP;case"SLIDE_OUT_TO_BOTTOM":return Se.SLIDE_OUT_TO_BOTTOM;case"MOVE_OUT_TO_LEFT":return Se.MOVE_OUT_TO_LEFT;case"MOVE_OUT_TO_RIGHT":return Se.MOVE_OUT_TO_RIGHT;case"MOVE_OUT_TO_TOP":return Se.MOVE_OUT_TO_TOP;case"MOVE_OUT_TO_BOTTOM":return Se.MOVE_OUT_TO_BOTTOM;case"FADE":return Se.DISSOLVE;case"MAGIC_MOVE":return Se.DISSOLVE}throw new Error(`Unhandled transition type ${e}`)}};Se.SLIDE_BACK_FRAME_OPACITY_START=1,Se.SLIDE_BACK_FRAME_OPACITY_END=.5,Se.OFFSCREEN_LEFT=new R(-1,0),Se.OFFSCREEN_RIGHT=new R(1,0),Se.OFFSCREEN_TOP=new R(0,-1),Se.OFFSCREEN_BOTTOM=new R(0,1),Se.CENTER=R.new2(),Se.INSTANT_TRANSITION=new Se().freeze(),Se.DISSOLVE=new Se().dissolve().freeze(),Se.SLIDE_FROM_LEFT=new Se().enteringFrameTranslation(Se.OFFSCREEN_LEFT,Se.CENTER).exitingFrameTranslation(Se.CENTER,Se.OFFSCREEN_RIGHT.divide(4)).exitingFrameOpacity(Se.SLIDE_BACK_FRAME_OPACITY_START,Se.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Se.SLIDE_FROM_RIGHT=new Se().enteringFrameTranslation(Se.OFFSCREEN_RIGHT,Se.CENTER).exitingFrameTranslation(Se.CENTER,Se.OFFSCREEN_LEFT.divide(4)).exitingFrameOpacity(Se.SLIDE_BACK_FRAME_OPACITY_START,Se.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Se.SLIDE_FROM_TOP=new Se().enteringFrameTranslation(Se.OFFSCREEN_TOP,Se.CENTER).exitingFrameTranslation(Se.CENTER,Se.OFFSCREEN_BOTTOM.divide(4)).exitingFrameOpacity(Se.SLIDE_BACK_FRAME_OPACITY_START,Se.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Se.SLIDE_FROM_BOTTOM=new Se().enteringFrameTranslation(Se.OFFSCREEN_BOTTOM,Se.CENTER).exitingFrameTranslation(Se.CENTER,Se.OFFSCREEN_TOP.divide(4)).exitingFrameOpacity(Se.SLIDE_BACK_FRAME_OPACITY_START,Se.SLIDE_BACK_FRAME_OPACITY_END).freeze(),Se.SLIDE_OUT_TO_LEFT=Se.SLIDE_FROM_RIGHT.reversed(),Se.SLIDE_OUT_TO_RIGHT=Se.SLIDE_FROM_LEFT.reversed(),Se.SLIDE_OUT_TO_TOP=Se.SLIDE_FROM_BOTTOM.reversed(),Se.SLIDE_OUT_TO_BOTTOM=Se.SLIDE_FROM_TOP.reversed(),Se.PUSH_FROM_LEFT=new Se().enteringFrameTranslation(Se.OFFSCREEN_LEFT,Se.CENTER).exitingFrameTranslation(Se.CENTER,Se.OFFSCREEN_RIGHT).freeze(),Se.PUSH_FROM_RIGHT=Se.PUSH_FROM_LEFT.reversed(),Se.PUSH_FROM_TOP=new Se().enteringFrameTranslation(Se.OFFSCREEN_TOP,Se.CENTER).exitingFrameTranslation(Se.CENTER,Se.OFFSCREEN_BOTTOM).freeze(),Se.PUSH_FROM_BOTTOM=Se.PUSH_FROM_TOP.reversed(),Se.MOVE_FROM_LEFT=new Se().enteringFrameTranslation(Se.OFFSCREEN_LEFT,Se.CENTER).freeze(),Se.MOVE_FROM_RIGHT=new Se().enteringFrameTranslation(Se.OFFSCREEN_RIGHT,Se.CENTER).freeze(),Se.MOVE_FROM_TOP=new Se().enteringFrameTranslation(Se.OFFSCREEN_TOP,Se.CENTER).freeze(),Se.MOVE_FROM_BOTTOM=new Se().enteringFrameTranslation(Se.OFFSCREEN_BOTTOM,Se.CENTER).freeze(),Se.MOVE_OUT_TO_LEFT=Se.MOVE_FROM_RIGHT.reversed(),Se.MOVE_OUT_TO_RIGHT=Se.MOVE_FROM_LEFT.reversed(),Se.MOVE_OUT_TO_TOP=Se.MOVE_FROM_BOTTOM.reversed(),Se.MOVE_OUT_TO_BOTTOM=Se.MOVE_FROM_TOP.reversed();var Ir=Se;var ol=class ol{constructor(e,t){this.hotspotStablePath=e,this.interactionId=t}};ol.EXTERNAL_INTERACTION_ID=J._new(-1,-2),ol.EXTERNAL=new ol(null,ol.EXTERNAL_INTERACTION_ID);var po=ol,Kr=class i{static getDefault(){return new i("INSTANT_TRANSITION",0,null,!1,ye.FrozenVector_new1(),"NAVIGATE",!1,ye.FrozenVector_new1(),!1,!0,!1,!1,1)}static fromPrototypeAction(e,t){return e==null?i.getDefault():new i(e.transitionType(),e.transitionDuration(),e.easingFunction,e.transitionShouldSmartAnimate(),e.overlayRelativePosition(),e.navigationType(),e.transitionPreserveScroll(),e.extraScrollOffset(),e.transitionResetVideoPosition(),e.openUrlInNewTab(),e.transitionResetScrollPosition(),e.transitionResetInteractiveComponents(),t)}withTransitionPreserveScroll(e){return new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,e,this.extraScrollOffset,this.transitionResetVideoPosition,this.openUrlInNewTab,this.transitionResetScrollPosition,this.transitionResetInteractiveComponents,this.stateManagementVersion)}withDefaultStateManagementSettings(){return new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,!1,this.openUrlInNewTab,!1,!1,this.stateManagementVersion)}withStateManagementSettings(e){return e==null?this:new i(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,e.transitionResetVideoPosition,this.openUrlInNewTab,e.transitionResetScrollPosition,e.transitionResetInteractiveComponents,e.stateManagementVersion)}constructor(e,t,r,n,o,a,s,l,c,d,h,u,m){this.transitionType=e,this.transitionDuration=t,this.easingFunction=r,this.transitionShouldSmartAnimate=n,this.overlayRelativePosition=o,this.navigationType=a,this.transitionPreserveScroll=s,this.extraScrollOffset=l,this.transitionResetVideoPosition=c,this.openUrlInNewTab=d,this.transitionResetScrollPosition=h,this.transitionResetInteractiveComponents=u,this.stateManagementVersion=m}},Sr=class{topId(){return this.overlays.length>0?ce.List_last(this.overlays).id:this.stateId}debugString(e){let t=o=>{let a=e.findNode(o);return`[nodeId.toString]: ${(a==null?void 0:a.name())??"null"}`},r="  ",n="[";for(let o=0,a=this.overlays.length;o<a;o=o+1){let s=this.overlays[o];n+=r+t(s.id),o!=this.overlays.length-1&&(n+=`,
`)}return n+="]",`PresentedState(
`+r+t(this.stateId)+`
`+r+`,
`+r+n+`
)`}statesAndOverlaysIncluded(){let e=new ln;this.stateId!=null&&J.isValid(this.stateId)&&e.add(this.stateId);for(let t of this.overlays)J.isValid(t.id)&&e.add(t.id);return e}constructor(e,t){this.stateId=e,this.overlays=t}},Ur=class i{constructor(){if(arguments[0]==0){let[,e]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Kr.getDefault(),this.interactionAddress=po.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new Sr(null,[]),this.newStateAndOverlays=new Sr(null,[])}else if(arguments[0]==1){let[,e,t,r]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Kr.getDefault(),this.interactionAddress=po.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=r}else if(arguments[0]==2){let[,e,t,r,n,o,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Kr.getDefault(),this.interactionAddress=po.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new Sr(t,[]),this.newStateAndOverlays=new Sr(r,[]),this.direction=0,this.cause=s,this.interactionAddress=n,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=o}else if(arguments[0]==3){let[,e,t,r,n,o,a,s,l]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Kr.getDefault(),this.interactionAddress=po.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=r,this.direction=s,this.cause=l,this.interactionAddress=n,this.transitionParameters=a,this.canvasSpaceTriggerBoundsOrNull=o}else if(arguments[0]==4){let[,e,t,r,n,o,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=Kr.getDefault(),this.interactionAddress=po.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=r,this.interactionAddress=o,this.direction=a,this.transitionParameters=s,this.cause=n}}static forClosingTopNOverlays(e,t,r,n,o,a){let l=r[r.length-e].openingTransition.withTransitionPreserveScroll(!0).withDefaultStateManagementSettings();return new i(3,yt.ROOT_STABLE_PATH(),new Sr(t,r),new Sr(t,r.slice(0,r.length-e)),n,o,l,1,a)}oldStateId(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.stateId}newStateId(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.stateId}oldOverlayData(){var e;return(e=this.oldStateAndOverlays)==null?void 0:e.overlays}newOverlayData(){var e;return(e=this.newStateAndOverlays)==null?void 0:e.overlays}oldOverlays(e){var t;return e.bindOverlays((t=this.oldStateAndOverlays)==null?void 0:t.overlays)}newOverlays(e){var t;return e.bindOverlays((t=this.newStateAndOverlays)==null?void 0:t.overlays)}isTransientChange(){let e=J.equals(this.oldStateAndOverlays.stateId,this.newStateAndOverlays.stateId);switch(this.transitionParameters.navigationType){case"OVERLAY":case"SWAP":case"SCROLL_TO":return!0;default:break}return ut.isTransientAction(this.cause)||e}debugString(e){var t,r;return`${(t=this.oldStateAndOverlays)==null?void 0:t.debugString(e)}
=>
${(r=this.newStateAndOverlays)==null?void 0:r.debugString(e)}`}easingFunction(){return this.transitionParameters.easingFunction}preserveScroll(){return this.transitionParameters.transitionPreserveScroll?1:0}resetScroll(){return this.transitionParameters.transitionResetScrollPosition?0:1}resetInteractiveComponents(){return this.transitionParameters.transitionResetInteractiveComponents?0:1}stateManagementVersion(){return this.transitionParameters.stateManagementVersion}getFramePairTransition(){let e=Ir.get(this.transitionParameters.transitionType);return this.direction==1?e.reversed():e}getNewOrChangedFrameIds(){let e=[];!J.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());for(let t=0,r=this.newOverlayData().length;t<r;t=t+1)(t>=this.oldOverlayData().length||!J.equals(this.oldOverlayData()[t].id,this.newOverlayData()[t].id))&&e.push(this.newOverlayData()[t].id);return e}getInsertedFrameIds(){let e=[];!J.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());let t=new ln;this.oldOverlayData().forEach(r=>{t.add(r.id)});for(let r=0,n=this.newOverlayData().length;r<n;r=r+1){let o=this.newOverlayData()[r].id;t._in(o)||e.push(o)}return e}getRemovedFrameIds(){let e=[];!J.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.oldStateId());let t=new ln;this.newOverlayData().forEach(r=>{t.add(r.id)});for(let r=0,n=this.oldOverlayData().length;r<n;r=r+1){let o=this.oldOverlayData()[r].id;t._in(o)||e.push(o)}return e}},Fn=class i{static getDefaultExternalExecution(){return new i(po.EXTERNAL,Kr.getDefault(),null)}static forNoodle(e,t,r){let n=new po(i.stablePathForHotspot(e),t.id()),o=t.action().value;if(r!=null)o=r;else for(let l of t.getAllValidTransitionActionsInInteraction()){o=l;break}let a=Kr.fromPrototypeAction(o,t.stateManagementVersion()),s=t.event().interactionType()=="ON_HOVER"?e.canvasSpaceInteractiveBounds():null;return new i(n,a,s)}static forExternalOpenOverlay(e){let t=new po(i.stablePathForHotspot(e),J._new(-1,-2));return new i(t,Kr.getDefault(),null)}static stablePathForHotspot(e){let t=null;return t=e.stablePath(),t}constructor(e,t,r){this.interactionAddress=e,this.transitionParameters=t,this.canvasSpaceTriggerBoundsOrNull=r}};var Fc=class{constructor(e){this._noodleMap=new Ei,this._cachedCleanedUpTransitionMapByTlf=null,this._scene=null,this._appState=null,this.triggerPotentialTimedTransition=null,this.createVideoTriggerEventsForNodesInFrame=null,this.createVideoTriggerEventsForAllNodesOnscreen=null,this._topmostScreenChangeCounter=0,this._appState=e,this._appState.addAppObserver(this)}_setPrototypeInteractionsInNoodleMap(e,t){t.some(n=>n.isValid())?this._noodleMap.update(e,t):this._noodleMap.update(e,[])}getStateGroupStateSwapInteractionCounts(){return this._noodleMap.stateGroupStateSwapInteractionCounts}_setHyperlinkInteractionInNoodleMap(e){if(qt.isNodeInteractableBecauseOfHyperlinks(e)){let t=qt.createFakeHyperlinkInteraction();this._setPrototypeInteractionsInNoodleMap(e,[t])}}cleanedUpMediaEndInteractionMap(){return this.cleanedUpInteractionMapForPrefilteredType(2)}cleanedUpMediaHitInteractionMap(){return this.cleanedUpInteractionMapForPrefilteredType(3)}cleanedUpInteractionMapForPrefilteredType(e){return new Ei.CleanedMap(this._noodleMap,e,t=>{var o,a;let r=(o=this._scene)==null?void 0:o.findNode(t),n=(a=this._noodleMap.noodleNodes.get(t,null))==null?void 0:a.prefilteredInteractionsByType.get(e);return qt.cleanedInteractionsForNodeFromDirtyInteractions(this._appState,r,n==null?void 0:n.asList())})}cleanedUpInteractionMap(){return new Ei.CleanedMap(this._noodleMap,0,e=>{var r;let t=(r=this._scene)==null?void 0:r.findNode(e);return qt.cleanedInteractionsForNode(this._appState,t)})}cleanedUpTransitionMap(){return new Ei.CleanedMap(this._noodleMap,1,e=>{let t=[];return this.cleanedUpInteractionMap().getHotspotInteractions(e).forEach(r=>{r.interactionContainsTransitionAction()&&t.push(r)}),t})}cleanedUpTransitionMapByTLF(){if(this._cachedCleanedUpTransitionMapByTlf==null){let e=new Gn(t=>t);for(let t of this.cleanedUpTransitionMap().hotspots()){let r=this._scene.findNode(t);if(r!=null){let n=null,o=r.topLevelAncestor();o!=null&&o.visible()&&(n=o.id()),n!=null&&(e._in(n)||e.set(n,[]),Or(e.get(n),this.cleanedUpTransitionMap().getHotspotInteractions(t).slice()))}}this._cachedCleanedUpTransitionMapByTlf=e}return this._cachedCleanedUpTransitionMapByTlf}rawInteractionMapForTests(){return new Ei.RawMapForTests(this._noodleMap)}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){this._noodleMap.noodleNodes.clear(),t!=null&&this._addConnectionsFromSubtree(t),this._cachedCleanedUpTransitionMapByTlf=null}handleActivePrototypeStartingPointChange(e,t){}_addConnectionsFromSubtree(e){this._setPrototypeInteractionsInNoodleMap(e,e.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e);for(let t=0,r=e.childCount();t<r;t=t+1){let n=e.childAt1(t);this._addConnectionsFromSubtree(n)}}_removeConnectionsFromSubtree(e){this._noodleMap.update(e,[]);for(let t=0,r=e.childCount();t<r;t=t+1)this._removeConnectionsFromSubtree(e.childAt1(t))}topmostScreenChangeCounter(){return this._topmostScreenChangeCounter}handleSceneGraphEvent(e){let t=!1;if((qn.isInteractionProperty(e.property)||qn.affects(e.property,81))&&(e.node.isRooted()&&(this._setPrototypeInteractionsInNoodleMap(e.node,e.node.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e.node),t=!0),J.equals(this._appState.baseScreenId(),e.node.id())&&e.node.prototypeInteractions().forEach(r=>{this._topmostScreenChangeCounter=this._topmostScreenChangeCounter+1,r.event().interactionType()=="AFTER_TIMEOUT"?this.triggerPotentialTimedTransition!=null&&this.triggerPotentialTimedTransition():(r.event().interactionType()=="ON_MEDIA_HIT"||r.event().interactionType()=="ON_MEDIA_END")&&this.createVideoTriggerEventsForAllNodesOnscreen!=null&&this.createVideoTriggerEventsForAllNodesOnscreen()})),e.property==8||e.property==9||e.property==14||e.property==80)t=!0,this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node),this._noodleMap.invalidateHotspotAndChildren(e.node);else if(e.property==25){let r=e.oldVal!=null&&nt.isParentIndex(e.oldVal)?nt.asParentIndex(e.oldVal):null,n=e.newVal!=null&&nt.isParentIndex(e.newVal)?nt.asParentIndex(e.newVal):null,o=r!=null?e.node.scene().findNode(r.id):null,a=n!=null?e.node.scene().findNode(n.id):null,s=o!=null&&o.isRooted(),l=a!=null&&a.isRooted();s&&!l?(this._removeConnectionsFromSubtree(e.node),t=!0):!s&&l&&(this._addConnectionsFromSubtree(e.node),t=!0,this.createVideoTriggerEventsForNodesInFrame!=null&&this.createVideoTriggerEventsForNodesInFrame(e.node)),s&&l&&o.id()!=a.id()&&(t=!0),this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node)}t&&(this._cachedCleanedUpTransitionMapByTlf=null)}};var Sp=class{invalidateCaches(){this.caches.set(0,null),this.caches.set(1,null),this.caches.set(2,null),this.caches.set(3,null)}constructor(){this.interactions=new ko(e=>e.id()),this.backReferences=new Gn(e=>e),this.caches=new Map([[0,null],[1,null],[2,null],[3,null]]),this.prefilteredInteractionsByType=new Map}},Lb=new Map([[3,i=>i.event().interactionType()=="ON_MEDIA_HIT"],[2,i=>i.event().interactionType()=="ON_MEDIA_END"]]);var Ei=class{constructor(){this.queuedInteractionChanges=[];this.noodleNodes=new Gn(e=>e),this.stateGroupStateSwapInteractionCounts=new Gn(e=>e),this.guidsForPrefilterType=new Map([[2,new ko(e=>e)],[3,new ko(e=>e)]])}update(e,t){var o,a;let r=((a=(o=this.noodleNodes.get(e.id(),null))==null?void 0:o.interactions)==null?void 0:a.asList())??[];for(let s=0,l=r.length;s<l;s=s+1){let c=r[s];this._eraseInteraction(e,c)}for(let s=0,l=t.length;s<l;s=s+1){let c=t[s];this._addInteraction(e,c)}let n=this.noodleNodes.get(e.id(),null);n!=null&&n.interactions.count()==0&&n.backReferences.count()==0&&this.noodleNodes.remove(e.id())}_updateStateGroupSwapInteractionCounts(e,t,r){if(X.shouldPreventVolatileCaching())return;if(X&&!X.viewerICCacheOpt()){this.stateGroupStateSwapInteractionCounts.clear();return}let n=e.getBackingSymbolParent();if(!(!n||!n.isStateGroup())){for(let o of t.allActions())if(o.navigationType()=="SWAP_STATE"){let a=this.stateGroupStateSwapInteractionCounts.get(n.id(),0),s=r?1:-1;this.stateGroupStateSwapInteractionCounts.set(n.id(),a+s)}}}_processQueuedInteractionChanges(){for(;this.queuedInteractionChanges.length>0;){let e=this.queuedInteractionChanges[0];switch(e.change){case 0:this._updatePrefilteredInteractionsForAddedInteraction(e.interaction,e.guid);case 1:this._updatePrefilteredInteractionsForRemovedInteraction(e.interaction,e.guid)}this.queuedInteractionChanges.shift()}}_addInteraction(e,t){let r=e.id(),n=this.noodleNodes.get(r,null)??new Sp;this.noodleNodes.set(r,n),n.interactions.add(t);for(let o of t.allActions()){let a=o.transitionNodeID();if(Mb(a,o.connectionType())){let s=this.noodleNodes.get(a,null);s==null&&(s=new Sp,this.noodleNodes.set(a,s)),s.backReferences.set(r,s.backReferences.get(r,0)+1)}}n.invalidateCaches(),this._updateStateGroupSwapInteractionCounts(e,t,!0),X?X.viewerCreateVideoTriggersOpt()?(this._processQueuedInteractionChanges(),this._updatePrefilteredInteractionsForAddedInteraction(t,r)):this.queuedInteractionChanges=[]:this.queuedInteractionChanges.push({interaction:t,guid:r,change:0})}_updatePrefilteredInteractionsForAddedInteraction(e,t){let r=this.noodleNodes.get(t,null);e!=null&&r!=null&&Lb.forEach((n,o)=>{if(n(e)){let a=r.prefilteredInteractionsByType.get(o)??new ko(s=>s.id());r.prefilteredInteractionsByType.set(o,a),a.add(e),this.guidsForPrefilterType.get(o).add(t)}})}_eraseInteraction(e,t){let r=e.id(),n=this.noodleNodes.get(r,null);n!=null&&n.interactions.remove(t);for(let o of t.allActions()){let a=o.transitionNodeID();if(Mb(a,o.connectionType())){let s=this.noodleNodes.get(a,null);s!=null&&(s.backReferences.set(r,s.backReferences.get(r)-1),s.backReferences.get(r)<=0&&s.backReferences.remove(r))}}n.invalidateCaches(),this._updateStateGroupSwapInteractionCounts(e,t,!1),X?X.viewerCreateVideoTriggersOpt()?(this._processQueuedInteractionChanges(),this._updatePrefilteredInteractionsForRemovedInteraction(t,r)):this.queuedInteractionChanges=[]:this.queuedInteractionChanges.push({interaction:t,guid:r,change:1})}_updatePrefilteredInteractionsForRemovedInteraction(e,t){let r=this.noodleNodes.get(t,null);e!=null&&r!=null&&Lb.forEach((n,o)=>{if(n(e)){let a=r.prefilteredInteractionsByType.get(o);a==null||a.remove(e),(a==null?void 0:a.count())<1&&this.guidsForPrefilterType.get(o).remove(t)}})}invalidateHotspotAndChildren(e){Wr(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get(t.id()).invalidateCaches(),0))}invalidateBackRefsForDestinationAndChildren(e){Wr(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get(t.id()).backReferences.each((n,o)=>{this.noodleNodes.get(n).invalidateCaches()}),0))}};(t=>{class i{_in(n){return this.noodleMap.noodleNodes._in(n)&&this.getHotspotInteractions(n).length!=0}hotspots(){return this.noodleMap.noodleNodes.keys().filter(n=>this.getHotspotInteractions(n).length!=0)}getHotspotInteractions(n){return this.noodleMap.noodleNodes.get(n).interactions.asList()}constructor(n){this.noodleMap=n}}t.RawMapForTests=i;class e{_in(n){return this.noodleMap.noodleNodes._in(n)?this.getHotspotInteractions(n).length!=0:!1}hotspots(){return this.cacheType===2||this.cacheType===3?this.noodleMap.guidsForPrefilterType.get(this.cacheType).asList().filter(n=>this.noodleMap.noodleNodes.get(n)==null?(Le("GUID in guidsForPrefilterType not in noodleNodes"),!1):this.getHotspotInteractions(n).length!=0):this.noodleMap.noodleNodes.keys().filter(n=>this.getHotspotInteractions(n).length!=0)}getHotspotInteractions(n){let o=this.noodleMap.noodleNodes.get(n);return o.caches.get(this.cacheType)==null&&o.caches.set(this.cacheType,this.computeCacheForHotspot(n)),o.caches.get(this.cacheType)}constructor(n,o,a){this.noodleMap=n,this.cacheType=o,this.computeCacheForHotspot=a}}t.CleanedMap=e})(Ei||(Ei={}));function Mb(i,e){return i!=null&&J.isValid(i)&&(e=="INTERNAL_NODE"||e=="UPDATE_MEDIA_RUNTIME")}var No=class{constructor(e,t=null){this.node=e,this.hyperlink=t}canvasSpaceScrolledInteractiveBounds(e){let t=this.node.canvasSpaceScrolledInteractiveBounds(e);return this.hyperlink!=null?Br.FrozenRect_new4(this.hyperlink.bounds.x+t.x(),this.hyperlink.bounds.y+t.y(),this.hyperlink.bounds.w,this.hyperlink.bounds.h):t}},Xi=(t=>(t[t.NONLINEAR=0]="NONLINEAR",t[t.FRAME_LIST=1]="FRAME_LIST",t))(Xi||{}),bp=class{asScreen(){return null}asSmartAnimate(){return null}constructor(){}},Lr=class i extends bp{constructor(t,r,n,o,a){super();this.nodeId=t,this.role=r,this.overlayStackPosition=n,this.prototypeAction=o,this.precedingOverlays=a}asScreen(){return this}hash(){let t=`${this.nodeId}-${i.FrameRole[this.role]}`;return this.role==i.FrameRole.OVERLAY?t+`-${this.overlayStackPosition}`:t}static forBaseScreen(t){return new i(t,i.FrameRole.BASE_SCREEN,0,null,null)}static forOverlay(t,r,n,o){return new i(t,i.FrameRole.OVERLAY,r,n,o)}};(e=>{let i;(n=>(n[n.BASE_SCREEN=0]="BASE_SCREEN",n[n.OVERLAY=1]="OVERLAY"))(i=e.FrameRole||(e.FrameRole={}))})(Lr||(Lr={}));var Og=class extends bp{constructor(t,r,n,o,a){super();this.srcNodeId=t,this.dstNodeId=r,this.role=n,this.transitionType=o,this.easingFunction=a}asSmartAnimate(){return this}hash(){return`Smart animate ${this.srcNodeId} -> ${this.dstNodeId} w/ ${this.transitionType}`}},Dc;(e=>{function i(t,r){if(r=="URL"){if(t!="ON_CLICK"&&t!="MOUSE_UP")return!1}else if(r=="BACK"&&(t=="ON_HOVER"||t=="ON_PRESS"))return!1;return!0}e.isValidForConnection=i})(Dc||(Dc={}));var En=class En{constructor(e){this._nodeTransitionTracker=null,this._appState=null,this._emitter=null,this._cachedPrerenderJobList=[],this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1,this._appState=e,this._emitter=$t.getEventEmitter(),this._appState.addAppObserver(this),this._appState.prototypeState().addObserver(this),this._nodeTransitionTracker=new Fc(e),this._appState.addFrameObserver(this)}nodeTransitionTracker(){return this._nodeTransitionTracker}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActiveCanvasChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActivePrototypeStartingPointChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleSceneGraphEvent(e){if(qn.isPrototypeStructuralChange(e.property)||e.property==14||e.property==80||e.property==9||e.property==24){this._cachedPrerenderJobList=null;let t=this._appState.prototypeState();t.isApplyingStateChangeMutation()||t.isResettingStateChangeMutations()||(this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0)}}onFrame(){this._shouldNotifyTopLevelPrototypeNodesInvalidated&&(this._emitter.trigger("topLevelFramesListInvalidated"),this._emitter.trigger("navigationInfoInvalidated"),this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1)}handleStateChangeAborted(e){this._cachedPrerenderJobList=null}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._cachedPrerenderJobList=null}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}_scene(){return this._appState.scene()}_baseScreenId(){return this._appState.prototypeState().getCurrentBaseScreenId()}getPrerenderingJobs(e){return this._cachedPrerenderJobList==null&&(this._cachedPrerenderJobList=this.computePrerenderJobsForStartNode(this._baseScreenId(),En.MAX_PRERENDER_JOB_COUNT)),this._cachedPrerenderJobList}currentType(){return this._scene()==null||this._appState.getActiveCanvas()==null?1:this.topLevelPrototypeStartingPointNodeIdsSorted().length>0||X.getViewerMode()==X.ViewerMode.MIRROR?0:1}activePrototypeStartNodeOrDefault(){if(this._scene()==null)return null;if(this._appState.activePrototypeStartingPointNodeId()!=null){let t=this._scene().findNode(this._appState.activePrototypeStartingPointNodeId());if(t!=null&&t.visible())return t}let[e]=this.topLevelPrototypeStartingPointNodeIdsSorted();return e?this._scene().findNode(J.fromString(e)):null}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let t=this.activePrototypeStartNodeOrDefault();if(t!=null)return t;let r=En.visuallySortedTopLevelFrames(e);return r.length>0?r[0]:null}getDestinationFrame(e){var r,n,o;let t=(r=this._scene())==null?void 0:r.findNode(e);if(t==null)return null;if(t.type()=="SECTION"){let a=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(t.id()),s=(n=this._scene())==null?void 0:n.findNode(a);if((s==null?void 0:s.type())=="SECTION")for(;s.type()!="FRAME";)a=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(a),s=(o=this._scene())==null?void 0:o.findNode(a);return s}return t}validDestinationForPrototypeFromId(e){let t=this.getDestinationFrame(e);return t==null||!t.isTopLevel()||!t.isVisibleInCanvas()||t.isStateGroup()||t.isGroup()||ir.isImmutableFrame(t.type())?null:t}topLevelPrototypeNodesInOrder(){return this.currentType()==1?En.visuallySortedTopLevelFrames(this._appState.getActiveCanvas()).map(e=>e.id()):this._appState.prototypeState().getTlfHistory()}topLevelPrototypeStartingPointNodeIdsSorted(){if(this._scene()==null)return console.error("topLevelPrototypeStartingPointNodeIdsSorted when we don't have a valid scene"),[];let e=this._appState.getActiveCanvas();return e==null||e.type()!="CANVAS"?[]:L().topLevelPrototypeStartingPointsSorted(e.id())}prototypeStartingPointsData(){let e=this._appState.getActiveCanvas();return e==null||e.type()!="CANVAS"?null:L().topLevelPrototypeStartingPointsSorted(e.id()).map(r=>{let n=this._scene().findNode(r);if(n)return{id:n.id(),name:n.prototypeStartingPoint().name,description:n.prototypeStartingPoint().description}}).filter(Boolean)}prerenderJobsForBaseScreen(){return this.prerenderJobsAfter(Lr.forBaseScreen(this._baseScreenId()))}prerenderJobsAfter(e){var a;let t=(a=this._scene())==null?void 0:a.findNode(e.nodeId);if(t==null)return[];let r=new Map,n=[],o=s=>{r.has(s.hash())||(r.set(s.hash(),!0),n.push(s))};if(e.role==0){let s=this.topLevelPrototypeNodesInOrder(),l=s.indexOf(e.nodeId);if(l!=-1){let c=l+1,d=null;c<s.length?d=J.fromString(s[c]):this.currentType()==1?d=this._appState.prototypeState().getNextBaseScreenIdForFrameList():d=this._appState.prototypeState().getNextBaseScreenIdForPrototype(),d!=null&&o(Lr.forBaseScreen(d))}}return this.forTransitionInFrame(t,s=>{for(let l of s.allActions()){if(l==null||!J.isValid(l.transitionNodeID()))return!0;let c=l.transitionType(),d=!1;if(l.navigationType()=="SWAP_STATE")return!0;if(e.role==0&&(c=="SMART_ANIMATE"||mn.supportsSmartAnimate(c)&&l.transitionShouldSmartAnimate())&&(d=!0),e.role==1&&c=="SMART_ANIMATE"&&l.navigationType()=="SWAP"&&(d=!0),d&&o(new Og(t.id(),l.transitionNodeID(),e.role,c,l.easingFunction)),l.navigationType()=="NAVIGATE"){o(Lr.forBaseScreen(l.transitionNodeID()));let h=this._scene().findNode(l.transitionNodeID());h!=null&&h.setUsedAsBaseScreen(!0)}else if(l.navigationType()=="OVERLAY"){let h=e.precedingOverlays!=null?e.precedingOverlays.slice():[];h.push(l.transitionNodeID()),o(Lr.forOverlay(l.transitionNodeID(),e.overlayStackPosition+1,l,h));let u=this._scene().findNode(l.transitionNodeID());u!=null&&u.setUsedAsBaseScreen(!1)}else if(l.navigationType()=="SWAP"){if(e.role==1){let h=e.precedingOverlays!=null?e.precedingOverlays.slice():null;h!=null&&(h[h.length-1]=l.transitionNodeID()),o(Lr.forOverlay(l.transitionNodeID(),e.overlayStackPosition,l,h))}else o(Lr.forBaseScreen(l.transitionNodeID()));this._scene().findNode(l.transitionNodeID()).setUsedAsBaseScreen(e.role==0)}}return!0}),n}prerenderJobForPreviousNode(){return this.prerenderJobForNodeBefore(this._baseScreenId())}prerenderJobForNodeBefore(e){var o;if(((o=this._scene())==null?void 0:o.findNode(e))==null)return null;let r=this.topLevelPrototypeNodesInOrder(),n=r.indexOf(e);if(n!=-1){let a=n-1;if(a>=0)return Lr.forBaseScreen(J.fromString(r[a]))}return null}computePrerenderJobsForStartNode(e,t){if(e==null)return[];let r=[Lr.forBaseScreen(e)],n=[Lr.forBaseScreen(e)],o=new Map,a=0;for(o.set(r[0].hash(),!0);a<r.length;){let s=r[a],l=[],c=this.prerenderJobForNodeBefore(s.nodeId);if(c!=null&&l.push(c),Or(l,this.prerenderJobsAfter(s)),l.forEach(d=>{if(n.length<t&&!o.has(d.hash())){let h=d.asScreen();h!=null&&r.push(h),n.push(d),o.set(d.hash(),!0)}}),r.length==t)break;a=a+1}return n}forTransitionInFrame(e,t){let r=this._nodeTransitionTracker.cleanedUpTransitionMapByTLF();if(r._in(e.id())){let n=r.get(e.id());for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];if(!t(s))return}}}forInteractionInFrame(e,t){this.forInteractionInFrames([e],t)}getInteractionsGroupedByType(e){let t=this._nodeTransitionTracker.cleanedUpInteractionMap(),r={};for(let n of t.hotspots()){let o=this._scene().findNode(n);if(o!=null)for(let a of e)a!=null&&a.isAncestorOf(o)&&t.getHotspotInteractions(n).forEach(s=>{let l=s.event().interactionType().toString();r[l]||(r[l]=[]),r[l].push({node:o,interaction:s})})}return r}static getNodeInteractionPairs(e,t){if(t!==null)return t[e]||[]}forInteractionInFrames(e,t){let r=this._nodeTransitionTracker.cleanedUpInteractionMap();for(let n of r.hotspots()){let o=this._scene().findNode(n);if(o!=null)for(let a of e)a!=null&&a.isAncestorOf(o)&&r.getHotspotInteractions(n).forEach(s=>{t(o,s)})}}forHotspotInMap(e,t){for(let r of Array.from(e.keys())){let n=this._scene().findNode(r);if(n!=null){let o=!1;if(En.isNodeInteractableBecauseOfHyperlinks(n)){for(let a of e.get(r))for(let s of a.allActions())if(s.connectionURL()=="HYPERLINK"){for(let l of n.textHyperlinkBoxes())t(new No(n,l)),o=!0;break}}o||t(new No(n))}}}findPrototypeInteractionWithId(e,t){let r=this._scene().findNode(e),n=En.cleanedInteractionsForNode(this._appState,r);for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];if(s.id()==t)return s}return null}findPrototypeInteractionsWithTransition(e,t){let r=this._scene().findNode(e),n=En.cleanedInteractionsForNode(this._appState,r),o=[];return n.forEach(a=>{for(let s of a.getAllValidTransitionActionsInInteraction())if(s!=null&&s.transitionNodeID()==t){o.push(a);break}}),o}findPrototypeInteractionsWithInteractionType(e,t){let r=En.cleanedInteractionsForNode(this._appState,e);if(r.length==0)return r;let n=[],o=[];return r.forEach(a=>{a.event().interactionType()==t&&(a.action()!=null&&a.action().value.navigationType()=="SWAP_STATE"?o.push(a):n.push(a))}),e.isInstanceSublayer()&&o.sort((a,s)=>{var d,h;let l=Zt.whichInstanceToSwap(e,(d=a.action())==null?void 0:d.value.transitionNodeID()).stablePath(),c=Zt.whichInstanceToSwap(e,(h=s.action())==null?void 0:h.value.transitionNodeID()).stablePath();return l.guids.length<c.guids.length?-1:1}),Or(n,o),n}findHotspotsWithInteractionFilter(e,t,r,n){return this.findHotspotsWithNoodleFilter(e,t,(o,a)=>r(a),n)}findHotspotsWithInteractionFilterWithinMultipleNodes(e,t,r){return this.findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,(n,o)=>r(o))}findHotspotsWithNoodleFilter(e,t,r,n){let o=[];return e==null?o:this.findHotspotsWithNoodleFilterWithinMultipleNodes(new Set([e]),t,r,n)}findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,r,n){let o=[];if(e==null||e.size==0)return o;let a=new Map,s=(l,c)=>{!r(l,c)||!c.allActions().some(h=>Dc.isValidForConnection(c.event().interactionType(),h.connectionType()))||(a.has(l.id())||a.set(l.id(),[]),a.get(l.id()).push(c))};if(n)for(let l of n)s(l.node,l.interaction);else this.forInteractionInFrames(Array.from(e.values()),s);return this.forHotspotInMap(a,l=>{(t==0||!e.has(l.node))&&o.push(l)}),o.sort((l,c)=>l.node.isAboveInLayerOrder(c.node)?-1:1),o}findHotspotsWithInteractionType(e,t,r,n){return this.findHotspotsWithInteractionFilter(e,t,o=>o.event().interactionType()==r,n)}findAllHotspots(e,t){return this.findHotspotsWithInteractionFilter(e,t,r=>!0)}hotspotOnPresentedNode(e,t,r,n){let o=r!="MOUSE_OUT"&&r!="MOUSE_LEAVE",a=this._appState.prototypeStructure().findHotspotsWithInteractionType(e,0,r,n),s=null;for(let l of a)l.canvasSpaceScrolledInteractiveBounds(0).contains2(t)==o&&(s==null||l.node.isAboveInLayerOrder(s.node))&&(s=l);return s}static createFakeHyperlinkInteraction(){let e=new Qn("ON_CLICK",null,null,{},null,null),t=new Qr(null,null,null,null,null,null,"URL","HYPERLINK",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null);return new Zt(J.invalid(),e,[t],!1,0)}static cleanedInteractionsForNode(e,t){if(t==null)return[];let r=t.prototypeInteractions();return this.cleanedInteractionsForNodeFromDirtyInteractions(e,t,r)}static cleanedInteractionsForNodeFromDirtyInteractions(e,t,r){let n=[];if(t==null||r==null)return n;for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];if(s.actions()==null||s.actions().length==0)continue;let l=[];for(let c=0,d=s.actions().length;c<d;c=c+1){let h=s.actions()[c],u=null;if(J.isValid(h.transitionNodeID())){let m=e.getActiveCanvas(),g=En.cleanedUpTransitionDestinationId(m,t==null?void 0:t.id(),h.transitionNodeID(),h.navigationType(),h.connectionType());g!==null&&g!=null&&(u=h.withTransitionNodeID(g))}else t.isVisibleInCanvas()&&En.isPrototypeActionInteractableBecauseOfConnection(h)&&(u=h);u!=null&&l.push(u)}l.length!=0&&n.push(s.withActions(l))}return n.length==0&&En.isNodeInteractableBecauseOfHyperlinks(t)&&n.push(En.createFakeHyperlinkInteraction()),n}static cleanedUpTransitionDestinationId(e,t,r,n,o){return L().modules().prototype.cleanedUpTransitionDestination(e!=null?e.handle():-1,t,r,ke().NavigationType[n],ke().ConnectionType[o])}static visuallySortedTopLevelFrames(e){if(e==null)return[];let t=[];for(let o=0,a=e.childCount();o<a;o=o+1){let s=e.childAt1(o);s&&L().isOrContainsBaseScreen(s.id())&&t.push(s)}let r=En.visuallySortLayersLeftToRightAndTopToBottom1(t),n=[];for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];s.type()=="SECTION"||s.type()=="SLIDE_GRID"||s.type()=="SLIDE_ROW"?Or(n,En.visuallySortedTopLevelFrames(s)):n.push(s)}return n}static visuallySortLayersLeftToRightAndTopToBottom1(e){let t=e.slice();return t.sort((r,n)=>{let o=r.fullSizeCanvasSpaceBoundingBox(),a=n.fullSizeCanvasSpaceBoundingBox();return a.top()<=o.bottom()&&a.bottom()>=o.top()?o.x()==a.x()?fo.string_compare(r.id(),n.id()):o.x()-a.x()|0:o.y()-a.y()|0}),t}static visuallySortLayersLeftToRightAndTopToBottom2(e,t){let r=[];for(let o of t){let a=e.findNode(o);a!=null&&r.push(a)}return En.visuallySortLayersLeftToRightAndTopToBottom1(r).map(o=>o.id())}static adjacentBaseScreens(e,t){let r=t.scene(),n=new ko(s=>s),o=null,a=new ln;return o=s=>{if(s==null||a._in(s.id())||!e._in(s.id()))return;a.add(s.id());let l=e.get(s.id());for(let c=0,d=l.length;c<d;c=c+1){let h=l[c];for(let u of h.allActions()){if(u==null||!J.isValid(u.transitionNodeID()))continue;let m=r.findNode(u.transitionNodeID());if(m==null){Le("null destination when finding reachable TLFs?");continue}let g=u.connectionType()!="UPDATE_MEDIA_RUNTIME"&&u.connectionType()!="SET_VARIABLE"&&u.connectionType()!="SET_VARIABLE_MODE";u.navigationType()=="NAVIGATE"&&g||u.navigationType()=="SWAP"&&J.equals(s.id(),t.id())?n.add(m.id()):(u.navigationType()=="OVERLAY"||u.navigationType()=="SWAP")&&o(m)}}},o(t),n}static isNodeInteractableBecauseOfHyperlinks(e){return e.type()=="TEXT"&&e.textHyperlinkBoxes().length>0}static isPrototypeActionInteractableBecauseOfConnection(e){return e.connectionURL()!=null||e.connectionType()=="BACK"||e.connectionType()=="CLOSE"||e.connectionType()=="SET_VARIABLE"||e.connectionType()=="SET_VARIABLE_MODE"||e.connectionType()=="UPDATE_MEDIA_RUNTIME"||e.connectionType()=="CONDITIONAL"}};En.MAX_PRERENDER_JOB_COUNT=10;var qt=En;var Ji=class i{constructor(e){this.VERBOSE_LOGS=!1,this._appState=null,this._observers=new zr,this._isNotifyingStateChangeObservers=!1,this._emitter=null,this._interactionsEnabled=!0,this._disableNewStateChanges=!1,this._currentFitMode=0,this.componentStateSyncer=null,this._onStateSwapFailedDueToCycle=null,this._isDragging=!1,this._actionCounter=0,this._transitionOnClick=!0,this._changeHistory=[],this._initiatedChange=null,this._initiatedHistory=null,this._lastInitiatedTopLevelStateChange=null,this._ongoingNavigateRepairsInvalidState=!1,this._shouldNotifyNavigationInfoInvalidated=!1,this._tlfHistory=[],this._upcomingTlfs=new Set,this._videoStateChangeHistory=[],this._screensNeedValidating=!1,this._removedPrimaryInstances=[],this._enqueueUpcomingTlfsDeadline=0,this._forceInitiateStateChangeForTests=!1,this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._visitedScreenIds=new ln,this._isApplyingStateChangeMutation=!1,this._isResettingStateChangeMutations=!1,this._hsmRoot=null,this._initiatedInstanceChanges=new Map,this._lastInitiatedInstanceStateChange=null,this._setVariableActionHistory=[],this._variableIdToSetVariableActionHistoryIndex=new Map,this._hsmObservers=new zr,this._appState=e,this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this.componentStateSyncer=new Oc(this._appState,this,(t,r,n)=>this._getFullscreenNodeChangesForStateSwap(t,r,n)),this._emitter=$t.getEventEmitter(),this._hsmRoot=new il(this),this._onStateSwapFailedDueToCycle=()=>{this._emitter.trigger("stateSwapFailedDueToCycle")},this.resetState()}hasRequestedStateChange(){return this._requestedStateChange!==null}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._hsmRoot=new il(this),this._initiatedInstanceChanges=new Map,t!=null&&this.createOrRepairStateMachinesForInsertedSubtree(t.root()),this._visitedScreenIds=new ln,this._enforceValidPrototypeState()}resetState(){this.resetPrototype(),this._currentFitMode=0,this._transitionOnClick=!0}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){this._enforceValidPrototypeState()}handleSceneGraphEvent(e){if(qn.isPrototypeStructuralChange(e.property)&&(this._screensNeedValidating=!0,this._deferEnqueueUpcomingTlfs()),e.property==98)nt.asString(e.newVal)=="REMOVED"&&!this.isApplyingStateChangeMutation()&&e.node.isPrimaryInstance()&&this._removedPrimaryInstances.push(e.node.id());else if(e.property==75&&e.node.isInstance()){let t=e.node.symbolID()??J.invalid();J.isValid(t)||console.warn("Unexpected invalid symbolID for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(e.node,t)}else if(e.property==25){let t=e.oldVal!=null&&nt.isParentIndex(e.oldVal)?nt.asParentIndex(e.oldVal):null,r=e.newVal!=null&&nt.isParentIndex(e.newVal)?nt.asParentIndex(e.newVal):null,n=t!=null?e.node.scene().findNode(t.id):null,o=r!=null?e.node.scene().findNode(r.id):null,a=n!=null&&n.isRooted(),s=o!=null&&o.isRooted();!a&&s?this.createOrRepairStateMachinesForInsertedSubtree(e.node):a&&!s&&(this.isApplyingStateChangeMutation()||Wr(e.node,l=>{if(l.isInstance()){let c=this._getStateMachineOrNull(l.stablePath());if(c!=null)return this.commitInstanceStateChange(c),2}return 0}))}else e.property==62&&vr.clearCachedNodePaths()}didApplyNodeChanges(){if(this._screensNeedValidating&&(this._enforceValidPrototypeState(),this._screensNeedValidating=!1),this._removedPrimaryInstances.length>0){for(let e of this._removedPrimaryInstances)this.commitChangesBelowInstanceTransitionRoot(new yt([e])),this._hsmRoot.removeChild(e);this._removedPrimaryInstances=[]}}onFrame(){this._shouldNotifyNavigationInfoInvalidated&&(this._emitter.trigger("navigationInfoInvalidated"),this._shouldNotifyNavigationInfoInvalidated=!1),this._enqueueUpcomingTlfsDeadline!=0&&We.milliseconds()>this._enqueueUpcomingTlfsDeadline&&this._enqueueUpcomingTlfs()}_filterOverlays(e){let t=e.length;for(let r=0;r<e.length;r=r+1){let n=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e[r].id);if(n==null){t=r;break}n.setUsedAsBaseScreen(!1)}return t==e.length?e:e.slice(0,t)}_filterPresentedState(e){if(e==null)return null;if(e.stateId==null&&e.overlays.length==0)return e;let t=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e.stateId);if(t==null)return new Sr(null,[]);t.setUsedAsBaseScreen(!0);let r=this._filterOverlays(e.overlays);return r==e.overlays?e:new Sr(e.stateId,r)}_filterChange(e){if(e==null)return null;let t=this._filterPresentedState(e.oldStateAndOverlays),r=this._filterPresentedState(e.newStateAndOverlays);return t==e.oldStateAndOverlays&&r==e.newStateAndOverlays?e:new Ur(1,yt.ROOT_STABLE_PATH(),t,r)}enforceValidPrototypeStateForTesting(){this._enforceValidPrototypeState()}_enforceValidPrototypeState(){let e=!1;if(this._initiatedChange!=null){let n=this._initiatedChange.oldStateId()!=null&&this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.oldStateId())==null,o=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.newStateId())==null;e=n||o}else if(this._changeHistory.length>0){let n=ce.List_last(this._changeHistory).newStateId();e=this._appState.prototypeStructure().validDestinationForPrototypeFromId(n)==null}else return;if(e){this.restartPrototype(0);return}let t=null,r=null;if(this._initiatedChange!=null){let n=this._filterChange(this._initiatedChange);this._initiatedChange!=n&&(r=this._initiatedHistory.slice(),t=n)}else if(this._changeHistory.length>0){let n=ce.List_last(this._changeHistory),o=this._filterChange(n);o!=n&&(r=this._changeHistory.slice(),t=o)}t!=null&&r!=null&&(ce.List_removeLast(r),r.push(t),this._requestStateChange(t,r),this.commitStateChange())}getTlfHistory(){return this._tlfHistory}getLastChangeInHistory(){return this._changeHistory.length<1?null:ce.List_last(this._changeHistory)}getHistoryCount(){return this._changeHistory.length}getInitiatedChange(){return this._initiatedChange}getCurrentBaseScreenId(){return this._initiatedChange!=null?this._initiatedChange.newStateAndOverlays.stateId:this._changeHistory.length>0?ce.List_last(this._changeHistory).newStateAndOverlays.stateId:null}getCurrentBaseScreenNode(){var t;let e=this.getCurrentBaseScreenId();return e==null?null:(t=this._appState.scene())==null?void 0:t.findNode(e)}getCurrentBaseScreenIndex(){let e=this.getCurrentBaseScreenId();return e==null?-1:this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)}getNextBaseScreenIdForPrototype(){let e=this.getCurrentBaseScreenIndex(),t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();return e<0?null:e>=t.length-1?this._getUpcomingTlf():J.fromString(t[e+1])}getNextBaseScreenNodeForPrototype(){return this._appState.scene().findNode(this.getNextBaseScreenIdForPrototype())}getNextBaseScreenIdForFrameList(){let e=this.getCurrentBaseScreenIndex(),t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();return e<0||e>=t.length-1?null:J.fromString(t[e+1])}getNextBaseScreenNodeForFrameList(){return this._appState.scene().findNode(this.getNextBaseScreenIdForFrameList())}getPreviousBaseScreenId(){let e=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),t=this.getCurrentBaseScreenIndex();return t<1?null:J.fromString(e[t-1])}getPreviousBaseScreenNode(){return this._appState.scene().findNode(this.getPreviousBaseScreenId())}getCurrentOverlays(){return this.bindOverlays(this.getCurrentOverlayData())}getCurrentOverlayData(){return this._initiatedChange!=null?this._initiatedChange.newOverlayData():this._changeHistory.length>0?ce.List_last(this._changeHistory).newOverlayData():[]}getCurrentOverlayIds(){return this.getCurrentOverlays().map(e=>e.id())}getOpenOverlayData(e){let t=this.getCurrentOverlays();for(let r=0,n=t.length;r<n;r=r+1){let o=t[r];if(J.equals(o.id(),e))return o}return null}getTopmostScreenAndPoint(e){let t=this.getCurrentBaseScreenNode(),r=this.getTopmostOverlayNode();return r?[r,this.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(t,e)]:[t,e]}getTopmostScreen(){return this.getTopmostOverlayNode()??this.getCurrentBaseScreenNode()}getTopmostScreenId(){return this.getTopmostOverlayId()??this.getCurrentBaseScreenId()}getTopmostOverlay(){let e=this.getCurrentOverlays();return e.length>0?ce.List_last(e):null}getTopmostOverlayId(){let e=this.getCurrentOverlays();return e.length>0?ce.List_last(e).id():null}getTopmostOverlayNode(){var t;let e=this.getCurrentOverlays();return e.length==0?null:(t=this._appState.scene())==null?void 0:t.findNode(ce.List_last(e).id())}getSecondTopmostOverlayNodeOrBaseScreen(){var t;let e=this.getCurrentOverlays();return e.length==0?null:e.length==1?this.getCurrentBaseScreenNode():(t=this._appState.scene())==null?void 0:t.findNode(e[e.length-2].id())}getLayersIds(){let e=this.getCurrentBaseScreenId();if(e==null)return[];let t=this.getCurrentOverlayIds().slice();return t.unshift(e),t}getPreviousNonTransientChange(){let e=this._changeHistory.slice();for(;e.length>0&&ce.List_last(e).isTransientChange();)e.pop();if(e.length==0)return null;for(;e.length>0;){let t=e.pop();if(!(e.length>0&&ce.List_last(e).isTransientChange()||this._appState.prototypeStructure().validDestinationForPrototypeFromId(t.oldStateId())==null))return t}return null}bindOverlays(e){let t=[];for(let r=0,n=e.length;r<n;r=r+1)t.push(new xc(this._appState.scene(),e[r],r>0?t[r-1]:null,r));return t}getOngoingNavigateRepairsInvalidState(){return this._ongoingNavigateRepairsInvalidState}lastNodeForBaseScreen(){var t;let e=null;return this._initiatedChange!=null?e=this._initiatedChange.oldStateId():this._changeHistory.length>0&&(e=ce.List_last(this._changeHistory).newStateId()),e==null?null:(t=this._appState.scene())==null?void 0:t.findNode(e)}nextNodeForBaseScreen(){var e,t;return((e=this._initiatedChange)==null?void 0:e.newStateId())==null?null:(t=this._appState.scene())==null?void 0:t.findNode(this._initiatedChange.newStateId())}lastNodeForOverlayAt(e){var r;let t=null;if(this._initiatedChange!=null)t=this._initiatedChange.oldOverlayData();else if(this._changeHistory.length>0)t=ce.List_last(this._changeHistory).newOverlayData();else return null;return t.length<=e?null:(r=this._appState.scene())==null?void 0:r.findNode(t[e].id)}nextNodeForOverlayAt(e){var r;if(this._initiatedChange==null)return null;let t=this._initiatedChange.newOverlayData();return t.length<=e?null:(r=this._appState.scene())==null?void 0:r.findNode(t[e].id)}displayedOverlayCount(){return this._initiatedChange!=null?Math.max(this._initiatedChange.oldOverlayData().length,this._initiatedChange.newOverlayData().length):this._changeHistory.length>0?ce.List_last(this._changeHistory).newOverlayData().length:0}nodeForOverlayAt(e){var r;let t=this.getCurrentOverlayData();return t.length<=e?null:(r=this._appState.scene())==null?void 0:r.findNode(t[e].id)}getCurrentFitMode(){return this._currentFitMode}setFitModeFromParameter(e){let t=2;switch(e){case"contain":{t=1;break}case"scale-down":{t=2;break}case"min-zoom":{t=3;break}case"scale-down-width":{t=5;break}case"fit-width":{t=6;break}case"free":{t=4;break}default:break}if(t!=this._currentFitMode){let r=this._currentFitMode;this._currentFitMode=t,this._notifyFitModeChange(r,this._currentFitMode)}}_notifyFitModeChange(e,t){this._observers.forEach(r=>{r.handleFitModeChange(e,t)})}actionCounter(){return this._actionCounter}setTransitionOnClick(e){this._transitionOnClick=e}getTransitionOnClick(){return this._transitionOnClick}setInteractionsEnabled(e){this._interactionsEnabled=e}interactionsEnabled(){return this._interactionsEnabled}isDragging(){return this._isDragging}setIsDragging(e){this._isDragging=e}showDeviceFrame(){return this._showDeviceFrame}setShowDeviceFrame(e){this._showDeviceFrame=e}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}closeOverlayAtAndAbove(e,t){let r=Fn.getDefaultExternalExecution();this._closeOverlayAtAndAbove(e,r.interactionAddress,r.canvasSpaceTriggerBoundsOrNull,0,null,t)}closeOverlayForHotspot(e,t,r,n){var c;let o=null,a=null,s=0;e!=null&&t!=null?(o=(c=e.topLevelAncestor())==null?void 0:c.id(),a=Fn.forNoodle(e,t,n),s=ut.fromInteractionType(t.event().interactionType())):(Le("closeOverlayForHotspot called with null hotspot"),o=this.getTopmostOverlayId(),a=Fn.getDefaultExternalExecution(),s=0);let l=this.getCurrentOverlayData();for(let d=l.length-1;d>=0;d=d-1)if(J.equals(l[d].id,o)){this._closeOverlayAtAndAbove(d,a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,s,null,r);return}}_closeOverlayAtAndAbove(e,t,r,n,o,a){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let s=this.getCurrentOverlayData();if(s.length>e){let l=Ur.forClosingTopNOverlays(s.length-e,this.getCurrentBaseScreenId(),s,t,r,n);if(o==null)switch(a){case 0:{o=this._changeHistory.slice();break}case 1:{o=jt.FrozenList_cloneAndAppendOne(this._changeHistory,l);break}case 2:{o=[l];break}}this._requestStateChange(l,o)}}navigateToFrameAndCloseOverlays(e,t=null,r=2,n=0,o=0,a=null,s=null){var T;if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let l=this.getCurrentBaseScreenNode(),c=(T=this._appState.prototypeStructure())==null?void 0:T.getDestinationFrame(e);if(c!=null)this._appState.prototypeStructure().validDestinationForPrototypeFromId(c.id())||De.trackDefinedEvent("prototype.viewer_navigation_invalid_destination",{cause:o,nodeType:c.type(),interactionId:(a==null?void 0:a.id())??""}),c.setUsedAsBaseScreen(!0),e=c.id();else if(!X.isInlinePreview())return;let d=this.getCurrentOverlayData();if(J.equals(e,l==null?void 0:l.id())&&(l==null?void 0:l.scene())==(c==null?void 0:c.scene())&&d.length==0)return;let h=l!=null?l.id():null,u=[],m=t!=null&&a!=null?Fn.forNoodle(t,a,s):Fn.getDefaultExternalExecution(),g=new Ur(3,yt.ROOT_STABLE_PATH(),new Sr(h,d),new Sr(e,u),m.interactionAddress,m.canvasSpaceTriggerBoundsOrNull,m.transitionParameters,n,o),_=null;switch(r){case 0:{_=this._changeHistory;break}case 1:{_=jt.FrozenList_cloneAndAppendOne(this._changeHistory,g);break}case 2:{_=[g];break}}let f=!1,S=c,b=l;if(c!=null&&l!=null&&(S=c.findNearestAncestorOrNull("SECTION"),b=l.findNearestAncestorOrNull("SECTION"),f=S!=null&&b!=null),f){let y=this._getStateMachineOrNull(new yt([S.id()]));if(y==null||this._shouldDisableNewChangesInStateMachine(y))return;y.clearInitiatedChangesInSelfAndSubstates();let I=null;switch(r){case 0:{I=y.changeHistory();break}case 1:{I=jt.FrozenList_cloneAndAppendOne(y.changeHistory(),g);break}case 2:{I=[g];break}}if(this._requestAndSaveSectionStateChange(y,g,I,_),S!=b&&S.parent()==b){let p=new Ur(3,yt.ROOT_STABLE_PATH(),new Sr(h,d),new Sr(S.id(),u),m.interactionAddress,m.canvasSpaceTriggerBoundsOrNull,m.transitionParameters,n,o),A=this._getStateMachineOrNull(new yt([b.id()]));if(A==null||this._shouldDisableNewChangesInStateMachine(A))return;switch(A.clearInitiatedChangesInSelfAndSubstates(),r){case 0:{I=A.changeHistory();break}case 1:{I=jt.FrozenList_cloneAndAppendOne(A.changeHistory(),p);break}case 2:{I=[p];break}}this._saveSectionStateChange(A,p,I)}}else this._requestStateChange(g,_)}overlayFrame(e,t,r,n,o,a){var g;if(!this._allowNewStateChanges()||this.getCurrentBaseScreenId()==null||t==null)return;this._clearInitiatedChangesBeforeNewChange();let s=o!=null?Fn.forNoodle(t,o,a):Fn.forExternalOpenOverlay(t),l=this.getCurrentOverlayData(),c=(g=this._appState.prototypeStructure())==null?void 0:g.getDestinationFrame(e);if(c==null){Le("tried to open to null overlay");return}let d=new wc(c.id(),e,s.interactionAddress.hotspotStablePath,s.interactionAddress.interactionId,s.transitionParameters,this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen()??this.getCurrentBaseScreenNode(),c)),h=this.getCurrentBaseScreenId(),u=new Ur(3,yt.ROOT_STABLE_PATH(),new Sr(h,l),new Sr(h,jt.FrozenList_cloneAndAppendOne(l,d)),s.interactionAddress,s.canvasSpaceTriggerBoundsOrNull,s.transitionParameters,r,n);c.setUsedAsBaseScreen(!1);let m=jt.FrozenList_cloneAndAppendOne(this._changeHistory,u);this._requestStateChange(u,m)}getSetVariableActionHistoryLength(){return this._setVariableActionHistory.length}getSetVariableModeActionHistoryLength(){return this._setVariableModeActionHistory.length}createMultiplayerSetVariableAction(e,t,r,n){let o={nodeForFindingTopmostScreenId:J.toFigGUID(e),targetVariableId:t,targetVariableData:JSON.stringify(r),resolvedVariableModes:JSON.stringify(n)};this._addVariableToHistory(o)}createMultiplayerSetVariableModeAction(e,t,r){let n={targetVariableSetKey:t,targetVariableModeId:r};this._addVariableModeToHistory(n)}performMultiplayerSetVariableAction(e){L().runSetVariable(J.fromFigGUID(e.nodeForFindingTopmostScreenId),e.targetVariableId,JSON.parse(e.targetVariableData),JSON.parse(e.resolvedVariableModes)),this._addVariableToHistory(e)}performMultiplayerSetVariableModeAction(e){L().runSetVariableMode(J.fromFigGUID(e.nodeForFindingTopmostScreenId),e.targetVariableSetKey,e.targetVariableModeId),this._addVariableModeToHistory(e)}_addVariableToHistory(e){let t=e.targetVariableId;if(this._variableIdToSetVariableActionHistoryIndex.has(t)){let r=this._variableIdToSetVariableActionHistoryIndex.get(t);this._setVariableActionHistory[r]=e}else this._variableIdToSetVariableActionHistoryIndex.set(t,this._setVariableActionHistory.length),this._setVariableActionHistory.push(e);this._notifyMultiplayerSetVariableActionHistory()}_addVariableModeToHistory(e){let t=e.targetVariableSetKey;if(this._variableSetKeyToSetVariableModeActionHistoryIndex.has(t)){let r=this._variableSetKeyToSetVariableModeActionHistoryIndex.get(t);this._setVariableModeActionHistory[r]=e}else this._variableSetKeyToSetVariableModeActionHistoryIndex.set(t,this._setVariableModeActionHistory.length),this._setVariableModeActionHistory.push(e);this._notifyMultiplayerSetVariableModeActionHistory(),this._setOverlaysToParentModes(this.getCurrentOverlayData(),this.getCurrentBaseScreenId(),!0)}_notifyMultiplayerSetVariableActionHistory(){this._observers.forEach(e=>{var t;(t=e.handleSetVariableAction)==null||t.call(e,this._setVariableActionHistory)})}_notifyMultiplayerSetVariableModeActionHistory(){this._observers.forEach(e=>{var t;(t=e.handleSetVariableModeAction)==null||t.call(e,this._setVariableModeActionHistory)})}resetVariablePrototypeState(){L().resetLocalVariableChanges(),L().resetLocalVariableModeChanges(),this.resetSetVariableActionHistory(),this.resetSetVariableModeActionHistory()}resetSetVariableActionHistory(){this._setVariableActionHistory=[],this._variableIdToSetVariableActionHistoryIndex=new Map,this._notifyMultiplayerSetVariableActionHistory()}resetSetVariableModeActionHistory(){this._setVariableModeActionHistory=[],this._variableSetKeyToSetVariableModeActionHistoryIndex=new Map,this._notifyMultiplayerSetVariableModeActionHistory()}createVideoStateChange(e,t,r,n,o){if(e==null||t==null||r==null)return;let a={targetNodeId:J.toFigGUID(e),isPlaying:t,isPlayingSound:r,currentTimes:n,actionTakenTimestamp:o};this._addVideoStateChangeToHistory(a)}performMultiplayerVideoStateChange(e,t){this._appState.videoManager().multiplayerUpdateVideoRuntimes(e,t),this._addVideoStateChangeToHistory(t)}_addVideoStateChangeToHistory(e){let t=!1;for(let r=0;r<this._videoStateChangeHistory.length;r++)if(J.fromFigGUID(this._videoStateChangeHistory[r].targetNodeId)==J.fromFigGUID(e.targetNodeId)){this._videoStateChangeHistory[r]=e,t=!0;break}t||this._videoStateChangeHistory.push(e),this._notifyMultiplayerVideoStateChangeToHistory()}_notifyMultiplayerVideoStateChangeToHistory(){this._observers.forEach(e=>{var t;(t=e.handleVideoStateChange)==null||t.call(e,this._videoStateChangeHistory)})}getVideoStateChange(e){return this._videoStateChangeHistory[e]}getVideoStateChanges(){return this._videoStateChangeHistory.slice()}resetVideoStateChangeHistory(){var t,r;let e=this._videoStateChangeHistory.slice();this._videoStateChangeHistory=[],(r=(t=this._appState.videoManager())==null?void 0:t.resetVideoStateChanges)==null||r.call(t,e)}resetSectionsState(){let e=this._appState.getActiveCanvas();if(e!=null){let t=e.findAllSectionsInNode();for(let r of t){let n=this._getStateMachineOrNull(new yt([r.id()]));n!=null&&n.resetHistoryToFirstFrameInSection(r)}}}resetPrototype(){var e;this._appState.scene()!=null&&(this._clearInitiatedChangesBeforeNewChange(),this._isResettingStateChangeMutations=!0,(e=L())==null||e.resetLocalChanges(),this._initiatedInstanceChanges=new Map,this._isResettingStateChangeMutations=!1,this._clearOverlays(this.getCurrentOverlayData()),this.resetSectionsState(),vr.clearCachedNodePaths(),this.componentStateSyncer.handleRestartPrototype()),this._initiatedChange=null,this._initiatedHistory=null,this._changeHistory=[],this._tlfHistory=[],this._upcomingTlfs=new Set,this.resetSetVariableActionHistory(),this.resetSetVariableModeActionHistory(),this.resetVideoStateChangeHistory(),this._actionCounter=this._actionCounter+1,this._lastInitiatedTopLevelStateChange=null,this._lastInitiatedInstanceStateChange=null}restartPrototype(e){var n;if(this.logVerbose(()=>`[PrototypeState] restartPrototype started for ${Zi[e]}`),this.resetPrototype(),this._observers.forEach(o=>{o.handleRestartPrototype()}),X.getViewerMode()==X.ViewerMode.MIRROR)return;if(((n=this._appState.scene())==null?void 0:n.findNode(this._appState.activePrototypeStartingPointNodeId()))==null){let o=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();o!=null&&this._appState.setActivePrototypeStartingPointNodeId(o.id())}let r=this._appState.prototypeStructure().nodeToRestartPrototypeOn(this._appState.getActiveCanvas());r!=null&&(e==0&&(this._ongoingNavigateRepairsInvalidState=!0),this.navigateToFrameAndCloseOverlays(r.id()),this.tryToInitiateRequestedStateChange(i.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW)),this.logVerbose(()=>`[PrototypeState] restartPrototype finished for ${Zi[e]}`)}returnToState1(e){this.returnToState2(null,null,e,0,null,null)}returnToState2(e,t,r,n,o,a){var h;if(!this._allowNewStateChanges()||this._changeHistory.length<=1)return;let s=r!=2,l=null;this._clearInitiatedChangesBeforeNewChange();let c=this._changeHistory.slice(),d=null;for(e!=null&&t!=null?d=Fn.forNoodle(e,t,a):d=Fn.getDefaultExternalExecution();c.length>1&&(s&&ce.List_last(c).isTransientChange());)l=c.pop();if(r==0||c.length<=1){((h=t==null?void 0:t.event())==null?void 0:h.interactionType())=="DRAG"&&this._returnToOverlayState(d,n,l==null?void 0:l.oldOverlayData(),l,c);return}for(l=ce.List_last(c);c.length>1;){let u=c.pop();if(c.length>1&&s&&ce.List_last(c).isTransientChange())continue;let g=u.oldStateId();if(J.equals(g,this.getCurrentBaseScreenId()))this._returnToOverlayState(d,n,u.oldOverlayData(),l,c);else{if(this._appState.prototypeStructure().validDestinationForPrototypeFromId(u.oldStateId())==null)continue;this._returnToFrame(g,d,n,l,c,o)}break}}_returnToFrame(e,t,r,n,o,a){var m;let s=(m=this._appState.prototypeStructure())==null?void 0:m.getDestinationFrame(e),l=n.transitionParameters.withStateManagementSettings(a),c=new Ur(4,yt.ROOT_STABLE_PATH(),new Sr(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new Sr(e,[]),r,t.interactionAddress,1,l);if(s!=null)s.setUsedAsBaseScreen(!0);else{Le("tried to return to deleted frame");return}let d=!1,h=s.findNearestAncestorOrNull("SECTION"),u=this.getCurrentBaseScreenNode().findNearestAncestorOrNull("SECTION");if(h!=null&&u!=null){if(h==u||h==u.parent()){let g=this._getStateMachineOrNull(new yt([h.id()])),_=ce.List_last(g.changeHistory()),f=jt.FrozenList_cloneAndRemoveOne(g.changeHistory(),_);this._requestAndSaveSectionStateChange(g,c,f,o),d=!0}else if(u==h.parent()){c=new Ur(4,yt.ROOT_STABLE_PATH(),new Sr(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new Sr(h.id(),[]),r,t.interactionAddress,1,n.transitionParameters);let g=this._getStateMachineOrNull(new yt([u.id()])),_=ce.List_last(g.changeHistory()),f=jt.FrozenList_cloneAndRemoveOne(g.changeHistory(),_);this._requestAndSaveSectionStateChange(g,c,f,o),d=!0}}d||this._requestStateChange(c,o)}_returnToOverlayState(e,t,r,n,o){var s;let a=this.getCurrentOverlayData();if(r.length<a.length)this._closeOverlayAtAndAbove(r.length,e.interactionAddress,e.canvasSpaceTriggerBoundsOrNull,t,o,0);else{for(let d=0,h=r.length;d<h;d=d+1){let u=(s=this._appState.prototypeStructure())==null?void 0:s.getDestinationFrame(r[d].id);if(u==null)break;u.setUsedAsBaseScreen(!1)}let l=this.getCurrentBaseScreenId(),c=new Ur(4,yt.ROOT_STABLE_PATH(),new Sr(l,this.getCurrentOverlayData()),new Sr(l,r),t,e.interactionAddress,1,n.transitionParameters);this._requestStateChange(c,o)}}swapTopOverlay(e,t,r,n,o){var g;if(!this._allowNewStateChanges())return;let a=this.getCurrentOverlayData(),s=this.getCurrentBaseScreenId();if(s==null||a.length==0)return;this._clearInitiatedChangesBeforeNewChange();let l=(g=this._appState.prototypeStructure())==null?void 0:g.getDestinationFrame(e),c=a.slice();c[c.length-1]=c[c.length-1].cloneWithId(l.id(),this._getOverlayDerivedModes(this.getSecondTopmostOverlayNodeOrBaseScreen(),l));let d=null,h=0;t!=null&&n!=null?(d=Fn.forNoodle(t,n,o),h=ut.fromInteractionType(n.event().interactionType())):(d=Fn.getDefaultExternalExecution(),h=0);let u=new Ur(3,yt.ROOT_STABLE_PATH(),new Sr(s,a),new Sr(s,c),d.interactionAddress,d.canvasSpaceTriggerBoundsOrNull,d.transitionParameters,0,h);if(l==null){Le("tried to swap to null overlay");return}l.setUsedAsBaseScreen(!1);let m=jt.FrozenList_cloneAndAppendOne(this._changeHistory,u);this._requestStateChange(u,m)}_clearInitiatedChangesBeforeNewChange(){this._disableNewStateChanges=!0,this._appState.scene()!=null&&this._forEachTransitioningStateMachine(e=>{let t=this._getStateMachineOrNull(e);return t!=null&&t.clearInitiatedChangesInSelfAndSubstates(),0}),this._initiatedChange!=null&&this.commitStateChange(),this._disableNewStateChanges=!1}_allowNewStateChanges(){return this.interactionsEnabled()&&!this._disableNewStateChanges}abortStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._initiatedChange=null,this._initiatedHistory=null,this._broadcastStateChange(e,2,null),this._handleOverlaysModeSetting(e,2),this._enforceValidPrototypeState()}commitStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._changeHistory=this._initiatedHistory,this._initiatedChange=null,this._initiatedHistory=null,this.logVerbose(()=>`[PrototypeState] commitTopLevelChange ${e.debugString(this._appState.scene())}`);let t=[],r=n=>{t.push(n)};if(this._broadcastStateChange(e,3,r),this._handleOverlaysModeSetting(e,3),this._allowNewStateChanges())for(let n of t)n();X.isInlinePreview()||this._enforceValidPrototypeState()}_enqueueUpcomingTlfs(){let e=this.getCurrentBaseScreenNode();if(e==null)return;let t=qt.adjacentBaseScreens(this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF(),e);for(let r of t.asList())this._upcomingTlfs.add(r);this._shouldNotifyNavigationInfoInvalidated=!0,this._enqueueUpcomingTlfsDeadline=0}_getUpcomingTlf(){for(;this._upcomingTlfs.size>0;){let e=qt.visuallySortLayersLeftToRightAndTopToBottom2(this._appState.scene(),Array.from(this._upcomingTlfs.values()).map(t=>J.fromString(t)))[0];if(this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)>=0){this._upcomingTlfs.delete(e);continue}return this._appState.scene().findNode(e)==null?null:J.fromString(e)}return null}setForceInitiateStateChangeForTests(e){this._forceInitiateStateChangeForTests=e}_requestStateChange(e,t){var r;this._broadcastStateChange(e,0,null),this._requestedStateChange=new i.StateChangeRequest(e,t),this._requestedStateChangeAtMs=We.milliseconds(),this._emitter.trigger("requestedStateChange",{interactionId:(r=e==null?void 0:e.interactionAddress)==null?void 0:r.interactionId,cause:ut[e.cause],destinationId:e.newStateId()}),this._disableNewStateChanges=!0,this.tryToInitiateRequestedStateChange(i.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED)}_requestAndSaveSectionStateChange(e,t,r,n){this._appState.scene()!=null&&(e.stage(t,r),this._requestStateChange(t,n),J.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}_saveSectionStateChange(e,t,r){this._appState.scene()!=null&&(e.stage(t,r),J.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}tryToInitiateRequestedStateChange(e){this._requestedStateChange!=null&&(this._forceInitiateStateChangeForTests||e==i.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW?this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history):this._requestedStateChange.change.newStateAndOverlays.statesAndOverlaysIncluded().asList().every(n=>{var a;let o=(a=this._appState.scene())==null?void 0:a.findNode(n);return o==null?!1:o.hasBeenLoaded()})&&this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history))}_maybeTrackStateChangeInitiated(e){var r;let t=e.newStateAndOverlays.statesAndOverlaysIncluded();for(let n of t.asList())this._visitedScreenIds._in(n)||this._visitedScreenIds.add(n);if(this._requestedStateChangeAtMs>0){let n=We.milliseconds()-this._requestedStateChangeAtMs;if(n>100){let o={prototypeType:Xi[this._appState.prototypeStructure().currentType()],incrementalFrameLoading:!0,timeWaitedForLoadingMs:n,interactionId:(r=e==null?void 0:e.interactionAddress)==null?void 0:r.interactionId,interactionCause:ut[e.cause],destinationId:e.newStateId()},a=this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.newStateId());this._appState.requestedFrameMetricsTracker().clear(),a&&(o.destinationWasLoaded=a.wasAlreadyLoaded,o.destinationWasInWorkingSet=a.wasAlreadyInWorkingSet),De.trackDefinedEvent("prototype.viewer_reached_unloaded_frame",o)}}}_initiateStateChange(e,t){this._disableNewStateChanges=!0;for(let o of e.getRemovedFrameIds())this._forEachMaterializedStateInTlf(o,a=>{if(a.changeHistory().length>0&&ce.List_last(a.changeHistory()).isTransientChange()){let s=ut.getOppositeTransientAction(ce.List_last(a.changeHistory()).cause);return this.returnInstanceToState(a.stablePath,0,s),a.clearInitiatedChangesInSelfAndSubstates(),2}return 0});this._emitter.trigger("requestedStateChangeInitiated"),this._maybeTrackStateChangeInitiated(e),this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._disableNewStateChanges=!1,this._initiatedChange=e,this._initiatedHistory=t;let r=e.newStateId();this._tlfHistory.indexOf(r)<0&&ce.List_appendOne(this._tlfHistory,r),this._shouldNotifyNavigationInfoInvalidated=!0,this.logVerbose(()=>`[PrototypeState] initiateTopLevelChange ${e.debugString(this._appState.scene())}`),this._lastInitiatedTopLevelStateChange=e,this._actionCounter=this._actionCounter+1,this._broadcastStateChange(e,1,null),this._handleOverlaysModeSetting(e,1),(e==null?void 0:e.oldStateId())!=(e==null?void 0:e.newStateId())&&(this._ongoingNavigateRepairsInvalidState=!1),e.direction==1&&e.transitionParameters.transitionType=="INSTANT_TRANSITION"&&this.commitStateChange(),this._deferEnqueueUpcomingTlfs()}_handleOverlaysModeSetting(e,t){let r=e.oldOverlayData(),n=r.length,o=e.newOverlayData(),a=o.length;if(!(a==0&&n==0)){if(a>n)t==1?this._setOverlaysToParentModes(o.slice(n),e.oldStateAndOverlays.topId()):t==2&&this._clearOverlays(o.slice(n));else if(a<n)t==3&&this._clearOverlays(r.slice(a));else if(a>0&&n>0&&a===n&&o[a-1].id!=r[n-1].id){let s=[o[a-1]];t==1?this._setOverlaysToParentModes(s,this.getSecondTopmostOverlayNodeOrBaseScreen().id()):t==2&&this._clearOverlays(s),t==3&&this._clearOverlays([r[n-1]])}}}_getOverlayDerivedModes(e,t){let r=t.getExplicitVariableModesWithSetKeys(),n=t.getResolvedVariableModesWithSetKeys(),o=e.getResolvedVariableModesWithSetKeys();return Object.entries(o).filter(([a,s])=>n[a]!=null&&r[a]==null)}_setOverlaysToParentModes(e,t,r){var o;let n=t;e.forEach(a=>{let s=this._appState.scene().findNode(a.id),l=this._appState.scene().findNode(n),c=l.getResolvedVariableModesWithSetKeys(),d=[];r?a.newOverlayExplicitModes.forEach(([h,u])=>{c[h]!=u&&s.setExplicitVariableModeForCollectionWithSetKey(h,c[h]),d.push([h,c[h]])}):this._getOverlayDerivedModes(l,s).forEach(([h,u])=>{s.setExplicitVariableModeForCollectionWithSetKey(h,c[h]),d.push([h,c[h]])}),a.newOverlayExplicitModes=d,n=a.id}),(o=L())==null||o.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}_clearOverlays(e){var t;e.forEach(r=>{let n=this._appState.scene().findNode(r.id);if(n==null)return;let o=n.getExplicitVariableModesWithSetKeys();r.oldOverlayDerivedModes.filter(([a,s])=>o[a]!=null&&(r.newOverlayExplicitModes[a]==null||o[a]==r.newOverlayExplicitModes[a])).forEach(([a,s])=>{n.clearExplicitVariableConsumerModeForCollectionWithSetKey(a)})}),(t=L())==null||t.updateImmutableFramesAndLayoutDirtyGroupsAndStacks()}lastInitiatedTopLevelStateChange(){return this._lastInitiatedTopLevelStateChange}_broadcastStateChange(e,t,r){let n=this._isNotifyingStateChangeObservers;switch(n&&Le("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,t){case 0:{this._observers.forEach(o=>{o.handleStateChangeRequested(e)});break}case 1:{this._observers.forEach(o=>{o.handleStateChangeInitiated(e)});break}case 2:{this._observers.forEach(o=>{o.handleStateChangeAborted(e)});break}case 3:{this._observers.forEach(o=>{o.handleStateChangeCommitted(e,r)});break}}this._isNotifyingStateChangeObservers=n}debugHSMTree(){console.log("== Component SST =="),console.log(this.componentStateSyncer.debugString()),console.log("== Component HSM =="),console.log(this._hsmRoot.debugHierarchy(this._appState.scene()))}addHsmObserver(e){this._hsmObservers.add(e)}removeHsmObserver(e){this._hsmObservers.remove(e)}_getStateMachineOrNull(e){let t=e==null?void 0:e.guids;if(t==null)return null;let r=this._hsmRoot;for(let n of t){if(r==null)break;r=r.childOrNull(n)}return r}getStateMachineOrNull(e){return this._getStateMachineOrNull(e)}_getStateMachineOrNullWithString(e){return this._getStateMachineOrNull(yt.fromString(e))}_getParentStateMachineOrNull(e){return e.guids.length==0?null:this._getStateMachineOrNull(e.slice2(0,e.guids.length-1))}_forMaterializedStateMachineAndDescendants(e,t){var o;let n=[this._getStateMachineOrNull(e)];for(;n.length>0;){let a=n.pop();if(a!=null){let s=((o=this._appState.scene())==null?void 0:o.findNodeByStablePath(a.stablePath))==null,l=0;s?a==this._hsmRoot?l=0:l=2:l=t(a);let c=!1;switch(l){case 1:{c=!0;break}case 0:{Or(n,a.getChildren());break}case 2:continue}if(c)break}}}createOrRepairStateMachinesForInsertedSubtree(e){Wr(e,t=>{if(t.isInstance()){let r=t.symbolID()??J.invalid();J.isValid(r)||console.warn("Unexpected null symbolData for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(t,r)}else t.type()=="SECTION"&&this.createOrRepairSectionStateMachineIfNeeded(t,t.id())})}createOrRepairSectionStateMachineIfNeeded(e,t){let r=this._getParentStateMachineOrNull(e.stablePath());if(r==null){Le("Could not create or repair state machine for section with null parent");return}let n=ce.List_last(e.stablePath().guids),o=r.childOrNull(n);if(o!=null)if(J.equals(o.stateId(),t)){this._isResettingStateChangeMutations&&o.resetHistoryToFirstFrameInSection(e);return}else o.initiatedChange()!=null&&this.commitSectionStateChange(o);r.setChild(n,new il(this,e,t,!0))}createOrRepairInstanceStateMachineIfNeeded(e,t){let r=this._getParentStateMachineOrNull(e.stablePath());if(r==null){console.warn("Could not create or repair state machine with null parent");return}let n=ce.List_last(e.stablePath().guids),o=r.childOrNull(n);if(o!=null){if(J.equals(o.stateId(),t)){this._isResettingStateChangeMutations&&o.resetHistoryToState(t);return}else if(o.initiatedChange()!=null){if(this.isApplyingStateChangeMutation())return;this.commitInstanceStateChange(o)}}r.setChild(n,new il(this,e,t))}actionCounterForState(e){let t=this._getStateMachineOrNull(e);return t==null?-1:t.actionCounter}actionCountersForStateAndAncestors(e){let t=[this.actionCounter()];for(let r=0,n=e.guids.length;r<n;r=r+1)t.push(this.actionCounterForState(e.slice2(0,r+1)));return t}getStateMachineInitiatedChange(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.initiatedChange()}getStateMachineLastChangeInHistory(e){let t=this._getStateMachineOrNull(e);return t==null||t.changeHistory().length==0?null:t!=null?ce.List_last(t.changeHistory()):null}getLastFrameOrSectionVisitedInSection(e){if(e==null)return null;let t=this.getStateMachineLastChangeInHistory(new yt([e]));return t!=null?t.newStateAndOverlays.stateId:null}getState(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.stateId()}_forEachMaterializedStateInTlf(e,t){var n;let r=(n=this._appState.scene())==null?void 0:n.findNode(e);r==null||!r.isTopLevel()||Wr(r,o=>{if(o.isInstance()){let a=this._getStateMachineOrNull(o.stablePath());if(a!=null)return t(a)}return 0})}_forEachTransitioningStateMachine(e){for(let t of Array.from(this._initiatedInstanceChanges.keys()))if(Array.from(this._initiatedInstanceChanges.keys()).indexOf(t)!=-1){let r=this._initiatedInstanceChanges.get(t);if(e(r.stablePath)==1)break}}getOnscreenStates(){let e=[],t=this.getLayersIds();for(let r of t)this._forEachMaterializedStateInTlf(r,n=>{if(2==0){let o=this._appState.scene().findNodeByStablePath(n.stablePath)}return e.push(new cn(n.stablePath,n.stateId())),0});return e}forMaterializedStateInstanceAndDescendants(e,t){this._forMaterializedStateMachineAndDescendants(e,r=>t(r.stablePath))}_deferEnqueueUpcomingTlfs(){this._enqueueUpcomingTlfsDeadline=We.milliseconds()+(Po?0:250)}lastInitiatedInstanceStateChange(){return this._lastInitiatedInstanceStateChange}_forStateMachineAndParents(e,t){let r=e.guids,n=[],o=this._hsmRoot,a=0;for(;o!=null&&a<r.length;)o=o.childOrNull(r[a]),o!=null&&n.push(o),a=a+1;if(!(n.length==0||!yt.equals(ce.List_last(n).stablePath,e))){for(let s=n.length-1;s>=0;s=s-1)if(t(n[s])==1)return}}_shouldDisableNewChangesInStateMachine(e){var n;let t=(n=this._appState.scene())==null?void 0:n.findNodeByStablePath(e.stablePath);if(t==null)return!0;let r=t;for(;r!=null;){let o=this._getStateMachineOrNull(r.stablePath());if(o!=null&&o.isClearingChangesInSelfAndSubstates())return!0;r=r.parent()}return!1}swapInstanceToState1(e,t,r,n,o,a){this.swapInstanceToState2(e,t,r,n,o,a,null)}swapInstanceToState2(e,t,r,n,o,a,s){this.logVerbose(()=>`[HSM] >>>>>>>> swap instance ${e} to state -> ${t} cause: ${ut[n]}`);let l=this._getStateMachineOrNull(e);if(l==null||this._shouldDisableNewChangesInStateMachine(l)||this._validatedStateSwapDestination(l.stateId(),t)==null)return;l.clearInitiatedChangesInSelfAndSubstates();let d=r!=null&&o!=null?Fn.forNoodle(r,o,s):Fn.getDefaultExternalExecution(),h=new Ur(2,l.stablePath,l.stateId(),t,d.interactionAddress,d.canvasSpaceTriggerBoundsOrNull,d.transitionParameters,n),u=null;switch(a){case 0:{u=l.changeHistory();break}case 1:{u=jt.FrozenList_cloneAndAppendOne(l.changeHistory(),h);break}case 2:{u=[h];break}}let m=this._shouldDisallowSwap(e,t);m==1?this._onStateSwapFailedDueToCycle():m==0&&this._requestInstanceStateChange(l,h,u)}returnInstanceToState(e,t,r){this.logVerbose(()=>`[HSM] >>>>>>>> return instance ${e} to previous state cause: ${ut[r]}`);let n=this._getStateMachineOrNull(e);if(n==null||this._shouldDisableNewChangesInStateMachine(n)||(n.clearInitiatedChangesInSelfAndSubstates(),n.changeHistory().length<=1))return;let o=n.cloneHistoryForReturnToState(t,(h,u)=>this._validatedStateSwapDestination(h,u)),a=o.a,s=o.b,l=this._validatedStateSwapDestination(n.stateId(),ce.List_last(s).newStateId());if(l==null)return;let c=new Ur(2,n.stablePath,n.stateId(),l.id(),a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,a.transitionParameters,r),d=this._shouldDisallowSwap(n.stablePath,l.id());d==1?this._onStateSwapFailedDueToCycle():d==0&&this._requestInstanceStateChange(n,c,s)}_requestInstanceStateChange(e,t,r){this._forMaterializedStateMachineAndDescendants(e.stablePath,o=>{if(o!=e&&o.changeHistory().length>0&&ce.List_last(o.changeHistory()).isTransientChange()){let a=ut.getOppositeTransientAction(ce.List_last(o.changeHistory()).cause);return this.returnInstanceToState(o.stablePath,0,a),o.clearInitiatedChangesInSelfAndSubstates(),2}return 0});let n=this._appState.scene();if(n!=null){e.stage(t,r),this._initiatedInstanceChanges.set(e.stablePath.toString(),t),this._lastInitiatedInstanceStateChange=t;let o=this._appState.scene().findNodeByStablePath(t.interactionAddress.hotspotStablePath),a=new Map,s=null;this._isApplyingStateChangeMutation=!0,e.broadcastHsmStateChange(this._hsmObservers,t,0,null),n.dangerouslyDeferNodeRemovalScope(()=>{let d=this._getFullscreenNodeChangesForStateSwap(e.stablePath,t.newStateId(),0);for(let h of d.cloneOps)h.clone.copyNodeCachedTransformAndBounds(h.source),a.set(h.source,h.clone);s=this._appState.scene().findNodeByStablePath(d.transitionRootStablePath)});let l=Nc.Map_getOrDefault(a,o,null),c=Nc.Map_getOrDefault(a,s,null);s!=null&&c!=null?s.transitioningFrom=new ic(c,t.stablePath,l):Le("Failed to find swapped out node after state swap"),J.equals(t.oldStateId(),t.newStateId())||(this._forEachTransitioningStateMachine(d=>{if(!yt.equals(t.stablePath,d)){let h=n.findNodeByStablePath(d);if(s!=null&&s.isAncestorOf(h)){let u=this._getStateMachineOrNull(d);this.commitInstanceStateChange(u)}}return 0}),this._deferEnqueueUpcomingTlfs()),this._isApplyingStateChangeMutation=!1}e.actionCounter=e.actionCounter+1,e.broadcastHsmStateChange(this._hsmObservers,t,1,null),this.logVerbose(()=>`[HSM] initiate ${t.oldStateId()} -> ${t.newStateId()} finished for ${e.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitChangesBelowStablePath(e){var r,n;let t=(r=this._appState.scene())==null?void 0:r.findNodeByStablePath(e);for(let o of Array.from(this._initiatedInstanceChanges.keys())){let a=this._initiatedInstanceChanges.get(o),s=this._getStateMachineOrNull(a.stablePath);s!=null&&t!=null&&t.isAncestorOf((n=this._appState.scene())==null?void 0:n.findNodeByStablePath(s.stablePath))&&this.commitInstanceStateChange(s)}}commitChangesBelowInstanceTransitionRoot(e){let t=this._findTransitionRootForSwappedPath(e),r=t==null?e:t.stablePath();this.commitChangesBelowStablePath(r)}commitInstanceStateChange(e){if(e.initiatedChange()==null)return;let t=e.initiatedChange();e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null),this._initiatedInstanceChanges.delete(e.stablePath.toString()),J.equals(t.oldStateId(),t.newStateId())||this._finishStateSwapMutation(t.stablePath);let r=[],n=o=>{r.push(o)};if(e.broadcastHsmStateChange(this._hsmObservers,t,3,n),!e.isClearingChangesInSelfAndSubstates())for(let o of r)o();this.logVerbose(()=>`[HSM] commit ${t.oldStateId()} -> ${t.newStateId()} finished for ${t.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitSectionStateChange(e){e.initiatedChange()!=null&&(e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null))}abortInstanceStateChange(e){let t=this._getStateMachineOrNull(e);if(t==null||t.initiatedChange()==null)return;let r=t.initiatedChange();if(this._appState.scene()!=null){t.stage(null,null),this._initiatedInstanceChanges.delete(t.stablePath.toString());let o=this._findTransitionRootForSwappedPath(e),a=o.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,o.transitioningFrom=null,a.removeSelfAndSubtree(),t.broadcastHsmStateChange(this._hsmObservers,r,0,null),this._getFullscreenNodeChangesForStateSwap(t.stablePath,r.oldStateId(),1),this._isApplyingStateChangeMutation=!1}t.broadcastHsmStateChange(this._hsmObservers,r,2,null),this.logVerbose(()=>`[HSM] abort ${r.oldStateId()} -> ${r.newStateId()} finished for ${t.stablePath} -- ${r.transitionParameters.transitionType} !`)}_validatedStateSwapDestination(e,t){var s,l;let r=(s=this._appState.scene())==null?void 0:s.findNode(e),n=r==null?void 0:r.parent();if((r==null?void 0:r.type())!="SYMBOL"||n==null||!n.isStateGroup())return null;let o=(l=this._appState.scene())==null?void 0:l.findNode(t),a=o==null?void 0:o.parent();return(o==null?void 0:o.type())!="SYMBOL"||a==null||!a.isStateGroup()||J.equals(e,t)?null:J.equals(n.id(),a.id())?o:null}isApplyingStateChangeMutation(){return this._isApplyingStateChangeMutation}isResettingStateChangeMutations(){return this._isResettingStateChangeMutations}_findTransitionRootForSwappedPath(e){var r;let t=(r=this._appState.scene())==null?void 0:r.findNodeByStablePath(e);for(;t!=null;){if(t.transitioningFrom!=null&&t.transitioningFrom.swappedStablePath==e)return t;t=t.parent()}return null}_finishStateSwapMutation(e){let t=this._findTransitionRootForSwappedPath(e);if(this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation started for ${e}`),t==null)return;let r=t.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,t.transitioningFrom=null,r.removeSelfAndSubtree(),this._isApplyingStateChangeMutation=!1,t.invalidateRenderTreeForSelfAndParents(),t.invalidateRenderTreeForChildren(),this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation finished for ${e}`)}_getFullscreenNodeChangesForStateSwap(e,t,r){return L().getNodeChangesForSwap(e,t,r)}_shouldDisallowSwap(e,t){return L().shouldDisallowSwap(e,t)}logVerbose(e){this.VERBOSE_LOGS&&(this.debugHSMTree(),console.log(e()))}};(t=>{class i{constructor(n,o){this.change=n,this.history=o}}t.StateChangeRequest=i;let e;(o=>(o[o.WAIT_UNTIL_DESTINATIONS_LOADED=0]="WAIT_UNTIL_DESTINATIONS_LOADED",o[o.FORCE_INITIATE_NOW=1]="FORCE_INITIATE_NOW"))(e=t.InitiateRequestedStateChangePolicy||(t.InitiateRequestedStateChangePolicy={}))})(Ji||(Ji={}));var Zi=(t=>(t[t.FIX_INVALID_STATE=0]="FIX_INVALID_STATE",t[t.USER_REQUESTED=1]="USER_REQUESTED",t))(Zi||{});var yp=class{handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){this.callback(e)}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}handleSetVariableAction(e){}constructor(e){this.callback=e}},il=class{constructor(e,t,r,n){this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=e,t?(this.stablePath=t.stablePath(),n?this.resetHistoryToFirstFrameInSection(t):this.resetHistoryToState(r)):(this.stablePath=new yt([]),this.setChangeHistory([]))}changeHistory(){return this._changeHistory}setChangeHistory(e){this._changeHistory=e}debugHierarchy(e){return this._debugHierarchy(0,e)}_debugHierarchy(e,t){let r="";for(let u=0,m=e;u<m;u=u+1)r+="  ";r+=this.stablePath.toString()+": ";let n="missing state name",o="(N/A)";if(this.stateId()!=null){let u=t.findNode(this.stateId());u!=null&&(n=u.name()??"null state name"),o="("+this.stateId()+")"}r+="<"+n+" "+o+">";let a="[",s=0,l=3,c=this.changeHistory();c.length>l&&(a+="..., ",s=c.length-l);for(let u=s,m=c.length;u<m;u=u+1){let g=c[u];a+=`${(g==null?void 0:g.oldStateId())??"null"}->${g==null?void 0:g.newStateId()}`,u!=c.length-1&&(a+=", ")}a+="]",r+=" "+a;let d=t.findNodeByStablePath(this.stablePath);if(d!=null){let u=d.name()??"null node name";r+=" "+u}let h=this.initiatedChange()!=null?`{${this.initiatedChange().oldStateId()??"null"}->${this.initiatedChange().newStateId()}}`:"";r+=" "+h+`
`;for(let u of Array.from(this._children.values()))r+=u._debugHierarchy(e+1,t);return r}removeChild(e){this._children.delete(e)}setChild(e,t){this._children.set(e,t)}childOrNull(e){return He.StringMap_get(this._children,e,null)}getChildren(){return Array.from(this._children.values())}stage(e,t){this._initiatedChange=e,this._initiatedChangeHistory=t}initiatedChange(){return this._initiatedChange}initiatedChangeHistory(){return this._initiatedChangeHistory}stateId(){var t,r;if(((t=this.initiatedChange())==null?void 0:t.newStateId())!=null)return(r=this.initiatedChange())==null?void 0:r.newStateId();let e=this.changeHistory();return e!=null&&e.length>0?ce.List_last(e).newStateId():J.invalid()}clearInitiatedChangesInSelfAndSubstates(){this._isClearingChangesInSelfAndSubstates=!0,this._prototypeState.commitChangesBelowInstanceTransitionRoot(this.stablePath),this._isClearingChangesInSelfAndSubstates=!1}isClearingChangesInSelfAndSubstates(){return this._isClearingChangesInSelfAndSubstates}cloneHistoryForReturnToState(e,t){let r=e!=2,n=null,o=this.changeHistory().slice();for(;o.length>1&&(r&&ce.List_last(o).isTransientChange());)n=o.pop();if(e==0||o.length<=1)return new cn(n,o);for(n=ce.List_last(o);o.length>1;){let a=o.pop();if(!(o.length>1&&r&&ce.List_last(o).isTransientChange()||t(a.newStateId(),a.oldStateId())==null))break}return new cn(n,o)}resetHistoryToState(e){let t=new Ur(2,this.stablePath,null,e,po.EXTERNAL,null,Kr.getDefault(),0);this.setChangeHistory([t])}resetHistoryToFirstFrameInSection(e){let t=qt.visuallySortedTopLevelFrames(e);if(t.length>0){let r=t[0];if(r!=null){let n=new Ur(2,this.stablePath,null,r.id(),po.EXTERNAL,null,Kr.getDefault(),0);this.setChangeHistory([n])}}else this.setChangeHistory([])}broadcastHsmStateChange(e,t,r,n){let o=this._isNotifyingStateChangeObservers;switch(o&&console.warn("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,r){case 0:{e.forEach(a=>{a.handleHsmRequested(this.stablePath,t)});break}case 1:{e.forEach(a=>{a.handleHsmInitiated(this.stablePath,t)});break}case 2:{e.forEach(a=>{a.handleHsmAborted(this.stablePath,t)});break}case 3:{e.forEach(a=>{a.handleHsmCommitted(this.stablePath,t,n)});break}}this._isNotifyingStateChangeObservers=o}};var Tp=class{track(e,t){this._frameRequestInfo.set(e,t)}getMetricsForRequestedNode(e){return this._frameRequestInfo.get(e)}clear(){this._frameRequestInfo.clear()}constructor(){this._frameRequestInfo=new Map}};var vp=class{hash(){return Mr.bytesToHex(this._hash)}getVideoManager(){return this._videoManager}size(e){return this._videoManager.getVideoRuntimeForPaint(e).size()}didLoad(e){let t=this._videoManager.getVideoRuntimeForPaint(e);return t==null?!1:t.isReadyToPlay()}getOrCreateTexture(e,t,r){let n=this._videoManager.getVideoRuntimeForPaint(e);return n==null||n.shouldDisplayThumbnail?null:n.getOrCreateTexture(t,r)}pause(e){let t=this._videoManager.getVideoRuntimeForPaint(e);t!=null&&t.pause()}constructor(e,t){this.id=B0++,this._hash=e,this._videoManager=t,this._loadComplete=!1}},B0=0;var Dn;(e=>e.VERBOSE_LOGS=!1)(Dn||(Dn={}));var sl=class sl{clone(){let e=new sl(this._hash,this._sourceURL,this._metaMP4Url,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(e),e}isReadyToPlay(){if(this._player==null||!this._loadComplete||this._isInErrorState)return!1;if(Gt.ios()||this._seeking)return this._player.readyState()>al.HAVE_NOTHING;{let e=this._player.currentTime()==this._player.duration()&&this._player.readyState()>=al.HAVE_CURRENT_DATA;return this._player.readyState()>=al.HAVE_FUTURE_DATA||e}}isInErrorState(){return this._isInErrorState}uninitialize(){this._player!=null&&(this.pause(),this.setMuted(!1),this.resetToStartTime(),this._player.dispose())}toString(){if(this._player==null)return`Runtime(id=${this.id},  <NO VIDEO INFORMATION> )`;let e=this._player.currentTime()|0,t=St.int_remainder(e,60)<10?`0${St.int_remainder(e,60)}`:`${St.int_remainder(e,60)}`,n=`${(e/60|0)<10?`0${e/60|0}`:`${e/60|0}`}:${t}`;return this._isInErrorState?`Runtime(id=${this.id}, <LOADING ERROR>)`:`Runtime(id=${this.id}, time=${n}, ready=${this.isReadyToPlay()}, P=${!this._player.paused()}, M=${this._player.muted()}, L=${this._loop})`}_setMuted(e,t){if(this._player!=null){Gt.ios()&&!e&&this._videoManager.muteAllOtherVideos(this);try{this._player.muted(e),t&&(this.overriddenMutedState=new fe(e))}catch{De.trackEvent("video_mute_failure",{errorState:this._isInErrorState,loadComplete:this._loadComplete,fileType:this._fileTypeLoading})}}}setMutedByVideoAction(e){this._setMuted(e,!0)}setMuted(e){this._setMuted(e,!1)}muted(){return this._player!=null?this._player.muted():!0}setLoop(e){this._loop=e}size(){return this._player==null?null:new R(this._player.videoWidth(),this._player.videoHeight())}_pause(e){Dn.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Pausing"),this._player!=null&&(this._player.pause(),e&&(this.overriddenPlayingState=new fe(!1)))}pauseByVideoAction(){this._pause(!0)}pause(){this._pause(!1)}_play(e,t){Dn.VERBOSE_LOGS&&(e?console.log("VideoResource #",this.id,": Loop playback"):console.log("VideoResource #",this.id,": Start playback")),this._player!=null&&this.isReadyToPlay()&&(this.shouldDisplayThumbnail=!1,this._player.play().then(r=>{t&&(this.overriddenPlayingState=new fe(!0))},r=>{let n=r.message+"";n.indexOf("The play() request was interrupted")!=-1?this.warnPlayFailureAnalytics(e?`Loop error: ${n}`:n):(console.warn("User has yet to interact with page, starting video muted",r),this.setMuted(!0),this._player.play().then(o=>{},o=>{let a=o.message+"";e&&(a=`Loop error: ${a}`),this.warnPlayFailureAnalytics(a)}))}))}_playLoop(){this._play(!0,!1)}playByVideoAction(){this._play(!1,!0)}play(){this._play(!1,!1)}duration(){return this._player!=null?this._player.liveTracker!=null?this._player.liveTracker.seekableEnd():this._player.duration():0}currentTime1(){return this._player!=null?this._player.currentTime():0}currentTime2(e){this._player!=null&&(this._player.paused()&&this._player.one("timeupdate",t=>{this.invalidateTexture()}),this._player.currentTime(e))}resetToStartTime(){this.currentTime2(0)}isPlaying(){return this._player==null?!1:!this._player.paused()}invalidateTexture(){if(this._texture==null)return;this._texture.invalidateVideoFrame()}_handleOnLoadedMetadata(){var e;Dn.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Loading completed"),this.reportLoadSuccessAnalytics(),this._loadComplete=!0,window.vid=this,(e=this._videoManager)==null||e.onVideoLoaded(this)}_beginLoadingHLS(e){this._loadTimeTracker.start(),this._fileTypeLoading="hls",this._player.src({type:"application/x-mpegURL",src:this._sourceURL}),this._player.one("error",t=>{this._loadTimeTracker.end(),console.warn("Reverting to fallback media source"),this.reportLoadFailureAnalytics("Failed to access HLS manifest"),this._beginLoadingMP4()})}_getMP4Url(){let e=new jn;return this._MP4VideoUrl!=null?(e.resolve(this._MP4VideoUrl),e):(new Zn(this._metaMP4Url).get().then(t=>{let r=null;try{r=JSON.parse(t.text)}catch{e.reject("Failed to parse response");return}let n=new fe(r.status);if(n.value===void 0){e.reject("Failed to parse status from response");return}if(n.value!=200){e.reject(`Status is ${n.value}: ${r.message}`);return}let o=r.meta;if(o===void 0){e.reject("Status is 200, but failed to parse signed_url");return}let a=o.signed_url;if(a===void 0){e.reject("Status is 200, but failed to parse signed_url");return}this._MP4VideoUrl=a,e.resolve(a)},t=>{e.reject(`Request failed with status: ${t.status}`)}),e)}_isWebMVideo(){let e=new jn;return this._getMP4Url().then2(t=>{new Zn(t).head().then(r=>{e.resolve(r.contentType=="video/webm")},r=>{e.resolve(!1)})},t=>{e.resolve(!1)}),e}_beginLoadingMP4(){this._loadTimeTracker.start(),this._fileTypeLoading="mp4",this._getMP4Url().then2(e=>{this._player.src({type:"video/mp4",src:e}),this._player.one("error",t=>{this._loadTimeTracker.end(),this._isInErrorState=!0;try{this.reportLoadFailureAnalytics(`Failed to access mp4. Status: ${t.status} Message: ${t.message}`)}catch{this.reportLoadFailureAnalytics("Failed to access mp4.")}})},e=>{this._loadTimeTracker.end(),this.reportLoadFailureAnalytics(`Failed to acquire mp4 url. ${e}`),this._isInErrorState=!0})}startLoadIfNeeded(){if(this._player!=null)return;let e=document.createElement("video");if(e.crossOrigin="anonymous",e.style.display="none",document.body.appendChild(e),this._player=Un.instance().getPlayer(e),this._player==null){Un.instance().isLibAvailable()&&(this._isInErrorState=!0,this.reportLoadFailureAnalytics("Failed to create VideoJS player"));return}this._player.muted(!0),this._player.playsinline(!0),this._player.autoplay(!1),this._player.loop(!1),this._player.ready(()=>{this._player.on("ended",t=>{this._loop?this._playLoop():this.resetToDefaultState()}),this._player.on("seeking",t=>{this._seeking=!0}),this._player.on("seeked",t=>{this._seeking=!1}),this._player.on("loadedmetadata",t=>{this._handleOnLoadedMetadata()})}),this._beginLoadingHLS(this._sourceURL)}on(e,t){let r=n=>{t(this._player)};return this._player!=null&&this._player.on(e,r),r}off(e,t){this._player!=null&&this._player.off(e,t)}getOrCreateTexture(e,t){if(this._texture==null&&this._loadComplete){let r=zd.VideoJsPlayer_getBackingVideo(this._player);this._texture=e.createTextureWithVideo(t,r,"Video")}return!this.isReadyToPlay()||this.isInErrorState()?null:this._texture}resetToDefaultState(){this.overriddenPlayingState=null,this.overriddenMutedState=null}_getCurrentLocation(){return window.location.href.indexOf("/community/")!=-1?"community_viewer":"viewer"}reportLoadFailureAnalytics(e){this._loadTimeTracker.end();let t=this._loadTimeTracker.getLoadTime();t<0||(console.warn("Video failed to load:",e),De.trackDefinedEvent("prototype.video_load",{status:"failure",hash:this._hash,load_time:t,file_type:this._fileTypeLoading,reason:e,location:this._getCurrentLocation()}))}reportLoadSuccessAnalytics(){this._loadTimeTracker.end();let e=this._loadTimeTracker.getLoadTime();e<0||De.trackDefinedEvent("prototype.video_load",{status:"success",hash:this._hash,load_time:e,file_type:this._fileTypeLoading,width:this._player.videoWidth(),height:this._player.videoHeight(),location:this._getCurrentLocation()})}warnPlayFailureAnalytics(e){console.warn("Video failed to play:",e)}constructor(e,t,r,n){this.id=(sl.nextID=sl.nextID+1)+-1,this._hash=e,this._sourceURL=t,this._metaMP4Url=r,this._videoManager=n,this._loadTimeTracker=new wg,this._loadComplete=!1,this._texture=null,this._player=null,this._isInErrorState=!1,this._fileTypeLoading="hls",this._loop=!1,this._seeking=!1,this._prevReadyState=al.HAVE_NOTHING,this.overriddenPlayingState=null,this.overriddenMutedState=null,this.shouldDisplayThumbnail=!0,this._MP4VideoUrl=null}};sl.nextID=0;var Lc=sl,al;(o=>(o.HAVE_NOTHING=0,o.HAVE_METADATA=1,o.HAVE_CURRENT_DATA=2,o.HAVE_FUTURE_DATA=3,o.HAVE_ENOUGH_DATA=4))(al||(al={}));var wg=class{start(){this._endConditionSeconds=-1,this._startConditionSeconds=We.seconds()}end(){this._endConditionSeconds=We.seconds()}getLoadTime(){return this._endConditionSeconds<0||this._startConditionSeconds<0?-1:this._endConditionSeconds-this._startConditionSeconds}constructor(){this._startConditionSeconds=-1,this._endConditionSeconds=-1}},Mc=class extends ya{uninitialize1(){this.uninitialize2(e=>{e.uninitialize()})}toString1(){return this.toString2(e=>e.toString())}constructor(){super()}};var Ip=class{constructor(e){this._visiblePaints=new Set([]),this._appState=null,this._lastStateChange=null,this._appState=e}isPaintVisible(e){return this._visiblePaints.has(e)}forEachVisiblePaint(e){for(let t=0,r=Array.from(this._visiblePaints.values()).length;t<r;t=t+1)e(Array.from(this._visiblePaints.values())[t])}refreshVisibleVideosIfNeeded(){this.handlePrototypeStateChange(this._lastStateChange)}handlePrototypeStateChange(e){var a;if(e==null)return;this._visiblePaints=new Set;let t=e.newStateId(),r=(a=this._appState.scene())==null?void 0:a.findNode(t);if(r==null)return;this._lastStateChange=e,this._gatherVisibleVideoResources(r);let n=e.newOverlayData();for(let s=0,l=n.length;s<l;s=s+1){let c=this._appState.scene().findNode(n[s].id);this._gatherVisibleVideoResources(c)}let o="";this.forEachVisiblePaint(s=>{o+=" "+s.id().toString()+","}),Dn.VERBOSE_LOGS&&console.log("Found these visible paints:",o)}_gatherVisibleVideoResources(e){if(!e.visible())return;for(let r=0,n=e.childCount();r<n;r=r+1)this._gatherVisibleVideoResources(e.childAt1(r));let t=null;if(e.getCachedRenderTree()!=null)t=e.getCachedRenderTree();else if(e.getCachedRenderTreeForBaseScreen()!=null)t=e.getCachedRenderTreeForBaseScreen();else return;this._gatherVideosFromRenderNode(t.value)}_gatherVideosFromRenderNode(e){if(e!=null)switch(e.op()){case 3:{this._gatherVideosFromFillNode(e);break}case 4:{this._gatherVideosFromFillStrokeNode(e);break}case 5:{this._gatherVideosFromMaskNode(e);break}case 1:{this._gatherVideosFromGroupNode(e);break}case 6:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 2:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 9:{let t=e;this._gatherVideosFromRenderNode(t.alpha);break}case 7:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 8:{let t=e;this._gatherVideosFromRenderNode(t.tree);break}case 10:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 11:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 12:{let t=e;this._gatherVideosFromRenderNode(t.startChild),this._gatherVideosFromRenderNode(t.endChild);break}case 0:{let t=e;this._gatherVideosFromRenderNode(t.child);break}}}_gatherVideosFromFillNode(e){let t=e.geometry.paints;Ce.forEachPaintWithVideo(t,r=>{this._visiblePaints.add(r)})}_gatherVideosFromFillStrokeNode(e){let t=e.fillGeometries;for(let r=0,n=t.length;r<n;r=r+1){let o=t[r].paints;Ce.forEachPaintWithVideo(o,a=>{this._visiblePaints.add(a)})}for(let r=0,n=e.strokeGeometries.length;r<n;r=r+1){let o=e.strokeGeometries[r].paints;Ce.forEachPaintWithVideo(o,a=>{this._visiblePaints.add(a)})}}_gatherVideosFromMaskNode(e){this._gatherVideosFromRenderNode(e.color)}_gatherVideosFromGroupNode(e){for(let t=0,r=e.children.length;t<r;t=t+1)this._gatherVideosFromRenderNode(e.children[t])}getLastTopLevelStateChange(){return this._lastStateChange}};var cl=class i{constructor(e,t,r,n){this.status=i.Status.PENDING,this.interactionType=e,this.interactionID=t,this.hotspotNodeID=r,this.listener=n,this.internalEventListeners=[]}};(e=>{let i;(o=>(o[o.PENDING=0]="PENDING",o[o.ACTIVE=1]="ACTIVE",o[o.SUPERCEDED=2]="SUPERCEDED"))(i=e.Status||(e.Status={}))})(cl||(cl={}));var ll=class{constructor(e,t){this.nodePath=e,this.videoPlayback=t}},Bc=class{constructor(e,t){this.eventName=e,this.listener=t}},Vc=class{runtimeStorage(){return this._runtimeStorage}associatePaintWithNode(e,t){this._needToRecalculateVisibleVideos=!0;let r=t.uniqueIdentifier();this._paintToNodeGUIDMap.set(e,r),this._guidToVideoMetadata.set(r,new ll(vr.getSemanticNodePath(t),t.videoPlayback())),this._paintsForPlaybackSettingsRefresh.add(e)}constructor(e){this._appState=null,this._guidToVideoMetadata=new Map,this._hashToRuntimeMap=new Map,this._paintToNodeGUIDMap=new Map,this._runtimeStorage=new Mc,this._deferredRuntimes=new Set,this._deferredInteractionEvents=new Set,this._visibilityTracker=null,this._needToRecalculateVisibleVideos=!1,this._framePotentiallyReadyToPlay=!0,this._paintsForPlaybackSettingsRefresh=new Set,this._lastTransitionShouldForceStateRefresh=!1,this._userHasInteractedWithPage=!1,this._appState=e,this._visibilityTracker=new Ip(e),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}getNodeMetadata(e){return this._guidToVideoMetadata.has(e)?this._guidToVideoMetadata.get(e):new ll([],null)}getVideoRuntimeForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),r=this.getNodeMetadata(t).nodePath,n=e.video().hash();return this._runtimeStorage.getData(r,n)}getPlaybackSettingsForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),r=this.getNodeMetadata(t).videoPlayback;return r==null&&(r={autoplay:!0,mediaLoop:!0,muted:!1}),r}_populateRuntimesForVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintToNodeGUIDMap.has(e))return;let t=this._paintToNodeGUIDMap.get(e),r=this.getNodeMetadata(t).nodePath;if(this.getVideoRuntimeForPaint(e)!=null)return;let n=e.video().hash(),o=this._hashToRuntimeMap.get(n).clone();this._runtimeStorage.insert(r,n,o)})}getVideoRuntimesForNode(e){let t=this.getNodeMetadata(e).nodePath;return this._runtimeStorage.getAllDataForNode(t)}updateVideoRuntime(e,t){let r=J.isValid(e.transitionNodeID())?e.transitionNodeID():t;if(!this._guidToVideoMetadata.has(r))return;let n,o,a=[],s=this.getVideoRuntimesForNode(r);s!=null&&(s.forEach((l,c)=>{if(l!=null){switch(e.mediaAction()){case"PLAY":{l.playByVideoAction();break}case"PAUSE":{l.pauseByVideoAction();break}case"TOGGLE_PLAY_PAUSE":{l.isPlaying()?l.pauseByVideoAction():l.playByVideoAction();break}case"MUTE":{l.setMutedByVideoAction(!0);break}case"UNMUTE":{l.setMutedByVideoAction(!1);break}case"TOGGLE_MUTE_UNMUTE":{l.setMutedByVideoAction(!l.muted());break}case"SKIP_FORWARD":{let d=e.mediaSkipByAmount(),h=Math.min(l.currentTime1()+d,l.duration()-.01);l.currentTime2(h);break}case"SKIP_BACKWARD":{let d=e.mediaSkipByAmount(),h=Math.max(0,l.currentTime1()-d);l.currentTime2(h);break}case"SKIP_TO":{let d=e.mediaSkipToTime(),h=Math.max(0,d);h=Math.min(h,l.duration()-.01),l.currentTime2(h);break}}n=l.isPlaying(),o=!l.muted(),a.push(l.currentTime1()*1e3)}}),n!=null&&o!=null&&a.length>0&&this._createVideoStateChangeInPrototypeState(r,n,o,a))}_createVideoStateChangeInPrototypeState(e,t,r,n){this._appState.prototypeState().createVideoStateChange(e,t,r,n,this._currentTruncatedTimeInMilliseconds())}resetVideoStateChanges(e){e.forEach(t=>{let r=J.fromFigGUID(t.targetNodeId);if(!this._guidToVideoMetadata.has(r))return;let n=this.getVideoRuntimesForNode(r);if(n==null)return;let o=[];n.forEach((a,s)=>{o.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(r,o)})}_createDefaultVideoStateChangeInPrototypeState(e,t){var n;let r=(n=this.getNodeMetadata(e))==null?void 0:n.videoPlayback;this._appState.prototypeState().createVideoStateChange(e,r==null?void 0:r.autoplay,r==null?void 0:r.muted,t,this._currentTruncatedTimeInMilliseconds())}multiplayerUpdateVideoRuntimes(e,t){let r=J.fromFigGUID(t.targetNodeId);if(!this._guidToVideoMetadata.has(r))return;let n=this.getVideoRuntimesForNode(r);if(n==null)return;let o=0;n.forEach((a,s)=>{if(a!=null){if(t.isPlaying!=a.isPlaying()&&(a.isPlaying()?a.pauseByVideoAction():a.playByVideoAction()),t.isPlayingSound!=!a.muted()&&a.setMutedByVideoAction(!t.isPlayingSound),!a.isPlaying()||t.currentTimes[o]!=e[o]){let l=this._currentTruncatedTimeInMilliseconds()-t.actionTakenTimestamp,d=(a.isPlaying()?t.currentTimes[o]+l:t.currentTimes[o])%(a.duration()*1e3);a.currentTime2(d/1e3)}o+=1}})}_currentTruncatedTimeInMilliseconds(){return Date.now()%1e6}_registerDeferredInteractionEvent(e){if(e.status==1)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null){for(let r of Array.from(t.keys())){let n=t.get(r);if(e.interactionType=="ON_MEDIA_END"){let o=n.on("ended",a=>{e.listener(a)});e.internalEventListeners.push(new Bc("ended",o))}else if(e.interactionType=="ON_MEDIA_HIT"){let o=n.on("timeupdate",a=>{e.listener(a)});e.internalEventListeners.push(new Bc("timeupdate",o)),o=n.on("play",a=>{e.listener(a)}),e.internalEventListeners.push(new Bc("play",o))}}e.status=1}}_deregisterDeferredInteractionEvent(e){if(e.status!=2)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null)for(let r of Array.from(t.keys())){let n=t.get(r);for(let o of e.internalEventListeners)n.off(o.eventName,o.listener)}}_getListenerForInteractionEvent(e,t,r){let n=null;if(e=="ON_MEDIA_END")n=o=>{r()};else if(e=="ON_MEDIA_HIT"){let o=!1;n=a=>{let s=a.currentTime(),l=a.liveTracker?a.liveTracker.seekableEnd():a.duration();t>l&&(t=l);let c=.3;if(s>=t-c&&s<t){let d=Math.ceil((t-s)*1e3)|0;setTimeout(()=>{let h=a.currentTime(),u=a.paused()&&h<t,m=h>=t&&h<t+c;!o&&!u&&m&&(o=!0,r())},d)}else o=!1}}else console.error("videoManager.addInteractionEvent() should only be called with video trigger events");return n}addInteractionEvent(e,t,r,n){let o=e.event().interactionType(),a=this._getListenerForInteractionEvent(o,r,n),s=new cl(o,e.id(),t,a);for(let l of Array.from(this._deferredInteractionEvents.values()))l.interactionID==s.interactionID&&(l.status=2,Un.instance().isLibAvailable()&&(this._deregisterDeferredInteractionEvent(l),this._deferredInteractionEvents.delete(l)));Un.instance().isLibAvailable()&&this._registerDeferredInteractionEvent(s),this._deferredInteractionEvents.add(s)}onFrame(){if(Dn.VERBOSE_LOGS&&console.log(this.debugString()),this._visibilityTracker!=null){if(this._needToRecalculateVisibleVideos&&(this._visibilityTracker.refreshVisibleVideosIfNeeded(),this._populateRuntimesForVisibleVideos(),this._framePotentiallyReadyToPlay=!0,this._needToRecalculateVisibleVideos=!1,Dn.VERBOSE_LOGS&&console.log(this.debugString())),this._framePotentiallyReadyToPlay&&this._allVisibleVideosAreLoaded()){this._framePotentiallyReadyToPlay=!1,this._applyPlaybackSettingsToVisibleVideos();for(let e of Array.from(this._deferredInteractionEvents.values()))e.status==0?this._registerDeferredInteractionEvent(e):e.status==2&&(this._deregisterDeferredInteractionEvent(e),this._deferredInteractionEvents.delete(e));Dn.VERBOSE_LOGS&&console.log(this.debugString())}this._invalidateTexturesOfPlayingVideos()}}resetAllRuntimesWithinNode(e){let t=new Kt(this._appState.scene().findNode(e)),r=vr.getSemanticNodePath(t),n=this._runtimeStorage.getSubTrie(r),o=[];n!=null&&n.forEach(a=>{a.resetToStartTime(),o.push(a.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,o)}resetAllRuntimesWithinTLFNode(e){let t=this._appState.scene().findNode(e);for(let o=0,a=t.childCount();o<a;o=o+1){let s=t.childAt1(o);this.resetAllRuntimesWithinNode(s.id())}let r=this._runtimeStorage.getSubTrie([new is(t.name(),0)]),n=[];r!=null&&r.forEach(o=>{o.resetToStartTime(),n.push(o.currentTime1())}),this._createDefaultVideoStateChangeInPrototypeState(e,n)}handleHsmAborted(e,t){}handleHsmCommitted(e,t,r){if(this._lastTransitionShouldForceStateRefresh=t.transitionParameters.transitionResetVideoPosition,t.transitionParameters.transitionResetVideoPosition){let n=this._appState.scene().findNodeByStablePath(e);n&&this.resetAllRuntimesWithinNode(n.id())}this.reactToStateChange(this._visibilityTracker.getLastTopLevelStateChange(),t.getInsertedFrameIds())}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}handleStateChangeCommitted(e,t){if(this._lastTransitionShouldForceStateRefresh=e.transitionParameters.transitionResetVideoPosition,e.transitionParameters.transitionResetVideoPosition){this.resetAllRuntimesWithinTLFNode(e.newStateId());let r=e.newOverlayData();for(let n=0,o=r.length;n<o;n=n+1)this.resetAllRuntimesWithinNode(r[n].id)}this.reactToStateChange(e,e.getInsertedFrameIds())}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._deleteVisibleRuntimes(),this._framePotentiallyReadyToPlay=!0}reactToStateChange(e,t){this._recalculateVisibleVideoPaints(e);let r=new Set;this._visibilityTracker.forEachVisiblePaint(n=>{if(!this._paintToNodeGUIDMap.has(n))return;let o=n.video().hash(),a=this._paintToNodeGUIDMap.get(n),s=this.getNodeMetadata(a).nodePath,l=this.getVideoRuntimeForPaint(n);l!=null&&r.add(l.id);let c=this._appState.scene().findNode(a);for(let d of t){let h=this._appState.scene().findNode(d);h!=null&&h.isAncestorOf(c)&&this._paintsForPlaybackSettingsRefresh.add(n)}if(l==null){let d=this._hashToRuntimeMap.get(o).clone();this._runtimeStorage.insert(s,o,d)}}),this._runtimeStorage.forEach(n=>{!r.has(n.id)&&n.isPlaying()&&n.pause()}),this._framePotentiallyReadyToPlay=!0}handleAction(e,t){this._userHasInteractedWithPage||(e==5||e==6||e==8||e==9||e==10)&&(this._userHasInteractedWithPage=!0,this._visibilityTracker.forEachVisiblePaint(r=>{let n=this.getVideoRuntimeForPaint(r),o=this.getPlaybackSettingsForPaint(r);n!=null&&o!=null&&!o.muted&&n.setMuted(o.muted)}),this._appState.removeActionObserver(this))}_applyPlaybackSettingsToVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintsForPlaybackSettingsRefresh.has(e))return;this._paintsForPlaybackSettingsRefresh.delete(e);let t=this.getVideoRuntimeForPaint(e),r=this.getPlaybackSettingsForPaint(e);if(t!=null&&r!=null){t.setLoop(r.mediaLoop),this._lastTransitionShouldForceStateRefresh&&t.resetToDefaultState();let o=t.overriddenMutedState==null?r.muted:t.overriddenMutedState.value;t.setMuted(o),(t.overriddenPlayingState==null?r.autoplay:t.overriddenPlayingState.value)?t.play():t.pause()}})}_invalidateTexturesOfPlayingVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{let t=this.getVideoRuntimeForPaint(e);t!=null&&t.isPlaying()&&t.invalidateTexture()})}_recalculateVisibleVideoPaints(e){Dn.VERBOSE_LOGS&&console.log("Recalculating visible paints"),this._visibilityTracker.handlePrototypeStateChange(e),this._visibilityTracker.forEachVisiblePaint(t=>{let r=this.getVideoRuntimeForPaint(t);r!=null&&r.startLoadIfNeeded()}),this._framePotentiallyReadyToPlay=!0}_deleteVisibleRuntimes(){Dn.VERBOSE_LOGS&&console.log("Deleting existing runtimes"),this._runtimeStorage.uninitialize1()}buildVideoResource(e){Un.instance().hasRequestedLibrary()||(Un.instance().onSuccess=()=>{for(let r of Array.from(this._deferredRuntimes.values()))r.startLoadIfNeeded()},Un.instance().requestLibrary());let t=new vp(e,this);if(!this._hashToRuntimeMap.has(t.hash())){let r=cr.getVideoPrefixUrl(),n=r!=null&&r.endsWith("/")?r:r+"/",o=`${n}${t.hash()}/manifest`,a=`${n}${t.hash()}`,s=new Lc(t.hash(),o,a,this);this._hashToRuntimeMap.set(t.hash(),s)}return t}_allVisibleVideosAreLoaded(){let e=!0;return this._visibilityTracker.forEachVisiblePaint(t=>{let r=this.getVideoRuntimeForPaint(t);r!=null&&!r.isReadyToPlay()&&!r.isInErrorState()&&(e=!1)}),e}onVideoLoaded(e){this._appState.imageManager()==null||this._appState.imageManager().onImageLoaded==null||(this._allVisibleVideosAreLoaded()?(Dn.VERBOSE_LOGS&&console.log("VideoManager - - : All videos in frame are loaded!"),this._appState.baseScreenNode()!=null&&this._appState.imageManager().onImageLoaded(this._appState.baseScreenNode())):Dn.VERBOSE_LOGS&&console.log("VideoManager - - : Not all videos in frame are loaded"))}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==72&&(this._guidToVideoMetadata.set(e.node.id(),new ll(vr.getSemanticNodePath(new Kt(e.node)),e.newVal)),this._paintToNodeGUIDMap.forEach((t,r)=>{t==e.node.id()&&this._paintsForPlaybackSettingsRefresh.add(r)}),this._framePotentiallyReadyToPlay=!0)}debugString(){let e=`VideoManager 
`;return e+="Need to recalculate visible videos: "+this._needToRecalculateVisibleVideos.toString()+`
`,e+="Frame may be ready to start playing videos: "+this._framePotentiallyReadyToPlay.toString()+`
`,e+=`	Loading Runtimes:
`,this._hashToRuntimeMap.forEach((t,r)=>{e+="		hash: "+r+" -> "+t.toString()+`
`}),e+=`	VisiblePaints:
`,this._visibilityTracker.forEachVisiblePaint(t=>{let r=this.getPlaybackSettingsForPaint(t);r!=null?e+="		"+t.debugString()+" muted="+r.muted.toString()+" loop="+r.mediaLoop.toString()+" autoplay="+r.autoplay.toString()+" hash: "+t.video().hash()+`
`:e+="		"+t.debugString()+` (no playback settings found) 
`}),e+=`	Paint -> GUID:
`,this._paintToNodeGUIDMap.forEach((t,r)=>{e+="		P="+r.id().toString()+" => "+t+`
`}),e}enqueueVideoOrStartLoad(e){Un.instance().isLibAvailable()?e.startLoadIfNeeded():this._deferredRuntimes.add(e)}muteAllOtherVideos(e){this._runtimeStorage.forEach(t=>{t.id!=e.id&&t.setMuted(!0)})}};var ur=class{emitter(){return this._emitter}scene(){return this._scene}prototypeState(){return this._prototypeState}prototypeStructure(){return this._prototypeStructure}imageManager(){return this._imageManager}videoManager(){return this._videoManager}requestedFrameMetricsTracker(){return this._requestedFrameMetricsTracker}serialization(){return this._serialization}currentFileKey(){return this._currentFileKey}setCurrentFileKey(e){this._currentFileKey=e}fontListPromise(){return this._fontListPromise}setFontListPromise(e){this._fontListPromise=e}renderDots(){return this._renderDots}setRenderDots(e){this._renderDots=e}baseScreenId(){return this._prototypeState.getCurrentBaseScreenId()}currentFitMode(){return this._prototypeState.getCurrentFitMode()}baseScreenNode(){return this._scene==null?null:this._prototypeState.getCurrentBaseScreenNode()}constructor(){this._appObservers=new zr,this._actionObservers=new zr,this._frameObservers=new zr,this._scene=null,this._canvas=null,this._prototypeState=null,this._prototypeStructure=null,this._imageManager=null,this._videoManager=null,this._requestedFrameMetricsTracker=new Tp,this._serialization=null,this._currentFileKey="",this._activePrototypeStartingPointNodeId=null,this._renderDots=!1,this._fontListPromise=Promise.resolve(),this._emitter=null,this._pendingSetActiveCanvas=null,this._emitter=$t.getEventEmitter(),this._prototypeState=new Ji(this),this._prototypeStructure=new qt(this),this._imageManager=new pp(this,()=>{this._emitter.trigger("showImageFetchFailureUI")}),this._videoManager=new Vc(this),this._serialization=new It(this._imageManager,this._videoManager),Vn&&L()==null&&Ad(new rl(di,this))}addAppObserver(e){this._appObservers.add(e)}removeAppObserver(e){this._appObservers.remove(e)}addActionObserver(e){this._actionObservers.add(e)}removeActionObserver(e){this._actionObservers.remove(e)}addFrameObserver(e){this._frameObservers.add(e)}removeFrameObserver(e){this._frameObservers.remove(e)}nodeTransitionTracker(){return this._prototypeStructure.nodeTransitionTracker()}triggerAction1(e){this.triggerAction2(e,null)}triggerAction2(e,t){this._actionObservers.forEach(r=>{r.handleAction(e,t)})}onFrame(){this._frameObservers.forEach(e=>{e.onFrame()})}resetStateForTests(){this._prototypeState.resetState()}setScene(e){var t;if(e!=this._scene){let r=this._scene;this._scene=e,(t=this._scene)==null||t.markLoaded(),this._appObservers.forEach(n=>{n.handleSceneChange(r,e)}),r!=null&&r.destroy(),this._scene==null?this.setActiveCanvas(null):this.setActiveCanvas(this._scene.firstUserCanvasOrNull())}}requestSetActiveCanvas(e){e.hasBeenLoaded()?this.setActiveCanvas(e):(this._pendingSetActiveCanvas=e,this.triggerAction2(11,e))}trySettingRequestedActiveCanvas(){this._pendingSetActiveCanvas!=null&&this._pendingSetActiveCanvas.hasBeenLoaded()&&(this.setActiveCanvas(this._pendingSetActiveCanvas),this._pendingSetActiveCanvas=null)}setActiveCanvas(e){if(this._canvas!=e){let t=this._canvas;this._canvas=e,this._appObservers.forEach(r=>{r.handleActiveCanvasChange(t,this._canvas)})}}getActiveCanvas(){return this._canvas!=null&&this._scene==null?(console.warn("getActiveCanvas called with null scene but non-null canvas"),null):this._canvas}activePrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.prototypeDevice()}storedPrototypeDevice(){var e;return(e=this.getActiveCanvas())==null?void 0:e.storedPrototypeDevice()}activePrototypeStartingPointNodeId(){return this._activePrototypeStartingPointNodeId}setActivePrototypeStartingPointNodeId(e){let t=this._activePrototypeStartingPointNodeId;this._activePrototypeStartingPointNodeId=e,this._appObservers.forEach(r=>{r.handleActivePrototypeStartingPointChange(t,e)})}};var Vb=fs(Bb());var qr=class qr{constructor(e){this._valueBySnapshotId=null,this._isDirty=!1,this._valueBySnapshotId=e}getValueOrNull(e){return He.StringMap_get(this._valueBySnapshotId,e,null)}updateValue(e,t){this._valueBySnapshotId.set(e,t),this._isDirty=!0}toString(){let e=Array.from(this._valueBySnapshotId.keys());e.sort((r,n)=>fo.string_compare(r,n));let t="";for(let r of e)t+=`
${qr._PREFIX}snapshotId: ${r}
`,t+=this._valueBySnapshotId.get(r);return t}isDirty(){return this._isDirty}static _createEmptyDefaultDirtyAtPath(e){if(qr._snapshotFileCache.has(e))throw new Error("Snapshot file at path already exists in cache");return qr._snapshotFileCache.set(e,new qr(new Map)),qr._snapshotFileCache.get(e)._isDirty=!0,qr._snapshotFileCache.get(e)}static loadOrCreateFromPath(e){let t=He.StringMap_get(qr._snapshotFileCache,e,null);return t!=null?Promise.resolve(t):ProtoTestHost_readFile(e).then(r=>{let n=He.StringMap_get(qr._snapshotFileCache,e,null);return n??(r==null?(console.log(`[Snapshot] Create empty default dirty snapshot at path ${e}`),qr._createEmptyDefaultDirtyAtPath(e)):(qr._snapshotFileCache.set(e,new qr(qr._snapshotStringToMap(r))),qr._snapshotFileCache.get(e)))})}static _snapshotStringToMap(e){let t=new Map,r=e.split(`
`),n=null,o=null;for(let a of r){let s=`${qr._PREFIX}snapshotId: `;a.startsWith(s)?(n!=null&&t.set(n,o.join(`
`)),n=a.slice(s.length),o=[]):o!=null&&o.push(a)}return n!=null&&t.set(n,o.join(`
`)),t}static flushSnapshotUpdates(){let e=[];return He.StringMap_each(qr._snapshotFileCache,(t,r)=>{r.isDirty()&&e.push(qr._saveToPath(t,r))}),Promise.all(e)}static _saveToPath(e,t){return console.log(`[Snapshot] Saving to file ${e}`),ProtoTestHost_writeFile(e,t.toString())}};qr._PREFIX="#*#* ",qr._snapshotFileCache=new Map;var dl=qr;var ss=class{constructor(e){this._testFilepath=null,this._testFilepath=e}asyncAssertMatchesSnapshot(e,t){if(Ep==null)throw new Error("asyncAssertMatchesSnapshot called outside of a test");let n=this._testFilepath.split(".sk").join(".snapshot.txt"),o=Ep+" -- "+e,a=ProtoTestHost_env.UPDATE_SNAPSHOTS!==void 0;return U0(n,o).then(s=>{let l=new RegExp("\\d+\\.\\d*","g"),c=t.replaceAll(l,d=>`${Math.round(parseFloat(d)*1e3)/1e3}`);if(s==null||a)return k0(n,o,c),An.VOID;if(s!==c)throw new Error(`${Gc}Snapshot ${o} in file ${n} did not match previous value. Here's a diff that changes the ${Ub}stored snapshot${Gc} into the ${kb}received value${Gc}:

${V0(s,c)}`);return An.VOID})}},va;(o=>{function i(){return o.hasSetExpectedErrorsBeenCalled=!1,di.interactionTestHelpers.resetExpectedErrorsAndGetErrorString(1)}o.resetExpectedErrorsAndGetErrorString=i;function e(a){if(o.hasSetExpectedErrorsBeenCalled)throw new Error("Can only call setExpectedErrors once per test");o.hasSetExpectedErrorsBeenCalled=!0,di.interactionTestHelpers.setExpectedErrors(a)}o.setExpectedErrors=e;function t(){o.isUnhandledErrorsExpected=!0}o.setUnhandledErrorsExpected=t,o.hasSetExpectedErrorsBeenCalled=!1,o.isUnhandledErrorsExpected=!1})(va||(va={}));function Ie(i,e){Pg(i,()=>new Promise((t,r)=>{e(),setTimeout(()=>{t(An.VOID)},0)}))}function be(i,e){Pg(i,e)}function ls(i,e){Pg(i,()=>e().then(t=>An.VOID))}function Pg(i,e){Uc.push(i);let t=Uc.join(" -- ");ce.List_removeLast(Uc);let r=()=>{new ur;let n=e();return L().reset(),n};it(i,()=>{Ep=t,Oo=[],va.isUnhandledErrorsExpected=!1;let n=va.resetExpectedErrorsAndGetErrorString();return n.length>0&&Oo.push(new Error("Errors detected from before test started. Maybe from test harness initialization, or from a previous test: "+n)),r().catch(o=>(Oo.push(o),An.VOID)).then(o=>{let a=va.resetExpectedErrorsAndGetErrorString();if(a.length>0&&Oo.push(new Error(a)),Ep=null,va.isUnhandledErrorsExpected){if(Oo.length==0)throw new Error("Expected errors, but none were triggered")}else{Oo=Oo.filter(l=>l.message.indexOf("/api/web_logger/metrics/unhandled_error")==-1);let s=Oo.length>1?Oo.length.toString()+` unhandled errors: 
`:`Unhandled error: 
`;if(Oo.length==1)throw Oo[0];if(Oo.length>1){for(let l of Oo)s+=l.message,s+=`
`,s+=l.stack;throw new Error(s)}}return An.VOID})})}function Bt(i,e){Uc.push(i),describe(i,()=>{e()}),ce.List_removeLast(Uc)}function V0(i,e){let t=Vb.diffLines(i,e),r="";return t.forEach(n=>{let o="",a="";n.added?(o="+ ",a=kb):n.removed?(o="- ",a=Ub):(o="  ",a=Gc),r+=`${a}${o}${n.value}${Gc}
`}),r}function k0(i,e,t){dl.loadOrCreateFromPath(i).then(r=>{r.updateValue(e,t)})}function U0(i,e){return dl.loadOrCreateFromPath(i).then(t=>t.getValueOrNull(e))}var Oo=[],Uc=[],Ep=null,kb="\x1B[32m",Ub="\x1B[31m",Gc="\x1B[0m";var cs=class{constructor(e,t,r){var n;this._property=0,this._activeCanvasGUID=null,this._onChange=null,this._property=t,this._activeCanvasGUID=(n=e.getActiveCanvas())==null?void 0:n.id(),this._onChange=r,e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){if(t==null)return;this._activeCanvasGUID=t.id();let r=e==null?void 0:e.get(this._property),n=t.get(this._property);r!=n&&this._onChange(n)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){var t;e.property==this._property&&J.equals((t=e.node)==null?void 0:t.id(),this._activeCanvasGUID)&&e.oldVal!=e.newVal&&this._onChange(e.newVal)}};var Xg=fs(Rl());function Fg(i){switch(i){case 2:case 4:return 0;case 1:case 3:case 5:return 1;default:return 2}}var ul=class{createBallisticScrollSimulation(e,t,r,n,o,a){return null}applyOverscrollBehavior(e,t,r,n){return t}constructor(){}};var Ia=class{constructor(){this._startTime=0,this._startTime=We.seconds()}endPos(){return new R(this._xSimulation().endPos(),this._ySimulation().endPos())}pos1(){return this.pos2(this.elapsed())}pos2(e){return new R(this._xSimulation().pos(e),this._ySimulation().pos(e))}dPos(e){return new R(this._xSimulation().dPos(e),this._ySimulation().dPos(e))}elapsed(){return We.seconds()-this._startTime}isDone1(){return this.isDone2(this.elapsed())}isOverscrolled(){return!1}isDone2(e){return this._xSimulation().isDone(e)&&this._ySimulation().isDone(e)}xSimulation(e){return this._xSimulation().typeAt(e)}ySimulation(e){return this._ySimulation().typeAt(e)}},Hc=class Hc{static withDampingRatio(e,t,r){return new Hc(e,t,r*2*Math.sqrt(e*t))}constructor(e,t,r){this.mass=e,this.stiffness=t,this.damping=r}};Hc.DEFAULT_SPRING=Hc.withDampingRatio(.5,100,1.1);var pl=Hc,hl=class{constructor(e,t){this.velocity=e,this.distance=t}};function Dg(){return typeof window<"u"&&typeof Jn()=="number"?new hl(1/(.05*Jn()),1/Jn()):new hl(1/.05,1)}var ml=class{constructor(e,t,r){this._friction=.015;this._initialVelocityPenetration=3.065;this._decelerationRate=Math.log(.78)/Math.log(.9);this._pos=e,this._velocity=t,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=r??this._flingDuration(t),this._distance=Math.abs(t*this._duration/this._initialVelocityPenetration)}duration(){return this._duration}pos(e){if(this._duration==0)return this._pos;let t=lr.Math_clamp(e/this._duration,0,1);return this._pos+this._distance*this._flingDistancePenetration(t)*this._vSign}dPos(e){if(this._duration==0)return this._velocity;let t=lr.Math_clamp(e/this._duration,0,1);return this._distance*this._flingVelocityPenetration(t)*this._vSign/this._duration}isDone(e){return e>=this._duration}endPos(){return this._pos+this._distance}_decelerationForFriction(e){return e*61774.04968}_flingDuration(e){let t=this._friction*this._decelerationForFriction(.84),r=Math.log(.35*Math.abs(e)/t);return Math.exp(r/(this._decelerationRate-1))}_flingDistancePenetration(e){return 1.2*e*e*e-3.27*e*e+this._initialVelocityPenetration*e}_flingVelocityPenetration(e){return 3.6*e*e-6.54*e+this._initialVelocityPenetration}},zc=class{constructor(e,t,r,n=Dg()){this._drag=e,this._dragLog=Math.log(e),this._p=t,this._v=r,this._tolerance=n}pos(e){return this._p+this._v*Math.pow(this._drag,e)/this._dragLog-this._v/this._dragLog}dPos(e){return this._v*Math.pow(this._drag,e)}endPos(){return this._p-this._v/this._dragLog}timeAtPos(e){if(e==this._p)return 0;let t=this.endPos();return this._v==0||(this._v>0?e<this._p||e>t:e>this._p||e<t)?1/0:Math.log(this._dragLog*(e-this._p)/this._v+1)/this._dragLog}isDone(e){return Math.abs(this.dPos(e))<this._tolerance.velocity}},Ea=class{constructor(e,t,r,n,o=Dg()){let a=t-r,s=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(s))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(s))/(2*e.mass),this._c2=(-(a*this._r1)+n)/(this._r2-this._r1),this._c1=a-this._c2,this._end=r,this._tolerance=o}endPos(){return this._end}pos(e){return this._end+this._c1*Math.pow(Math.E,this._r1*e)+this._c2*Math.pow(Math.E,this._r2*e)}dPos(e){return this._c1*this._r1*Math.pow(Math.E,this._r1*e)+this._c2*this._r2*Math.pow(Math.E,this._r2*e)}isDone(e){return Math.abs(this.pos(e)-this._end)<=this._tolerance.distance&&Math.abs(this.dPos(e))<=this._tolerance.velocity}},gl=class{pos(e){return this._c}dPos(e){return 0}isDone(e){return!0}endPos(){return this._c}constructor(e){this._c=e}};var Wc=class{applyOverscrollBehavior(e,t,r,n){let o=e.subtract1(r),s=e.subtract1(t).divide1(n).makeAbs(),l=this._frictionFactor2(s);return r.add1(l.multiply1(o))}_frictionFactor1(e){return e==0?1:.52*Math.pow(1-e,2)}_frictionFactor2(e){return new R(this._frictionFactor1(e.x()),this._frictionFactor1(e.y()))}createBallisticScrollSimulation(e,t,r,n,o,a){return new fl(e,t,r,n,o,a)}constructor(){}},fl=class extends Ia{constructor(t,r,n,o,a,s){super();this._xSim=null,this._ySim=null;let l=pl.DEFAULT_SPRING;this._xSim=new Cp(t.x(),r.x(),n,o,l),this._ySim=new Cp(t.y(),r.y(),a,s,l)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}isOverscrolled(){return this._xSimulation().typeAt(this.elapsed())==1||this._ySimulation().typeAt(this.elapsed())==1}},Cp=class{constructor(e,t,r,n,o){if(this._frictionSimulationIOS=null,this._springSimulation=null,this._fixedSolution=null,this._startTime=0,this._springTime=0,this._timeOffset=0,e<r)this._springSimulation=new Ea(o,e,r,t),this._springTime=-1/0;else if(e>n)this._springSimulation=new Ea(o,e,n,t),this._springTime=-1/0;else if(t==0)this._fixedSolution=new gl(e);else{this._frictionSimulationIOS=new zc(G0,e,t);let a=this._frictionSimulationIOS.endPos();t>0&&a>n?(this._springTime=this._frictionSimulationIOS.timeAtPos(n),this._springSimulation=new Ea(o,n,n,Math.min(this._frictionSimulationIOS.dPos(this._springTime),Gb))):t<0&&a<r?(this._springTime=this._frictionSimulationIOS.timeAtPos(r),this._springSimulation=new Ea(o,r,r,Math.min(this._frictionSimulationIOS.dPos(this._springTime),Gb))):this._springTime=1/0}}_simulation(e){return this._fixedSolution!=null?this._fixedSolution:e>this._springTime?(this._timeOffset=isFinite(this._springTime)?this._springTime:0,this._springSimulation):(this._timeOffset=0,this._frictionSimulationIOS)}typeAt(e){return this._fixedSolution!=null?2:e<=this._springTime?0:1}endPos(){return this._fixedSolution!=null?this._fixedSolution.pos(0):isFinite(this._springTime)||this._springTime<0?this._springSimulation.endPos():this._frictionSimulationIOS.endPos()}pos(e){return this._simulation(e).pos(e-this._timeOffset)}dPos(e){return this._simulation(e).dPos(e-this._timeOffset)}isDone(e){return this._simulation(e).isDone(e-this._timeOffset)}},Gb=5e3,G0=.135;var Qc=class{createBallisticScrollSimulation(e,t,r,n,o,a){return new Mg(e,t,r,n,o,a)}applyOverscrollBehavior(e,t,r,n){return t}constructor(){}},Mg=class extends Ia{constructor(t,r,n,o,a,s){super();if(this._xSim=null,this._ySim=null,Math.abs(r.x())>Math.abs(r.y())){this._xSim=new _l(t.x(),r.x(),n,o);let l=Math.abs(r.y())>=Hb?r.y():0;this._ySim=new _l(t.y(),l,a,s,this._xSimulation().duration())}else{this._ySim=new _l(t.y(),r.y(),a,s);let l=Math.abs(r.x())>=Hb?r.x():0;this._xSim=new _l(t.x(),l,n,o,this._ySimulation().duration())}}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},_l=class{constructor(e,t,r,n,o){this._duration=-1/0,this._min=r,this._max=n,t==0?this._simulation=new gl(e):o?this._simulation=new ml(e,t):(this._simulation=new ml(e,t,o),this._duration=this._simulation.duration()),this._startTime=We.seconds()}duration(){return this._duration}pos(e){let t=this._simulation.pos(e);return t<=this._min?this._min:t>=this._max?this._max:t}dPos(e){return this._simulation.dPos(e)}endPos(){return this._simulation.endPos()}isDone(e){if(this._simulation.isDone(e))return!0;let t=this.pos(e);return t>=this._max||t<=this._min}elapsed(){return We.seconds()-this._startTime}typeAt(e){return 0}},Hb=50;var Kc=class extends Ia{constructor(t,r,n,o){super();this._xSim=null,this._ySim=null,this._xSim=new Rp(t.x(),r.x(),n,o),this._ySim=new Rp(t.y(),r.y(),n,o)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},Rp=class{constructor(e,t,r,n){this._begin=0,this._end=0,this._duration=0,this._curve=null,this._begin=e,this._end=t,this._duration=r,this._curve=n}pos(e){let t=lr.Math_clamp(e/this._duration,0,1);return t==0?this._begin:t==1?this._end:this._begin+(this._end-this._begin)*this._curve.get(t)}dPos(e){return(this.pos(e+.001)-this.pos(e-.001))/(2*.001)}endPos(){return this._end}isDone(e){return e>this._duration}typeAt(e){return 3}};var H0=new Map([["http:",80],["https:",443]]);function z0(i){return i==="http:"||i==="https:"}function W0(i){if(z0(i.protocol)){let e=i.port?parseInt(i.port):H0.get(i.protocol);return{scheme:i.protocol,hostname:i.hostname,port:e}}else return"INVALID_ORIGIN"}function Q0(i,e){return e.scheme==="ALL"||e.scheme.scheme===i}function K0(i,e){return e.hostname==="ALL"||e.hostname.hostname===i}function q0(i,e){return e.port==="ALL"||e.port.port===i}function Y0(i,e){return Q0(i.scheme,e)&&K0(i.hostname,e)&&q0(i.port,e)?"ALLOWED":"DENIED"}var X0={scheme:"ALL",hostname:{hostname:"localhost"},port:"ALL"},J0={scheme:"ALL",hostname:{hostname:"127.0.0.1"},port:"ALL"},Z0={scheme:{scheme:"https:"},hostname:"ALL",port:"ALL"},j0=[X0,J0,Z0];function $0(i){for(let e of j0)if(Y0(i,e)==="ALLOWED")return"ALLOWED";return"DENIED"}function Np(i){let e;try{e=new URL(i)}catch{return"DENIED"}let t=W0(e);return t==="INVALID_ORIGIN"?"DENIED":$0(t)}var Ca={requestedEmbedAPIOrigin:null};function zb(){try{if(window.top===window)return null;if(window.location.origin===window.parent.location.origin)return window.location.origin}catch{return null}}var Ra;(g=>{function i(_){g._mockEmbedListener=_}g.setMockListener=i;function e(_,f,S){f.addObserver(new d(_,f)),g._prototypeObserver=new h(_),Ca=S,_.prototypeState().addObserver(g._prototypeObserver),_.prototypeState().addHsmObserver(g._prototypeObserver),$t.getEventEmitter().on("sceneDidCompleteInitialLoad",T=>{_.scene().addObserver(g._prototypeObserver),r(0,{})}),$t.getEventEmitter().on("requestClose",T=>{r(4,{})});let b=window;b!==null&&b.addEventListener("message",T=>{if(Ca.requestedEmbedAPIOrigin!=null){let I=zb(),p=T.origin===Ca.requestedEmbedAPIOrigin&&Np(Ca.requestedEmbedAPIOrigin)==="ALLOWED";if(!(I||p))return}let y=T.data;if(y){let I=y.type,p=y.data;t(_,f,I,p)}})}g.init=e;function t(_,f,S,b){var T,y,I;switch(S){case"NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS":{let p=J.fromString(b.nodeId),A=J.fromString(b.startingPointNodeId);if(X.isInlinePreview()&&(_.prototypeState().resetPrototype(),f.handleRestartPrototype(),_.videoManager().handleRestartPrototype()),!(X.isInlinePreview()&&p==null))if(J.isValid(p)){let v=(T=_.scene())==null?void 0:T.findNode(p);if(v!=null){A&&_.setActivePrototypeStartingPointNodeId(A);let E=A&&v.topLevelAncestor()==null?A:p;_.prototypeState().navigateToFrameAndCloseOverlays(E,null,2,0,0,null,null)}else g._prototypeObserver.setPendingNodeId(p)}else console.error(`Expected node id; got '${b.nodeId}' instead`);break}case"NAVIGATE_BACKWARD":{f.navigateBackward(18);break}case"NAVIGATE_FORWARD":{f.navigateForward(19);break}case"CHANGE_COMPONENT_STATE":{let p=(y=_.scene())==null?void 0:y.findNodeFromDeveloperFriendlyId(b.nodeId),A=(I=_.scene())==null?void 0:I.findNodeFromDeveloperFriendlyId(b.newVariantId);if(p==null){console.error(`Could not find node from specified node id '${b.nodeId}'`);return}if(A==null){console.error(`Could not find variant for CHANGE_COMPONENT_STATE from id '${b.newVariantId}'`);return}_.prototypeState().swapInstanceToState2(p.stablePath(),A.id(),null,0,null,1,null);break}case"RESTART":{_.prototypeState().restartPrototype(1);break}default:break}}g._receiveFromHost=t;function r(_,f){let S={type:c[_],data:f};if(g._mockEmbedListener!=null){(0,g._mockEmbedListener)(S);return}let b=window;if(!(b===null||b.parent===null||b.parent.postMessage===void 0)&&b.top!==b)if(Ca.requestedEmbedAPIOrigin!=null){let T=zb();T?b.parent.postMessage(S,T):Ca.requestedEmbedAPIOrigin!=null&&Np(Ca.requestedEmbedAPIOrigin)==="ALLOWED"&&b.parent.postMessage(S,Ca.requestedEmbedAPIOrigin)}else b.parent.postMessage(S,"*")}function n(_,f){for(let S=_.childCount()-1;S>=0;S=S-1)n(_.childAt2(S,!0),f);f(_)}g._forEachNodeInHitTestOrder=n;function o(_,f){let S=null,b=null;return n(_,T=>{if(S!=null)return;let y=T.canvasSpaceScrolledInteractiveBounds(0);if(T.isVisibleInCanvas()&&y.contains2(f)){S=T;let I=T.canvasSpaceScrolledInteractiveBounds(1);b=f.subtract1(I.topLeft())}}),S==null?null:new l(S,b)}g.findClickInfoForUnhandledMouseRelease=o;function a(_,f,S){if(f.node==null){Le("Hotspot node is null");return}let b=_.baseScreenNode();if(b==null)return;let T=_.prototypeState().getTopmostOverlayNode(),y=T??b,I=S;T!=null&&(I=_.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(b,S));let p=I.subtract1(f.node.canvasSpaceScrolledInteractiveBounds(1).topLeft()),A={};A.handled=!0,A.presentedNodeId=y.developerFriendlyId(),A.targetNodeId=f.node.developerFriendlyId(),A.targetNodeMousePosition=p.toJSON();let v=f.node.findContainingScrollingFrameOrSelf();if(v!=null){let E=v.canvasSpaceScrolledInteractiveBounds(1),D=I.subtract1(E.topLeft());A.nearestScrollingFrameId=v.developerFriendlyId(),A.nearestScrollingFrameMousePosition=D.toJSON(),A.nearestScrollingFrameOffset=v.scrollOffset().toJSON()}else A.nearestScrollingFrameId=null,A.nearestScrollingFrameMousePosition=null,A.nearestScrollingFrameOffset=null;r(1,A)}g.willTriggerClickLikeHotspot=a;function s(_,f){let S=_.baseScreenNode();if(S==null)return;let b=_.prototypeState().getTopmostOverlayNode(),T=f;b!=null&&(T=_.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(S,f));let y=b??S,I=o(y,T),p={};p.handled=!1,p.presentedNodeId=y.developerFriendlyId(),p.targetNodeId=I!=null?I.node.developerFriendlyId():null,p.targetNodeMousePosition=I!=null?I.nodeSpacePoint.toJSON():null;let A=I!=null?I.node.findContainingScrollingFrameOrSelf():null;if(A!=null){let v=A.canvasSpaceScrolledInteractiveBounds(1),E=T.subtract1(v.topLeft());p.nearestScrollingFrameId=A.developerFriendlyId(),p.nearestScrollingFrameMousePosition=E.toJSON(),p.nearestScrollingFrameOffset=A.scrollOffset().toJSON()}else p.nearestScrollingFrameId=null,p.nearestScrollingFrameMousePosition=null,p.nearestScrollingFrameOffset=null;r(1,p)}g.notifyUnhandledMouseRelease=s;class l{constructor(f,S){this.node=f,this.nodeSpacePoint=S}}g.ClickedLayer=l;let c;(y=>(y[y.INITIAL_LOAD=0]="INITIAL_LOAD",y[y.MOUSE_PRESS_OR_RELEASE=1]="MOUSE_PRESS_OR_RELEASE",y[y.PRESENTED_NODE_CHANGED=2]="PRESENTED_NODE_CHANGED",y[y.NEW_STATE=3]="NEW_STATE",y[y.REQUEST_CLOSE=4]="REQUEST_CLOSE"))(c=g.MessageType||(g.MessageType={}));class d{willTriggerHotspot(f,S,b,T){let y=b==4||b==8||b==9||b==3;if(T!=null&&y){let I=this._canvasView.viewport().viewSpaceToCanvasSpace1().transformPoint(T.clone());a(this._appState,f,I)}}didScrollNode(f){}constructor(f,S){this._appState=f,this._canvasView=S}}g.EmbedCanvasViewObserver=d;class h{constructor(f){this.appState=null,this._pendingNodeId=null,this.appState=f}setPendingNodeId(f){this._pendingNodeId=f}handleSceneGraphEvent(f){this._pendingNodeId!=null&&this.appState.prototypeStructure().validDestinationForPrototypeFromId(this._pendingNodeId)&&(X.isInlinePreview()?(this.appState.setActivePrototypeStartingPointNodeId(this._pendingNodeId),this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId,null,2,0,0,null,null)):this.appState.prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}handlePresentedNodeChanged(f){if(f==null)return;let S=this.appState.baseScreenNode();if(!X.isInlinePreview()&&S==null)return;let b=this.appState.prototypeState().getTopmostOverlayNode(),T=b??S,y={};y.presentedNodeId=T==null?void 0:T.developerFriendlyId(),y.isStoredInHistory=!ut.isTransientAction(f.cause);let I={};this.appState.prototypeState().getOnscreenStates().forEach(p=>{let A=p.a,v=p.b,E=this.appState.scene().findNodeByStablePath(A);E!=null&&(I[E.developerFriendlyId()]=v)}),y.stateMappings=I,r(2,y)}handleInteractiveComponentStateChange(f,S){if(S==null)return;let b=this.appState.scene().findNodeByStablePath(f);if(b==null)return;let T={};T.nodeId=b.developerFriendlyId(),T.currentVariantId=S.oldStateId(),T.newVariantId=S.newStateId(),T.isStoredInHistory=!ut.isTransientAction(S.cause),T.isTimedChange=S.cause==1,r(3,T)}handleStateChangeAborted(f){this.handlePresentedNodeChanged(f)}handleStateChangeCommitted(f,S){}handleStateChangeInitiated(f){this.handlePresentedNodeChanged(f)}handleStateChangeRequested(f){}handleFitModeChange(f,S){}handleRestartPrototype(){}handleHsmAborted(f,S){this.handleInteractiveComponentStateChange(f,S)}handleHsmCommitted(f,S,b){}handleHsmInitiated(f,S){this.handleInteractiveComponentStateChange(f,S)}handleHsmRequested(f,S){}}g.EmbedPrototypeObserver=h,g._mockEmbedListener=null,g._prototypeObserver=null})(Ra||(Ra={}));var Op=class{onClick(){this._timeOfLastClick=We.seconds()}getOpacity(){let e=We.seconds()-this._timeOfLastClick;return e<this._animationDuration?1-this._easingFunction.get(e):0}constructor(){this._animationDuration=.7,this._easingFunction=wn.makeEasingFunction([0,0,.58,1],.7),this._timeOfLastClick=0}},wp=class{constructor(e,t){this._hotspotMaterial=null,this._hotspotQuad=null,this._context=null,this._context=e,this._materialStrings=wr.instance(),this._hotspotMaterial=this._context.createMaterial("hotspot",O.VertexFormat.getPositionF4(),this._materialStrings.GLSLX_SOURCE_RENDER_HOTSPOT_VERTEX,this._materialStrings.GLSLX_SOURCE_RENDER_HOTSPOT_FRAGMENT);let r=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._hotspotQuad=t.allocate(O.VertexFormat.getPositionF4(),r)}draw(e,t,r,n,o){if(n<=0)return;let a=e;for(let s of r){let l=ee.new2();l.copyFrom(a);let c=s.canvasSpaceBounds;l.translate2(c.x(),c.y()),l.scale4(c.width(),c.height());let d=V.new2();s.canvasSpaceClipBounds.transformInto1(d,a);let h=new R(2/c.width(),2/c.height());h.divideUpdate(t*o),O.in_Material.Material_setUniformMat32(this._hotspotMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,l),O.in_Material.Material_setUniformVec22(this._hotspotMaterial,this._materialStrings.GLSLX_NAME_U_STROKE_PROPORTION,h),this._hotspotMaterial.setUniformVec41(this._materialStrings.GLSLX_NAME_U_UV_HOTSPOT_CLIPPING_RECT,d.x(),d.y(),d.width(),d.height()),this._hotspotMaterial.setUniformFloat(this._materialStrings.GLSLX_NAME_U_HOTSPOT_OPACITY,n),O.in_Context.Context_setUnpremultipliedBlendState(this._context),this._context.draw(O.Primitive.TRIANGLE_STRIP,this._hotspotMaterial,this._hotspotQuad)}}},qc=class{constructor(e,t){this.canvasSpaceBounds=e,this.canvasSpaceClipBounds=t}},xp=class{constructor(){this.backgroundColor=0,this.hotspots=null,this.hotspotOpacity=0,this.particles=null,this.mouse=null,this.renderDots=!1}};var Pp=class{constructor(e,t){this._didFinishZooming=null,this._drawIdleCount=0,this._userIdleCount=0,this._isFirstFrame=!1,this._justInteracted=!1,this._zoomInProgress=!1,this._previousZoomScale=1,this._previousRenderStatus=2,this._emitter=null,this._didFinishZooming=e,this._emitter=t}handleSceneChange(){this._isFirstFrame=!0}updateZoomScaleNow(e){this._previousZoomScale=e,this._didFinishZooming(this._previousZoomScale)}handleInteraction(){this._justInteracted=!0}justInteracted(){return this._justInteracted}advanceFrame(e){e.isInvalid()||this._justInteracted?(this._userIdleCount=0,this._drawIdleCount=0):this._userIdleCount=this._userIdleCount+1,this._previousRenderStatus!=2?this._drawIdleCount=0:this._drawIdleCount=this._drawIdleCount+1,this._isFirstFrame&&(this._userIdleCount=0,this._isFirstFrame=!1,this.updateZoomScaleNow(e.zoomScale()));let t=this._zoomInProgress;this._zoomInProgress=this._previousZoomScale!=e.zoomScale(),this._zoomInProgress&&!t&&this._emitter.trigger("zoomStart");let r=this._userIdleCount>=2;this._zoomInProgress&&r&&this.updateZoomScaleNow(e.zoomScale()),!this._zoomInProgress&&t&&this._emitter.trigger("zoomStop"),this._justInteracted=!1}shouldRenderOptionalTiles(){return X.shouldApplyMobileOptimizations()?this._userIdleCount>6&&this._drawIdleCount<120:this._userIdleCount>6}zoomInProgress(){return this._zoomInProgress}previousZoomScale(){return this._previousZoomScale}setPreviousRenderStatus(e){this._previousRenderStatus=e}};var Bg=class{delayedHotspotId(){return this._delayedHotspotId}interaction(){return this._interaction}action(){return this._action}counter(){return this._counter}reset(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=this._counter+1}set(e,t,r){this._delayedHotspotId=e,this._interaction=t,this._action=r,this._counter=this._counter+1}constructor(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=0}},Fp=class{resetEntry(e,t){this.resetAllEntriesMatchingPredicate((r,n)=>J.equals(r,e)&&n==t)}resetAllEntries(){this._maintainedDataEntries.length=0}resetAllEntriesWithInteractionType(e){this.resetAllEntriesMatchingPredicate((t,r)=>r==e)}resetAllEntriesMatchingPredicate(e){this._maintainedDataEntries=this._maintainedDataEntries.filter(t=>!e(t.delayedHotspotId(),t.interaction()))}set(e,t,r){let n=this.getByHotspotAndInteractionType(e,t);if(n==null){let o=new Bg;o.set(e,t,r),this._maintainedDataEntries.push(o),n=o}else n.set(e,t,r);return n.counter()}getByHotspotAndInteractionType(e,t){for(let r of this._maintainedDataEntries)if(J.equals(r.delayedHotspotId(),e)&&r.interaction()==t)return r;return null}constructor(){this._maintainedDataEntries=[]}};var Dp=class{constructor(e){this._appState=null,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=[],this.currentlyEnteredGUIDsSet=new Set,this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=[],this.previouslyEnteredGUIDsSet=new Set,this._appState=e}reset(){this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.currentlyEnteredGUIDsSet.clear(),this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.previouslyEnteredGUIDsSet.clear()}updateEnteredNodes(e,t){this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._getNodesEnteredByCanvasSpacePoint(e,t),this.currentlyEnteredGUIDsSet=new Set(this._currentlyEnteredNodesGUIDsOrderedInnerToOuter),this.previouslyEnteredGUIDsSet=new Set(this._previouslyEnteredNodesGUIDsOrderedInnerToOuter)}getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(e){let t=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(o=>!this.previouslyEnteredGUIDsSet.has(o));t.reverse();let r=new Map;for(let o=0,a=t.length;o<a;o=o+1)r.set(t[o],o);let n=e.filter(o=>r.has(o.node.id()));return n.sort((o,a)=>St.int_compare(r.get(o.node.id()),r.get(a.node.id()))),n}getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(e){let t=this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.filter(o=>!this.currentlyEnteredGUIDsSet.has(o)),r=new Map;for(let o=0,a=t.length;o<a;o=o+1)r.set(t[o],o);let n=e.filter(o=>r.has(o.node.id()));return n.sort((o,a)=>St.int_compare(r.get(o.node.id()),r.get(a.node.id()))),n}markNodesAsNotEnteredWithoutTriggeringMouseLeave(e){let t=new Set(e);this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(r=>!t.has(r))}resetNoLongerMaintainedMouseEnterOrLeaveInteractions(e){e.resetAllEntriesMatchingPredicate((t,r)=>{let n=r=="MOUSE_ENTER"&&!this.currentlyEnteredGUIDsSet.has(t),o=r=="MOUSE_LEAVE"&&this.currentlyEnteredGUIDsSet.has(t);return n||o})}_getNodesEnteredByCanvasSpacePoint(e,t){if(this._appState.baseScreenNode()==null)return[];let n=[],[o,a]=this._appState.prototypeState().getTopmostScreenAndPoint(e),s=qt.getNodeInteractionPairs("MOUSE_ENTER",t),l=qt.getNodeInteractionPairs("MOUSE_LEAVE",t),c=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(o,0,h=>{let u=h.event().interactionType();return u=="MOUSE_LEAVE"||u=="MOUSE_ENTER"},[...s??[],...l??[]]),d=null;for(let h of c)h.canvasSpaceScrolledInteractiveBounds(0).contains2(a)&&(d==null||h.node.isAboveInLayerOrder(d.node))&&(d=h);if(d!=null&&d.node){let h=d.node;for(;h!=o;)n.push(h.id()),h=h.parent();n.push(o.id())}return n}};var eC=["APPLE_IPHONE_14_PRO","APPLE_IPHONE_14_PLUS","APPLE_IPHONE_15","APPLE_WATCH_45MM"],Qb=i=>eC.some(e=>i.startsWith(e));var Yc=class{constructor(e,t,r,n){this._delayFrames=0,this._onChange=null,this._equals=null,this._nextUpdateAfterFrameCount=-1,this._value=null,this._queuedValue=null,this._delayFrames=t,this._equals=r,this._onChange=n,e(this)}onFrame(){this._nextUpdateAfterFrameCount>0&&(this._nextUpdateAfterFrameCount=this._nextUpdateAfterFrameCount-1,this._nextUpdateAfterFrameCount<=0&&(this._value=this._queuedValue,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1,this._onChange()))}_updateQueuedValue(e){this._queuedValue=new fe(e),this._nextUpdateAfterFrameCount=this._delayFrames}hasQueuedValue(){return this._queuedValue!=null}queueValue(e){if(this._value==null){this._value=new fe(e),this._onChange();return}if(this._queuedValue!=null){if(this._equals(this._queuedValue.value,e))return;this._updateQueuedValue(e);return}else this._equals(this._value.value,e)||this._updateQueuedValue(e)}getValue(){return this._value.value}clear(){this._value=null,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1}unregister(e){e(this)}};function Xc(i,e){let t=new WeakMap,r=null;return n=>{let o=e(n);if(o===null)return r==null&&(r=new fe(i(n))),r.value;if(t.has(o))return t.get(o);let a=i(n);return t.set(o,a),a}}function kg(i){return Xc(i,e=>e)}function tC(i,e,t){let r=Xc(n=>Xc(o=>i(n,o),t),e);return(n,o)=>r(n)(o)}function Kb(i,e,t,r){let n=tC((o,a)=>Xc(s=>i(o,a,s),r),e,t);return(o,a,s)=>n(o,a)(s)}function qb(i,e,t,r,n){let o=Kb((a,s,l)=>Xc(c=>i(a,s,l,c),n),e,t,r);return(a,s,l,c)=>o(a,s,l)(c)}var Lp=class{constructor(e,t){this._context=null,this._bufferPool=null,this._deviceImageManager=new Rn,this._deviceFrameMaterial=null,this._deviceFrameQuad=null,this._hasPendingFrame=!1,this._context=e,this._bufferPool=t,this._materialStrings=wr.instance();let r=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._deviceFrameQuad=this._bufferPool.allocate(O.VertexFormat.getPositionF4(),r),this._deviceFrameMaterial=this._context.createMaterial("deviceFrame",O.VertexFormat.getPositionF4(),this._materialStrings.GLSLX_SOURCE_RENDER_DEVICE_FRAME_VERTEX,this._materialStrings.GLSLX_SOURCE_RENDER_DEVICE_FRAME_FRAGMENT)}clearOnContextReset(){this._hasPendingFrame=!1,this._deviceImageManager.clearOnContextReset()}flush(){this._hasPendingFrame&&(O.in_Context.Context_setPremultipliedBlendState(this._context),this._context.draw(O.Primitive.TRIANGLE_STRIP,this._deviceFrameMaterial,this._deviceFrameQuad),this._hasPendingFrame=!1)}isWaitingForDeviceFrameToLoad(e){let t=Rn.infoForDevice(e);if(t==null)return!1;let r=this._deviceImageManager.getImage(t,this._context);return!r.isDecoded()&&!r.loadDidFail()}canRenderDeviceFrame(e){let t=Rn.infoForDevice(e);return t==null?!1:this._deviceImageManager.getImage(t,this._context).isDecoded()}pixelAtPosition(e,t,r){if(t==null)return C.TRANSPARENT;let n=Rn.infoForDevice(r);if(n==null)return C.TRANSPARENT;let o=this._deviceImageManager.getImage(n,this._context);if(!o.isDecoded()||o.width()<=0||o.height()<=0)return C.TRANSPARENT;let a=o.decodedData(),s=r.canvasSpaceTopLeftOffset(n),l=t.topLeft().subtract1(s),c=r.canvasSpaceImageSize(n),d=e.subtract1(l).divide1(c);switch(r.rotation){case"NONE":break;case"CCW_90":{d=new R(1-d.y(),d.x());break}default:break}let h=d.x()*n.nonRotatedImageSize.x()|0,u=d.y()*n.nonRotatedImageSize.y()|0;return a.pixelAtIndex(h,u)}drawPrototypeDeviceIfAny(e,t,r,n){if(r==null)return;let o=Rn.infoForDevice(t);if(o==null)return;let a=this._deviceImageManager.getImage(o,this._context);if(!a.isDecoded()&&!a.loadDidFail()){e.invalidate();return}if(a.width()<=0||a.height()<=0)return;let s=a.texture().width()/o.scaleFactor,l=a.texture().height()/o.scaleFactor,c=o.nonRotatedOffset,d=r.topLeft().subtract1(c),h=V.new2();h.setTo1(d.x(),d.y(),s,l);let u=ee.new2();u.copyFrom(n),u.translate2(h.x(),h.y()),t.rotation=="CCW_90"&&(u.translate1(o.nonRotatedOffset),u.rotate(-Math.PI/2),u.translate1(o.nonRotatedOffset.negative()),u.translate2(-o.nonRotatedFramePresetSize.x(),0)),u.scale4(h.width(),h.height()),O.in_Material.Material_setUniformMat32(this._deviceFrameMaterial,this._materialStrings.GLSLX_NAME_U_VERTEX_TRANSFORM,u),this._deviceFrameMaterial.setUniformSampler(this._materialStrings.GLSLX_NAME_U_TEXTURE0,a.texture(),0),this._hasPendingFrame=!0}};var Jc=class{constructor(e){this._dirtyNewBoundsBuilder=new bt,this._dirtyOldBoundsBuilder=new bt,this._onBoundsInvalidate=null,this._cachedCanvasSpaceBounds=new Map,this._dirtyNodes=new Map,this._canvasSpaceDirtyNewBounds=V.new2(),this._canvasSpaceDirtyOldBounds=V.new2(),this._onBoundsInvalidate=e}initCanvas(e){this._dirtyNodes=new Map,this._cachedCanvasSpaceBounds=new Map,e!=null&&this._initCachedBounds(e)}handleSceneGraphEvent(e){switch(e.property){case 62:case 26:case 70:case 28:case 48:case 16:case 29:case 69:case 46:case 71:case 17:case 47:case 27:case 30:case 87:break;case 20:case 21:case 34:case 66:{this.dirtyNode(e.node);break}default:{this.dirtyNode(e.node);break}}}handleImageLoaded(e){this.dirtyNode(e)}dirtyNode(e){this._dirtyNodes.set(e.id(),e.id())}invalidateDirtyTiles(e,t){if(e==null||this._dirtyNodes.size==0)return;let r=[],n=new Map;this._dirtyOldBoundsBuilder.reset(),this._dirtyNewBoundsBuilder.reset(),He.StringMap_each(this._dirtyNodes,(o,a)=>{let s=e.scene().findNode(a);if(s!=null&&s.type()=="CANVAS"){this._onBoundsInvalidate(null);return}let l=s==null?void 0:s.topLevelAncestor();if(l!=null){if(!l.hasBeenLoaded())return;n.set(l.id(),!0)}let c=He.StringMap_get(this._cachedCanvasSpaceBounds,o,null),d=s==null?void 0:s.canvasSpaceRenderedBounds();if(c!=null&&this._dirtyOldBoundsBuilder.include3(c),d!=null?(this._dirtyNewBoundsBuilder.include3(d),this._cachedCanvasSpaceBounds.set(o,d)):this._cachedCanvasSpaceBounds.delete(o),t.overlayRenderData()!=null){let h=t.overlayRenderData();if(h!=null)for(let u of h.keys()){let m=h.get(u),g=c!=null&&c.overlaps(m.bounds),_=d!=null&&d.overlaps(m.bounds);(g||_)&&n.set(m.overlayId,!0)}}}),De.appTimerStart("invalidateNestedBackgroundBlurRenderTrees"),e.invalidateNestedBackgroundBlurRenderTrees(n,r),De.appTimerStop("invalidateNestedBackgroundBlurRenderTrees");for(let o=0,a=r.length;o<a;o=o+1){let s=r[o];this._dirtyOldBoundsBuilder.include3(s)}this._dirtyOldBoundsBuilder.isValid()&&(this._dirtyOldBoundsBuilder.buildTo(this._canvasSpaceDirtyOldBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyOldBounds)),this._dirtyNewBoundsBuilder.isValid()&&(this._dirtyNewBoundsBuilder.buildTo(this._canvasSpaceDirtyNewBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyNewBounds)),this._dirtyNodes=new Map}_initCachedBounds(e){for(let t=0,r=e.childCount();t<r;t=t+1){let n=e.childAt1(t);this._cachedCanvasSpaceBounds.set(n.id(),n.canvasSpaceRenderedBounds()),this._initCachedBounds(n)}}};var rC=-1,Yb=!1,er=class er{addProperty(e){return this.transition=e(this.transition!=null?this.transition:new nn),this}dissolve(){return this.isDissolve=!0,this.transition=new nn().transform(this.transition.from().transform1(),this.transition.to().transform1()),this}static buildStrategy(e,t){let r=new er;for(let n of er.propertyFunctions)if(n(e,t,r),r.isDissolve)return r;return r}static forDiscreteProperties(e,t,r){return r=er.nodeTypeToRenderSetMap.get(e.type())==er.nodeTypeToRenderSetMap.get(t.type())?r:r.dissolve(),r=e.blendMode()==t.blendMode()?r:r.dissolve(),r=e.clipsToBoundingRectangle()==t.clipsToBoundingRectangle()?r:r.dissolve(),r=e.isFixed()==t.isFixed()?r:r.dissolve(),r}static forSizes(e,t,r){let n=e.size(),o=t.size();if(r.addProperty(l=>l.transformOrigin(n.divide(2),o.divide(2))),r.transition.hasLegacyTransitioningSizesForImageRect()||r.transition.hasTransitioningGeometryForRoundedRectangles()||e.type()=="ROUNDED_RECTANGLE"&&t.type()=="ROUNDED_RECTANGLE")return r;let a=t.isResizeToFit()||ir.isFrameLike(t.type())&&!t.clipsToBoundingRectangle();return(e.isResizeToFit()||ir.isFrameLike(e.type())&&!e.clipsToBoundingRectangle())&&er._filterPaints3(e.fillPaintsToRender()).length==0&&a&&er._filterPaints3(t.fillPaintsToRender()).length==0||n.equals(o)?r:r.dissolve()}static forOpacity(e,t,r){return r.addProperty(n=>n.opacity(e,t))}static forRelativeTransforms(e,t,r){return r.addProperty(n=>n.transform(e,t))}static forFillPaints(e,t,r){let n=er._filterPaints2(e),o=er._filterPaints2(t);return er._maybeInterpolatePaints(n,o,r,a=>a.fillPaints1(n,o))}static forStrokePaints(e,t,r){let n=er._filterPaints2(e),o=er._filterPaints2(t);return er._maybeInterpolatePaints(n,o,r,a=>a.strokePaints1(n,o))}static _filterPaints1(e){return er._filterPaints2(e)}static _filterPaints2(e){return e.filter(t=>t.isEnabled())}static _filterPaints3(e){return er._filterPaints2(e)}static _maybeInterpolatePaints(e,t,r,n){return!r.transition.hasTransitioningGeometryForRoundedRectangles()&&jt.FrozenList_equals(e,t,(o,a)=>o.equals1(a))?r:jt.FrozenList_equals(e,t,(o,a)=>o.type()==a.type()&&o.blendMode()==a.blendMode())?r.addProperty(n):r.dissolve()}static forGeometryAndPaints(e,t,r){var d,h;let n=e.supportsGeometry(),o=t.supportsGeometry();if(!n&&!o)return r;if(n!=o)return r.dissolve();let a=((d=e.fillGeometry())==null?void 0:d.regions)??[],s=((h=t.fillGeometry())==null?void 0:h.regions)??[],l=(ir.isFrameLike(e.type())&&e.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(e.type())!=-1)&&e.strokePaints().length==0&&a.length==1&&Ot.isRoundedRectSupportedIgnoringCornerSmoothing(e.roundedRectInfo()),c=(ir.isFrameLike(t.type())&&t.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(t.type())!=-1)&&t.strokePaints().length==0&&s.length==1&&Ot.isRoundedRectSupportedIgnoringCornerSmoothing(t.roundedRectInfo());if(l&&c){if(a.length!=0&&s.length!=0){let u=e.fillGeometry().regions[0].bounds().size(),m=t.fillGeometry().regions[0].bounds().size(),g=oo.fromRoundedRect(e.roundedRectInfo()),_=oo.fromRoundedRect(t.roundedRectInfo());(!g.equals(_)||!u.equals(m))&&r.addProperty(f=>f.transitionGeometryForRoundedRectangles(u,g,m,_))}}else{let u=!1;if(e.isAxisAlignedRectFill()&&t.isAxisAlignedRectFill())for(let m of[e.fillPaints(),t.fillPaints()]){for(let g=0,_=m.length;g<_;g=g+1)if(m[g].type()=="IMAGE"||m[g].type()=="VIDEO"){u=!0;break}if(u)break}if(u&&!e.fillOrTextGeometry().geometryEquals(t.fillOrTextGeometry())){let m=er._filterPaints1(e.fillRegionPaints()[0]),g=er._filterPaints1(t.fillRegionPaints()[0]);if(jt.FrozenList_equals(m,g,(_,f)=>_.type()==f.type()))return r.addProperty(_=>_.fillPaints1(m,g)),r.addProperty(_=>_.shouldDoLegacyImageRectSizeTransition(!0)),r}r=er._forGeometryStructure(e.fillOrTextGeometry(),t.fillOrTextGeometry(),r)}return r=er._forGeometryPaints(e.fillRegionPaints(),t.fillRegionPaints(),r,(u,m,g)=>er.forFillPaints(u,m,g)),r=er._forGeometryStructure(e.strokeGeometry(),t.strokeGeometry(),r),r=er._forGeometryPaints(e.strokeRegionPaints(),t.strokeRegionPaints(),r,(u,m,g)=>er.forStrokePaints(u,m,g)),r}static forEffects(e,t,r){let n=e.filter(a=>a.isVisibleForRendering()),o=t.filter(a=>a.isVisibleForRendering());return ce.List_equalsWithComparison(n,o,(a,s)=>a.equals(s))?r:r.dissolve()}static _forGeometryStructure(e,t,r){return e!=null&&t!=null?e.geometryEquals(t)?r:r.dissolve():e==null&&t==null?r:r.dissolve()}static _forGeometryPaints(e,t,r,n){if(e.length==t.length){for(let o=0,a=e.length;o<a;o=o+1)if(r=n(e[o],t[o],r),r.isDissolve)return r;return r}return r.dissolve()}constructor(){this.isDissolve=!1,this.transition=new nn}};er.propertyFunctions=[(e,t,r)=>{er.forRelativeTransforms(e.relativeTransformAccountingForFixedOffset(),t.relativeTransformAccountingForFixedOffset(),r)},(e,t,r)=>{er.forGeometryAndPaints(e,t,r)},(e,t,r)=>{er.forSizes(e,t,r)},(e,t,r)=>{er.forDiscreteProperties(e,t,r)},(e,t,r)=>{er.forOpacity(e.opacity(),t.opacity(),r)},(e,t,r)=>{er.forEffects(e.effects(),t.effects(),r)}],er.nodeTypeToRenderSetMap=[["NONE","DOCUMENT","SLICE"],["CANVAS","GROUP","FRAME","SYMBOL","INSTANCE","CONNECTOR","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","MEDIA","SECTION_OVERLAY","TABLE","TABLE_CELL","SLIDE"],["ELLIPSE","LINE","RECTANGLE","REGULAR_POLYGON","ROUNDED_RECTANGLE","STAR","VECTOR","STAMP","WASHI_TAPE"],["BOOLEAN_OPERATION"],["TEXT"]].reduce((e,t,r)=>(t.forEach(n=>{e.set(n,r)}),e),new Map);var Al=er;var wo=class i{constructor(e,t,r,n){this._lastInputTForAbsoluteTransform=-1;this._oldSceneNode=e,this._oldCanvasToRenderTreeTransform=t,this._newSceneNode=r,this._newCanvasToRenderTreeTransform=n,this._children=[],this._enabledTraits=rC,this._parent=null,this._transition=null,this._isDissolve=!1,this._scalesIndependentlyOfParent=!1,this._forceMask=!1,this._interpolateScalingToCachedAbsoluteTransform=new Map}get isDissolve(){return this._isDissolve}get scalesIndependentlyOfParent(){return this._scalesIndependentlyOfParent}get forceMask(){return this._forceMask}get enabledTraits(){return this._enabledTraits}get transition(){return this._transition}setTransition(e){this._transition=e,this._referenceTransitionForChildrenNodes=e}clearTransitionForDissolveRenderTrees(){let e=this.transition.clone().transform(ee.new2(),ee.new2());this._transition=e}get parent(){return this._parent}get children(){return this._children}static debugStringRecursive(e,t,r,n){var s,l;t.result+=t.indent,r||(t.result+=n?"\u2514\u2500":"\u251C\u2500");let o=t.indent.length;r||(t.indent+=n?"  ":"\u2502 "),t.result+=`${((s=e._oldSceneNode)==null?void 0:s.name())??"null"} -> ${((l=e._newSceneNode)==null?void 0:l.name())??"null"}`,e.forceMask&&(t.result+=" (.MASK)");let a=e.transition;if(a!=null){t.result+=e.isDissolve?" (dissolve)":"",t.result+=a.hasTransitioningPaints()&&4&e.enabledTraits?" (paints)":"",t.result+=a.hasTransitioningGeometryForRoundedRectangles()&&16&e.enabledTraits?" (geometry)":"";let c=a.from(),d=a.to();if((c.opacity1()!=1||c.opacity1()!=d.opacity1())&&(t.result+=` (opacity: ${c.opacity1()} -> ${d.opacity1()})`),c.translation1().equals(d.translation1())||(t.result+=` (translation: ${c.translation1()} -> ${d.translation1()})`),!c.transform1().equals1(d.transform1())){let h=Hn.from(c.transform1()),u=Hn.from(d.transform1());h.translation.approximatelyEquals(u.translation,1e-6)||(t.result+=` (translation: ${h.translation} -> ${u.translation})`),h.scale.approximatelyEquals(u.scale,1e-6)||(t.result+=` (scale: ${h.scale} -> ${u.scale})`),h.angleDegrees!=u.angleDegrees&&(t.result+=` (angle: ${h.angleDegrees} deg -> ${u.angleDegrees} deg)`)}}t.result+=`
`;for(let c=0,d=e.children.length;c<d;c=c+1)this.debugStringRecursive(e.children[c],t,!1,c==e.children.length-1);e.isDissolve&&(this.debugStringRecursive(e.forDissolveStart1(),t,!1,!1),this.debugStringRecursive(e.forDissolveEnd1(),t,!1,!0)),t.indent=t.indent.slice(0,o)}static _generatePlanForMatchedNodes(e,t,r,n,o,a){let s=Al.buildStrategy(e,r);if(s.transition.hasLegacyTransitioningSizesForImageRect()){let c=s.transition;c.scaling(new R(1,1),r.size().divide1(e.size()));let d=new i(e,t,r,n);return d._isDissolve=!1,d.setTransition(c),d}let l=this.getMagicMovePlan1(e,t,r,n,o,null,e.isFixed()?Ir.DISSOLVE:a);return l._isDissolve=s.isDissolve,l.setTransition(s.transition),l}static _generatePlanForRemovedNode(e,t,r){let n=new i(e,t,null,null);if(r!=null&&r.isDissolve()){let o=new nn().opacity(e.opacity(),0);o.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),n.setTransition(o)}else{let o=new nn().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());r!=null?(o.translation(r.exitingFrameTransition().from().translation1(),r.exitingFrameTransition().to().translation1()),o.opacity(e.opacity()*r.exitingFrameTransition().from().opacity1(),e.opacity()*r.exitingFrameTransition().to().opacity1())):o.opacity(e.opacity(),e.opacity()),n.setTransition(o)}return e.forEachChild(o=>{n._appendChild(this._generatePlanForRemovedNode(o,t,null))}),n}static _generatePlanForInsertedNode(e,t,r){let n=new i(null,null,e,t);if(r!=null&&r.isDissolve()){let o=new nn().opacity(0,e.opacity());o.transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset()),n.setTransition(o)}else{let o=new nn().transform(e.relativeTransformAccountingForFixedOffset(),e.relativeTransformAccountingForFixedOffset());r!=null?(o.translation(r.enteringFrameTransition().from().translation1(),r.enteringFrameTransition().to().translation1()),o.opacity(e.opacity()*r.enteringFrameTransition().from().opacity1(),e.opacity()*r.enteringFrameTransition().to().opacity1())):o.opacity(e.opacity(),e.opacity()),n.setTransition(o)}return e.forEachChild(o=>{n._appendChild(this._generatePlanForInsertedNode(o,t,null))}),n}static _matchKey(e){return e.name()}static _getNodeMatches(e,t,r,n){if(!n&&(e.type()=="BOOLEAN_OPERATION"||t.type()=="BOOLEAN_OPERATION"))return;let o=new Map;t.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=null;o.has(s)?l=o.get(s):(l=[],o.set(s,l)),l.push(a)}),e.forEachChild(a=>{if(!a.visible())return;let s=this._matchKey(a),l=He.StringMap_get(o,s,null);if(l==null||l.length==0)return;let c=l.shift();r.set(a.id(),c),r.set(c.id(),a),this._getNodeMatches(a,c,r,n)})}static getNodeMatches(e,t){let r=new Map;return this._getNodeMatches(e,t,r,!1),r}static getMagicMovePlan1(e,t,r,n,o,a,s){a==null&&(a=new nn);let l=e.isTopLevel()&&r.isTopLevel(),c=new i(e,t,r,n);if(e.type()=="BOOLEAN_OPERATION"||r.type()=="BOOLEAN_OPERATION")return c;for(let h=0;h<r.childCount();h=h+1){let u=r.childAt2(h,!0),m=He.StringMap_get(o,u.id(),null);m==null?c._appendChild(this._generatePlanForInsertedNode(u,n,s)):c._appendChild(this._generatePlanForMatchedNodes(m,t,u,n,o,s))}let d=0;for(;d<e.childCount();){let h=[],u=d,m=d;for(;d<e.childCount();){let T=e.childAt2(d,!0);if(o.has(T.id()))break;h.push(this._generatePlanForRemovedNode(T,t,s)),m=d,d=d+1}if(h.length==0){d=d+1;continue}let g=-1,_=c.children.length;if(u-1>=0){let T=e.childAt2(u-1,!0);if(T!=null){let y=He.StringMap_get(o,T.id(),null);y!=null&&(g=c.indexOfSceneNodeInChildren(y))}}if(m+1<e.childCount()){let T=e.childAt2(m+1,!0);if(T!=null){let y=He.StringMap_get(o,T.id(),null);y!=null&&(_=c.indexOfSceneNodeInChildren(y))}}let f=Math.min(g,_),S=Math.max(g,_),b=s.drawsEnteringFrameOnTopOfExitingFrame()?f+1:S;c.insertChildren(b,h)}if(l){c._enabledTraits&=-5,c._enabledTraits&=-9,c._enabledTraits&=-65,c._enabledTraits&=-3,c._enabledTraits&=-33,c._enabledTraits&=-129;let h=e.clipsToBoundingRectangle()&&e.containerSupportsFillStrokeAndCorners()||r.clipsToBoundingRectangle()&&r.containerSupportsFillStrokeAndCorners(),u=new i(e,t,r,n);u._enabledTraits=156,h&&(u._enabledTraits&=-9),u._isDissolve=!0,u.setTransition(new nn);let m=h;if(e.fillGeometry()!=null&&r.fillGeometry()!=null&&(m=m&&!e.fillGeometry().geometryEquals(r.fillGeometry())),m){let f=c,S=new i(e,t,r,n);S._enabledTraits=20,S.setTransition(new nn),S._forceMask=!0,S._isDissolve=!0,c=new i(e,t,r,n),c._enabledTraits=0,c._isDissolve=!1,c.setTransition(new nn),c._appendChild(S),c._appendChild(f)}else c._enabledTraits|=130;let g=[u,c];if(h){let f=new i(e,t,r,n);f._enabledTraits=24,f._isDissolve=!0,f.setTransition(new nn),g.push(f)}a.opacity(e.opacity(),r.opacity());let _=new i(e,t,r,n);return _._enabledTraits=224,_.insertChildren(0,g),_.setTransition(a),_}else return c}static getMagicMovePlanForStateSwapTransition(e,t){var s;let r=this.getNodeMatches(e,t),n=((s=t.parent())==null?void 0:s.absoluteTransform())??Nt.FrozenAffineTransform_IDENTITY,o=this._generatePlanForMatchedNodes(e,Nt.FrozenAffineTransform_IDENTITY,t,Nt.FrozenAffineTransform_IDENTITY,r,Ir.DISSOLVE),a=o.transition;return o.setTransition(a.clone().transform(n.clone().multipliedBy1(a.from().transform1()),n.clone().multipliedBy1(a.to().transform1()))),Yb&&(console.log("------------------------------"),console.log("getMagicMovePlanForStateSwapTransition between interactive component states"),console.log(o.debugString()),console.log("------------------------------")),o}static getMagicMovePlan2(e,t,r,n,o){let a=this.getNodeMatches(e,r),s=new nn().transform(t.clone().multipliedBy1(e.absoluteTransform()),n.clone().multipliedBy1(r.absoluteTransform()));return this.getMagicMovePlan1(e,t,r,n,a,s,o)}static renderTreeForMagicMove(e,t,r,n,o){let a=ee.new2().copyFrom(e.absoluteTransform());a.invert();let s=ee.new2();s.leftMultiply(a),s.leftMultiply(t.absoluteTransform());let l=Nt.FrozenAffineTransform_IDENTITY,c=e.size().max2(t.size()),d=this.getMagicMovePlan2(e,s,t,l,o.withScaledTranslation(c)),h=!0,u=()=>h?0:r(),m=new Ci(d,null,u,n),g=Ne.renderTreeWithPerfLogging1(m,"renderTreeForMagicMove");return Yb&&(console.log("------------------------------"),console.log(`renderTreeForMagicMove between top-level frames ${e.id()} -> ${t.id()}`),console.log(d.debugString()),console.log(g.debugString1()),console.log("------------------------------")),h=!1,g}forDissolveStart1(){return this.forDissolveStart2(null)}forDissolveStart2(e){let t=new i(this._oldSceneNode,this._oldCanvasToRenderTreeTransform,null,null);t._enabledTraits=this._enabledTraits,t._forceMask=this._forceMask;let r=this._referenceTransitionForChildrenNodes.clone().opacity(this._oldSceneNode.opacity(),this._oldSceneNode.opacity());return this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._oldSceneNode,this._newSceneNode,n=>{r.scaling(ye.FrozenVector_ONE,new R(n,n))},r.to().transform1(),n=>{r.transform(r.from().transform1(),n)}):r.hasTransitioningGeometryForRoundedRectangles()||r.scaling(ye.FrozenVector_ONE,Mp(this._newSceneNode).divide1(Mp(this._oldSceneNode))),r.transformOrigin(this._oldSceneNode.size().divide(2),this._newSceneNode.size().divide(2))),t._isDissolve=!1,t.setTransition(r),e!=null&&(r.from().scaling1().divide1(r.to().scaling1()).equals(e.from().scaling1().divide1(e.to().scaling1()))||(t._scalesIndependentlyOfParent=!0)),this.children.forEach(n=>{n._oldSceneNode!=null&&t._appendChild(n.forDissolveStart2(r))}),t}forDissolveEnd1(){return this.forDissolveEnd2(null)}forDissolveEnd2(e){let t=new i(null,null,this._newSceneNode,this._newCanvasToRenderTreeTransform);t._enabledTraits=this._enabledTraits,t._forceMask=this._forceMask;let r=this._referenceTransitionForChildrenNodes.clone().opacity(this._newSceneNode.opacity(),this._newSceneNode.opacity());return this._oldSceneNode!=null&&this._newSceneNode!=null&&(this._oldSceneNode.type()=="TEXT"||this._newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this._newSceneNode,this._oldSceneNode,n=>{r.scaling(new R(n,n),ye.FrozenVector_ONE)},r.from().transform1(),n=>{r.transform(n,r.to().transform1())}):r.hasTransitioningGeometryForRoundedRectangles()||r.scaling(Mp(this._oldSceneNode).divide1(Mp(this._newSceneNode)),ye.FrozenVector_ONE),r.transformOrigin(this._oldSceneNode.size().divide(2),this._newSceneNode.size().divide(2))),t._isDissolve=!1,t.setTransition(r),e!=null&&(r.from().scaling1().divide1(r.to().scaling1()).equals(e.from().scaling1().divide1(e.to().scaling1()))||(t._scalesIndependentlyOfParent=!0)),this.children.forEach(n=>{n._newSceneNode!=null&&t._appendChild(n.forDissolveEnd2(r))}),t}_maybeUpdateDissolveTransitionsForText(e,t,r,n,o){if(t.type()!="TEXT"||e.type()!="TEXT")return;let a=t.textGeometry(),s=e.textGeometry(),l=1;!t.textHasMixedFontSizes()&&!e.textHasMixedFontSizes()&&t.fontSize()>0&&e.fontSize()>0&&(l=t.fontSize()/e.fontSize(),r(l));let c=R.new2(),d=V.new4(t.relativeTransform().translation(),t.size()),h=V.new4(e.relativeTransform().translation(),e.size()),u=null,m=null,g=V.new2();switch(t.textAlignHorizontal()==e.textAlignHorizontal()?(u=a.bounds,m=s.bounds):(u=d,m=h),g.copyFrom(m).scaledBy1(l),e.textAlignHorizontal()){case"RIGHT":{c.setX(u.right()-m.right()-(g.right()-m.right()));break}case"CENTER":case"JUSTIFIED":{c.setX(u.center().x()-m.center().x()-(g.center().x()-m.center().x()));break}}switch(t.textAlignVertical()==e.textAlignVertical()?(u=a.bounds,m=s.bounds):(u=d,m=h),g.copyFrom(m).scaledBy1(l),e.textAlignVertical()){case"BOTTOM":{c.setY(u.bottom()-m.bottom()-(g.bottom()-m.bottom()));break}case"CENTER":{c.setY(u.center().y()-m.center().y()-(g.center().y()-m.center().y()));break}}if(!c.equals(R.new2())){let _=ee.new3(n);_.translate1(c),o(_)}}sceneNode(){return this._oldSceneNode??this._newSceneNode}isEverVisible(){return this._isSceneNodeEverVisible(this._oldSceneNode)||this._isSceneNodeEverVisible(this._newSceneNode)}_isSceneNodeEverVisible(e){return e!=null&&e.visible()&&e.opacity()>0}absoluteTransform1(e){return X.smartAnimateCacheTransform()?this.absoluteTransform2WithCaching(e,1):this.absoluteTransform2(e,1)}invalidateCachedAbsoluteTransformsForSelf(){X.smartAnimateCacheTransform()&&(this._lastInputTForAbsoluteTransform=-1,this._interpolateScalingToCachedAbsoluteTransform[0]=null,this._interpolateScalingToCachedAbsoluteTransform[1]=null)}absoluteTransform2WithCaching(e,t){return e!=this._lastInputTForAbsoluteTransform&&(this._lastInputTForAbsoluteTransform=e,this._interpolateScalingToCachedAbsoluteTransform[0]=null,this._interpolateScalingToCachedAbsoluteTransform[1]=null),this._interpolateScalingToCachedAbsoluteTransform[t]||(this._interpolateScalingToCachedAbsoluteTransform[t]=this.absoluteTransform2(e,t)),this._interpolateScalingToCachedAbsoluteTransform[t]}absoluteTransform2(e,t){let r=ee.new2();if(this._transition!=null){let n=this._transition.interpolateTranslation(e);r.translate1(n)}if(this._parent!=null&&r.multiply(this._parent.absoluteTransform2(e,0)),this._transition!=null){let n=this._transition.interpolateTransform(e);if(r.multiply(n),t){let o=this._transition.interpolateScaling(e);r.scale3(o)}}return r}rotatesOrScales1(){return this.rotatesOrScales2(!0)}rotatesOrScales2(e){let t=this._transition!=null;return e?t=t&&!this._transition.from().equalTransformsUpToTranslation(this._transition.to(),1e-10):t=t&&!this._transition.from().equalTransformsUpToTranslationAndScaling(this._transition.to(),1e-10),this._parent!=null&&(t=t||this._parent.rotatesOrScales2(!1)),t}_appendChild(e){e._parent=this,this._children.push(e)}insertChildren(e,t){for(let r of t)r._parent=this;Gf(this._children,e,t)}removeChild(e){this._children.splice(e,1)}debugString(){let e=new Ug;return i.debugStringRecursive(this,e,!0,!0),e.result}indexOfSceneNodeInChildren(e){for(let t=0;t<this.children.length;t=t+1){let r=this.children[t];if(r._oldSceneNode==e||r._newSceneNode==e)return t}return-1}indexInParent(){return this._parent!=null?this._parent.children.indexOf(this):-1}},Ug=class{constructor(){this.result="",this.indent=""}},Ci=class i{constructor(){this._sceneNodeCursor=null;arguments.length==4?(this._planNode=arguments[0],this._node=arguments[1],this._getEasedT=arguments[2],this._easingFunction=arguments[3]):arguments.length==3&&(this._planNode=arguments[0],this._node=null,this._getEasedT=arguments[1],this._easingFunction=arguments[2]),this._updateSceneNodeCursorForCurrentPlanNode()}clone(){return new i(this._planNode,this._node,this._getEasedT,this._easingFunction)}_updateSceneNodeCursorForCurrentPlanNode(){let e=this._planNode.sceneNode();if(e==null){this._sceneNodeCursor=null;return}this._sceneNodeCursor==null?this._sceneNodeCursor=new Kt(e):this._sceneNodeCursor.setNode(e)}moveToChildAt(e){this._planNode=this._planNode.children[e],this._node=this._node!=null&&e<this._node.childCount()?this._node.childAt2(e,!0):null,this._updateSceneNodeCursorForCurrentPlanNode()}moveToParent(){this._planNode=this._planNode.parent,this._node=this._node!=null?this._node.parent():null,this._updateSceneNodeCursorForCurrentPlanNode()}isRoot(){return this._planNode.parent==null}hasTransitioningPaints(){return this._planNode.transition.hasTransitioningPaints()}indexInParent(){return this._planNode.indexInParent()}renderableContentType(){return this.hasCustomRenderTree()?Ar.RenderableContentType.CUSTOM_RENDER_TREE:16&this._planNode.enabledTraits?this._sceneNodeCursor!=null?this._sceneNodeCursor.renderableContentType():Ar.RenderableContentType.NON_RENDERABLE:Ar.RenderableContentType.RENDERABLE_GROUP}isFrameLike(){return this._planNode.isDissolve?!1:ir.isFrameLike(this.type())}isTopLevel(){return!1}paintsDebugString(){return`AnimationPlanNode [from=${this._planNode._oldSceneNode.paintsDebugString()}] [to=${this._planNode._newSceneNode.paintsDebugString()}]`}subtreeWillChange(){var t,r;if(this._planNode.cachedSubtreeWillChange!==void 0)return this._planNode.cachedSubtreeWillChange;if(this._sceneNodeCursor.node!=null&&this._sceneNodeCursor.node.isTopLevel())return this._planNode.cachedSubtreeWillChange=!0,!0;if((t=this._planNode._oldSceneNode)!=null&&t.hasBackgroundBlurs()||(r=this._planNode._newSceneNode)!=null&&r.hasBackgroundBlurs())return this._planNode.cachedSubtreeWillChange=!0,!0;if(!this._planNode.isEverVisible())return this._planNode.cachedSubtreeWillChange=!1,!1;if(this.willChange()!==0)return this._planNode.cachedSubtreeWillChange=!0,!0;if(this._planNode.isDissolve||this._planNode.transition!=null&&(this._planNode.transition.hasTransitioningPaints()||this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()))return this._planNode.cachedSubtreeWillChange=!0,!0;if(this.childCount()===0)return this._planNode.cachedSubtreeWillChange=!1,!1;for(let n=this.childCount()-1;n>=0;n=n-1){this.moveToChildAt(n);let o=this.subtreeWillChange();if(this.moveToParent(),o!=!1)return this._planNode.cachedSubtreeWillChange=!0,!0}return this._planNode.cachedSubtreeWillChange}willChange(){if(this._planNode.transition==null||!this._planNode.isEverVisible())return 0;let e=0;return this._planNode.transition.from().opacity1()!=this._planNode.transition.to().opacity1()&&(e|=2),(this._planNode.transition.hasTransitioningTranslation()||this._planNode.transition.hasTransitioningTransform()||this._planNode.transition.hasTransitioningScaling()||this._planNode.transition.hasTransitioningTransformOrigin())&&(e|=1),this._planNode.scalesIndependentlyOfParent&&(e|=1),e}size(){return this._planNode.sceneNode().size()}shouldOptimizeShadowForAnimation(e){return e==null||e.equals(ye.FrozenVector_ZERO)?!1:this._planNode.rotatesOrScales1()}hasCustomRenderTree(){return this._planNode.isDissolve}customRenderTree(e){var t,r,n,o;if(this._planNode.isDissolve){let a=this._planNode.indexInParent(),s=this._planNode.forDissolveStart1();(t=this._planNode.parent)==null||t.insertChildren(a,[s]);let l=Ne.generateRenderTree(new i(s,this._getEasedT,this._easingFunction),e);(r=this._planNode.parent)==null||r.removeChild(a);let c=null;if(this._node!=null&&this._node.hasBackgroundBlurs())c=Ne.generateRenderTree(new Kt(this._node),e);else{let h=this._planNode.forDissolveEnd1();(n=this._planNode.parent)==null||n.insertChildren(a,[h]),c=Ne.generateRenderTree(new i(h,this._getEasedT,this._easingFunction),e),(o=this._planNode.parent)==null||o.removeChild(a)}let d=new en(l,c,Ct.forAnimateableDissolve(this._planNode.sceneNode().id()),this._getEasedT);return this._planNode.clearTransitionForDissolveRenderTrees(),this._planNode.invalidateCachedAbsoluteTransformsForSelf(),this._planNode.cachedSubtreeWillChange=!0,d}throw new Error("Unhandled customRenderTree case")}opacity(){return 32&this._planNode.enabledTraits?this._planNode.transition!=null?this._planNode.transition.interpolateOpacity(this._getEasedT()):this._sceneNodeCursor.opacity():1}absoluteTransform(){return this._planNode.absoluteTransform1(this._getEasedT())}maxTransformScale(){let e=this._planNode.transition;if(e==null)return 1;let t=e.from().scaling1(),n=e.to().scaling1().divide1(t).min1();return Math.max(n,1)}scene(){return this._sceneNodeCursor.scene()}parent(){if(this._planNode.parent==null)return null;let e=this._node!=null?this._node.parent():null;return new i(this._planNode.parent,e,this._getEasedT,this._easingFunction)}blendMode(){return 32&this._planNode.enabledTraits?this._sceneNodeCursor.blendMode():"PASS_THROUGH"}visible(){return this._sceneNodeCursor.visible()}isVisibleMask(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.isVisibleMask():!1}maskType(){return this._sceneNodeCursor.maskType()}isSpreadEligibleNode(){return this._sceneNodeCursor.isSpreadEligibleNode()}type(){return this._sceneNodeCursor.type()}childCount(){return this._planNode.children.length}clipsChildren(){return 2&this._planNode.enabledTraits?this._sceneNodeCursor.clipsChildren():!1}stopsMaskPropagation(){return this._planNode.forceMask?!0:128&this._planNode.enabledTraits?this._sceneNodeCursor.stopsMaskPropagation():!1}strokeAlign(){return this._sceneNodeCursor.strokeAlign()}strokeWeight(){return this._sceneNodeCursor.strokeWeight()}hasDefaultStrokeParameters(){return this._sceneNodeCursor.hasDefaultStrokeParameters()}strokeJoin(){return this._sceneNodeCursor.strokeJoin()}setStrokeJoin(e){this._sceneNodeCursor.setStrokeJoin(e)}strokeMiterLimit(){return this._sceneNodeCursor.strokeMiterLimit()}setStrokeMiterLimit(e){this._sceneNodeCursor.setStrokeMiterLimit(e)}uniqueIdentifier(){return this._sceneNodeCursor.id()}isInsideOutlineMask(){return this._sceneNodeCursor.isInsideOutlineMask()}textData(){return this._sceneNodeCursor.textData()}derivedTextData(){return this._sceneNodeCursor.derivedTextData()}arcData(){return this._sceneNodeCursor.arcData()}roundedRectInfo(){return this._sceneNodeCursor.roundedRectInfo()}fillGeometry(){if(16&this._planNode.enabledTraits){if(this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles())return this._planNode.transition.fillGeometryForRoundedRectangles(this._getEasedT,this._easingFunction.bounds)}else return null;return this._sceneNodeCursor.fillGeometry()}strokeGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.strokeGeometry():null}fillGeometryForSpread(e,t,r){return 16&this._planNode.enabledTraits&&this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()?this._planNode.transition.fillGeometryForSpreadDynamic(e,t,this._getEasedT,r,this.uniqueIdentifier(),this._easingFunction.bounds):this._sceneNodeCursor.fillGeometryForSpread(e,t,r)}strokeGeometryForSpread(e,t,r,n){return this._sceneNodeCursor.strokeGeometryForSpread(e,t,r,n)}textGeometry(){return 16&this._planNode.enabledTraits?this._sceneNodeCursor.textGeometry():null}getCachedRenderTree(){return null}getCachedBaseScreenRenderTree(){return null}renderTree(){if(Lt.didEncounterStaticRenderTreeAnimationOpt(),X.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=null;return this._sceneNodeCursor.node.getCachedRenderTreeForBaseScreen()!=null?t=this._sceneNodeCursor.node.renderTreeForBaseScreen1():t=this._sceneNodeCursor.renderTree(),this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);return Ne.generateRenderTree(this.clone(),e)}renderTreeWithoutBackgroundBlurs(){if(X.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeWithoutBackgroundBlurs();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new Ne.GenerateArgs(Ne.RenderMode.WITHOUT_BACKGROUND_BLURS);return Ne.generateRenderTree(this.clone(),e)}renderTreeForShadowRoot(){if(X.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForShadowRoot();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new Ne.GenerateArgs(Ne.RenderMode.SHADOW,this.uniqueIdentifier());return Ne.generateRenderTree(this.clone(),e)}renderTreeForShadowDescendant(){if(X.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForShadowDescendant();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new Ne.GenerateArgs(Ne.RenderMode.SHADOW);return Ne.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowRoot(){if(X.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForKnockoutShadowRoot();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Ne.generateRenderTree(this.clone(),e)}renderTreeForKnockoutShadowDescendant(){if(X.useStaticRenderTreeIfNonAnimatingSubtree()&&this._sceneNodeCursor!=null&&!this.subtreeWillChange()){let t=this._sceneNodeCursor.renderTreeForKnockoutShadowDescendant();return this.wrapNonAnimatingSubTreeWithPositionTransform(t)}let e=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW);return Ne.generateRenderTree(this.clone(),e)}wrapNonAnimatingSubTreeWithPositionTransform(e){if(e==null)return null;if(this._planNode._oldSceneNode==null){let t=this._planNode._newSceneNode.absoluteTransform(),r=this.absoluteTransform().clone();return r=r.multipliedBy1(t.inverse()),new To(e,r)}else return new To(e,this._planNode._oldCanvasToRenderTreeTransform)}isFixed(){return this._sceneNodeCursor.isFixed()}isStandardScrolling(){return this._sceneNodeCursor.isStandardScrolling()}isStickyScrolling(){return this._sceneNodeCursor.isStickyScrolling()}scrollOffset(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollOffset():ye.FrozenVector_ZERO}scrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.scrollDirection():"NONE"}hasOverflowingContentInScrollDirection(){return 1&this._planNode.enabledTraits?this._sceneNodeCursor.hasOverflowingContentInScrollDirection():!1}effects(){return this._planNode.isDissolve||!(64&this._planNode.enabledTraits)?[]:this._sceneNodeCursor.effects()}fillPaints(){var t;if(!(4&this._planNode.enabledTraits))return Ce.EMPTY;if(this._planNode.forceMask)return[te.createSolid(C.BLACK,1)];let e=((t=this._planNode.transition)==null?void 0:t.fillPaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.fillPaints():e}strokePaints(){var t;if(!(8&this._planNode.enabledTraits))return Ce.EMPTY;let e=((t=this._planNode.transition)==null?void 0:t.strokePaints2(this._getEasedT))??[];return e.length==0?this._sceneNodeCursor.strokePaints():e}fillPaintsToRender(){return 4&this._planNode.enabledTraits?this._sceneNodeCursor.fillPaintsToRender():Ce.EMPTY}videoPlayback(){return this._sceneNodeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._sceneNodeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._sceneNodeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._sceneNodeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._sceneNodeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._sceneNodeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._sceneNodeCursor.node.overrideKey()}name(){return this._sceneNodeCursor.node.name()}getSemanticNodePath(){return this._sceneNodeCursor.getSemanticNodePath()}hasBackgroundBlurs(){return this._sceneNodeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._sceneNodeCursor.overlayRenderData()}containsIndependentBordersStrokeMask(){return this._sceneNodeCursor.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,t,r){return this._sceneNodeCursor.generateStrokeAndStrokeMaskGeometries(e,t,r)}};function Mp(i){if(i.fillGeometry()!=null&&i.fillGeometry().regions.length!=0)return i.size();let e=i.size().x()<=.1,t=i.size().y()<=.1;if(e==t)return i.size();let r=Math.max(i.strokeWeight(),.1),n=R.new3(i.size());return e?n.setX(r):n.setY(r),n}var Yo=class i{constructor(){var e,t;if(arguments.length==4){let r=arguments[0],n=arguments[2];if(this._stateGroupSwapInteractionCounts=arguments[3],this._sceneCursor=null,this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this._planTrees=new Map,this.transitionMap=arguments[1],r.transitioningFrom!=null){let o=r.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=o;let a=this._getOrCreateSmartAnimatePlanTreeAt(r,this._activeTransitionKey);if(a!=null){let s=this.transitionMap.get(o).progress,l=this.transitionMap.get(o).change.transitionParameters;this._activeCursor=new Ci(a,r,s,l.easingFunction);return}}this._sceneCursor=new Kt(r,n),this._activeCursor=this._sceneCursor}else if(arguments.length==1){let r=arguments[0];this._sceneCursor=(e=r._sceneCursor)==null?void 0:e.clone(),this._planTrees=r._planTrees,r._activeCursor==r._sceneCursor?this._activeCursor=this._sceneCursor:this._activeCursor=(t=r._activeCursor)==null?void 0:t.clone(),this._activeTransitionKey=r._activeTransitionKey,this._activeTransitionIndexInParent=r._activeTransitionIndexInParent,this.transitionMap=r.transitionMap,this._stateGroupSwapInteractionCounts=r._stateGroupSwapInteractionCounts}}clone(){return new i(this)}_getOrCreateSmartAnimatePlanTreeAt(e,t){let r=this.transitionMap.get(t).change.transitionParameters;if(r.transitionType=="SMART_ANIMATE"||mn.supportsSmartAnimate(r.transitionType)&&r.transitionShouldSmartAnimate){if(!this._planTrees.has(t)){let n=wo.getMagicMovePlanForStateSwapTransition(e.transitioningFrom.exitingTransitionRoot,e);this._planTrees.set(t,n)}return this._planTrees.get(t)}return null}moveToChildAt(e){if(this._activeTransitionKey==null&&this._sceneCursor!=null){let t=this._sceneCursor.node.childAt2(e,!0);if(t.transitioningFrom!=null){this._activeTransitionIndexInParent=e;let r=t.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=r;let n=this._getOrCreateSmartAnimatePlanTreeAt(t,this._activeTransitionKey);if(n!=null){let o=this.transitionMap.get(r).progress,a=this.transitionMap.get(r).change.transitionParameters;this._sceneCursor.moveToChildAt(e),this._activeCursor=new Ci(n,t,o,a.easingFunction);return}}}this._activeCursor.moveToChildAt(e)}moveToParent(){this._activeCursor.isRoot()?(this._sceneCursor.moveToParent(),this._activeCursor=this._sceneCursor,this._activeTransitionIndexInParent=-1,this._activeTransitionKey=null):(this._activeCursor==this._sceneCursor&&(this._activeTransitionKey=null),this._activeCursor.moveToParent())}isRoot(){return this._activeCursor.isRoot()?this._sceneCursor==null||this._sceneCursor==this._activeCursor:!1}indexInParent(){return!this.isRoot()&&this._activeCursor.isRoot()?this._activeTransitionIndexInParent:this._activeCursor.indexInParent()}renderableContentType(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?Ar.RenderableContentType.CUSTOM_RENDER_TREE:this._activeCursor.renderableContentType()}isFrameLike(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?!1:this._activeCursor.isFrameLike()}isTopLevel(){return this._activeTransitionKey!=null||this._sceneCursor==null?!1:this._sceneCursor.node.isTopLevel()}paintsDebugString(){return`PlaybackCursor ${this._sceneCursor.node.paintsDebugString()}`}willChange(){return this._activeCursor.willChange()}shouldOptimizeShadowForAnimation(e){return this._activeCursor.shouldOptimizeShadowForAnimation(e)}customRenderTree(e){if(this._sceneCursor==this._activeCursor&&this._sceneCursor.node.transitioningFrom!=null){let t=this.transitionMap.get(this._activeTransitionKey).progress,r=this.transitionMap.get(this._activeTransitionKey).change,n=r.transitionParameters,o=Ir.get(n.transitionType);r.direction==1&&(o=o.reversed());let a=this._sceneCursor.node,s=a.transitioningFrom.exitingTransitionRoot,l=Ne.generateRenderTree(new Kt(a),e),c=Ne.generateRenderTree(new Kt(s),e),d=a.size().max2(s.size()),h=null;l!=null&&(h=pt.forTransformIsolation(l)),h!=null?(h=pt.forOpacity(h,Ct.forAnimateableOpacity(a.id()),()=>o.enteringFrameTransition().interpolateOpacity(t())),h=pt.forTranslation(h,Ct.forAnimateableTranslation(a.id()),()=>d.multiply1(o.enteringFrameTransition().interpolateTranslation(t())))):h=new Xe([]);let u=null;if(c!=null&&(u=pt.forTransformIsolation(c)),u!=null?(u=pt.forOpacity(u,Ct.forAnimateableOpacity(s.id()),()=>o.exitingFrameTransition().interpolateOpacity(t())),u=pt.forTranslation(u,Ct.forAnimateableTranslation(s.id()),()=>d.multiply1(o.exitingFrameTransition().interpolateTranslation(t())))):u=new Xe([]),o.isDissolve()){let m=Ct.forAnimateableDissolve(a.id());return new en(u,h,m,t)}else return o.drawsEnteringFrameOnTopOfExitingFrame()?Xe.wrap([u,h]):Xe.wrap([h,u])}return this._activeCursor.customRenderTree(e)}name(){return this._activeCursor.name()}scene(){return this._activeCursor.scene()}parent(){if(this.isRoot())return null;let e=this.clone();return e.moveToParent(),e}blendMode(){return this._activeCursor.blendMode()}opacity(){return this._activeCursor.opacity()}visible(){return this._activeCursor.visible()}isVisibleMask(){return this._activeCursor.isVisibleMask()}maskType(){return this._activeCursor.maskType()}isSpreadEligibleNode(){return this._activeCursor.isSpreadEligibleNode()}type(){return this._activeCursor.type()}childCount(){return this._activeCursor.childCount()}absoluteTransform(){return this._activeCursor.absoluteTransform()}maxTransformScale(){return this._activeCursor.maxTransformScale()}clipsChildren(){return this._activeCursor.clipsChildren()}stopsMaskPropagation(){return this._activeCursor.stopsMaskPropagation()}arcData(){return this._activeCursor.arcData()}roundedRectInfo(){return this._activeCursor.roundedRectInfo()}fillGeometry(){return this._activeCursor.fillGeometry()}strokeGeometry(){return this._activeCursor.strokeGeometry()}fillGeometryForSpread(e,t,r){return this._activeCursor.fillGeometryForSpread(e,t,r)}strokeGeometryForSpread(e,t,r,n){return this._activeCursor.strokeGeometryForSpread(e,t,r,n)}size(){return this._activeCursor.size()}strokeAlign(){return this._activeCursor.strokeAlign()}strokeWeight(){return this._activeCursor.strokeWeight()}hasDefaultStrokeParameters(){return this._activeCursor.hasDefaultStrokeParameters()}strokeJoin(){return this._activeCursor.strokeJoin()}setStrokeJoin(e){this._activeCursor.setStrokeJoin(e)}strokeMiterLimit(){return this._activeCursor.strokeMiterLimit()}setStrokeMiterLimit(e){this._activeCursor.setStrokeMiterLimit(e)}uniqueIdentifier(){return this._activeCursor.uniqueIdentifier()}isInsideOutlineMask(){return this._activeCursor.isInsideOutlineMask()}textData(){return this._activeCursor.textData()}derivedTextData(){return this._activeCursor.derivedTextData()}textGeometry(){return this._activeCursor.textGeometry()}getCachedRenderTree(){return this._activeCursor.getCachedRenderTree()}_shouldPreemptivelyMarkAsVolatile(){if(X.shouldPreventVolatileCaching())return!1;let e=this._sceneCursor.node.canvas().parent().scene(),t=this._sceneCursor.node;if(!t.isInstance())return!1;let r=X.viewerICCacheOpt();Lt.didEncounterICCacheOpt();let n=1;if(!r&&t.stablePath().guids.length>n+1)return!1;let o=t.getBackingSymbolParent();return o==null||!o.isStateGroup()?!1:r?this._stateGroupSwapInteractionCounts.get(o.id(),0)>0:!0}renderTree(){if(this._sceneCursor==null){let e=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);return Ne.generateRenderTree(this.clone(),e)}else if(this._activeCursor==this._sceneCursor){let e=this._sceneCursor.node.renderTree2(this);return this._shouldPreemptivelyMarkAsVolatile()&&e!=null?pt.forStateSwap(e):e}else{if(this._activeCursor.isRoot())return this._sceneCursor.node.renderTree2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);return Ne.generateRenderTree(this.clone(),e)}}}renderTreeWithoutBackgroundBlurs(){return this._activeCursor.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowRoot2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.SHADOW,this.uniqueIdentifier());return Ne.generateRenderTree(this.clone(),e)}}renderTreeForShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowDescendant2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.SHADOW);return Ne.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowRoot2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Ne.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowDescendant2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW);return Ne.generateRenderTree(this.clone(),e)}}isFixed(){return this._activeCursor.isFixed()}isStandardScrolling(){return this._activeCursor.isStandardScrolling()}isStickyScrolling(){return this._activeCursor.isStickyScrolling()}scrollOffset(){return this._activeCursor.scrollOffset()}scrollDirection(){return this._activeCursor.scrollDirection()}hasOverflowingContentInScrollDirection(){return this._activeCursor.hasOverflowingContentInScrollDirection()}effects(){return this._activeCursor.effects()}fillPaints(){return this._activeCursor.fillPaints()}strokePaints(){return this._activeCursor.strokePaints()}fillPaintsToRender(){return this._activeCursor.fillPaintsToRender()}videoPlayback(){return this._activeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._activeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._activeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._activeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._activeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._activeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._activeCursor.overrideKey()}getSemanticNodePath(){return vr.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this._activeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._activeCursor.overlayRenderData()}containsIndependentBordersStrokeMask(){return this._activeCursor.containsIndependentBordersStrokeMask()}generateStrokeAndStrokeMaskGeometries(e,t,r){return this._activeCursor.generateStrokeAndStrokeMaskGeometries(e,t,r)}};var Ln=class i{willStartTransitionWithDuration(e){this._durationSeconds=e,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=We.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0,this._progressAtStart=0,this._lastProgress=0}transitionEnded(){this._lastProgress=-1,this._progressType=i.ProgressType.FORWARD,this._externalOnTickProgress=null;let e=this._externalOnTransitionEnded;return this._externalOnTransitionEnded=null,e!=null?e():i.TransitionEndedAction.COMMIT}isTransitionInProgress(){return this.isProgressControlledExternally()?!0:this._progressType==i.ProgressType.REVERSE?0<this._lastProgress&&this._lastProgress<=1:0<=this._lastProgress&&this._lastProgress<1}duration(){return this._durationSeconds}progress(){return this._lastProgress}isProgressControlledExternally(){return this._progressType==i.ProgressType.EXTERNAL}pinProgressToRealTimeWithDuration(e,t,r){this._progressAtStart=e,this._durationSeconds=t,this._progressType=r?i.ProgressType.REVERSE:i.ProgressType.FORWARD,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=We.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0}pinProgressToExternalControl(e,t){this._externalOnTickProgress=e,this._externalOnTransitionEnded=t,this._progressType=i.ProgressType.EXTERNAL,this._timeOfTransitionStart=We.seconds(),this.frameTimesMs.length=0}advanceToNextFrame(){if(this.isProgressControlledExternally())this._lastProgress=this._externalOnTickProgress();else if(this._durationSeconds>0){let e=We.seconds(),t=e-this._timeOfLastTransitionFrame;this.frameTimesMs.push(1e3*t),t=Math.min(t,1/30),this._elapsedSeconds+=t,this._timeOfLastTransitionFrame=e;let r=this._progressType==i.ProgressType.REVERSE?-1:1;this._lastProgress=lr.Math_clamp(r*this._elapsedSeconds/this._durationSeconds+this._progressAtStart,0,1)}else this._lastProgress=this._progressType==i.ProgressType.REVERSE?0:1}constructor(){this._lastProgress=-1,this._durationSeconds=-1,this._elapsedSeconds=-1,this._timeOfLastTransitionFrame=-1,this._progressAtStart=0,this._timeOfTransitionStart=-1,this.frameTimesMs=[],this._progressType=i.ProgressType.FORWARD,this._externalOnTickProgress=null,this._externalOnTransitionEnded=null}};(t=>{let i;(a=>(a[a.FORWARD=0]="FORWARD",a[a.REVERSE=1]="REVERSE",a[a.EXTERNAL=2]="EXTERNAL"))(i=t.ProgressType||(t.ProgressType={}));let e;(o=>(o[o.ABORT=0]="ABORT",o[o.COMMIT=1]="COMMIT"))(e=t.TransitionEndedAction||(t.TransitionEndedAction={}))})(Ln||(Ln={}));var ds;(t=>{function i(r,n){r(n)}t.applyTo=i;function e(r){return r}t._new=e})(ds||(ds={}));var Bp=class{constructor(e){this._dragToAnimateBehavior=null,this._canvasView=null,this._canvasView=e}clearDrag(e){this._dragToAnimateBehavior==e&&(this._canvasView.removeInteractionObserver(this._dragToAnimateBehavior),this._dragToAnimateBehavior=null)}removeFrom(e){this.clearDrag(this._dragToAnimateBehavior)}getTransitionMixin(e,t,r){let n=t.interactionAddress.hotspotStablePath!=null?e.findNodeByStablePath(t.interactionAddress.hotspotStablePath):null;if(n==null)return null;switch(t.cause){case 5:{if(!r&&ut.getControlSource(t.cause)!=0){let o=pr.computeDragVector2(t,n,e);if(o!=null&&o.length()>0)return ds._new(a=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new pr(this,o,a,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}getTransitionMixinForStateSwap(e,t,r){switch(t.cause){case 5:{if(!r&&ut.getControlSource(t.cause)!=0){let n=pr.computeDragVectorForStateSwap(t,e);if(n!=null&&n.length()>0)return ds._new(o=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new pr(this,n,o,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}},Ri=class Ri{static computeOverlaySwipeDragVector(e,t,r){let n=r.size(),o=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return n.multiply1(o.to().translation1().subtract1(o.from().translation1()))}static computeScreenSwipeDragVector(e,t,r){let n=t.size().max2(r.size()),o=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return n.multiply1(o.to().translation1().subtract1(o.from().translation1()))}static computeSmartAnimateDragVector(e,t,r){if(t!=null&&r!=null&&e!=null){let n=wo.getNodeMatches(t,r),o=He.StringMap_get(n,e.id(),null);if(o!=null){let a=t.absoluteTransform().inverse().multipliedBy1(e.absoluteTransform()).transformPoint(e.size().divide(2));return r.absoluteTransform().inverse().multipliedBy1(o.absoluteTransform()).transformPoint(o.size().divide(2)).subtract1(a)}}return null}static computeDragVectorImpl(e,t,r,n,o,a,s){if(e==null)return null;if(t!=null&&r!=null){if(o=="SMART_ANIMATE"||mn.supportsSmartAnimate(o)&&s){let d=Ri.computeSmartAnimateDragVector(e,t,r);if(d!=null&&d.length()>0)return d}if(["DISSOLVE","INSTANT_TRANSITION","SMART_ANIMATE"].indexOf(o)==-1){let d=Ir.get(o);n==1&&(d=d.reversed());let h=null;if(["OVERLAY","SWAP"].indexOf(a)!=-1?h=Ri.computeOverlaySwipeDragVector(d,t,r):h=Ri.computeScreenSwipeDragVector(d,t,r),h.length()>0)return h}}return null}static computeDragVector1(e,t,r,n,o){if(e==null||t==null)return null;let a=null;for(let g of t.allActions())if(["INTERNAL_NODE","BACK","CLOSE"].indexOf(g.connectionType())!=-1){a=g;break}if(a==null)return null;let s=a.connectionType(),l=null,c=null,d=a.transitionShouldSmartAnimate(),h=0,u=r,m=null;if(s=="INTERNAL_NODE")if(c=a.navigationType(),l=a.transitionType(),c=="SWAP_STATE"){let g=Zt.whichInstanceToSwap(e,a.transitionNodeID());g!=null&&(u=g,m=e.scene().findNode(a.transitionNodeID()))}else c=="SWAP"&&(u=e.topLevelAncestor()),m=n.getDestinationFrame(a.transitionNodeID());else if(s=="BACK"){let g=o.getPreviousNonTransientChange();if(g==null)return null;m=n.getDestinationFrame(g.oldStateId()),l=g.transitionParameters.transitionType,c="NAVIGATE",h=1}else if(s=="CLOSE"){m=e.topLevelAncestor();let g=o.getOpenOverlayData(m.id());if(g==null)return null;l=g.openingTransitionType(),c="OVERLAY",h=1}return Ri.computeDragVectorImpl(e,u,m,h,l,c,d)}static computeDragVector2(e,t,r){let n=null,o=null;if(e.oldStateId()==e.newStateId()&&e.oldOverlayData().length>0&&e.oldOverlayData().length==e.newOverlayData().length){let s=e.oldOverlayData()[e.oldOverlayData().length-1],l=e.newOverlayData()[e.newOverlayData().length-1];n=r.findNode(s.id),o=r.findNode(l.id)}else if(n=r.findNode(e.oldStateId()),e.transitionParameters.navigationType=="OVERLAY"){let s=e.direction==1?e.getRemovedFrameIds():e.getInsertedFrameIds();o=r.findNode(s[0])}else o=r.findNode(e.newStateId());return Ri.computeDragVectorImpl(t,n,o,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}static computeDragVectorForStateSwap(e,t){var a,s;let r=t.findNodeByStablePath(e.stablePath),n=(a=r==null?void 0:r.transitioningFrom)==null?void 0:a.exitingTransitionRoot,o=(s=r==null?void 0:r.transitioningFrom)==null?void 0:s.hotspotInExitingTree;return Ri.computeDragVectorImpl(o,n,r,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}constructor(e,t,r,n){var o;this._dragStartPosition=null,this._currPointerPosition=null,this._lastPointerPosition=null,this._currPointerTime=-1,this._lastPointerTime=-1,this._didRecordPointerPosition=!1,this._pointerVelocity=null,this._shouldRevertTransition=!1,this._behaviorManager=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._lastPointerTime=We.seconds(),this._behaviorManager=e,this._dragVector=t,this._easingFunction=n,this._transitionProgress=r,(o=this._transitionProgress)==null||o.pinProgressToExternalControl(()=>this.onTickProgress(),()=>this.onTransitionEnded())}handleDrag(e){this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,this._currPointerTime=We.seconds(),this._currPointerPosition=e,this._didRecordPointerPosition=!0}handleDragStart(e){this._dragStartPosition=e}handleRelease(e){if(this._transitionProgress!=null&&this._transitionProgress.isProgressControlledExternally()){let t=this._transitionProgress.progress(),r=this._easingFunction!=null?this._easingFunction.invert(t):t,n=this.signedDragSpeed(),o=this._transitionProgress.duration(),a=o>0?Ri.DRAG_SPEED_THRESHOLD_MULTIPLE/o:0,s=n>=a,l=n<=-a;this._shouldRevertTransition=!1,t>=.5?this._shouldRevertTransition=l:this._shouldRevertTransition=!s;let c=1;if(this._shouldRevertTransition&&(c=lr.Math_clamp(Math.log(r+.5)/Math.log(2)+1,.02,1)),Math.abs(n)>=1/o){let d=this._easingFunction!=null?this._easingFunction.getDerivative(r,n):1;c=Math.abs(n/d)}this._transitionProgress.pinProgressToRealTimeWithDuration(r,o/c,this._shouldRevertTransition)}}onTickProgress(){if(this._dragVector!=null){if(this._currPointerPosition!=null&&this._dragStartPosition!=null){if(this._lastPointerPosition!=null&&this._lastPointerTime!=-1){let r=this._currPointerTime;this._didRecordPointerPosition||(this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,r=We.seconds(),this._currPointerTime=r),this._pointerVelocity=this._currPointerPosition.subtract1(this._lastPointerPosition).divide(r-this._lastPointerTime)}let e=this._currPointerPosition.subtract1(this._dragStartPosition),t=lr.Math_clamp(e.dot(this._dragVector)/Math.pow(this._dragVector.length(),2),0,1);return this._didRecordPointerPosition=!1,t}return this._didRecordPointerPosition=!1,0}return this._didRecordPointerPosition=!1,1}onTransitionEnded(){return this._dragStartPosition=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._behaviorManager!=null&&this._behaviorManager.clearDrag(this),this._shouldRevertTransition?Ln.TransitionEndedAction.ABORT:Ln.TransitionEndedAction.COMMIT}signedDragSpeed(){return this._pointerVelocity==null||this._dragVector==null?0:this._dragVector.length()>0?this._pointerVelocity.dot(this._dragVector)/Math.pow(this._dragVector.length(),2):0}};Ri.DRAG_SPEED_THRESHOLD_MULTIPLE=.15;var pr=Ri;var Gp=fs(Rl());var Zc=class{constructor(){if(arguments[0]==0){let[,e]=arguments;this.ws=null,this.ws=e}else if(arguments[0]==1){let[,e]=arguments;this.ws=null,this.ws=new WebSocket(e)}}url(){return this.ws.url}readyState(){return this.ws.readyState}setBinaryType(e){this.ws.binaryType=e}binaryType(){return this.ws.binaryType}setOnclose(e){this.ws.onclose=t=>{e(t)}}setOnerror(e){this.ws.onerror=t=>{e(t)}}setOnmessage(e){this.ws.onmessage=t=>{e(new Hg(t))}}setOnopen(e){this.ws.onopen=t=>{e(t)}}close(){this.ws.close()}send1(e){this.ws.send(e)}send2(e){this.ws.send(e)}equals(e){var t;return this.ws==((t=e==null?void 0:e.asHTMLSocket())==null?void 0:t.ws)}asHTMLSocket(){return this}asMockSocket(){return null}},Vp=class Vp{simulateDidOpen(){if(this._readyState=Yn.Socket_OPEN,this._onopen!=null){let e={meta:"Fake open event for testing"};this._onopen(e)}}simulateDidClose(){if(this._readyState=Yn.Socket_CLOSED,this._onclose!=null){let e={meta:"Fake close event for testing"};this._onclose(e)}}simulateMessage(e){this._onmessage!=null&&this._onmessage(e)}url(){return Vp.FAKE_URL}readyState(){return this._readyState}setBinaryType(e){this._binaryType=e}binaryType(){return this._binaryType}setOnclose(e){this._onclose=e}setOnerror(e){this._onerror=e}setOnmessage(e){this._onmessage=e}setOnopen(e){this._onopen=e}close(){this._readyState=Yn.Socket_CLOSING}send1(e){if(this._readyState!=Yn.Socket_OPEN)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.");this.sent.push(new Uint8Array(e))}send2(e){if(this._readyState!=Yn.Socket_OPEN)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.");this.sent.push(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}equals(e){return(e==null?void 0:e.asMockSocket())==this}asHTMLSocket(){return null}asMockSocket(){return this}constructor(){this._readyState=Yn.Socket_CONNECTING,this._binaryType="blob",this._onclose=null,this._onerror=null,this._onmessage=null,this._onopen=null,this.sent=[]}};Vp.FAKE_URL="ws://fake_url_for_tests_value_does_not_matter.com";var Gg=Vp;var Hg=class{isArrayBuffer(){return this.messageEvent.data instanceof ArrayBuffer}isBlob(){return this.messageEvent.data instanceof Blob}isString(){return typeof this.messageEvent.data=="string"}dataAsArrayBuffer(){return this.messageEvent.data}dataAsBlob(){return this.messageEvent.data}dataAsString(){return this.messageEvent.data}constructor(e){this.messageEvent=e}},Yn;(n=>(n.Socket_CONNECTING=0,n.Socket_OPEN=1,n.Socket_CLOSING=2,n.Socket_CLOSED=3))(Yn||(Yn={}));var mr=class mr{static logVerbose(e){mr.VERBOSE_LOGS&&console.log("[IncrementalFrameLoader]",e())}static MAX_SLIDESHOW_PRELOAD_DISTANCE(){return 2}constructor(e,t){this._multiplayer=null,this._appState=null,this._emitter=null,this._canvas=null,this._currentQueries=new Xo,this._previousSceneGraphReply=new Xo,this._rootLevelSceneGraphQuery=Er.create(J._new(0,0),1),this._requestSectionsOnCanvas=!1,this._requestedTlfIds=new ln,this._currentTlfIds=[],this._requestedSectionsQueue=[],this._bfsOrderWorkingSet=[],this._pendingNodeToRequest=null,this._multiplayer=t,this._multiplayer.addObserver(this),this._appState=e,e.addAppObserver(this),e.prototypeState().addObserver(this),this._emitter=$t.getEventEmitter(),this._emitter.on("slowIncrementalLoad",r=>{De.trackEventJSON1("Slow incremental load",r)}),console.debug("Using incremental frame loading")}dangerouslySetLoadFullDocument(e){this._setLoadFullDocument(e)}setLoadFullDocumentForTests(e){this._setLoadFullDocument(e)}_setLoadFullDocument(e){e?this._rootLevelSceneGraphQuery=Er.create(J._new(0,0),0):this._rootLevelSceneGraphQuery=Er.create(J._new(0,0),1)}simulateRepliedQueriesForTests(e){this._currentQueries=Xo.fromList(e),this.handleSceneGraphReply(0,e)}requestTlf(e){return this._setCurrentTlfIds([e]),this._isFullyLoaded(e)?!0:(this._requestedTlfIds.add(e),this._redeferUpdate(0),!1)}_setCurrentTlfIds(e){this._currentTlfIds=e}_requestTlfs(e){this._setCurrentTlfIds(e);for(let t of e){if(this._isFullyLoaded(t)){this._appState.requestedFrameMetricsTracker().track(t,{wasAlreadyLoaded:!0,wasAlreadyInWorkingSet:!0});continue}else{let r={wasAlreadyLoaded:!1,wasAlreadyInWorkingSet:!1};for(let n of this._bfsOrderWorkingSet)if(n.nodeId==t){r.wasAlreadyInWorkingSet=!0;break}this._appState.requestedFrameMetricsTracker().track(t,r)}this._requestedTlfIds.add(t),this._redeferUpdate(0)}}_isFullyLoaded(e){var n;let t=(n=this._multiplayer.scene())==null?void 0:n.findNode(e);if(t==null)return!1;let r=t;for(;r!=null;){if(this._previousSceneGraphReply.containsExactQuery(Er.create(r.id(),0)))return!0;r=r.parent()}return!1}_isQueryPresent(e,t){for(let r of t)if(tn.equals(r,e))return!0;return!1}_getQueriesToLoad(){let e=new Xo;return this._requestSectionsOnCanvas&&(this._getSectionAndSlideSceneGraphQueriesGivenNode(this._canvas).each(r=>{e.add(r)}),this._requestSectionsOnCanvas=!1),this._addRequestedTlfs(e),this._appState.scene()!=null&&this._addScreenAdjacencies(e),e}_getSectionAndSlideSceneGraphQueriesGivenNode(e){let t=new Xo;if(this._multiplayer.scene()!=null){if(e==null||e.type()!="DOCUMENT"&&e.type()!="CANVAS"&&e.type()!="SECTION")return t;Wr(e,r=>{if(r.type()=="SECTION"){De.trackDefinedEvent("prototype.ifl_section_infinite_query",{});let n=Er.create(r.id(),0);t.add(n)}r.type()=="SLIDE_GRID"&&t.add(Er.create(r.id(),2))})}return t}_getSectionSceneGraphQueries(){var r;let e=new Xo,t=[];if(this._multiplayer.scene()!=null){for(;this._requestedSectionsQueue.length!=0;){let n=this._requestedSectionsQueue.shift(),o=(r=this._multiplayer.scene())==null?void 0:r.findNode(n);o==null||o.type()!="DOCUMENT"&&o.type()!="CANVAS"&&o.type()!="SECTION"||Wr(o,a=>{if(a.id()!=o.id()&&a.type()=="SECTION"){let s=Er.create(a.id(),1);e.add(s),t.push(a.id())}})}this._requestedSectionsQueue=t}return e}_addRequestedTlfs(e){var t;mr.logVerbose(()=>"Visiting requestedTlfs for next queries:"+this._requestedTlfIds.asList().join(","));for(let r of this._requestedTlfIds.asList()){let n=J.fromString(r);if(n==null)continue;if(!this._previousSceneGraphReply.containsNodeById(n)){e.add(Er.create(n,1));continue}let a=(t=this._multiplayer.scene())==null?void 0:t.findNode(n);if(this._requestedTlfIds.remove(n),a==null){let s=J._new(0,0);e.add(Er.create(s,1)),this._requestedTlfIds.add(s)}else if(a.type()=="DOCUMENT"){this._emitter.trigger("redirectingToFirstPageDueToInvalidStartNode");let s=this._multiplayer.scene().firstUserCanvasOrNull();if(s==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(s.id()),e.add(Er.create(s.id(),1))}else if(a.type()=="CANVAS"){let s=!1,l=this._getSectionAndSlideSceneGraphQueriesGivenNode(a);s=l.count()>0,l.each(d=>{e.add(d)});let c=this._appState.prototypeStructure().nodeToRestartPrototypeOn(a);if(c==null){s||console.error("No top-level frames present");continue}this._requestedTlfIds.add(c.id()),e.add(Er.create(c.id(),0)),this._setCurrentTlfIds([c.id()])}else{for(;a!=null&&!a.isTopLevel();)a=a.parent();a!=null&&(e.add(Er.create(a.id(),0)),this._canvas=a.findContainingCanvasOrParent(),e.add(Er.create(this._canvas.id(),1)),this._getSectionAndSlideSceneGraphQueriesGivenNode(this._canvas).each(l=>{e.add(l)}),this._requestSectionsOnCanvas=!0)}}}_addScreenAdjacencies(e){X.getViewerMode()==X.ViewerMode.PROTOTYPE&&this._appState.prototypeStructure().currentType()==1&&this._addScreenAdjacenciesForSlideshow(e),this._addScreenAdjacenciesForPrototype(e)}_getMaxBFSDistance(){return Gt.isCurrentOSMobileOrIPad()?mr.MOBILE_MAX_PROTOTYPE_BFS_DEPTH:mr.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH}_getMaxBFSCount(){return Gt.isCurrentOSMobileOrIPad()?mr.MOBILE_MAX_PROTOTYPE_BFS_COUNT:mr.DEFAULT_MAX_PROTOTYPE_BFS_COUNT}_addScreenAdjacenciesForSlideshow(e){let t=qt.visuallySortedTopLevelFrames(this._appState.getActiveCanvas()),r=t.map(o=>o.id());if(this._currentTlfIds.length==0||!J.isValid(this._currentTlfIds[0]))return;let n=r.indexOf(this._currentTlfIds[0]);if(!(n<0)){for(let o=n-mr.MAX_SLIDESHOW_PRELOAD_DISTANCE(),a=n+mr.MAX_SLIDESHOW_PRELOAD_DISTANCE()+1;o<a;o=o+1)o>=0&&o<t.length&&e.add(Er.create(t[o].id(),0));if(this._currentTlfIds.length>1)for(let o=1,a=this._currentTlfIds.length;o<a;o=o+1)J.isValid(this._currentTlfIds[o])&&e.add(Er.create(this._currentTlfIds[o],0))}}_addScreenAdjacenciesForPrototype(e){if(this._currentTlfIds.length==0||!J.isValid(this._currentTlfIds[0]))return;let t=new mr.Queue;for(let l=this._currentTlfIds.length-1;l>=0;l=l-1)t.pushBackIfUnseen(this._currentTlfIds[l],0);let r=0;this._bfsOrderWorkingSet=[];let n=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF();for(;t.nonempty()&&(t.front().depth<=1||r<this._getMaxBFSCount());){let l=t.popFront(),c=l.guid,d=this._previousSceneGraphReply.containsExactQuery(Er.create(c,0));this._bfsOrderWorkingSet.push(new mr.WorkingSetItem(c,d));let h=this._appState.scene().findNode(c);if(h==null||(l.depth>0&&(r=r+1),l.depth>=this._getMaxBFSDistance()))continue;let u=qt.adjacentBaseScreens(n,h);Wr(h,m=>{var g;if(m.isInstance()&&!m.isPrimaryInstance()&&m.getBoundVariables().componentProperties){let f=this._appState.scene().findNode(m.symbolID()).parent();f.isStateGroup()&&(u.add(f.id()),m.invalidateRenderTreeForSelfAndParents(),m.invalidateRenderTreeForChildren())}(g=m.prototypeInteractions())==null||g.forEach(_=>{for(let f of _.allActions())if(J.isValid(f.transitionNodeID())&&u.add(f.transitionNodeID()),f.connectionType()=="BACK"){let S=this._appState.prototypeState().getLastChangeInHistory();S!=null&&S.getRemovedFrameIds().forEach(b=>{b!=null&&u.add(b)})}}),X.getFeatureFlags().viewer_ifl_enhancements&&qt.isNodeInteractableBecauseOfHyperlinks(m)&&m.textHyperlinkBoxes().forEach(_=>{_.guid&&u.add(J.fromFigGUID(_.guid))})});for(let m of u.asList())t.pushBackIfUnseen(m,l.depth+1)}let o=this._appState.prototypeState().getInitiatedChange();if(o!=null)for(let l of o.oldStateAndOverlays.statesAndOverlaysIncluded().asList()){let c=J.fromString(l);this._bfsOrderWorkingSet.unshift(new mr.WorkingSetItem(c,this._previousSceneGraphReply.containsExactQuery(Er.create(c,0))))}Cr.trackNumber("[IFL] Working set size",this._bfsOrderWorkingSet.length);let a=0,s=0;for(let l of this._bfsOrderWorkingSet)if(e.add(Er.create(l.nodeId,0)),l.isAlreadySubscribed?s=s+1:a=a+1,a>=mr.MAX_PROTOTYPE_TLF_BATCH_SIZE)break;Cr.trackNumber("[IFL] Working set frames loaded",s)}getMetricsForNode(e){return this._appState.requestedFrameMetricsTracker().getMetricsForRequestedNode(e.id())}_requestNextQueriesToLoad(e){if(e.add(this._rootLevelSceneGraphQuery),e.equals(this._currentQueries))return;X.protoUseFrameEviction()?(this._multiplayer.scene()!=null&&this._currentQueries.each(r=>{let n=this._multiplayer.scene().findNode(Ja.toString(r.startingNode));n!=null&&(n.type()=="DOCUMENT"||n.type()=="CANVAS"||n.type()=="SECTION")&&e.add(r)}),this._currentQueries=e):e.each(r=>{this._currentQueries.add(r)});let t=[];for(let r of this._currentQueries.asList())t.push(r);mr.logVerbose(()=>"setting scene graph queries:"+t.map(r=>tn.toString(r)).join(",")),this._multiplayer.setSceneGraphQueries(t)}_redeferUpdate(e){this._deferredUpdate!==void 0?this._deferredUpdate.redefer(e):this._deferredUpdate=new jc(()=>{mr.logVerbose(()=>`update............
`+(mr.VERBOSE_LOGS_SHOW_SCENEGRAPH?this._multiplayer.scene().root().hierarchyString():"")),this._requestNextQueriesToLoad(this._getQueriesToLoad()),this._deferredUpdate=void 0},e)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._redeferUpdate(0)}handleActiveCanvasChange(e,t){this._redeferUpdate(0)}handleActivePrototypeStartingPointChange(e,t){}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._redeferUpdate(0)}handleStateChangeRequested(e){let t=e.newStateAndOverlays.statesAndOverlaysIncluded(),r=[];for(let n of t.asList())r.push(J.fromString(n));this._requestTlfs(r)}handleFitModeChange(e,t){}handleRestartPrototype(){}handleConnect(e,t){e==0&&(X.getFeatureFlags().prototype_previous_reply||(this._previousSceneGraphReply=new Xo),this._currentQueries=new Xo,this._redeferUpdate(0),X.getViewerMode()==X.ViewerMode.PROTOTYPE&&t==null&&(t=J._new(0,0)),t!=null&&(this._pendingNodeToRequest=t))}handleDisconnect(){}handleJoinStart(e,t,r){X.getFeatureFlags().prototype_previous_reply&&e==0&&(this._previousSceneGraphReply=new Xo),this._pendingNodeToRequest!=null&&this.requestTlf(this._pendingNodeToRequest),this._pendingNodeToRequest=null}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){}handleSceneChangedLoadingPhase(e,t){}handleSceneGraphReply(e,t){De.handleMultiplayerFirstResponse(),mr.logVerbose(()=>{let a="";return a+=`
-----handleSceneGraphReply-----
`,a+="sceneGraphQueries:"+t.map(s=>tn.toString(s)).join(",")+`
`,mr.VERBOSE_LOGS_SHOW_SCENEGRAPH&&(a+=this._multiplayer.scene().root().hierarchyString()+`
`),a+="-----------------------------------",a}),this._previousSceneGraphReply=Xo.fromList(t);let r=this._getQueriesToLoad(),n=t.some(a=>Er.isUnlimitedRootQuery(a));r.isSubsetOf(this._previousSceneGraphReply)||n?(De.handleMultiplayerIFLSatisfied(),mr.logVerbose(()=>"All queries satisfied! Calling finishIncrementalLoading..."),this._multiplayer.finishIncrementalLoading(),De.handleIFLCompleted()):this._requestNextQueriesToLoad(r)}handleSceneGraphEvent(e){if(qn.isPrototypeStructuralChange(e.property)){if(e.node.type()=="SECTION"&&e.property==25&&(this._requestSectionsOnCanvas=!0),this._deferredUpdate!=null&&this._deferredUpdate.delayMs==0)return;this._redeferUpdate(Po||Vn?0:250)}}};mr.VERBOSE_LOGS=!1,mr.VERBOSE_LOGS_SHOW_SCENEGRAPH=!1,mr.MOBILE_MAX_PROTOTYPE_BFS_DEPTH=2,mr.DEFAULT_MAX_PROTOTYPE_BFS_DEPTH=8,mr.MOBILE_MAX_PROTOTYPE_BFS_COUNT=4,mr.DEFAULT_MAX_PROTOTYPE_BFS_COUNT=Number.MAX_SAFE_INTEGER,mr.MAX_PROTOTYPE_TLF_BATCH_SIZE=4;var Na=mr;(r=>{class i{constructor(o,a){this.guid=o,this.depth=a}}r.Entry=i;class e{constructor(o,a){this.nodeId=o,this.isAlreadySubscribed=a}}r.WorkingSetItem=e;class t{nonempty(){return this._queue.length>0}pushBackIfUnseen(o,a){this._seen.has(o)||(this._seen.set(o,!0),this._queue.push(new r.Entry(o,a)))}front(){return this._queue[0]}popFront(){return this._queue.shift()}constructor(){this._queue=[],this._seen=new Map}}r.Queue=t})(Na||(Na={}));var Xo=class i{add(e){let t=tn.nodeIdString(e);if(!this._hash.has(t))this._hash.set(t,e);else{let r=this._hash.get(t);if(r.depth==0)return;(e.depth==0||e.depth>r.depth)&&this._hash.set(t,e)}}containsNodeById(e){return e!=null&&this._hash.has(e)}containsExactQuery(e){return this.containsNodeById(J.fromFigGUID(e.startingNode))?this._hash.get(tn.nodeIdString(e)).depth==e.depth:!1}remove(e){this._hash.delete(tn.hash(e))}count(){return this._hash.size}asList(){return Array.from(this._hash.values())}each(e){Array.from(this._hash.values()).forEach(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}isSubsetOf(e){if(e==null||this.count()>e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}toJSObject(){return He.StringMap_toJSObject(this._hash)}static fromList(e){let t=new i;for(let r of e)t.add(r);return t}constructor(){this._hash=new Map}},ho=class ho{constructor(e,t){this.complete=()=>{let e=this._executionTime-Date.now();e<=0||2==0?this.callback():this._timeoutID=ho._setTimeout(this.complete,e)};this.delayMs=t,this.callback=e,this._timeoutID=ho._setTimeout(this.complete,t),this._executionTime=Date.now()+t}redefer(e){this._executionTime=Date.now()+e}cancel(){ho._clearTimeout(this._timeoutID)}static _setTimeout(e,t){if(2==0){let r=(ho._nextMockTimeoutID=ho._nextMockTimeoutID+1)+-1;return ho._mockTimeouts.set(r,e),r}else return setTimeout(e,t)}static _clearTimeout(e){2==0?ho._mockTimeouts.delete(e):clearTimeout(e)}static fireAllMockedTimeouts(){let e=Array.from(ho._mockTimeouts.keys());for(let t of e)ho._mockTimeouts.get(t)(),ho._mockTimeouts.delete(t)}};ho._nextMockTimeoutID=1,ho._mockTimeouts=new Map;var jc=ho;var zg=class{constructor(e,t){this.nodeId=e,this.offset=t}},kp=class{version(){return mpGlobal.version}sock(){return mpGlobal.sock!=null?new Zc(0,mpGlobal.sock):null}setSock(e){if(e!=null){let t=e.asHTMLSocket();t==null&&console.warn("Ignoring invalid socket binding for mpGlobal"),mpGlobal.sock=t.ws}else mpGlobal.sock=null}msgs(){return mpGlobal.msgs}setMsgs(e){mpGlobal.msgs=e}perfMetrics(){return mpGlobal.perfMetrics}setPerfMetrics(e){mpGlobal.perfMetrics=e}url(e){return mpGlobal.url(e)}preconnect(e){mpGlobal.preconnect(e)}newSocket(e){return new Zc(1,e)}constructor(){}},Wg=class i{static attemptToParseFrom(e){try{let t=JSON.parse(e);return new i(t.url,t.type)}catch{Le("Failed to parse TooManyConnectionsPayload")}return null}constructor(e,t){this.url=e,this.type=t}};var Yr=class Yr{constructor(e,t,r){this._onDocumentVisibilityChange=e=>{X.prototypeIFLTimeSlice()&&(e==="visible"&&this._wasBackgrounded?(this._wasBackgrounded=!1,this._flushQueueWhenAvailable=!0):e==="hidden"&&(this._wasBackgrounded=!0))};this._appState=null,this._isWindowActive=null,this._emitter=null,this._mpContext=null,this._incrementalLoader=null,this._role="viewer",this._scene=null,this._userSyncing=null,this._heartbeatTimeout=0,this._consecutiveFailedConnectionAttempts=0,this._attemptsSinceLastConnectionSuccess=0,this._hasConnectedAtLeastOnce=!1,this._onlineChangeHandler=null,this._reconnectionTimeout=0,this._isConnected=!1,this._isJoined=!1,this._shouldReconnect=!0,this._socket=null,this._url=null,this._fileKey=null,this._oauthToken=null,this._nodeId=null,this._partialSnapshotInfo=new Up(null,null,null),this._reconnectKey=null,this._previousTlfID=null,this._previousCanvasSpaceMouseLocation=null,this._sessionID=0,this._observingSessionID=-1,this._presenterSessionID=null,this._sessionsNominatingCurrentUser=new Set,this._sessionNominatedByCurrentUser=null,this._cachedNextUserChange=null,this._canvasSpaceClicks=[],this._nextCanvasSpaceClickID=0,this._pendingSceneGraphQueriesOrNull=null,this._lastSceneGraphQueryTime=0,this._lastSceneGraphQueryConcurrency=0,this._lastSentSceneGraphQueriesOrNull=null,this._observers=new zr,this._sceneLoadingPhase=0,this._connectType=0,this._sessionSchema=null,this._staticFileRequest=null,this.maxScrollPositionsToStore=10,this._recentlyChangedScrollPositions=[],this._lastFlush=-1,this._appState=e,this._isWindowActive=t,this._emitter=$t.getEventEmitter(),this._appState.addAppObserver(this),e.prototypeState().addObserver(this),e.prototypeState().addHsmObserver(this),this._appState.addFrameObserver(this),this._wasBackgrounded=!1,document.addEventListener("visibilitychange",()=>{this._onDocumentVisibilityChange(document.visibilityState)}),this._mpContext=r,this._incrementalLoader=new Na(this._appState,this),this._flushQueueWhenAvailable=!1}static hasPrefix(e,t){if(e.length>=t.length){for(let r=0,n=t.length;r<n;r=r+1)if(e[r]!=t.charCodeAt(r))return!1;return!0}return!1}onFrame(){var e,t;X.prototypeIFLTimeSlice()&&((e=this._socket)==null?void 0:e.readyState())==Yn.Socket_OPEN&&(this._flushQueueWhenAvailable?(this.flushMessageQueue(),this._flushQueueWhenAvailable=!1):(t=L())==null||t.modules().prototype.tickAsyncMultiplayerMessageHandler(this.sessionID(),Po))}flushMessageQueue(){var e;X.prototypeIFLTimeSlice()&&((e=L())==null||e.modules().prototype.flushMessageQueue(this.sessionID(),Po))}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}fileKey(){return this._fileKey}observingSessionID(){return this._observingSessionID}setObservingSessionID(e){this._observingSessionID=e,this._getOrCreateNextUserChange().observing=[e]}observedUser(){return this._userSyncing!=null?zt.IntMap_get(this._userSyncing.userBySessionID(),this._observingSessionID,null):null}isObserving(){return this.observingSessionID()!=-1}presenterSessionID(){return this._presenterSessionID}removeNominator(e){this._sessionsNominatingCurrentUser.delete(e)}sessionsNominatingCurrentUser(){return Array.from(this._sessionsNominatingCurrentUser.values())}sessionNominatedByCurrentUser(){return this._sessionNominatedByCurrentUser}setPresenterSessionID(e){this._presenterSessionID=e}scene(){return this._scene}incrementalLoader(){return this._incrementalLoader}socketForTesting(){var e;return(e=this._socket)==null?void 0:e.asMockSocket()}setMultiplayerUserSyncing(e){this._userSyncing=e}setScene(e){this._scene=e}isConnected(){return this._isConnected}fulfilledMultiplayerQueries(){return this._partialSnapshotInfo.fulfilledQueries}_setSceneLoadingPhase(e){let t=this._sceneLoadingPhase;switch(this._sceneLoadingPhase=e,t!=e&&this._observers.forEach(r=>{r.handleSceneChangedLoadingPhase(t,e)}),e){case 0:break;case 1:{console.log("sceneWillRebuildAfterReconnecting"),this._emitter.trigger("sceneWillRebuildAfterReconnecting");break}case 2:{t==0?this._appState.fontListPromise().then(()=>{console.debug("sceneDidCompleteInitialLoad"),this._emitter.trigger("sceneDidCompleteInitialLoad")}):t==1&&(console.log("sceneDidRebuildAfterReconnecting"),this._emitter.trigger("sceneDidRebuildAfterReconnecting")),this._socket!=null&&this._sendSignal("client-rendered","");break}}}setNodeLoadedStatusesAndUpdate(e){this._setCanvasLoadedStatuses(e),this._setTlfLoadedStatuses(e),this._appState.prototypeState().tryToInitiateRequestedStateChange(Ji.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED),this._appState.trySettingRequestedActiveCanvas()}_setCanvasLoadedStatuses(e){this.scene().root().forEachChild(t=>{t.type()!="CANVAS"||t.isInternalOnly()||(e==null||e.some(r=>tn.fullyLoadsNode(r,t)))&&t.setHasBeenLoaded(!0)})}_setTlfLoadedStatuses(e){var n,o,a;let t=0,r=0;Yr.VERBOSE&&(console.log("-----------_setTlfLoadedStatuses-----------"),((n=this.scene())==null?void 0:n.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(t=t+1)})})),this.scene().setTlfsLoaded(s=>e==null||e.some(l=>tn.fullyLoadsNode(l,s))),Yr.VERBOSE&&(((o=this.scene())==null?void 0:o.root())!=null&&this.scene().root().forEachChild(s=>{s.forEachChild(l=>{l.hasBeenLoaded()&&(r=r+1)})}),console.log(`\u{1F69A} numLoaded ${r-t} (${t} -> ${r})`),console.log("--------------------------------------------")),(a=L())==null||a.applyExistingVariableChangesToIFLLoadedNodes()}_finishLoadingIfNecessary(){var t;if(this._sceneLoadingPhase==2)return;this._appState.setCurrentFileKey(this._fileKey),this._appState.setScene(this._scene);let e=null;if(this._nodeId!=null){let r=this._appState.scene().findNode(this._nodeId),n=r==null?void 0:r.findContainingCanvasOrSelf();n!=null&&this._appState.setActiveCanvas(n),e=(t=this._appState.prototypeStructure())==null?void 0:t.validDestinationForPrototypeFromId(this._nodeId)}e!=null?this._appState.prototypeState().navigateToFrameAndCloseOverlays(e.id()):this._appState.prototypeState().restartPrototype(0),this._setSceneLoadingPhase(2)}finishIncrementalLoading(){this._finishLoadingIfNecessary(),this._emitter.trigger("incrementalLoadingInfo",{type:"finishIncrementalLoading",fileKey:this._fileKey})}sessionID(){return this._sessionID}role(){return this._role}setRole(e){this._role=e}currentSceneGraphQueries(){return this._pendingSceneGraphQueriesOrNull!=null?this._pendingSceneGraphQueriesOrNull:this._lastSentSceneGraphQueriesOrNull!=null?this._lastSentSceneGraphQueriesOrNull:[]}connectTo(e,t,r){this._connectTo(e,0,t,r)}attemptReconnect(){var t;if(this._scene==null||this._sceneLoadingPhase==0){this._scene!=null&&this._sceneLoadingPhase==0&&De.trackEvent("Viewer reconnected during initial load",{}),this._connectTo(this._fileKey,0,this._nodeId,this._oauthToken);return}let e=this._appState.baseScreenId()??((t=this._appState.getActiveCanvas())==null?void 0:t.id());this._connectTo(this._fileKey,1,e,this._oauthToken)}_connectTo(e,t,r,n){var g;this._attemptsSinceLastConnectionSuccess=this._attemptsSinceLastConnectionSuccess+1,De.handleMultiplayerOpenConnection(),this.disconnect(),this._fileKey=e,this._connectType=t,this._oauthToken=n,this._nodeId=r,this._staticFileRequest!=null&&(this._staticFileRequest.cancel(),this._staticFileRequest=null);let o="";switch(t){case 0:{o="initial-load",this._lastSentSceneGraphQueriesOrNull=null,this._pendingSceneGraphQueriesOrNull=null,this._partialSnapshotInfo=new Up(null,null,null),X.prototypeIFLTimeSlice()&&((g=L())==null||g.modules().prototype.clearMessageQueue());break}case 1:{o="reconnect",this._pendingSceneGraphQueriesOrNull==null&&this._lastSentSceneGraphQueriesOrNull!=null&&(this._pendingSceneGraphQueriesOrNull=this._lastSentSceneGraphQueriesOrNull,this._lastSentSceneGraphQueriesOrNull=null);break}}let a=this._mpContext.url({fileKey:e,role:this._role,oauthToken:n,connectionType:o}),s=this._partialSnapshotInfo.isValid()&&this._pendingSceneGraphQueriesOrNull!=null&&this._queriesAreEqual(this._partialSnapshotInfo.fulfilledQueries,this._pendingSceneGraphQueriesOrNull);if(this._scene!=null&&s){this._partialSnapshotInfo.snapshotHash!=null&&(a+=`&snapshot-hash=${encodeURIComponent(this._partialSnapshotInfo.snapshotHash)}`),this._partialSnapshotInfo.reconnectSequenceNumber!=null&&(a+=`&reconnect-sequence-number=${encodeURIComponent(this._partialSnapshotInfo.reconnectSequenceNumber.value.toString())}`);let _=encodeURIComponent(Er.serializeListForMultiplayerURL(this._pendingSceneGraphQueriesOrNull));a+=`&scenegraph-queries=${_}`,X.getFeatureFlags().prototype_previous_load_mode&&(a+="&previousLoadMode=incremental"),this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,0),this._pendingSceneGraphQueriesOrNull=null}this._reconnectKey!=null&&(console.log(`reconnecting with reconnect key ${this._reconnectKey}`),a+=`&reconnect-key=${encodeURIComponent(this._reconnectKey)}`),this._url=a,console.debug(`attempting to connect to ${a}`);let l=this._mpContext.sock(),c=this._mpContext.msgs();if(l!=null&&l.url()==a&&(l.readyState()==Yn.Socket_CONNECTING||l.readyState()==Yn.Socket_OPEN))console.debug(`Applied the preconnect optimization for URL ${a}`),this._mpContext.setSock(null),this._mpContext.setMsgs([]),this._mpContext.setPerfMetrics([]);else{if(l!=null){console.warn(`Preconnect URL ${l.url()} doesn't match URL ${a}, skipping preconnect optimization`);try{l.close()}catch{}}l=this._mpContext.newSocket(a),l.setBinaryType("arraybuffer"),c=[]}let d=()=>this._socket==null?l==null:this._socket.equals(l),h=!0,u=null;l.setOnopen(_=>{if(!d()){console.warn("ignoring 'open' event on old socket");return}this._consecutiveFailedConnectionAttempts=0,u()}),u=()=>{this._isConnected=!0,console.debug(`connected to ${this._url}`),De.handleMultiplayerSocketConnectionAttempt(!0,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this._hasConnectedAtLeastOnce=!0,this._attemptsSinceLastConnectionSuccess=0,this._observers.forEach(_=>{_.handleConnect(t,r)})};let m=null;l.setOnmessage(_=>{if(!d()){console.warn("ignoring 'message' event on old socket");return}if(!_.isArrayBuffer()){console.warn("ignoring 'message' event without an ArrayBuffer payload");return}let f=new Uint8Array(_.dataAsArrayBuffer());m(f)}),m=_=>{let f=L();if(h){if(h=!1,!f.modules().prototype.handleServerSchema(_)){this.disconnect();return}this._sendSignal("feature-flags",JSON.stringify(X.getFeatureFlags()))}else f.modules().prototype.handleCompressedMultiplayerMessage(_,this.sessionID(),Po)},l.setOnclose(_=>{if(!d()){console.warn("ignoring 'close' event on old socket");return}if(this._isConnected?De.handleMultiplayerSocketDisconnected(this._isWindowActive()):De.handleMultiplayerSocketConnectionAttempt(!1,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this.disconnect(),!this._shouldReconnect){console.warn("File too busy, not reconnecting");return}let f=null,S=()=>{clearTimeout(this._reconnectionTimeout),this._onlineChangeHandler!=null&&(Jt.EventTarget_removeEventListener1(window,"online",this._onlineChangeHandler),this._onlineChangeHandler=null),this._isWindowActive()?this.attemptReconnect():f()};f=()=>{let b=Math.min(Yr.RECONNECTION_DELAY_MAX,Yr.RECONNECTION_DELAY_MIN*Math.pow(2,this._consecutiveFailedConnectionAttempts)),T=Yr.RECONNECTION_DELAY_MIN+(b-Yr.RECONNECTION_DELAY_MIN)*Math.random();console.debug(`attempting to reconnect to ${this._url} in ${T}s`),this._reconnectionTimeout=setTimeout(S,T*1e3|0),this._onlineChangeHandler=()=>{console.log("attempting to reconnect due to connectivity change"),navigator.onLine&&(this._consecutiveFailedConnectionAttempts=0,S())},Jt.EventTarget_addEventListener1(window,"online",this._onlineChangeHandler)},f(),this._consecutiveFailedConnectionAttempts=this._consecutiveFailedConnectionAttempts+1}),this._socket=l,l.readyState()==Yn.Socket_OPEN&&u(),c.forEach(m)}_decodeConcatenatedUncompressedMessages(e,t){let r=new this._sessionSchema.ByteBuffer(e);for(;r.length!==r._index;){let n=null;try{n=this._sessionSchema.decodeMessage(r)}catch(o){console.error(`decoding failed: '${o.message}'`);return}Yr.VERBOSE&&console.log(`got message of type '${n.type}'`),t(n)}}handleUncompressedMessage(e,t){this._decodeConcatenatedUncompressedMessages(e,r=>{switch(r.type){case"JOIN_START":case"JOIN_START_SKIP_RELOAD":{this._handleJoinStartOrJoinStartSkipReload(r,this._connectType);break}case"JOIN_END":{this._handleJoinEnd();break}case"SCENE_GRAPH_REPLY":{this._handleSceneGraphReply(r);break}case"NODE_CHANGES":throw new Error("handleUncompressedMessage cannot handle a NODE_CHANGES payload. Did you mean to process this message in C++ and call PrototypeApp::didReceiveNodeChanges instead?");case"USER_CHANGES":{this._userSyncing!=null&&this._userSyncing.handleUserChanges(r,this);break}case"SIGNAL":{this._handleSignal(r);break}case"NOTIFY_SHOULD_UPGRADE":{this._handleNotifyShouldUpgrade();break}case"CLIENT_BROADCAST":{this._handleClientBroadcast(r);break}}})}handleUncompressedSchema(e){try{this._sessionSchema=Gp.compileSchema(Gp.decodeBinarySchema(e))}catch(t){return console.error(`schema decoding failed: '${t.message}'; uncompressedBytes is ${e.length}`),!1}return!0}didReceiveNodeChanges(e,t){if(this._scene==null){console.warn("ignoring 'NODE_CHANGES' event without a scene");return}this._emitter.trigger("incrementalLoadingInfo",{type:"receiveNodeChanges",size:e}),this._partialSnapshotInfo.snapshotHash=null,t!==null&&t!=null&&(this._partialSnapshotInfo.reconnectSequenceNumber=new fe(t)),this._observers.forEach(r=>{r.handleNodeChanges()}),X.getFeatureFlags().prototype_ifl_join_protocol_fix&&!Po||this._isJoined||(console.debug("server sent the full document (vs. incrementally loading)"),this.setNodeLoadedStatusesAndUpdate(null),this._finishLoadingIfNecessary())}getSceneLoadingPhase(){return this._sceneLoadingPhase}_handleJoinStartOrJoinStartSkipReload(e,t){let r=0;if(e.type=="JOIN_START"?r=0:(r=1,console.debug("performing fast reconnect to skip scene reload")),t==0?this._setSceneLoadingPhase(0):t==1&&r!=1&&this._setSceneLoadingPhase(1),this._sessionID=e.sessionID,r!=1){e.fileVersion||Le("Viewer received JOIN_START message without a file version");let n=_t.createScene(this._sessionID,e.fileVersion||null);this.setScene(n),n.setFileKey(this.fileKey()),this._appState.setScene(null)}else this._sendSignal("client-rendered","");this._observers.forEach(n=>{n.handleJoinStart(r,e.sessionID,e.fileVersion)})}_handleJoinEnd(){this._isJoined=!0,this._enableHeartbeatTimer(),this._cachedNextUserChange!=null&&(this._getOrCreateNextUserChange().recentClicks=[]),this._pendingSceneGraphQueriesOrNull!=null&&(this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,1),this._pendingSceneGraphQueriesOrNull=null),this._observers.forEach(e=>{e.handleJoinEnd()}),this.handleStateChangeInitiated(new Ur(0,yt.ROOT_STABLE_PATH()))}_handleSceneGraphReply(e){this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency-1,Cr.increment("[IFL] sceneGraphQueriesReceived",1),Cr.trackNumber("[IFL] Total Loaded Nodes",e.sceneGraphQueries.length),this._emitter.trigger("incrementalLoadingInfo",{type:"receiveSceneGraphReply",queries:e.sceneGraphQueries.map(t=>tn.toString(t))}),this._partialSnapshotInfo.fulfilledQueries=e.sceneGraphQueries,this.setNodeLoadedStatusesAndUpdate(e.sceneGraphQueries),this._observers.forEach(t=>{t.handleSceneGraphReply(this._lastSceneGraphQueryConcurrency,e.sceneGraphQueries)}),this.handleStateChangeInitiated(new Ur(0,yt.ROOT_STABLE_PATH()))}_handleSignal(e){if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="invalid-permissions"){console.warn("received 'invalid-permissions' message."),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="client-too-old"){console.warn("received 'client-too-old' message. refreshing!"),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="snapshot-hash"&&(this._partialSnapshotInfo.snapshotHash=e.signalPayload),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-sequence-number"&&(this._partialSnapshotInfo.reconnectSequenceNumber=new fe(parseInt(e.signalPayload))),e.signalName!==void 0&&e.signalName=="reconnect-immediately"&&(console.log("received 'reconnect-immediately' signal. reconnecting."),this.attemptReconnect()),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-key"&&(this._reconnectKey=e.signalPayload,console.debug(`server sent reconnect key ${this._reconnectKey}`)),e.signalName!==void 0&&e.signalName=="too-many-connections"){let t=Wg.attemptToParseFrom(e.signalPayload!==void 0?e.signalPayload:"");t!=null&&(this._staticFileRequest=new Zn(t.url).format(1),this._staticFileRequest.get().then(r=>{this._observers.forEach(n=>{n.handleJoinStart(0,-1,-1)}),this._appState.serialization().decodeSceneForViewerAndPrototypeLib1(r.bytes).then(n=>{n!=null?(this._scene=n,this.setNodeLoadedStatusesAndUpdate(null),this._observers.forEach(o=>{o.handleJoinEnd()}),this._finishLoadingIfNecessary()):Le("Failed to parse scene")})})),console.warn("too many connections to multiplayer or example file, not reconnecting"),this._shouldReconnect=!1}}_handleNotifyShouldUpgrade(){console.warn("received NOTIFY_SHOULD_UPGRADE message. refreshing!"),location.reload()}_handleClientBroadcast(e){for(let t of e.broadcasts)t.prototypePresenter!=null&&(t.prototypePresenter.nomination!=null?this.updateNominatedPresenter(t.prototypePresenter.nomination,t.sessionID):(this.setPresenterSessionID(new fe(t.prototypePresenter.sessionID)),this._presenterSessionID!=null&&(this._sessionsNominatingCurrentUser.clear(),this._sessionNominatedByCurrentUser=null)));this._observers.forEach(t=>{t.handlePresenterChange()})}updateNominatedPresenter(e,t){e.isCancelled?(e.sessionID==this._sessionID&&(t==this._sessionID?this._sessionsNominatingCurrentUser.clear():this._sessionsNominatingCurrentUser.delete(t)),this._sessionNominatedByCurrentUser!=null&&this._sessionNominatedByCurrentUser.value==e.sessionID&&(this._sessionNominatedByCurrentUser=null)):(e.sessionID==this._sessionID&&this._sessionsNominatingCurrentUser.add(t),t==this._sessionID&&(this._sessionNominatedByCurrentUser=new fe(e.sessionID)))}disconnect(){if(this._isJoined=!1,this._socket!=null){try{this._socket.close()}catch{}this._socket=null,X.prototypeIFLTimeSlice()&&(this._flushQueueWhenAvailable=!0)}this._lastSceneGraphQueryConcurrency=0,clearTimeout(this._heartbeatTimeout),clearTimeout(this._reconnectionTimeout),this._isConnected&&(console.debug(`disconnected from ${this._url}`),this._isConnected=!1,this._observers.forEach(e=>{e.handleDisconnect()}))}_enableHeartbeatTimer(){if(2==0)return;let e=null,t=()=>{var r;if(this._isWindowActive()&&((r=this._socket)==null?void 0:r.readyState())==Yn.Socket_OPEN){console.debug("sending heartbeat message");let n={};n.type="USER_CHANGES",n.userChanges=[],this._sendMessage(n)}e()};e=()=>{this._heartbeatTimeout=setTimeout(t,Yr.HEARTBEAT_DELAY)},e()}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==98&&nt.asString(e.newVal)=="CREATED"&&this._partialSnapshotInfo.fulfilledQueries!=null&&this._partialSnapshotInfo.fulfilledQueries.some(t=>tn.fullyLoadsNode(t,e.node))&&e.node.setHasBeenLoaded(!0)}handleStateUpdate(e,t){this.pushAllInstanceStateChanges()}handleStateChangeAborted(e){e!=null&&(this.handleStateUpdate(e,"ABORTED"),this.handlePresentedStateChange(null,e.oldStateAndOverlays,null))}handleStateChangeCommitted(e,t){this.handleStateUpdate(e,"COMMITTED")}handleStateChangeInitiated(e){if(e==null||e.oldStateAndOverlays.stateId==null&&e.newStateAndOverlays.stateId==null)return;this.handleStateUpdate(e,"INITIATED");let t=this._getSynchronizableHotspotId_instanceHACK(e.interactionAddress.hotspotStablePath);this.handlePresentedStateChange(t,e.newStateAndOverlays,e.interactionAddress.interactionId)}handleStateChangeRequested(e){}_pushInstanceStateChange(e,t,r){let n=It.encodeInstanceStateChange(t,r);n.hotspotStablePath==null&&(n.hotspotStablePath=It.encodeGUIDPath(e)),this._getOrCreateNextUserChange().instanceStateChanges==null&&(this._getOrCreateNextUserChange().instanceStateChanges=[]),this._getOrCreateNextUserChange().instanceStateChanges.push(n)}handleHsmAborted(e,t){this._pushInstanceStateChange(e,t,"ABORTED")}handleHsmCommitted(e,t,r){this._pushInstanceStateChange(e,t,"COMMITTED")}handleHsmInitiated(e,t){this._pushInstanceStateChange(e,t,"INITIATED")}handleHsmRequested(e,t){}pushAllInstanceStateChanges(){let e=this._appState.prototypeState();e.getOnscreenStates().forEach(t=>{let r=e.getStateMachineLastChangeInHistory(t.a);this._pushInstanceStateChange(t.a,r,"INITIATED"),this._pushInstanceStateChange(t.a,r,"COMMITTED")})}onTransitionFrame(e){this._getOrCreateNextUserChange()}_getSynchronizableHotspotId_instanceHACK(e){var r,n;return(n=(r=this._appState.scene())==null?void 0:r.findNodeByStablePath(e))==null?void 0:n.id()}_createTriggeredOverlaysDataForMultiplayer(e,t){let r=[];return t.overlays.forEach(n=>{let o=this._getSynchronizableHotspotId_instanceHACK(n.openingHotspotStablePath);r.push(It.encodeOverlayData(n,o))}),r}_updateNextUserChangeForOverlay(e,t){this.observedUser()==null&&(this._getOrCreateNextUserChange().triggeredOverlaysData=this._createTriggeredOverlaysDataForMultiplayer(e,t))}handleVideoStateChange(e){this._getOrCreateNextUserChange().videoStateChangeData=e}pushAllVideoStateChanges(){this._getOrCreateNextUserChange().videoStateChangeData=this._appState.prototypeState().getVideoStateChanges()}handlePresentedStateChange(e,t,r){let n=this._previousTlfID,o=this._appState.baseScreenId();J.equals(n,o)||(this._previousTlfID=o,this._getOrCreateNextUserChange().selection=[],o!=null&&this._getOrCreateNextUserChange().selection.push(J.toFigGUID(o))),e!=null&&(this._getOrCreateNextUserChange().lastTriggeredHotspot=It.encodeGUID(e)),r!=null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=It.encodeGUID(r)),this._updateNextUserChangeForOverlay(e,t)}pushAllSetVariableActions(){this.handleSetVariableAction(this._appState.prototypeState()._setVariableActionHistory)}handleSetVariableAction(e){this._getOrCreateNextUserChange().triggeredSetVariableActionData=e}pushAllSetVariableModeActions(){this.handleSetVariableModeAction(this._appState.prototypeState()._setVariableModeActionHistory)}handleSetVariableModeAction(e){this._getOrCreateNextUserChange().triggeredSetVariableModeActionData=e}handleFitModeChange(e,t){}handleRestartPrototype(){}_getOrCreateNextUserChange(){return this._cachedNextUserChange==null&&(this._cachedNextUserChange={},this._cachedNextUserChange.sessionID=this._sessionID,this._cachedNextUserChange.instanceStateChanges=null),this._cachedNextUserChange}getParticles(){var e;return(e=this.observedUser())==null?void 0:e.remainingParticles()}getMouse(){var e;return(e=this.observedUser())==null?void 0:e.canvasSpaceMouse}getScrollPositions(){var e;return(e=this.observedUser())==null?void 0:e.scrollPositions}setCanvasSpaceMouse(e){let t=this._previousCanvasSpaceMouseLocation;if(e==null&&t==null||e!=null&&t!=null&&e.equals(t))return;this._previousCanvasSpaceMouseLocation=e==null?void 0:e.clone();let r={};e!=null?(r.x=e.x(),r.y=e.y()):(r.x=NaN,r.y=NaN);let n={};n.canvasSpaceLocation=r,n.cursor="DEFAULT",this._getOrCreateNextUserChange().mouse=n}recordCanvasSpaceClick(e){for(;this._canvasSpaceClicks.length>10;)this._canvasSpaceClicks.shift();let t={};t.x=e.x(),t.y=e.y();let r={};r.id=this._nextCanvasSpaceClickID=this._nextCanvasSpaceClickID+1,r.point=t,this._canvasSpaceClicks.push(r),this._getOrCreateNextUserChange().recentClicks=this._canvasSpaceClicks.slice()}setScrollPosition(e,t){for(ce.List_removeIf(this._recentlyChangedScrollPositions,r=>r.nodeId==e);this._recentlyChangedScrollPositions.length>this.maxScrollPositionsToStore;)this._recentlyChangedScrollPositions.shift();this._recentlyChangedScrollPositions.push(new zg(e,t)),this._getOrCreateNextUserChange().scrollPositions=this._recentlyChangedScrollPositions.map(r=>{let n={};return n.node=It.encodeGUID(J.fromString(r.nodeId)),n.scrollOffset=It.encodeVector2(r.offset),n})}maybeFlushNextUserChange(e){let t=We.seconds();(this._lastFlush==-1||t-this._lastFlush>Yr.FLUSH_INTERVAL_SEC||e==1)&&(this._flushNextUserChange(),this._lastFlush=t)}_flushNextUserChange(){if(this._isJoined&&this._cachedNextUserChange!=null){let e={};e.type="USER_CHANGES",e.userChanges=[this._cachedNextUserChange],Yr.debugUserChanges&&console.log("flushNextUserChange",this._cachedNextUserChange),this._sendMessage(e),this._cachedNextUserChange=null}}_queriesAreEqual(e,t){let r=new Map;for(let o of e)r.set(tn.hash(o),!0);let n=new Map;for(let o of t)n.set(tn.hash(o),!0);if(r.size!=n.size)return!1;for(let o of Array.from(r.keys()))if(!n.has(o))return!1;return!0}setSceneGraphQueries(e){this._queriesAreEqual(e,this.currentSceneGraphQueries())||(this._isJoined?this._sendSceneGraphQueries(e,1):this._pendingSceneGraphQueriesOrNull=e)}_sendSceneGraphQueries(e,t){if(this._lastSceneGraphQueryConcurrency==0&&(this._lastSceneGraphQueryTime=We.milliseconds()),this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency+1,e.length>0&&(this._lastSentSceneGraphQueriesOrNull=e,t==1)){let r={};r.type="SCENE_GRAPH_QUERY",r.sceneGraphQueries=e,Cr.increment("[IFL] sceneGraphQueriesSent",1),this._emitter.trigger("incrementalLoadingInfo",{type:"sendSceneGraphQuery",queries:r.sceneGraphQueries.map(n=>tn.toString(n))}),this._sendMessage(r)}}_sendSignal(e,t){let r={};r.type="SIGNAL",r.signalName=e,r.signalPayload=t,this._sendMessage(r)}nominatePresenter(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!1);this._sendClientBroadcast(t)}cancelPresenterNomination(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!0);this._sendClientBroadcast(t)}presenterClientBroadcastMessageWithNomination(e,t){let r={};r.type="CLIENT_BROADCAST";let n={};n.sessionID=this._sessionID;let o={},a={};return this._presenterSessionID!=null&&(o.sessionID=this._presenterSessionID.value),a.sessionID=e,a.isCancelled=t,o.nomination=a,n.prototypePresenter=o,r.broadcasts=[n],r}startPresenting(){let e=this.presenterClientBroadcastMessage(!0);this._sendClientBroadcast(e)}stopPresenting(){let e=this.presenterClientBroadcastMessage(!1);this._sendClientBroadcast(e)}setInteractiveSlideConfigData(e,t,r){if(t!="resultsShown"){console.error(`Could not set configData for ${e} to ${t}:${r}. Only allowed to set resultsShown from the viewer.`);return}let n={};n.type="NODE_CHANGES";let o={entries:[{key:t,value:r}]},a={guid:J.toFigGUID(e),interactiveSlideConfigData:o};n.nodeChanges=[a],this._sendClientBroadcast(n)}setInteractiveSlideParticipantData(e,t,r){let n={};n.type="INTERACTIVE_SLIDE_CHANGE";let o={anonymousUserID:t,nodeID:J.toFigGUID(e),responseData:r};n.interactiveSlideElementChange=o,this._sendClientBroadcast(n)}presenterClientBroadcastMessage(e){let t={};t.type="CLIENT_BROADCAST";let r={},n={};return e&&(n.sessionID=this._sessionID),r.prototypePresenter=n,t.broadcasts=[r],t}_sendClientBroadcast(e){this._socket!=null&&this._sendMessage(e)}_sendMessage(e){X.getFeatureFlags().prototype_log_all_ws&&console.log(e),this._socket.send2(jo.deflateRaw(ke().encodeMessage(e)))}};Yr.debugUserChanges=!1,Yr.VERBOSE=!1,Yr.SCHEMA_PREFIX="fig-wire\0\0\0",Yr.SCHEMA_PREFIX_BYTES=new Uint8Array([102,105,103,45,119,105,114,101,1,0,0,0]),Yr.RECONNECTION_DELAY_MIN=1,Yr.RECONNECTION_DELAY_MAX=128,Yr.FLUSH_INTERVAL_SEC=1/30,Yr.HEARTBEAT_DELAY=60*1e3;var Ni=Yr;var Up=class{constructor(e,t,r){this.snapshotHash=null,this.reconnectSequenceNumber=null,this.fulfilledQueries=null,this.snapshotHash=e,this.reconnectSequenceNumber=t,this.fulfilledQueries=r}isValid(){return(this.snapshotHash!=null||this.reconnectSequenceNumber!=null)&&this.fulfilledQueries!=null}};var Er;(r=>{function i(n,o){let a={};return a.startingNode=J.toFigGUID(n),a.depth=o,a}r.create=i;function e(n){if(n==null)return"";let o="";for(let a of n)o+=tn.serializeForMultiplayerURL(a),o+=",";return o.slice(0,o.length-1)}r.serializeListForMultiplayerURL=e;function t(n){return n.startingNode.localID==0&&n.startingNode.sessionID==0&&n.depth==0}r.isUnlimitedRootQuery=t})(Er||(Er={}));var $c=class $c{age(){return lr.Math_clamp((We.seconds()-this.startTimestamp)/$c.LIFETIME,0,1)}constructor(e,t,r){this.sessionID=e,this.canvasSpaceLocation=t,this.startTimestamp=r}};$c.LIFETIME=.25,$c.RADIUS=25;var Sl=$c,Qg=class{remainingParticles(){let e=We.seconds(),t=null;return this.particles!=null&&ce.List_removeIf(this.particles,r=>e-r.startTimestamp>Sl.LIFETIME?!0:(t==null&&(t=[]),t.push(r),!1)),t}toJSON(){return{sessionID:this.sessionID,userID:this.userID,name:this.name,color:this.color!=C.TRANSPARENT?C.toCSS(this.color):null,imageURL:this.imageURL,deviceName:this.deviceName,currentFrame:this.currentFrame!=null?this.currentFrame:null}}constructor(e){this.sessionID=e,this.userID=null,this.name=null,this.color=C.TRANSPARENT,this.imageURL=null,this.deviceName=null,this.currentFrame=null,this.canvasSpaceMouse=null,this.largestClickID=-1,this.particles=null,this.scrollPositions=new Map,this.observedSessions=[],this.lastTriggeredHotspot=null,this.lastTriggeredPrototypeInteractionID=null,this.triggeredOverlaysData=[],this.instanceStateChanges=[],this.triggeredSetVariableActionData=[],this.triggeredSetVariableModeActionData=[],this.videoStateChangeData=[]}},ed=class{userBySessionID(){return this._userBySessionID}handleUserChanges(e,t){if(e.userChanges===void 0){console.error("decoded node change message with missing required field: 'userChanges'");return}let r=!1,n=0;for(let o of e.userChanges){if(o.sessionID===void 0){Le("skipping user change message without sessionID");continue}n=o.sessionID;let a=Ni.debugUserChanges&&t!=null&&n!=t.sessionID();o.connected!==void 0&&(o.connected?(this._userBySessionID.set(n,new Qg(n)),a&&console.log(`user sessionID ${n} connected`,this._userBySessionID.get(n).toJSON()),t!=null&&(t.pushAllInstanceStateChanges(),t.pushAllSetVariableActions(),t.pushAllSetVariableModeActions(),t.pushAllVideoStateChanges())):(a&&this._userBySessionID.has(n)&&console.log(`user sessionID ${n} disconnected`,this._userBySessionID.get(n).toJSON()),t!=null&&t.removeNominator(n),this._userBySessionID.delete(n)),r=!0);let s=zt.IntMap_get(this._userBySessionID,n,null);s!=null?(r=this._applyChangeToUser(o,s,a)||r,this._applyNullChecksToUserStrings(s)):a&&Le("could not find existing user to apply user change message"),a&&console.log("recvUserChange",o,r)}r&&this.onChange!=null&&this.onChange(n)}_applyNullChecksToUserStrings(e){e.userID==null&&(e.userID=""),e.name==null&&(e.name=""),e.imageURL==null&&(e.imageURL="")}_applyChangeToUser(e,t,r){let n=!1,o=e.sessionID;if(e.color!==void 0&&(t.color=It.decodeColor(e.color),n=!0),e.name!==void 0&&(t.name=e.name,n=!0),e.deviceName!==void 0&&(t.deviceName=e.deviceName,n=!0),e.imageURL!==void 0&&(t.imageURL=e.imageURL,n=!0),e.userID!==void 0&&(t.userID=e.userID,n=!0),e.observing!==void 0&&(t.observedSessions=e.observing,n=!0),e.selection!==void 0){let a=e.selection;t.currentFrame=a.length==1?It.decodeGUID(a[0]):null,n=!0}if(e.mouse!==void 0){let a=e.mouse;if(a.canvasSpaceLocation!==void 0){let s=It.decodeVector(a.canvasSpaceLocation);(t.canvasSpaceMouse==null||!t.canvasSpaceMouse.equals(s))&&(t.canvasSpaceMouse=s.equals(s)?s:null,this.onMouseCursorChange!=null&&this.onMouseCursorChange(o))}}if(e.recentClicks!==void 0)if(t.particles==null){t.particles=[];for(let a of e.recentClicks)a.id>t.largestClickID&&(t.largestClickID=a.id)}else for(let a of e.recentClicks)a.id>t.largestClickID&&(t.largestClickID=a.id,t.particles.push(new Sl(o,It.decodeVector(a.point),We.seconds())),this.onMouseCursorChange!=null&&this.onMouseCursorChange(o));if(e.scrollPositions!==void 0)for(let a of e.scrollPositions)t.scrollPositions.set(It.decodeGUID_instanceHACK(a.node),It.decodeVector(a.scrollOffset));return e.lastTriggeredHotspot!==void 0&&(t.lastTriggeredHotspot=It.decodeGUID_instanceHACK(e.lastTriggeredHotspot),n=!0),e.lastTriggeredPrototypeInteractionID!==void 0&&(t.lastTriggeredPrototypeInteractionID=It.decodeGUID(e.lastTriggeredPrototypeInteractionID),n=!0),e.triggeredOverlaysData!==void 0&&(t.triggeredOverlaysData=e.triggeredOverlaysData.slice(),n=!0),e.instanceStateChanges!==void 0&&(e.instanceStateChanges.forEach(a=>{t.instanceStateChanges.push(a)}),n=!0),e.triggeredSetVariableActionData!==void 0&&(t.triggeredSetVariableActionData=e.triggeredSetVariableActionData.slice(),n=!0),e.triggeredSetVariableModeActionData!==void 0&&(t.triggeredSetVariableModeActionData=e.triggeredSetVariableModeActionData.slice(),n=!0),e.videoStateChangeData!==void 0&&(t.videoStateChangeData=e.videoStateChangeData.slice(),n=!0),r&&console.log("_applyChangeToUser",e,t.toJSON()),n}constructor(){this._sessionID=-1,this._userBySessionID=new Map,this.onChange=null,this.onMouseCursorChange=null}};var us;(a=>{function i(){let s=null;try{s=localStorage}catch{return 1}let l=+s.getItem("cursorScaleFactor");return l||1}a._globalCursorScaleFactor=i;function e(s,l,c,d,h,u){let m=V.new2(),g=V.new2(),_=c.clone(),f=1/l;if(X.isInlinePreview()&&_.expand1(3),g.copyFrom(d),g.expand1(f),g.left()<_.left()&&s.fillRect(m.setTo1(g.left(),g.top(),_.left()-g.left(),g.height()),h),_.right()<g.right()&&s.fillRect(m.setTo1(_.right(),g.top(),g.right()-_.right(),g.height()),h),g.top()<_.top()&&s.fillRect(m.setTo1(_.left()-f,g.top(),_.width()+2*f,_.top()-g.top()),h),_.bottom()<g.bottom()&&s.fillRect(m.setTo1(_.left()-f,_.bottom(),_.width()+2*f,g.bottom()-_.bottom()),h),u>0){_.expand1(f);let S=u*Math.cos(Math.PI/4);s.fillConvexPolygon([_.topLeft(),_.topLeft().add1(new R(S,0)),_.topLeft().add1(new R(0,S))],h),s.fillConvexPolygon([_.topRight(),_.topRight().add1(new R(0,S)),_.topRight().add1(new R(-S,0))],h),s.fillConvexPolygon([_.bottomRight(),_.bottomRight().add1(new R(-S,0)),_.bottomRight().add1(new R(0,-S))],h),s.fillConvexPolygon([_.bottomLeft(),_.bottomLeft().add1(new R(0,-S)),_.bottomLeft().add1(new R(S,0))],h)}}a.drawPreviewStencil=e;function t(s,l,c,d){for(let h of l){let u=R.new3(h.canvasSpaceLocation);if(!d.contains2(u))continue;let m=[],g=h.age(),_=g*Sl.RADIUS,f=Math.max(8,(_|0)*2);for(let S=0;S<f;S=S+1){let b=Math.PI*2*S/f;m.push(new R(u.x()+Math.cos(b)*_*c,u.y()+Math.sin(b)*_*c))}s.fillConvexPolygon(m,C.new3(.9,.9,.9,.5*(1-g)))}}a.drawParticles=t;function r(s,l,c){let d=l.x(),h=l.y(),u=i()/c,m=[],g=[];for(let T of a.cursorOutlineOuter)m.push(R.new2());for(let T of a.cursorOutlineInner)g.push(R.new2());let _=2,f=.5,S=(_+1)*(_+1)*(_+1)*(_+1),b=f/S;for(let T=-_,y=_+1;T<y;T=T+1)for(let I=-_,p=_+1;I<p;I=I+1){let v=(_+1-Math.abs(T))*(_+1-Math.abs(I))*b;if(!(v<1/255)){for(let E=0,D=a.cursorOutlineOuter.length;E<D;E=E+1){let G=a.cursorOutlineOuter[E],U=m[E];U.setX(d+(G.x()+T)*u),U.setY(h+(G.y()+I+1)*u)}s.fillConvexPolygon(m,C.new3(0,0,0,v))}}for(let T=0,y=a.cursorOutlineOuter.length;T<y;T=T+1){let I=a.cursorOutlineOuter[T],p=m[T];p.setX(d+I.x()*u),p.setY(h+I.y()*u)}s.fillConvexPolygon(m,C.WHITE);for(let T=0,y=a.cursorOutlineInner.length;T<y;T=T+1){let I=a.cursorOutlineInner[T],p=g[T];p.setX(d+I.x()*u),p.setY(h+I.y()*u)}s.fillConvexPolygon(g,C.BLACK)}a.drawMouseCursor=r,a.cursorOutlineOuter=[new R(14.933,9.027),new R(7.755,10.975),new R(3.57,17.299),new R(0,0)],a.cursorOutlineInner=[new R(12.416,8.674),new R(7.13,10.109),new R(4.063,14.742),new R(1.442,2.04)]})(us||(us={}));var Kg=class{constructor(e,t){this.tree=null,this.bounds=null,this.hash=0,this.tree=e,this.bounds=t;let r=new no;r.hash1(t.x()),r.hash1(t.y()),r.hash1(t.width()),r.hash1(t.height()),this.hash=r.value(),X.compositeTileGridEqualWithinBounds()?this._equalsImpl=(n,o)=>n.bounds.equals(o.bounds)?(Lt.didEncounterCTGEqualWithinBounds(),n.tree.equalsWithinBounds(o.tree,n.bounds)):!1:this._equalsImpl=(n,o)=>n.bounds.equals(o.bounds)?(Lt.didEncounterCTGEqualWithinBounds(),n.tree.equals(o.tree)):!1}equals(e){return this._equalsImpl(this,e)}},td=class{constructor(e,t){this._tileAtlas=null,this._keyToTileHandle=null,this._keyToNeededImages=null,this._tileHandleToKey=null,this._resetMaps();let r=(n,o)=>{o.isValid=!1;let a=He.StringMap_get(this._tileHandleToKey,n,null);a!=null&&(this._tileHandleToKey.delete(n),this._keyToTileHandle.remove(a),this._keyToNeededImages.remove(a))};this._tileAtlas=new or(e,r)}_resetMaps(){this._keyToTileHandle=new fi(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._keyToNeededImages=new fi(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._tileHandleToKey=new Map}_allocateTileHandle(e){let t=this._tileAtlas.allocateTile();return this._tileHandleToKey.set(t,e),this._keyToTileHandle.set(e,t),t}getOrInsertOrNull(e,t){let r=new pn(yr.solidColorRect(t,C.BLACK,1),e).optimized();if(r==null)return null;let n=new Kg(r,t),o=new cu(n,this);return o.tileHandleOrNull=this._keyToTileHandle.get(n,null),o.neededImagesOrNull=this._keyToNeededImages.get(n,null),o}setNeededImagesForTile(e,t){this._keyToNeededImages.set(e.key,t),e.neededImagesOrNull=t}maximumCapacity(){return this._tileAtlas.maximumCapacity()}tilesPerAtlasTexture(){return this._tileAtlas.tilesPerTexture()}prepareForNewFrame(){this._tileAtlas.prepareForNewFrame()}totalVRAM(){return this._tileAtlas.totalVRAM()}hasRenderedContent(e){return e.tileHandleOrNull!=null&&this._tileAtlas.tileIsStillValid(e.tileHandleOrNull)}prepareToRenderTo(e,t){return this.hasRenderedContent(e)||(e.tileHandleOrNull=this._allocateTileHandle(e.key)),this._tileAtlas.viewportForTile(e.tileHandleOrNull,t),this._tileAtlas.framebufferForTile(e.tileHandleOrNull)}textureRegionOrNull(e){if(!this.hasRenderedContent(e))return null;let t=V.new2();this._tileAtlas.viewportForTile(e.tileHandleOrNull,t);let r=this._tileAtlas.framebufferForTile(e.tileHandleOrNull).colorTexture();return new O.TextureRegion(r,t.scaledBy1(1/r.width()))}devalueTile(e){this._tileAtlas.devalueTile(e.tileHandleOrNull)}clear(){this._tileAtlas.clearCache(),this._resetMaps()}};var Jo=class Jo{constructor(e,t,r){this._context=null,this._compositeTileCache=null,this._renderer=null,this._boundsCache=Ai._new(),this._backbuffer=null,this._prepareForEfficientCompositingMemoized=null,this._context=e,this._compositeTileCache=t,this._renderer=r,this._prepareForEfficientCompositingMemoized=kg(n=>{let o=this._prepareForEfficientCompositing(n);return Jo._VERBOSE_LOGS&&(console.log("Before Preparation for Rasterization"),console.log("--------------"),console.log(n.debugString1()),console.log(""),console.log("After Preparation for Rasterization"),console.log("--------------"),console.log(o.debugString1())),o})}beginFrameAndCreateBudget(){this._compositeTileCache.prepareForNewFrame(),Ai.clear(this._boundsCache),this._context.resetNumFramebufferSwitches();let e=this._compositeTileCache.maximumCapacity();return e>=1e3&&(Jo._alreadyLoggedTooManyTiles||(De.trackEvent("viewer_prototype_too_many_tiles",{numTiles:e}),Jo._alreadyLoggedTooManyTiles=!0)),new Jo.FrameBudget(this._context,Jo.FrameBudget.defaultTimeBudgetInSeconds,Jo.FrameBudget.defaultTileRenderingBudget,e,Jo.FrameBudget.defaultFramebufferSwitchBudget)}prepareForEfficientCompositing(e){return this._prepareForEfficientCompositingMemoized(e)}_prepareForEfficientCompositing(e){if(e!=null&&e.isAxisAlignedRectFill()){let t=e;if(Ce.onlySolidPaintOrNull(t.geometry.paints)!=null)return e}if(e.canCacheRasterized())return new du(e,this._compositeTileCache);switch(e.op()){case 0:{let t=e;return new la(this._prepareForEfficientCompositing(t.child),t.flags)}case 2:{let t=e;return new Ho(this._prepareForEfficientCompositing(t.child))}case 1:{let t=e,r=[],n=[];for(let o of t.children)if(o.canCacheRasterized())n.push(o);else{if(n.length!=0){let a=Xe.wrap(n);r.push(this._prepareForEfficientCompositing(a)),n=[]}r.push(this._prepareForEfficientCompositing(o))}if(n.length!=0){let o=Xe.wrap(n);r.push(this._prepareForEfficientCompositing(o))}return Xe.wrap(r)}case 5:{let t=e;return new pn(this._prepareForEfficientCompositing(t.alpha),this._prepareForEfficientCompositing(t.color),t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return t.radius>=1?t:new zn(t.radius,this._prepareForEfficientCompositing(t.child),t.clamp)}case 7:{let t=e;return new Wn(t.blendMode,t.opacity,this._prepareForEfficientCompositing(t.child))}case 9:{let t=e;return new so(this._prepareForEfficientCompositing(t.alpha),t.color)}case 10:{let t=e;return new pt(this._prepareForEfficientCompositing(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new To(this._prepareForEfficientCompositing(t.child),t.transform)}case 12:{let t=e;return new en(this._prepareForEfficientCompositing(t.startChild),this._prepareForEfficientCompositing(t.endChild),t.id,t.progressFn)}case 3:case 4:{if(e.hasAnimatingMedia()||e.hasVolatileContent()&&e.op()!=8)return e;throw new Error(`Unexpectedly received ${un[e.op()]} node`)}case 8:throw new Error(`Unexpectedly received ${un[e.op()]} node`);default:throw new Error(`Node type ${un[e.op()]} is unhandled`)}}getPrioritizedListOfTilesToPopulate(e,t,r,n){let o=[ee.new2()],a=[ee.new2()],s=[1],l=[],c=h=>{switch(h.op()){case 10:{let u=h;switch(u.property){case 2:{let m=ee.new3(ce.List_last(o));m.multipliedBy1(u.transform()),o.push(m);let g=ee.new3(u.transform());g.invert()||g.copyFrom(Nt.FrozenAffineTransform_IDENTITY),g.multipliedBy1(ce.List_last(a)),a.push(g);break}case 0:{let m=ee.new3(ce.List_last(o));m.multipliedBy1(ce.List_last(a)),o.push(m);let g=ee.new2();a.push(g);break}case 1:{a.push(ee.new2());break}case 3:{s.push(u.maxTransformScale());break}}break}case 11:{let u=h,m=ee.new3(ce.List_last(o));m.multipliedBy1(u.transform),o.push(m);let g=ee.new3(u.transform);g.invert()||g.copyFrom(Nt.FrozenAffineTransform_IDENTITY),g.multipliedBy1(ce.List_last(a)),a.push(g);break}case 8:{let u=h,m=ce.List_last(o),g=ee.new3(m);g.invert();let _=V.new3(r);g.transformRect(_);let f=V.new3(t);g.transformRect(f);let S=e*ce.List_last(s);for(let b=0;b<10;b=b+1){u.setDevicePixelPerCanvasPixel(S);let T=u.numTilesNeededForBounds(f),y=this._compositeTileCache.tilesPerAtlasTexture();if(T>y){S/=2;continue}break}u.forEachTileWithinBounds(0,_,b=>{let y=b.bounds().distanceTo(f)*m.scale1().max1();l.push(new Jo.TileWithPriority(b,y))});break}}},d=h=>{switch(h.op()){case 10:{let u=h.property;(u==2||u==0||u==1)&&ce.List_removeLast(a),(u==2||u==0)&&ce.List_removeLast(o),u==3&&ce.List_removeLast(s);break}case 11:{ce.List_removeLast(a),ce.List_removeLast(o);break}}};return Lt.didEncounterCullTreesDuringTilePrioritization(),X.cullTreesDuringTilePrioritization()?br.visitEachNodeInTree(n,c,d,r,this._boundsCache):br.visitEachNodeInTree(n,c,d),l.sort((h,u)=>h.canvasSpaceDistanceToViewport<u.canvasSpaceDistanceToViewport?-1:1),l}cleanExistingInterrupt(e){this._renderer.cleanUpExistingInterrupt(),this._compositeTileCache.devalueTile(e),e.tileHandleOrNull=null,e.neededImagesOrNull=null}ensureTileIsPopulatedContinue(e,t,r){let n=V.new2(),o=this._compositeTileCache.prepareToRenderTo(e,n),a=!0,s=new vo.Options(e.key.tree,a,this._boundsCache,r,!1,!0,!1);return this._renderer.drawTileContinued(n,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),o,s,t)==null?(this.cleanExistingInterrupt(e),2):(t.recordTileWasRendered(),0)}ensureTileIsPopulated(e,t,r){if(t.recordTileCacheSlotWasUsed(),this._compositeTileCache.hasRenderedContent(e))return 2;let n=V.new2(),o=this._compositeTileCache.prepareToRenderTo(e,n),a=!0,s=new vo.Options(e.key.tree,a,this._boundsCache,r,!1,!0,!1),l=this._renderer.drawTile(n,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),o,s,t);return l.status!=1&&t.recordTileWasRendered(),this._compositeTileCache.setNeededImagesForTile(e,l.neededImagesOrNull),l.status==1?1:0}drawToScreen(e,t,r,n,o,a){this._context.annotate("Composite",()=>{let s=Nn.new2();s.copyFrom(t);let l=s.invert();if(this._backbuffer==null||this._backbuffer.colorTexture().width()!=(r.size().x()|0)||this._backbuffer.colorTexture().height()!=(r.size().y()|0)){this._backbuffer!=null&&this._backbuffer.deleteTexture();let y=this._context.createTexture(O.TextureFormat.RGBA_LINEAR_CLAMP,r.size().x()|0,r.size().y()|0,"Compositor Backbuffer"),I=this._context.createTexture(O.TextureFormat.STENCIL,r.size().x()|0,r.size().y()|0,"Compositor Backbuffer");this._backbuffer=this._context.createFramebuffer(y,I,"Compositor Backbuffer")}let c=this._context.currentFramebuffer();this._context.setFramebuffer(this._backbuffer),this._context.clear(O.Clear.ALL),this._context.setFramebuffer(c),Lt.didEncounterLargeTilesForDrawToScreen();let d=X.viewerLargeTilesDrawToScreen(),h=d?BA():or.TILE_SIZE,u=new V(0,0,h,h),m=V.new2();X.internalDebugTools()&&(e=this._renderer.treeToRender(e));let g=!1,_=!0,f=new vo.Options(e,g,this._boundsCache,a,_,!1,d);for(let y=r.left();y<=r.right();y+=h)for(let I=r.top();I<=r.bottom();I+=h)u.setX(y),u.setY(I),m.copyFrom(u),s.transformRect(m),u.translate2(r.topLeft().negative()),this._renderer.drawTile(u,m.x(),m.y(),m.width(),this._backbuffer,f,null);X.internalDebugTools()&&this._renderer.finishLayerByLayerDrawToScreen();let S=ee.new2();S.translate2(-1,1),S.scale4(2/n.width(),-2/n.height());let b=V.new2();b.copyFrom(r),b.transformBy1(S),b.setY(b.y()+b.height()),b.setHeight(-b.height()),this._context.setFramebuffer(null),this._context.setViewport(n.left()|0,n.top()|0,n.width()|0,n.height()|0),this._context.clear(O.Clear.ALL,o);let T=V.UNIT;this._renderer.drawTextureToCurrentFramebuffer(this._backbuffer.colorTexture(),T,null,b,Nt.FrozenAffineTransform_IDENTITY,1,1),this._renderer.context().endFrame()})}};Jo._VERBOSE_LOGS=!1,Jo._alreadyLoggedTooManyTiles=!1;var ps=Jo;(t=>{class i{overlapsViewport(){return this.canvasSpaceDistanceToViewport==0}constructor(n,o){this.node=n,this.canvasSpaceDistanceToViewport=o}}t.TileWithPriority=i;class e{constructor(n,o,a,s,l){this._context=n,this._renderingDeadline=0,this._tileRenderingBudgetRemaining=0,this._tileCacheCapacityRemaining=0,this._overrideFrameBudget=!1,this._renderingDeadline=We.seconds()+o,this._tileRenderingBudgetRemaining=a,this._tileCacheCapacityRemaining=s,this._framebufferSwitchBudget=l}recordTileWasRendered(){this._tileRenderingBudgetRemaining=this._tileRenderingBudgetRemaining-1}recordTileCacheSlotWasUsed(){this._tileCacheCapacityRemaining=this._tileCacheCapacityRemaining-1}tileCacheCapacityRemaining(){return this._tileCacheCapacityRemaining}permitsMoreWork(){return this._overrideFrameBudget?!0:!(We.seconds()>=this._renderingDeadline||this._tileRenderingBudgetRemaining<=0||this._tileCacheCapacityRemaining<=0||this._framebufferSwitchBudget-this._context.getNumFramebufferSwitches()<=0)}permitWorkAfterBudgetExceeded(){this._overrideFrameBudget=!0}forbidWorkAfterBudgetExceeded(){this._overrideFrameBudget=!1}frameBudgetOverride(){return this._overrideFrameBudget}}e.defaultTimeBudgetInSeconds=.016,e.defaultTileRenderingBudget=2,e.defaultFramebufferSwitchBudget=250,t.FrameBudget=e})(ps||(ps={}));var rd=class{constructor(e,t,r,n){this._boundsCache=Ai._new();this._requestImage=(e,t)=>{};this._context=e,this._renderer=t,this._requestImage=r,this._emitter=n}_resetBuffer(e,t){this._buffer!=null&&this._buffer.deleteTexture();let r=this._context.createTexture(O.TextureFormat.RGBA_LINEAR_CLAMP,e,t,"Slide Thumbnail Buffer"),n=this._context.createTexture(O.TextureFormat.STENCIL,e,t,"Slide Thumbnail Buffer");this._buffer=this._context.createFramebuffer(r,n,"Slide Thumbnail Buffer")}generateThumbnail(e,t,r,n){this._resetBuffer(r,n);let o=this._context.currentFramebuffer();this._context.setFramebuffer(this._buffer);let a=new Ne.GenerateArgs(Ne.RenderMode.NORMAL),s=new Kt(e),l=e.renderTree2(s),c=new vo.Options(l,!0,this._boundsCache,this._requestImage,!1,!1,!1),d=or.TILE_SIZE;for(let u=0;u<=r;u+=d)for(let m=0;m<=n;m+=d){let g=new V(u,m,d,d),_=V.new2();_.copyFrom(g),t.transformRect(_),this._renderer.drawTile(g,_.x(),_.y(),_.width(),this._buffer,c,null)}let h=this._context.readPixels(this._buffer,0,0,r,n);return this._context.setFramebuffer(o),h}dirtyNode(e){let t=e.findNearestAncestorOrNull("SLIDE");t!==null&&this._emitter.trigger("slideThumbnailInvalidated",t.id())}handleImageLoaded(e){this.dirtyNode(e)}handleSceneGraphEvent(e){switch(e.property){case 65:case 66:case 68:case 69:case 72:case 81:case 83:case 96:case 97:break;case 24:case 25:case 90:if(e.node.type()!=="SLIDE"){this.dirtyNode(e.node);break}default:{this.dirtyNode(e.node);break}}}};rd._VERBOSE_LOGS=!1;var Hp=class{_resetBuffer(e,t){}generateThumbnail(e,t,r,n){return new Uint8Array}dirtyNode(e){}handleImageLoaded(e){}handleSceneGraphEvent(e){}};var zp=class{toggleRenderTreePrinting(){}addObserver(e){}removeObserver(e){}setBackgroundEnabled(e){}internalInitPerfTracking(){}isRenderingDone(){return!0}getContext(){return null}graphicsCardName(){return""}setNeedsBlit(e){}checkNeedsBlit(){return!1}deviceRenderer(){return null}slideThumbnailRenderer(){return null}changeFitMode(e){}setZoomScale(e){}updateScroll(e){}handleSceneChange(e,t){}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}resize(e,t,r,n){return new O.ComputedCanvasSize(new R(0,0),!1)}drawBlank(){}draw(e,t,r,n){return 2}clearTileCaches(){}getAggregateTransitionStats(){return new Map}triggerTransition(e,t,r){}handleAbortedTransition(e){}handleCommittedTransition(e){}triggerHsmTransition(e,t,r){}abortHsmTransition(e,t){}commitHsmTransition(e,t){}isTopLevelTransitionOngoing(){return!1}easedTransitionProgress(){return 1}currentCanvasSpacePreviewBounds(){return new V(0,0,0,0)}currentCanvasSpaceFrameBounds(){return new V(0,0,0,0)}canvasSpacePreviewBoundsForTransition(e,t){return new V(0,0,0,0)}canvasSpaceFrameBoundsForTransition(e,t){return new V(0,0,0,0)}ongoingPrototypeStateChange(){return null}transitionProgressTracker(){return null}drawDeviceFrameIfNecessary(e,t,r,n){return!1}renderLayerByLayerActivate(e){}renderLayerByLayerDeactivate(){}renderLayerByLayerPlay(){}renderLayerByLayerPause(){}renderLayerByLayerForward(){}renderLayerByLayerBackward(){}renderLayerByLayerRewind(){}renderLayerByLayerIncreaseSpeed(){}renderLayerByLayerDecreaseSpeed(){}attachTo(e){}removeFrom(e){}},Mn=class Mn{constructor(e,t,r,n){this._interruptCompletionCallback=null;this._context=null,this._bufferPool=null,this._compositeTileCache=null,this._compositor=null,this._renderer=null,this._viewport=null,this._dirtinessTracker=null,this._appState=null,this._hotspotRenderer=null,this._smoothPath=null,this._deviceRenderer=null,this._prerenderViewport=new qo,this._devicePixelRatio=0,this._needsBlit=!0,this._isAnimatedMediaPlaying=!1,this._printRenderTree=!1,this._activeRenderTree=null,this._overlayBaseScreenId=null,this._generatedOverlays=new Map,this._debouncedDevicePixelsPerCanvasPixel=null,this._didRasterizeContentOnLastDraw=!0,this._observers=new zr,this._requestImageOnScreen=null,this._requestImageForPrerendering=null,this.PORTION_TO_LOG=50/100,this.MAX_TRANSITION_LOGS=50,this._numTransitionsLogged=0,this._transitionStats=new Map,this._transitionWasInterruptedByVisibilityChange=!1,this._visibilityListener=null,this.HEADERS=["frame_count","transition_count","mean_frame_ms","median_transition_mean","median_transition_max","count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"],this._ongoingTransition=null,this._drewFirstFrameOfTransition=!0,this._transitionProgressTracker=new Ln,this._hsmTransitionMap=new Map,this._consolidatedRenderTreeForMagicMove=null,this._context=this._createContext(),this._bufferPool=new O.BufferPool(this._context),this._compositeTileCache=new td(this._context,this._bufferPool),this._renderer=new vo(this._context,this._bufferPool),this._compositor=new ps(this._context,this._compositeTileCache,this._renderer),this._viewport=e,this._appState=t,this._appState.addAppObserver(this),this._emitter=n,this._renderer.context().addContextResetHandler(()=>{this._deviceRenderer.clearOnContextReset(),this._viewport.invalidate(),X.shouldApplyMobileOptimizations()&&r.clearQueuesAndDecodedDataForAllImages(this._canvas())}),r.onImageLoaded=a=>{a.invalidateRenderTreeForSelfAndParents(),this._dirtinessTracker.handleImageLoaded(a),this._slideThumbnailRenderer.handleImageLoaded(a),this._viewport.invalidate()};let o=a=>{this._onBoundsInvalidate(a)};this._dirtinessTracker=new Jc(o),this._smoothPath=new O.SmoothPath(this._context,this._bufferPool),this._deviceRenderer=new Lp(this._context,this._bufferPool),this._hotspotRenderer=new wp(this._context,this._bufferPool),this._debouncedDevicePixelsPerCanvasPixel=new Yc(a=>{t.addFrameObserver(a)},2,(a,s)=>a==s,()=>{this.setNeedsBlit(!0)}),this._initMagicMoveRenderTreeCache(),this._requestImageOnScreen=(a,s)=>{let l=hn.forOnScreenPurpose(s);r.requestImageForRendering(a,l)},X.getFeatureFlags().piper_webgl_thumbnails?this._slideThumbnailRenderer=new rd(this._context,this._renderer,this._requestImageOnScreen,this._emitter):this._slideThumbnailRenderer=new Hp,this._requestImageForPrerendering=(a,s)=>{let l=hn.forPrerenderPurpose(s);r.requestImageForRendering(a,l)},console.debug(`Graphics card: '${this._context.graphicsCardName()}'`),Mn.PERF_TRACKING&&(this._initTransitionStats(),window.getTransitionStats=a=>this._formatStatsForGoogleSheets(this.getAggregateTransitionStats(),a??!1))}toggleRenderTreePrinting(){this._printRenderTree=!this._printRenderTree,this._printRenderTree&&this._activeRenderTree!=null&&console.log(this._activeRenderTree.debugString1())}_currentBaseScreenId(){var e;return(e=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:e.id()}_currentOverlayData(){return this._appState.prototypeState().getCurrentOverlayData()}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){}_uninitialize(){this._debouncedDevicePixelsPerCanvasPixel.unregister(e=>{this._appState.removeFrameObserver(e)}),this._appState.removeAppObserver(this)}internalInitPerfTracking(){3==0&&(Mn.PERF_TRACKING=!0,this._initTransitionStats())}isRenderingDone(){return!this._didRasterizeContentOnLastDraw}getContext(){return this._context}graphicsCardName(){return this._context.graphicsCardName()}setNeedsBlit(e){this._needsBlit=e,this._observers.forEach(t=>{t.handleSetNeedsBlit(e)})}checkNeedsBlit(){return this.setNeedsBlit(this._needsBlit||this._viewport.isInvalid()||this.isTopLevelTransitionOngoing()||this._animatedMediaPlaying()||this._hsmTransitionMap.size>0),this._needsBlit||Li.hasUnexpectedCompositingBug()}deviceRenderer(){return this._deviceRenderer}slideThumbnailRenderer(){return this._slideThumbnailRenderer}changeFitMode(e){this._viewport.invalidate()}setZoomScale(e){}updateScroll(e){this.setNeedsBlit(!0)}handleSceneChange(e,t){this._debouncedDevicePixelsPerCanvasPixel.clear()}handleActiveCanvasChange(e,t){this._renderer.setCanvas(t),e!=null&&(e.scene().removeObserver(this._dirtinessTracker),e.scene().removeObserver(this._slideThumbnailRenderer)),t!=null&&(t.scene().addObserver(this._dirtinessTracker),t.scene().addObserver(this._slideThumbnailRenderer)),this._dirtinessTracker.initCanvas(t)}handleActivePrototypeStartingPointChange(e,t){}resize(e,t,r,n){let a=new R(e,t).multiply(n),s=this._context.resize(Math.round(a.x())|0,Math.round(a.y())|0);return this._devicePixelRatio=n,this.setZoomScale(r),this._debouncedDevicePixelsPerCanvasPixel.clear(),new O.ComputedCanvasSize(s.canvasSize.divide(n),s.webGLDidAdjustCanvasSize)}drawBlank(){this._context.annotate("Draw blank",()=>{X.isInlinePreview()&&this._ongoingTransition!=null&&this._onBeforeFrameForTransition(),this._renderer.context().beginFrame(),this._renderer.context().clear(O.Clear.ALL),this._renderer.context().endFrame()})}_renderTreeToDraw(e){if(this.isTopLevelTransitionOngoing())return this._renderTreeForTransition(e);{let t=this._appState.prototypeState().getCurrentBaseScreenNode(),r=this._appState.prototypeState().bindOverlays(this._currentOverlayData());return De.appTimerStart("invalidateDirtyTiles"),this._dirtinessTracker.invalidateDirtyTiles(this._canvas(),new Yo(this._canvas(),this._hsmTransitionMap,new Yi(this._generatedOverlays),this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts())),De.appTimerStop("invalidateDirtyTiles"),this._generatedOverlays=new Map,this._renderTreeForBaseScreenAndOverlays(t,r)}}_renderTreeForBaseScreenAndOverlays(e,t){if(e==null)return null;let r=Ne.renderTreeForBaseScreenWithPerfLogging(e,new Yo(e,this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts()),"_renderTreeForBaseScreenAndOverlays");return r==null?null:pt.forTransformIsolation(Xe.wrap([this._compositor.prepareForEfficientCompositing(r),this._renderTreeForOverlays(e,t)]).optimized())}_renderTreeForOverlays(e,t){let r=[],n=new Yi;for(let o=0,a=t.length;o<a;o=o+1){let s=Ne.renderTreeForOverlayBackground(t[o].backgroundAppearance(),e.canvasSpaceBoundingBox());s!=null&&r.push(s);let l=this._renderTreeForOverlay1(t[o],e,o,n,null);l!=null&&r.push(l)}return Xe.wrap(r)}_renderTreeForOverlay1(e,t,r,n,o){return this._renderTreeForOverlay2(e,t,r,null,n,o)}_renderTreeForOverlay2(e,t,r,n,o,a){if(t==null)return null;let s=e.node();if(s==null)return null;let l=e.renderedBounds(t),c=s.canvasSpaceBoundingBox(),d=l.center().subtract1(c.center());this._overlayBaseScreenId!=null&&t.id()!=this._overlayBaseScreenId&&(s.invalidateRenderTreeForSelfAndParents(),s.invalidateRenderTreeForChildren()),this._overlayBaseScreenId=t.id();let h=new Kt(t,null),u=new nl(e.id(),e.node(),l,h,e.backgroundAppearance(),n,()=>d,a);o.addEntry(e.id(),u),this._generatedOverlays.set(e.id(),u);let m=Ne.renderTreeForOverlayWithPerfLogging(s,new Yo(s,this._hsmTransitionMap,o,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts()),"_renderTreeForOverlay");if(m==null)return null;let g=this._compositor.prepareForEfficientCompositing(m);return g=pt.forTranslation(g,Ct.forOverlayPosition(r),()=>d),g}_animatedMediaPlaying(){return this._isAnimatedMediaPlaying}_setAnimatedMediaPlaying(e){this._isAnimatedMediaPlaying=e}draw(e,t,r,n){var o;return this._didRasterizeContentOnLastDraw=!1,this._renderer.context().isContextLost()?2:((o=this._canvas())==null?void 0:o.scene())==null?2:this._currentTlf()==null?2:r.viewSpaceBounds().isEmpty()?2:this._context.annotateAndReturn("draw",()=>{var S,b,T,y;let a=this._compositor.beginFrameAndCreateBudget(),s=a.tileCacheCapacityRemaining();this._interruptCompletionCallback==null&&this._renderer.context().beginFrame();let l=this._ongoingTransition!=null,c=this.isTopLevelTransitionOngoing();l&&this._onBeforeFrameForTransition(),this._onBeforeFrameForHsm();let d=this._renderTreeToDraw(r);this._activeRenderTree=d,d!=null&&this._setAnimatedMediaPlaying(d.hasAnimatingMedia()),this._debouncedDevicePixelsPerCanvasPixel.queueValue(r.zoomScale()*this._devicePixelRatio);let h=this._debouncedDevicePixelsPerCanvasPixel.hasQueuedValue()&&!(c&&!this._drewFirstFrameOfTransition);this._drewFirstFrameOfTransition=!0;let u=[],m=0,g=V.new2();r.computeCanvasSpaceBounds1(g);let _=this.currentCanvasSpacePreviewBounds();if(_==null)return De.trackEvent("prototype_null_canvas_space_preview_bounds",{currentTlfID:((S=this._currentTlf())==null?void 0:S.id)??"null",baseScreenNodeID:((b=this._appState.baseScreenNode())==null?void 0:b.id)??"null",sceneNull:((T=this._canvas())==null?void 0:T.scene())==null,transitionOngoing:this._ongoingTransition!=null}),2;let f=this.currentCanvasSpaceFrameBounds()!=null?this.currentCanvasSpaceFrameBounds().topLeft():new R(0,0);if(_.intersectWith(g),De.appTimerStart("interruptCompletion"),this._interruptCompletionCallback&&(a.permitWorkAfterBudgetExceeded(),this._interruptCompletionCallback(a),a.forbidWorkAfterBudgetExceeded(),this._interruptCompletionCallback=null),De.appTimerStop("interruptCompletion"),this._renderer.context().beginFrame(),De.appTimerStart("drawOnScreenTiles"),this._context.annotate("On-screen tiles",()=>{if(!h){let I=V.new3(_);for(I.expandedBy1(_.height()),u=this._compositor.getPrioritizedListOfTilesToPopulate(this._debouncedDevicePixelsPerCanvasPixel.getValue(),_,I,d),a.permitWorkAfterBudgetExceeded();m<u.length;){let p=u[m];if(!p.overlapsViewport())break;this._compositor.ensureTileIsPopulated(p.node,a,this._requestImageOnScreen)==0&&(this._didRasterizeContentOnLastDraw=!0,Mn.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame INSIDE of viewport. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`)),m=m+1}a.forbidWorkAfterBudgetExceeded()}}),De.appTimerStop("drawOnScreenTiles"),De.appTimerStart("drawToScreen"),this._needsBlit){this._printRenderTree&&console.log(d.debugString1());let I=V.new2(),p=0,A=(y=this._canvas())==null?void 0:y.prototypeDevice();A!=null&&A.type=="PRESET"&&this._appState.prototypeState().showDeviceFrame()?(I.setTo2(f,A.size()),p=C.BLACK):(I.copyFrom(_),p=n.backgroundColor);let E=Nn.new2().scaledBy(this._devicePixelRatio).multipliedBy(r.canvasSpaceToViewSpace1());E.transformRect(I),I.round();let D=r.viewSpaceBounds(),G=new V(D.left()*this._devicePixelRatio,D.top()*this._devicePixelRatio,D.width()*this._devicePixelRatio,D.height()*this._devicePixelRatio).rounded();this._compositor.drawToScreen(d,E,I,G,p,this._requestImageOnScreen),this._drawUI(r,n),this.setNeedsBlit(!1)}return De.appTimerStop("drawToScreen"),De.appTimerStart("drawOffScreenTiles"),this._context.annotate("Off-screen tiles",()=>{if(!h){for(;a.permitsMoreWork()&&m<u.length;){let I=this._compositor.ensureTileIsPopulated(u[m].node,a,this._requestImageForPrerendering);if(I==0)this._didRasterizeContentOnLastDraw=!0;else if(I==1){this._didRasterizeContentOnLastDraw=!0;let p=u[m].node,A=u[m].node.key;this._interruptCompletionCallback=v=>{this._compositor.ensureTileIsPopulatedContinue(p,v,this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)};break}I==0&&Mn.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame OUTSIDE of viewport. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`),m=m+1}if(t&&this._interruptCompletionCallback==null){let I=this._appState.prototypeState().bindOverlays(this._currentOverlayData()),p=null,A=this._appState.baseScreenNode().canvasSpaceBoundingBox().topLeft();for(let v of this._appState.prototypeStructure().getPrerenderingJobs(()=>a.permitsMoreWork())){let E=null,D=null,G=null,U=null,M=v.asScreen(),z=v.asSmartAnimate();if(M!=null){if(M.role==Lr.FrameRole.BASE_SCREEN&&J.equals(M.nodeId,this._currentBaseScreenId())||(G=this._canvas().scene().findNode(M.nodeId),G==null||!G.hasBeenLoaded()))continue;if(!a.permitsMoreWork())break;let Q=null;if(M.role==Lr.FrameRole.OVERLAY){let ne=Kr.fromPrototypeAction(M.prototypeAction,0);Q=Pc.BoundOverlay_computeNewBounds(G,this._appState.baseScreenNode(),ne,A,G.overlayPositionType()),A=Q.topLeft();let W=new Kt(this._appState.baseScreenNode(),null),K=new nl(G.id(),G,Q,W,G.overlayBackgroundAppearance(),null,()=>G.canvasSpaceBoundingBox().topLeft().negative().add1(A),null);this._generatedOverlays.set(G.id(),K),p==null&&(p=new Yi),p.addEntry(G.id(),K),E==null&&M.precedingOverlays!=null&&(E=new Yi)}if(M.role==Lr.FrameRole.OVERLAY&&I.some(ne=>J.equals(M.nodeId,ne.id())))continue;if(U=this.canvasSpacePreviewBoundsForTransition(G,G),E!=null){let ne=!1;for(let W of M.precedingOverlays){let K=p.get(W);if(K==null){ne=!0;break}E.addEntry(W,K)}if(ne)break}let Y=new Yo(G,this._hsmTransitionMap,E,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts());D=M.role==Lr.FrameRole.BASE_SCREEN?Ne.renderTreeForBaseScreenWithPerfLogging(G,Y,"_draw"):Ne.renderTreeForOverlayWithPerfLogging(G,Y,"_draw")}else if(z!=null){let Q=this._canvas().scene().findNode(z.srcNodeId),Y=this._canvas().scene().findNode(z.dstNodeId);if(Q==null||Y==null||!Q.hasBeenLoaded()||!Y.hasBeenLoaded())continue;U=this.canvasSpacePreviewBoundsForTransition(Q,Y);let ne=Ir.get(z.transitionType);D=this._renderTreeForMagicMove(Q,Y,ne,z.role,z.easingFunction),G=Y}if(D==null)continue;if(!a.permitsMoreWork())break;let B=this._compositor.prepareForEfficientCompositing(D);if(!a.permitsMoreWork())break;this._prerenderViewport.copyFrom(this._viewport),this._prerenderViewport.updateForCurrentPreview(G.canvasSpaceBoundingBox(),U,this._appState.currentFitMode(),this._appState.activePrototypeDevice());let w=V.new2();this._prerenderViewport.computeCanvasSpaceBounds1(w),U.intersectWith(w);let P=this._prerenderViewport.zoomScale()*this._devicePixelRatio,H=this._compositor.getPrioritizedListOfTilesToPopulate(P,U,U,B);for(let Q of H){if(a.tileCacheCapacityRemaining()==0)break;let Y=this._compositor.ensureTileIsPopulated(Q.node,a,this._requestImageForPrerendering);if(Y==0)this._didRasterizeContentOnLastDraw=!0,Mn.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendering tile for future frame. Capacity left: ${a.tileCacheCapacityRemaining()} / ${s}`);else if(Y==1){this._didRasterizeContentOnLastDraw=!0;let ne=Q.node;this._interruptCompletionCallback=W=>{this._compositor.ensureTileIsPopulatedContinue(ne,W,this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0)};break}if(!a.permitsMoreWork())break}}}}}),De.appTimerStop("drawOffScreenTiles"),this._context.endFrame(),0})}_canvas(){return this._appState.getActiveCanvas()}_currentTlf(){var e;return(e=this._canvas())==null?void 0:e.scene().findNode(this._currentBaseScreenId())}_drawUI(e,t){this._context.annotate("Draw UI",()=>{if(this._appState.getActiveCanvas()==null)return;let r=this.currentCanvasSpacePreviewBounds(),n=this.currentCanvasSpaceFrameBounds().topLeft(),o=V.new2();e.computeCanvasSpaceBounds1(o);let l=1/(e.zoomScale()*this._devicePixelRatio);if(r==null)return;this._smoothPath.setTransformAndPixelScale(e.canvasSpaceToClipSpace1(),l);let c=this._canvas().prototypeDevice(),d=c!=null&&c.type=="PRESET"&&this._appState.prototypeState().showDeviceFrame(),h=0;if(d&&Qb(c.presetIdentifier)&&(h=25),!d)r.intersectWith(o),us.drawPreviewStencil(this._smoothPath,e.zoomScale(),r,o,t.backgroundColor,h);else{let m=V.new2();m.setTo2(n,c.size()),m.expand1(1/e.zoomScale()),r.intersectWith(o),m.intersectWith(o),us.drawPreviewStencil(this._smoothPath,e.zoomScale(),m,o,t.backgroundColor,h)}3!=0&&(this._drawDeviceFrameIfNecessary(this._smoothPath,e,this._currentTlf().canvasSpaceBoundingBox(),o),t.particles!=null&&us.drawParticles(this._smoothPath,t.particles,1/e.zoomScale(),r),t.mouse!=null&&r.contains2(t.mouse)&&us.drawMouseCursor(this._smoothPath,t.mouse,e.zoomScale()),t.hotspots!=null&&this._hotspotRenderer.draw(e.canvasSpaceToClipSpace1(),e.zoomScale(),t.hotspots,t.hotspotOpacity,this._devicePixelRatio),this._smoothPath.flush(),this.deviceRenderer().flush())})}drawDeviceFrameIfNecessary(e,t,r,n){return this._drawDeviceFrameIfNecessary(this._smoothPath,t,r,n)}_drawDeviceFrameIfNecessary(e,t,r,n){return this._canvas()==null||!this._appState.prototypeState().showDeviceFrame()?!1:(this._context.annotate("Draw device frame",()=>{var o;if(this.deviceRenderer().drawPrototypeDeviceIfAny(t,this._canvas().prototypeDevice(),r,t.canvasSpaceToClipSpace1()),this.deviceRenderer().isWaitingForDeviceFrameToLoad(this._canvas().prototypeDevice())){let a=bu((o=this._appState.baseScreenNode())==null?void 0:o.id(),this._appState.currentFitMode(),this._canvas());e.fillRect(n,a)}}),!0)}_totalVRAM(){let e=0;return e=e+this._bufferPool.totalVRAM(),e=e+this._compositeTileCache.totalVRAM(),e=e+this._renderer.totalVRAM(),e}_onBoundsInvalidate(e){this._viewport.invalidate()}clearTileCaches(){this._compositeTileCache.clear()}_initTransitionStats(){if(this._visibilityListener===null){let e=()=>{this._transitionWasInterruptedByVisibilityChange=!0};Jt.EventTarget_addEventListener1(document,"visibilitychange",e)}this._transitionWasInterruptedByVisibilityChange=!1;for(let e of["SA","nonSA"])this._transitionStats.set(e,new Map([["transition_mean",[]],["transition_max",[]],["frame_counts",[]],["count_0_to_20ms",0],["count_20_to_40ms",0],["count_40_to_80ms",0],["count_80_to_160ms",0],["count_160_to_320ms",0],["count_320_to_640ms",0],["count_640_ms_or_higher",0]]))}_maybeLogPerformanceMetricsForTransition(){let e=this._transitionWasInterruptedByVisibilityChange;if(this._transitionWasInterruptedByVisibilityChange=!1,!(e||document.hidden)&&!this._transitionProgressTracker.isProgressControlledExternally()&&this._transitionProgressTracker.duration()>0){let t=Math.random()<this.PORTION_TO_LOG&&this._numTransitionsLogged<this.MAX_TRANSITION_LOGS;if(Mn.VERBOSE_LOGS||t||Mn.PERF_TRACKING){let r=this._transitionProgressTracker.frameTimesMs,n=r.length,o=0,a=0,s=0,l=0,c=0,d=0,h=0,u=0,m=0;for(let T of r)u=Math.max(u,T),m+=T,T<20?o=o+1:T<40?a=a+1:T<80?s=s+1:T<160?l=l+1:T<320?c=c+1:T<640?d=d+1:h=h+1;if(u>60*1e3)return;let g=m/n,_=this._ongoingTransition.change,f=_.transitionParameters.transitionType,S=f=="SMART_ANIMATE"||mn.supportsSmartAnimate(f)&&_.transitionParameters.transitionShouldSmartAnimate,b=new Map([["is_smart_animate",S],["mean_frame_ms",g],["max_frame_ms",u],["frame_count",n],["count_0_to_20ms",o],["count_20_to_40ms",a],["count_40_to_80ms",s],["count_80_to_160ms",l],["count_160_to_320ms",c],["count_320_to_640ms",d],["count_640_ms_or_higher",h]]);Mn.VERBOSE_LOGS&&(console.group("ProtoRenderManager: Transition complete"),console.table(He.StringMap_toJSObject(b)),console.groupEnd()),t&&(De.trackEvent("viewer_transition_frame_times_v2",He.StringMap_toJSObject(b)),this._numTransitionsLogged=this._numTransitionsLogged+1),Mn.PERF_TRACKING&&this._aggregateTransitionStats(b)}}}_aggregateTransitionStats(e){let t=e.get("is_smart_animate")?"SA":"nonSA",r=this._transitionStats.get(t);r.get("frame_counts").push(e.get("frame_count")),r.get("transition_mean").push(e.get("mean_frame_ms")),r.get("transition_max").push(e.get("max_frame_ms"));for(let n of["count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"])r.set(n,r.get(n)+e.get(n))}getAggregateTransitionStats(){for(let e of["SA"]){let t=new Map(this._transitionStats.get(e)),r=0;for(let a=0,s=t.get("transition_mean").length;a<s;a=a+1)r=r+t.get("transition_mean")[a]*t.get("frame_counts")[a];t.set("frame_count",t.get("frame_counts").reduce((a,s,l)=>a+s,0)),t.delete("frame_counts"),t.set("mean_frame_ms",r/t.get("frame_count")|0),t.get("transition_mean").sort(),t.get("transition_max").sort();let n=t.get("transition_mean").length%2===0,o=Math.floor(t.get("transition_mean").length/2);for(let a of["mean","max"]){let s=t.get(`transition_${a}`)[o];n&&(s+=t.get(`transition_${a}`)[o-1],s/=2),t.set(`median_transition_${a}`,s)}return t.set("transition_count",t.get("transition_mean").length),t.set("max_frame_ms",t.get("transition_max")[t.get("transition_max").length-1]),t.delete("transition_mean"),t.delete("transition_max"),t}}_formatStatsForGoogleSheets(e,t){let r=`
`;t&&(r+=`=SPLIT("${this.HEADERS.join(",")}", ",")
`);let n=[];for(let o of this.HEADERS)n.push(e.get(o).toString());return r+=`=SPLIT("${n.join(",")}", ",")
`,r}triggerTransition(e,t,r){this._drewFirstFrameOfTransition=!1,this._ongoingTransition=new Mn.TransitionState(e,t),this._transitionProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration),r!=null&&ds.applyTo(r,this._transitionProgressTracker)}handleAbortedTransition(e){var t;e==((t=this._ongoingTransition)==null?void 0:t.change)&&(this._ongoingTransition=null)}handleCommittedTransition(e){var t;e==((t=this._ongoingTransition)==null?void 0:t.change)&&(this._ongoingTransition=null)}triggerHsmTransition(e,t,r){let n=e.toString(),o=new Ln;o.willStartTransitionWithDuration(t.transitionParameters.transitionDuration),r!=null&&ds.applyTo(r,o),this._hsmTransitionMap.set(n,new Mn.InstanceSwapTransition(o,()=>{let a=o.progress();return t.transitionParameters.easingFunction==null||o.isProgressControlledExternally()?a:t.easingFunction().get(a)},t))}abortHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}commitHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}isTopLevelTransitionOngoing(){return this._ongoingTransition!=null&&this._transitionProgressTracker.isTransitionInProgress()}easedTransitionProgress(){let e=this._ongoingTransition;if(e==null)return 0;let t=this._transitionProgressTracker.progress();return e.change.easingFunction()==null||this._transitionProgressTracker.isProgressControlledExternally()?t:e.change.easingFunction().get(t)}_renderTreeForTransition(e){let t=this._ongoingTransition;return t==null?null:t.cachedRenderTree!=null?t.cachedRenderTree:J.equals(t.change.oldStateId(),t.change.newStateId())?this._renderTreeForOverlayTransition(t):this._renderTreeForBaseScreenTransition(t,e)}_initMagicMoveRenderTreeCache(){let e=a=>a[1]==Lr.FrameRole.OVERLAY?Ne.renderTreeWithPerfLogging2(a[0],new Yo(a[0],this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts()),"_initMagicMoveRenderTreeCache"):Ne.renderTreeForBaseScreenWithPerfLogging(a[0],new Yo(a[0],this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts()),"_initMagicMoveRenderTreeCache"),t=a=>a,r=a=>a,n=(a,s,l,c)=>{let d=null;try{d=wo.renderTreeForMagicMove(a,s,()=>this.easedTransitionProgress(),c,l)}catch(h){d=new Xe([]),Le(h)}return Mn.VERBOSE_LOGS&&(console.log("Smart animate render tree"),console.log("-------------------------"),console.log(d.debugString1())),d},o=(a,s,l,c)=>n(a[0],s[0],l,c);this._consolidatedRenderTreeForMagicMove=qb(o,e,e,t,r)}_renderTreeForMagicMove(e,t,r,n,o){return this._consolidatedRenderTreeForMagicMove([e,n],[t,n],r,o)}_preparedRenderTreeForMagicMove(e,t,r,n,o,a){let s=this._renderTreeForMagicMove(r,n,t,o,a);return e.cachedRenderTree=this._compositor.prepareForEfficientCompositing(s),e.cachedRenderTree}_renderTreeForBaseScreenTransition(e,t){let r=e.change,n=e.viewportBeforeTransition.zoomScale()*this._devicePixelRatio,o=this._appState.prototypeState().lastNodeForBaseScreen();if(o==null)return null;let a=t.zoomScale()*this._devicePixelRatio,s=this._appState.prototypeState().nextNodeForBaseScreen();if(s==null)return null;let l=r.oldOverlays(this._appState.prototypeState()),c=r.newOverlays(this._appState.prototypeState()),d=Ir.get(r.transitionParameters.transitionType);r.direction==1&&(d=d.reversed());let h=r.transitionParameters.transitionType=="SMART_ANIMATE"||mn.supportsSmartAnimate(r.transitionParameters.transitionType)&&r.transitionParameters.transitionShouldSmartAnimate,u=l.length!=0;if(h){let S=this._preparedRenderTreeForMagicMove(e,d,o,s,Lr.FrameRole.BASE_SCREEN,r.easingFunction());if(u){let b=s.size().max2(o.size()),T=ee.new2(),y=this._renderTreeForOverlays(o,l);if(y=pt.forOpacity(y,Ct.EXITING_TLF,()=>d.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),y=pt.forTransform(y,Ct.EXITING_TLF,()=>T.copyFrom(Nt.FrozenAffineTransform_IDENTITY).translatedBy1(b.multiply1(d.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(n/a).translatedBy1(o.canvasSpaceBoundingBox().center().negative())),r.transitionParameters.transitionType=="SMART_ANIMATE"){let I=Ct.DISSOLVE_TRANSITION;y=new en(y,S,I,()=>this.easedTransitionProgress())}return e.cachedRenderTree=Xe.wrap([S,y]).optimized(),e.cachedRenderTree}else return S}let m=s.size().max2(o.size()),g=ee.new2(),_=this._renderTreeForBaseScreenAndOverlays(o,l);_!=null?(_=pt.forOpacity(_,Ct.EXITING_TLF,()=>d.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),_=pt.forTransform(_,Ct.EXITING_TLF,()=>g.copyFrom(Nt.FrozenAffineTransform_IDENTITY).translatedBy1(m.multiply1(d.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(s.canvasSpaceBoundingBox().center()).scaledBy2(n/a).translatedBy1(o.canvasSpaceBoundingBox().center().negative()))):_=new Xe([]);let f=this._renderTreeForBaseScreenAndOverlays(s,c);if(f!=null?(f=pt.forOpacity(f,Ct.ENTERING_TLF,()=>d.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),f=pt.forTranslation(f,Ct.ENTERING_TLF,()=>m.multiply1(d.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())))):f=new Xe([]),d.isDissolve()){let S=Ct.DISSOLVE_TRANSITION;e.cachedRenderTree=new en(_,f,S,()=>this.easedTransitionProgress())}else d.drawsEnteringFrameOnTopOfExitingFrame()?e.cachedRenderTree=Xe.wrap([_,f]):e.cachedRenderTree=Xe.wrap([f,_]);return e.cachedRenderTree}_renderTreeForOverlayTransition(e){var b,T;let t=e.change,r=t.oldOverlays(this._appState.prototypeState()),n=t.newOverlays(this._appState.prototypeState()),o=this._appState.prototypeState().lastNodeForBaseScreen(),a=o.canvasSpaceBoundingBox().topLeft();if(o==null)return null;let s=Ne.renderTreeForBaseScreenWithPerfLogging(o,new Yo(o,this._hsmTransitionMap,null,this._appState.prototypeStructure().nodeTransitionTracker().getStateGroupStateSwapInteractionCounts()),"_renderTreeForOverlayTransition");if(s==null)return null;let l=[],c=this._compositor.prepareForEfficientCompositing(s);c!=null&&l.push(pt.forTransformIsolation(c));let d=t.getFramePairTransition(),h=new Yi,u=0;for(let y=0,I=Math.min(r.length,n.length);y<I&&J.equals(r[y].id(),n[y].id());y=y+1){let p=Ne.renderTreeForOverlayBackground(r[y].backgroundAppearance(),o.canvasSpaceBoundingBox());p!=null&&l.push(p);let A=this._renderTreeForOverlay1(r[y],o,y,h,null);A!=null&&l.push(A),u=u+1}if(r.length==n.length&&u==r.length-1&&t.transitionParameters.transitionType=="SMART_ANIMATE"){let y=r[r.length-1],I=n[n.length-1],p=this._appState.prototypeState().lastNodeForOverlayAt(r.length-1),A=this._appState.prototypeState().nextNodeForOverlayAt(n.length-1);if(p!=null&&A!=null){let v=[];Or(v,l);let E=Ne.renderTreeForOverlayBackground(y.backgroundAppearance(),o.canvasSpaceBoundingBox()),D=Ne.renderTreeForOverlayBackground(I.backgroundAppearance(),o.canvasSpaceBoundingBox());(E!=null||D!=null)&&v.push(new en(E,D,Ct.OVERLAY_BACKGROUND_DISSOLVE,()=>this.easedTransitionProgress()));let G=this._preparedRenderTreeForMagicMove(e,d,p,A,Lr.FrameRole.OVERLAY,t.easingFunction());return G=pt.forTranslation(G,Ct.SMART_ANIMATE_OVERLAY_TRANSLATION,()=>{let U=I.deltaFromRenderedPositionToCanvasSpacePosition(o),M=y.renderedOrigin(o).subtract1(A.canvasSpaceBoundingBox().topLeft());return U.multiply(this.easedTransitionProgress()).add1(M.multiply(1-this.easedTransitionProgress()))}),v.push(G),e.cachedRenderTree=Xe.wrap(v).optimized(),e.cachedRenderTree}}let _=[];for(let y=u,I=r.length;y<I;y=y+1){let p=Ne.renderTreeForOverlayBackground(r[y].backgroundAppearance(),o.canvasSpaceBoundingBox()),A=null;p!=null&&(A=()=>1-this.easedTransitionProgress(),_.push(pt.forOpacity(p,Ct.EXITING_OVERLAY_BACKGROUND,A)));let v=r[y].renderedOrigin(o).subtract1(a),E=((b=r[y].node())==null?void 0:b.size())??ye.FrozenVector_new1(),D=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(t.transitionParameters.transitionType)!=-1?o.size().subtract1(v.add1(E)):v,G=E.add1(D),U=()=>G.multiply1(d.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress())),M=this._renderTreeForOverlay2(r[y],o,y,A,h,U);h!=null&&h.removeEntry(r[y].id()),M!=null&&(M=pt.forOpacity(M,Ct.EXITING_OVERLAY,()=>d.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),M=pt.forTranslation(M,Ct.EXITING_OVERLAY,U),_.push(M))}let f=[];for(let y=u,I=n.length;y<I;y=y+1){let p=Ne.renderTreeForOverlayBackground(n[y].backgroundAppearance(),o.canvasSpaceBoundingBox()),A=null;p!=null&&(A=()=>this.easedTransitionProgress(),f.push(pt.forOpacity(p,Ct.ENTERING_OVERLAY_BACKGROUND,A)));let v=n[y].renderedOrigin(o).subtract1(a),E=((T=n[y].node())==null?void 0:T.size())??ye.FrozenVector_new1(),D=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(t.transitionParameters.transitionType)!=-1?o.size().subtract1(v.add1(E)):v,G=E.add1(D),U=()=>G.multiply1(d.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())),M=this._renderTreeForOverlay2(n[y],o,y,A,h,U);M!=null&&(M=pt.forOpacity(M,Ct.ENTERING_OVERLAY,()=>d.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),M=pt.forTranslation(M,Ct.ENTERING_OVERLAY,U),f.push(M))}let S=[];if(Or(S,l),d.isDissolve()){let y=Ct.DISSOLVE_TRANSITION,I=Xe.wrap(_),p=Xe.wrap(f);S.push(new en(I,p,y,()=>this.easedTransitionProgress()))}else Or(S,_),Or(S,f);return e.cachedRenderTree=Xe.wrap(S),e.cachedRenderTree}_onBeforeFrameForTransition(){if(this._ongoingTransition!=null&&(this._transitionProgressTracker.advanceToNextFrame(),!this._transitionProgressTracker.isTransitionInProgress()))switch(this._maybeLogPerformanceMetricsForTransition(),this._transitionProgressTracker.transitionEnded()){case Ln.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case Ln.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}_onBeforeFrameForHsm(){this._hsmTransitionMap.size!=0&&Array.from(this._hsmTransitionMap.keys()).forEach(e=>{if(Array.from(this._hsmTransitionMap.keys()).indexOf(e)!=-1){let t=this._hsmTransitionMap.get(e),r=t.tracker;if(r.advanceToNextFrame(),!r.isTransitionInProgress()){let n=r.transitionEnded(),o=this._appState.prototypeState(),a=t.change;if(o.getStateMachineInitiatedChange(a.stablePath)==a)switch(n){case Ln.TransitionEndedAction.COMMIT:{o.commitChangesBelowInstanceTransitionRoot(a.stablePath);let s=this._appState.scene().findNodeByStablePath(a.stablePath);s!=null&&this._dirtinessTracker.dirtyNode(s);break}case Ln.TransitionEndedAction.ABORT:{o.abortInstanceStateChange(a.stablePath);break}}}}})}currentCanvasSpacePreviewBounds(){if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let n=this._appState.prototypeState(),o=n.lastNodeForBaseScreen(),a=n.nextNodeForBaseScreen()??n.lastNodeForBaseScreen();return this.canvasSpacePreviewBoundsForTransition(o,a)}let t=this._appState.baseScreenNode();return this.canvasSpacePreviewBoundsForTransition(t,t)}currentCanvasSpaceFrameBounds(){if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let n=this._appState.prototypeState(),o=n.lastNodeForBaseScreen(),a=n.nextNodeForBaseScreen()??n.lastNodeForBaseScreen();return this.canvasSpaceFrameBoundsForTransition(o,a)}let t=this._appState.baseScreenNode();return this.canvasSpaceFrameBoundsForTransition(t,t)}canvasSpacePreviewBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!J.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let r=ye.FrozenVector_ZERO,n=ye.FrozenVector_ZERO,o=0,a=0;e!=null&&(r=e.canvasSpaceBoundingBox().size(),e.strokeGeometry()!=null&&e.strokeGeometry().bounds.isFinite()&&e.strokeAlign()!="INSIDE"&&(o=Math.abs(e.strokeGeometry().bounds.left()))),n=t.canvasSpaceBoundingBox().size(),t.strokeGeometry()!=null&&t.strokeGeometry().bounds.isFinite()&&t.strokeAlign()!="INSIDE"&&(a=Math.abs(t.strokeGeometry().bounds.left()));let s=r.max2(n),l=new V(0,0,s.x(),s.y()),c=Math.max(o,a),d=ee.new2().translatedBy1(t.canvasSpaceBoundingBox().center()).translatedBy1(l.center().negative());return l.transformInto1(l,d),l.expand1(c),l}return t.canvasSpacePreviewBounds()}canvasSpaceFrameBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!J.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let r=e!=null?e.size():ye.FrozenVector_ZERO,n=t.size(),o=r.max2(n),a=new V(0,0,o.x(),o.y());return a.transformInto1(a,t.absoluteTransform()),a}return e.canvasSpaceBoundingBox()}ongoingPrototypeStateChange(){var e;return(e=this._ongoingTransition)==null?void 0:e.change}transitionProgressTracker(){return this._transitionProgressTracker}renderLayerByLayerActivate(e){this._renderer.renderLayerByLayerActivate(e)}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}_createContext(){return new O.HTMLContext}attachTo(e){e.element().appendChild(this._context.gl().canvas)}removeFrom(e){e.element().removeChild(this._context.gl().canvas),this._uninitialize()}};Mn.VERBOSE_LOGS=!1,Mn.PERF_TRACKING=!1;var Oa=Mn;(t=>{class i{constructor(n,o){this.change=null,this.viewportBeforeTransition=null,this.cachedRenderTree=null,this.change=n,this.viewportBeforeTransition=new qo,this.viewportBeforeTransition.copyFrom(o)}}t.TransitionState=i;class e{constructor(n,o,a){this.tracker=n,this.progress=o,this.change=a}}t.InstanceSwapTransition=e})(Oa||(Oa={}));var bl=class{constructor(e,t){this._ballisticSimulation=null,this._scrollingNodeID=null,this._isValid=!1,this._ballisticSimulation=e,this._scrollingNodeID=t,this._isValid=e!=null}nodeID(){return this._scrollingNodeID}simulation(){return this._ballisticSimulation}isOverscrolled(){return this._ballisticSimulation.isOverscrolled()}isValid(e){return e!=null&&e.findNode(this._scrollingNodeID)!=null}isDone(){return this._ballisticSimulation.isDone1()}performScroll(e,t){if(!this.isValid(t))return;let r=this._ballisticSimulation.pos1(),n=t.findNode(this._scrollingNodeID);e.setScrollOffsetUnconditionally(n,r)}};var nd=class{uninit(){this._semanticScrollStorage.uninitialize1()}getValueFromStorage(e){let t=new Kt(e),r=vr.getSemanticNodePath(t);return this._semanticScrollStorage.getData(r,vr.DEFAULT_STORAGE_KEY)}setValueInStorage(e,t){let r=new Kt(e),n=vr.getSemanticNodePath(r);this._semanticScrollStorage.insert(n,vr.DEFAULT_STORAGE_KEY,t)}_getOldNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode(e.oldStateId()):this._appState.scene().findNodeByStablePath(e.stablePath)}_getNewNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode(e.newStateId()):this._appState.scene().findNodeByStablePath(e.stablePath)}commitCurrentScrollStateToStorage(e){let t=this._getOldNode(e);this._recursivelyRecordOffsets(t);for(let r=0,n=e.oldStateAndOverlays.overlays.length;r<n;r=r+1){let o=e.oldStateAndOverlays.overlays[r].id,a=this._appState.scene().findNode(o);this._recursivelyRecordOffsets(a)}}applyStoredScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelySetOffsets(t);for(let r=0,n=e.newStateAndOverlays.overlays.length;r<n;r=r+1){let o=e.newStateAndOverlays.overlays[r].id,a=this._appState.scene().findNode(o);this._recursivelySetOffsets(a)}}resetScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelyResetOffsets(t);for(let r=0,n=e.newStateAndOverlays.overlays.length;r<n;r=r+1){let o=e.newStateAndOverlays.overlays[r].id,a=this._appState.scene().findNode(o);this._recursivelyResetOffsets(a)}}_recursivelyRecordOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&this.setValueInStorage(e,e.scrollOffset()),e.forEachChild(t=>{this._recursivelyRecordOffsets(t)}))}_recursivelySetOffsets(e){if(e!=null){if(e.scrollDirection()!="NONE"){let t=this.getValueFromStorage(e);t!=null?t.equals(e.scrollOffset())||(De.trackDefinedEvent("prototype.viewer_scroll_state_transferred",{}),e.setScrollOffset(this._canvasView.restrictScrollDeltaAxes(e,t))):e.setScrollOffset(ye.FrozenVector_ZERO)}e.forEachChild(t=>{this._recursivelySetOffsets(t)})}}_recursivelyResetOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&(De.trackDefinedEvent("prototype.viewer_scroll_state_reset",{}),e.setScrollOffset(ye.FrozenVector_ZERO),this.setValueInStorage(e,ye.FrozenVector_ZERO)),e.forEachChild(t=>{this._recursivelyResetOffsets(t)}))}toString(){return this._semanticScrollStorage.toString2(e=>e.toString())}constructor(e,t){this._canvasView=e,this._appState=t,this._semanticScrollStorage=new ya}};var Wp=class{constructor(e,t,r,n,o,a,s,l){this.hotspot=e,this.prototypeInteraction=t,this.action=r,this.viewSpacePointOrNull=n,this.prototypeAction=o,this.connectionType=a,this.actionIndexPath=s,this.resolvedVariableModes=l}},Qp=class{constructor(e,t){this._queue=null,this._canvasView=null,this._prototypeState=null,this._queue=[],this._canvasView=e,this._prototypeState=t,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this),this._canvasView.addObserver(this)}appendToQueue(e,t,r,n,o,a,s,l){this._queue.push(new Wp(e,t,r,n,o,a,s,l))}insertInQueue(e,t,r,n,o,a,s,l,c){this._queue.splice(l,0,new Wp(e,t,r,n,o,a,s,c))}runNextAction(){if(this._queue.length>0){let e=this._queue.shift();e!=null&&this._runAction(e)}}_runAction(e){this._canvasView.runAction(e.hotspot,e.prototypeInteraction,e.action,e.viewSpacePointOrNull,e.prototypeAction,e.connectionType,e.actionIndexPath,e.resolvedVariableModes)}handleStateChangeAborted(e){this._queue.length=0}handleStateChangeCommitted(e,t){if(this._queue.length>0&&this._shouldProcessAction(e)){let r=this._queue.shift();r!=null&&t(()=>{this._runAction(r)})}}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._queue.length=0}handleHsmAborted(e,t){this._queue.length=0}handleHsmCommitted(e,t,r){if(this._queue.length>0&&this._shouldProcessAction(t)){let n=this._queue.shift();n!=null&&r(()=>{this._runAction(n)})}}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}willTriggerHotspot(e,t,r,n){(r==4||r==8||r==9||r==3)&&(this._queue.length=0)}didScrollNode(e){}_shouldProcessAction(e){return!(e.cause==6||e.cause==7)}};var hs;(n=>{function i(o){return o.stateManagementVersion()==1}n.newStateManagementRulesEnabledForChange=i;function e(){return n._seenOldStateManagementInteraction}n.seenOldStateManagementInteraction=e;function t(){n._seenOldStateManagementInteraction=!0}n.markOldStateManagementInteractionSeen=t,n._seenOldStateManagementInteraction=!1})(hs||(hs={}));var yl;(o=>{let i=()=>null,e=()=>null;function t(a,s){a&&(i=a),s&&(e=s)}o.initialize=t;function r(a){return i(a)}o.getStatsigExpConfig=r;function n(a){return e(a)}o.getStatsigExpConfigWithoutExposureLogging=n})(yl||(yl={}));var ms=class{static initializeStatsigConfigsWithoutExposureLogging(){this.statsigValidationConfig=yl.getStatsigExpConfigWithoutExposureLogging("render_animation_statsig_evaluation")}static getStatsigValidationConfig(){return this.statsigValidationConfig}};ms.statsigValidationConfig=null;var Kp=class{check(e){(!this._lastOffset.equals(e.offset())||this._lastZoomScale!=e.zoomScale())&&(this._lastOffset=e.offset(),this._lastZoomScale=e.zoomScale(),this.onChange!=null&&this.onChange(this._lastOffset,this._lastZoomScale))}resetStateForTests(){this._lastOffset=ye.FrozenVector_ZERO,this._lastZoomScale=0}constructor(){this._lastOffset=ye.FrozenVector_ZERO,this._lastZoomScale=0,this.onChange=null}};var qg=(t=>(t[t.SHORTCUT=0]="SHORTCUT",t[t.SCROLL=1]="SCROLL",t))(qg||{});var qp=class{constructor(e,t){this.swappedStablePath=e,this.hotspotStablePath=t}},Yp=class{willTriggerHotspot(e,t,r,n){this.willTriggerHotspotCallback!=null&&this.willTriggerHotspotCallback(e,t,r,n)}didScrollNode(e){this.didScrollNodeCallback!=null&&this.didScrollNodeCallback(e)}constructor(e,t){this.willTriggerHotspotCallback=e,this.didScrollNodeCallback=t}},Tl=class i{constructor(e,t){this.FRAMES_TO_FINISH_RENDERING=3,this._state=i.State.INACTIVE,this._framesToFinishRendering=0,this._observers=new zr,this._emitter=null,e.addObserver(this),this._emitter=t}onFrame(){this._state==i.State.WAITING_TO_FINISH&&(this._framesToFinishRendering==0?(this._emitter.trigger("renderingStop"),this._observers.forEach(e=>{e.handleRenderingStop()}),this._state=i.State.INACTIVE):this._framesToFinishRendering=this._framesToFinishRendering-1)}handleSetNeedsBlit(e){this._state==i.State.INACTIVE?e&&(this._emitter.trigger("renderingStart"),this._observers.forEach(t=>{t.handleRenderingStart()}),this._state=i.State.ACTIVE):this._state==i.State.ACTIVE?e||(this._state=i.State.WAITING_TO_FINISH,this._framesToFinishRendering=this.FRAMES_TO_FINISH_RENDERING):e&&(this._state=i.State.ACTIVE)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}};(e=>{let i;(o=>(o[o.ACTIVE=0]="ACTIVE",o[o.INACTIVE=1]="INACTIVE",o[o.WAITING_TO_FINISH=2]="WAITING_TO_FINISH"))(i=e.State||(e.State={}))})(Tl||(Tl={}));var me=class me extends $l{constructor(t){super();this._appState=null,this._observers=new zr,this._renderer=null,this._renderingStateTracker=null,this._idlenessTracker=null,this._transitionBehaviorManager=null,this._scrollSyncer=null,this._sequentialActionManager=null,this._viewportTracker=new Kp,this._viewport=new qo,this._hotspotAnimation=new Op,this._uiRenderData=new xp,this._showHotspots=!0,this._multiplayer=null,this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=!1,this._mostRecentFrameNum=0,this._microtasksSinceLastFrame=0,this.MAX_MICROTASKS_PER_FRAME=2,this.onResize=null,this.onBaseScreenIdChanged=null,this.userDidAttemptZoom=null,this.disengageObservationMode=null,this.onURLClicked=null,this.onNavigateToPrototype=null,this.afterFrame=null,this.afterFirstRenderOfScreenStack=null,this._emitter=null,this._pointerEventDelegate=null,this.INTERACTION_REPORTING_RATE=10/100,this._currentMouseLocation=null,this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedData=new Fp,this._mouseEnteredNodesManager=null,this._initialFlingVelocity=new R(0,0),this._interactionObservers=new zr,this.ALT_CODE=18,this.SHIFT_CODE=16,this.META_CODE=91,this.CONTROL_CODE=17,this._appState=t,this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._emitter=$t.getEventEmitter(),this.makeRenderer(),this.setPhysicsForOS(this.getRelevantOS()),this._idlenessTracker=new Pp(r=>{this._renderer.setZoomScale(r)},this._emitter),this._pointerEventDelegate=new me.CanvasPointerEventDelegate(this),this._scrollSyncer=new nd(this,this._appState),this._sequentialActionManager=new Qp(this,this._appState.prototypeState()),this._mouseEnteredNodesManager=new Dp(this._appState)}addObserver(t){this._observers.add(t)}removeObserver(t){this._observers.remove(t)}setBackgroundEnabled(t){this._renderer.setBackgroundEnabled(t)}renderingStateTracker(){return this._renderingStateTracker}makeRenderer(){let t=this._renderer;t!=null&&t.removeFrom(this),X.getFeatureFlags().viewer_disable_rendering?this._renderer=new zp:this._renderer=new Oa(this._viewport,this._appState,this._appState.imageManager(),this._emitter),this._transitionBehaviorManager!=null&&this._transitionBehaviorManager.removeFrom(this),this._transitionBehaviorManager=new Bp(this),this._renderingStateTracker!=null&&this._appState.removeFrameObserver(this._renderingStateTracker),this._renderingStateTracker=new Tl(this._renderer,this._emitter),this._appState.addFrameObserver(this._renderingStateTracker),t!=null&&this._renderer!=null&&this._renderer.attachTo(this)}graphicsCardName(){return this._renderer.graphicsCardName()}deviceRenderer(){return this._renderer.deviceRenderer()}slideThumbnailRenderer(){return this._renderer.slideThumbnailRenderer()}getContext(){return this._renderer.getContext()}appState(){return this._appState}idlenessTracker(){return this._idlenessTracker}viewport(){return this._viewport}viewportTracker(){return this._viewportTracker}mostRecentFrameNum(){return this._mostRecentFrameNum}setScrollPadding(t,r,n,o){this._viewport.setScrollPadding([t,r,n,o])}setMultiplayer(t){this._multiplayer=t}setShowHotspots(t){this._showHotspots=t}handleSceneChange(t,r){t!=null&&t.removeObserver(this),r!=null&&r.addObserver(this),this._viewport.invalidate(),this._invalidateZoomScaleForRender(),this._idlenessTracker.handleSceneChange(),this._setCurrentViewportSizeOnCanvas()}resetStateForTests(){this._viewport.resetStateForTests(),this._viewportTracker.resetStateForTests(),this._appState.resetStateForTests(),this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedData.resetAllEntries(),this._pointerEventDelegate.resetStateForTests(),this._mouseEnteredNodesManager.reset(),this._appState.prototypeState().addHsmObserver(this)}handleActiveCanvasChange(t,r){r!=null?this._viewport.invalidate():this._currentMouseLocation=null}handleActivePrototypeStartingPointChange(t,r){}afterEnteredViewer(){this._appState.nodeTransitionTracker().triggerPotentialTimedTransition=()=>{let t=this._appState.prototypeState(),r=[];t.getCurrentBaseScreenNode()!=null&&r.push(t.getCurrentBaseScreenNode());for(let n=0,o=t.getCurrentOverlayData().length;n<o;n=n+1)r.push(t.nodeForOverlayAt(n));this._triggerPotentialTimedTransition(r,0)},this._appState.nodeTransitionTracker().createVideoTriggerEventsForNodesInFrame=t=>{t&&this._createVideoTriggerEvents([t])},this._appState.nodeTransitionTracker().createVideoTriggerEventsForAllNodesOnscreen=()=>{let t=[],r=this._appState.prototypeState();r.getCurrentBaseScreenNode()!=null&&t.push(r.getCurrentBaseScreenNode());for(let n=0,o=r.getCurrentOverlayData().length;n<o;n=n+1)t.push(r.nodeForOverlayAt(n));this._createVideoTriggerEvents(t)}}navigateForward(t){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenNode();if(n==null)return;let o=null;this._appState.prototypeStructure().currentType()==1?o=this._appState.prototypeState().getNextBaseScreenNodeForFrameList():o=this._appState.prototypeState().getNextBaseScreenNodeForPrototype(),o!=null&&this.navigateViaArrows(n.id(),o.id(),0,t)}navigateBackward(t){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenNode();if(n==null)return;let o=this._appState.prototypeState().getPreviousBaseScreenNode();o!=null&&this.navigateViaArrows(n.id(),o.id(),1,t)}navigateToFrameAtIndex(t){let r=this._appState.prototypeState().getCurrentBaseScreenId();if(r==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenIndex(),o=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();if(t<0||t>o.length-1||t==n)return;let a=J.fromString(o[t]),s=n<t?0:1;this.navigateViaArrows(r,a,s,null)}navigateViaArrows(t,r,n,o){this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,Math.random()<this.INTERACTION_REPORTING_RATE&&De.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:bn[n],nonInteraction:0,prototypeType:Xi[this._appState.prototypeStructure().currentType()]});let a=this._appState.prototypeState().getCurrentBaseScreenNode();if(a!=null&&a.prototypeInteractions().length!=0){let s=null;for(let l=0,c=a.prototypeInteractions().length;l<c;l=l+1){let d=a.prototypeInteractions()[l],h=(d==null?void 0:d.action())!=null?d.action().value:null;if(d!=null&&d.allActions().length>0)for(let m of d.allActions())m.transitionNodeID()!=null&&m.transitionNodeID()==r&&(h=m);let u=h!=null?this._appState.scene().findNode(h.transitionNodeID()):null;if(u!=null){let m=qt.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),a==null?void 0:a.id(),u==null?void 0:u.id(),h.navigationType(),h.connectionType());s=m??null}if(J.equals(s,r)){this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,a,1,n,o,d,h);return}}}this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,null,1,n,o,null,null)}_navigateToHyperlink(t,r){var n;if(t.hyperlink.url!==void 0){this.onURLClicked(t.hyperlink.url,!0);return}else if(t.hyperlink.guid!==void 0){let o=It.decodeGUID(t.hyperlink.guid);if(J.equals(o,this._appState.getActiveCanvas().id())){this._appState.prototypeState().restartPrototype(1);return}let a=this._appState.scene().findNode(o),s=qt.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),(n=t.node)==null?void 0:n.id(),a==null?void 0:a.id(),r,"URL");if(s!=null){this._appState.prototypeState().navigateToFrameAndCloseOverlays(s);return}let l=this._appState.currentFileKey();this.onNavigateToPrototype(l,o)}}triggerHotspot(t,r,n,o){if(this._multiplayer.isObserving()||(this._observers.forEach(s=>{s.willTriggerHotspot(t,r,n,o)}),r==null||r.actions().length==0))return;!hs.seenOldStateManagementInteraction()&&r.stateManagementVersion()==0&&(De.trackDefinedEvent("prototype.viewer_old_noodle_used",{}),hs.markOldStateManagementInteractionSeen());let a=t.node.getResolvedVariableModes();for(let s=0,l=r.actions().length;s<l;s=s+1){let c=r.actions()[s],d=c.connectionType();Math.random()<this.INTERACTION_REPORTING_RATE&&De.trackEvent("prototype_view_interaction",{type:"triggerHotspot",transitionAction:ut[n],transitionType:c==null?void 0:c.transitionType(),action:d=="INTERNAL_NODE"?c==null?void 0:c.navigationType():d=="UPDATE_MEDIA_RUNTIME"?c==null?void 0:c.mediaAction():d,nonInteraction:0}),X.getViewerMode()==X.ViewerMode.MIRROR&&De.trackDefinedEvent("mobile_platform.first_prototype_interaction_mirror",{}),this._sequentialActionManager.appendToQueue(t,r,n,o,c,d,[s],a)}this._sequentialActionManager.runNextAction()}runAction(t,r,n,o,a,s,l,c){let d=!0;switch(s){case"INTERNAL_NODE":{let h=a.transitionNodeID();this._performNavigationOrOverlayChangeForHotspot(t.node,h,n,r,o,l),a.navigationType()=="SCROLL_TO"&&a.transitionType()!="SCROLL_ANIMATE"||(d=!1);break}case"URL":{t.hyperlink==null?this.onURLClicked(a.connectionURL(),a.openUrlInNewTab()):this._navigateToHyperlink(t,a.navigationType());break}case"BACK":{this.requestBack(t.node,r,1,ut.fromInteractionType(r.event().interactionType()),Kr.fromPrototypeAction(a,r.stateManagementVersion()),a),d=!1;break}case"CLOSE":{this._appState.prototypeState().closeOverlayForHotspot(t.node,r,1,a),d=!1;break}case"SET_VARIABLE":{let h=L();if(h.fonts().isWaitingForFontList())return;let u=t.node.id();t.node.isOrInInstance()&&(u=t.node.findContainingPrimaryInstance().id());let m=h.getICActionsForSetVariableAction(u,a.targetVariableID(),a.targetVariableData(),this._appState.prototypeState().getTopmostScreenId(),c);if(m.length>0){let _=_n.instance.setReverseVariantBindingsForICsDisabled(!0);for(let f of m){let b=t.node.scene().findNode(f.nodeToSwap),T=b.prototypeInteractions()[f.interactionIndex];this.runAction(new No(b),T,0,null,T.actions()[f.actionIndex],"INTERNAL_NODE",[f.actionIndex],c)}_n.instance.setReverseVariantBindingsForICsDisabled(_),d=!1}let g=L().runSetVariable(u,a.targetVariableID(),a.targetVariableData(),c);this._appState.prototypeState().createMultiplayerSetVariableAction(u,a.targetVariableID(),g,c);break}case"SET_VARIABLE_MODE":{let h=t.node.id();t.node.isOrInInstance()&&(h=t.node.findContainingPrimaryInstance().id()),L().runSetVariableMode(h,a.targetVariableSetKey(),a.targetVariableModeID()),this._appState.prototypeState().createMultiplayerSetVariableModeAction(h,a.targetVariableSetKey(),a.targetVariableModeID());break}case"UPDATE_MEDIA_RUNTIME":{this._appState.videoManager().updateVideoRuntime(a,t.node.id());break}case"CONDITIONAL":{if(L().fonts().isWaitingForFontList()||a.conditionalActions().length==0)return;let h=t.node.id();t.node.isOrInInstance()&&(h=t.node.findContainingPrimaryInstance().id());let u=L().getFirstTruthyConditionalIndex(h,a.conditionalActions()[0].condition());if(u>=0&&u<a.conditionalActions().length){let g=a.conditionalActions()[u].actions();for(let _=0,f=g.length;_<f;_=_+1){let S=g[_],b=[l[0],u,_];this._sequentialActionManager.insertInQueue(t,r,n,o,S,S.connectionType(),b,_,c)}}break}}d&&this._sequentialActionManager.runNextAction()}triggerDelayedHotspot(t,r,n){var a;let o=(a=this._appState.scene())==null?void 0:a.findNode(t);o!=null&&this.triggerHotspot(new No(o),r,n,null)}_findPrototypeActionGivenActionIndexPath(t,r){let n=t.actions(),o=r[0];if(o<n.length){let a=n[o];if(r.length>2){let s=r[1],l=r[2];if(a.conditionalActions()!=null&&a.conditionalActions().length>s){let c=a.conditionalActions()[s];if(c.actions()!=null&&c.actions().length>l)return c.actions()[l]}}return a}return null}_performNavigationOrOverlayChangeForHotspot(t,r,n,o,a,s){var c;this._mostRecentTransitionViaArrows=!1,this._mostRecentTransitionViaArrowsLegacy=a==null;let l=this._findPrototypeActionGivenActionIndexPath(o,s);if(t==null&&Le("Hotspot node unexepectedly null when performing navigation or overlay change for hotspot"),t==null||l.navigationType()=="NAVIGATE"||l.navigationType()=="SWAP"&&this._appState.prototypeState().getTopmostOverlayId()==null)this._appState.prototypeState().navigateToFrameAndCloseOverlays(r,t,1,0,n,o,l);else if(l.navigationType()=="SCROLL_TO")this.scrollToDestinationInFrame(r,o);else if(l.navigationType()=="OVERLAY")this._appState.prototypeState().overlayFrame(r,t,0,n,o,l);else if(l.navigationType()=="SWAP")this._appState.prototypeState().swapTopOverlay(r,t,n,o,l);else if(l.navigationType()=="SWAP_STATE"){if(L().fonts().isWaitingForFontList())return;let d=(c=Zt.whichInstanceToSwap(t,l.transitionNodeID()))==null?void 0:c.stablePath();d!=null&&this._appState.prototypeState().swapInstanceToState2(d,r,t,n,o,1,l)}}requestBack(t,r,n,o,a,s){this._appState.prototypeState().returnToState2(t,r,n,o,a,s)}handleHsmAborted(t,r){this._renderer.abortHsmTransition(t,r),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath);let n=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(t,o=>(n.push(this._appState.scene().findNodeByStablePath(o)),0)),this._onCommitOrAbortForInteractions(n,r.cause,r.oldStateId())}handleHsmCommitted(t,r,n){this._renderer.commitHsmTransition(t,r),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath);let o=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(t,a=>(o.push(this._appState.scene().findNodeByStablePath(a)),0)),n(()=>{this._onCommitOrAbortForInteractions(o,r.cause,r.oldStateId())})}handleHsmRequested(t,r){hs.newStateManagementRulesEnabledForChange(r)&&this._scrollSyncer.commitCurrentScrollStateToStorage(r)}handleHsmInitiated(t,r){hs.newStateManagementRulesEnabledForChange(r)&&(r.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(r):this._scrollSyncer.resetScrollStateToScene(r));let n=this._transitionBehaviorManager.getTransitionMixinForStateSwap(this._appState.scene(),r,this._multiplayer.isObserving());this._renderer.triggerHsmTransition(t,r,n),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(r.stablePath)}handleStateChangeAborted(t){this._updateCanvasForCurrentBaseScreen();let r=null,n=[];J.equals(t.oldStateId(),t.newStateId())||n.push(t.oldStateId());let o=t.oldOverlayData(),a=t.newOverlayData();for(let s=0,l=o.length;s<l;s=s+1)(s>=a.length||!J.equals(o[s].id,a[s].id))&&n.push(o[s].id);r=n.map(s=>{var l;return(l=this._appState.scene())==null?void 0:l.findNode(s)}).filter(s=>s!=null),!J.equals(t.oldStateId(),t.newStateId())&&this.onBaseScreenIdChanged!=null&&this.onBaseScreenIdChanged(t.oldStateId(),ut.getControlSource(t.cause),!t.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState()),this._renderer.handleAbortedTransition(t),this._updateViewportForCurrentPreview(),this._appState.currentFitMode()==4&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate(),this._onCommitOrAbortForInteractions(r,t.cause,t.oldStateId())}handleStateChangeCommitted(t,r){this._updateCanvasForCurrentBaseScreen(),this._renderer.handleCommittedTransition(t);let n=t.getNewOrChangedFrameIds().map(a=>{var s;return(s=this._appState.scene())==null?void 0:s.findNode(a)}).filter(a=>a!=null),o=this._appState.scene().findNode(this._appState.prototypeState().getTopmostScreenId());o!=null&&Wr(o,a=>(a!=o&&a.isInstance()&&n.push(a),0)),r(()=>{this._onCommitOrAbortForInteractions(n,t.cause,t.oldStateId())})}handleStateChangeInitiated(t){if(this._updateCanvasForCurrentBaseScreen(),this._appState.baseScreenNode()==null&&!X.isInlinePreview()){console.warn("no current TLF after receiving update");return}this.setPhysicsForOS(this.getRelevantOS());let r=this._transitionBehaviorManager.getTransitionMixin(this._appState.scene(),t,this._multiplayer.isObserving());this._renderer.triggerTransition(t,this._viewport,r),this.setPhysicsForOS(this.getRelevantOS()),!J.equals(t==null?void 0:t.oldStateId(),t==null?void 0:t.newStateId())&&this.onBaseScreenIdChanged!=null&&this.onBaseScreenIdChanged(t.newStateId(),ut.getControlSource(t.cause),!t.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState());let n=this._appState.prototypeState();if(t.stateManagementVersion()==1)this._scrollSyncer.commitCurrentScrollStateToStorage(t),t.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(t):this._scrollSyncer.resetScrollStateToScene(t);else if(t.preserveScroll()==1)me.matchNodesAndPreserveScroll(this,n,t);else{let o=t.getNewOrChangedFrameIds().map(a=>{var s;return(s=this._appState.scene())==null?void 0:s.findNode(a)});for(let a of o)this._resetScrollForTlf(a)}this._pointerEventDelegate.unlockScroll(),this._updateViewportForCurrentPreview(),this._appState.currentFitMode()==4&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate()}handleStateChangeRequested(t){}handleFitModeChange(t,r){this._appState.baseScreenNode()!=null&&!to.topLevelFramesCanScroll(this._appState.prototypeState().getCurrentFitMode())&&(this._appState.activePrototypeDevice()!=null&&pa.hasDevice(this._appState.activePrototypeDevice().type)||this.updateScrollOffsetForNode(this._appState.baseScreenNode(),new R(0,0))),this._renderer.changeFitMode(r),this._setCurrentViewportSizeOnCanvas()}handleRestartPrototype(){this._scrollSyncer.uninit(),this.cancelAnimationManager(),this._mouseEnteredNodesManager.reset()}_updateCanvasForCurrentBaseScreen(){let t=this._appState.baseScreenNode();(t==null?void 0:t.canvas())!=null&&(this._appState.setActiveCanvas(t.canvas()),this._setCurrentViewportSizeOnCanvas())}_updateViewportForCurrentPreview(){let t=this._renderer.currentCanvasSpaceFrameBounds(),r=this._renderer.currentCanvasSpacePreviewBounds();t!=null&&r!=null?this._viewport.updateForCurrentPreview(t,r,this._appState.currentFitMode(),this._appState.activePrototypeDevice()):this._viewport.updateForBaseScreen(this._appState.baseScreenNode(),this._appState.currentFitMode(),this._appState.activePrototypeDevice())}_invalidateZoomScaleForRender(){this._idlenessTracker.updateZoomScaleNow(this._viewport.zoomScale())}handleSceneGraphEvent(t){J.equals(t.node.id(),this._appState.baseScreenId())?t.property==25?this._updateCanvasForCurrentBaseScreen():t.property==49&&this._updateViewportForCurrentPreview():t.property==66&&(this._updateViewportForCurrentPreview(),this._invalidateZoomScaleForRender(),this._maybeChangePhysicsForDevice(t.oldVal)),this._handleScrollingPropertyChange(t.node,t.property,t.oldVal,t.newVal),t.property!=62&&this._viewport.invalidate()}handleAction(t,r){switch(t){case 1:{if(X.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,2),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 2:{if(X.isInlinePreview())break;this._viewport.adjustCameraZoomRounded(1,.5),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 3:{this._viewport.setCameraZoom(1,1),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 4:{if(X.isInlinePreview())break;this.canvasContentBounds()!=null&&this._viewport.zoomToFit2(1,this.canvasContentBounds()),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}}}setup(){this._setupInteractionHandlers(this._emitter),Hr.addUpdate(Yt.windowResize(this.events()),t=>{this._resize()}),Hr.addUpdate(Yt.windowFrame(this.window().events()),t=>{this._onFrame()}),this._renderer.attachTo(this),this._resize(),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}canvasSpaceToWindowSpace(){let t=Nn.new2();return t.translate2(this._viewport.viewSpaceBounds().topLeft()),t.multiply(this._viewport.canvasSpaceToViewSpace1()),t}_tryResizingTo(t){this._viewport.setBounds(new V(0,0,t.x(),t.y())),this._updateViewportForCurrentPreview();let r=this._renderer.resize(t.x(),t.y(),this._viewport.zoomScale(),Jn());return this.onResize!=null&&(this._setCurrentViewportSizeOnCanvas(),this.onResize()),this._idlenessTracker.handleInteraction(),r}_resize(){let t=this.absoluteBounds(),r=ye.FrozenVector_new4(t.width(),t.height()),n=this._tryResizingTo(r),o=n.canvasSize;if(n.webGLDidAdjustCanvasSize){let a=this._tryResizingTo(o).canvasSize}}_setCurrentViewportSizeOnCanvas(){let t=this._appState.baseScreenNode();if(t==null)return;let r=t.findContainingCanvasOrSelf();if(r==null)return;let n=null,o=this._appState.prototypeState().getCurrentFitMode();if(o==1||o==2)n=ye.FrozenVector_INFINITY;else if(o==5||o==6){let a=this._viewport.getScaleFactorForCurrentTlf(t.fullSize(),o,r.prototypeDevice()),s=this._viewport.viewSpaceBounds().size().y()/a;n=new R(1/0,s)}else n=this._viewport.viewSpaceBounds().size();r.currentViewportSize().equals(n)||r.setCurrentViewportSize(n)}renderingIsComplete(){return this._renderer.isRenderingDone()}isTopLevelTransitionOngoing(){return this._renderer.isTopLevelTransitionOngoing()}dangerouslyAccessProtoRenderManager(){return this._renderer}clearTileCaches(){this._renderer.clearTileCaches()}_onFrame(){var o;this._mostRecentFrameNum=this._mostRecentFrameNum+1,this._microtasksSinceLastFrame=0,this._appState.onFrame();let t=this._appState.getActiveCanvas();if(t==null)return;if(X.getFeatureFlags().rendering_statsig_evaluation){let a=ms.getStatsigValidationConfig();Lt.encounteredStatsigEvaluation(a!=null?a.getValue("testValue","defaultVal"):"nullConfig")}this._clampDirtyScrollContainers(),me._scrollAnimationManager!=null&&this._updateForAnimation(),(this._idlenessTracker.justInteracted()||this._renderer.checkNeedsBlit())&&this._renderer.setNeedsBlit(!0),this._idlenessTracker.advanceFrame(this._viewport),this._viewportTracker.check(this._viewport),this._viewport.prepareForRendering(),this._updateViewportForCurrentPreview(),this._appState.baseScreenNode()!=null&&this._sendMouseCursorUpdate(),this._updateScrollOffsetsFromMultiplayer();let r=this._appState.baseScreenNode()!=null&&this._appState.baseScreenNode().visible();if(!r)X.isInlinePreview()||De.trackDefinedEvent("prototype.draw_blank",{hasScene:!!this._appState.scene(),hasBaseScreenId:!!this._appState.prototypeState().getCurrentBaseScreenId(),hasBaseScreen:!!this._appState.baseScreenNode(),baseScreenVisible:!!((o=this._appState.baseScreenNode())!=null&&o.visible())}),this._renderer.drawBlank();else{this._appState.renderDots()?this._uiRenderData.backgroundColor=C.WHITE:this._uiRenderData.backgroundColor=bu(this._appState.baseScreenId(),this._appState.currentFitMode(),t),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspots=this._findHotspotsToAnimate(),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspotOpacity=this._hotspotAnimation.getOpacity(),this._uiRenderData.particles=this._multiplayer.getParticles(),this._uiRenderData.mouse=this._multiplayer.getMouse(),this._uiRenderData.renderDots=this._appState.renderDots(),De.appTimerStart("rendererDraw");let a=this._renderer.draw(this._idlenessTracker.zoomInProgress(),this._idlenessTracker.shouldRenderOptionalTiles(),this._viewport,this._uiRenderData);De.appTimerStop("rendererDraw"),this._idlenessTracker.setPreviousRenderStatus(a),this._uiRenderData.particles!=null&&this._uiRenderData.particles.length!=0&&this._viewport.invalidate(),this.isTopLevelTransitionOngoing()&&this._multiplayer.onTransitionFrame(this._renderer.transitionProgressTracker().progress())}this.afterFrame!=null&&this.afterFrame(),this.afterFirstRenderOfScreenStack!=null&&r&&this.afterFirstRenderOfScreenStack(),this._pointerEventDelegate.maybeProcessStoredPointerRelease()}_findHotspotsToAnimate(){let t=a=>{let s=a.canvasSpaceScrolledInteractiveBounds(1),l=a.canvasSpaceScrolledInteractiveBounds(0);return new qc(s,l)},r=this._appState.prototypeState(),n=this._appState.baseScreenNode();if(!(!this._showHotspots||!r.getTransitionOnClick()||this._hotspotAnimation.getOpacity()<=0)&&n!=null){let a=(l,c)=>{var u;let d=c.event().interactionType(),h=(u=c.action())==null?void 0:u.value;if(d=="ON_MEDIA_HIT"||d=="ON_MEDIA_END")return!1;if(c.actions().length==1&&h.navigationType()=="SWAP_STATE"){if(["ON_HOVER","ON_PRESS","AFTER_TIMEOUT"].indexOf(d)!=-1)return!1;if(l!=null)return Zt.whichInstanceToSwap(l,h==null?void 0:h.transitionNodeID())!=null}return!0},s=r.getTopmostOverlayNode();if(s!=null){let l=r.getTopmostOverlay();return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(s,0,a).map(c=>{let d=t(c),h=l.overlaySpaceToBaseTlfSpace2(n,d.canvasSpaceBounds),u=l.overlaySpaceToBaseTlfSpace2(n,d.canvasSpaceClipBounds);return new qc(h,u)})}else return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(n,1,a).map(t)}return null}hitTestDeviceFrame(t){let r=this._appState.getActiveCanvas();if(r==null)return!1;let n=this._appState.baseScreenNode();if(n==null)return!1;let o=this._renderer.deviceRenderer();if(o==null||!o.canRenderDeviceFrame(r.prototypeDevice()))return!1;let a=o.pixelAtPosition(t,n.canvasSpaceBoundingBox(),r.prototypeDevice());return C.alpha(a)>0}hitTestBaseScreen(t){let r=this._appState.baseScreenNode();if(r==null)return 0;let n=this._canvasSpacePoint(t),o=r.canvasSpaceBoundingBox();return o.contains2(n)?o.leftThird().contains2(n)?1:o.rightThird().contains2(n)?3:2:0}_canvasSpacePoint(t){return this._viewport.canvasSpaceToViewSpace1().clone().inverseTransformPoint(t.clone())}canvasContentBounds(){var t;return(t=this._appState.getActiveCanvas())==null?void 0:t.canvasSpaceRenderedBounds()}setMaximumDrawingBufferSizeForTesting(t){this._renderer.getContext().setMaximumDrawingBufferSizeForTesting(t)}clearMaximumDrawingBufferSizeForTesting(){this._renderer.getContext().clearMaximumDrawingBufferSizeForTesting()}triggerResizeForTesting(){let t=this._cachedAbsoluteBounds,r=t.clone();r.setWidth(r.width()-1),this._cachedAbsoluteBounds=r,this._resize(),this._cachedAbsoluteBounds=t,this._resize()}toggleRenderTreePrinting(){this._renderer.toggleRenderTreePrinting()}invalidateIdlenessTracker(){this._idlenessTracker.handleInteraction()}_nonNull(t){return t}_setupInteractionHandlers(t){let r=a=>s=>{De.appTimerStart("discreteUserAction"),a(s),De.appTimerStop("discreteUserAction")},n=a=>s=>{De.appTimerStart("mouseMove"),a(s),De.appTimerStop("mouseMove")},o=a=>s=>{De.appTimerStart("dragUserAction"),a(s),De.appTimerStop("dragUserAction")};Hr.addUpdate(Yt.mousePress(this.events()),r(a=>{this._pointerEventDelegate.onMousePress(this._nonNull(a.asMouseEvent()))})),Hr.addUpdate(Yt.mouseDrag(this.events()),o(a=>{this._pointerEventDelegate.onDrag(this._nonNull(a.asMouseEvent()))})),Hr.addUpdate(Yt.mouseRelease(this.events()),r(a=>{this._pointerEventDelegate.onMouseRelease(this._nonNull(a.asMouseEvent()))})),Hr.addUpdate(Yt.mouseMove(this.events()),n(a=>{this._pointerEventDelegate.onMouseMove(this._nonNull(a.asMouseEvent()))})),Hr.addUpdate(Yt.mouseScroll(this.events()),o(a=>{this._pointerEventDelegate.onMouseScroll(this._nonNull(a.asMouseEvent()))})),Hr.addUpdate(Yt.mouseLeave(this.window().root().events()),r(a=>{this._pointerEventDelegate.onMouseLeave(this._nonNull(a.asMouseEvent()))})),Hr.addUpdate(Yt.touchPress(this.events()),r(a=>{this._pointerEventDelegate.onTouchPress(this._nonNull(a.asTouchEvent()))})),Hr.addUpdate(Yt.touchDrag(this.events()),o(a=>{this._pointerEventDelegate.onDrag(this._nonNull(a.asTouchEvent()))})),Hr.addUpdate(Yt.touchRelease(this.events()),r(a=>{this._pointerEventDelegate.onTouchRelease(this._nonNull(a.asTouchEvent()))})),Hr.addUpdate(Yt.keyPress(this.events()),r(a=>{this._pointerEventDelegate.onKeyPress(a.asKeyEvent(),t)})),Hr.addUpdate(Yt.gamepadDown(this.events()),r(a=>{this._pointerEventDelegate.onGamepadDown(a.asGamepadEvent())}))}_updateHoveredStateInstanceIfNeeded(t){let r=this._appState.prototypeState(),n=r.getStateMachineInitiatedChange(t)??r.getStateMachineLastChangeInHistory(t);n!=null&&n.cause==2?this._hoveredStateInstances.set(t.toString(),n):this._hoveredStateInstances.delete(t.toString())}_onCommitOrAbortForInteractions(t,r,n){if(this._triggerPotentialTimedTransition(t,r),this._createVideoTriggerEvents(t),this._mouseEnteredNodesManager.markNodesAsNotEnteredWithoutTriggeringMouseLeave(t.map(o=>o.id())),n!=null&&this._currentMouseLocation!=null&&!this._mostRecentTransitionViaArrows){let o=!this._mostRecentTransitionViaArrowsLegacy,a=this._currentMouseLocation;this._microtasksSinceLastFrame=this._microtasksSinceLastFrame+1,this._microtasksSinceLastFrame<=this.MAX_MICROTASKS_PER_FRAME&&Nd(()=>{this.handleInteractionsForMove(a,o)})}}_createCallbackForMediaEvent(t,r,n){return()=>{this.triggerHotspot(t,r,n,null)}}_createVideoTriggerEvents(t){var r,n;if(this._appState.prototypeState().interactionsEnabled())if(Lt.didEncounterCreateVideoTriggers(),X.viewerCreateVideoTriggersOpt()){let o=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpMediaHitInteractionMap();for(let s of o.hotspots()){let l=o.getHotspotInteractions(s),c=(r=this._appState.scene())==null?void 0:r.findNode(s);if(c==null||l==null)return;for(let d of t)if(d.isAncestorOf(c)){this._createMediaHitEvents(l,new No(c));break}}let a=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpMediaEndInteractionMap();for(let s of a.hotspots()){let l=a.getHotspotInteractions(s),c=(n=this._appState.scene())==null?void 0:n.findNode(s);if(c==null||l==null)return;for(let d of t)if(d.isAncestorOf(c)){this._createMediaEndEvents(l,new No(c));break}}}else{let o=new Set([ut.mapToInteractionType(20),ut.mapToInteractionType(21)]),a=l=>o.has(l.event().interactionType()),s=this._appState.prototypeStructure().findHotspotsWithInteractionFilterWithinMultipleNodes(new Set(t),0,a);for(let l of s)this._registerMediaEventsForHotspot(l)}}_createMediaHitEvents(t,r){for(let n of t){let o=n.event().mediaHitTime();this._appState.videoManager().addInteractionEvent(n,r.node.id(),o,this._createCallbackForMediaEvent(r,n,20))}}_createMediaEndEvents(t,r){for(let n=0,o=t.length;n<o;n=n+1){let a=t[n],s=this._createCallbackForMediaEvent(r,a,21);if(this._appState.videoManager().addInteractionEvent(a,r.node.id(),0,s),n+1<t.length){let l=t[n+1];if(this._shouldTriggerVariantInteractionWithMediaAction(a,l)){let c=this._createCallbackForMediaEvent(r,l,21);this._appState.videoManager().addInteractionEvent(l,r.node.id(),0,c)}}}}_registerMediaEventsForHotspot(t){let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,ut.mapToInteractionType(20));this._createMediaHitEvents(r,t);let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,ut.mapToInteractionType(21));this._createMediaEndEvents(n,t)}_triggerPotentialTimedTransition(t,r){if(!this._appState.prototypeState().interactionsEnabled())return;let n=[],o=[];for(let s of t){let l=this._appState.prototypeStructure().findHotspotsWithInteractionType(s,0,"AFTER_TIMEOUT");for(let c of l){let d=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(c.node,ut.mapToInteractionType(1));for(let h of d)n.push(h),o.push(c.node)}}let a=0;n.forEach(s=>{var S;let l=o[a];a=a+1;let c=s.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),d=c!=null?(S=Zt.whichInstanceToSwap(l,c.transitionNodeID()))==null?void 0:S.stablePath():null,h=this._appState.prototypeState(),u=d!=null?h.actionCountersForStateAndAncestors(d):[h.actionCounter()],m=this._appState.nodeTransitionTracker().topmostScreenChangeCounter(),g=l.stablePath(),_=()=>{var p;let b=(p=this._appState.scene())==null?void 0:p.findNodeByStablePath(g);if(b==null)return;let T=d!=null?h.actionCountersForStateAndAncestors(d):[h.actionCounter()];this._appState.nodeTransitionTracker().topmostScreenChangeCounter()==m&&ce.List_equalsWithComparison(u,T,(A,v)=>A==v)&&this.triggerDelayedHotspot(b.id(),s,1)},f=s.event().transitionTimeout()*1e3|0;(r==18||r==19)&&(f=Math.max(500,f)),setTimeout(_,f)})}updateCursorType(t,r){if(!this._appState.prototypeState().interactionsEnabled()){this.setCursor(0);return}if(Gt.isMobile(this.getRelevantOS())){this.setCursor(2);return}let n=this._appState.prototypeState().getTopmostScreen();if(n==null){this.setCursor(0);return}let o=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_CLICK",qt.getNodeInteractionPairs("ON_CLICK",r));o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_PRESS",qt.getNodeInteractionPairs("ON_PRESS",r))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN",qt.getNodeInteractionPairs("MOUSE_DOWN",r))),o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_UP",qt.getNodeInteractionPairs("MOUSE_UP",r))),o!=null&&!J.equals(o.node.id(),n.id())?this.setCursor(1):this.setCursor(0)}_handleMaintainedInteraction(t,r,n){var m;if(!this._appState.prototypeState().interactionsEnabled()||r==null)return;let o=t.node.id(),a=r.event().interactionType();if(this._maintainedData.getByHotspotAndInteractionType(o,a)!=null)return;let s=this._maintainedData.set(o,a,n),l=r.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),c=l!=null?(m=Zt.whichInstanceToSwap(t.node,l.transitionNodeID()))==null?void 0:m.stablePath():null,d=c!=null?this._appState.prototypeState().actionCounterForState(c):-1,h=this._appState.prototypeState().actionCounter();setTimeout(()=>{var I;let g=this._maintainedData.getByHotspotAndInteractionType(o,a);if(g==null)return;let _=g.counter(),f=c!=null?this._appState.prototypeState().actionCounterForState(c):-1,S=this._appState.prototypeState().actionCounter(),b=(I=this._appState.scene())==null?void 0:I.findNode(o),T=s==_,y=T&&h==S&&d==f;T&&this._maintainedData.resetEntry(o,a),y&&b!=null&&this.triggerDelayedHotspot(b.id(),r,g.action())},r.event().interactionDuration()*1e3|0)}_handleMouseEnterMouseLeave(t,r){let n=this._canvasSpacePoint(t);this._mouseEnteredNodesManager.updateEnteredNodes(n,r),this._mouseEnteredNodesManager.resetNoLongerMaintainedMouseEnterOrLeaveInteractions(this._maintainedData);let o=me.WasHandled.NOT_HANDLED,a=this._appState.prototypeState().actionCounter(),s=this._appState.prototypeState(),l=s.getTopmostOverlayNode(),c=this._appState.baseScreenNode(),d=l??c,h=s.getSecondTopmostOverlayNodeOrBaseScreen(),u=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(d,0,f=>f.event().interactionType()=="MOUSE_LEAVE",qt.getNodeInteractionPairs("MOUSE_LEAVE",r));if(h!=null){let f=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(h,0,S=>S.event().interactionType()=="MOUSE_LEAVE");Or(u,f)}let m=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(d,0,f=>f.event().interactionType()=="MOUSE_ENTER",qt.getNodeInteractionPairs("MOUSE_ENTER",r)),g=this._mouseEnteredNodesManager.getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(u);for(let f of g){let S=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(f.node,"MOUSE_LEAVE"),b=this._appState.prototypeState().actionCounter();if(a!=b)return o;o=this._triggerOrHandleMaintainedInteractions(S,f,13,t)}let _=this._mouseEnteredNodesManager.getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(m);for(let f of _){let S=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(f.node,"MOUSE_ENTER"),b=this._appState.prototypeState().actionCounter();if(a!=b)return o;o=this._triggerOrHandleMaintainedInteractions(S,f,12,t)}return o}handleInteractionsForMove(t,r){if(this._appState.scene()==null||!this._appState.prototypeState().interactionsEnabled())return;let n=this._appState.prototypeState().getTopmostScreen(),o=this._appState.prototypeStructure().getInteractionsGroupedByType([n]);this.updateCursorType(t,o);let a=this._handleMouseEnterMouseLeave(t,o);r&&(a=this._handleGranularMoveForDeprecatedMouseInMouseOut(t,o)),a==me.WasHandled.NOT_HANDLED&&r&&(this._handleHover1(t,o),this._handleReverseHover(t))}_handleGranularMoveForDeprecatedMouseInMouseOut(t,r){let n=10,o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_IN",qt.getNodeInteractionPairs("MOUSE_IN",r));if(o==null&&(o=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_OUT",qt.getNodeInteractionPairs("MOUSE_OUT",r)),n=11),this._maintainedData.resetAllEntriesMatchingPredicate((s,l)=>["MOUSE_IN","MOUSE_OUT"].indexOf(l)!=-1&&!J.equals(o!=null?o.node.id():null,s)),o==null)return me.WasHandled.NOT_HANDLED;let a=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(o.node,ut.mapToInteractionType(n));return this._triggerOrHandleMaintainedInteractions(a,o,n,t)}_handleHover1(t,r){let n=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_HOVER",qt.getNodeInteractionPairs("ON_HOVER",r));return this._handleHover2(n,t)}handleHoverAtHotspot(t){return this._mostRecentTransitionViaArrows=!0,this._mostRecentTransitionViaArrowsLegacy=!0,this._handleHover2(t,null)}_handleHover2(t,r){if(t!=null){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,ut.mapToInteractionType(2));for(let o of n)return this.triggerHotspot(t,o,2,r),o.setHoverLastHandledFrameNum(this.mostRecentFrameNum()),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}handleReverseHoverAtHotspot(t){var o;let r=t.node,n=He.StringMap_get(this._hoveredStateInstances,t.node.stablePath().toString(),null);return n==null||!J.equals((o=r.topLevelAncestor())==null?void 0:o.id(),this._appState.prototypeState().getTopmostScreenId())?me.WasHandled.NOT_HANDLED:(this._appState.prototypeState().returnInstanceToState(n.stablePath,2,6),me.WasHandled.HANDLED)}_handleReverseHover(t){var f,S;if(this._multiplayer.isObserving())return me.WasHandled.HANDLED;let r=this._appState.prototypeState(),n=me.WasHandled.NOT_HANDLED;for(let b of Array.from(this._hoveredStateInstances.keys())){let T=He.StringMap_get(this._hoveredStateInstances,b,null);if(T==null)continue;let y=this._appState.scene().findNodeByStablePath(T.stablePath);if(y==null||!J.equals((f=y.topLevelAncestor())==null?void 0:f.id(),r.getTopmostScreenId()))continue;let I=(S=T==null?void 0:T.canvasSpaceTriggerBoundsOrNull)==null?void 0:S.clone(),p=r.getCurrentBaseScreenNode();if(I!=null&&p!=null){let A=null,v=this._canvasSpacePoint(t),E=this._appState.prototypeState().getTopmostOverlay();if(A=(E==null?void 0:E.baseTlfSpaceToOverlaySpace1(p,v))??v,y.scrollAndClipBoundsBySelfAndAncestors(I,0).contains2(A))continue;r.returnInstanceToState(T.stablePath,2,6),n=me.WasHandled.HANDLED;break}}if(n==me.WasHandled.HANDLED)return n;let o=this._appState.prototypeState().getInitiatedChange()??this._appState.prototypeState().getLastChangeInHistory(),a=o==null?void 0:o.canvasSpaceTriggerBoundsOrNull;if(!(a!=null&&o.cause==2))return me.WasHandled.NOT_HANDLED;let l=null;if(l=this._appState.scene().findNode(o==null?void 0:o.oldStateId()),l==null)return me.WasHandled.NOT_HANDLED;let c=null,d=this._canvasSpacePoint(t);J.equals(o==null?void 0:o.oldStateId(),o==null?void 0:o.newStateId())||(d=this._canvasSpacePointInPreviousFrame(l,this._appState.baseScreenNode(),d));let h=o==null?void 0:o.oldOverlays(this._appState.prototypeState());h.length>0?c=ce.List_last(h).baseTlfSpaceToOverlaySpace1(l,d):c=d;let u=o!=null?o.interactionAddress.hotspotStablePath:null,m=this._retrieveReverseInteractionHotspotFromStoredData(u);if(m==null||m.scrollAndClipBoundsBySelfAndAncestors(a,0).contains2(c))return me.WasHandled.NOT_HANDLED;let _=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(this._retrieveReverseInteractionHotspotFromStoredData(u),ut.mapToInteractionType(2));for(let b of _){if(b.getHoverLastHandledFrameNum()==this.mostRecentFrameNum())break;return this.requestBack(m,b,2,6,null,null),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}_retrieveReverseInteractionHotspotFromStoredData(t){return this._appState.scene().findNodeByStablePath(t)}handleInteractionsForPress(t){if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_UP");let r=this._handleMouseDown(t);return r==me.WasHandled.NOT_HANDLED&&(r=this._handlePress(t)),r}_handleMouseDown(t){if(!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN");if(r==null)return me.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,ut.mapToInteractionType(8));return this._triggerOrHandleMaintainedInteractions(n,r,8,t)}_handlePress(t){if(!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_PRESS");if(r==null)return me.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,ut.mapToInteractionType(3));for(let o of n){let a=r.node.stablePath(),s=o.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE");if(s!=null){let l=Zt.whichInstanceToSwap(r.node,s.transitionNodeID());this._lastPressData=new qp(l==null?void 0:l.stablePath(),a)}else this._lastPressData=new qp(null,a);return this.triggerHotspot(r,o,3,t),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}maybeHandleSingleTapAsNavigation(t){if(this._appState.scene()==null||this._appState.getActiveCanvas()==null)return!1;if(this._appState.prototypeStructure().currentType()==1){let o=this.hitTestBaseScreen(t);if(o!=0&&o!=2){let a=o==1?-1:1;return a==1?this.navigateForward(17):this.navigateBackward(17),Math.random()<this.INTERACTION_REPORTING_RATE&&De.trackEvent("prototype_view_interaction",{type:"navigateViaArrows",direction:a==1?"FORWARD":"REVERSE",inputType:"tap",nonInteraction:0,prototypeType:Xi[this._appState.prototypeStructure().currentType()]}),!0}}return!1}handleInteractionsForRelease(t,r,n){let o=this._lastPressData;if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN");let a=this._appState.prototypeState().isDragging(),s=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());if(this._interactionObservers.forEach(h=>{h.handleRelease(s)}),a)return this._appState.prototypeState().setIsDragging(!1),me.WasHandled.HANDLED;let l=this._handleMouseUp(t);l==me.WasHandled.NOT_HANDLED&&r&&(l=this._handleClick(t)),l==me.WasHandled.NOT_HANDLED&&(l=this._handleReversePress(o));let c=l==me.WasHandled.NOT_HANDLED,d=n==me.WasHandled.NOT_HANDLED;return c&&d&&Ra.notifyUnhandledMouseRelease(this._appState,s),l}_handleMouseUp(t){if(!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_UP");if(r==null)return me.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,ut.mapToInteractionType(9));return this._triggerOrHandleMaintainedInteractions(n,r,9,t)}_handleReversePress(t){if(!this._appState.prototypeState().interactionsEnabled()||this._multiplayer.isObserving())return me.WasHandled.HANDLED;if(t==null)return me.WasHandled.NOT_HANDLED;if(t.swappedStablePath!=null)return this._appState.prototypeState().returnInstanceToState(t.swappedStablePath,2,7),me.WasHandled.HANDLED;{let r=t.hotspotStablePath!=null?this._retrieveReverseInteractionHotspotFromStoredData(t.hotspotStablePath):null,n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r,ut.mapToInteractionType(3));for(let o of n)return this.requestBack(r,o,2,7,null,null),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}_handleClick(t){if(this.disengageObservationMode(),!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"ON_CLICK");if(r!=null){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(r.node,ut.mapToInteractionType(4));for(let o=0,a=n.length;o<a;o=o+1){let s=n[o];if(this.triggerHotspot(r,s,4,t),o+1<n.length){let l=n[o+1];this._shouldTriggerVariantInteractionWithMediaAction(s,l)&&this.triggerHotspot(r,l,4,t)}return me.WasHandled.HANDLED}}if(this._shouldCloseTopmostOverlayOnClickOutside(t)){let n=this._appState.prototypeState().getCurrentOverlayData().length-1;return this._appState.prototypeState().closeOverlayAtAndAbove(n,1),me.WasHandled.HANDLED}return me.WasHandled.NOT_HANDLED}performHotspotAnimationOnClick(){this._hotspotAnimation.onClick()}handleInteractionsForDrag(t){let r=this._hotspotAtViewportSpacePointWithInteractionType(t,"MOUSE_DOWN");this._maintainedData.resetAllEntriesMatchingPredicate((o,a)=>a=="MOUSE_DOWN"&&!J.equals(r!=null?r.node.id():null,o));let n=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());this._interactionObservers.forEach(o=>{o.handleDrag(n)})}handleDragStart(t,r,n){if(!this._appState.prototypeState().interactionsEnabled()||this._appState.prototypeState().isDragging())return me.WasHandled.HANDLED;if(r==null)return me.WasHandled.NOT_HANDLED;let o=this._appState.prototypeStructure().findPrototypeInteractionWithId(r!=null?r.id():null,n);if(o==null)return me.WasHandled.NOT_HANDLED;this.triggerHotspot(new No(r),o,5,t),this._appState.prototypeState().setIsDragging(!0);let a=this._viewport.viewSpaceToCanvasSpace1().transformPoint(t.clone());return this._interactionObservers.forEach(s=>{s.handleDragStart(a)}),me.WasHandled.HANDLED}handleInteractionsForScroll(){this.handleScrollAndFindNewNodeToScroll(null)}handleScrollAndFindNewNodeToScroll(t){if(this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._lastPressData!=null){if(t==null)return null;let r=t==this._appState.baseScreenNode();this._handleReversePress(this._lastPressData),this._lastPressData=null;let n=this._appState.baseScreenNode();if(n==null)return null;if(r)return this._appState.baseScreenNode();{let o=n.scrollableFrameDescendants();return me.findMatchingTransitionNode(t,o)}}return t}handleFling(t,r){var c;let n=r.length,o=We.seconds(),a=this._appState.getActiveCanvas();if(a==null)return me.WasHandled.NOT_HANDLED;if(!this._appState.prototypeState().interactionsEnabled())return me.WasHandled.HANDLED;let s=(c=a.scene())==null?void 0:c.findNode(t),l=50*Jn();this._initialFlingVelocity=new R(0,0);for(let d=n-1;d>=0;d=d-1)if(d==0||o-r[d-1].startTime>.1){let h=r[d],u=r[n-1],m=u.startLocation.subtract1(h.startLocation).divide(u.startTime-h.startTime),g=m.length(),_=Math.log(1+g)/5,f=g*_/5,S=m.multiply(f/g);if(h!=u&&g>l)if(s==null||s==a)this._viewport.flingCameraOffset(S,_);else{this._initialFlingVelocity=this.restrictScrollDeltaAxes(s,m).negative();let b=me._scrollPhysics.createBallisticScrollSimulation(s.scrollOffset(),this._initialFlingVelocity,s.minScrollOffsetX(),s.maxScrollOffsetX(),s.minScrollOffsetY(),s.maxScrollOffsetY());return b!=null&&(me._scrollAnimationManager=new bl(b,s.id())),me.WasHandled.HANDLED}break}return me.WasHandled.NOT_HANDLED}handleInteractionsForLeave(){this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_IN"),this.handleInteractionsForMove(ye.FrozenVector_new4(-1,-1),!0)}handleInteractionsForKeyPress(t){let r=this._appState.prototypeState().getTopmostScreen(),n=this._appState.prototypeStructure().findHotspotsWithInteractionType(r,0,"ON_KEY_DOWN"),o=this._createListFromKeyEvent(t),a=l=>(l=Gt.current()!=4&&l==this.META_CODE?this.CONTROL_CODE:l,o.some(c=>c.indexOf(l)!=-1)),s=l=>{let c=l.event().keyTrigger().triggerDevice=="KEYBOARD",d=l.event().keyTrigger().keyCodes;if(d==null)return!1;let h=d.length==o.length;return c&&h&&d.every(a)};for(let l of n){let d=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(l.node,ut.mapToInteractionType(14)).filter(s);for(let h=0,u=d.length;h<u;h=h+1){let m=d[h];if(this.triggerHotspot(l,m,14,null),h+1<d.length){let g=d[h+1];this._shouldTriggerVariantInteractionWithMediaAction(m,g)&&this.triggerHotspot(l,g,14,null)}return t.accept(),me.WasHandled.HANDLED}}return me.WasHandled.NOT_HANDLED}_createListFromKeyEvent(t){let r=[];return 1&t.modifiers()&&r.push([this.ALT_CODE]),4&t.modifiers()&&r.push([this.SHIFT_CODE]),2&t.modifiers()&&r.push([this.META_CODE]),8&t.modifiers()&&r.push([this.CONTROL_CODE]),jl.Key_isModifier(t.key)||r.push(jl.Key_keyToKeyCode(t.key)),r}handleInteractionsForGamepadDown(t){let r=this._appState.prototypeState().getTopmostScreen(),n=a=>{let s=a.event().keyTrigger().triggerDevice!="KEYBOARD";return a.event().keyTrigger().keyCodes==null?!1:s&&a.event().keyTrigger().keyCodes.indexOf(t.button)!=-1},o=this._appState.prototypeStructure().findHotspotsWithInteractionType(r,0,"ON_KEY_DOWN");for(let a of o){let l=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(a.node,ut.mapToInteractionType(14)).filter(n);for(let c=0,d=l.length;c<d;c=c+1){let h=l[c];if(this.triggerHotspot(a,h,14,null),c+1<l.length){let u=l[c+1];this._shouldTriggerVariantInteractionWithMediaAction(h,u)&&this.triggerHotspot(a,u,14,null)}return t.accept(),me.WasHandled.HANDLED}}return me.WasHandled.NOT_HANDLED}addInteractionObserver(t){this._interactionObservers.add(t)}removeInteractionObserver(t){this._interactionObservers.remove(t)}_hotspotAtViewportSpacePointWithInteractionType(t,r,n){if(!this._appState.prototypeState().getTransitionOnClick())return null;let o=this._canvasSpacePoint(t);return this._hotspotAtCanvasSpacePointWithInteractionType(o,r,n)}_hotspotAtCanvasSpacePointWithInteractionType(t,r,n){let o=this._appState.baseScreenNode();if(o==null||!o.canvasSpaceBoundingBox().contains2(t)&&r!="MOUSE_OUT")return null;let a=this._appState.prototypeState(),s=a.getTopmostOverlayNode();if(s!=null){let l=a.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(o,t);return this._appState.prototypeStructure().hotspotOnPresentedNode(s,l,r,n)}else return this._appState.prototypeStructure().hotspotOnPresentedNode(o,t,r,n)}_canvasSpacePointInPreviousFrame(t,r,n){if(t==r)return n;let o=r.absoluteTransform().clone();if(!o.invert())return n;let a=t.absoluteTransform(),s=n.clone();return o.transformPoint(s),a.transformPoint(s),s}updateUserCursor(t){this._currentMouseLocation=t==null?void 0:t.locationInView(this),this._sendMouseCursorUpdate()}_shouldCloseTopmostOverlayOnClickOutside(t){let r=this._appState.prototypeState().getTopmostOverlay(),n=this._appState.prototypeState().getTopmostOverlayNode(),o=this._appState.baseScreenNode();if(o==null||n==null||r.backgroundInteraction()!="CLOSE_ON_CLICK_OUTSIDE")return!1;let a=this._canvasSpacePoint(t),s=r.baseTlfSpaceToOverlaySpace1(o,a);return!n.canvasSpaceBoundingBox().contains2(s)}recordViewportSpaceClick(t){let r=this._canvasSpacePoint(t);r!=null&&this._multiplayer.recordCanvasSpaceClick(r)}_sendMouseCursorUpdate(){if(this._currentMouseLocation==null)this._multiplayer.setCanvasSpaceMouse(null);else{let t=this._canvasSpacePoint(this._currentMouseLocation);t!=null&&this._multiplayer.setCanvasSpaceMouse(t)}}triggerMouseAction(t,r){this._appState.triggerAction2(t,r)}_triggerOrHandleMaintainedInteractions(t,r,n,o){for(let a=0,s=t.length;a<s;a=a+1){let l=me.WasHandled.NOT_HANDLED,c=t[a];if(c.event().interactionMaintained()?(this._handleMaintainedInteraction(r,c,n),l=me.WasHandled.MAINTAINED):(this.triggerHotspot(r,c,n,o),l=me.WasHandled.HANDLED),a+1<t.length){let d=t[a+1];this._shouldTriggerVariantInteractionWithMediaAction(c,d)&&(c.event().interactionMaintained()?(this._handleMaintainedInteraction(r,d,n),l=me.WasHandled.MAINTAINED):(this.triggerHotspot(r,d,n,o),l=me.WasHandled.HANDLED))}return l}return me.WasHandled.NOT_HANDLED}_shouldTriggerVariantInteractionWithMediaAction(t,r){let n=t.allActions().length>=1&&t.allActions().every(c=>c.connectionType()=="UPDATE_MEDIA_RUNTIME"),o=t.allActions().length>=1&&t.allActions().every(c=>J.isValid(c.transitionNodeID())),a=r.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),s=a!=null&&a.connectionType()=="INTERNAL_NODE",l=n&&o&&s;return l&&X.getFeatureFlags().prototype_log_video_and_ic_swap&&De.trackEvent("prototype_interaction_conflict_override_triggered",{interaction_type:t.event().interactionType(),action_type:t.actions().map(c=>c.mediaAction())}),l}getRelevantOS(){return this._appState.getActiveCanvas()==null?0:me._getRelevantOSForDevice(this._appState.getActiveCanvas().prototypeDevice())}_resetScrollForTlf(t){if(t!=null){this.updateScrollOffsetForNode(t,ye.FrozenVector_ZERO);let r=t.scrollableFrameDescendants();for(let n of r)this.updateScrollOffsetForNode(n,ye.FrozenVector_ZERO)}}getBestScrollOrDragProposal(t,r,n){let o=this._appState.getActiveCanvas();if(o==null)return null;if(this._appState.currentFitMode()==3&&this._viewport.zoomScale()!=1)return new me.ScrollOrDragProposal(me.ScrollOrDragProposal.InteractionType.SCROLL,1,o==null?void 0:o.id(),null);let a=this._canvasSpacePoint(r);if(a==null||this._appState.baseScreenNode()==null)return null;let s=null;t==me.ScrollOrDragQuerySet.SCROLL_OR_DRAG&&(s=(c,d)=>pr.computeDragVector1(c,d,this._appState.baseScreenNode(),this._appState.prototypeStructure(),this._appState.prototypeState()));let l=this._appState.prototypeState().getCurrentOverlays();for(let c=0,d=l.length;c<d;c=c+1){let h=l[l.length-c-1],u=h.node();if(u==null)continue;let m=h.baseTlfSpaceToOverlaySpace1(this._appState.baseScreenNode(),a);if(!u.canvasSpaceBoundingBox().contains2(m)){if(h.backgroundAppearance().backgroundType=="SOLID_COLOR")return null;continue}let g=me.findBestScrollOrDragProposalInFrame(o,m,n,u,this._appState.activePrototypeDevice(),s);return J.equals(g==null?void 0:g.targetNodeId,o==null?void 0:o.id())?null:g}return me.findBestScrollOrDragProposalInFrame(o,a,n,this._appState.baseScreenNode(),this._appState.activePrototypeDevice(),s)}_updateForAnimation(){if(me._scrollAnimationManager==null)return;let t=!me._scrollAnimationManager.isValid(this._appState.scene());t||(me._scrollAnimationManager.performScroll(this,this._appState.scene()),t=me._scrollAnimationManager.isDone()),t&&(this.cancelAnimationManager(),this._sequentialActionManager.runNextAction())}cancelAnimationManager(){me._scrollAnimationManager=null}maybeHandleOverdragRelease(){var n;if(me._overscrolledNodeID==null)return;let t=(n=this._appState.scene())==null?void 0:n.findNode(me._overscrolledNodeID);me._overscrolledNodeID=null,!(t==null||me.clampScrollOffsetForNode(t,t.scrollOffset()).equals(t.scrollOffset()))&&(me._scrollAnimationManager=new bl(new fl(t.scrollOffset(),new R(0,0),t.minScrollOffsetX(),t.maxScrollOffsetX(),t.minScrollOffsetY(),t.maxScrollOffsetY()),t.id()))}setPhysicsForOS(t){switch(Fg(t)){case 0:{me._scrollPhysics=new Wc;break}case 1:{me._scrollPhysics=new Qc;break}case 2:{me._scrollPhysics=new ul;break}}}_maybeChangePhysicsForDevice(t){let r=this.getRelevantOS(),n=me._getRelevantOSForDevice(t);r!=n&&this.setPhysicsForOS(r)}updateScrollOffsetForNode(t,r){let n=me.clampScrollOffsetForNode(t,r),o=this.restrictScrollDeltaAxes(t,r),a=this._pointerEventDelegate.isDragging();if(t.scrollOffset().equals(n)&&(!a||t.scrollOffset().equals(r)))return!1;if(a&&!n.equals(r)){let l=me._scrollPhysics.applyOverscrollBehavior(o,n,t.scrollOffset(),t.size());l.equals(n)||(me._overscrolledNodeID=t.id(),n=l)}t.setScrollOffset(n),this._observers.forEach(l=>{l.didScrollNode(t)}),this._emitter.trigger("scrollNode",t.id());let s=t.id();return this._multiplayer.setScrollPosition(s,t.scrollOffset()),!0}setScrollOffsetUnconditionally(t,r){t.setScrollOffset(r);let n=t.id();this._multiplayer.setScrollPosition(n,r)}restrictScrollDeltaAxes(t,r){let n=r.clone();switch(t.scrollDirection()){case"HORIZONTAL":{n.setY(0);break}case"VERTICAL":{n.setX(0);break}case"NONE":{n.setX(0),n.setY(0);break}case"BOTH":{let o=null;switch(t.overflowDirection()){case"NONE":{o="NONE";break}case"HORIZONTAL":{o="HORIZONTAL";break}case"VERTICAL":{o="VERTICAL";break}case"BOTH":{o="BOTH";break}}!$r.scrollsHorizontally(o)&&!t.hasOverflowingContentInXDirection()&&n.setX(0),!$r.scrollsVertically(o)&&!t.hasOverflowingContentInYDirection()&&n.setY(0);break}}return n}scrollToDestinationInFrame(t,r){let n=this._appState.scene().findNode(t),o=n.parent();for(;o!=null&&!((o.scrollDirection()!="NONE"||o.isTopLevel())&&!o.isTooRotatedToScroll());)o=o.parent();if(o!=null){let a=r.action().value;for(let c of r.getAllActionsWithSpecificTransitionType("SCROLL_ANIMATE"))a=c;let s=Kr.fromPrototypeAction(a,r.stateManagementVersion()),l=n.absoluteTransform().translation().add1(s.extraScrollOffset).subtract1(o.absoluteTransform().translation());if(a.transitionType()=="SCROLL_ANIMATE"){let c=me.clampScrollOffsetForNode(o,l);me._scrollAnimationManager=new bl(new Kc(o.scrollOffset(),c,s.transitionDuration,s.easingFunction),o.id())}else this.updateScrollOffsetForNode(o,l)}}scrollNode(t,r,n){var l,c;let o=(l=this._appState.scene())==null?void 0:l.findNode(t);if(o==null)return!1;if(me._scrollAnimationManager!=null&&me._scrollAnimationManager.isOverscrolled()){let d=me._scrollAnimationManager;if(o.id()!=d.nodeID()){let h=(c=this._appState.scene())==null?void 0:c.findNode(d.nodeID());h!=null&&h.setScrollOffset(d.simulation().endPos())}this.cancelAnimationManager()}else me._scrollAnimationManager!=null&&r!=me.ScrollSource.FLING&&this.cancelAnimationManager();if(o.isTooRotatedToScroll()||o.scrollDirection()=="NONE")return!1;let a=o.scrollOffset().clone();o.scrollDirection()=="HORIZONTAL"?a.setX(a.x()+(n.x()==0&&r==me.ScrollSource.SCROLL_EVENT?n.y():n.x())):a.addUpdate1(n);let s=this.updateScrollOffsetForNode(o,a);return this.disengageObservationMode(),s}_updateScrollOffsetsFromMultiplayer(){var r;let t=this._multiplayer.getScrollPositions();if(t!=null)for(let n of Array.from(t.keys())){let o=J.fromString(n),a=(r=this._appState.scene())==null?void 0:r.findNode(o);a!=null&&a.setScrollOffset(t.get(n))}}_clampDirtyScrollContainers(){let t=this._appState.scene();if(t==null)return;let r=new Set;for(let n of Array.from(me._dirtyNodesForScrollClamping.values())){let o=t.findNode(n);for(let a=o;a!=null&&!(r.has(a.id())||a!=o&&ir.isFrameLike(a.type())&&a.clipsToBoundingRectangle());a=a.parent())a.scrollDirection()!="NONE"&&this.updateScrollOffsetForNode(a,a.scrollOffset()),r.add(a.id())}me._dirtyNodesForScrollClamping=new Set}_handleScrollingPropertyChange(t,r,n,o){if(r==34)t.setScrollOffset(ye.FrozenVector_ZERO);else if(r==49||r==24)me._dirtyNodesForScrollClamping.add(t.id());else if(r==66){let a=this._appState.baseScreenNode();a!=null&&this.updateScrollOffsetForNode(a,a.scrollOffset())}else r==87&&(this._renderer.updateScroll(t),this._emitter.trigger("scrollEvent"))}renderLayerByLayerActivate(){this._renderer.renderLayerByLayerActivate(()=>{this.viewport().invalidate()})}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}static findBestScrollOrDragProposalInTree(t,r,n,o,a){let s=o==0,l=null;return l=(c,d)=>{let h=c.canvasSpaceGeometryBounds().contains2(d),u=c.canvasSpaceBoundingBox().contains2(d);if(c.clipsToBoundingRectangle()&&!h&&!u)return null;let m=null;for(let y=0,I=c.childCount();y<I;y=y+1){let p=c.childAt2(c.childCount()-y-1,!0),A=d,v=sa.getScrollTranslationOfNodeRelativeToParent1(p);A=d.add1(v);let E=l(p,A);m=(m==null?void 0:m.updateToBestProposal1(E))??E}let g=c.scrollDirectionWithScrollableContent(),_=u||h,f=g!="NONE"&&_&&!c.isInvisibleOrTransparent(),S=_&&c.visible()&&c.prototypeInteractions().some(y=>y.event().interactionType()=="DRAG"&&y.allActions().some(I=>Dc.isValidForConnection(y.event().interactionType(),I.connectionType()))),b=r.length()>0?r.divide(r.length()):r,T=null;if(_){if(f){let y=EA(g),I=me.ScrollOrDragProposal.InteractionType.OVERSCROLL;Math.abs(b.y())>0&&Math.abs(y.y())>0&&(b.y()>0?c.scrollOffset().y()<c.maxScrollOffsetY():c.scrollOffset().y()>c.minScrollOffsetY())&&(I=me.ScrollOrDragProposal.InteractionType.SCROLL),Math.abs(b.x())>0&&Math.abs(y.x())>0&&(b.x()>0?c.scrollOffset().x()<c.maxScrollOffsetX():c.scrollOffset().x()>c.minScrollOffsetX())&&(I=me.ScrollOrDragProposal.InteractionType.SCROLL);let p=$r.getDirectionSimilarity(g,b);(I==me.ScrollOrDragProposal.InteractionType.SCROLL||s)&&(T=new me.ScrollOrDragProposal(I,p,c.id(),null))}if(a!=null&&S){let y=b.multiply(-1);for(let I of c.prototypeInteractions().filter(p=>p.event().interactionType()=="DRAG")){let p=a(c,I),A=p!=null?y.dot(p.divide(p.length())):0;T=(T==null?void 0:T.updateToBestProposal2(me.ScrollOrDragProposal.InteractionType.DRAG,A,c.id(),I.id()))??new me.ScrollOrDragProposal(me.ScrollOrDragProposal.InteractionType.DRAG,A,c.id(),I.id())}}}return T=(m==null?void 0:m.updateToBestProposal1(T))??T,T},l(n,t)}static _canvasSpaceBoundsOfDeviceBackground(t,r){let n=Rn.infoForDevice(r);if(n==null)return Br.FrozenRect_EMPTY;let o=t.canvasSpaceBoundingBox().topLeft(),a=r.canvasSpaceFramePresetSize(n);return new V(o.x(),o.y(),a.x(),a.y())}static findBestScrollOrDragProposalInFrame(t,r,n,o,a,s){if(o==null)return null;let l=a!=null&&pa.hasDevice(a.type),c=Fg(me._getRelevantOSForDevice(a)),d=Math.abs(n.y())>Math.abs(n.x())?"VERTICAL":"HORIZONTAL",h=o.scrollsInPreferredDirection(d)&&o.hasOverflowingContentInScrollDirection();if(o.canvasSpaceBoundingBox().contains2(r)){let u=me.findBestScrollOrDragProposalInTree(r,n,o,c,s);if(u!=null)return u;if(l)return null}else if(l){if(me._canvasSpaceBoundsOfDeviceBackground(o,a).contains2(r))return null}else if(h)return new me.ScrollOrDragProposal(me.ScrollOrDragProposal.InteractionType.SCROLL,1,o.id(),null);return new me.ScrollOrDragProposal(me.ScrollOrDragProposal.InteractionType.SCROLL,1,t==null?void 0:t.id(),null)}static copyScrollOffset(t,r,n){r!=null&&n!=null&&(t==null?n.setScrollOffset(r.scrollOffset()):t.updateScrollOffsetForNode(n,r.scrollOffset()))}static findMatchingTransitionNode(t,r){let n=r.filter(c=>c.name()==t.name());if(n.length==1)return n[0];let o=t.canvasSpaceBoundingBox(),a=r.filter(c=>c.canvasSpaceBoundingBox().size().approximatelyEquals(o.size(),1));if(a.length==0)return null;if(a.length==1)return a[0];let s=t.topLevelAncestor(),l=o.topLeft();s!=null&&l.subtractUpdate1(s.canvasSpaceBoundingBox().topLeft());for(let c of a){let d=c.canvasSpaceBoundingBox().topLeft(),h=c.topLevelAncestor();if(h!=null&&d.subtractUpdate1(h.canvasSpaceBoundingBox().topLeft()),l.approximatelyEquals(d,1))return c}return null}static matchNodesAndPreserveScroll(t,r,n){if(!J.equals(n.oldStateId(),n.newStateId())){let s=r.lastNodeForBaseScreen(),l=r.nextNodeForBaseScreen();me.findMatchingNodesAndPreserveScroll(t,s,l)}let o=n.oldStateAndOverlays.overlays,a=n.newStateAndOverlays.overlays;for(let s=0,l=Math.min(o.length,a.length);s<l;s=s+1)if(!J.equals(o[s].id,a[s].id)){let c=r.lastNodeForOverlayAt(s),d=r.nextNodeForOverlayAt(s);me.findMatchingNodesAndPreserveScroll(t,c,d)}}static findMatchingNodesAndPreserveScroll(t,r,n){if(r!=null&&n!=null){me.copyScrollOffset(t,r,n);let o=r.scrollableFrameDescendants(),a=n.scrollableFrameDescendants();for(let s of o){if(a.length==0)break;let l=me.findMatchingTransitionNode(s,a);l!=null&&(me.copyScrollOffset(t,s,l),ce.List_removeOne(a,l))}}}static clampScrollOffsetForNode(t,r){if(t.scrollDirection()=="NONE")return ye.FrozenVector_ZERO.clone();let n=R.new2();return t.scrollDirection()=="HORIZONTAL"?n.setX(lr.Math_clamp(r.x(),t.minScrollOffsetX(),t.maxScrollOffsetX())):t.scrollDirection()=="VERTICAL"?n.setY(lr.Math_clamp(r.y(),t.minScrollOffsetY(),t.maxScrollOffsetY())):t.scrollDirection()=="BOTH"&&(n.setX(lr.Math_clamp(r.x(),t.minScrollOffsetX(),t.maxScrollOffsetX())),n.setY(lr.Math_clamp(r.y(),t.minScrollOffsetY(),t.maxScrollOffsetY()))),n}static _getRelevantOSForDevice(t){return Gt.current()==2||Gt.current()==1||t==null?Gt.current():t.os()==2||t.os()==1?t.os():Gt.current()}};me._scrollPhysics=new ul,me._scrollAnimationManager=null,me._overscrolledNodeID=null,me._dirtyNodesForScrollClamping=new Set;var ji=me;(o=>{class i{constructor(s){this._canvasView=null,this._dragStart=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._activeScrollOrDrag=null,this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0,this._canvasView=s}unlockScroll(){this._lastScrollEvent=0,this._scrollingNodeId=null}resetStateForTests(){this._resetDragInfo(),this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=0,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0}isDragging(){return this._isDragging}_handleSinglePointerPress(s,l){let c=s.locationInView(this._canvasView);this._canvasView.triggerMouseAction(l,c),this._dragStart=c,this._isDragGestureConfirmed=!1,this._canvasView.recordViewportSpaceClick(this._dragStart),s.accept(),this._flingPoints=[],this._currentGesture=new Xp(c,We.seconds(),s.interactionType()),this._lastPointerPressHandled=this._canvasView.handleInteractionsForPress(c),this._lastPointerPressHandled!=0&&(this._lastPointerPressHandledAt=We.seconds())}onMousePress(s){this._handleSinglePointerPress(s,6),this._canvasView.cancelAnimationManager()}onTouchPress(s){this._canvasView.cancelAnimationManager(),s.touches.length==1?this._handleSinglePointerPress(s,10):s.accept()}_processPointerRelease(s){var f;if(!this._canvasView.appState().prototypeState().interactionsEnabled())return!1;let l=this._isDragGestureConfirmed,c=!l&&this._lastPointerPressHandled!=2,d=l&&this._lastPointerPressHandled==1&&(this._activeScrollOrDrag==null||this._activeScrollOrDrag.interactionType==o.ScrollOrDragProposal.InteractionType.DRAG),h=c||d,u=this._canvasView.handleInteractionsForRelease(s,h,this._lastPointerPressHandled);return(this._isDragging?this._canvasView.handleFling((f=this._activeScrollOrDrag)==null?void 0:f.targetNodeId,this._flingPoints):0)==0&&this._canvasView.maybeHandleOverdragRelease(),!l&&u==0&&this._lastPointerPressHandled==0&&this._canvasView.performHotspotAnimationOnClick(),!l&&this._canvasView.appState().scene()!=null&&X.getViewerMode()==X.ViewerMode.MIRROR&&this._canvasView.appState().triggerAction1(5),this._canvasView.updateCursorType(s,null),this._resetDragInfo(),l||u==1||this._lastPointerPressHandled==1}_storeOrProcessPointerReleaseAtPoint(s){if(We.seconds()-this._lastPointerPressHandledAt<pC)this._storedPointerReleasePoint=s;else if(this._processPointerRelease(s))return 1;return this._lastPointerPressHandledAt=0,0}onMouseRelease(s){let l=s.locationInView(this._canvasView);this._canvasView.triggerMouseAction(9,l),this._storeOrProcessPointerReleaseAtPoint(l)}onTouchRelease(s){s.touches.length==0&&this._currentGesture!=null?(this._currentGesture!=null&&(this._currentGesture.endTime=We.seconds(),this.isSingleTap()?this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)==0&&this._canvasView.appState().prototypeState().getTransitionOnClick()&&this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation):this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)),this._resetDragInfo()):s.touches.length==0&&this._canvasView.maybeHandleOverdragRelease(),this._previousGesture=this._currentGesture,this._currentGesture=null}_resetDragInfo(){this._dragStart=null,this._activeScrollOrDrag=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1}onDrag(s){var c;let l=s.locationInView(this._canvasView);if(this._isDragging=!0,this._dragStart!=null&&!this._isDragGestureConfirmed&&(this._isDragGestureConfirmed=s.interactionCount()>1||l.distanceTo(this._dragStart)>lC),this._dragStart!=null&&this._isDragGestureConfirmed&&!this._isDragInteractionLocked){let d=l.subtract1(this._dragStart).multiply(-1);this._activeScrollOrDrag=this._canvasView.getBestScrollOrDragProposal(1,this._dragStart,d)}if(!this._canvasView.appState().prototypeState().isDragging()){if(this._isDragGestureConfirmed&&X.getDragToPan()&&this._activeScrollOrDrag!=null){let d=s.delta(),h=(c=this._canvasView.appState().scene())==null?void 0:c.findNode(this._activeScrollOrDrag.targetNodeId);switch(this._activeScrollOrDrag.interactionType){case o.ScrollOrDragProposal.InteractionType.SCROLL:case o.ScrollOrDragProposal.InteractionType.OVERSCROLL:{if(h!=null&&h!=this._canvasView.appState().getActiveCanvas()){if(this._canvasView.scrollNode(h.id(),1,d.negative().divide(this._canvasView.viewport().zoomScale()))){this._lastPointerPressHandled=1,this._isDragInteractionLocked=!0;let m=this._canvasView.handleScrollAndFindNewNodeToScroll(h);m==null&&Le("new scroll node is null"),this._activeScrollOrDrag.targetNodeId=m==null?void 0:m.id()}}else this._canvasView.viewport().panCamera(d);break}case o.ScrollOrDragProposal.InteractionType.DRAG:{this._lastPointerPressHandled=this._canvasView.handleDragStart(l,h,this._activeScrollOrDrag.targetInteractionId),this._isDragInteractionLocked=!0;break}}s.interactionCount()!=1?this._currentGesture=null:this._currentGesture!=null&&(this._flingPoints.push(new Xp(l,We.seconds(),s.interactionType())),this._currentGesture.endLocation=l,this._currentGesture.endTime=We.seconds())}}this._canvasView.idlenessTracker().handleInteraction(),this._canvasView.handleInteractionsForDrag(l),s.interactionType()==0&&(this._canvasView.updateUserCursor(s),this._canvasView.triggerMouseAction(8,l))}onMouseScroll(s){var u;let l=this._canvasView.appState().getActiveCanvas();if(l==null)return;let c=We.seconds();c-this._lastScrollEvent>cC&&(this._scrollingNodeId=null);let d=s.locationInView(this._canvasView),h=this._canvasView.appState().activePrototypeDevice()!=null&&pa.hasDevice(this._canvasView.appState().activePrototypeDevice().type);if((8&s.modifiers()||2&s.modifiers())&&to.userCanManuallyZoom(this._canvasView.appState().prototypeState().getCurrentFitMode(),h))this._canvasView.viewport().adjustCameraZoomWithPin(Math.pow(.99,s.scrollDelta.y()),d.subtract1(this._canvasView.viewport().viewSpaceBounds().topLeft())),s.accept(),this._canvasView.userDidAttemptZoom!=null&&this._canvasView.userDidAttemptZoom(1);else{let m=(u=l.scene())==null?void 0:u.findNode(this._scrollingNodeId);if(m==null){let g=this._canvasView.getBestScrollOrDragProposal(0,d,s.scrollDelta);m=this._canvasView.appState().scene().findNode(g==null?void 0:g.targetNodeId),this._scrollingNodeId=m==null?void 0:m.id()}m==null||(m!=l?(this._canvasView.scrollNode(this._scrollingNodeId,0,s.scrollDelta.divide(this._canvasView.viewport().zoomScale()))&&(this._canvasView.handleInteractionsForScroll(),this._canvasView.handleInteractionsForMove(d,!0)),s.accept()):X.getScrollToPan()&&(this._canvasView.viewport().panCamera(s.scrollDelta.negative()),this._scrollingNodeId=l.id(),s.accept(),this._canvasView.handleInteractionsForMove(d,!0)))}this._lastScrollEvent=c,this._canvasView.idlenessTracker().handleInteraction()}onMouseMove(s){let l=s.locationInView(this._canvasView);this._canvasView.updateUserCursor(s),this._canvasView.triggerMouseAction(7,l),this._canvasView.handleInteractionsForMove(l,!0),this._scrollingNodeId=null}onMouseLeave(s){this._canvasView.updateUserCursor(null),this._canvasView.handleInteractionsForLeave()}onKeyPress(s,l){let c=this._canvasView.handleInteractionsForKeyPress(s);X.isInlinePreview()&&c==0&&(s.key==7||s.key==8&&4&s.modifiers())&&l.trigger("requestClose")}onGamepadDown(s){this._canvasView.handleInteractionsForGamepadDown(s)}maybeProcessStoredPointerRelease(){this._storedPointerReleasePoint!=null&&(this._processPointerRelease(this._storedPointerReleasePoint),this._storedPointerReleasePoint=null)}isSingleTap(){return this._canvasView.appState().baseScreenNode()!=null&&this._currentGesture!=null&&this._currentGesture.isTap()}}o.CanvasPointerEventDelegate=i;let e;(c=>(c[c.NOT_HANDLED=0]="NOT_HANDLED",c[c.HANDLED=1]="HANDLED",c[c.MAINTAINED=2]="MAINTAINED"))(e=o.WasHandled||(o.WasHandled={}));let t;(l=>(l[l.SCROLL_ONLY=0]="SCROLL_ONLY",l[l.SCROLL_OR_DRAG=1]="SCROLL_OR_DRAG"))(t=o.ScrollOrDragQuerySet||(o.ScrollOrDragQuerySet={}));class r{updateToBestProposal1(s){return s!=null&&this.updateToBestProposal2(s.interactionType,s.directionSimilarity,s.targetNodeId,s.targetInteractionId),this}updateToBestProposal2(s,l,c,d){return(this.interactionType==o.ScrollOrDragProposal.InteractionType.OVERSCROLL&&s==o.ScrollOrDragProposal.InteractionType.DRAG||l>this.directionSimilarity)&&(this.interactionType=s,this.directionSimilarity=l,this.targetNodeId=c,this.targetInteractionId=d),this}constructor(s,l,c,d){this.interactionType=s,this.directionSimilarity=l,this.targetNodeId=c,this.targetInteractionId=d}}o.ScrollOrDragProposal=r,(s=>{let a;(h=>(h[h.OVERSCROLL=0]="OVERSCROLL",h[h.SCROLL=1]="SCROLL",h[h.DRAG=2]="DRAG"))(a=s.InteractionType||(s.InteractionType={}))})(r=o.ScrollOrDragProposal||(o.ScrollOrDragProposal={}));let n;(c=>(c[c.SCROLL_EVENT=0]="SCROLL_EVENT",c[c.DRAGGING=1]="DRAGGING",c[c.FLING=2]="FLING"))(n=o.ScrollSource||(o.ScrollSource={}))})(ji||(ji={}));var Xp=class{constructor(e,t,r){this.startLocation=null,this.startTime=0,this.endLocation=null,this.endTime=0,this.type=0,this.startLocation=e,this.startTime=t,this.endLocation=e,this.endTime=t,this.type=r}isTap(){return(this.endLocation==null||this.startLocation.distanceTo(this.endLocation)<uC)&&this.endTime-this.startTime<dC}},lC=5,cC=.2,dC=.4,uC=50,pC=.1;var Jp=class{constructor(e,t,r){this._appState=null,this._canvasView=null,this._emitter=null,this._session=null,this._userSyncing=null,this._isFirst=!1,this._appState=e,this._canvasView=t,this._emitter=$t.getEventEmitter(),this._session=r,this._userSyncing=null,this._isFirst=!0,this._session.addObserver(this),this._appState.addFrameObserver(this)}reset(){this._isFirst=!0}userInfoJSON(){if(this._userSyncing==null)return null;let e=[],t=this._userSyncing.userBySessionID(),r=this._session.sessionID();t.has(r)&&e.push(t.get(r).toJSON());for(let o of Array.from(this._userSyncing.userBySessionID().values()))o.sessionID!=r&&e.push(o.toJSON());let n=0;if(this._session.presenterSessionID()!=null&&this._session.presenterSessionID().value==r)for(let o of Array.from(this._userSyncing.userBySessionID().values()))o.sessionID!=r&&o.observedSessions.indexOf(r)!=-1&&(n=n+1);return{deviceNameFilter:this._session.role(),sessionID:r,allUsers:e,followerCount:n,observingSessionID:this._session.observingSessionID(),presenterSessionID:this._session.presenterSessionID()!=null?this._session.presenterSessionID().value:null,sessionNominatedByCurrentUser:this._session.sessionNominatedByCurrentUser()!=null?this._session.sessionNominatedByCurrentUser().value:null,sessionsNominatingCurrentUser:this._session.sessionsNominatingCurrentUser()}}performVariableActions(e){let t=this._appState.prototypeState(),r=this._session.observedUser();if(r==null)return;e&&t.resetVariablePrototypeState();let n=r.triggeredSetVariableActionData??[],o=r.triggeredSetVariableModeActionData??[];(t.getSetVariableActionHistoryLength()>n.length||t.getSetVariableModeActionHistoryLength()>o.length)&&t.resetVariablePrototypeState();let a=t.getSetVariableActionHistoryLength();for(let l=0;l<n.length;l++){let c=n[l];(l>=a||c.targetVariableData!==t._setVariableActionHistory[l].targetVariableData)&&t.performMultiplayerSetVariableAction(c)}let s=t.getSetVariableModeActionHistoryLength();for(let l=0;l<o.length;l++){let c=o[l];(l>=s||c.targetVariableModeId!==t._setVariableModeActionHistory[l].targetVariableModeId)&&t.performMultiplayerSetVariableModeAction(c)}}performVideoStateChanges(e){let t=this._appState.prototypeState(),r=this._session.observedUser();if(r==null)return;e&&t.resetVideoStateChangeHistory();let n=r.videoStateChangeData??[];for(let o=0;o<n.length;o++){let a=n[o],s=t.getVideoStateChange(o);(!s||!this._videoStateEqual(a,s))&&t.performMultiplayerVideoStateChange((s==null?void 0:s.currentTimes)||[],a)}}_videoStateEqual(e,t){return J.fromFigGUID(e.targetNodeId)!=J.fromFigGUID(t.targetNodeId)||e.isPlaying!=t.isPlaying||e.isPlayingSound!=t.isPlayingSound||e.actionTakenTimestamp!=t.actionTakenTimestamp?!1:(e.currentTimes.forEach((r,n)=>{if(r!=t.currentTimes[n])return!1}),!0)}setPreviewToObservedFrameOrOverlay(e){let t=this._appState.prototypeState(),r=this._appState.prototypeStructure(),n=this._session.observedUser();if(n==null)return;this.applyInstanceStateSwaps(e);let o=n.triggeredOverlaysData??[],a=n.currentFrame;if(a!=null&&!J.equals(this._appState.baseScreenId(),a)){let l=null,c=null;o.length==0&&(l=n.lastTriggeredHotspot,c=n.lastTriggeredPrototypeInteractionID);let d=null;if(l!=null&&c!=null)d=r.findPrototypeInteractionWithId(l,c);else if(l!=null){let h=this._appState.getActiveCanvas().scene().findNode(l),u=qt.cleanedInteractionsForNode(this._appState,h);u.length!=0&&(d=u[0])}this._appState.prototypeState().navigateToFrameAndCloseOverlays(a,this._appState.scene().findNode(l),1,0,0,d,null)}let s=t.getCurrentOverlays();s.length>o.length&&(t.closeOverlayAtAndAbove(o.length,1),s=t.getCurrentOverlays());for(let l=0,c=o.length;l<c;l=l+1){let d=It.decodeGUID(o[l].overlayGuid),h=It.decodeGUID(o[l].swapGuid),u=It.decodeGUID_instanceHACK(o[l].hotspotGuid),m=It.decodeGUID(o[l].prototypeInteractionGuid),g=null;if(m!=null)g=r.findPrototypeInteractionWithId(u,m);else{let _=this._appState.prototypeStructure().findPrototypeInteractionsWithTransition(u,h);_.length!=0&&(g=_[0])}if(s.length<=l){let _=this._appState.scene().findNode(u);if(_==null)return;t.overlayFrame(h,_,0,0,g,null),s=t.getCurrentOverlays()}if(!J.equals(s[l].id(),d)||!J.equals(s[l].overlayDataModelId(),h)){if(l<s.length-1&&t.closeOverlayAtAndAbove(l+1,1),!J.equals(s[l].overlayDataModelId(),h)){t.closeOverlayAtAndAbove(l,1);let y=this._appState.scene().findNode(u);t.overlayFrame(h,y,0,0,g,null)}let _=this._appState.scene().findNode(s[l].id()),f=n.lastTriggeredHotspot,S=this._appState.scene().findNode(f);S=_!=null&&_.isAncestorOf(S)?S:null;let b=n.lastTriggeredPrototypeInteractionID,T=null;S!=null&&b!=null?T=r.findPrototypeInteractionWithId(S.id(),b):S!=null&&r.nodeTransitionTracker().cleanedUpInteractionMap()._in(S.id())&&(T=r.nodeTransitionTracker().cleanedUpInteractionMap().getHotspotInteractions(S.id())[0]),t.swapTopOverlay(d,S,0,T,null)}s=t.getCurrentOverlays()}t.getInitiatedChange()!=null&&!e&&t.commitStateChange()}_initiateStateSwap(e){var a;let t=this._appState.prototypeState(),r=It.decodeGUIDPath(e.hotspotStablePath),n=(a=this._appState.scene())==null?void 0:a.findNodeByStablePath(r),o=It.decodeGUID(e.interactionID);t.swapInstanceToState2(It.decodeGUIDPath(e.instanceStablePath),It.decodeGUID(e.stateID),n,0,n==null?void 0:n.findPrototypeInteraction(o),1,null)}_commitStateSwap(e){let t=this._appState.prototypeState(),r=It.decodeGUIDPath(e.instanceStablePath);t.commitChangesBelowInstanceTransitionRoot(r)}applyInstanceStateSwaps(e){let t=this._session.observedUser();if(t.instanceStateChanges!=null){for(let r of t.instanceStateChanges)r.phase=="INITIATED"&&this._initiateStateSwap(r),(r.phase=="COMMITTED"||!e)&&this._commitStateSwap(r);t.instanceStateChanges=[]}}handleConnect(e,t){this._userSyncing=new ed,this._session.setMultiplayerUserSyncing(this._userSyncing),this._userSyncing.onChange=r=>{this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())},this._userSyncing.onMouseCursorChange=r=>{var n;r==this._session.observingSessionID()&&((n=this._canvasView)==null||n.viewport().invalidate())}}handleDisconnect(){this._userSyncing=null,this._session.setMultiplayerUserSyncing(null),this._emitter.trigger("multiplayerUserInfoChange",null)}handleJoinStart(e,t,r){e!=1&&this._emitter.trigger("joinStart")}handleJoinEnd(){var t;this._session.scene()!=this._appState.scene()&&this._appState.setActiveCanvas(null),this._isFirst&&(this._isFirst=!1);let e=this._appState.getActiveCanvas();e!=null&&this._emitter.trigger("prototypeDeviceChanged",e.prototypeDevice().toJSON()),(t=this._canvasView)==null||t.afterEnteredViewer()}handleNodeChanges(){this._appState.prototypeState().didApplyNodeChanges()}handlePresenterChange(){this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())}handleSceneGraphReply(e,t){}handleSceneChangedLoadingPhase(e,t){}onFrame(){this.setPreviewToObservedFrameOrOverlay(!0),this.performVariableActions(!1),this.performVideoStateChanges(!1)}};var Zp;(h=>{function i(u){return u}h._shortcut1=i;function e(u,m){return u|m<<h.MODIFIERS_SHIFT}h._shortcut2=e;function t(u,m,g){return u|m<<h.MODIFIERS_SHIFT|g<<h.FLAGS_SHIFT}h._shortcut3=t;function r(u){let m=new Map([[3,[e(20,4),e(20,16)]],[4,[21,29]],[1,[93,92,69,e(93,16),e(92,16),e(69,16)]],[2,[91,70,e(91,16),e(70,16)]]]);for(let g of Array.from(m.keys()))for(let _ of m.get(g)){let f=_&h.KEY_MASK,S=_>>h.MODIFIERS_SHIFT&h.MODIFIERS_MASK,b=_>>h.FLAGS_SHIFT&h.FLAGS_MASK;o.Flags_currentlyApplies(b)&&(16&S&&(S|=Ka.Modifiers_currentPlatformModifier()),Fs.KeyShortcutMap_set(u,f,S,g))}}h.addTo=r;let n;(_=>(_[_.__NONE=0]="__NONE",_[_.MAC=1]="MAC",_[_.NON_MAC=2]="NON_MAC"))(n=h.Flags||(h.Flags={}));let o;(_=>{function u(f){return(1&f)!=0}_.Flags_isMacOnly=u;function m(f){return(2&f)!=0}_.Flags_isNonMacOnly=m;function g(f){return(!u(f)||Gt.current()==4)&&(!m(f)||Gt.current()!=4)}_.Flags_currentlyApplies=g})(o=h.in_Flags||(h.in_Flags={})),h.KEY_MASK=255,h.MODIFIERS_MASK=255,h.MODIFIERS_SHIFT=8,h.FLAGS_MASK=255,h.FLAGS_SHIFT=16})(Zp||(Zp={}));var vl=class{constructor(e,t,r,n){this._window=null,this._appState=null,this._canvasView=null,this._shortcuts=new Map,this._multiplayerSession=null,this._multiplayerCoupler=null,this._window=new qd(e,t,n==1,()=>X.disableKeyboardHandling(),()=>X.isInlinePreview()),this._appState=new ur,this._canvasView=new ji(this._appState),this._canvasView.setParent(this._window.root()),this._canvasView.setup(),this._canvasView.focus(),this._registerShortcuts(),this._multiplayerSession=new Ni(this._appState,()=>this._window.isActive(),r),this._multiplayerCoupler=new Jp(this._appState,this._canvasView,this._multiplayerSession),this._canvasView.setMultiplayer(this._multiplayerSession),_n.instance.setMultiplayer(this._multiplayerSession)}state(){return this._appState}canvasView(){return this._canvasView}window(){return this._window}multiplayerSession(){return this._multiplayerSession}multiplayerCoupler(){return this._multiplayerCoupler}_registerShortcuts(){let e=!0;Hr.addUpdate(Yt.keyPress(this._window.root().events()),t=>{e&&(Zp.addTo(this._shortcuts),e=!1);let r=Fs.KeyShortcutMap_get(this._shortcuts,t.asKeyEvent().key,t.modifiers(),0);r!=0&&(this._appState.triggerAction1(r),t.accept())})}unloadSceneAndResetPrototypeLib(){this._multiplayerSession.disconnect(),this._appState.setScene(null),this._multiplayerSession.setScene(null),L()!=null&&(console.debug("Resetting PrototypeLib..."),Sd())}initializePrototypeLib(e){if(this.unloadSceneAndResetPrototypeLib(),e==null)throw new Error("Can't initialize PrototypeLib with null CppModules");Ad(new rl(e,this._appState))}connectTo(e,t,r,n,o,a){this._appState.setActivePrototypeStartingPointNodeId(r),this._appState.prototypeState().resetPrototype(),this._multiplayerCoupler.reset(),this._appState.setRenderDots(!!o),this._canvasView.setBackgroundEnabled(!o),cr.setImagePrefixURL(`/file/${e}/image`),cr.setVideoPrefixUrl(`/api/files/${e}/videos`),X.shouldApplyMobileOptimizations()?cr.setImageBatchURL(`/file/${e}/image/batch?max_size=2048`):cr.setImageBatchURL(`/file/${e}/image/batch`),this.initializePrototypeLib(a),this._multiplayerSession.connectTo(e,t,n)}};var Yg;(n=>{function i(o){return Array.from(o.values())}n.Set_values=i;function e(o,a){return r(o,a)}n.Set_subtract=e;function t(o){return new Set(o)}n.Set_new1=t;function r(o,a){let s=new Set(Array.from(o.values()));return o.forEach(l=>{a.has(l)&&s.delete(l)}),s}n.Set_difference=r})(Yg||(Yg={}));var Jg;(c=>{function i(){return O.BufferChunk.BYTE_COUNT}c.BYTE_COUNT=i;function e(){let d=new l,h=d.add(O.VertexFormat.getPositionF2(),i()/4|0,0);h.area.byteOffset()==0;let u=d.add(O.VertexFormat.getPositionF2(),i()/4|0,1);u.area.byteOffset()==(i()/4|0);let m=d.add(O.VertexFormat.getPositionF2(),i()/4|0,2);m.area.byteOffset()==(i()/4|0)*2;let g=d.add(O.VertexFormat.getPositionF2(),i()/4|0,3);g.area.byteOffset()==(i()/4|0)*3,h.free(),m.free();let _=d.add(O.VertexFormat.getPositionF2(),i()/4|0,4);u.area.byteOffset()==0,g.area.byteOffset()==(i()/4|0),_.area.byteOffset()==(i()/4|0)*2,d.pool.totalVRAM()==i(),d.context.buffers.length==1;let f=d.context.buffers[0];u.check(f),g.check(f),_.check(f)}c.testBasicBufferPoolGC=e;function t(){let d=new l,h=d.add(O.VertexFormat.getPositionF2(),i()/4|0,0);h.area.byteOffset()==0;let u=d.add(O.VertexFormat.getPositionF2(),i()/4|0,1);u.area.byteOffset()==(i()/4|0);let m=d.add(O.VertexFormat.getPositionF2(),i()/4|0,2);m.area.byteOffset()==(i()/4|0)*2;let g=d.add(O.VertexFormat.getPositionF2(),i()/4|0,3);g.area.byteOffset()==(i()/4|0)*3,h.free();let _=d.add(O.VertexFormat.getPositionF2(),i()/4|0,4);u.area.byteOffset()==0,m.area.byteOffset()==(i()/4|0),g.area.byteOffset()==(i()/4|0)*2,_.area.byteOffset()==(i()/4|0)*3,d.pool.totalVRAM()==i(),d.context.buffers.length==1;let f=d.context.buffers[0];u.check(f),m.check(f),g.check(f),_.check(f)}c.testBasicBufferPoolGC2=t;function r(){let d=new l,h=d.add(O.VertexFormat.getPositionF2(),i()/4|0,0);h.area.byteOffset()==0;let u=d.add(O.VertexFormat.getPositionF2(),i()/4|0,1);u.area.byteOffset()==(i()/4|0);let m=d.add(O.VertexFormat.getPositionF2(),i()/4|0,2);m.area.byteOffset()==(i()/4|0)*2,u.free();let g=d.add(O.VertexFormat.getPositionF2(),i()/2|0,3);h.area.byteOffset()==0,m.area.byteOffset()==(i()/4|0),g.area.byteOffset()==(i()/4|0)*2,d.pool.totalVRAM()==i(),d.context.buffers.length==1;let _=d.context.buffers[0];h.check(_),m.check(_),g.check(_)}c.testByteOffsetBugFig5426=r;function n(){let d=new l,h=d.add(O.VertexFormat.getPositionF2(),8,0);h.area.byteOffset()==0;let u=d.add(O.VertexFormat.getPositionF2(),8,1);u.area.byteOffset()==8;let m=d.add(O.VertexFormat.getPositionF4CoordF4(),32,2);m.area.byteOffset()==32;let g=d.add(O.VertexFormat.getPositionF4CoordF4(),32,3);g.area.byteOffset()==64,u.free(),m.free();let _=d.add(O.VertexFormat.getPositionF2(),i()-64,4);h.area.byteOffset()==0,g.area.byteOffset()==32,_.area.byteOffset()==64,d.pool.totalVRAM()==i(),d.context.buffers.length==1;let f=d.context.buffers[0];h.check(f),g.check(f),_.check(f)}c.testStrideBugFig5426=n;class o{constructor(h,u){this._context=null,this._byteCount=0,this._bytes=null,this._context=h,this._byteCount=u,this._bytes=new Uint8Array(u)}context(){return this._context}bytes(){return this._bytes}byteCount(){return this._byteCount}move(h,u,m){m>=0,0<=h&&h+m<=this._byteCount,0<=u&&u+m<=this._byteCount,h!=u&&m!=0&&this._bytes.set(this._bytes.subarray(h,h+m),u)}upload2(h,u){0<=u&&u+h.length<=this._byteCount,this._bytes.set(h,u)}prepare(){}}c.VertexBuffer=o;class a{createVertexBuffer(h){let u=new o(this,h);return this.buffers.push(u),u}addContextResetHandler(h){}beginFrame(){}clear(h,u){}createMaterial(h,u,m,g){return null}createTexture(h,u,m,g){return null}createTextureWithPixels(h,u,m,g,_){return null}createTextureWithVideo(h,u,m){return null}createFramebuffer(h,u,m){return null}currentFramebuffer(){return null}currentStencilState(){return null}currentBlendState(){return null}draw(h,u,m){}endFrame(){}flush(){}getNumFramebufferSwitches(){return 0}height(){return 0}maxTextureSize(){return 4096}removeContextResetHandler(h){}resize(h,u){return new O.ComputedCanvasSize(new R(h,u),!1)}setBlendState(h){}readPixels(h,u,m,g,_){return null}resetNumFramebufferSwitches(){}bindWebGLFramebufferAndTrackForBudget(h){}setStencilState(h){}setFramebuffer(h){}setViewport(h,u,m,g){}width(){return 0}annotate(h,u){u()}annotateAndReturn(h,u){return u()}annotateProfile(h,u){u()}setScissor(h){}isContextLost(){return!1}graphicsCardName(){return"Unknown"}setMaximumDrawingBufferSizeForTesting(h){}clearMaximumDrawingBufferSizeForTesting(){}hasLoggedHighpPrecisionUnsupported(){return!0}setHasLoggedHighpPrecisionUnsupported(){}constructor(){this.buffers=[]}}c.Context=a;class s{free(){this.area.free(),this.area.wasFreed()}check(h){for(let u=0,m=this.bytes.length;u<m;u=u+1)h.bytes()[this.area.byteOffset()+u]==this.bytes[u]}constructor(h,u){this.bytes=h,this.area=u}}c.Result=s;class l{constructor(){this.context=new a,this.pool=null,this.pool=new O.BufferPool(this.context)}add(h,u,m){let g=new Uint8Array(u);g[0]=m*2+1,g[g.length-1]=m*2+2;let _=this.pool.allocate(h,g);return _!=null,_.byteCount()==u,_.wasFreed(),new s(g,_)}}c.Helper=l})(Jg||(Jg={}));var od=class{constructor(e){this._scene=null,this._watchedNodeIDs=new Map,this.onChangeCallback=null,e.addAppObserver(this)}watchNodesWithIDs(e){this._watchedNodeIDs=new Map;for(let t of e)this._watchedNodeIDs.set(t,!0)}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this.onChangeCallback!=null&&this.onChangeCallback()}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_isWatchedNode(e){return this._watchedNodeIDs.has(e)}_isAncestorOrSelfOfWatchedNode(e){for(let t of Array.from(this._watchedNodeIDs.keys())){let r=this._scene.findNode(t);for(let n=r;n!=null;n=n.parent())if(J.equals(n.id(),e))return!0}return!1}handleSceneGraphEvent(e){let t=!1;if(e.property==25){let r=e.oldVal!=null&&nt.isParentIndex(e.oldVal)?nt.asParentIndex(e.oldVal):null,n=e.newVal!=null&&nt.isParentIndex(e.newVal)?nt.asParentIndex(e.newVal):null;(r==null||n==null||r.id!=n.id)&&(t=this._isAncestorOrSelfOfWatchedNode(e.node.id()))}else e.property==24?t=this._isAncestorOrSelfOfWatchedNode(e.node.id()):(e.property==49||e.property==87)&&(t=this._isWatchedNode(e.node.id()));t&&this.onChangeCallback!=null&&this.onChangeCallback()}};var gs=class i{toJSON(){let e={nodeId:this.nodeId};return this.nodeOffset!=null&&(e.nodeOffset={x:this.nodeOffset.x(),y:this.nodeOffset.y()}),this.canvasPosition!=null&&(e.canvasPosition={x:this.canvasPosition.x(),y:this.canvasPosition.y()}),e}static fromJSON(e){let t=null,r=null,n=null;return e.nodeId!==null&&e.nodeId!==void 0&&(t=J.fromString(e.nodeId)),e.nodeOffset!==null&&e.nodeOffset!==void 0&&(r=new R(e.nodeOffset.x,e.nodeOffset.y)),e.canvasPosition!==null&&e.canvasPosition!==void 0&&(n=new R(e.canvasPosition.x,e.canvasPosition.y)),new i(t,r,n)}constructor(e,t,r){this.nodeId=e,this.nodeOffset=t,this.canvasPosition=r}},id=class{constructor(e){this._appState=null,this._boundsWatcher=null,this._shouldNotifyCommentPositionsChanged=!1,this._nodesWithComments=[],this.notifyCommentPositionsChange=null,this._appState=e,this._boundsWatcher=new od(e),this._boundsWatcher.onChangeCallback=()=>{this._shouldNotifyCommentPositionsChanged=!0},this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this)}setNodesWithComments(e){this._boundsWatcher.watchNodesWithIDs(e),this._nodesWithComments=e}onFrame(){this._shouldNotifyCommentPositionsChanged&&(this.notifyCommentPositionsChange!=null&&this.notifyCommentPositionsChange(),this._shouldNotifyCommentPositionsChanged=!1)}handleSceneChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActiveCanvasChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActivePrototypeStartingPointChange(e,t){}_isAncestorOrSelfOfNodeWithComment(e){let t=this._appState.scene();if(t==null)return!1;for(let r of this._nodesWithComments){let n=t.findNode(r);for(let o=n;o!=null;o=o.parent()){let a=o.id();if(J.equals(a,e))return!0}}return!1}handleStateChangeAborted(e){this.handlePresentedStateChange(e)}handleStateChangeCommitted(e,t){this.handlePresentedStateChange(e)}handleStateChangeInitiated(e){this.handlePresentedStateChange(e)}handleStateChangeRequested(e){}handlePresentedStateChange(e){if(e==null||this._shouldNotifyCommentPositionsChanged)return;if(this._isAncestorOrSelfOfNodeWithComment(e.oldStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let t=e.oldStateAndOverlays.overlays;for(let n=0,o=t.length;n<o;n=n+1){let a=t[n].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}if(this._isAncestorOrSelfOfNodeWithComment(e.newStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let r=e.newStateAndOverlays.overlays;for(let n=0,o=r.length;n<o;n=n+1){let a=r[n].id;if(this._isAncestorOrSelfOfNodeWithComment(a)){this._shouldNotifyCommentPositionsChanged=!0;return}}}handleFitModeChange(e,t){}handleRestartPrototype(){}getCommentDestinationAtPosition(e){let t=this._appState.scene();if(t==null)return null;let r=this._appState.baseScreenNode();if(r==null)return null;let n=this._appState.prototypeState().getCurrentOverlays();for(let a=n.length-1;a>=0;a=a-1){let s=t.findNode(n[a].id());if(s==null)continue;let l=n[a].renderedBounds(r);if(l.contains2(e)){let c=e.subtract1(l.topLeft());return new gs(s.id(),c,null)}}let o=e.subtract1(r.canvasSpaceBoundingBox().topLeft());return new gs(r.id(),o,null)}_currentCommentsScreen(){return this._appState.prototypeState().getTopmostScreen()}_currentCommentsScreenRenderedBounds(){let e=this._appState.baseScreenNode(),t=this._appState.prototypeState().getTopmostOverlay();return e!=null&&t!=null?t.renderedBounds(e):e==null?void 0:e.canvasSpaceBoundingBox()}getCanvasSpaceCommentLocations(e,t){let r={};for(let n of Array.from(t.keys())){let o=t.get(n),a=e.findNode(o.nodeId),s=this._currentCommentsScreen(),l=this._currentCommentsScreenRenderedBounds();if(a==null||s==null||l==null)continue;let c=!1;if(c=s.isAncestorOf(a),!c)continue;let d=a.canvasSpaceScrolledBounds(1).topLeft().subtract1(s.canvasSpaceBoundingBox().topLeft()),u=l.topLeft().add1(d).add1(o.nodeOffset),m={};m.x=u.x(),m.y=u.y(),r[n]=m}return r}};var $p;(f=>{function i(S,b){let T=new Fr("NONZERO",0,Pt.forCenterStrokeAroundRect(S,b),S);return new xr([T],null,T.bounds(),null)}f.strokeGeometryForRect=i;function e(S,b){if(Math.abs(C.redF(S)-C.redF(b))+Math.abs(C.greenF(S)-C.greenF(b))+Math.abs(C.blueF(S)-C.blueF(b))+Math.abs(C.alphaF(S)-C.alphaF(b))>.01)throw new Error(`Colors are too different ${C.toString(S)} ${C.toString(b)}`)}f.assertColorRoughlyEquals=e;function t(S,b,T){let y=HA(S);return y.setTestOnlyFillPaints([te.createSolid(C.BLACK,T)]),y.setTestOnlyFillGeometry(KA(b)),Je(y,y.fillGeometry().bounds.topLeft(),y.fillGeometry().bounds.size()),y}f.createStaticVectorWithMultipleRegions=t;function r(S,b,T,y){S.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),_.GeometryType_hasFill(b)&&S.setTestOnlyFillGeometry(Qo(T)),_.GeometryType_hasStroke(b)&&(S.setTestOnlyStrokeGeometry(i(T,y)),S.setStrokeWeight(y)),Je(S,T.topLeft(),T.size())}f.addPaintsAndGeometry=r;function n(S,b,T,y){let I=Tn(S);return r(I,b,T,y),I}f.createRectangleWithPaintsAndGeometry1=n;function o(S,b,T){return n(S,b,T,1)}f.createRectangleWithPaintsAndGeometry2=o;function a(S,b,T,y,I){let p=zA(S,b);return r(p,T,y,I),p}f.createRoundedRectangleWithPaintsAndGeometry1=a;function s(S,b,T,y){return a(S,b,T,y,1)}f.createRoundedRectangleWithPaintsAndGeometry2=s;function l(S,b,T,y,I,p,A,v,E,D){let G=new Fr("NONZERO",0,Ot.fromRect(T),T),U=new xr([G],null,G.bounds(),null),M=gn(S,"RECTANGLE");return M.setTestOnlyFillGeometry(U),M.setTestOnlyFillPaints(y),M.setTestOnlyStrokeGeometry(U),M.setTestOnlyStrokePaints(I),M.setStrokeAlign(p),M.setStrokeWeight(10),M.setStrokeJoin("MITER"),M.setStrokeMiterLimit(4),M.setTestOnlyEffects([Oe.createDropShadow(A,v,E,D)]),M}f.createRoundedRectangleWithStrokeFillAndDropShadow=l;function c(S,b){let T=Tn(S);T.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]);let y=b.topLeft().x(),I=b.topLeft().y(),p=b.width(),A=b.height(),v=new Fr("NONZERO",0,Pt.new2().moveTo1(y,I).lineTo(y+p,I).lineTo(y+p,I+A).lineTo(y,I+A-1).close(),b),E=new xr([v],null,v.bounds(),null);return T.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),T.setTestOnlyFillGeometry(E),T.setTestOnlyStrokeGeometry(E),Je(T,b.topLeft(),b.size()),T}f.createNonRectangleInNode=c;function d(S,b,T){let y=S.canvasSpaceBoundingBox();switch(T){case"INSIDE":case"OUTSIDE":{S.setTestOnlyStrokeGeometry(i(y,b*2));break}case"CENTER":{S.setTestOnlyStrokeGeometry(i(y,b));break}}S.setStrokeAlign(T)}f.setStrokeForRect=d;function h(){let S=AssertLib.deepStrictEqual,b=new ss("./src/test/rendertree.test.sk");Bt("generateRenderTree",()=>{let T=null,y=null,I=()=>{T=_t.createSceneWithCanvasForTests1(),y=T.root().childAt1(0),y.setPrototypeDevice(jr.DEFAULT)};beforeEach(I),be("simple rect",()=>{let p=o(y,0,new V(0,0,100,100));return b.asyncAssertMatchesSnapshot("should emit single fill",p.renderTree1().debugString1())}),be("simple rounded rect",()=>{let p=s(y,10,0,new V(0,0,100,100));return b.asyncAssertMatchesSnapshot("should emit single rounded rect fill",p.renderTree1().debugString1())}),be("rounded rect symbol",()=>{let p=oi(y);return r(p,0,new V(0,0,100,100),0),p.setContainerSupportsFillStrokeAndCorners(!0),p.setIsFrameMaskDisabled(!0),p.setCornerRadius(10),b.asyncAssertMatchesSnapshot("symbol should emit rounded rect fill",p.renderTree1().debugString1())}),be("rounded rect instance",()=>{let p=oi(y),A=ha(y,p);return r(A,0,new V(0,0,100,100),0),A.setContainerSupportsFillStrokeAndCorners(!0),A.setIsFrameMaskDisabled(!0),A.setCornerRadius(10),b.asyncAssertMatchesSnapshot("instance should emit rounded rect fill",A.renderTree1().debugString1())}),ls("simple vector with multiple regions",()=>{let p=[],A=t(y,[new V(0,0,10,10),new V(20,20,10,10)],.5);p.push(b.asyncAssertMatchesSnapshot("should emit single fill",A.renderTree1().debugString1()));let v=t(y,[new V(0,0,10,10),new V(5,5,10,10)],.5);return p.push(b.asyncAssertMatchesSnapshot("should emit multiple fills",v.renderTree1().debugString1())),Promise.all(p)}),be("multiply blend mode",()=>{let p=o(y,0,new V(0,0,100,100));return p.setBlendMode("MULTIPLY"),b.asyncAssertMatchesSnapshot("should emit fill with blend mode",p.renderTree1().debugString1())}),be("foreground blur",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyEffects([Oe.createForegroundBlur(4)]),b.asyncAssertMatchesSnapshot("should emit foreground blur",p.renderTree1().debugString1())}),be("foreground blur w/ radius zero",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyEffects([Oe.createForegroundBlur(0)]),b.asyncAssertMatchesSnapshot("blur should be ellided",p.renderTree1().debugString1())}),be("foreground blur disabled",()=>{let p=o(y,0,new V(0,0,100,100)),A=Oe.createForegroundBlur(4);return A.setIsEnabled(!1),p.setTestOnlyEffects([A]),b.asyncAssertMatchesSnapshot("blur should be ellided",p.renderTree1().debugString1())}),be("background blur",()=>{o(y,0,new V(25,25,50,50)).setTestOnlyFillPaints([te.createSolid(C.RED,1)]);let A=o(y,0,new V(0,0,100,100));return A.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),b.asyncAssertMatchesSnapshot("blur should be ellided because rect with blur is opaque",A.renderTree1().debugString1())}),be("background blur on partially transparent node",()=>{let p=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(p),o(y,0,new V(25,25,50,50)).setTestOnlyFillPaints([te.createSolid(C.RED,1)]);let v=o(y,0,new V(0,0,100,100));return v.setTestOnlyFillPaints([te.createSolid(C.BLACK,.5)]),v.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),b.asyncAssertMatchesSnapshot("background blur should be emitted",v.renderTree1().debugString1())}),be("rectangle won't show up in the background blur",()=>{let p=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(p),o(y,0,new V(0,0,10,10)).setTestOnlyFillPaints([te.createSolid(C.RED,1)]);let v=lt(y);v.setTestOnlyFillPaints([te.createSolid(C.BLACK,.5)]),Je(v,new R(0,0),new R(10,10));let E=o(v,0,new V(0,0,10,10));return E.setTestOnlyFillPaints([te.createSolid(C.GREEN,.5)]),E.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),b.asyncAssertMatchesSnapshot("red rectangle should not show up in the background blur",v.renderTree1().debugString1())}),Bt("scrolling frames",()=>{be("wrap scrollable layers in a volatile property binding",()=>{let p=lt(y);return p.setOverflowDirection("VERTICAL"),Je(p,new R(0,0),new R(100,100)),o(p,0,new V(0,0,100,200)).setTestOnlyFillPaints([te.createSolid(C.RED,1)]),b.asyncAssertMatchesSnapshot("red fill should be in volatile property binding",p.renderTree1().debugString1())}),be("wrap scrollable layers with non-isolated blends with a group",()=>{let p=lt(y);p.setOverflowDirection("VERTICAL"),Je(p,new R(0,0),new R(100,100));let A=o(p,0,new V(0,0,100,200));A.setBlendMode("MULTIPLY"),A.setTestOnlyFillPaints([te.createSolid(C.RED,1)]);let v=p.renderTree1();return b.asyncAssertMatchesSnapshot("red rectangle should be wrapped with a group",v.debugString1())}),ls("fixed layers and their descendants should be re-positioned",()=>{let p=[];y.setPrototypeDevice(new jr("CUSTOM",new R(100,100),"","NONE"));let A=lt(y);Je(A,new R(0,0),new R(100,500));let v=lt(A);return v.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),v.setVerticalConstraint("MAX"),Je(v,new R(0,400),new R(100,100)),o(v,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.RED,1)]),p.push(b.asyncAssertMatchesSnapshot("Red square should NOT be culled because the screen is 100 x 500",A.renderTree1().debugString1())),p.push(b.asyncAssertMatchesSnapshot("Red square should NOT be culled even though the screen is 100 x 100 because it is a fixed footer that was repositioned to be in in the screen",A.renderTreeForBaseScreen1().debugString1())),v.setScrollBehavior("SCROLLS"),p.push(b.asyncAssertMatchesSnapshot("Red square SHOULD be culled because the screen is 100 x 100 and the footer is not fixed",A.renderTreeForBaseScreen1().debugString1())),Promise.all(p)}),be("do not wrap fixed layers in a volatile property binding",()=>{let p=lt(y);p.setOverflowDirection("VERTICAL"),Je(p,new R(0,0),new R(100,100));let A=lt(p);return A.setTestOnlyFillPaints([te.createSolid(C.GREEN,1)]),A.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),o(p,0,new V(0,50,100,150)).setTestOnlyFillPaints([te.createSolid(C.RED,1)]),b.asyncAssertMatchesSnapshot("red fill should be in volatile property binding; green fill should not",p.renderTree1().debugString1())}),be("Background blur trees should not cull scrollable content",()=>{let p=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(p);let A=lt(y);A.setOverflowDirection("VERTICAL"),Je(A,new R(0,0),new R(100,100)),A.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]);let v=o(A,0,new V(0,150,100,100));Je(v,new R(150,0),new R(100,101)),v.setTestOnlyFillPaints([te.createSolid(C.GREEN,1)]);let E=o(A,0,new V(0,0,100,100));return E.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),Je(E,new R(0,0),new R(100,100)),E.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]),E.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),b.asyncAssertMatchesSnapshot("blur node should contain green fill",A.renderTree1().optimized().debugString1())}),["FRAME","GROUP"].forEach(p=>{be(`Background blur inside ${p} in scrolling content should contain transformed scrolling siblings`,()=>{let A=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(A);let v=lt(y);v.setOverflowDirection("VERTICAL"),Je(v,new R(0,0),new R(100,100)),v.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]);let E=p=="FRAME"?lt(v):ni(v),D=o(E,0,new V(0,0,100,101));Je(D,new R(0,0),new R(100,101)),D.setTestOnlyFillPaints([te.createSolid(C.GREEN,1)]);let G=o(E,0,new V(0,0,100,100));return Je(G,new R(0,0),new R(100,100)),G.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]),G.setTestOnlyEffects([Oe.createBackgroundBlur(4)]),Je(E,new R(0,0),new R(100,101)),b.asyncAssertMatchesSnapshot("blur node should contain transformed green fill",v.renderTree1().optimized().debugString1())})}),be("calling .renderTree on a frame should NOT make it scrollable by default",()=>{y.setCurrentViewportSize(new R(100,50));let p=lt(y);return Je(p,new R(0,0),new R(100,100)),o(p,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.RED,1)]),b.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should NOT be present",p.renderTree1().debugString1())}),be("calling .renderTreeForBaseScreen on a frame should make it scrollable by default",()=>{y.setCurrentViewportSize(new R(100,50));let p=lt(y);return Je(p,new R(0,0),new R(100,100)),o(p,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.RED,1)]),b.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should be present",p.renderTreeForBaseScreen1().debugString1())})}),be("drop shadow",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("drop shadow should be emitted",p.renderTree1().debugString1())}),be("two drop shadows",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyEffects([Oe.createDropShadow(0,new R(50,50),C.RED,1),Oe.createDropShadow(0,new R(-50,-50),C.GREEN,1)]),b.asyncAssertMatchesSnapshot("two drop shadows should be emitted",p.renderTree1().debugString1())}),be("drop shadow on semi-transparent layer",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),p.setOpacity(.5),b.asyncAssertMatchesSnapshot("should be wrapped in blend with 0.5 opacity",p.renderTree1().debugString1())}),be("drop shadow on clipping frame with visible background paints",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=lt(p);return Je(A,new R(0,0),new R(200,200)),A.setTestOnlyFillPaints([te.createSolid(C.RED,1)]),o(A,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.GREEN,1)]),A.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("shadow tree does not contain rect fill",A.renderTree1().debugString1())}),be("drop shadow on non-clipping frame with visible background paints",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=lt(p);return Je(A,new R(0,0),new R(200,200)),A.setTestOnlyFillPaints([te.createSolid(C.RED,1)]),A.setIsFrameMaskDisabled(!0),o(A,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.GREEN,1)]),A.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill",A.renderTree1().debugString1())}),be("drop shadow on clipping frame with no background paints",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=lt(p);return Je(A,new R(0,0),new R(200,200)),A.setTestOnlyFillPaints([]),o(A,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.GREEN,1)]),A.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",A.renderTree1().debugString1())}),be("drop shadow on clipping frame with no visible background paints",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=lt(p);return Je(A,new R(0,0),new R(200,200)),A.setTestOnlyFillPaints([te.createSolid(C.RED,0)]),o(A,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.GREEN,1)]),A.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",A.renderTree1().debugString1())}),be("drop shadow on clipping frame with visible background paint with transparent area",()=>{let p=te.createLinearGradient([new ot(C.new3(0,0,0,1),0),new ot(C.new3(0,0,0,0),.5)]),A=lt(y);Je(A,new R(-100,-100),new R(300,300));let v=lt(A);return Je(v,new R(0,0),new R(200,200)),v.setTestOnlyFillPaints([p]),o(v,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.GREEN,1)]),v.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("shadow tree should contain frame background and rect",v.renderTree1().debugString1())}),be("drop shadow on clipping frame with inside stroke",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=$a(p,"frame",[te.createSolid(C.RED,1)],[te.createSolid(C.BLACK,1)],new V(0,0,50,50));return Je(A,new R(0,0),new R(50,50)),A.setStrokeAlign("INSIDE"),A.setStrokeWeight(4),c(A,new V(0,0,100,100)),A.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("drop shadow should not be clipped by frame mask",A.renderTree1().debugString1())}),be("drop shadow on rounded rectangle clipping frame with inside stroke",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=$a(p,"frame",[te.createSolid(C.RED,1)],[te.createSolid(C.WHITE,1)],new V(0,0,50,50));return Je(A,new R(0,0),new R(50,50)),A.setStrokeAlign("INSIDE"),A.setStrokeWeight(4),A.setCornerRadius(10),A.setTestOnlyFillGeometry(WA(A.canvasSpaceBoundingBox(),10)),A.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("drop shadow should be a rounded rect",A.renderTree1().debugString1())}),be("drop shadow and inner shadow on clipping frame with inside stroke",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=$a(p,"frame",[te.createSolid(C.RED,1)],[te.createSolid(C.BLACK,1)],new V(0,0,50,50));return Je(A,new R(0,0),new R(50,50)),A.setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),A.setStrokeAlign("INSIDE"),A.setTestOnlyStrokePaints([te.createSolid(C.RED,1)]),A.setStrokeWeight(4),c(A,new V(0,0,100,100)),A.setTestOnlyEffects([Oe.createInnerShadow(4,new R(0,0),C.BLACK,.25),Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("inner shadow should be clipped by frame mask",A.renderTree1().debugString1())}),be("spread shadow for eligible frame",()=>{let p=lt(y);Je(p,new R(0,0),new R(300,300));let A=lo(p,"frame",te.createSolid(C.RED,1));return Je(A,new R(0,0),new R(50,50)),A.setTestOnlyEffects([Oe.createDropShadow(0,new R(0,0),C.BLACK,.25,10)]),b.asyncAssertMatchesSnapshot("should generate shadow with spread for eligible frame: max bounds",`${A.renderTree1().maxBounds}
`)}),be("no spread shadow for frame with no visible fill paints",()=>{let p=lo(y,"frame",te.createSolid(C.RED,0));return Je(p,new R(0,0),new R(50,50)),o(p,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyEffects([Oe.createDropShadow(0,new R(0,0),C.BLACK,.25,10)]),b.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no visible fill: max bounds",`${p.renderTree1().maxBounds}
`)}),be("no spread shadow for frame that does not clip",()=>{let p=lt(y);Je(p,new R(0,0),new R(300,300));let A=lo(p,"frame",te.createSolid(C.RED,1));return Je(A,new R(0,0),new R(50,50)),A.setIsFrameMaskDisabled(!0),A.setTestOnlyEffects([Oe.createDropShadow(0,new R(0,0),C.BLACK,.25,10)]),b.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no clipping: max bounds",`${A.renderTree1().maxBounds}
`)}),be("drop shadow with knockout: translucent node",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]),p.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,.25,5,!1)]),b.asyncAssertMatchesSnapshot("should generate knockout shadow for regular translucent node",p.renderTree1().debugString1())}),be("drop shadow with knockout: opaque node",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.RED,1)]),p.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,.25,5,!1)]),b.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque node",p.renderTree1().debugString1())}),be("drop shadow with knockout: opaque frame",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=lo(p,"frame",te.createSolid(C.RED,1));return Je(A,new R(0,0),new R(50,50)),A.setIsFrameMaskDisabled(!0),A.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,.25,20,!1)]),b.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque frame",A.renderTree1().debugString1())}),be("drop shadow with knockout: node with gradient transparency",()=>{let p=o(y,0,new V(0,0,100,100)),A=te.createLinearGradient([new ot(C.new3(0,0,0,1),0),new ot(C.new3(0,0,0,0),.3),new ot(C.new3(0,0,0,0),.7),new ot(C.new3(0,0,0,1),.7)]);return p.setTestOnlyFillPaints([A]),p.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,.25,5,!1)]),b.asyncAssertMatchesSnapshot("should knockout gradient with transparency",p.renderTree1().debugString1())}),be("drop shadow with knockout: with effect blend mode",()=>{let p=o(y,0,new V(0,0,100,100));p.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]);let A=Oe.createDropShadow(0,new R(10,0),C.BLACK,.25,5,!1);return A.setBlendMode("DIFFERENCE"),p.setTestOnlyEffects([A]),b.asyncAssertMatchesSnapshot("should generate blend for knockout shadow",p.renderTree1().debugString1())}),be("drop shadow with knockout: with an inner shadow",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]),p.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,.25,5,!1),Oe.createInnerShadow(4,new R(5,5),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("should generate knockout shadow and inner shadow",p.renderTree1().debugString1())}),be("drop shadow with knockout: with fill/stroke blend modes",()=>{let p=o(y,0,new V(0,0,100,100)),A=te.createSolid(C.RED,.5);A.setBlendMode("HARD_LIGHT"),p.setTestOnlyFillPaints([A]);let v=te.createSolid(C.BLUE,.5);return v.setBlendMode("SOFT_LIGHT"),p.setTestOnlyStrokePaints([v]),p.setStrokeWeight(5),p.setStrokeAlign("OUTSIDE"),p.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,.25,5,!1)]),b.asyncAssertMatchesSnapshot("should generate fills/strokes with effects correctly (should not nest blends into knockout shadow mask alpha)",p.renderTree1().debugString1())}),be("with fill/stroke blend modes (fast stroke optimization)",()=>{let p=Object({viewer_fast_stroke_shadow:!0});X.updateFeatureFlags(p);let A=o(y,1,new V(0,0,100,100)),v=te.createSolid(C.RED,.5);v.setBlendMode("HARD_LIGHT"),A.setTestOnlyFillPaints([v]);let E=te.createSolid(C.BLACK,1);return E.setBlendMode("SOFT_LIGHT"),A.setTestOnlyStrokePaints([E]),A.setStrokeAlign("OUTSIDE"),A.setStrokeJoin("MITER"),A.setStrokeMiterLimit(4),A.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,.25,5,!1)]),b.asyncAssertMatchesSnapshot("should generate strokes with a combined rendertree.",A.renderTree1().debugString1())}),be("drop shadow with knockout: should not render knockout shadow inside bg blur",()=>{let p=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(p);let A=lo(y,"frame",te.createSolid(C.RED,1));Je(A,new R(0,0),new R(50,50));let v=o(y,0,new V(0,0,100,100));return v.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]),v.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,.25,5,!1),Oe.createBackgroundBlur(10)]),b.asyncAssertMatchesSnapshot("should not render knockout shadow inside bg blur",v.renderTree1().debugString1())}),be("drop shadow with knockout: with drop shadow that does not overlap node at all",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]),p.setTestOnlyEffects([Oe.createDropShadow(10,new R(200,0),C.BLACK,.25,5,!1)]),b.asyncAssertMatchesSnapshot("should optimize but not cull knockout shadow that does not overlap node",p.renderTree1().debugString1())}),be("drop shadow with knockout: transparent frame with stroke should have no shadows inside",()=>{let p=lt(y);Je(p,new R(-100,-100),new R(300,300));let A=$a(p,"frame",[te.createSolid(C.RED,0)],[te.createSolid(C.BLACK,1)],new V(0,0,50,50));return Je(A,new R(0,0),new R(50,50)),A.setTestOnlyEffects([Oe.createDropShadow(10,new R(10,0),C.BLACK,1,5,!1)]),b.asyncAssertMatchesSnapshot("should generate knockout shadow for transparent node",A.renderTree1().debugString1())}),be("inner shadow",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyEffects([Oe.createInnerShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("should output inner shadow",p.renderTree1().debugString1())}),be("two inner shadows",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyEffects([Oe.createInnerShadow(0,new R(50,50),C.RED,1),Oe.createInnerShadow(0,new R(-50,-50),C.GREEN,1)]),b.asyncAssertMatchesSnapshot("should output two inner shadows",p.renderTree1().debugString1())}),be("inner shadow w/ zero blur radius",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyEffects([Oe.createInnerShadow(0,new R(0,4),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("should NOT output inner shadow",p.renderTree1().debugString1())}),be("inner shadow, with outside stroke (mask.alpha HARD_MASK_WITH_COLOR inlines into shader)",()=>{let p=o(y,1,new V(0,0,100,100));return p.setStrokeAlign("OUTSIDE"),p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyStrokePaints([te.createSolid(C.WHITE,1)]),p.setTestOnlyEffects([Oe.createInnerShadow(1,new R(0,4),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("should have mask without hard mask alpha",p.renderTree1().debugString1())}),be("semi-transparent rect",()=>{let p=o(y,0,new V(0,0,100,100));return p.setTestOnlyFillPaints([te.createSolid(C.BLACK,.5)]),p.setOpacity(.5),b.asyncAssertMatchesSnapshot("opacity should be baked into fill paint",p.renderTree1().debugString1())}),be("simple rect with stroke",()=>{let p=o(y,1,new V(0,0,100,100));return p.setStrokeAlign("INSIDE"),p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),p.setTestOnlyStrokePaints([te.createSolid(C.WHITE,1)]),b.asyncAssertMatchesSnapshot("should output FillStroke",p.renderTree1().debugString1())}),be("rect with stroke and disabled fill should NOT render fill",()=>{let p=o(y,1,new V(0,0,100,100));p.setStrokeAlign("INSIDE");let A=te.createSolid(C.BLACK,1);return A.setIsEnabled(!1),p.setTestOnlyFillPaints([A]),p.setTestOnlyStrokePaints([te.createSolid(C.WHITE,1)]),b.asyncAssertMatchesSnapshot("FILL_STROKE should NOT have black fill",p.renderTree1().debugString1())}),be("background blur with no background",()=>{let p=Object({viewer_background_blur_opts:!0});X.updateFeatureFlags(p);let A=lo(y,"frame",te.createSolid(C.RED,.5));return Je(A,new R(0,0),new R(100,100)),A.setTestOnlyEffects([Oe.createBackgroundBlur(10)]),b.asyncAssertMatchesSnapshot("should not generate a background blur subtree",A.renderTree1().debugString1())}),be("background blur with no scrolling elements",()=>{let p=Object({viewer_background_blur_opts:!0});X.updateFeatureFlags(p);let A=lo(y,"frame",te.createSolid(C.RED,1));Je(A,new R(0,0),new R(100,100));let v=o(y,0,new V(0,0,50,50));return v.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]),v.setTestOnlyEffects([Oe.createBackgroundBlur(10)]),b.asyncAssertMatchesSnapshot("should not include an INVERSE_TRANSFORM node",v.renderTree1().debugString1())}),be("background blur with scroll: foreground and background in clipping frame",()=>{let p=Object({viewer_background_blur_opts:!0});X.updateFeatureFlags(p);let A=lo(y,"frame",te.createSolid(C.RED,1));Je(A,new R(0,0),new R(100,100)),A.setOverflowDirection("VERTICAL");let v=lo(A,"container",te.createSolid(C.WHITE,1));Je(v,new R(0,0),new R(100,500));let E=o(v,0,new V(0,0,50,50));return E.setTestOnlyFillPaints([te.createSolid(C.RED,.5)]),E.setTestOnlyEffects([Oe.createBackgroundBlur(10)]),b.asyncAssertMatchesSnapshot("background blur should not include INVERSE_TRANSFORM or scrolling TRANSFORM nodes",E.renderTree1().debugString1())}),Bt("simple stroke-only rect",()=>{let p=null;beforeEach(()=>{I(),p=o(y,1,new V(0,0,100,100)),p.setTestOnlyFillPaints(Ce.EMPTY),p.setTestOnlyStrokePaints([te.createSolid(C.WHITE,1)])}),be("inside stroke",()=>(d(p,1,"INSIDE"),b.asyncAssertMatchesSnapshot("should output FillStroke with mode .INSIDE",p.renderTree1().debugString1()))),be("outside stroke",()=>(d(p,1,"OUTSIDE"),b.asyncAssertMatchesSnapshot("should output FillStroke with mode .OUTSIDE",p.renderTree1().debugString1()))),be("center stroke",()=>(d(p,1,"CENTER"),b.asyncAssertMatchesSnapshot("should output FillStroke with mode .CENTER",p.renderTree1().debugString1())))}),Bt("drop shadow with stroke, no spread",()=>{let p=null;be("strokeAlign = CENTER, drop shadow",()=>{let A=Object({viewer_fast_stroke_shadow:!0});return X.updateFeatureFlags(A),I(),p=l(y,0,new V(0,0,100,100),[te.createSolid(C.BLACK,1)],[te.createSolid(C.WHITE,1)],"CENTER",4,new R(0,0),C.BLACK,.25),b.asyncAssertMatchesSnapshot("Should output one BLUR and three FILLS",p.renderTree1().debugString1())}),be("strokeAlign = INSIDE, drop shadow",()=>{let A=Object({viewer_fast_stroke_shadow:!0});return X.updateFeatureFlags(A),I(),p=l(y,0,new V(0,0,100,100),[te.createSolid(C.BLACK,1)],[te.createSolid(C.WHITE,1)],"INSIDE",4,new R(0,0),C.BLACK,.25),b.asyncAssertMatchesSnapshot("Should output one BLUR, two FILLS and one FILL_STROKE",p.renderTree1().debugString1())}),be("strokeAlign = OUTSIDE, drop shadow",()=>{let A=Object({viewer_fast_stroke_shadow:!0});return X.updateFeatureFlags(A),I(),p=l(y,0,new V(0,0,100,100),[te.createSolid(C.BLACK,1)],[te.createSolid(C.WHITE,1)],"OUTSIDE",4,new R(0,0),C.BLACK,.25),b.asyncAssertMatchesSnapshot("Should output one BLUR, TWO FILLS, and one FILL_STROKE",p.renderTree1().debugString1())}),be("simulated image border, corner radius > 0",()=>{let A=Object({viewer_fast_stroke_shadow:!0});X.updateFeatureFlags(A),I(),p=s(y,20,1,new V(0,0,100,100));let v=te.createSolid(C.WHITE,1);p.setTestOnlyFillPaints([v]);let E=te.createSolid(C.WHITE,1);return p.setTestOnlyStrokePaints([E]),p.setStrokeAlign("OUTSIDE"),p.setTestOnlyEffects([Oe.createDropShadow(6,new R(0,2),C.BLACK,.1,0,!1),Oe.createDropShadow(6,new R(0,0),C.BLACK,.08,0,!1),Oe.createDropShadow(6,new R(0,0),C.BLACK,.2,0,!1)]),p.setStrokeJoin("MITER"),p.setStrokeMiterLimit(4),b.asyncAssertMatchesSnapshot("should output three BLURs with FILLs, a FILL, and a FILL_STROKE.",p.renderTree1().debugString1())})}),Bt("Simple tests on non-rects",()=>{be("simple non-rectangle",()=>{let p=c(y,new V(0,0,100,100));return b.asyncAssertMatchesSnapshot("should be single fill without isRect flag",p.renderTree1().debugString1())}),be("non-rectangle not clipped by frame",()=>{let p=lt(y);return Je(p,new R(0,0),new R(100,100)),p.setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),c(p,new V(0,0,99,99)),b.asyncAssertMatchesSnapshot("group with two fills (frame background and non-rect layer)",p.renderTree1().debugString1())}),be("non-rectangle clipped by frame",()=>{let p=lt(y);return Je(p,new R(0,0),new R(50,50)),p.setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),c(p,new V(0,0,100,100)),b.asyncAssertMatchesSnapshot("clipping should not be optimized",p.renderTree1().debugString1())})}),be("grouped single node",()=>{let p=ni(y);ma(p,!1),Je(p,new R(0,0),new R(100,100));let A=o(p,0,new V(0,0,100,100));return A.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),b.asyncAssertMatchesSnapshot("group should be ellided since it does not affect rendering",A.renderTree1().debugString1())}),be("nested groups",()=>{let p=ni(y);ma(p,!1),Je(p,new R(0,0),new R(100,100));let A=ni(p);ma(A,!1),Je(A,new R(0,0),new R(50,50)),o(A,0,new V(0,0,50,50)).setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]);let E=ni(p);return ma(E,!1),Je(E,new R(50,50),new R(50,50)),o(E,0,new V(0,0,50,50)).setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),b.asyncAssertMatchesSnapshot("render tree should contain only 1 group since groups do not affect rendering",p.renderTree1().debugString1())}),be("flatten nested opacities",()=>{let p=ni(y);Je(p,new R(0,0),new R(100,100)),p.setOpacity(.8);let A=ni(p);Je(A,new R(0,0),new R(50,50)),A.setOpacity(.5);let v=o(A,0,new V(0,0,50,50));v.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),v.setOpacity(.5);let E=ni(p);Je(E,new R(50,50),new R(50,50)),E.setOpacity(.25);let D=o(E,0,new V(0,0,50,50));return D.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]),D.setOpacity(.1),b.asyncAssertMatchesSnapshot("opacities for ellided groups should be applied to leaves",p.renderTree1().debugString1())}),Bt("node outside bounds of frame",()=>{let p=null;beforeEach(()=>{I(),p=lt(y),p.setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),Je(p,new R(0,0),new R(100,100)),o(p,0,new V(110,110,100,100)).setTestOnlyFillPaints([te.createSolid(C.BLACK,1)])}),be("without frame clipping",()=>(p.setIsFrameMaskDisabled(!0),b.asyncAssertMatchesSnapshot("there should be two fills; one for the non-clipped rect",p.renderTree1().debugString1()))),be("with frame clipping",()=>(p.setIsFrameMaskDisabled(!1),b.asyncAssertMatchesSnapshot("there should be on fill; rect was clipped",p.renderTree1().debugString1()))),Ie("with frame clipping and no background color",()=>{p.setIsFrameMaskDisabled(!1),ma(p,!1),S(p.renderTree1(),null)})}),Bt("frame background",()=>{let p=null;beforeEach(()=>{I(),p=lt(y),p.setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),ma(p,!0),Je(p,new R(0,0),new R(100,100))}),be("with solid paint",()=>(p.setTestOnlyFillPaints([te.createSolid(C.new3(1,.5,0,1),1)]),b.asyncAssertMatchesSnapshot("frame background fill should be present",y.renderTree1().debugString1()))),be("with solid paint and blend mode",()=>{let A=te.createSolid(C.new3(1,.5,0,1),1);return A.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",y.renderTree1().debugString1())}),be("with solid paint and blended gradient",()=>{let A=te.createSolid(C.new3(1,.5,0,1),1),v=te.createLinearGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);return v.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([A,v]),b.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",y.renderTree1().debugString1())}),be("with solid paint and blend mode and children",()=>{let A=te.createSolid(C.new3(1,.5,0,1),1);return A.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([A]),o(p,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.BLACK,.5)]),b.asyncAssertMatchesSnapshot("should output background and children",y.renderTree1().debugString1())}),be("with drop shadow and opaque fill",()=>(p.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("should not output a drop shadow",p.renderTree1().debugString1()))),be("with drop shadow and no opaque fill",()=>(p.setTestOnlyFillPaints([te.createSolid(C.WHITE,.5)]),p.setTestOnlyEffects([Oe.createDropShadow(4,new R(0,0),C.BLACK,.25)]),b.asyncAssertMatchesSnapshot("should output a drop shadow",p.renderTree1().debugString1())))}),Bt("frame fills for containers supporting fill stroke and corners",()=>{let p=null;beforeEach(()=>{I(),p=lt(y),p.setContainerSupportsFillStrokeAndCorners(!0),p.setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),Je(p,new R(0,0),new R(100,100))}),be("with solid paint",()=>(p.setTestOnlyFillPaints([te.createSolid(C.new3(1,.5,0,1),1)]),b.asyncAssertMatchesSnapshot("frame background fill should be present",y.renderTree1().debugString1()))),be("with solid paint and blend mode",()=>{let A=te.createSolid(C.new3(1,.5,0,1),1);return A.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",y.renderTree1().debugString1())}),be("with solid paint and blended gradient",()=>{let A=te.createSolid(C.new3(1,.5,0,1),1),v=te.createLinearGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);return v.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([A,v]),b.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",y.renderTree1().debugString1())}),be("with solid paint and blend mode and children",()=>{let A=te.createSolid(C.new3(1,.5,0,1),1);return A.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([A]),o(p,0,new V(0,0,100,100)).setTestOnlyFillPaints([te.createSolid(C.BLACK,.5)]),b.asyncAssertMatchesSnapshot("should output background and children",y.renderTree1().debugString1())}),be("with inside stroke",()=>{let A=$a(y,"frame",[te.createSolid(C.RED,1)],[te.createSolid(C.BLACK,1)],new V(0,0,50,50));return Je(A,new R(0,0),new R(50,50)),A.setContainerSupportsFillStrokeAndCorners(!0),A.setStrokeAlign("INSIDE"),A.setStrokeWeight(4),c(A,new V(0,0,100,100)),b.asyncAssertMatchesSnapshot("should generate a fill render node that is clipped by the frame mask",y.renderTree1().debugString1())}),be("with outside stroke",()=>{let A=$a(y,"frame",[te.createSolid(C.RED,1)],[te.createSolid(C.BLACK,1)],new V(0,0,50,50));return Je(A,new R(0,0),new R(50,50)),A.setContainerSupportsFillStrokeAndCorners(!0),Je(A,new R(0,0),new R(50,50)),A.setStrokeAlign("OUTSIDE"),A.setStrokeWeight(4),c(A,new V(0,0,100,100)),b.asyncAssertMatchesSnapshot("should have stroke on top of mask",y.renderTree1().debugString1())})}),Bt("masks",()=>{be("blend mode of masked content should mark mask and all ancestors as 'hasBlends'",()=>{let p=Object({rounded_mask_optimization:!0});X.updateFeatureFlags(p);let A=lt(y);return A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),o(A,0,new V(0,0,10,10)).setIsMask(!0),o(A,0,new V(0,0,100,100)).setBlendMode("MULTIPLY"),b.asyncAssertMatchesSnapshot("all ancestors of rect should have 'hasBlends' flag",y.renderTree1().debugString1())}),be("small outside strokes should be masked",()=>{let p=Object({rounded_mask_optimization:!0});X.updateFeatureFlags(p);let A=lt(y);A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),o(A,0,new V(0,0,100,100)).setIsMask(!0);let E=n(A,1,new V(0,0,100,100),2);return E.setStrokeAlign("OUTSIDE"),E.setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),E.setTestOnlyStrokePaints([te.createSolid(C.BLACK,1)]),b.asyncAssertMatchesSnapshot("optimized RenderTree should mask rect with outside stroke",y.renderTree1().optimized().debugString1())}),be("mask should be ignored if color is contained within the alpha",()=>{let p=Object({rounded_mask_optimization:!0});X.updateFeatureFlags(p);let A=lt(y);return A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),s(A,50,0,new V(0,0,100,100)).setIsMask(!0),s(A,10,0,new V(40,40,20,20)).setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),b.asyncAssertMatchesSnapshot("optimized RenderTree should ignore mask as contained",y.renderTree1().optimized().debugString1())}),be("mask should not ignored if color is not contained within the alpha",()=>{let p=Object({rounded_mask_optimization:!0});X.updateFeatureFlags(p);let A=lt(y);return A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),s(A,50,0,new V(0,0,100,100)).setIsMask(!0),s(A,32,0,new V(12,12,76,76)).setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),b.asyncAssertMatchesSnapshot("optimized RenderTree should have a mask if alpha does not contain color",y.renderTree1().optimized().debugString1())}),be("mask should be ignored if color contained within the a rounded rectangular alpha",()=>{let p=Object({rounded_mask_optimization:!0});X.updateFeatureFlags(p);let A=lt(y);return A.setIsBackgroundEnabled(!1),A.setIsFrameMaskDisabled(!0),s(A,27,0,new V(0,0,100,100)).setIsMask(!0),s(A,32,0,new V(12,12,76,76)).setTestOnlyFillPaints([te.createSolid(C.WHITE,1)]),b.asyncAssertMatchesSnapshot("optimized RenderTree should not contain a mask if color is contained within a rounded rectangular alpha",y.renderTree1().optimized().debugString1())})}),Bt("rectangle visibility",()=>{let p=null;beforeEach(()=>{I(),p=o(y,0,new V(0,0,100,100)),p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)])}),be("default visible",()=>b.asyncAssertMatchesSnapshot("should output single fill",p.renderTree1().debugString1())),Ie("visibility false",()=>{p.setVisible(!1),S(p.renderTree1(),null)}),Ie("layer opacity zero",()=>{p.setOpacity(0),S(p.renderTree1(),null)}),Ie("fill paint opacity zero",()=>{p.setTestOnlyFillPaints([te.createSolid(C.BLACK,0)]),S(p.renderTree1(),null)}),Ie("no paints",()=>{p.setTestOnlyFillPaints(Ce.EMPTY),S(p.renderTree1(),null)}),Ie("no fill paint, stroke paints, zero stroke width",()=>{let v=n(y,1,new V(0,0,100,100),0);v.setTestOnlyFillPaints(Ce.EMPTY),v.setTestOnlyStrokePaints([te.createSolid(C.TRANSPARENT,0)]),S(v.renderTree1(),null)})}),Bt("solid paints",()=>{let p=null;beforeEach(()=>{I(),p=o(y,0,new V(0,0,100,100))}),be("normal",()=>(p.setTestOnlyFillPaints([te.createSolid(C.new3(1,.5,0,1),1)]),b.asyncAssertMatchesSnapshot("should output fill with opacity=1",p.renderTree1().debugString1()))),be("50% opacity",()=>(p.setTestOnlyFillPaints([te.createSolid(C.new3(1,.5,0,1),.5)]),b.asyncAssertMatchesSnapshot("should output fill with opacity=0.5",p.renderTree1().debugString1()))),Ie("0% opacity",()=>{p.setTestOnlyFillPaints([te.createSolid(C.new3(1,.5,0,1),0)]),S(p.renderTree1(),null)}),Ie("disabled",()=>{let A=te.createSolid(C.new3(1,.5,0,1),1);A.setIsEnabled(!1),p.setTestOnlyFillPaints([A]),S(p.renderTree1(),null)}),be("multiply blend",()=>{let A=te.createSolid(C.new3(1,.5,0,1),1);return A.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("should output Blend with Fill child",p.renderTree1().debugString1())})}),Bt("gradient paints",()=>{let p=null;beforeEach(()=>{I(),p=o(y,0,new V(0,0,100,100))}),be("linear",()=>{let A=te.createLinearGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);return p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("should output Fill with linear gradient paint",p.renderTree1().debugString1())}),be("radial",()=>{let A=te.createRadialGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);return p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("should output Fill with radial gradient paint",p.renderTree1().debugString1())}),be("angular",()=>{let A=te.createAngularGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);return p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("should output Fill with angular gradient paint",p.renderTree1().debugString1())}),be("diamond",()=>{let A=te.createDiamondGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);return p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("should output Fill with diamond gradient paint",p.renderTree1().debugString1())}),be("50% opacity",()=>{let A=te.createLinearGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);return A.setOpacity(.5),p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("should output linear gradient with 50% opacity",p.renderTree1().debugString1())}),Ie("0% opacity",()=>{let A=te.createLinearGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);A.setOpacity(0),p.setTestOnlyFillPaints([A]),S(p.renderTree1(),null)}),Ie("disabled",()=>{let A=te.createLinearGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);A.setIsEnabled(!1),p.setTestOnlyFillPaints([A]),S(p.renderTree1(),null)}),be("40% stop opacity",()=>{let A=te.createLinearGradient([new ot(C.new3(1,.5,0,.4),.25),new ot(C.new3(0,.5,1,.6),.75)]);return p.setTestOnlyFillPaints([A]),b.asyncAssertMatchesSnapshot("should output linear gradient with partial opacity stops",p.renderTree1().debugString1())}),Ie("0% stop opacity",()=>{let A=te.createLinearGradient([new ot(C.new3(1,.5,0,0),.25),new ot(C.new3(0,.5,1,0),.75)]);p.setTestOnlyFillPaints([A]),S(p.renderTree1(),null)}),be("transform",()=>{let A=te.createLinearGradient([new ot(C.new3(1,.5,0,1),.25),new ot(C.new3(0,.5,1,1),.75)]);A.setTransform1(new ee(.5,-.5,1,-1,1.5,-1.5)),p.setTestOnlyFillPaints([A]);let v=p.renderTree1();S(v.op(),3);let D=v.geometry.paints;return S(D,p.fillPaints()),b.asyncAssertMatchesSnapshot("should output linear gradient",p.renderTree1().debugString1())})}),be("geometry",()=>{let p=gn(y,"VECTOR");p.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]);let A=new V(0,0,100,100),v=new Fr("ODD",0,Pt.new2().moveTo1(0,0).lineTo(100,0).lineTo(50,100).close(),A),E=new Fr("NONZERO",0,Pt.new2().moveTo1(0,100).lineTo(100,100).lineTo(50,0).close(),A);p.setTestOnlyFillGeometry(new xr([v,E],null,A,null));let D=p.renderTree1();S(D.op(),1);let G=D;return S(G.children.length,2),S(G.children[0].op(),3),S(G.children[1].op(),3),S(G.children[0].geometry.path().windingRule(),"ODD"),S(G.children[1].geometry.path().windingRule(),"NONZERO"),b.asyncAssertMatchesSnapshot("should output a group with two fills",p.renderTree1().debugString1())})}),Bt("RenderTree optimization of PaintData",()=>{Ie("dual-color gradient",()=>{let T=[te.createLinearGradient([new ot(C.new3(0,.5,1,1),0),new ot(C.new3(1,.5,0,1),1)])],y=Ce.optimize(T);S(y.length,1),S(y[0].type(),"GRADIENT_LINEAR")}),Ie("dual-opacity gradient",()=>{let T=[te.createLinearGradient([new ot(C.new3(1,.5,0,0),0),new ot(C.new3(1,.5,0,1),1)])],y=Ce.optimize(T);S(y.length,1),S(y[0].type(),"GRADIENT_LINEAR")}),Ie("single-color gradient",()=>{let T=[te.createLinearGradient([new ot(C.new3(1,.5,0,1),0),new ot(C.new3(1,.5,0,1),1)])],y=Ce.optimize(T);S(y.length,1),S(y[0].type(),"SOLID")}),Ie("solid underneath dual-color gradient",()=>{let T=[te.createSolid(C.GREEN,1),te.createLinearGradient([new ot(C.new3(0,0,1,.5),0),new ot(C.new3(1,0,0,.5),1)])],y=Ce.optimize(T);S(y.length,1),S(y[0].type(),"GRADIENT_LINEAR"),y[0].asSinglePaint()!=null;let I=y[0].asSinglePaint().colorStops()[0],p=y[0].asSinglePaint().colorStops()[1];S(I.position,0),e(I.color,C.new3(0,.5,.5,1)),S(p.position,1),e(p.color,C.new3(.5,.5,0,1))}),Ie("solid underneath single-color gradient",()=>{let T=[te.createSolid(C.GREEN,1),te.createLinearGradient([new ot(C.new3(1,0,0,.5),0),new ot(C.new3(1,0,0,.5),1)])],y=Ce.optimize(T);S(y.length,1),S(y[0].type(),"SOLID"),e(y[0].asSinglePaint().color(),C.new3(.5,.5,0,1))})}),Bt("RenderTree.isRect",()=>{let T=I=>{S(new Ft(I,"ODD").isRect(),!0)},y=I=>{S(new Ft(I,"ODD").isRect(),!1)};Ie("RenderTree.isRect",()=>{T(Pt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5)),T(Pt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0)),T(Pt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),T(Pt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).close()),T(Pt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),y(Pt.new2().moveTo1(10,0).lineTo(10,5).lineTo(0,5)),y(Pt.new2().moveTo1(10,0).lineTo(0,0).lineTo(10,5).lineTo(0,5).close()),y(Pt.new2().quadraticTo(10,0,10,5).lineTo(0,5)),y(Pt.new2().lineTo(10,0).quadraticTo(10,5,0,5)),y(Pt.new2().cubicTo1(10,0,10,5,0,5));let p=_t.createSceneWithCanvasForTests1().root().childAt1(0),A=o(p,0,new V(0,0,100,100));S(A.renderTree1()!=null,!0),S(A.renderTree1().isRectFill(),!0)})}),Bt("RenderTree optimization of Group nodes",()=>{let T=null;beforeEach(()=>{let y=new Qt(new Ft(Ot.fromRect(new V(0,0,1,1)),"ODD"),[te.createSolid(C.BLACK,1)]);T=new yr(ee.new2(),y,R.new2())}),Ie("empty group",()=>{S(new Xe([]).optimized(),null)}),Ie("empty nested group",()=>{S(new Xe([new Xe([])]).optimized(),null)}),be("single group",()=>b.asyncAssertMatchesSnapshot("should be fill only; no groups",new Xe([T]).optimized().debugString1())),be("single nested group",()=>b.asyncAssertMatchesSnapshot("should be fill only; no groups",new Xe([new Xe([T])]).optimized().debugString1())),be("double group",()=>b.asyncAssertMatchesSnapshot("group with two fill children can't be optimized",new Xe([T,T]).optimized().debugString1())),be("double nested group 1",()=>b.asyncAssertMatchesSnapshot("outer group should be optimized away, leaving a group with two fill children",new Xe([new Xe([T,T])]).optimized().debugString1())),be("double nested group 2",()=>b.asyncAssertMatchesSnapshot("inner groups should be optimized away, leaving a group with two fill children",new Xe([new Xe([T]),new Xe([T])]).optimized().debugString1()))}),Bt("RenderTree optimization of Dissolve",()=>{let T=null,y=null,I=(p,A)=>new en(p,A,"A",()=>1).optimized();beforeEach(()=>{let p=new Qt(new Ft(Ot.fromRect(new V(0,0,1,1)),"ODD"),[te.createSolid(C.BLACK,1)]);T=new yr(ee.new2(),p,R.new2());let A=new Qt(new Ft(Ot.fromRect(new V(0,0,1,1)),"ODD"),[te.createSolid(C.RED,1)]);y=new yr(ee.new2(),A,R.new2())}),Ie("both subtrees null",()=>{S(I(null,null),null)}),be("old subtree null",()=>b.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because old subtree is null",I(null,T).debugString1())),be("new subtree null",()=>b.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because new subtree is null",I(T,null).debugString1())),be("identical subtrees",()=>b.asyncAssertMatchesSnapshot("dissolve should be optimized away entirely because subtrees are identical",I(T,T).debugString1())),be("different subtrees",()=>b.asyncAssertMatchesSnapshot("dissolve should not be optimized away",I(T,y).debugString1()))}),Bt("RenderTree optimization of Fill",()=>{Ie("fill with zero opacity paint",()=>{S(new yr(ee.new2(),new Qt(new Ft(Ot.fromRect(new V(0,0,1,1)),"ODD"),[te.createSolid(C.BLACK,0)]),R.new2()).optimized(),null)}),Ie("fill with disabled paint",()=>{S(new yr(ee.new2(),new Qt(new Ft(Ot.fromRect(new V(0,0,1,1)),"ODD"),[te.create("SOLID",1,"NORMAL",!1,C.BLACK)]),R.new2()).optimized(),null)}),Ie("fill with empty bounds",()=>{S(new yr(ee.new2(),new Qt(new Ft(Ot.fromRect(new V(0,0,0,0)),"ODD"),[te.createSolid(C.BLACK,1)]),R.new2()).optimized(),null)})}),Bt("RenderTree optimization of Blur",()=>{let T=null;beforeEach(()=>{let y=new Qt(new Ft(Ot.fromRect(new V(0,0,1,1)),"ODD"),[te.createSolid(C.BLACK,1)]);T=new yr(ee.new2(),y,R.new2())}),be("zero radius blur",()=>b.asyncAssertMatchesSnapshot("should contain no Blur node",new zn(0,T,V.INVALID).optimized().debugString1())),be("blur wrapping volatile fill",()=>b.asyncAssertMatchesSnapshot("volatile property binding should be OUTSIDE of blur",new zn(10,pt.forTranslation(T,Ct.forAnimateableTranslation("x"),()=>R.new2()),V.INVALID).optimized().debugString1())),be("clamp blur wrapping volatile fill",()=>b.asyncAssertMatchesSnapshot("volatile property binding should be INSIDE of blur",new zn(10,pt.forTranslation(T,Ct.forAnimateableTranslation("x"),()=>R.new2()),new V(0,0,1,1)).optimized().debugString1()))}),Bt("RenderTree optimization of HardMaskWithColor",()=>{let T=null;beforeEach(()=>{let y=new Qt(new Ft(Ot.fromRect(new V(0,0,1,1)),"ODD"),[te.createSolid(C.BLACK,1)]);T=new yr(ee.new2(),y,R.new2())}),be("hard mask wrapping fill",()=>b.asyncAssertMatchesSnapshot("should be a single Fill",new so(T,C.BLACK).optimized().debugString1())),be("hard mask wrapping volatile fill",()=>b.asyncAssertMatchesSnapshot("should be a single Fill wrapped by the VolatilePropertyBinding",new so(pt.forTranslation(T,Ct.forAnimateableTranslation("x"),()=>R.new2()),C.BLACK).optimized().debugString1())),be("hard mask wrapping blend nodes",()=>b.asyncAssertMatchesSnapshot("should be a single Fill",new so(new Wn("MULTIPLY",.5,T),C.BLACK).optimized().debugString1()))}),Bt("Stack reverse Z index",()=>{let T=null,y=null,I=()=>{T=_t.createSceneWithCanvasForTests1(),y=T.root().childAt1(0),y.setPrototypeDevice(jr.DEFAULT)};beforeEach(I),be("stacking frame without stackReverseZIndex",()=>{let p=at(y,"f");return Ht(p,"c1",C.RED,1),Ht(p,"c2",C.BLUE,1),p.setStackMode("VERTICAL"),p.setStackReverseZIndex(!1),b.asyncAssertMatchesSnapshot("should have non-reversed children",p.renderTree1().debugString1())}),be("stacking frame with stackReverseZIndex",()=>{let p=at(y,"f");return Ht(p,"c1",C.RED,1),Ht(p,"c2",C.BLUE,1),p.setStackMode("VERTICAL"),p.setStackReverseZIndex(!0),b.asyncAssertMatchesSnapshot("should have reversed children",p.renderTree1().debugString1())}),be("non-stacking frame without stackReverseZIndex",()=>{let p=at(y,"f");return Ht(p,"c1",C.RED,1),Ht(p,"c2",C.BLUE,1),p.setStackMode("NONE"),p.setStackReverseZIndex(!1),b.asyncAssertMatchesSnapshot("should have non-reversed children",p.renderTree1().debugString1())}),be("non-stacking frame with stackReverseZIndex",()=>{let p=at(y,"f");return Ht(p,"c1",C.RED,1),Ht(p,"c2",C.BLUE,1),p.setStackMode("NONE"),p.setStackReverseZIndex(!0),b.asyncAssertMatchesSnapshot("should have non-reversed children",p.renderTree1().debugString1())})})}f.testRenderTree=h;function u(){let S=AssertLib.deepStrictEqual;Ie("Reparenting a node should invalidate render trees on both its old and its new parent",()=>{let T=_t.createSceneWithCanvasForTests1().root().childAt1(0),y=lt(T),I=lt(T),p=o(y,0,new V(0,0,100,100)),A=y.renderTree1(),v=I.renderTree1();S(A!=null,!0),S(v!=null,!0),p.setParentIndex(new Vr(J.invalid(),dr.fromString(""))),I.appendChild(p);let E=y.renderTree1(),D=I.renderTree1();S(E!=A,!0),S(D!=v,!0)})}f.testNodeRenderTree=u;function m(){let S=AssertLib.deepStrictEqual,b=AssertLib.notDeepStrictEqual;Ie("equalWithinBounds works for Group nodes",()=>{let y=_t.createSceneWithCanvasForTests1().root().childAt1(0),I=sr(y,"frame1",C.BLUE),p=sr(y,"frame2",C.BLUE),A=null,v=null,E=()=>{A=I.renderTree1(),v=p.renderTree1()};E(),S(A.equals(v),!0),S(A,v),S(A.equalsWithinBounds(v,new V(15,15,10,10)),!0),S(A.equalsWithinBounds(v,new V(0,0,5,5)),!0);let D=o(I,0,new V(1,1,10,10)),G=o(p,0,new V(0,0,10,10));E(),S(A.equals(v),!1),b(A,v),S(A.equalsWithinBounds(v,new V(15,15,10,10)),!0),S(A.equalsWithinBounds(v,new V(0,0,5,5)),!1);let U=o(I,0,new V(15,15,10,10));E(),S(A.equalsWithinBounds(v,new V(30,30,10,10)),!1),S(A.equalsWithinBounds(v,new V(15,15,10,10)),!1),S(A.equalsWithinBounds(v,new V(0,0,5,5)),!1)}),Ie("equalWithinBounds works with nested masking",()=>{let y=_t.createSceneWithCanvasForTests1().root().childAt1(0),I=sr(y,"frame1",C.BLUE),p=sr(y,"frame2",C.BLUE),A=null,v=null,E=()=>{A=I.renderTree1(),v=p.renderTree1()};E(),S(A.equals(v),!0),S(A,v),S(A.equalsWithinBounds(v,new V(15,15,10,10)),!0),S(A.equalsWithinBounds(v,new V(0,0,5,5)),!0),o(I,0,new V(1,1,10,10)).setIsMask(!0);let G=o(I,0,new V(1,1,100,100));o(p,0,new V(1,1,10,10)).setIsMask(!0);let M=o(p,0,new V(1,1,101,101));E(),S(A.equals(v),!1),b(A,v),S(A.equalsWithinBounds(v,new V(15,15,10,10)),!0),S(A.equalsWithinBounds(v,new V(0,0,5,5)),!1)})}f.testEqualsWithinBounds=m;let g;(T=>(T[T.FILL=0]="FILL",T[T.FILL_AND_STROKE=1]="FILL_AND_STROKE"))(g=f.GeometryType||(f.GeometryType={}));let _;(T=>{function S(y){return y==0||y==1}T.GeometryType_hasFill=S;function b(y){return y==1}T.GeometryType_hasStroke=b})(_=f.in_GeometryType||(f.in_GeometryType={}))})($p||($p={}));var eh;(s=>(s.FIG_FILE_NO_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,73,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,130,136,1,0]),s.FIG_FILE_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,76,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,2,11,177,49,48,0,0,3,0,0,0,1,2,3]),s.GIF_MULTI_IMAGE=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,2,76,1,0,59]),s.GIF_MALFORMED_END_NO_EOF=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,50,76,1,0]),s.GIF_SPEED=new Uint8Array([71,73,70,56,57,97,2,0,2,0,240,0,0,0,0,0,255,255,255,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,0,25,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,33,249,4,0,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,68,0,5,0,33,249,4,0,100,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,132,83,0,33,249,4,0,200,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,4,2,5,0,59]),s.GIF_D1_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,5,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59]),s.GIF_D3_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,13,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59])))(eh||(eh={}));var ad=class{constructor(e,t){if(this._app=null,this._frameLoader=null,this._session=null,this._pendingNodeId=null,this._app=e,this._session=t,this._frameLoader=this._session.incrementalLoader(),this._frameLoader==null)throw new Error("Expected incremental frame loader for mirror mode");this._emitter=$t.getEventEmitter(),this._pendingNodeId=null,this._emitter.on("incrementalLoadingInfo",r=>{r.type==="finishIncrementalLoading"&&this._handleIncrementalLoadFinished()})}hasPendingSelectionChange(){return this._pendingNodeId!==null}connectToFileAndShowNode(e,t,r,n,o,a){r!=null&&this._app.state().setActivePrototypeStartingPointNodeId(r),this._session.fileKey()!=e?this._app.connectTo(e,t,r,n,o,a):this._app.state().currentFileKey()!=e?(this._frameLoader.requestTlf(t),this._pendingNodeId=t):this._frameLoader.requestTlf(t)?this._app.state().prototypeState().navigateToFrameAndCloseOverlays(t):this._pendingNodeId=t}_handleIncrementalLoadFinished(){var e;this._pendingNodeId!=null&&((e=this._app.state().scene())==null?void 0:e.findNode(this._pendingNodeId))!=null&&(this._app.state().prototypeState().navigateToFrameAndCloseOverlays(this._pendingNodeId),this._pendingNodeId=null)}};var Il;(a=>{function i(s){return{x:Math.round(s.x()*100)/100,y:Math.round(s.y()*100)/100}}a._serialize=i;function e(s){return new R(s.x,s.y)}a._deserializeVector=e;function t(s,l){1&l&&(s.alt=!0),2&l&&(s.meta=!0),4&l&&(s.shift=!0),8&l&&(s.ctrl=!0),16&l&&(s.platform=!0)}a._setModifiers=t;function r(s){return("alt"in s?1:0)|("meta"in s?2:0)|("shift"in s?4:0)|("ctrl"in s?8:0)|("platform"in s?16:0)}a._loadModifiers=r;function n(s,l){let c=s.asMouseEvent();if(c!=null){let h={};return h.type=qa[s.type()],h.at=i(l(c.locationInWindow)),c.locationInWindow.equals(c.previousLocationInWindow)||(h.lastAt=i(l(c.previousLocationInWindow))),c.clickCount!=0&&(h.clicks=c.clickCount),c.scrollDelta!=null&&(h.scroll=i(c.scrollDelta)),t(h,s.modifiers()),h}let d=s.asKeyEvent();if(d!=null){let h={};return h.type=qa[s.type()],h.key=d.key,d.isRepeat&&(h.repeat=!0),t(h,s.modifiers()),h}return null}a.serialize=n;function o(s,l,c,d){let h=aa.ViewerEventType_fromString(s.type);if(aa.ViewerEventType_isMouseEventType(h)){let u=d(e(s.at)),m=l(u),g=u;"lastAt"in s&&(g=d(e(s.lastAt)));let _=null;"scroll"in s&&(_=e(s.scroll));let f=0;"clicks"in s&&(f=s.clicks);let S=r(s);return new za(h,m,S,u,g,_,f,[])}else if(aa.ViewerEventType_isKeyEventType(h)){let u=c(),m=s.key|0,g=s.repeat,_=r(s);return new Qa(h,u,_,m,g)}else if(aa.ViewerEventType_isTouchEventType(h)){let u=r(s),m=d(e(s.at)),g=l(m);if(h==11||h==12){let _=m;"lastAt"in s&&(_=d(e(s.lastAt)));let f=new Ps(0,g,m,_);return new Wa(h,g,u,[f],[f])}else return new Wa(h,g,u,[],[])}else if(aa.ViewerEventType_isWindowEventType(h))throw new Error("Deserializing window events not supported");throw new Error(`Unrecognized event type in deserialize ${qa[h]}`)}a.deserialize=o})(Il||(Il={}));var WJ=new hl(1/.05,1),QJ=pl.withDampingRatio(.5,100,1.1);var $b;(t=>{function i(r,n){return r(n)}t.call=i;function e(r){return r}t._new=e})($b||($b={}));var Zg;(n=>{function i(o){e(o.map(a=>(s,l,c,d)=>{a(c,d)}))}n.createNewSceneAndRun=i;function e(o){let a=new ur,s=_t.createSceneWithCanvasForTests1(),l=s.root().childAt1(0),c=sr(l,"source",C.BLACK);c.setRelativeTransform(new ee(1,0,0,0,1,400)),c.setSize(new R(500,700));let d=sr(l,"dst",C.BLACK);d.setRelativeTransform(new ee(1,0,0,0,1,1100)),d.setSize(new R(500,700)),a.setActiveCanvas(l),a.setScene(s);for(let h of o)h(a,s,c,d)}n.createNewAppStateAndSceneAndRun=e;function t(){let o=AssertLib.deepStrictEqual,a=new ss("./src/test/protomagicmove.test.sk");beforeEach(()=>{X.setViewerMode(X.ViewerMode.PROTOTYPE)}),Bt("getNodeMatches",()=>{let s=(l,c,d)=>{let h=wo.getNodeMatches(l,c);for(let u of d){let m=u[0],g=u[1],_=He.StringMap_get(h,m.id(),null),f=He.StringMap_get(h,g.id(),null);o(_,g,`Expected ${m.id()} to match ${g.id()}, but got ${_==null?null:_.id()} instead.`),o(f,m,`Expected ${g.id()} to match ${m.id()}, but got ${f==null?null:f.id()} instead.`)}o(h.size,d.length*2)};Ie("simple match case",()=>{let c=_t.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),h=rt(d,"A"),u=rt(d,"B"),m=rt(d,"C"),g=at(c,"dst"),_=rt(g,"A"),f=rt(g,"B"),S=rt(g,"C");s(d,g,[[h,_],[u,f],[m,S]])}),Ie("crossed match case",()=>{let c=_t.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),h=rt(d,"A"),u=rt(d,"B"),m=at(c,"dst"),g=rt(m,"B"),_=rt(m,"A");s(d,m,[[h,_],[u,g]])}),Ie("duplicate names",()=>{let c=_t.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),h=rt(d,"A"),u=rt(d,"A");rt(d,"A");let m=at(c,"dst"),g=rt(m,"A"),_=rt(m,"A");s(d,m,[[h,g],[u,_]])}),Ie("recursive matches",()=>{let c=_t.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),h=at(c,"dst"),u=rt(d,"A"),m=rt(u,"A"),g=rt(u,"B"),_=rt(d,"B");rt(_,"A"),rt(_,"B");let f=rt(d,"C");rt(f,"A"),rt(f,"B");let S=rt(h,"A"),b=rt(S,"A"),T=rt(S,"B"),y=rt(h,"B");rt(y,"C"),rt(y,"D");let I=rt(h,"D");rt(I,"A"),rt(I,"B"),s(d,h,[[u,S],[m,b],[g,T],[_,y]])}),Ie("hidden and transparent nodes",()=>{let c=_t.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),h=rt(d,"A");rt(d,"B");let u=rt(d,"C"),m=rt(d,"D");h.setVisible(!1),u.setOpacity(0);let g=at(c,"dst");rt(g,"A");let _=rt(g,"B"),f=rt(g,"C"),S=rt(g,"D");_.setVisible(!1),m.setOpacity(0),s(d,g,[[u,f],[m,S]])}),Ie("boolean op nodes",()=>{let c=_t.createSceneWithCanvasForTests1().root().childAt1(0),d=at(c,"src"),h=Us(d);h.setName("booleanOp"),rt(h,"A"),rt(h,"B");let u=at(c,"dst"),m=Us(u);m.setName("booleanOp"),rt(m,"A"),rt(m,"B"),s(d,u,[[h,m]])})}),Ie("Smart animate of fixed elements",()=>{let s=new R(100,100),l=new R(10,10),c=new ur,d=_t.createSceneWithCanvasForTests1(),h=d.root().childAt1(0);h.setPrototypeDevice(new jr("CUSTOM",s,null,"NONE")),h.setCurrentViewportSize(s),c.setActiveCanvas(h),c.setScene(d);let u=(f,S)=>{let b=lt(h);b.setSize(new R(f,S)),b.setUsedAsBaseScreen(!0);let T=Tn(b);return T.setSize(new R(10,10)),T.setRelativeTransform(new ee(1,0,0,0,1,S-l.y())),T.setVerticalConstraint("MAX"),T.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),b},m=u(100,200),g=u(100,100);Gs(m,g);let _=Al.buildStrategy(m.childAt1(0),g.childAt1(0));o(_.transition.from().transform1().translation().y(),s.y()-l.y()),o(_.transition.to().transform1().translation().y(),s.y()-l.y())}),Bt("interpolation strategies",()=>{let s=(l,c)=>{let d=Al.buildStrategy(l,c);d.isDissolve};Ie("dissolve discrete properties",()=>{[(c,d)=>{let h=ue(c,"A");h.setBlendMode("NORMAL");let u=ue(d,"A");u.setBlendMode("MULTIPLY"),s(h,u)},(c,d)=>{let h=qA(c,"B"),u=ue(d,"B");s(h,u)},(c,d)=>{let h=sr(c,"C",C.TRANSPARENT);ue(h,"C_content");let u=Ui(d,"C");ue(u,"C_content"),s(h,u)},(c,d)=>{c.setOverflowDirection("VERTICAL"),d.setOverflowDirection("VERTICAL");let h=ue(c,"D");h.setScrollBehavior("SCROLLS");let u=ue(d,"D");u.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),s(h,u)}].forEach(c=>{i([c])})}),Ie("interpolate effects and paints",()=>{let l=te.createLinearGradient([new ot(C.RED,0),new ot(C.TRANSPARENT,.5)]);[(d,h)=>{let u=xu(d,"A",[l]),m=ue(h,"A");s(u,m)},(d,h)=>{let u=ue(d,"B");u.setTestOnlyEffects([]);let m=ue(h,"B");m.setTestOnlyEffects([Oe.createForegroundBlur(1)]),s(u,m)},(d,h)=>{let u=ue(d,"C");u.setTestOnlyEffects([Oe.createForegroundBlur(1)]);let m=ue(h,"C");m.setTestOnlyEffects([Oe.createDropShadow(1,new R(1,1),C.BLACK,1)]),s(u,m)},(d,h)=>{let u=ue(d,"D"),m=[Oe.createForegroundBlur(1),Oe.createDropShadow(1,new R(1,1),C.BLACK,1)];u.setTestOnlyEffects(m);let g=ue(h,"D"),_=m.slice();_[0].setIsEnabled(!1),g.setTestOnlyEffects(_),s(u,g)},(d,h)=>{let u=ue(d,"E"),m=[l,te.createSolid(C.RED,1)];u.setTestOnlyFillPaints(m);let g=ue(h,"E"),_=m.slice();_[0].setIsEnabled(!1),g.setTestOnlyFillPaints(_),s(u,g)}].forEach(d=>{i([d])})}),Ie("interpolate geometry",()=>{let l=(d,h,u)=>{let m=rt(d,h);m.setTestOnlyFillPaints([te.createSolid(C.BLACK,1)]);let g=u.topLeft().x(),_=u.topLeft().y(),f=u.width(),S=u.height(),b=new Fr("NONZERO",0,Pt.new2().moveTo1(g,_).lineTo(g+f,_).lineTo(g+f,_+S).lineTo(g,_+S-1).close(),u),T=new xr([b],null,b.bounds(),null);return m.setTestOnlyFillPaints([te.createSolid(C.RED,1)]),m.setTestOnlyFillGeometry(T),m.setTestOnlyStrokeGeometry(T),Je(m,u.topLeft(),u.size()),m};[(d,h)=>{let u=l(d,"A",new V(0,0,100,100)),m=Ht(h,"A",C.RED,1);s(u,m)}].forEach(d=>{i([d])})})}),Bt("magic move",()=>{let s=(m,g,_)=>{ls(m,()=>{let f=[];return g.forEach(S=>{i([_,(b,T)=>{let y=new ee(1,0,0,0,1,700),I=Nt.FrozenAffineTransform_IDENTITY,p=wo.getMagicMovePlan2(b,y,T,I,Ir.get(S));f.push(a.asyncAssertMatchesSnapshot(`plan ${S}`,p.debugString()));let A=()=>0,v=wn.makeEasingFunction([0,0,1,1],.3),E=new Ci(p,A,v);f.push(a.asyncAssertMatchesSnapshot(`render tree ${S}`,E.renderTree().debugString1()))}])}),Promise.all(f)})},l=["DISSOLVE","SLIDE_FROM_RIGHT","PUSH_FROM_RIGHT","MOVE_FROM_RIGHT","SLIDE_OUT_TO_RIGHT","MOVE_OUT_TO_RIGHT"],c=["DISSOLVE","MOVE_FROM_RIGHT","MOVE_OUT_TO_RIGHT"],d=["DISSOLVE"];s("identical rectangles",d,(m,g)=>{ue(m,"rect"),ue(g,"rect")}),s("rectangles with different opacities",d,(m,g)=>{ue(m,"rect").setOpacity(.9),ue(g,"rect").setOpacity(.1)}),s("rectangles with changing and unchanging paints",d,(m,g)=>{xu(m,"rect",[te.createSolid(C.RED,1),te.createSolid(C.GREEN,1)]),xu(g,"rect",[te.createSolid(C.BLUE,1),te.createSolid(C.GREEN,1)])}),s("rectangles with different translations",d,(m,g)=>{ue(m,"rect").setRelativeTransform(new ee(1,0,30,0,1,50)),ue(g,"rect").setRelativeTransform(new ee(1,0,130,0,1,250))}),s("rectangles with different rotation",d,(m,g)=>{let _=ue(m,"rect");_.setRelativeTransform(new ee(1,0,30,0,1,50));let f=ue(g,"rect"),S=ee.new3(_.relativeTransform());S.rotatedBy(Math.PI/4),f.setRelativeTransform(S)}),s("rectangles with different scale",d,(m,g)=>{let _=ue(m,"rect");_.setRelativeTransform(new ee(1,0,30,0,1,50));let f=ue(g,"rect"),S=ee.new3(_.relativeTransform());S.scaledBy1(new R(2,3)),f.setRelativeTransform(S)}),s("insertion of new rectangle",d,(m,g)=>{ue(g,"rect")}),s("deletion of old rectangle",d,(m,g)=>{ue(m,"rect")}),s("rectangles with mismatched names",d,(m,g)=>{ue(m,"A"),ue(g,"B")}),s("hidden and never-visible rectangles",d,(m,g)=>{let _=ue(m,"hidden"),f=ue(m,"neverVisible");_.setVisible(!1),f.setOpacity(0);let S=ue(g,"hidden"),b=ue(g,"neverVisible");S.setVisible(!1),b.setOpacity(0)}),s("hidden and transparent and no match nodes to visible nodes",d,(m,g)=>{let _=ue(m,"hidden"),f=ue(m,"transparent");_.setVisible(!1),f.setOpacity(0),ue(g,"hidden"),ue(g,"transparent"),ue(g,"noMatch")}),s("visible nodes to hidden and transparent and no match nodes",d,(m,g)=>{ue(m,"hidden"),ue(m,"transparent"),ue(m,"noMatch");let _=ue(g,"hidden"),f=ue(g,"transparent");_.setVisible(!1),f.setOpacity(0)}),s("matching boolean op nodes",d,(m,g)=>{let _=Us(m);_.setName("booleanOp"),rt(_,"A"),rt(_,"B");let f=Us(g);f.setName("booleanOp"),rt(f,"A"),rt(f,"B")}),s("simple matching with layer re-ordering",d,(m,g)=>{ue(m,"A"),ue(m,"B"),ue(g,"B"),ue(g,"A")}),s("simple insertion, deletion, and matching",l,(m,g)=>{ue(m,"A"),ue(m,"B"),ue(g,"C"),ue(g,"B")}),s("complex layer re-ordering with insertions and removals",c,(m,g)=>{ue(m,"A"),ue(m,"B"),ue(m,"C"),ue(m,"D"),ue(m,"E"),ue(m,"F"),ue(m,"G"),ue(m,"H"),ue(g,"1"),ue(g,"2"),ue(g,"F"),ue(g,"3"),ue(g,"4"),ue(g,"C"),ue(g,"5"),ue(g,"6")}),s("complex matching case with no nesting",d,(m,g)=>{ue(m,"A"),ue(m,"B"),ue(m,"C"),ue(m,"E"),ue(g,"X"),ue(g,"Y"),ue(g,"B"),ue(g,"Z"),ue(g,"E"),ue(g,"F")}),s("simple nested matching",d,(m,g)=>{let _=at(m,"F");at(_,"rect");let f=at(g,"F");at(f,"rect").setOpacity(.5)}),s("nested insertions/removals",c,(m,g)=>{let _=at(m,"A");ue(_,"rectA");let f=at(g,"B");ue(f,"rectB")}),s("dissolving between different sized objects",d,(m,g)=>{ue(m,"A").setSize(new R(100,100)),ue(g,"A").setSize(new R(200,200))}),s("dissolving between non-uniformly scaling frames with children",d,(m,g)=>{let _=at(m,"A");_.setSize(new R(150,1)),Ht(_,"rect",C.RED,1).setSize(new R(100,100)),Ht(_,"rect",C.RED,1).setSize(new R(100,100));let b=at(g,"A");b.setSize(new R(300,300)),Ht(b,"rect",C.RED,1).setSize(new R(100,100)),Ht(b,"rect",C.RED,1).setSize(new R(100,100))}),s("dissolving between background blur objects",d,(m,g)=>{let _=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(_),Ht(m,"A",C.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]),Ht(g,"A",C.BLUE,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)])}),s("dissolving between background blur objects with a background blur behind",d,(m,g)=>{let _=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(_),Ht(m,"BG",C.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]),Ht(g,"BG",C.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]),Ht(m,"A",C.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]),Ht(g,"A",C.BLUE,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)])}),s("translating a background blur contained in a frame with clip-content enabled",d,(m,g)=>{let _=Object({viewer_background_blur_opts:!1});X.updateFeatureFlags(_);let f=at(m,"A");f.setIsFrameMaskDisabled(!0);let S=at(f,"B");Ht(S,"BG",C.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]);let T=at(g,"A");T.setIsFrameMaskDisabled(!0);let y=ee.new3(T.relativeTransform());y.translatedBy2(10,10),T.setRelativeTransform(y);let I=at(T,"B");Ht(I,"BG",C.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)])}),s("translating a node with a background blur",d,(m,g)=>{Ht(m,"BG",C.RED,.5).setTestOnlyEffects([Oe.createBackgroundBlur(1)]);let f=Ht(g,"BG",C.RED,.5);f.setTestOnlyEffects([Oe.createBackgroundBlur(1)]);let S=ee.new3(f.relativeTransform());S.translatedBy2(10,10),f.setRelativeTransform(S)}),s("dissolving + scaling between nodes with unmatched children",d,(m,g)=>{let _=sr(m,"F",C.RED);_.setSize(new R(100,100)),ue(_,"rect"),at(g,"F").setSize(new R(200,200))}),s("dissolve only between nodes with unmatched children",d,(m,g)=>{let _=sr(m,"F",C.RED);_.setSize(new R(100,100)),ue(_,"rect"),GA(g,"F").setSize(new R(100,100))}),s("dissolving between visible top frame to invisibile top frame",d,(m,g)=>{let _=new te("SOLID");_.setColor(C.RED),_.setOpacity(1),_.setIsEnabled(!0),m.setTestOnlyFillPaints([_]),_.setOpacity(0),g.setTestOnlyFillPaints([_])}),s("dissolving between different opacity objects",d,(m,g)=>{let _=ue(m,"A");_.setOpacity(1),_.setBlendMode("MULTIPLY");let f=ue(g,"A");f.setOpacity(.5),f.setBlendMode("NORMAL")}),s("dissolving between invisible node to visible node",d,(m,g)=>{Ht(m,"A",C.RED,0),Ht(g,"A",C.BLUE,.5)}),s("interpolating between two solid color paints",d,(m,g)=>{Ht(m,"A",C.RED,1),Ht(g,"A",C.BLUE,1)}),s("drop shadow: node rotates",d,(m,g)=>{let _=ue(m,"rect");_.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),_.setRelativeTransform(new ee(1,0,30,0,1,50));let f=ue(g,"rect");f.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]);let S=ee.new3(_.relativeTransform());S.rotatedBy(Math.PI/4),f.setRelativeTransform(S)}),s("inner shadow: node rotates",d,(m,g)=>{let _=ue(m,"rect");_.setTestOnlyEffects([Oe.createInnerShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),_.setRelativeTransform(new ee(1,0,30,0,1,50));let f=ue(g,"rect");f.setTestOnlyEffects([Oe.createInnerShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]);let S=ee.new3(_.relativeTransform());S.rotatedBy(Math.PI/4),f.setRelativeTransform(S)}),s("drop shadow: group shadow where group rotates and children are static",d,(m,g)=>{let _=sr(m,"F",C.TRANSPARENT);_.setIsBackgroundEnabled(!1),ue(_,"rectA").setRelativeTransform(ee.new2()),ue(_,"rectB").setRelativeTransform(new ee(1,0,50,0,1,0)),_.setRelativeTransform(new ee(1,0,30,0,1,50)),_.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]);let b=sr(g,"F",C.TRANSPARENT);b.setIsBackgroundEnabled(!1),ue(b,"rectA").setRelativeTransform(ee.new2()),ue(b,"rectB").setRelativeTransform(new ee(1,0,50,0,1,0));let I=ee.new3(_.relativeTransform());I.rotatedBy(Math.PI/4),b.setRelativeTransform(I),b.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)])}),s("drop shadow: group shadow where group is static and children rotate",d,(m,g)=>{let _=sr(m,"F",C.TRANSPARENT);_.setIsBackgroundEnabled(!1),ue(_,"rectA").setRelativeTransform(ee.new2()),ue(_,"rectB").setRelativeTransform(new ee(1,0,50,0,1,0)),_.setRelativeTransform(new ee(1,0,30,0,1,50)),_.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]);let b=sr(g,"F",C.TRANSPARENT);b.setIsBackgroundEnabled(!1);let T=ue(b,"rectA");T.setRelativeTransform(ee.new2());let y=ue(b,"rectB");y.setRelativeTransform(new ee(1,0,50,0,1,0));let I=ee.new3(T.relativeTransform());I.rotatedBy(Math.PI/4),T.setRelativeTransform(I);let p=ee.new3(y.relativeTransform());p.rotatedBy(Math.PI/4),y.setRelativeTransform(p),b.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)])}),s("drop shadow: complex group shadow with nested groups and mixed transitions",d,(m,g)=>{let _=sr(m,"staticGroup1",C.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(new ee(1,0,30,0,1,50)),_.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),ue(_,"staticRectZ").setRelativeTransform(ee.new2());let S=sr(_,"rotatingGroup2",C.TRANSPARENT);S.setIsBackgroundEnabled(!1),ue(S,"rotatingRectA").setRelativeTransform(ee.new2()),ue(S,"staticRectB").setRelativeTransform(new ee(1,0,50,0,1,0));let y=sr(g,"staticGroup1",C.TRANSPARENT);y.setIsBackgroundEnabled(!1),y.setRelativeTransform(new ee(1,0,30,0,1,50)),y.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),ue(y,"staticRectZ").setRelativeTransform(ee.new2());let p=sr(y,"rotatingGroup2",C.TRANSPARENT);p.setIsBackgroundEnabled(!1),p.setRelativeTransform(ee.new2().rotatedBy(Math.PI/4)),ue(p,"rotatingRectA").setRelativeTransform(ee.new2().rotatedBy(Math.PI/3)),ue(p,"staticRectB").setRelativeTransform(new ee(1,0,50,0,1,0))}),s("inner shadow: complex group shadow with nested groups and mixed transitions",d,(m,g)=>{let _=sr(m,"staticGroup1",C.TRANSPARENT);_.setIsBackgroundEnabled(!1),_.setRelativeTransform(new ee(1,0,30,0,1,50)),_.setTestOnlyEffects([Oe.createInnerShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),ue(_,"staticRectZ").setRelativeTransform(ee.new2());let S=sr(_,"rotatingGroup2",C.TRANSPARENT);S.setIsBackgroundEnabled(!1),ue(S,"rotatingRectA").setRelativeTransform(ee.new2()),ue(S,"staticRectB").setRelativeTransform(new ee(1,0,50,0,1,0));let y=sr(g,"staticGroup1",C.TRANSPARENT);y.setIsBackgroundEnabled(!1),y.setRelativeTransform(new ee(1,0,30,0,1,50)),y.setTestOnlyEffects([Oe.createInnerShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),ue(y,"staticRectZ").setRelativeTransform(ee.new2());let p=sr(y,"rotatingGroup2",C.TRANSPARENT);p.setIsBackgroundEnabled(!1),p.setRelativeTransform(ee.new2().rotatedBy(Math.PI/4)),ue(p,"rotatingRectA").setRelativeTransform(ee.new2().rotatedBy(Math.PI/3)),ue(p,"staticRectB").setRelativeTransform(new ee(1,0,50,0,1,0))}),s("drop shadow: no node change but parent rotates",d,(m,g)=>{let _=Object({static_render_tree_animations:!1});X.updateFeatureFlags(_);let f=at(m,"F");ue(f,"rect").setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),f.setRelativeTransform(new ee(1,0,30,0,1,50));let b=ue(g,"F");ue(b,"rect").setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]);let y=ee.new3(f.relativeTransform());y.rotatedBy(Math.PI/4),b.setRelativeTransform(y)}),s("drop shadow: no node change but parent translates/resizes",d,(m,g)=>{let _=at(m,"F");ue(_,"rect").setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),_.setRelativeTransform(new ee(1,0,30,0,1,50)),_.setSize(new R(100,100));let S=at(g,"F");ue(S,"rect").setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]);let T=ee.new3(_.relativeTransform());T.translate1(ye.FrozenVector_new4(1,1)),S.setRelativeTransform(T),S.setSize(new R(100,200))}),s("transition between scrolling frames",c,(m,g)=>{m.setOverflowDirection("VERTICAL"),m.setTestOnlyFillPaints([te.createSolid(C.RED,1)]),m.setTestOnlyEffects([Oe.createDropShadow(1,new R(1,1),C.BLACK,1)]),g.setTestOnlyFillPaints([te.createSolid(C.BLUE,1)]),g.setTestOnlyEffects([Oe.createDropShadow(1,new R(1,1),C.BLACK,1)]);let _=Ht(m,"rect",C.GREEN,1);_.setSize(new R(m.size().x(),m.size().y()+100)),Ht(g,"rect",C.GREEN,1).setSize(_.size())}),s("scaling nodes whose children have different scaling factors",d,(m,g)=>{let _=at(m,"subframe");_.setSize(new R(100,100)),ue(_,"rect").setSize(new R(50,50));let S=at(g,"subframe");S.setSize(new R(200,200)),ue(S,"rect").setSize(new R(50,50))}),s("deeply nested scaling nodes whose children have different scaling factors",d,(m,g)=>{let _=at(m,"A");_.setSize(new R(100,100));let f=sr(_,"B",C.RED);f.setSize(new R(50,50)),sr(f,"C",C.BLACK).setSize(new R(10,10));let b=at(g,"A");b.setSize(new R(200,200));let T=ue(b,"B");T.setSize(new R(50,50)),sr(T,"C",C.BLACK).setSize(new R(10,10))}),s("transition between two screens with masks",d,(m,g)=>{let _=ue(m,"mask");_.setSize(new R(50,50)),_.setIsMask(!0),ue(m,"color").setSize(new R(100,100)),rt(g,"andrew");let S=ue(g,"mask");S.setRelativeTransform(new ee(1,0,10,0,1,10)),S.setSize(new R(50,50)),S.setIsMask(!0),ue(g,"color").setSize(new R(100,100))}),s("MOVE_IN with unmatched layers nested inside of matched layers",["MOVE_FROM_RIGHT"],(m,g)=>{let _=at(m,"A");Ht(_,"A_1",C.BLUE,1);let f=at(g,"A");Ht(f,"A_2",C.GREEN,1)}),s("MOVE_IN with unmatched layers nested inside of matched fixed layers",["MOVE_FROM_RIGHT"],(m,g)=>{let _=at(m,"A");_.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),Ht(_,"A_1",C.BLUE,1);let f=at(g,"A");Ht(f,"A_2",C.GREEN,1)}),s("dissolving image fills with different geometries should separate into masks",d,(m,g)=>{ym(m,"tri",new R(100,100)),ym(g,"tri",new R(50,100))}),s("dissolving non-image fills with different geometries should NOT separate into masks",d,(m,g)=>{Tm(m,"rect",C.RED,1,new R(100,100)),Tm(g,"rect",C.GREEN,1,new R(50,100))}),ls("non-image rects with different geometries interpolate rounded rectangle parameters",()=>{let m=[];return d.forEach(g=>{i([(_,f)=>{vn(_,"rect",C.RED,1,new R(100,100)),vn(f,"rect",C.GREEN,1,new R(50,100));let S=new ee(1,0,0,0,1,1100-400),b=Nt.FrozenAffineTransform_IDENTITY,T=wo.getMagicMovePlan2(_,S,f,b,Ir.get(g));m.push(a.asyncAssertMatchesSnapshot(`plan ${g}`,T.debugString()));let y=()=>0,I=wn.makeEasingFunction([0,0,1,1],.3),p=new Ci(T,y,I);m.push(a.asyncAssertMatchesSnapshot(`render tree ${g}`,p.renderTree().debugString1()))}])}),Promise.all(m)}),ls("non-image rects with different geometries and different effect spreads interpolate rounded rectangle + effect parameters",()=>{let m=[];return d.forEach(g=>{i([(_,f)=>{vn(_,"rect",C.RED,1,new R(100,100)).setTestOnlyEffects([Oe.createDropShadow(1,new R(5,5),C.BLACK,.5,10)]),vn(f,"rect",C.GREEN,1,new R(50,100)).setTestOnlyEffects([Oe.createDropShadow(1,new R(5,5),C.BLACK,.5,10)]);let T=new ee(1,0,0,0,1,1100-400),y=Nt.FrozenAffineTransform_IDENTITY,I=wo.getMagicMovePlan2(_,T,f,y,Ir.get(g));m.push(a.asyncAssertMatchesSnapshot(`plan ${g}`,I.debugString()));let p=()=>0,A=wn.makeEasingFunction([0,0,1,1],.3),v=new Ci(I,p,A);m.push(a.asyncAssertMatchesSnapshot(`render tree ${g}`,v.renderTree().debugString1()))}])}),Promise.all(m)}),s("dissolving image rects with different geometries: render good-enough identical shadows for now",d,(m,g)=>{let _=[Oe.createDropShadow(1,new R(5,5),C.BLACK,.5)];mc(m,"rect",new R(100,100)).setTestOnlyEffects(_),mc(g,"rect",new R(50,100)).setTestOnlyEffects(_)}),s("dissolving image rects with different geometries: non-identical shadows fall back to dissolve for now",d,(m,g)=>{mc(m,"rect",new R(100,100)).setTestOnlyEffects([Oe.createDropShadow(1,new R(5,5),C.BLACK,.5)]),mc(g,"rect",new R(50,100)).setTestOnlyEffects([Oe.createDropShadow(5,new R(5,5),C.BLACK,.5)])}),s("groups with drop shadows and moving children",d,(m,g)=>{let _=Ui(m,"G");vn(_,"A",C.RED,1,new R(10,10)),vn(_,"B",C.GREEN,1,new R(10,10)),_.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]);let f=Ui(g,"G");f.setTestOnlyEffects([Oe.createDropShadow(1,ye.FrozenVector_new4(1,1),C.BLACK,.5)]),vn(f,"A",C.RED,1,new R(10,10)).setRelativeTransform(new ee(1,0,20,0,1,30)),vn(f,"B",C.GREEN,1,new R(10,10)).setRelativeTransform(new ee(1,0,50,0,1,100))});let h=(m,g)=>{let _=Ui(m,"G");vn(_,"A",C.RED,1,new R(10,10)).setRelativeTransform(new ee(1,0,0,0,1,0)),vn(_,"B",C.GREEN,1,new R(10,10)).setRelativeTransform(new ee(1,0,10,0,1,30)),_.setSize(new R(20,40));let b=Ui(g,"G");vn(b,"A",C.RED,1,new R(10,10)).setRelativeTransform(new ee(1,0,0,0,1,0)),vn(b,"B",C.GREEN,1,new R(10,10)).setRelativeTransform(new ee(1,0,20,0,1,30)),b.setSize(new R(30,40))};s("resizing resize-to-fit-groups without background paints",d,(m,g)=>{X.updateFeatureFlags({deprecate_cSFSAC:!1,lazify_more_defaults:!1}),h(m,g)}),s("resizing resize-to-fit-groups without background paints with NodeField::CONTAINER_SUPPORTS_FILL_STROKE_AND_CORNERS deprecated",d,(m,g)=>{X.updateFeatureFlags({deprecate_cSFSAC:!0}),h(m,g)});let u=(m,g)=>{let _=[te.createSolid(C.RED,1)],f=Ui(m,"G");f.setTestOnlyFillPaints(_),vn(f,"A",C.RED,1,new R(10,10)).setRelativeTransform(new ee(1,0,0,0,1,0)),vn(f,"B",C.GREEN,1,new R(10,10)).setRelativeTransform(new ee(1,0,10,0,1,30)),f.setSize(new R(20,40));let T=Ui(g,"G");T.setTestOnlyFillPaints(_),vn(T,"A",C.RED,1,new R(10,10)).setRelativeTransform(new ee(1,0,0,0,1,0)),vn(T,"B",C.GREEN,1,new R(10,10)).setRelativeTransform(new ee(1,0,20,0,1,30)),T.setSize(new R(30,40))};s("resizing resize-to-fit-groups with background paints",d,(m,g)=>{X.updateFeatureFlags({deprecate_cSFSAC:!1,lazify_more_defaults:!1}),u(m,g)}),s("resizing resize-to-fit-groups with background paints with NodeField::CONTAINER_SUPPORTS_FILL_STROKE_AND_CORNERS deprecated",d,(m,g)=>{X.updateFeatureFlags({deprecate_cSFSAC:!0}),u(m,g)}),s("transition between symbols with new frame properties",d,(m,g)=>{m.setType("SYMBOL"),m.setContainerSupportsFillStrokeAndCorners(!0),m.setTestOnlyFillPaints(m.fillPaints()),g.setType("SYMBOL"),g.setContainerSupportsFillStrokeAndCorners(!0),g.setTestOnlyFillPaints([te.createSolid(C.RED,1)])}),s("Smart animate frames with reverse z-index",["SMART_ANIMATE"],(m,g)=>{let _=f=>{f.setStackReverseZIndex(!0),f.setStackMode("HORIZONTAL");let S=Ht(f,"A",C.RED,.5);S.setSize(new R(20,20)),S.setRelativeTransform(new ee(1,0,0,0,1,0));let b=Ht(f,"B",C.BLUE,.5);b.setSize(new R(20,20)),b.setRelativeTransform(new ee(1,0,10,0,1,0))};_(m),_(g)})})}n.testMagicMove=t;function r(){let o=AssertLib.deepEqual;beforeEach(()=>{X.setViewerMode(X.ViewerMode.PROTOTYPE)}),Bt("Drag vector computation:",()=>{Ie("Smart animate drag - matched object with translation",()=>{e([(a,s,l,c)=>{let d=ue(l,"rect");d.setRelativeTransform(new ee(1,0,30,0,1,50)),ue(c,"rect").setRelativeTransform(new ee(1,0,130,0,1,250));let u=Pr(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),m=pr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());o(m,new R(100,200))}])}),Ie("Smart animate drag - matched object with translation, rotation, and resizing",()=>{e([(a,s,l,c)=>{let d=ue(l,"rect");d.setSize(new R(100,100)),d.setRelativeTransform(ee.new2().translatedBy1(d.size().negative().divide(2)));let h=ue(c,"rect");h.setSize(new R(200,100));let u=ee.new2().translatedBy1(h.size().negative().divide(2));u.postRotate(Math.PI/2),u.postTranslate(new R(100,200)),h.setRelativeTransform(u);let m=Pr(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),g=pr.computeDragVector1(d,m,l,a.prototypeStructure(),a.prototypeState());o(g,new R(100,200))}])}),Ie("Smart animate drag - no matches",()=>{e([(a,s,l,c)=>{let d=ue(l,"rect");d.setRelativeTransform(new ee(1,0,30,0,1,50));let h=Pr(d,c,"DRAG","SMART_ANIMATE","NAVIGATE"),u=pr.computeDragVector1(d,h,l,a.prototypeStructure(),a.prototypeState());o(u,null)}])}),Ie("Smart animate drag - overlay swap with matched object with translation",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),h=at(d,"overlayA"),u=at(d,"overlayB"),m=ue(h,"rect");m.setRelativeTransform(new ee(1,0,30,0,1,50)),ue(u,"rect").setRelativeTransform(new ee(1,0,130,0,1,250));let _=Pr(m,u,"DRAG","SMART_ANIMATE","SWAP");Pr(l,h,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let f=pr.computeDragVector1(m,_,l,a.prototypeStructure(),a.prototypeState());o(f,new R(100,200))}])}),Ie("Smart animate drag - overlay swap with no matches",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),h=at(d,"overlayA"),u=at(d,"overlayB"),m=ue(h,"rect");m.setRelativeTransform(new ee(1,0,30,0,1,50));let g=Pr(m,u,"DRAG","SMART_ANIMATE","SWAP");Pr(l,h,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let _=pr.computeDragVector1(m,g,l,a.prototypeStructure(),a.prototypeState());o(_,null)}])}),Ie("Move in smart animate drag - matched object with translation",()=>{e([(a,s,l,c)=>{let d=ue(l,"rect");d.setRelativeTransform(new ee(1,0,30,0,1,50)),ue(c,"rect").setRelativeTransform(new ee(1,0,130,0,1,250));let u=Nu(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),m=pr.computeDragVector1(d,u,l,a.prototypeStructure(),a.prototypeState());o(m,new R(100,200))}])}),Ie("Move in smart animate drag - no matches",()=>{e([(a,s,l,c)=>{let d=ue(l,"rect");d.setRelativeTransform(new ee(1,0,30,0,1,50));let h=Nu(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),u=Ir.get("MOVE_FROM_LEFT").enteringFrameTransition(),m=c.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),g=pr.computeDragVector1(d,h,l,a.prototypeStructure(),a.prototypeState());o(g,m)}])}),Ie("Screen swipe drag - nested node move in transition",()=>{e([(a,s,l,c)=>{let d=ue(l,"rect");d.setRelativeTransform(new ee(1,0,30,0,1,50));let h=Pr(d,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),u=Ir.get("MOVE_FROM_LEFT").enteringFrameTransition(),m=c.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),g=pr.computeDragVector1(d,h,l,a.prototypeStructure(),a.prototypeState());o(g,m)}])}),Ie("Screen swipe drag - nested node move out transition",()=>{e([(a,s,l,c)=>{let d=ue(l,"rect");d.setRelativeTransform(new ee(1,0,30,0,1,50));let h=Pr(d,c,"DRAG","MOVE_OUT_TO_LEFT","NAVIGATE"),u=Ir.get("MOVE_OUT_TO_LEFT").exitingFrameTransition(),m=l.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),g=pr.computeDragVector1(d,h,l,a.prototypeStructure(),a.prototypeState());o(g,m)}])}),Ie("Screen swipe drag - TLF move in transition",()=>{e([(a,s,l,c)=>{let d=Pr(l,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),h=Ir.get("MOVE_FROM_LEFT").enteringFrameTransition(),u=c.size().multiply1(h.to().translation1().subtract1(h.from().translation1())),m=pr.computeDragVector1(l,d,l,a.prototypeStructure(),a.prototypeState());o(m,u)}])}),Ie("Back screen swipe drag - TLF was opened by move in",()=>{e([(a,s,l,c)=>{Pr(l,c,"ON_CLICK","MOVE_FROM_LEFT","NAVIGATE"),Ou(c),wu(c,"DRAG");let d=l.prototypeInteractions()[0],h=d.action().value;a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().navigateToFrameAndCloseOverlays(h.transitionNodeID(),a.baseScreenNode(),1,0,4,d,h),a.prototypeState().commitStateChange();let u=Ir.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),m=c.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),g=c.prototypeInteractions()[0],_=pr.computeDragVector1(c,g,c,a.prototypeStructure(),a.prototypeState());o(_,m)}])}),Ie("Overlay swipe drag - overlay move in transition",()=>{e([(a,s,l,c)=>{Pr(l,c,"DRAG","MOVE_FROM_LEFT","OVERLAY"),c.setSize(new R(250,250)),c.setOverlayPositionType("TOP_LEFT");let d=pr.computeDragVector1(l,l.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(d,new R(c.size().x(),0))}])}),Ie("Overlay swipe drag - overlay move in transition with nested source",()=>{e([(a,s,l,c)=>{let d=ue(l,"rect"),h=Pr(d,c,"DRAG","MOVE_FROM_LEFT","OVERLAY");c.setSize(new R(250,250)),c.setOverlayPositionType("TOP_LEFT");let u=pr.computeDragVector1(d,h,l,a.prototypeStructure(),a.prototypeState());o(u,new R(c.size().x(),0))}])}),Ie("Close overlay swipe drag - overlay opened by move in",()=>{e([(a,s,l,c)=>{let d=s.root().childAt1(0),h=at(d,"overlayA");h.setSize(new R(250,250)),h.setOverlayPositionType("TOP_LEFT");let u=ue(h,"rect");u.setRelativeTransform(new ee(1,0,30,0,1,50)),Pr(l,h,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY"),bm(u),wu(u,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(h.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let m=Ir.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),g=h.size().multiply1(m.to().translation1().subtract1(m.from().translation1())),_=pr.computeDragVector1(u,u.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(_,g)}])}),Ie("Overlay go back swipe drag - no back frame",()=>{e([(a,s,l,c)=>{c.setSize(new R(250,250)),c.setOverlayPositionType("TOP_LEFT"),Pr(l,c,"DRAG","MOVE_FROM_LEFT","OVERLAY"),Ou(c),wu(c,"DRAG"),a.scene().setAllTlfsLoaded(),a.prototypeState().navigateToFrameAndCloseOverlays(l.id()),a.prototypeState().commitStateChange(),a.prototypeState().overlayFrame(c.id(),l,0,0,l.prototypeInteractions()[0],null),a.prototypeState().commitStateChange();let d=pr.computeDragVector1(c,c.prototypeInteractions()[0],l,a.prototypeStructure(),a.prototypeState());o(d,null)}])}),Ie("Drag - invalid navigate transition",()=>{e([(a,s,l,c)=>{Pr(l,c,"DRAG","DISSOLVE","NAVIGATE");let d=pr.computeDragVector1(l,null,l,a.prototypeStructure(),a.prototypeState());o(d,null)}])})}),Bt("Drag progress measurement:",()=>{let a=null;beforeEach(()=>{a=new Ts,We.dangerouslyPushMockTime(a)}),afterEach(()=>{We.popMockTime()}),Ie("Simple drag velocity and progress measurement",()=>{e([(s,l,c,d)=>{let u=AssertLib,m=(v,E,D)=>u(Math.abs(D-E)<=1e-14,`Expected velocity at timestep ${v} to equal ${E}, got ${D}`);s.prototypeState().setIsDragging(!0);let g=new pr(null,new R(1,0),null,null);g.handleDragStart(new R(0,0)),g.handleDrag(new R(0,0));let _=g.onTickProgress();o(_,0),a.advanceSeconds(1),g.handleDrag(new R(.5,0));let f=g.onTickProgress();o(f,.5);let S=g.signedDragSpeed();m(1,.5,S),a.advanceSeconds(.5),g.handleDrag(new R(1,0));let b=g.onTickProgress();o(b,1);let T=g.signedDragSpeed();m(2,1,T),a.advanceSeconds(1);let y=g.onTickProgress();o(y,1);let I=g.signedDragSpeed();m(3,0,I),a.advanceSeconds(.1),g.handleDrag(new R(.5,0));let p=g.onTickProgress();o(p,.5);let A=g.signedDragSpeed();m(4,-5,A)}])}),Ie("Different-direction drag velocity and progress measurement",()=>{e([(s,l,c,d)=>{let u=AssertLib,m=(p,A,v)=>u(Math.abs(v-A)<=1e-14,`Expected velocity at timestep ${p} to equal ${A}, got ${v}`);s.prototypeState().setIsDragging(!0);let g=new pr(null,new R(1,0),null,null);g.handleDragStart(new R(0,0)),g.handleDrag(new R(0,0));let _=g.onTickProgress();o(_,0),a.advanceSeconds(1),g.handleDrag(new R(0,.5));let f=g.onTickProgress();o(f,0);let S=g.signedDragSpeed();m(1,0,S),a.advanceSeconds(1),g.handleDrag(new R(-.5,0));let b=g.onTickProgress();o(b,0);let T=g.signedDragSpeed();m(2,-.5,T),a.advanceSeconds(1),g.handleDrag(new R(.5,1));let y=g.onTickProgress();o(y,.5);let I=g.signedDragSpeed();m(3,1,I)}])})})}n.testDragToAnimateBehavior=r})(Zg||(Zg={}));var th=class{constructor(e){this._session=null,this._preservers=[],this._isReconnecting=!1,this._session=e,this._session.addObserver(this),this._preservers.push(new $g),this._preservers.push(new jg)}handleSceneChangedLoadingPhase(e,t){t==1?this.handleSceneWillRebuildAfterReconnect():e==1&&t==2&&this.handleSceneDidRebuildAfterReconnect()}handleSceneWillRebuildAfterReconnect(){if(this._session.scene()==null){Le("Scene unexpectedly null in handleSceneWillRebuildAfterReconnect");return}this._isReconnecting=!0,this._preservers.forEach(e=>{e.reset()}),this._session.scene().each(e=>{this._preservers.forEach(t=>{t.saveDataFromOldSceneNode(e)})})}handleSceneDidRebuildAfterReconnect(){this._isReconnecting=!1,this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())}),this._preservers.forEach(e=>{e.reset()})}handleConnect(e,t){}handleDisconnect(){}handleJoinStart(e,t,r){}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){this._isReconnecting&&this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())})}handleSceneGraphReply(e,t){}},jg=class{constructor(){this._nodeDeveloperFriendlyIdToScrollOffset=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdToScrollOffset=new Map}saveDataFromOldSceneNode(e){e.scrollDirection()!="NONE"&&!e.scrollOffset().equals(ye.FrozenVector_ZERO)&&this._nodeDeveloperFriendlyIdToScrollOffset.set(e.developerFriendlyId(),e.scrollOffset())}restoreDataToNewScene(e){He.StringMap_each(this._nodeDeveloperFriendlyIdToScrollOffset,(t,r)=>{let n=e.findNodeFromDeveloperFriendlyId(t);n!=null&&n.setScrollOffset(r)})}},$g=class{constructor(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=new ln}saveDataFromOldSceneNode(e){e.usedAsBaseScreen()&&this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.add(e.developerFriendlyId())}restoreDataToNewScene(e){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.each(t=>{let r=e.findNodeFromDeveloperFriendlyId(t);r!=null&&r.setUsedAsBaseScreen(!0)})}};var rh=class{constructor(e){this._scene=null,this.onChange=null,this._scene=e.scene(),e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._scene=t}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.node.type()=="CANVAS"||e.node.type()=="DOCUMENT")&&this.onChange(this.pages())}pages(){let e=[];if(this._scene!=null&&this._scene.root()!=null)for(let t=0;t<this._scene.root().childCount();t=t+1){let r=this._scene.root().childAt1(t);r.type()=="CANVAS"&&!r.isInternalOnly()&&e.push({id:r.id(),name:r.name()})}return e}};var tf;(n=>{function i(){return n._instance}n.instance=i;function e(o,a){n._instance=new t(o,a)}n.create=e;class t extends yp{constructor(s,l){super(c=>{this._emitter.trigger("topLevelFrameChange",null)});this._dirtyNodes=null,this._emitter=null,this._scene=null,s.addFrameObserver(this),s.addAppObserver(this),s.prototypeState().addObserver(this),this._emitter=l,this._clearDirtySet()}_clearDirtySet(){this._dirtyNodes=new ko(s=>s)}handleSceneGraphEvent(s){switch(s.property){case 62:case 25:case 24:case 87:case 49:case 78:case 4:case 19:case 8:{this._dirtyNodes.add(s.node.id());break}}}handleSceneChange(s,l){s!=null&&s.removeObserver(this),l!=null&&l.addObserver(this)}handleActiveCanvasChange(s,l){}handleActivePrototypeStartingPointChange(s,l){}onFrame(){this._dirtyNodes.each(s=>{this._emitter.trigger("accessibilityNodeInvalidated",s)}),this._clearDirtySet()}}n._AccessibilityObserver=t,n._instance=null})(tf||(tf={}));function ef(i){return{x:i.x(),y:i.y(),width:i.width(),height:i.height()}}function ey(i){let e=i.state().getActiveCanvas();if(e==null)return null;let t=e.backgroundColor();return t==C.TRANSPARENT?null:C.asFloattoJSON(t)}function ty(i){if(i.state().scene()==null)return null;let t=i.state().getActiveCanvas();if(t==null)return null;let r=X.prototypeBackgroundColorOverride!=null?X.prototypeBackgroundColorOverride.value:t.prototypeBackgroundColor();return r==C.TRANSPARENT?null:C.asInttoJSON(r)}function CC(i){let e=[];for(let t of i)e.push(J.fromString(t));return e}function RC(i){return{trigger:i.event().interactionType(),to:i.action().value.connectionType(),type:i.action().value.navigationType()}}function ny(i){return t=>{let r=t.subtract1(i.canvasView().absoluteBounds().topLeft()),n=i.canvasView().canvasSpaceToWindowSpace().clone();return n.invert()?(n.transformPoint(r),r):null}}function oy(i,e){e.window().setAfterNotify(t=>{let r=Il.serialize(t,i);r!==null&&$t.getEventEmitter().trigger("recordInteraction",r)})}function NC(i){let e=ny(i);oy(e,i)}async function OC(i){Li.detect(),cr.initialize(i),_r.initialize(),Rn.initialize(),X.initialize(i),kA(i.kiwiSchema),yl.initialize(i.statsigConfigCallback,i.statsigConfigWithoutExposureLoggingCallback),X.getFeatureFlags().rendering_statsig_evaluation&&ms.initializeStatsigConfigsWithoutExposureLogging();let e=new vl(cr.getContainerElement(),X.gameControllerListener(),new kp,0),t=e.multiplayerSession(),r=e.multiplayerCoupler(),n=$t.getEventEmitter();new th(t);let o=new id(e.state()),a=new rh(e.state()),s={requestedEmbedAPIOrigin:null};s={requestedEmbedAPIOrigin:new URLSearchParams(window.location.search).get("embed_origin")||null},Ra.init(e.state(),e.canvasView(),s);let d=null;X.getViewerMode()==X.ViewerMode.MIRROR&&(d=new ad(e,t)),n.on("documentSyncingMessage",p=>{De.trackEventJSON1("Viewer Document Syncing Message",{...p,hasPendingMirrorSelectionChange:(d==null?void 0:d.hasPendingSelectionChange())??!1,hasPendingPrototypeStateChange:e.state().prototypeState().hasRequestedStateChange()})});let h=i.deviceName;if(typeof h=="string"){if(["viewer","prototype","editor"].indexOf(h)==-1)throw new Error(`Invalid device name ${h}`);t.setRole(h)}n.on("sceneDidCompleteInitialLoad",p=>{let A=v=>{window.figmaPerfTesting&&window.postMessage({name:v,value:0},"*")};A("DOCUMENT_IS_LOADED"),window.DebuggingHelpers&&(window.DebuggingHelpers.documentIsLoaded=!0),e.canvasView().afterFrame=()=>{e.canvasView().afterFrame=null,A("AFTER_FIRST_RENDER"),n.trigger("documentIsLoaded")},e.canvasView().afterFirstRenderOfScreenStack=()=>{e.canvasView().afterFirstRenderOfScreenStack=null,A("AFTER_FIRST_RENDER_OF_TLF")}});let u=0,m=i.interactionTestState;if(typeof m!="string"||m==="NONE")u=0;else if(m==="RECORD")u=1;else if(m==="PLAYBACK")u=2,Wf();else throw new Error(`Invalid interactionTestState ${m}`);let g=null,_=null,f=null,S=null;u!=0&&(g=p=>{let A=p.clone();return e.canvasView().canvasSpaceToWindowSpace().transformPoint(A),A.add1(e.canvasView().absoluteBounds().topLeft())},_=ny(e),f=p=>e.window().root().viewFromPoint(p),S=()=>e.window().focusedView()),u==1&&oy(_,e),e.state().addActionObserver(new $t.ActionHandler);let b=new $t.AppHandler(e.state());e.state().addFrameObserver(b),tf.create(e.state(),n),Hr.addUpdate(Yt.windowFrame(e.window().events()),p=>{t.maybeFlushNextUserChange(0)}),e.canvasView().onBaseScreenIdChanged=(p,A,v,E)=>{p!=null&&n.trigger("baseScreenChanged",{nodeId:p,userInitiated:A==1,updateURL:v,repairsInvalidState:E})},e.canvasView().disengageObservationMode=()=>{n.trigger("disengageObservationMode")},e.canvasView().viewportTracker().onChange=(p,A)=>{n.trigger("viewportChanged",{offset:{x:p.x(),y:p.y()},zoomScale:A})},e.canvasView().onResize=()=>{n.trigger("canvasResize")},e.canvasView().onURLClicked=(p,A)=>{n.trigger("urlClicked",{url:p,openInNewWindow:A})},e.canvasView().onNavigateToPrototype=(p,A)=>{n.trigger("navigateToPrototype",{fileKey:p,guid:A})},Un.instance().startLibLoad=()=>{n.trigger("loadVideoJsLib",{})},a.onChange=p=>{n.trigger("pagesChange",p)},o.notifyCommentPositionsChange=()=>{n.trigger("watchedNodeBoundsChange")},new cs(e.state(),64,p=>{n.trigger("backgroundColorChange",ey(e))}),new cs(e.state(),65,p=>{n.trigger("prototypeBackgroundColorChange",ty(e))}),new cs(e.state(),66,p=>{n.trigger("prototypeDeviceChanged",p!=null?p.toJSON():null)});let T=[],y={appState:()=>e.state(),multiplayer:()=>t,prototypeState:()=>e.state().prototypeState(),logAndGetDocument:()=>{var A;let p=(A=e.state().scene())==null?void 0:A.root();return p!=null?console.log(p.debugString()):console.log("Document root not found \u{1F630}"),p},logAndGetBaseScreen:()=>{let p=e.state().baseScreenNode();return p!=null?console.log(p.debugString()):console.log("Base screen not found \u{1F630}"),p},logAndGetNode:p=>{var v;let A=(v=e.state().scene())==null?void 0:v.findNode(p);return A!=null?console.log(A.debugString()):console.log(`Node with id ${p??"null"} not found!`),A},logAndGetNodeByStablePath:p=>{var v;let A=(v=e.state().scene())==null?void 0:v.findNodeByStablePath(yt.fromString(p));return A!=null?console.log(A.debugString()):console.log(`Node with stablePath ${p??"null"} not found!`),A},logAndGetRenderTree:p=>{var v,E;let A=(v=e.state().scene())==null?void 0:v.findNode(p);return A!=null?console.log(((E=A.renderTree1())==null?void 0:E.debugString1())??"null"):console.log(`Node with id ${p??"null"} not found!`),A.renderTree1()},logFakeError:p=>{zf(p)},setDebugUserChanges:p=>{Ni.debugUserChanges=p},fulfilledMultiplayerQueries:()=>t.fulfilledMultiplayerQueries(),ICSemanticStorageTrie:()=>{console.log(e.state().prototypeState().componentStateSyncer.debugString())},VideoSemanticStorageTrie:()=>{console.log(e.state().videoManager().runtimeStorage().toString1())}};X.getFeatureFlags().internal_only_debug_tools&&(window.DebuggingHelpers=y);let I={setObservingSessionID:p=>{if(!As(p))throw new Error("Missing sessionID");let A=p|0;A!=t.observingSessionID()&&(t.setObservingSessionID(A),r.setPreviewToObservedFrameOrOverlay(!1),r.performVariableActions(!0),r.performVideoStateChanges(!0),n.trigger("multiplayerUserInfoChange",r.userInfoJSON()),e.canvasView().viewport().invalidate())},nominatePresenter:p=>{if(!As(p))throw new Error("Missing sessionID");t.nominatePresenter(p|0)},cancelPresenterNomination:p=>{if(!As(p))throw new Error("Missing sessionID");t.cancelPresenterNomination(p|0)},startPresenting:()=>{t.startPresenting()},stopPresenting:()=>{t.stopPresenting()},setInteractiveSlideConfigData:(p,A,v)=>{t.setInteractiveSlideConfigData(p,A,v)},setInteractiveSlideParticipantData:(p,A,v)=>{t.setInteractiveSlideParticipantData(p,A,v)},adjustZoom:(p,A)=>{e.canvasView().viewport().adjustCameraZoom2(1,p,A)},setZoom:(p,A)=>{e.canvasView().viewport().setCameraZoom(1,p)},zoomToNode:(p,A)=>{var E;let v=(E=e.state().scene())==null?void 0:E.findNode(J.fromString(p));v!=null&&(e.state().setActiveCanvas(v.canvas()),e.canvasView().viewport().zoomToFit1(1,v.canvasSpaceBoundingBox(),A))},getZoomBounds:()=>({min:qo.ZOOM_MIN,max:qo.ZOOM_MAX}),setCanvasSpaceCenter:(p,A)=>{let v=new R(-1*p.x,-1*p.y);e.canvasView().viewport().setCameraOffset2(1,v,A)},setCanvasSpaceCenterWithScroll:p=>{var M;let A=new R(p.x,p.y),v=(M=e.state().baseScreenNode())==null?void 0:M.canvasSpaceBoundingBox();if(v==null)return;let E=Math.max(A.x()-v.x(),0),D=Math.max(A.y()-v.y(),0),G=Math.max(E-v.width()/2,0),U=Math.max(D-v.height()/2,0);if(E!=0||D!=0){let z=new R(G,U);e.canvasView().updateScrollOffsetForNode(e.state().prototypeState().getTopmostScreen(),z)}},setScrollPadding:p=>{e.canvasView().setScrollPadding(+p.left,+p.top,+p.right,+p.bottom)},setScrollToPan:p=>{X.setScrollToPan(p)},setDragToPan:p=>{X.setDragToPan(p)},injectVideoJsLib:p=>{Un.instance().onLoadComplete(p)},connectTo:(p,A)=>{let v={prototypeApp:_n.instance,skewKiwiSerialization:bd(),deprecatedJsSceneHooks:_n.instance};A(v).then(E=>{let D=E.cppModules;e.state().setFontListPromise(E.fontListPromise),X.getFeatureFlags().internal_only_debug_tools&&(y.fullscreen=D==null?void 0:D.sharedDebuggingHelpers,window.DebuggingHelpers=y);let G=p.fileKey,U=J.fromString(p.nodeId);J.isRoot(U)&&(U=null),X.getViewerMode()==X.ViewerMode.MIRROR&&d!=null?d.connectToFileAndShowNode(G,U,J.fromString(p.startingPointNodeId),p.oauthToken,!!p.renderDots,D):e.connectTo(G,U,J.fromString(p.startingPointNodeId),p.oauthToken,!!p.renderDots,D)})},openFileKey:()=>t.fileKey()??e.state().currentFileKey(),isConnected:()=>t.isConnected(),hasActiveScene:()=>e.state().scene()!=null,unloadSceneForTesting:()=>{t.disconnect(),e.state().prototypeState().resetPrototype(),e.state().setScene(null)},disconnectForTesting:()=>{t.disconnect()},reconnectForTesting:()=>{t.attemptReconnect()},enforceValidPrototypeStateForTesting:()=>{e.state().prototypeState().enforceValidPrototypeStateForTesting()},deleteNodeForTesting:p=>{let A=e.state().scene();if(A==null)throw new Error("No current scene");A.removeNode(J.fromString(p))},translateNodeForTesting:(p,A,v)=>{let E=e.state().scene();if(E==null)throw new Error("No current scene");let D=E.findNode(p);if(D==null)throw new Error("Node not found");let G=D.relativeTransform().clone();G.translate2(A,v),D.setRelativeTransform(G)},addCanvasViewObserverForTesting:(p,A)=>{let v=new Yp((E,D,G,U)=>{p()},E=>{A(E.scrollOffset().x(),E.scrollOffset().y())});T.push(v),e.canvasView().addObserver(v)},clearCanvasViewObserversForTesting:()=>{for(let p of T)e.canvasView().removeObserver(p);T=[]},sendMultiplayerNodeChangesForTesting:p=>{let A=e.state().scene();if(A==null)throw new Error("No current scene");let v=ke().encodeMessage(p);A.applyMessageToScene(v)},setMockEmbedListener:p=>{Ra.setMockListener(p)},setMaximumDrawingBufferSizeForTesting:p=>{e.canvasView().setMaximumDrawingBufferSizeForTesting(p)},clearMaximumDrawingBufferSizeForTesting:()=>{e.canvasView().clearMaximumDrawingBufferSizeForTesting()},triggerResizeForTesting:()=>{e.canvasView().triggerResizeForTesting()},reset:()=>{e.state().prototypeState().resetState(),e.unloadSceneAndResetPrototypeLib()},loadFile:(p,A)=>{let v={prototypeApp:_n.instance,skewKiwiSerialization:bd(),deprecatedJsSceneHooks:_n.instance};A(v).then(E=>{let D=E.cppModules;e.state().setFontListPromise(E.fontListPromise),e.initializePrototypeLib(D),X.getFeatureFlags().internal_only_debug_tools&&(y.fullscreen=D==null?void 0:D.debuggingHelpers,window.DebuggingHelpers=y);let G=p.bytes,U=J.fromString(p.nodeId);J.isRoot(U)&&(U=null);let M=p.startingPointNodeId,z=p.imagePrefixURL,B=p.videoPrefixURL,w=p.renderDots;typeof z=="string"&&cr.setImagePrefixURL(z),typeof B=="string"&&cr.setVideoPrefixUrl(B),e.state().serialization().decodeSceneForViewerAndPrototypeLib2(G,"DUMMY_FILE_KEY").then(P=>{if(t.disconnect(),e.state().prototypeState().resetPrototype(),e.state().setScene(P),e.state().setRenderDots(!!w),e.canvasView().setBackgroundEnabled(!w),P.setAllTlfsLoaded(),X.getViewerMode()==X.ViewerMode.PROTOTYPE){let H=e.state().scene().findNode(U);if(H==null){let ne=e.state().scene().findNode(J.fromString(M));if(ne!=null&&ne.isTopLevel()&&IA(ne)&&(H=ne),H==null){let W=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();W.length>0&&(H=e.state().scene().findNode(J.fromString(W[0])))}}e.state().setActivePrototypeStartingPointNodeId(J.fromString(M));let Q=e.state().prototypeStructure().nodeToRestartPrototypeOn(e.state().getActiveCanvas()),Y=H==null?void 0:H.topLevelAncestor();if(Y!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays(Y.id());else if(Q!=null)e.state().prototypeState().navigateToFrameAndCloseOverlays(Q.id());else if(!Oi)throw new Error("Calling loadFile in PROTOTYPE mode but with a file that isn't a valid prototype")}e.state().fontListPromise().then(()=>{n.trigger("sceneDidCompleteInitialLoad")})})})},navigateForward:()=>{e.canvasView().navigateForward(19)},navigateBackward:()=>{e.canvasView().navigateBackward(18)},navigateToFrameAndCloseOverlays:p=>{let A=J.fromString(p);A!=null&&e.state().prototypeState().navigateToFrameAndCloseOverlays(A)},navigateToFrameAtIndex:p=>{e.canvasView().navigateToFrameAtIndex(p)},restartPrototype:()=>{e.state().prototypeState().restartPrototype(1)},forceFrame:()=>{e.window().forceFrame!=null&&Nd(()=>{e.window().forceFrame()})},setScalingMode:p=>{if(typeof p!="string")throw new Error("Expected string");p=="free"&&console.warn("setScalingMode('free') called "),e.state().prototypeState().setFitModeFromParameter(p),e.state().prototypeState().getCurrentFitMode()==3&&e.canvasView().viewport().setCameraZoom(0,1)},setTransitionOnClick:p=>{e.state().prototypeState().setTransitionOnClick(p)},setShowHotspots:p=>{e.canvasView().setShowHotspots(p)},setShowDeviceFrame:p=>{e.state().prototypeState().setShowDeviceFrame(p),e.canvasView().viewport().invalidate()},toggleInteractionRecording:p=>{p?NC(e):e.window().clearAfterNotify()},getBackgroundColor:()=>ey(e),getPrototypeBackgroundColor:()=>ty(e),getPrototypeStartNodeId:()=>{let p=null,A=e.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();return A.length>0&&(p=J.fromString(A[0])),p==null||!J.isValid(p)?null:p},getActivePrototypeStartingPointNodeId:()=>{let p=e.state().activePrototypeStartingPointNodeId();return p==null||!J.isValid(p)?null:p},setActivePrototypeStartingPointNodeId:p=>{let A=J.fromString(p);e.state().activePrototypeStartingPointNodeId()!=A&&e.state().setActivePrototypeStartingPointNodeId(A)},prototypeStartingPointsData:()=>{let p=e.state().prototypeStructure();return p==null?null:p.prototypeStartingPointsData()},getBaseScreenId:()=>e.state().baseScreenId(),getCurrentOverlayIdsForTesting:()=>e.state().prototypeState().getCurrentOverlayIds().map(p=>p),getOnscreenStatesForTesting:()=>e.state().prototypeState().getOnscreenStates().map(p=>({stablePath:p.a.guids.map(A=>A),stateId:p.b})),pageIdForNodeId:p=>{var E;let A=e.state().scene();if(A==null)return null;let v=A.findNode(p);return(E=v==null?void 0:v.findContainingCanvasOrSelf())==null?void 0:E.id()},prototypeType:()=>{let p=e.state().prototypeStructure();return p==null||p.currentType()==1?"FRAME_LIST":"NONLINEAR"},requestPage:p=>{var D;let A,v=J.fromString(p),E=(D=e.state().scene())==null?void 0:D.findNode(v);E!=null&&E.type()=="CANVAS"&&e.state().requestSetActiveCanvas(E)},setCurrentPageId:p=>{var D;let A,v=J.fromString(p),E=(D=e.state().scene())==null?void 0:D.findNode(v);E!=null&&E.type()=="CANVAS"&&e.state().setActiveCanvas(E)},getCurrentPageId:()=>{var A;let p=e.state().getActiveCanvas();return(A=p==null?void 0:p.findContainingCanvasOrSelf())==null?void 0:A.id()},getNodesToShowInPrototype:()=>e.state().prototypeStructure().topLevelPrototypeNodesInOrder(),getStatsForAnalytics:()=>{let p=e.state().getActiveCanvas();if(p==null)throw new Error("Asking for stats without an active canvas");let A=p.prototypeDevice();return{pageId:p.id(),deviceType:A.type,presetIdentifier:A.presetIdentifier,graphicsCardName:e.canvasView().graphicsCardName(),isHardwareAccelerationDisabled:O.isUsingSoftwareRenderer(e.canvasView().getContext()),isHighDPR:X.isHighDPR(),fastImageDecode:Mr.browserSupportsFastImageDecoding()}},getPrototypeDeviceType:()=>{let p=e.state().getActiveCanvas();return p==null?(Le("Asking for prototype device type without a playback canvas"),"NONE"):p.prototypeDevice().type},getCurrentTlfBounds:()=>{var v;let p=(v=e.state().baseScreenNode())==null?void 0:v.canvasSpaceBoundingBox(),A=V.new2();return p==null?null:(p.transformInto2(A,e.canvasView().canvasSpaceToWindowSpace()),ef(A))},setUserDidAttemptZoom:p=>{e.canvasView().userDidAttemptZoom=A=>{p(qg[A])}},getCanvasSpaceBoundsByNodeId:p=>{let A={},v=e.state().scene();if(v==null)throw new Error("No current scene");for(let E of p){let D=J.fromString(E);if(D==null)continue;let G=v.findNode(D);if(G==null)continue;let U=G.canvasSpaceBoundingBox();A[E]=new Map([["x",U.x()],["y",U.y()],["width",U.width()],["height",U.height()]])}return A},watchBoundsForNodes:p=>{let A=CC(p);o.setNodesWithComments(A)},getPrototypeStateCurrentIndex:()=>e.state().prototypeState().getCurrentBaseScreenIndex(),getNavigateForwardEnabled:()=>e.state().prototypeStructure().currentType()==1?e.state().prototypeState().getNextBaseScreenIdForFrameList()!=null:e.state().prototypeState().getNextBaseScreenIdForPrototype()!=null,getNavigateBackwardEnabled:()=>e.state().prototypeState().getPreviousBaseScreenId()!=null,getPages:()=>a.pages(),viewport:()=>{let p=e.canvasView().viewport(),A=p.offset(),v=p.zoomScale();return{offset:{x:A.x(),y:A.y()},zoomScale:v}},getStatsForDebugging:()=>Cr.getStatsForDebugging(),on:n.on.bind(n),off:n.off.bind(n),trigger:n.trigger.bind(n),playbackInteraction:p=>{if(u==2){let A=Il.deserialize(p,f,S,g);e.window().notify(A)}},setNewContainerElement:p=>{e.window().setNewContainerElement(p)},canvasViewCursorForTesting:()=>Xd[e.canvasView().cursor()],lastTopLevelTransitionPropertiesForTesting:()=>{let p=e.state().prototypeState().lastInitiatedTopLevelStateChange();return p==null||p.transitionParameters==null?null:{type:p.transitionParameters.transitionType,durationSeconds:p.transitionParameters.transitionDuration}},lastICTransitionPropertiesForTesting:()=>{let p=e.state().prototypeState().lastInitiatedInstanceStateChange();return p==null||p.transitionParameters==null?null:{type:p.transitionParameters.transitionType,durationSeconds:p.transitionParameters.transitionDuration}},scrollOffsetForNodeInBaseScreenForTesting:p=>{let A=e.state().scene();if(A==null)return{};let v=A.findNode(p);return v!=null?v.scrollOffset().toJSON():R.new2().toJSON()},scrollOffsetForNodeInOverlayAtForTesting:(p,A)=>{let v=e.state().scene();if(v==null)return{};let E=v.findNode(p);return E!=null?E.scrollOffset().toJSON():R.new2().toJSON()},getCanvasSpaceCommentLocations:p=>{let A=e.state().scene();if(A==null)return{};let v=new Map;for(let E in p)v.set(E,gs.fromJSON(p[E]));return o.getCanvasSpaceCommentLocations(A,v)},getCommentDestinationAtPosition:p=>{let A=new R(p.x,p.y),v=o.getCommentDestinationAtPosition(A);return v==null?null:v.toJSON()},onChange:p=>{var A;(A=e.state().scene())==null||A.onChange(p)},getRevisionNumber:()=>{var p;return(p=e.state().scene())==null?void 0:p.getRevisionNumber()},setLoadFullDocument:p=>e.multiplayerSession().incrementalLoader().dangerouslySetLoadFullDocument(p),getThumbnailForSlide:(p,A,v)=>{var w;let E=(w=e.state().scene())==null?void 0:w.findNode(p);if(!E){console.log("Cannot get thumbnail for node that does not exist");return}if(E.type()!="SLIDE"){console.log("Cannot get thumbnail for non-slide node");return}let D=E.fullSizeCanvasSpaceBoundingBox().topLeft(),G=E.fullSize().x()/A,U=E.fullSize().y()/v,M=Math.max(G,U),z=new Nn(D,M);return e.canvasView().slideThumbnailRenderer().generateThumbnail(E,z,A,v)},isWaitingForDeviceFrameToLoadForTesting:()=>{var A;let p=e.state().getActiveCanvas();return p==null?!1:(A=e.canvasView().deviceRenderer())==null?void 0:A.isWaitingForDeviceFrameToLoad(p.prototypeDevice())},prototypeViewHitTest:p=>{let A=new R(p.x,p.y),v=e.state().baseScreenNode();return v==null?{type:"NONE"}:e.canvasView().hitTestDeviceFrame(A)?{type:"DEVICE_FRAME"}:v.canvasSpaceBoundingBox().contains2(A)?{type:"CURRENT_TLF"}:{type:"PROTOTYPE_BACKGROUND"}},getPrototypeNode:p=>{var A;return(A=e.state().scene())==null?void 0:A.findNode(p)},getTopmostFrameNode:p=>e.state().prototypeState().getTopmostScreen(),mapChildren:(p,A)=>{let v=[];if(p.isStack())for(let E=0,D=p.childCount();E<D;E=E+1)v.push(A(p.childAt1(E)));else for(let E=0,D=p.childCount();E<D;E=E+1)v.push(A(p.childAt1(p.childCount()-E-1)));return v},nodeId:p=>p.id(),nodeName:p=>p.name(),nodeParent:p=>p.parent(),nodeType:p=>p.type(),nodeCanvasSpaceBounds:p=>ef(p.canvasSpacePreviewBounds()),nodeDisplayBounds:p=>{let A=null;if(p.parent().type()=="CANVAS"){let v=e.state().prototypeState().getOpenOverlayData(p.id());v!=null?A=v.renderedBounds(e.state().prototypeState().getCurrentBaseScreenNode()):A=p.canvasSpaceScrolledBounds(1),A=e.canvasView().viewport().canvasSpaceToViewSpace1().transformRect(A.clone())}else{let v=p.fullSize(),E=new V(0,0,v.x(),v.y()),D=p.relativeTransform().clone(),G=ee.new2();G.scale2(e.canvasView().viewport().canvasSpaceToViewSpace1().scale()),D.leftMultiply(G),A=D.transformRect(E)}return ef(A)},nodeFillTypes:p=>p.fillPaints().map(A=>A.type()),nodeInteractions:p=>p.prototypeInteractions().filter(A=>A.action()!=null&&A.action().value.connectionType()!="NONE").map(A=>RC(A)),nodeScrollBounds:p=>{let A=null;if(p.hasOverflowingContentInScrollDirection()){let v=p.canvasSpaceContentBounds(),E=p.scrollOffset();A={x:E.x(),y:E.y(),width:v.width(),height:v.height()}}return A},nodeScrollTo:(p,A,v)=>{p.setScrollOffset(new R(A,v))},nodeText:p=>{var A;return(A=p==null?void 0:p.textData())==null?void 0:A.characters()},nodeVisible:p=>p==null?!1:p.visible(),nodeAccessibilityProperties:p=>({label:p.accessibleLabel()}),nodeCharacterStyles:p=>{var v,E,D;let A=(v=p==null?void 0:p.textData())==null?void 0:v.characters();if(A!=null){let G=hr._new();hr.set(G,6,p.get(6));let U=(E=p==null?void 0:p.textData())==null?void 0:E.characterStyleIds(),M=((D=p==null?void 0:p.textData())==null?void 0:D.styleOverrideTable())??new kr,z=U!=null?U.length:0,B=0,w=0,P=[],H=(Q,Y,ne)=>{let W=new Map;hr.each(G,(j,ge)=>{W.set(wt[j],ge)});let K=M==null?void 0:M.styleByID2();if(K!=null){let j=zt.IntMap_get(K,ne,null);j!=null&&hr.each(j,(ge,Ue)=>{W.set(wt[ge],Ue)})}P.push({start:Q,end:Y,props:W})};for(let Q=0,Y=A.length;Q<Y;Q=Q+1){let ne=z>Q?U[Q]:0;M._in(ne)||(ne=0),B!=ne&&(H(w,Q,B),B=ne,w=Q)}return H(w,A.length,B),P}else return[]},nodeLineData:p=>{var v;let A=(v=p==null?void 0:p.textData())==null?void 0:v.lines();return A!=null?A.map(E=>({indentLevel:E.indentationLevel,lineType:E.lineType})):null},nodeTriggerInteraction:(p,A)=>{let v=0;A=="ON_CLICK"&&(v=4);let E=e.state().prototypeStructure().findHotspotsWithInteractionType(p,0,A);for(let D of E){let G=e.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(D.node,A);for(let U of G){e.canvasView().triggerHotspot(D,U,v,null);return}}},nodeHover:p=>{let A=new No(p);e.canvasView().handleHoverAtHotspot(A)},nodeReverseHover:p=>{let A=new No(p);e.canvasView().handleReverseHoverAtHotspot(A)},nodeTableCells:p=>{if(p.type()!="TABLE")return null;let A=[];for(let v=0,E=p.childCount();v<E;v=v+1)A.push(p.childAt1(p.childCount()-v-1));return A},nodeTableCellContent:p=>{var A,v;return p.type()!="TABLE_CELL"?null:(v=(A=p.childAt1(0))==null?void 0:A.textData())==null?void 0:v.characters()},nodeInteractiveSlideConfigData:p=>p.interactiveSlideConfigData(),nodeInteractiveSlideParticipantData:p=>p.interactiveSlideParticipantData(),nodeSlideSpeakerNotes:p=>p.slideSpeakerNotes(),nodeSlideThumbnailHash:p=>p.slideThumbnailHash(),getCurrentOverlayStack:()=>e.state().prototypeState().getCurrentOverlays().map(p=>p.node()),setFeatureFlagsForTesting:p=>{X.setFeatureFlags(p)},setPrototypeBackgroundColorOverride:p=>{let A=C.new2(p>>16&255,p>>8&255,p&255,255);X.setPrototypeBackgroundColorOverride(new fe(A))},resetStateForTests:()=>{e.canvasView().resetStateForTests()},takeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().getContext().takeSpectorSnapshot()},clearTileCachesAndTakeSpectorSnapshot:()=>{e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().getContext().takeSpectorSnapshot()},renderLayerByLayerActivate:()=>{X.internalDebugTools()&&(e.canvasView().viewport().invalidate(),e.canvasView().clearTileCaches(),e.canvasView().renderLayerByLayerActivate())},renderLayerByLayerDeactivate:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerDeactivate()},renderLayerByLayerPlay:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerPlay()},renderLayerByLayerPause:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerPause()},renderLayerByLayerForward:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerForward()},renderLayerByLayerBackward:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerBackward()},renderLayerByLayerRewind:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerRewind()},renderLayerByLayerIncreaseSpeed:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerIncreaseSpeed()},renderLayerByLayerDecreaseSpeed:()=>{X.internalDebugTools()&&e.canvasView().renderLayerByLayerDecreaseSpeed()},toggleRenderTreePrinting:()=>{X.internalDebugTools()&&e.canvasView().toggleRenderTreePrinting()},getAndResetOptimizationExposures:()=>Lt.getAndResetOptimizationExposures()};return 3==0&&(I.app=e),_n.instance.setViewer(I),I}function wC(){return{prototypeApp:_n.instance,skewKiwiSerialization:bd(),deprecatedJsSceneHooks:_n.instance}}function iy(){let i=window,e=i.Fig;e||(i.Fig=e={}),e.createViewer=async t=>{if(delete e.createViewer,!(t instanceof Object))throw new Error("Missing parameters");return await OC(t)},e.getPrototypeAppBindingsForTest=()=>(delete e.getPrototypeAppBindingsForTest,wC())}var oh=class oh{setSerialization(e){this._serialization=e}decodeFillPaintData(e){if(e.length==0)return Ce.EMPTY;let t=ke().decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let r=null;try{let n=t.nodeChanges[0],o=n.fillPaints!=null?n.fillPaints:n.strokePaints;r=this._serialization.decodePaints(o,t.blobs)}catch(n){Le("Caught error during fill paints marshaling. Rendered output may be incorrect"),Le(n),r=Ce.EMPTY}return r}decodeSingleSolidFillWithNormalBlendMode(e,t,r){if(e.alpha!=1)throw new Error("Alpha from C++ is always expected to be 1");let n=new te("SOLID");return n.setColor(C.new3(e.red,e.green,e.blue,e.alpha)),n.setOpacity(t),n.setIsEnabled(r),[n]}decodeEffectData(e){let t=ke().decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return It.decodeEffects(t.nodeChanges[0].effects)}decodePrototypeInteractions(e){let t=ke().decodeNodeChange(e);if(t==null)throw new Error("Got bad node change from C++");return It.decodePrototypeInteractions(t.prototypeInteractions)}decodeVectorData(e){let t=ke().decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return this._serialization.decodeVectorData(t.nodeChanges[0].vectorData,t.blobs)}decodeTextData(e,t){let r=ke().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=this._serialization.decodeTextData(r.nodeChanges[0].textData,r.blobs),o=[];for(let a of t)o.push(this._serialization.decodeEmojiImage(a));return new yi(n.styleOverrideTable(),n.fontSizes(),n.hyperlinkBoxesDEPRECATED(),n.characters(),n.lines(),n.characterStyleIds(),t,o)}decodeDerivedTextData(e,t){let r=ke().decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=this._serialization.decodeDerivedTextData(r.nodeChanges[0].derivedTextData,r.blobs),o=[];for(let a of t)o.push(this._serialization.decodeEmojiImage(a));return new ba(n.hyperlinkBoxes(),t,o)}constructor(){this._serialization=null}};oh.instance=new oh;var nh=oh;function ay(){Kf(new nh)}function xC(){console.debug("viewer build: sk"),ay(),iy()}xC();})();
//!!!!!!!!!!!!!!!!!!!!!!
/*! Bundled license information:

diff/dist/diff.js:
  (*!
  
   diff v3.5.0
  
  Software License Agreement (BSD License)
  
  Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
  
  All rights reserved.
  
  Redistribution and use of this software in source and binary forms, with or without modification,
  are permitted provided that the following conditions are met:
  
  * Redistributions of source code must retain the above
    copyright notice, this list of conditions and the
    following disclaimer.
  
  * Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the
    following disclaimer in the documentation and/or other
    materials provided with the distribution.
  
  * Neither the name of Kevin Decker nor the names of its
    contributors may be used to endorse or promote products
    derived from this software without specific prior
    written permission.
  
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR
  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
  IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  @license
  *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=https://admin.figma.com/admin/viewerbuild-artifacts/8e652da5f23cdd50d5fde1d0e6d72097ac6af1e1/ts-viewer.js.map

//# debugId=76ba77ca-7525-511b-a1e9-4d3e6defed39
